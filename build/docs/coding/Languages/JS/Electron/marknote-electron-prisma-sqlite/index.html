<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-coding/Languages/JS/Electron/marknote-electron-prisma-sqlite">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">marknote-electron-prisma-sqlite | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="marknote-electron-prisma-sqlite | 南川笔记"><meta data-rh="true" name="description" content="1. 目标"><meta data-rh="true" property="og:description" content="1. 目标"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="docsWrapper_lLmf"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_PuQw" type="button"></button><div class="docRoot_kBZ6"><aside class="theme-doc-sidebar-container docSidebarContainer_S51O"><div class="sidebar_vtcw"><nav class="menu thin-scrollbar menu_rWGR"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/coding/SLAM/A01-recognizeLights">coding</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/SLAM/A01-recognizeLights">SLAM</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/DevOps/certbot ssl 证书">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/coding/Languages/CPP/cpp-howto">Languages</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/CPP/cpp-howto">CPP</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/CSS/css-howto">CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/Go/go-howto">Go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/HTML/html-howto">HTML</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/coding/Languages/JS/CodeQuality_eslint_prettier_jest/eslint-howto">JS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/JS/CodeQuality_eslint_prettier_jest/eslint-howto">CodeQuality_eslint_prettier_jest</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/coding/Languages/JS/Electron/electron-bugfix">Electron</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/Electron/electron-bugfix">electron-bugfix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/Electron/electron-howto">electron howto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2">electron prisma sqlite 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite">marknote-electron-prisma-sqlite</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/JS/React/react-howto">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/JS/Vue/vue-howto">Vue</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/database">database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/develop-remark-plugin">develop-remark-plugin</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/JS/es6/acknowledgment">es6</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/js-bugfix">js-bugfix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/js-discuss">js discuss</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/js-howto">js-howto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/npm_yarn-bugfix">npm/yarn bugfix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/npm_yarn-howto">npm_yarn-howto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/JS/redux">redux</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/Java/java-howto">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/Markdown/markdown-howto">Markdown</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/Python/fastapi-howto">Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/TS/ts-bugfix">TS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/Unity/unity-howto">Unity</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Languages/coding-best-practice">coding best practice</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/regex/regex-howto">regex</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Mac存储清理">Mac存储清理</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/OS/Linux/centos-init-manual">OS</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Poketto Dev Notes">Poketto Dev Notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Software/Adobe/PS/support-for-little-stars/">Software</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/apple">apple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/clash">clash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/coding-philosophy">coding philosophy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/composite/full-guide_cross-copy-over-ssh-vim-tmux">composite</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/css">css</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/electron">electron</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/hardware/rockchip/rockchip4-flash-manual">hardware</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/init-server">init-server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/moments">moments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/mongodb">mongodb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/next-i18next">next-i18next</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/next-themes">next-themes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/nextjs-best-practice">nextjs-best-practice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/nextjs">nextjs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/poetry">poetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/python">install python 3.11</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/vim">vim</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/websocket">websocket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/图形化语言">图形化语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/微信迁移">微信迁移</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/极客排版微信公众号最佳实践">极客排版微信公众号最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/毁灭人生的打包记">毁灭人生的打包记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/测试不同风格的toc">测试不同风格的toc</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/文集/2020-06-12-王逸成">education</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/series/NC-PFA/">series</a></div></li></ul></nav></div></aside><main class="docMainContainer_EfwR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_n6xZ"><div class="docItemContainer_RhpI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Wvrh" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_VLFi"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">coding</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Languages</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">JS</span><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Electron</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">marknote-electron-prisma-sqlite</span><meta itemprop="position" content="5"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.17.0+</span><div class="tocCollapsible_BEWm theme-doc-toc-mobile tocMobile_NSfz"><button type="button" class="clean-btn tocCollapsibleButton_IbtT">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>marknote-electron-prisma-sqlite</h1></header><ol><li><a href="#%E7%9B%AE%E6%A0%87">目标</a></li><li><a href="#%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%8F%AF%E4%BB%A5%E8%AF%BB%E5%8F%96env%E5%8F%98%E9%87%8F">在生产环境下可以读取<code>.env</code>变量</a></li><li><a href="#%E7%9B%AE%E5%89%8D%E5%B7%B2%E7%BB%8F%E5%AE%9E%E7%8E%B0%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%8B%A5%E6%9C%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8Fprisma%E5%8F%AF%E4%BB%A5%E8%AF%BB%E5%8F%96">目前已经实现在生产环境下，拥有环境变量，prisma 可以读取</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F">实现方式</a></li><li><a href="#%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82">实现细节</a></li><li><a href="#%E5%9C%A8%E6%89%93%E5%8C%85%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%B2%A1%E6%9C%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">在打包环境下，没有环境变量</a></li><li><a href="#%E4%B8%8D%E8%80%83%E8%99%91%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9B%B4%E6%8E%A5%E7%A1%AC%E7%BC%96%E7%A0%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6%E5%9C%B0%E5%9D%80">不考虑环境变量，直接硬编码数据库文件地址</a></li><li><a href="#electron-builder-load-env">electron-builder load <code>.env</code></a></li><li><a href="#%E6%89%93%E5%8C%85%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%AB%9F%E7%84%B6%E8%AF%BB%E5%88%B0%E4%BA%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">打包环境下，竟然读到了环境变量</a></li><li><a href="#%E9%87%8D%E5%BC%80%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8C%E5%88%86%E6%AE%B5%E6%B5%8B%E8%AF%95">重开项目进行分段测试！</a></li><li><a href="#%E6%91%8A%E7%89%8C%E4%BA%86">摊牌了</a></li></ol><blockquote><p>本篇谨以记录一天一夜（2022 年 1 月 1 日晚 8 点到 1 月 2 日晚 11 点）才解决某软件打包后运行异常的问题，原本只为弄清问题，理清思路，才一步步调试记录，遂成文章。</p><p>本次为破解难题，可谓心情沉重与复杂，全程关灯关门听着大提琴与钢琴奋战才有所获。但最终的答案，却并非来自问题本身，而是涉及到问题背后的问题，因而，给我的教训更为深刻，价值也更为宝贵，遂刊之。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="目标">目标<a class="hash-link" href="#目标" title="标题的直接链接">​</a></h2><ul><li>✅ G1. 在开发环境下，实现初始化数据库、运行中 CRUD 数据库</li><li>✅ G2. 在生产环境下，实现初始化数据库、运行中 CRUD 数据库</li><li>⚪ G1. 在打包环境下，实现初始化数据库、运行中 CRUD 数据库（update: ✅ solved since it&#x27;s out of permission）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="在生产环境下可以读取env变量">在生产环境下可以读取<code>.env</code>变量<a class="hash-link" href="#在生产环境下可以读取env变量" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="目前已经实现在生产环境下拥有环境变量prisma-可以读取">目前已经实现在生产环境下，拥有环境变量，prisma 可以读取<a class="hash-link" href="#目前已经实现在生产环境下拥有环境变量prisma-可以读取" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="实现方式">实现方式<a class="hash-link" href="#实现方式" title="标题的直接链接">​</a></h3><p>在<code>webpack.config.main.prod.ts</code>中，使用<code>dotenv-webpack</code>插件，会自动读取<code>.env</code>变量 <img loading="lazy" alt="picture 1" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641202097111-0447d8c9b7bd4cd446543df4d7035c78d381a8761aec5cb5b05cbf6b7723f0bb.png" width="480" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="实现细节">实现细节<a class="hash-link" href="#实现细节" title="标题的直接链接">​</a></h3><ol><li>运行<code>npm run build</code></li></ol><img loading="lazy" alt="picture 2" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641202237567-148ee19c466945aed7f23593a02481637c539148cba0fe1a432f256503955cad.png" width="480" class="img_vXGZ"><ol start="2"><li>运行<code>electron release/app</code></li></ol><img loading="lazy" alt="picture 4" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641202270373-c3cf875b689d3bd464af4ca317c504e7cb0f8efb0383731d8c1f76bbe03dc93e.png" width="480" class="img_vXGZ"><p>可以看到，已经有<code>DATABASE_URL</code>变量，该输出由源代码执行：</p><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/main/db.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dotenv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;electron&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> path </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;path&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotenv</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dbPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;userData&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sqlite.db&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dbUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">file:</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">dbPath</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">?connection_limit=1</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">The db url specified is </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">dbUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">, and the envs are:</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>该输出证明，<code>build</code>环境中已经有了<code>.env</code>变量</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="在打包环境下没有环境变量">在打包环境下，没有环境变量<a class="hash-link" href="#在打包环境下没有环境变量" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="不考虑环境变量直接硬编码数据库文件地址">不考虑环境变量，直接硬编码数据库文件地址<a class="hash-link" href="#不考虑环境变量直接硬编码数据库文件地址" title="标题的直接链接">​</a></h2><p>遇到了 Query 的问题，猜测是<code>query_engine</code>或者<code>@prisma</code>没有存放到指定位置的问题。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">PrismaClientKnownRequestError</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Failed</span><span class="token plain"> to validate the query</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Field does not exist on enclosing type.</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"> at </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Query.findManyerp</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641204200999-c3b7893d1e1a9b20659680a5516ed4a55ae9e5d1b9a0ab0da9c5ecfae5334b76.png" width="480" class="img_vXGZ"><h2 class="anchor anchorWithStickyNavbar_rB0w" id="electron-builder-load-env">electron-builder load <code>.env</code><a class="hash-link" href="#electron-builder-load-env" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="打包环境下竟然读到了环境变量">打包环境下，竟然读到了环境变量<a class="hash-link" href="#打包环境下竟然读到了环境变量" title="标题的直接链接">​</a></h2><img loading="lazy" alt="picture 1" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641206574494-62b217d0682587a549060e729667364448d1db47ffca110edd765a2345230dbe.png" width="480" class="img_vXGZ"><p>去掉以下之后，依旧有：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;from&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prisma.env&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;to&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.env&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 2" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641206809254-93caae8af81cc0898e0e41c0a8a3f515508e6907a32a5e8ae7fcd1f7ce418502.png" width="480" class="img_vXGZ"><p>再尝试去掉以下，还是有。。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;node_modules/.prisma/client/**/*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 3" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641206997694-7ff13106e6e66c40c94c82b9f9efd584941b6be7cad0a22009cfa676ffeac3f2.png" width="480" class="img_vXGZ"><p>——————</p><p>再尝试去掉最后的一项：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// package.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&#x27;node_modules/@prisma/client/**/*&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 4" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641207175716-7b76bc74a00534f1271bbd55c26a6ad32d225fff2f655199472616ab35dda167.png" width="480" class="img_vXGZ"><p>他喵的，还是有啊。</p><p>难道是缓存？</p><p>我删掉再试一遍！</p><p>——————</p><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641207355025-cced27ae67e7b5471da8da199da9fed844268c387ab664321849800903174184.png" width="480" class="img_vXGZ"><p>沃日啊，还有！</p><p>这下我就不明白了……</p><p>不知道是不是<code>dotenv-webpack</code>还是<code>prisma generate</code>搞的鬼。</p><p>我再把<code>dotenv-webpack</code>取消了看看！</p><p>——————</p><img loading="lazy" alt="picture 6" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641207608998-81f1ed696f9e63e07364a0881b38bc5f19b89d3f6264357e8e930f62770ecdd0.png" width="480" class="img_vXGZ"><p>哈哈哈哈，果然没有了！</p><p>看样子真跟这个有关，那现在我再加回来，看看还有没有。</p><p>——————</p><p>果然又有了！</p><img loading="lazy" alt="picture 7" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641207757455-df00e99a1719abe2f2d8db45495098f6405b94e6886a51b0533558bf3f926366.png" width="480" class="img_vXGZ"><p>那现在，我再去程序中，把<code>dotenv</code>的<code>config</code>句，取消，应该就没了吧！</p><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/main/db.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dotenv</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>——————</p><p>擦，还是有！ <img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641208023687-21c3e53559a2a67ae2ae2b5eb22d8f578d9240ff0182ea3b0ab18daa2ddc3211.png" width="480" class="img_vXGZ"></p><p>如果果然如此的话，那我直接用默认的<code>options</code>属性，是不是就可以了！</p><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/main/db.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prisma </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PrismaClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prisma </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PrismaClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，预期还是一样，会报<code>query</code>的问题，而不是像之前那样，报环境变量的问题。</p><p>因为，在<code>option</code>为空的情况下，<code>prisma</code>会去读<code>prisma/schema.prisma</code>，然后里面默认加载的是<code>env(DATABASE_URL)</code>。</p><p>—————</p><p>然而意外发生了！程序打不开了！只有一片空白！</p><img loading="lazy" alt="picture 10" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641208467702-92290684115599f52a6b00c011cc46c5ad977100676b4c9f381b752958311121.png" width="480" class="img_vXGZ"><p>但我用<code>lldb</code>却显示是正常的。当然，<code>lldb</code>太强大了，不能作为程序是否能正常运行的标准。</p><img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641208439561-e1fbee9c30db0ee9c3834c20e44cde786fff0103879e2b56074938355640942f.png" width="480" class="img_vXGZ"><p>等等，沃日，又出现了！卧槽，连数据库都连接上了！</p><img loading="lazy" alt="picture 11" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641208528717-17aaac50924d7ad35ebbb0be0087b60774dff4a9b0869a01f058c9fcde1b46da.png" width="480" class="img_vXGZ"><p>沃日，我好像悟✨✨到了什么！</p><p>看！默认的配置，除了<code>url</code>还有一个<code>provider</code>哦！！！</p><img loading="lazy" alt="picture 12" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641208953995-a523f3097e0c5f74fbc8aa8f85729b78eb203fd7803bdb83ef935b8c48a58420.png" width="480" class="img_vXGZ"><p>所以！！！</p><p>如果我们在程序中，直接同时指定这两项，是不是就等价于读取了本地<code>schema.prisma</code>了！</p><p>——————</p><p>之前用 url 的配置，虽然正确，但是覆盖了<code>prisma</code>的文件配置，然而，要想数据库真正正确地连接，除了<code>url</code>项之外，可还要有其他项的啊！</p><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/main/db.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@@ </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> @@ </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PrismaClientOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   datasources</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     db</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> dbUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// @ts-ignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">      provider</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sqlite&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为啥要加这个<code>@ts-ignore</code>呢？因为<code>d.ts</code>里没有这个定义：</p><img loading="lazy" alt="picture 13" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641209316277-e6d097dca96bbec8649b5c60ec477809dc061cd51f83c1af50a6d3aa486854b4.png" width="480" class="img_vXGZ"><p>所以，是我为了和<code>schema.prisma</code>对上，才加的，不知道结果会咋样……</p><p>——————</p><p>好的，又进入等待环节了……</p><img loading="lazy" alt="picture 14" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641209424635-f6326c5773fb7227f83e086a88f3518f564911707bf1c6b3f6b42ac3a53609e7.png" width="480" class="img_vXGZ"><p>不过，根据上次经验，可能意味着是成功的。</p><img loading="lazy" alt="picture 15" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641209524193-a1d946546ed78e7a60a135149788448a3108ea2ab5669e915bb4ee44749e7cb7.png" width="480" class="img_vXGZ"><p>我擦，很快就打脸了啊，并不是的！</p><p>这里应该是被类型报错了，意味着我不能加<code>provider</code>关键字。然后按照报错提示，去 read 了 more：</p><img loading="lazy" alt="picture 16" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641209686471-c2e5dde8844d15d542567d7c8136c1fa6efddb3df2e66f30b01a3eacdc425b99.png" width="480" class="img_vXGZ"><p>You see！这是在 api 上做了限制，只可以&#x27;programmatically&#x27;修改<code>url</code>，其他的信息是不可以的！</p><p>那行吧！</p><p>既然我们的环境变量现在是奏效的，那就直接用环境变量吧，这里不加任何参数【TODO：当然了，我们等会要去测一下，到底是哪个<code>prisma</code>文件进行初始化的，以及 url 到底是是啥】</p><p>——————</p><p>呜呜呜，在大概 20-30 秒的空白后，程序终于启动了，表现良好！</p><img loading="lazy" alt="picture 17" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210163127-a260b7367fc18cb9bc08dbf44caf8a068f542e8f8e61f2793c2ef4c1515f0916.png" width="480" class="img_vXGZ"><p>但我现在真地好奇，它到底是插的哪个数据库………………</p><p>总感觉，可能就是我本地的那个数据库……</p><p>如果是这样，我把那个数据库文件换换位置，它是不是又凉凉了…………</p><p>可能真的是本地的！因为我发现我的<code>navicat</code>被阻止了！</p><img loading="lazy" alt="picture 18" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210311381-d612f775c3c949cc7e8d278586807be36eb2e6c7b4450918b47653db662879c0.png" width="480" class="img_vXGZ"><p>刚刚插完！navicat 又好用了！而且一共 23 万条，是和本次插入目标一致的！</p><img loading="lazy" alt="picture 20" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210443057-64cd868895dc6118df816ea33858d0dfcfce611f8f333b1227866664ec538060.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 21" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210453610-df7ec67a9fd52a6dee9465570f3ca8a89eb620e683f28eab5b78743ee3aee8ec.png" width="480" class="img_vXGZ"><p>我有一个大胆的想法！</p><p>是不是因为，navicat 占着资源不放，导致我的程序启动很慢的！</p><p>因为我设置的<code>connection_limit=1</code>，为了防止插入失败！</p><p>——————</p><p>不行啊，还是很慢！还是 30 秒！我刚刚数了！</p><img loading="lazy" alt="picture 22" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210621195-dd0e5440f638be5836265de03d231f6ed4e4c78cf7b9d187e95dfeca7a7d7d58.png" width="480" class="img_vXGZ"><p>那是不是因为我在初始化的时候，就启动<code>query</code>，导致阻塞了呢？</p><p>我先试试不在启动的时候插入。</p><p>PASS: 我记得<code>github</code>上，也有<code>start wait too long</code>的问题的，晚点去看看。</p><p>——————</p><p>所以我先把 db 的初始化 query 放到了菜单栏里，主程序不在初始时执行任何数据库动作。</p><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/main/menu.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;test database connect&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            prisma</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">erp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">findMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> take</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">queried data: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">e</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">, it should has 2 items</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，预期程序启动速度就会很快了吧！</p><img loading="lazy" alt="picture 23" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641210956609-06255f626bbf7f80e5357241fb7f1a124b3e85b4d56a269cdc41d5a754802fa7.png" width="480" class="img_vXGZ"><p>沃日啊，并没有！</p><p>还是 30 多秒呢！</p><p>行啊，再测一个！</p><p>是不是数据库连接就很慢，我直接不初始化数据库行不行？</p><p>哦不行，太麻烦了，之前试过，要改很多地方，主要是 typescript 会检查导入，我直接把数据库变量取消的话，需要同时修改很多才能通过编译。</p><p>✅ 测试无数据库情况下的启动速度。结果：非常快！</p><p>——————</p><p>但是，你猜，你知道现在是啥情况吗？</p><p>是我用 lldb 或者程序启动，秒开，一切正常；接着我在内部包点击打开，需要 30 秒，然后一切正常；最后我直接在程序 logo 上点击，需要一分多钟，然后数据库没有数据结果。。</p><p>奔溃啊。</p><p>搞了这么久，还是老问题：</p><img loading="lazy" alt="picture 24" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641211571111-b2a036e5ee4fa8b346cb63205a687b6673932d9bef062abeb7e781562077a4b3.png" width="480" class="img_vXGZ"><hr><p>使用 asar 依旧不行。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="重开项目进行分段测试">重开项目进行分段测试！<a class="hash-link" href="#重开项目进行分段测试" title="标题的直接链接">​</a></h2><ol><li>剔除 db 模块（prisma, sqlite)之后秒开，2022-01-03 21:04:34</li><li>。。。</li></ol><p>ONE HOUR LATER...</p><img loading="lazy" alt="picture 25" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-prisma-sqlite-1641222126966-6b16ac915cb84333c6a0902dd19e80723746f9f5dda13aea3c11bd7c33570d0a.png" width="480" class="img_vXGZ"><h2 class="anchor anchorWithStickyNavbar_rB0w" id="摊牌了">摊牌了<a class="hash-link" href="#摊牌了" title="标题的直接链接">​</a></h2><p>历经整整有 30 个小时，原因终于在一个犄角旮旯的地方找到了：权限！！！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20220103231434862.png" alt="image-20220103231434862" class="img_vXGZ"></p><p>由于我将 sqlite 数据库存在项目里（默认行为），但并有打包进入程序，所以在开发时（无论是开发模式还是生产模式）没有问题，但是打包成可运行程序后，就有读写权限问题了。</p><p>这导致程序启动的时候，直接 cpu 飙升（到七八十），为啥呢？肯定是陷入了权限申请的无线循环！</p><p>然后三十多秒中甚至一分多钟后才打开，为啥呢？因为超时放弃了！</p><p>那为什么在摸索的过程中有出现过可以打开的情况呢？</p><p>那是因为我有过将 sqlite 存到 userdata 的尝试，那样连接的时候就没问题了，只不过 prisma 找不到，因为 prisma 要提前配置。</p><p>那接下来怎么办？</p><p>肯定还是不能在 userdata 里直接存业务数据的把，这样太大了？但也许也不是这么个意思，app 就那么大（1-300M），数据是单独存在程序对应的数据区的，即使把程序卸载，数据还在，这个模式应该还是比较合适的。不合适的是直接把 sqlite（尤其是已经有数据的）打包进程序，虽然我有这么做过，网上也有这么做的，但是场景不同啊，别人打包进去可能只是存一些基本数据、用户数据等，不像我这个场景，是用来存业务的，存业务应该是在 userdata 里新开数据库！这样才稳妥！</p><p>诶……</p><p>ref:</p><p>SPECIAL THANKS：</p><ul><li><a href="https://stackoverflow.com/questions/49784259/exported-electron-app-doesnt-work-on-macos" target="_blank" rel="noopener noreferrer">javascript - Exported Electron APP doesn&#x27;t work on MacOS - Stack Overflow</a></li></ul><p>about electron:</p><ul><li><p><a href="https://www.electronjs.org/zh/docs/latest/tutorial/using-native-node-modules" target="_blank" rel="noopener noreferrer">Node 原生模块 | Electron</a></p></li><li><p><a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="noopener noreferrer">electron-userland/electron-builder: A complete solution to package and build a ready for distribution Electron app with “auto update” support out of the box</a></p></li><li><p><a href="https://www.electronforge.io/" target="_blank" rel="noopener noreferrer">Getting Started - Electron Forge</a></p></li><li><p><a href="https://stackoverflow.com/questions/59566904/no-such-file-or-directory-inside-app-asar-electron-nodejs" target="_blank" rel="noopener noreferrer">python - No such file or directory inside app.asar (electron/nodejs) - Stack Overflow</a></p></li></ul><p>about prisma:</p><ul><li><p><a href="https://www.prisma.io/docs/reference/api-reference/prisma-client-reference#upsert" target="_blank" rel="noopener noreferrer">Prisma Client API (Reference) | Prisma Docs</a></p></li><li><p><a href="https://www.prisma.io/docs/guides/deployment/deployment" target="_blank" rel="noopener noreferrer">Deploying projects using Prisma to the cloud | Prisma Docs</a></p></li><li><p><a href="https://github.com/prisma/prisma/issues/10236" target="_blank" rel="noopener noreferrer">Prisma has a very slow startup time when my database has 100+ tables · Issue #10236 · prisma/prisma</a></p></li><li><p><a href="https://stackoverflow.com/questions/69323946/electron-prisma-error-can-not-find-module-prisma-client" target="_blank" rel="noopener noreferrer">javascript - Electron-Prisma Error: can not find module &#x27;.prisma/client&#x27; - Stack Overflow</a></p></li><li><p><a href="https://stackoverflow.com/questions/64088437/how-to-use-prisma-with-electron" target="_blank" rel="noopener noreferrer">angularjs - How to use Prisma with Electron - Stack Overflow</a></p></li></ul><p>about environment variables: (a good discussion about whether to use dynamic env)</p><ul><li><p><a href="https://chat.stackoverflow.com/rooms/186836/discussion-between-sigmasoldier-and-albert-chen" target="_blank" rel="noopener noreferrer">Discussion between SigmaSoldier and Albert Chen | chat.stackoverflow.com</a></p></li><li><p><a href="https://www.npmjs.com/package/dotenv-cli" target="_blank" rel="noopener noreferrer">dotenv-cli - npm</a></p></li><li><p><a href="https://github.com/kentcdodds/cross-env" target="_blank" rel="noopener noreferrer">kentcdodds/cross-env: 🔀 Cross platform setting of environment scripts</a></p></li><li><p><a href="https://www.genui.com/resources/env-variables-json" target="_blank" rel="noopener noreferrer">How To Use .env Variables In package.json | GenUI</a></p></li><li><p><a href="https://www.prisma.io/docs/guides/development-environment/environment-variables" target="_blank" rel="noopener noreferrer">Environment variables | Prisma Docs</a></p></li><li><p><a href="https://stackoverflow.com/questions/54214340/electron-builder-how-to-set-node-environmental-variables" target="_blank" rel="noopener noreferrer">node.js - electron-builder, how to set node environmental variables - Stack Overflow</a></p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/markshawn2020/docusaurus/edit/master/my-documents/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_IMw_" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_DtqZ"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-09-17T09:17:49.000Z">2024年9月17日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">electron prisma sqlite 2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/coding/Languages/JS/React/react-howto"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">react-howto</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_RLlU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目标" class="table-of-contents__link toc-highlight">目标</a></li><li><a href="#在生产环境下可以读取env变量" class="table-of-contents__link toc-highlight">在生产环境下可以读取<code>.env</code>变量</a><ul><li><a href="#目前已经实现在生产环境下拥有环境变量prisma-可以读取" class="table-of-contents__link toc-highlight">目前已经实现在生产环境下，拥有环境变量，prisma 可以读取</a></li><li><a href="#实现方式" class="table-of-contents__link toc-highlight">实现方式</a></li><li><a href="#实现细节" class="table-of-contents__link toc-highlight">实现细节</a></li></ul></li><li><a href="#在打包环境下没有环境变量" class="table-of-contents__link toc-highlight">在打包环境下，没有环境变量</a></li><li><a href="#不考虑环境变量直接硬编码数据库文件地址" class="table-of-contents__link toc-highlight">不考虑环境变量，直接硬编码数据库文件地址</a></li><li><a href="#electron-builder-load-env" class="table-of-contents__link toc-highlight">electron-builder load <code>.env</code></a></li><li><a href="#打包环境下竟然读到了环境变量" class="table-of-contents__link toc-highlight">打包环境下，竟然读到了环境变量</a></li><li><a href="#重开项目进行分段测试" class="table-of-contents__link toc-highlight">重开项目进行分段测试！</a></li><li><a href="#摊牌了" class="table-of-contents__link toc-highlight">摊牌了</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>