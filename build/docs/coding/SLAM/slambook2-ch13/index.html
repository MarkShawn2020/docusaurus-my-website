<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-coding/SLAM/slambook2-ch13">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">slambook2-ch13 | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/docs/coding/SLAM/slambook2-ch13"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="slambook2-ch13 | 南川笔记"><meta data-rh="true" name="description" content="准备"><meta data-rh="true" property="og:description" content="准备"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/docs/coding/SLAM/slambook2-ch13"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/docs/coding/SLAM/slambook2-ch13" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/docs/coding/SLAM/slambook2-ch13" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="docsWrapper_lLmf"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_PuQw" type="button"></button><div class="docRoot_kBZ6"><aside class="theme-doc-sidebar-container docSidebarContainer_S51O"><div class="sidebar_vtcw"><nav class="menu thin-scrollbar menu_rWGR"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/coding/SLAM/A01-recognizeLights">coding</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/coding/SLAM/A01-recognizeLights">SLAM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/SLAM/A01-recognizeLights">A01: recognize lights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/SLAM/opencv-object-detection">learning opencv object detection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/SLAM/slam-research">slam-research</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/coding/SLAM/slambook2-ch13">slambook2-ch13</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/SLAM/slambook2-learning">slambook2-learning</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/DevOps/certbot ssl 证书">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Languages/CPP/cpp-howto">Languages</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Mac存储清理">Mac存储清理</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/OS/Linux/centos-init-manual">OS</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/Poketto Dev Notes">Poketto Dev Notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/Software/Adobe/PS/support-for-little-stars/">Software</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/apple">apple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/clash">clash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/coding-philosophy">coding philosophy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/composite/full-guide_cross-copy-over-ssh-vim-tmux">composite</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/css">css</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/electron">electron</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/coding/hardware/rockchip/rockchip4-flash-manual">hardware</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/init-server">init-server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/moments">moments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/mongodb">mongodb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/next-i18next">next-i18next</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/next-themes">next-themes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/nextjs-best-practice">nextjs-best-practice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/nextjs">nextjs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/poetry">poetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/python">install python 3.11</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/vim">vim</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/websocket">websocket</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/图形化语言">图形化语言</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/微信迁移">微信迁移</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/极客排版微信公众号最佳实践">极客排版微信公众号最佳实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/毁灭人生的打包记">毁灭人生的打包记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/coding/测试不同风格的toc">测试不同风格的toc</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/文集/2020-06-12-王逸成">education</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/series/NC-PFA/">series</a></div></li></ul></nav></div></aside><main class="docMainContainer_EfwR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_n6xZ"><div class="docItemContainer_RhpI"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Wvrh" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_VLFi"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">coding</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">SLAM</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">slambook2-ch13</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.17.0+</span><div class="tocCollapsible_BEWm theme-doc-toc-mobile tocMobile_NSfz"><button type="button" class="clean-btn tocCollapsibleButton_IbtT">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>slambook2-ch13</h1></header><h2 class="anchor anchorWithStickyNavbar_rB0w" id="准备">准备<a class="hash-link" href="#准备" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决编译问题">解决编译问题<a class="hash-link" href="#解决编译问题" title="标题的直接链接">​</a></h3><p>加载第十三章的 cmake 文件时，第一个问题是关于<code>glog</code>的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655276254303-f02d03399bb4a8bdfb2dfded9ed94ad0affabe10a3a5dc9e3665c0908fc337ce.png" alt="picture 1" class="img_vXGZ"></p><p>章节里也没提这个，我也不确定在之前的章节里是否有说这个，可能是一个基本工程包，所以我打算手动装一下。</p><p>搜索了一下，根据 <a href="https://blog.csdn.net/CAIYUNFREEDOM/article/details/104903050" target="_blank" rel="noopener noreferrer">(5 条消息) Failed to find glog<!-- -->_<!-- -->彩云的笔记的博客-CSDN 博客</a> 指示，只需要 <code>sudo apt-get install libgoogle-glog-dev</code> 即可。</p><p>接着重新加载 cmake，问题变成了<code>Could NOT find GTest</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655276503103-b9436bf88b737635ab66b29bbd3aa112d1389f690b5e2a5870a19016509c89c1.png" alt="picture 2" class="img_vXGZ"></p><p>根据 - <a href="https://blog.csdn.net/Numberors/article/details/109765131" target="_blank" rel="noopener noreferrer">(5 条消息) 记录 Could NOT find GTest (missing: GTEST_LIBRARY GTEST_MAIN_LIBRARY) 解决方法<!-- -->_<!-- -->Numberors 的博客-CSDN 博客</a> 直接<code>sudo apt-get install libgtest-dev</code> 即可。</p><p>接着重新加载 cmake，问题变成了<code>The package name passed to `find_package_handle_standard_args` (CSPARSE) does not match the name of the calling package (CSparse)</code></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655276645869-7f4f09a469146f5179f9fe3de3b05696cceb77f1c6f34858ec70c059c335d556.png" alt="picture 3" class="img_vXGZ"></p><p>按照 - <a href="https://www.codeleading.com/article/68336255783/" target="_blank" rel="noopener noreferrer">【解决问题】【SLAM 十四讲第 7 讲】【关于自己创建工程，遇到的 CSparse 警告的解决方案】 - 代码先锋网</a> 把<code>CSPARSE</code>改成<code>CSParse</code>即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655277058527-721c82fd756bb5dee21986d169ef526c6a74b757caa51e191e73041f64f8b71f.png" alt="picture 4" class="img_vXGZ"></p><p>最终，编译成功：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655277098164-c8c936ae5784221665a088de76ffe05ffa70f51a5a44b963c9b1d84d510e2336.png" alt="picture 5" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="kiti-数据集准备">kiti 数据集准备<a class="hash-link" href="#kiti-数据集准备" title="标题的直接链接">​</a></h3><p>在之前，我们已经通过迅雷下载完了数据集到 mac 主机上。</p><p>接着分别尝试了 smb 和 hgfs 两种方案传输到 ubuntu 虚拟机，smb 受限于带宽只有 20+兆的速度，而 hgfs 逐渐达到了 360+兆。</p><p>然后解压，数据集准备完成，并在<code>config/default.yaml</code>中指定数据集位置：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655282023167-a56e6b39485fc7cd7cdd416b32f51e1f200c0a29835aa1027c794d152ba4e074.png" alt="picture 16" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="运行run_kitti_stereo">运行<code>run_kitti_stereo</code><a class="hash-link" href="#运行run_kitti_stereo" title="标题的直接链接">​</a></h3><p>首先遇到的是配置文件不存在的问题，根据经验，应该是 clion 中的 cmake 目录没有配置好：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655281984418-fb0d0ed40222e250744ca263111e3c65affe4247cd1acf76ae71a3ebf98d2ea2.png" alt="picture 15" class="img_vXGZ"></p><p>果然，这里之前写的<code>ch5</code>，修改成 13 再试试看：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655282104798-f3cd3c861293009c8c795216ad704fda3e7d99f126d3077c0be474088d390847.png" alt="picture 17" class="img_vXGZ"></p><p>刺激刺激！运行成功了！好酷炫！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655282176641-8265a3675a79456c0fcf129bd1121201505887ff0e48c741e377f8f7bec501f4.png" alt="picture 18" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="理解">理解<a class="hash-link" href="#理解" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="run_kitti_stereocpp-中-define_string-和-googleparsecommandlineflags-的用意"><code>run_kitti_stereo.cpp</code> 中 <code>DEFINE_string</code> 和 <code>google::ParseCommandLineFlags</code> 的用意<a class="hash-link" href="#run_kitti_stereocpp-中-define_string-和-googleparsecommandlineflags-的用意" title="标题的直接链接">​</a></h3><p>目前分析来看，DEFINE_String 的主要用途相当于是定义变量+注释。</p><p>比如我们直接把那些都去掉，直接传入一个 <code>std::basic_sring&lt;char&gt; &amp;</code> 变量到 <code>myslam::VisualOdometry</code> 函数中，程序也能正常运行。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655445417929-3c52ceff4c2ce671c853da2f48a39b2f82686a37d7174b7383b1ac36548ec40c.png" alt="picture 2" class="img_vXGZ"></p><p>以下是它们两的源代码，附有详细的说明：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655445590325-3a84302c47a706ff12cd70775f5f0796a5774a716014f005c97ae5d48ab834a0.png" alt="picture 3" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655445630109-c26faa36ad1dbd630eb58a82fa365663b6b4e3208becad89765574a6edb45c18.png" alt="picture 4" class="img_vXGZ"></p><p>这种写法应该说，比较高级，属于工程级别经验了，比较适合变量很多，尤其是输入参数很多的时候，涉及到系统管理的场景。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="读取配置文件的过程">读取配置文件的过程<a class="hash-link" href="#读取配置文件的过程" title="标题的直接链接">​</a></h3><p>在 <code>myslam::VisualOdometry</code> 的初始化中，将使用 <code>Config::SetParameterFile</code> 去解析文件。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446032484-32a253f5d900705f53f641e7270bcdd9d652e2822737f461a43000bcc2e68ece.png" alt="picture 5" class="img_vXGZ"></p><p>而这个函数其实是调用了 <code>cv::FileStorage</code> 函数：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446097105-e97b238299db35dfd1afbbc2d2f8f00db7bad0cab366a7cdf6ea7f650050c12a.png" alt="picture 6" class="img_vXGZ"></p><p>在 <code>cv</code> 的注释中可以看到，它可以读取与解析 <code>xml</code> 或者 <code>yml</code> 格式的文件。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446160051-3cda1fb62f7169607b503c333fbce304a1405da3a6e7d888000da9c06e1d6f13.png" alt="picture 7" class="img_vXGZ"></p><p>我们的配置文件是一个 <code>yml</code>，里面第一个键就是 <code>dataset_dir</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446210973-31ea360484a1e82db2819b4a49cec4b18bc5bb2e4dbfddb5b171857aafb75f9d.png" alt="picture 8" class="img_vXGZ"></p><p>然后就是调用 <code>Dataset</code> 构造数据集： <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446261214-ab2d24bcd198616f9f756c801f2dc8e66ae9a185a3d7273321c4b25fda015bfb.png" alt="picture 9" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="数据集初始化过程">数据集初始化过程<a class="hash-link" href="#数据集初始化过程" title="标题的直接链接">​</a></h3><p>Dataset 初始化的过程中，第一步就是读取数据集里的 <code>calib</code>文件：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446411320-0049597e647d35c022f14d34baa84c86c74742e04cd477d58f6a99f6df2647fc.png" alt="picture 10" class="img_vXGZ"></p><p>检查我们磁盘上的数据集，确实有这个文件，里面存储着 <code>P0 | P1 | P2 | P3</code> 四个十二维浮点数组。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446535438-42e8e29281bc2032f10b87b44c72b0a08a64fc74653e5d38cbffc0d04cd63f74.png" alt="picture 12" class="img_vXGZ"></p><p>从代码来看，<code>P_i</code> 是相机的命名，而十二个数可分成两部分，<del>前 9 个组成一个 3X3 的矩阵（相机的内参数（Camera Intrinsics）矩阵 K，书 p99），后 3 个是一个向量（平移向量）（p45）</del>，即当它表示成 3X4 的矩阵时左边 3X3 的矩阵为相机的内参数矩阵，右边的 3X1 的矩阵为平移向量），因此内参数矩阵录入的数据分别是 0,1,2;4,5,6;8,9,10，而非 0-8。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655446782268-142b2901282dc8d8335cd205d93da8d3f4b19d70e4a2c2d2cd5cb8c366193914.png" alt="picture 13" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="相机的初始化">相机的初始化<a class="hash-link" href="#相机的初始化" title="标题的直接链接">​</a></h3><p>相机的初始化要用到六个参数：<code>fx | fy | cx | cy | baseline | pose</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655447420744-46e8c53a40c3a10e16e0f1cc7bbcd0aa242170ec2ab489a95423dc9d1bfe6860.png" alt="picture 14" class="img_vXGZ"></p><p>在上层的初始化过程中传入的分别是：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">fx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> K</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SE3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SO3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中 <code>fx | fy | cx | cy</code> 符合相机内参数矩阵 K 的定义（p99）：</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>K</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">K = \begin{pmatrix} f_x &amp; 0 &amp; c_x \\ 0 &amp; f_y &amp; c_y \\ 0 &amp; 0 &amp; 1 \end{pmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathnormal" style="margin-right:0.07153em">K</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em"><span style="top:-2.2500000000000004em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-3.2550000000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="overlay" style="height:0.3em;width:0.875em"><svg width="0.875em" height="0.3em" style="width:0.875em" viewBox="0 0 875 300" preserveAspectRatio="xMinYMin"><path d="M291 0 H417 V300 H291 z"></path></svg></span></span><span style="top:-4.05002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.0099999999999993em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.8099999999999994em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.0099999999999993em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span><span style="top:-1.8099999999999994em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em"></span><span class="arraycolsep" style="width:0.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em"><span style="top:-4.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.0099999999999993em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span><span style="top:-1.8099999999999994em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.5500000000000007em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em"><span style="top:-2.2500000000000004em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-3.2550000000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="overlay" style="height:0.3em;width:0.875em"><svg width="0.875em" height="0.3em" style="width:0.875em" viewBox="0 0 875 300" preserveAspectRatio="xMinYMin"><path d="M457 0 H583 V300 H457 z"></path></svg></span></span><span style="top:-4.05002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>并且我们可以检验一下，输入数据的第 1、4、8、9 项应为 0，第 10 项应为 1：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2_learning-1655450616981-06b93a0bca25ea5e5e1732b36c13d6ff6c6ccada43e223e649e525a9e65de53b.png" alt="picture 15" class="img_vXGZ"></p><p>此外，P0 的数据显示，其最后一列（也就是平移向量）其实是一个零矩阵。</p><p>!!! question 不过值得注意的是，从读取数据到初始化相机类时，K 有个乘以 0.5 的动作，也就是第十项实际输送时已经变成了 0.5。为啥？ 根据<a href="https://github.com/hjr553199215/slambook2-ch13-VO-comment" target="_blank" rel="noopener noreferrer">hjr553199215/slambook2-ch13-VO-comment: 视觉 SLAM 十四讲 ch13 中 VO 的详细注释版本，基本覆盖所有理解难点，尤其对入门学者十分友好！！</a>里的注释，是由于读取图片时做了缩放，导致<strong>投影获得的像素坐标变为了原来的一半</strong>所以才乘了一个系数 0.5： <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655612044973-24d637a983d34a5c6412fcf4f5c02a830e08bc35a0a74359478d22f9028475df.png" alt="picture 1" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655612151448-dc75fd7d429b4a4292cbbd320b2cf243a87898eeb40e7d8111f4eede970945f0.png" alt="picture 2" class="img_vXGZ"><br>
<!-- -->了解原理后，其实这里比较合适的写法是用一个常数，保证同步，不然不知所云。</p><p>!!! question 另外书中对基线的定义是两个相机（双目）之间的水平距离（p104），按道理这个应该也是已知的，因此也不知道第 37 行为啥要通过复杂的运算去算出来？ 事实上，这个 <code>projction_data</code> 的结构如下<sup id="fnref-calib-file"><a href="#fn-calib-file" class="footnote-ref">calib-file</a></sup>： $<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can&#x27;t use function &#x27;$&#x27; in math mode at position 199: …ay}  \right )  $̲" style="color:#cc0000"> K =   \left (  \begin{array}{c:c}  \begin{matrix}  f_u &amp; 0 &amp; c_x \\  0 &amp; f_v &amp; c_`y \\  0 &amp; 0 &amp; 1   \end{matrix} &amp;  \begin{matrix}  -f_ub_x \\  -f_vb_y \\  0   \end{matrix}  \end{array}  \right )  $</span></span> 因此，使用 <code>t = K.inverse() * t</code> 的办法可以还原出 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>x</mi></msub><mo separator="true">,</mo><msub><mi>b</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">b_x, b_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span></span></span></span></span>，从而得到 $<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can&#x27;t use function &#x27;$&#x27; in math mode at position 51: …\end{pmatrix}  $̲" style="color:#cc0000"> t = \begin{pmatrix}b_x \\ b_y \\ 0\end{pmatrix}  $</span></span> ，最终<code>baseline = t.norm()</code>即 $<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Can&#x27;t use function &#x27;$&#x27; in math mode at position 28: …_x^2 + b_y^2}  $̲" style="color:#cc0000"> t = \sqrt{b_x^2 + b_y^2}  $</span></span> ，由于我们的<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>y</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b_y = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">0</span></span></span></span></span>，因此 <code>t = b_x</code>即我们的<code>baseline（0.065m）</code>。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; 【猜测】这应该不是高翔的锅，是kitti的一种设计，至少这样能存储更多的信息，也许还包括了点位姿，毕竟baseline总是能解算出来的，而且能够存入矩阵内，比单独的用yaml文件去配要高级！</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接着就是把第 0 个相机（左眼）和第 1 个相机（右眼）分别送进前端与后端：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655452160747-eb38cdeb866f8944d23d390374b7503b2a108f758d925bc8f1b67f5c275ef0c2.png" alt="picture 16" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655452193036-23ccc9cb8627f0a57a8a12fad4629dab594bd263226d4428bae30851f81981af.png" alt="picture 17" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655452213185-1a7b9b7edd99d3bbf5414367b3950341521cfd8449a19910b415766dbcfea5a1.png" alt="picture 18" class="img_vXGZ"></p><p>然后就开始跑图了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑图---数据集遍历">跑图 - 数据集遍历<a class="hash-link" href="#跑图---数据集遍历" title="标题的直接链接">​</a></h3><p>跑图就是一个单步循环：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655453988457-9fc277a154a020c977f268484bcb3b7922f3acbaa5943aeaf47a1e599bdba61c.png" alt="picture 20" class="img_vXGZ"></p><p>其中最重要的两个逻辑是<code>dataset_-&gt;NextFrame</code>获取下一帧与<code>frontend_-&gt;AddFrame</code>将新帧加入前端。</p><p>其中 <code>dataset_-&gt;NextFrame</code> 倒是不难理解（相对于机器学习复杂的矩阵处理来说实在太简单了），就是按照路径把数据集内的图片分别放缩 0.5 倍（这部分后续其实可以变量化）然后加载到左右眼中：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655454910438-198f2cd340c76fa6771381bb0113a800c0e15ca6788ebe2fbdd266b9e00ffcba.png" alt="picture 21" class="img_vXGZ"></p><p>其中文件路径需要符合特定的格式：<code>%s/image_%d/%06d.png</code>，也就是左眼都存放在<code>image_0</code>文件夹下，右眼都存放在<code>image_1</code>文件下，然后每张图片命名为从零（<code>Dataset::current_image_index_</code>）开始的六位左补零整数，格式为 png：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655455052254-86b6acb5154d093bdebacd7371e70b77f3ccc3a964ecde02caf0cab057ad0e84.png" alt="picture 22" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑图---前端帧处理">跑图 - 前端帧处理<a class="hash-link" href="#跑图---前端帧处理" title="标题的直接链接">​</a></h3><p>前端帧处理部分相对比较多，它根据 <code>Frontend</code> 当前的状态决定下一帧的帧处理动作，核心应该是 <code>track</code> 函数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655455330083-7bf9be49b2bf21762ed7b679bc94d839fcd5173b6d43e64f333ab50e313059c8.png" alt="picture 23" class="img_vXGZ"></p><p>先来看看 <code>StereoInit</code> 的逻辑。</p><p>这里面最主要的逻辑其实就是开头的两句，先在左图中寻找特征点的数量，再在右图中使用 LK 光流法去估计点数。这里值得注意的是尽管 IDE 提示 <code>num_features_left</code> 这个变量没有用到，但是它对应的函数 <code>DetectFeatures()</code> 的执行却是必要的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655455983618-343ed50afe8a1c9c4ee7f2e44a09891fc694577d86c41dd935b8eb39786ea5c8.png" alt="picture 25" class="img_vXGZ"></p><p>在 <code>DetectFeatures</code> 中对 <code>current_frame_.features_left_</code> 遍历时，由于 <code>features_left_</code> 本身是一个向量，因此不会报错，但一开始是空的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655457571757-201f4443adb27b6399f06e6a1780a6900a1d2492d8208da69f1561e2acb5cc59.png" alt="picture 27" class="img_vXGZ"></p><p><code>GFTT</code> 是 <code>GoodFeaturesToTrack</code> 的意思：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655457659594-4a2539fb2b91c11a23bfde194c392a17ab113e92be53592876d3c0ecfa823a21.png" alt="picture 28" class="img_vXGZ"></p><p>它调用 <code>detect</code> 函数寻找一张图片（或图片集）里的关键点：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655457757967-c6582c4741074069cce5c80905337bda36b2ea8f87651d8bacdf0c040038234a.png" alt="picture 29" class="img_vXGZ"></p><p>其中，里面的 <code>mask</code> 参数，我们可以直接通过传入图片的 <code>size()</code> 去构造，而不用关心其具体原理，猜测应该是圈定我们需要分析的区域的意思（不确定）。</p><p><code>KeyPoint</code> 数据结构主要是 x 和 y 点（尽管还可以包括很多其他信息）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655458058732-7794dfe78777786972976022b2cf99f50412ea569355de65af9aac02cc51ddda.png" alt="picture 30" class="img_vXGZ"></p><p>因此整个逻辑就是：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655458171992-ef5957ac70060ab45b389154a15c316243f38bb6a13d8e7ffbaa84efde2799ed.png" alt="picture 31" class="img_vXGZ"></p><p>代码整理后如下：</p><div class="language-cpp codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-cpp codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Created by mark on 6/20/22.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ref: [cv::GFTTDetector特征点检测_酸菜余的博客-CSDN博客](https://blog.csdn.net/weixin_43821376/article/details/100135901)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;cv.hpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * detect keypoints from an image</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param img</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">KeyPoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">detectKeyPoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mat </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">KeyPoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Ptr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">GFTTDetector</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> gftt_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token class-name">GFTTDetector</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gftt_</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">detect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * draw keypoints on the image, the effect depends on the match degree</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param img</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param detectedKeyPoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param title</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mat </span><span class="token function" style="color:#d73a49">drawImgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mat </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">KeyPoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> title</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mat imgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">drawKeypoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Scalar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">DrawMatchesFlags</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">DRAW_RICH_KEYPOINTS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">waitKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> imgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string imgPath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/mark/work@arpara/datasets/dataset-0610-kitti/dataset02_head-around/image_0/000000.png&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string imgName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imgPath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">substr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imgPath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">find_last_of</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/\\&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Mat img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imgPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CV_LOAD_IMAGE_GRAYSCALE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">cv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">KeyPoint</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> detectedKeyPoints </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">detectKeyPoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">drawImgWithKeyPoints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> detectedKeyPoints</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;draw img with keypoints&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="测试与实现">测试与实现<a class="hash-link" href="#测试与实现" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="发现-1ch13-的代码检测特征点的办法不符合我们的场景需求">发现 1：ch13 的代码检测特征点的办法不符合我们的场景需求<a class="hash-link" href="#发现-1ch13-的代码检测特征点的办法不符合我们的场景需求" title="标题的直接链接">​</a></h3><p>在 ch13 中检测左图特征点的代码位于 <code>Frontend::DetectFeatures</code> 中，而在这个函数内的操作主要分两步，第一步是把上一帧检测出的特征点给画在当前帧上，第二步就是继续检测本帧的特征点。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655717713886-79e4d28214a22fb202572419c87c0f6dba04ff771be888c4d52a02c1bcf026d5.png" alt="picture 1" class="img_vXGZ"></p><p>但我们在初期测试验证时，并不需要这么复杂，只需要在检测出当前帧的特征点后，然后绘制验证即可。</p><p>此外，函数中使用了一个 <code>mask</code> 变量用以限定检测特征点的区域，这对于我们来说似乎也没有必要加上。而且这个 mask 目前使用的是全图大小，然后为单色，相当于没有不限定的意思：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655718046468-ab5d7612acb861bdcc35d50f2358ee32747a44272a2dc8766f08190fa2f1dfcd.png" alt="picture 2" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655718123983-431ba1a889342766b7e7fdd2911b7683b99ebfdb1b75137d7749614429901ce7.png" alt="picture 3" class="img_vXGZ"></p><p>最后，影响最终检测效果的关键参数，是在 <code>cv::Ptr&lt;cv::GFTTDetector&gt; gftt_</code> 的初始化上：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655718208698-a436204fb320766480c377a5b8f7421305e831da3ef413bfc27297f0547402c8.png" alt="picture 4" class="img_vXGZ"></p><p>可以看到，目前 ch13 初始化<code>gftt_</code>的参数中，第一个参数是特征点的最大数目，由配置文件输入（150）；第二个参数是质量等级；第三个参数是最小距离。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655718324411-a16973a2f9fc1e4a68334887e44a6cb967f96f1a11dc2de8db679a9765c7b189.png" alt="picture 5" class="img_vXGZ"></p><p>重点在这个最小距离上，默认是 1（单位应该是像素），这样可以把我们手柄上的灯一圈给完整识别出来；而 ch13 中配的是 20，就会导致一圈灯只能检测到一两个特征点，这个是严重不符合我们的场景目标的，我们就应该尽可能多地检测出手柄上的灯相关的特征！</p><p>以下就是我们分别以 ch13 设置与默认设置对同一张手柄输出图的检测效果，可以看到一个点比较稀疏，一个点比较密集，有相当大的差异：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655718758240-f5d14428223aaa23b77576757928a87c3a5570a3e277bebcaac4525b8137136e.png" alt="picture 6" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="如何-debug">如何 debug<a class="hash-link" href="#如何-debug" title="标题的直接链接">​</a></h3><p>为了查看一些运行逻辑，我们需要 debug，但是在 clion 中光打断点然后 debug 是不行的，还要更改我们的编译类型：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/slambook2-ch13-1655457339388-5b2b6eeac60a7d2b7b0c7dbccf524e39f11df4977e2f8ceefcebea437a40ac55.png" alt="picture 26" class="img_vXGZ"></p><div class="footnotes"><hr><ol><li id="fn-calib-file"><a href="#fnref-calib-file" class="footnote-backref">calib-file</a><p>参考：</p><ol><li>★★★ 对 github-slambook2 的提问，也都是我想问的：<a href="https://github.com/gaoxiang12/slambook2/issues/213" target="_blank" rel="noopener noreferrer">请教 ch13(设计 SLAM 系统）中 src/dataset.cpp 中的代码含义 · Issue #213 · gaoxiang12/slambook2</a></li><li>★★ 给出了第一行的表达式：<a href="https://blog.csdn.net/yangziluomu/article/details/78339575" target="_blank" rel="noopener noreferrer">KITTI 数据集测试 - 3 calib 相机参数<!-- -->_<!-- -->旧人赋荒年的博客-CSDN 博客<!-- -->_<!-- -->kitti 相机参数</a></li><li>★★ 给出了第二行的表达式：<a href="https://stackoverflow.com/questions/53218743/kitti-dataset-camera-projection-matrix" target="_blank" rel="noopener noreferrer">computer vision - kitti dataset camera projection matrix - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/50210547/format-of-parameters-in-kittis-calibration-file" target="_blank" rel="noopener noreferrer">computer vision - Format of parameters in KITTI&#x27;s calibration file - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/29407474/how-to-understand-the-kitti-camera-calibration-files" target="_blank" rel="noopener noreferrer">computer vision - How to understand the KITTI camera calibration files? - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/58918538/how-kitti-calibration-matrix-was-calculated" target="_blank" rel="noopener noreferrer">image processing - How Kitti calibration matrix was calculated? - Stack Overflow</a></li><li><a href="https://github.com/hjr553199215/slambook2-ch13-VO-comment/issues/1" target="_blank" rel="noopener noreferrer">关于 dataset.cpp 中外参平移向量的问题 · Issue #1 · hjr553199215/slambook2-ch13-VO-comment</a></li></ol><p></p></li></ol></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/markshawn2020/docusaurus/edit/master/my-documents/docs/coding/SLAM/slambook2-ch13.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_IMw_" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_DtqZ"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2024-09-17T09:17:49.000Z">2024年9月17日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/coding/SLAM/slam-research"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">slam-research</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/coding/SLAM/slambook2-learning"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">slambook2-learning</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_RLlU thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#准备" class="table-of-contents__link toc-highlight">准备</a><ul><li><a href="#解决编译问题" class="table-of-contents__link toc-highlight">解决编译问题</a></li><li><a href="#kiti-数据集准备" class="table-of-contents__link toc-highlight">kiti 数据集准备</a></li><li><a href="#运行run_kitti_stereo" class="table-of-contents__link toc-highlight">运行<code>run_kitti_stereo</code></a></li></ul></li><li><a href="#理解" class="table-of-contents__link toc-highlight">理解</a><ul><li><a href="#run_kitti_stereocpp-中-define_string-和-googleparsecommandlineflags-的用意" class="table-of-contents__link toc-highlight"><code>run_kitti_stereo.cpp</code> 中 <code>DEFINE_string</code> 和 <code>google::ParseCommandLineFlags</code> 的用意</a></li><li><a href="#读取配置文件的过程" class="table-of-contents__link toc-highlight">读取配置文件的过程</a></li><li><a href="#数据集初始化过程" class="table-of-contents__link toc-highlight">数据集初始化过程</a></li><li><a href="#相机的初始化" class="table-of-contents__link toc-highlight">相机的初始化</a></li><li><a href="#跑图---数据集遍历" class="table-of-contents__link toc-highlight">跑图 - 数据集遍历</a></li><li><a href="#跑图---前端帧处理" class="table-of-contents__link toc-highlight">跑图 - 前端帧处理</a></li></ul></li><li><a href="#测试与实现" class="table-of-contents__link toc-highlight">测试与实现</a><ul><li><a href="#发现-1ch13-的代码检测特征点的办法不符合我们的场景需求" class="table-of-contents__link toc-highlight">发现 1：ch13 的代码检测特征点的办法不符合我们的场景需求</a></li></ul></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#如何-debug" class="table-of-contents__link toc-highlight">如何 debug</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>