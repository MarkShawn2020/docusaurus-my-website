"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[69400],{35318:(e,n,a)=>{a.d(n,{Zo:()=>d,kt:()=>u});var t=a(27378);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function s(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){i(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,i=function(e,n){if(null==e)return{};var a,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(i[a]=e[a]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=t.createContext({}),l=function(e){var n=t.useContext(p),a=n;return e&&(a="function"==typeof e?e(n):s(s({},n),e)),a},d=function(e){var n=l(e.components);return t.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=l(a),u=i,h=m["".concat(p,".").concat(u)]||m[u]||c[u]||r;return a?t.createElement(h,s(s({ref:n},d),{},{components:a})):t.createElement(h,s({ref:n},d))}));function u(e,n){var a=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=m;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var l=2;l<r;l++)s[l]=a[l];return t.createElement.apply(null,s)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},73012:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>k,contentTitle:()=>u,default:()=>f,frontMatter:()=>m,metadata:()=>h,toc:()=>b});var t=a(35318),i=Object.defineProperty,r=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(e,n,a)=>n in e?i(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,c=(e,n)=>{for(var a in n||(n={}))p.call(n,a)&&d(e,a,n[a]);if(o)for(var a of o(n))l.call(n,a)&&d(e,a,n[a]);return e};const m={},u="electron prisma sqlite 2",h={unversionedId:"coding/Languages/JS/Electron/electron-prisma-sqlite-2",id:"coding/Languages/JS/Electron/electron-prisma-sqlite-2",title:"electron prisma sqlite 2",description:"[toc]",source:"@site/my-documents/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2.md",sourceDirName:"coding/Languages/JS/Electron",slug:"/coding/Languages/JS/Electron/electron-prisma-sqlite-2",permalink:"/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2",draft:!1,editUrl:"https://github.com/markshawn2020/docusaurus/edit/master/my-documents/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2.md",tags:[],version:"current",lastUpdatedAt:1726564669,formattedLastUpdatedAt:"2024\u5e749\u670817\u65e5",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"electron howto",permalink:"/docs/coding/Languages/JS/Electron/electron-howto"},next:{title:"marknote-electron-prisma-sqlite",permalink:"/docs/coding/Languages/JS/Electron/marknote-electron-prisma-sqlite"}},k={},b=[{value:"PASS: test putting <code>prisma | @prisma/client</code> under release package.json",id:"pass-test-putting-prisma--prismaclient-under-release-packagejson",level:2},{value:"\u2705 cannot start when integrated with sqlite in packed version",id:"-cannot-start-when-integrated-with-sqlite-in-packed-version",level:2},{value:"step 1. add dependency in <code>APP/package.json</code>",id:"step-1-add-dependency-in-apppackagejson",level:3},{value:"step 2. rebuild project",id:"step-2-rebuild-project",level:3},{value:"step 3. build and pack again",id:"step-3-build-and-pack-again",level:3},{value:"step 4. PLUS: if we don&#39;t pack <code>sqlite3</code> into $APP, then we won&#39;t pass the webpack build process only if we add this",id:"step-4-plus-if-we-dont-pack-sqlite3-into-app-then-we-wont-pass-the-webpack-build-process-only-if-we-add-this",level:3},{value:"\u2705 can normally open if no database connection in source code",id:"-can-normally-open-if-no-database-connection-in-source-code",level:2},{value:"using pure <code>sqlite3</code> and the programme goes well under prod, then failed with a popup suggesting me to integrate sqlite3",id:"using-pure-sqlite3-and-the-programme-goes-well-under-prod-then-failed-with-a-popup-suggesting-me-to-integrate-sqlite3",level:2},{value:"integrate prisma like sqlite",id:"integrate-prisma-like-sqlite",level:2},{value:"I am quite sure now the problem is about package import with <code>prisma</code>",id:"i-am-quite-sure-now-the-problem-is-about-package-import-with-prisma",level:2},{value:"Yeah, thanks Mac&#39;s console, I saw the dawn \u2728\u2728:sparkles",id:"yeah-thanks-macs-console-i-saw-the-dawn-sparkles",level:2},{value:"Finally found the problem, it&#39;s about the block of searching path",id:"finally-found-the-problem-its-about-the-block-of-searching-path",level:2},{value:"I finally understand why programme start by <code>double click</code> would be so slow",id:"i-finally-understand-why-programme-start-by-double-click-would-be-so-slow",level:3},{value:"what&#39;s the <code>findSync</code>",id:"whats-the-findsync",level:3},{value:"Current Solution: avoid `findSync&#39;",id:"current-solution-avoid-findsync",level:2},{value:"make binary can use <code>prisma db push</code>",id:"make-binary-can-use-prisma-db-push",level:2},{value:"\u82e5\u5728<code>release/package.json</code>\u91cc\u6307\u5b9a\u4e86<code>@prisma/client</code>\uff0c\u5219\u6253\u5305\u91cc\u6ca1\u6709<code>.prisma/client/index.js</code>",id:"\u82e5\u5728releasepackagejson\u91cc\u6307\u5b9a\u4e86prismaclient\u5219\u6253\u5305\u91cc\u6ca1\u6709prismaclientindexjs",level:3},{value:"\u82e5\u672a\u6307\u5b9a\uff08\u53ea\u6307\u5b9a\u4e00\u4e2a<code>sqlite3</code>\uff09\uff0c\u5219\u6709",id:"\u82e5\u672a\u6307\u5b9a\u53ea\u6307\u5b9a\u4e00\u4e2asqlite3\u5219\u6709",level:3},{value:"\u82e5\u76f4\u63a5\u6307\u5b9a\u4e24\u4e2a\uff082022-01-06 02:15:12\uff09\uff0c\u5219\u50cf\u4e00\u4e2a\u4e00\u6837\u8fd8\u662f\u62a5\u9519\u4e86\uff0c\u4f46\u662f\u6211\u8054\u60f3\u5230\u4e86<code>rebuild</code>",id:"\u82e5\u76f4\u63a5\u6307\u5b9a\u4e24\u4e2a2022-01-06-021512\u5219\u50cf\u4e00\u4e2a\u4e00\u6837\u8fd8\u662f\u62a5\u9519\u4e86\u4f46\u662f\u6211\u8054\u60f3\u5230\u4e86rebuild",level:3},{value:"<code>rebuild</code> \u786e\u5b9e\u662f\u4e00\u5927\u89e3\u836f\uff0c<code>rebuild</code>\u5b8c\u4e4b\u540e\u8fd8\u8981\u628a<code>prisma</code>\u79fb\u5230\u5bf9\u5e94\u7684<code>node_modules</code>\u76ee\u5f55\u65c1\uff0c\u8fd0\u884c\u4e00\u904d<code>prisma generate</code>\uff0c\u76ee\u524d\u6211\u4e00\u5957\u6d41\u7a0b\u8d70\u4e0b\u6765\uff0c\u5c06<code>prisma</code>\u4e00\u6b65\u6b65\u540c\u6b65\uff0c\u6548\u679c\u8fd8\u884c\uff1b\u53ea\u4e0d\u8fc7\u6700\u540e\u4e00\u6b65\u8fd8\u662f\u6709\u95ee\u9898\uff0c\u611f\u89c9\u53cc\u51fb\u7a0b\u5e8f\u542f\u52a8\u627e\u4e0d\u5230\u8def\u5f84\u7684\u95ee\u9898\u8fd8\u662f\u5b58\u5728\u3002\u65e2\u7136\u8fd9\u6837\uff0c\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u4f3c\u4e4e\u4e5f\u6ca1\u5565\u6027\u4ef7\u6bd4\u4e86",id:"rebuild-\u786e\u5b9e\u662f\u4e00\u5927\u89e3\u836frebuild\u5b8c\u4e4b\u540e\u8fd8\u8981\u628aprisma\u79fb\u5230\u5bf9\u5e94\u7684node_modules\u76ee\u5f55\u65c1\u8fd0\u884c\u4e00\u904dprisma-generate\u76ee\u524d\u6211\u4e00\u5957\u6d41\u7a0b\u8d70\u4e0b\u6765\u5c06prisma\u4e00\u6b65\u6b65\u540c\u6b65\u6548\u679c\u8fd8\u884c\u53ea\u4e0d\u8fc7\u6700\u540e\u4e00\u6b65\u8fd8\u662f\u6709\u95ee\u9898\u611f\u89c9\u53cc\u51fb\u7a0b\u5e8f\u542f\u52a8\u627e\u4e0d\u5230\u8def\u5f84\u7684\u95ee\u9898\u8fd8\u662f\u5b58\u5728\u65e2\u7136\u8fd9\u6837\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u4f3c\u4e4e\u4e5f\u6ca1\u5565\u6027\u4ef7\u6bd4\u4e86",level:3},{value:"\u518d\u6d4b\u8bd5\u4e00\u4e0b\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u662f\u5426\u53ef\u4ee5\u88c5 windows\uff0c\u5982\u679c\u4e5f\u4e0d\u884c\uff0c\u6211\u5c31\u76f4\u63a5\u653e\u5f03 prisma \u4e86",id:"\u518d\u6d4b\u8bd5\u4e00\u4e0b\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u662f\u5426\u53ef\u4ee5\u88c5-windows\u5982\u679c\u4e5f\u4e0d\u884c\u6211\u5c31\u76f4\u63a5\u653e\u5f03-prisma-\u4e86",level:3},{value:"\u5728 binary \u91cc\u9700\u8981\u7528<code>npm i prisma</code>\u5b89\u88c5\u811a\u672c",id:"\u5728-binary-\u91cc\u9700\u8981\u7528npm-i-prisma\u5b89\u88c5\u811a\u672c",level:3},{value:"\u6307\u5b9a prisma \u6587\u4ef6",id:"\u6307\u5b9a-prisma-\u6587\u4ef6",level:3},{value:"<code>prisma/client</code>",id:"prismaclient",level:3},{value:"\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c<code>query-engine</code> \uff082022-01-06 02:07:34 update: obviously not the last\uff09",id:"\u6700\u540e\u4e00\u4e2a\u95ee\u9898query-engine-2022-01-06-020734-update-obviously-not-the-last",level:3},{value:"query-engine in Windows, another not positive problem",id:"query-engine-in-windows-another-not-positive-problem",level:2},{value:"\u6781\u5c0f\u81ea\u52a8\u5316\u7a0b\u5e8f\u642d\u5efa",id:"\u6781\u5c0f\u81ea\u52a8\u5316\u7a0b\u5e8f\u642d\u5efa",level:3},{value:"\u2611\ufe0f <code>prisma</code> in binary",id:"\ufe0f-prisma-in-binary",level:2},{value:"\u6700\u5927\u7684\u95ee\u9898\uff0c\u4e0d\u540c\u542f\u52a8\u65b9\u5f0f\uff0c\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c\u4e0d\u4e00\u6837\uff0cprisma \u5728\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u627e\u4e0d\u5230",id:"\u6700\u5927\u7684\u95ee\u9898\u4e0d\u540c\u542f\u52a8\u65b9\u5f0f\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c\u4e0d\u4e00\u6837prisma-\u5728\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u627e\u4e0d\u5230",level:2}],g={toc:b};function f(e){var n,a=e,{components:i}=a,d=((e,n)=>{var a={};for(var t in e)p.call(e,t)&&n.indexOf(t)<0&&(a[t]=e[t]);if(null!=e&&o)for(var t of o(e))n.indexOf(t)<0&&l.call(e,t)&&(a[t]=e[t]);return a})(a,["components"]);return(0,t.kt)("wrapper",(n=c(c({},g),d),r(n,s({components:i,mdxType:"MDXLayout"}))),(0,t.kt)("h1",c({},{id:"electron-prisma-sqlite-2"}),"electron prisma sqlite 2"),(0,t.kt)("p",null,"[toc]"),(0,t.kt)("h2",c({},{id:"pass-test-putting-prisma--prismaclient-under-release-packagejson"}),"PASS: test putting ",(0,t.kt)("inlineCode",{parentName:"h2"},"prisma | @prisma/client")," under release package.json"),(0,t.kt)("h2",c({},{id:"-cannot-start-when-integrated-with-sqlite-in-packed-version"}),"\u2705 cannot start when integrated with sqlite in packed version"),(0,t.kt)("p",null,"suppose:"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"APP=release/app\n")),(0,t.kt)("h3",c({},{id:"step-1-add-dependency-in-apppackagejson"}),"step 1. add dependency in ",(0,t.kt)("inlineCode",{parentName:"h3"},"APP/package.json")),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-json"}),'// release/app/package.json\n"dependencies": {\n    "sqlite3": "^5.0.2"\n},\n')),(0,t.kt)("h3",c({},{id:"step-2-rebuild-project"}),"step 2. rebuild project"),(0,t.kt)("p",null,":::warn maybe we should ",(0,t.kt)("inlineCode",{parentName:"p"},"node i -g node-gyp")," first :::"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"[npm run rebuild] electron-rebuild --parallel --types prod,dev,optional --module-dir $APP\n")),(0,t.kt)("h3",c({},{id:"step-3-build-and-pack-again"}),"step 3. build and pack again"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"npm run build\n[npm run app:dir] electron-builder --dir\n")),(0,t.kt)("p",null,"ref:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",c({parentName:"p"},{href:"https://juejin.cn/post/6844903661336788999"}),"\u5728 Electron \u4e2d\u4f7f\u7528 SQLite3 - \u6398\u91d1"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",c({parentName:"p"},{href:"https://github.com/electron-userland/electron-builder/issues/4852"}),"electron-builder electron (8.2.0) & sqlite3 (4.1.1) \xb7 Issue #4852 \xb7 electron-userland/electron-builder"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",c({parentName:"p"},{href:"https://github.com/electron/electron-rebuild/pull/327"}),"chore(deps): upgrade node-gyp to ^6.0.1 by malept \xb7 Pull Request #327 \xb7 electron/electron-rebuild"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},(0,t.kt)("a",c({parentName:"p"},{href:"https://stackoverflow.com/questions/50991453/electron-packager-with-sqlite3-and-webpack/51256562"}),"sqlite - electron-packager with sqlite3 and webpack - Stack Overflow")))),(0,t.kt)("h3",c({},{id:"step-4-plus-if-we-dont-pack-sqlite3-into-app-then-we-wont-pass-the-webpack-build-process-only-if-we-add-this"}),"step 4. PLUS: if we don't pack ",(0,t.kt)("inlineCode",{parentName:"h3"},"sqlite3")," into $APP, then we won't pass the webpack build process only if we add this"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),"// .erb/configs/webpack.config.base.ts\n  externals: [\n    ...Object.keys(externals || {}),\n\n      // for prisma build\n      // https://github.com/prisma/prisma/issues/6564#issuecomment-899013495\n    {\n      _http_common: '_http_common',\n    },\n\n    // for sqlite3 build\n    // https://stackoverflow.com/a/51256562/9422455\n    { sqlite3: 'commonjs sqlite3' },\n  ],\n\n")),(0,t.kt)("h2",c({},{id:"-can-normally-open-if-no-database-connection-in-source-code"}),"\u2705 can normally open if no database connection in source code"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-ts"}),"// src/main/db.ts\ninterface FakePrisma {\n  erp: {\n    create: any;\n    upsert: any;\n    findMany: any;\n  };\n}\n\nexport const prisma: FakePrisma = {\n  erp: {\n    create: () => {\n      console.log('fake-database: creating one');\n    },\n    findMany: () => {\n      console.log('fake-database: finding many');\n    },\n    upsert: () => {\n      console.log('fake-database: upserting one');\n    },\n  },\n};\n")),(0,t.kt)("h2",c({},{id:"using-pure-sqlite3-and-the-programme-goes-well-under-prod-then-failed-with-a-popup-suggesting-me-to-integrate-sqlite3"}),"using pure ",(0,t.kt)("inlineCode",{parentName:"h2"},"sqlite3")," and the programme goes well under prod, then failed with a popup suggesting me to integrate sqlite3"),(0,t.kt)("img",{alt:"picture 11",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png",width:"480"}),(0,t.kt)("h2",c({},{id:"integrate-prisma-like-sqlite"}),"integrate prisma like sqlite"),(0,t.kt)("p",null,"When add the ",(0,t.kt)("inlineCode",{parentName:"p"},'"@prisma/client": "^3.7.0"')," into ",(0,t.kt)("inlineCode",{parentName:"p"},"APP/package.json"),": ",(0,t.kt)("img",{alt:"picture 12",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641290264413-57cae0d3b39ee3b8783d83a56ea24476ccbfdddc76b12d2c345f9cced752415c.png",width:"480"})),(0,t.kt)("p",null,"So we then try to add ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma")," into it."),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-json"}),'  "dependencies": {\n    "@prisma/client": "^3.7.0",\n    "sqlite3": "^5.0.2"\n  },\n  "devDependencies": {\n    "prisma": "^3.7.0",\n    "@prisma/client": "^3.7.0"\n  }\n\n')),(0,t.kt)("img",{alt:"picture 13",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641293795481-b2c1a6b69d6a1b726668058367a514807d2dfdb0800bd355d419b48db85fe557.png",width:"480"}),(0,t.kt)("img",{alt:"picture 14",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641294082849-a16d9878554cebc58aed0ac7ce8b87b32f5ba62f4fe957a7e30b6b13162185c3.png",width:"480"}),(0,t.kt)("img",{alt:"picture 15",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641294185753-c1bf2a6bf3db20c554daeee3b02332667ff24f6542f7da8f85dfb166794e9f5b.png",width:"480"}),(0,t.kt)("p",null,"After I moved the ",(0,t.kt)("inlineCode",{parentName:"p"},"libxxxxnode")," into ",(0,t.kt)("inlineCode",{parentName:"p"},"main"),", then things are ok, except still too slow!"),(0,t.kt)("img",{alt:"picture 16",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641294596528-f65b42bf2bc804b70c7c3f6254eff77d607048906fb64c3ca34f7d81aab9c3b8.png",width:"480"}),(0,t.kt)("p",null,"I try to debug as ",(0,t.kt)("a",c({parentName:"p"},{href:"https://github.com/prisma/prisma/issues/8484"}),"Other packages make Prisma load very slow \xb7 Issue #8484 \xb7 prisma/prisma")," did:"),(0,t.kt)("img",{alt:"picture 17",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641295180935-1184a4b6fedb71a7de0cc9ef7d529bbeccd822dd3dd370014c3e449ca8965223.png",width:"480"}),(0,t.kt)("p",null,"I found this app used my local packages, which maybe the issue behind the load problem."),(0,t.kt)("p",null,"So I uninstalled the global prisma:"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"npm uninstall -g prisma\n")),(0,t.kt)("p",null,"Then I run again."),(0,t.kt)("img",{alt:"picture 18",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641295340433-9db9c014cb84a5ee31e8600175343fbaa8465c99c2808a66ef5079202f695a6d.png",width:"480"}),(0,t.kt)("p",null,"However, it starts to use the packages in my dev project."),(0,t.kt)("p",null,"Finally I do a copy before I run for test:"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"# $erb\n# copy\ncp prisma/schema.prisma $app/Contents/Resources/app/dist/main/\ncp node_modules/.prisma/client/libquery_engine-darwin.dylib.node $app/Contents/Resources/app/dist/main\n\n# run\nopen release/build/mac/\u7687\u5bb6\u5c0f\u864e\u5feb\u9012\u5206\u6790\u7cfb\u7edf.app/Contents/MacOS/\u7687\u5bb6\u5c0f\u864e\u5feb\u9012\u5206\u6790\u7cfb\u7edf\n")),(0,t.kt)("p",null,"\u2728 maybe it's because prisma is searching file location, so that the system runs slow! (since finally it didn't search any ",(0,t.kt)("inlineCode",{parentName:"p"},"schema.prisma"),", which enlightened me!)"),(0,t.kt)("h2",c({},{id:"i-am-quite-sure-now-the-problem-is-about-package-import-with-prisma"}),"I am quite sure now the problem is about package import with ",(0,t.kt)("inlineCode",{parentName:"h2"},"prisma")),(0,t.kt)("p",null,"I added one log just at the entrance of the whole programme."),(0,t.kt)("img",{alt:"picture 20",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641300763719-36feb313c6ae07962b53e5140d909ed3b462de2a8e425f3eefa789746adfe833.png",width:"480"}),(0,t.kt)("p",null,"And I am lucky to see it is printed after programme runs in binary, and then wait, which indicates the start of programme is ok, except the packages."),(0,t.kt)("img",{alt:"picture 19",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641300743690-a321e7f6c6325a6210c8c694936e99cb18c76ddba1748061953908cc1d7e2e5f.png",width:"480"}),(0,t.kt)("h2",c({},{id:"yeah-thanks-macs-console-i-saw-the-dawn-sparkles"}),"Yeah, thanks Mac's console, I saw the dawn \u2728\u2728:sparkles"),(0,t.kt)("p",null,"Stupid!"),(0,t.kt)("p",null,"I found nothing helpful!"),(0,t.kt)("p",null,"(Since the programme didn't cause any system exception, except block)"),(0,t.kt)("h2",c({},{id:"finally-found-the-problem-its-about-the-block-of-searching-path"}),"Finally found the problem, it's about the block of searching path"),(0,t.kt)("p",null,"Just add these two lines for debug the ",(0,t.kt)("inlineCode",{parentName:"p"},"findSync")," sentence. ",(0,t.kt)("img",{alt:"picture 24",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641309385635-2c7f27383d90ee8aac8e0e32db1af1556f44c6ce1375e3b8a5e43d220a263a04.png",width:"480"})),(0,t.kt)("p",null,"Then you would know where does it go wrong. ",(0,t.kt)("img",{alt:"picture 23",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641309113293-e1bedee09b6842acbf3a2b9df051fca3e7612735e584bf70113035b2301a64c7.png",width:"480"})),(0,t.kt)("p",null,"I located to the source code. ",(0,t.kt)("img",{alt:"picture 25",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641309815216-65fbe7024490017e84223d0a82247e52ddd400994c9a61491476e6abd8b6cbb4.png",width:"480"})),(0,t.kt)("p",null,"It seems the path generated incorrectly."),(0,t.kt)("p",null,"Since this directory is generated via cli, I re-generate it, which looks more normal then."),(0,t.kt)("img",{alt:"picture 26",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641309960859-813a4586ebe04ff12d61d4632641f4ee7bfb18a3c2d5171b9c70d26a1db081b1.png",width:"480"}),(0,t.kt)("p",null,"And then we pack again."),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"npm run build\nnpm run app:dir\n")),(0,t.kt)("p",null,"Look into what's new in the ",(0,t.kt)("inlineCode",{parentName:"p"},"APP/../main.js")," ",(0,t.kt)("img",{alt:"picture 27",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641310502054-05ca31db8f32b47a028d463efeb660dbcb3a04f7f5107e48bd230be78afd0dfd.png",width:"480"})),(0,t.kt)("p",null,"OK, it's consistent with the source code after we ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma generate"),"."),(0,t.kt)("p",null,"However, there's no ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules")," neither ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma")," under ",(0,t.kt)("inlineCode",{parentName:"p"},"main.js")," directory now:"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"\u279c  main git:(main) \u2717 ls\nmain.js             main.js.LICENSE.txt preload.js\n")),(0,t.kt)("p",null,"It's because we didn't pack it into ",(0,t.kt)("inlineCode",{parentName:"p"},"app.asar")," in electron."),(0,t.kt)("p",null,"So how to achieve this goal?"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"we cannot use ",(0,t.kt)("inlineCode",{parentName:"li"},"externalResources")," choice since it only pack files into ",(0,t.kt)("inlineCode",{parentName:"li"},"Resources/")," not ",(0,t.kt)("inlineCode",{parentName:"li"},"app/main/")),(0,t.kt)("li",{parentName:"ol"},"if we use ",(0,t.kt)("inlineCode",{parentName:"li"},"files"),", then the files would list in ",(0,t.kt)("inlineCode",{parentName:"li"},"app.asar")," under ",(0,t.kt)("inlineCode",{parentName:"li"},"app")," directory, this is what we are looking for."),(0,t.kt)("li",{parentName:"ol"},"if we add the dependencies under ",(0,t.kt)("inlineCode",{parentName:"li"},"app/package.json"),", then there would be ",(0,t.kt)("inlineCode",{parentName:"li"},"node_modules")," installed under ",(0,t.kt)("inlineCode",{parentName:"li"},"app"),". It is also suitable if there would generate a ",(0,t.kt)("inlineCode",{parentName:"li"},".prisma/client"),", we can give it a shot only if we add ",(0,t.kt)("inlineCode",{parentName:"li"},"@prisma/client")," into ",(0,t.kt)("inlineCode",{parentName:"li"},"app/package.json"),".")),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-json"}),'// release/app/package.json\n  "dependencies": {\n    "sqlite3": "^5.0.2",\n    "@prisma/client": "^3.7.0"\n  }\n')),(0,t.kt)("p",null,"However, I tried but to find there is NO ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma")," folder in the target place."),(0,t.kt)("p",null,"And I tried locally to find that if I do not use ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma generate")," then I only got an blank template ",(0,t.kt)("inlineCode",{parentName:"p"},"index.js"),", which is certainly not I want."),(0,t.kt)("img",{alt:"picture 28",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641311767968-ad39fe926e5eb38bc8bda6d19f8950fd48937490b710e9b4e8b94d732254a453.png",width:"480"}),(0,t.kt)("p",null,"So, the answer is clear now: we can't put ",(0,t.kt)("inlineCode",{parentName:"p"},"@prisma/client")," into ",(0,t.kt)("inlineCode",{parentName:"p"},"app/package.json"),", since it won't generate the right sql model unless we use ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma generate"),". And even the ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma")," generated locally, it won't be packed into out target application's app.asar folder."),(0,t.kt)("p",null,"Therefore, the only way best suitable for us is to manually copy the local ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma")," folder to ",(0,t.kt)("inlineCode",{parentName:"p"},"app/dist/main/")," so that can be searched by ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," in the binary application."),(0,t.kt)("p",null,"We then use ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma generate")," to synchronize the ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.prisma/client/index.js")," with out ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/schema.prisma")," file (which would copied into ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.prisma/client/schema.prisma"),"), along with the generated query engine for MacOS: ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.prisma/client/libquery_engine-darwin.dylib.node"),".","[TODO: what should windows user do; maybe copy all the files into app is not ideal for cross platform use. Instead, we should consider about only copy the ",(0,t.kt)("inlineCode",{parentName:"p"},"schema.prisma")," file, and let all the other work generated by platforms]"),(0,t.kt)("img",{alt:"picture 29",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641312184877-79c3520e1b1f69e51de79ffcbf8e380d7312f4a46878b205bc0b17be2600658c.png",width:"480"}),(0,t.kt)("h3",c({},{id:"i-finally-understand-why-programme-start-by-double-click-would-be-so-slow"}),"I finally understand why programme start by ",(0,t.kt)("inlineCode",{parentName:"h3"},"double click")," would be so slow"),(0,t.kt)("p",null,"I added log before ",(0,t.kt)("inlineCode",{parentName:"p"},"findSync")," again, and run by double click of the main programme."),(0,t.kt)("img",{alt:"picture 32",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641313449263-88324bddd0fbb97399caee5b72123ffbbb24e3eab8fb8178a60df72e0561b001.png",width:"480"}),(0,t.kt)("p",null,"And it should tell me that the ",(0,t.kt)("inlineCode",{parentName:"p"},"process.cwd()")," is ",(0,t.kt)("inlineCode",{parentName:"p"},"/")," that means from my computer root!"),(0,t.kt)("img",{alt:"picture 30",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641313359005-aaed92dce777b54143a8dd9e8e0fef9324be40bf97bfc9505008f3ef53c391dd.png",width:"480"}),(0,t.kt)("p",null,"As a contrast, I ran it according the electron helper which is within the main programme."),(0,t.kt)("p",null,"And the ",(0,t.kt)("inlineCode",{parentName:"p"},"process.cwd()")," is ",(0,t.kt)("inlineCode",{parentName:"p"},"~"),", which is much much faster! ",(0,t.kt)("img",{alt:"picture 33",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641313624357-a725375b40e1c762592a7944d97f514f4166824854722db189f5686000b3c66b.png",width:"480"})),(0,t.kt)("h3",c({},{id:"whats-the-findsync"}),"what's the ",(0,t.kt)("inlineCode",{parentName:"h3"},"findSync")),(0,t.kt)("img",{alt:"picture 34",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641314504643-a85fb0c38c3b5f5d201cf17469b50cb23e82246ee94e8ae18d06eeeb2042a586.png",width:"480"}),(0,t.kt)("p",null,"So, according the source code, the ",(0,t.kt)("inlineCode",{parentName:"p"},"findSync")," starts from the ",(0,t.kt)("inlineCode",{parentName:"p"},"root"),", then to search target ",(0,t.kt)("inlineCode",{parentName:"p"},"pattern"),"."),(0,t.kt)("img",{alt:"picture 35",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641314655645-e8a564598b87018e4914e1d0e8b5b1cd3cbd624b4900715e3a4d791cc31bf751.png",width:"480"}),(0,t.kt)("p",null,"Thus, from the commands before, we can see, it would search target pattern ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.prisma/client")," or ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma/client")," from ",(0,t.kt)("inlineCode",{parentName:"p"},"process.cwd()")," (i.e. ",(0,t.kt)("inlineCode",{parentName:"p"},"/")," when run main programme and ",(0,t.kt)("inlineCode",{parentName:"p"},"~")," when run in shell)"),(0,t.kt)("p",null,"What's the solution?"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"directly change the logic into ",(0,t.kt)("inlineCode",{parentName:"p"},"_ = __dirname"),", and put ",(0,t.kt)("inlineCode",{parentName:"p"},".prisma/client")," under the ",(0,t.kt)("inlineCode",{parentName:"p"},"__dirname"),", i.e. ",(0,t.kt)("inlineCode",{parentName:"p"},"app/main"))),(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("p",{parentName:"li"},"perhaps there's way (i.e. package or not) to not go this logic, which is so-called best practice? But sadly, I haven't found one after many times of hard search in github of prisma. I am looking forward the developers of prisma can give one."),(0,t.kt)("ol",{parentName:"li"},(0,t.kt)("li",{parentName:"ol"},"For example, maybe there is a way allows me to fill some parameters so that to disable the hard search or change the root from?")))),(0,t.kt)("img",{alt:"picture 37",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641323620341-43c3b49ec507dca9a7bfc9907e7a70c40a78f4fafafe4f80f18d6394572e94cb.png",width:"480"}),(0,t.kt)("p",null,"ref:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",c({parentName:"li"},{href:"https://github.com/prisma/prisma/blob/62b91fd9bd32da983f457857411edef6daeecda1/packages/client/src/generation/utils/buildDirname.ts"}),"prisma/buildDirname.ts at 62b91fd9bd32da983f457857411edef6daeecda1 \xb7 prisma/prisma"))),(0,t.kt)("h2",c({},{id:"current-solution-avoid-findsync"}),"Current Solution: avoid `findSync'"),(0,t.kt)("p",null,"avoid any call of ",(0,t.kt)("inlineCode",{parentName:"p"},"findSync")),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),"// node_modules/.prisma/client/index.js\n\n// to save the hard search time(maybe from '/'), let us directly point out the target prisma client place\nconsole.log({process_cwd: process.cwd(), __dirname});\nconst dirname = path.join(__dirname, '.prisma/client');\nconsole.log({dirname});\n\n// const { findSync } = require('@prisma/client/runtime')\n//\n// const dirname = findSync(process.cwd(), [\n//     \"node_modules/.prisma/client\",\n//     \".prisma/client\",\n// ], ['d'], ['d'], 1)[0] || __dirname\n")),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-text"}),"// main files structure of an packed electron on Mac\n// with `.prisma/client` besides `main.js`\n// generate via ` find . ! -path '*node_modules/*' ! -path '*Frameworks/*' ! -path '*assets*' ! -path '*lproj'  ! -path '*svg'  | tree --fromfile --noreport -aC`\n\n. // Main Entrance\n\u2514\u2500\u2500 Contents\n    \u251c\u2500\u2500 Frameworks\n    \u251c\u2500\u2500 Info.plist\n    \u251c\u2500\u2500 MacOS\n    \u2502\xa0\xa0 \u2514\u2500\u2500 HJXH-DATA-ANALYSIS // Script Entrance\n    \u251c\u2500\u2500 PkgInfo\n    \u2514\u2500\u2500 Resources\n        \u251c\u2500\u2500 app\n        \u2502\xa0\xa0 \u251c\u2500\u2500 dist\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 main\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 .prisma\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 client\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 index-browser.js\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 index.js\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 libquery_engine-darwin.dylib.node\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 package.json\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 schema.prisma\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 main.js // Main Runner\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 main.js.LICENSE.txt\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 preload.js\n        \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 renderer\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 index.html\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 renderer.js\n        \u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 renderer.js.LICENSE.txt\n        \u2502\xa0\xa0 \u251c\u2500\u2500 node_modules\n        \u2502\xa0\xa0 \u2514\u2500\u2500 package.json\n        \u2514\u2500\u2500 icon.icns\n")),(0,t.kt)("h2",c({},{id:"make-binary-can-use-prisma-db-push"}),"make binary can use ",(0,t.kt)("inlineCode",{parentName:"h2"},"prisma db push")),(0,t.kt)("p",null,"The question is to intercept ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," into package use, am I right?(maybe not...)"),(0,t.kt)("p",null,"Anyway, we'd better have a try at the first: add ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," as a dependency of app."),(0,t.kt)("img",{alt:"picture 36",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641321785532-83ca4daa59910c730e2bad819c3150024b3ad2ed11442a0b13c32bac10b9803a.png",width:"480"}),(0,t.kt)("p",null,"Now, we have ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," in node_modules."),(0,t.kt)("p",null,"However, I doesn't be positive about running with ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," since it's only a dependency not a command."),(0,t.kt)("p",null,"There are at least two kinds of commands we can use, one for global, one for those under ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.bin"),"."),(0,t.kt)("p",null,"The sad truth is that only when we run ",(0,t.kt)("inlineCode",{parentName:"p"},"npm i prisma")," in packed app, we can have a ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," under ",(0,t.kt)("inlineCode",{parentName:"p"},"node_modules/.bin"),", which seems unacceptable. ","[TODO: so why they cannot generate a ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," under ",(0,t.kt)("inlineCode",{parentName:"p"},".bin")," when I have assigned ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," in ",(0,t.kt)("inlineCode",{parentName:"p"},"package.json")," of released app]"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"\u279c  app git:(main) \u2717 npm i prisma\n\nadded 2 packages, and changed 1 package in 2s\n\n3 packages are looking for funding\n  run `npm fund` for details\n\u279c  app git:(main) \u2717 ls node_modules/.bin\ndetect-libc  node-gyp     prisma       rimraf       sshpk-sign   which\nmkdirp       node-pre-gyp prisma2      semver       sshpk-verify\nneedle       nopt         rc           sshpk-conv   uuid\n")),(0,t.kt)("p",null,"So let's have a try step by step."),(0,t.kt)("p",null,"First, only add ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," in the ",(0,t.kt)("inlineCode",{parentName:"p"},"package.json")," of release."),(0,t.kt)("h3",c({},{id:"\u82e5\u5728releasepackagejson\u91cc\u6307\u5b9a\u4e86prismaclient\u5219\u6253\u5305\u91cc\u6ca1\u6709prismaclientindexjs"}),"\u82e5\u5728",(0,t.kt)("inlineCode",{parentName:"h3"},"release/package.json"),"\u91cc\u6307\u5b9a\u4e86",(0,t.kt)("inlineCode",{parentName:"h3"},"@prisma/client"),"\uff0c\u5219\u6253\u5305\u91cc\u6ca1\u6709",(0,t.kt)("inlineCode",{parentName:"h3"},".prisma/client/index.js")),(0,t.kt)("img",{alt:"picture 38",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641324945482-fa4db7120dea10e4574be593ce72e09deb916861a0dc70ed3013e7be5bb7c7cc.png",width:"480"}),(0,t.kt)("h3",c({},{id:"\u82e5\u672a\u6307\u5b9a\u53ea\u6307\u5b9a\u4e00\u4e2asqlite3\u5219\u6709"}),"\u82e5\u672a\u6307\u5b9a\uff08\u53ea\u6307\u5b9a\u4e00\u4e2a",(0,t.kt)("inlineCode",{parentName:"h3"},"sqlite3"),"\uff09\uff0c\u5219\u6709"),(0,t.kt)("img",{alt:"picture 39",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641325459183-9c244e08847be8d54907006fe7756d3434c355a2bc0c69ed1590dcb7cbe6b9ae.png",width:"480"}),(0,t.kt)("h3",c({},{id:"\u82e5\u76f4\u63a5\u6307\u5b9a\u4e24\u4e2a2022-01-06-021512\u5219\u50cf\u4e00\u4e2a\u4e00\u6837\u8fd8\u662f\u62a5\u9519\u4e86\u4f46\u662f\u6211\u8054\u60f3\u5230\u4e86rebuild"}),"\u82e5\u76f4\u63a5\u6307\u5b9a\u4e24\u4e2a\uff082022-01-06 02:15:12\uff09\uff0c\u5219\u50cf\u4e00\u4e2a\u4e00\u6837\u8fd8\u662f\u62a5\u9519\u4e86\uff0c\u4f46\u662f\u6211\u8054\u60f3\u5230\u4e86",(0,t.kt)("inlineCode",{parentName:"h3"},"rebuild")),(0,t.kt)("img",{alt:"picture 12",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-prisma-sqlite-2-1641406506923-9e06bf919325752ab1192f9da896232020a2cf200f4dfd43ee903abc7ade9cf6.png"}),(0,t.kt)("p",null,"So when I used ",(0,t.kt)("inlineCode",{parentName:"p"},"rebuild")," (in fact, it's ",(0,t.kt)("inlineCode",{parentName:"p"},"npm run post-install")," instead of ",(0,t.kt)("inlineCode",{parentName:"p"},"npm run rebuild"),"), everything is okay now! (although with a lot of errors...)"),(0,t.kt)("img",{alt:"picture 13",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-prisma-sqlite-2-1641406632784-f50b2d9e1a74dd4929dde5b75479ea8a3b459f694c34da06a97ae212df9474b2.png"}),(0,t.kt)("h3",c({},{id:"rebuild-\u786e\u5b9e\u662f\u4e00\u5927\u89e3\u836frebuild\u5b8c\u4e4b\u540e\u8fd8\u8981\u628aprisma\u79fb\u5230\u5bf9\u5e94\u7684node_modules\u76ee\u5f55\u65c1\u8fd0\u884c\u4e00\u904dprisma-generate\u76ee\u524d\u6211\u4e00\u5957\u6d41\u7a0b\u8d70\u4e0b\u6765\u5c06prisma\u4e00\u6b65\u6b65\u540c\u6b65\u6548\u679c\u8fd8\u884c\u53ea\u4e0d\u8fc7\u6700\u540e\u4e00\u6b65\u8fd8\u662f\u6709\u95ee\u9898\u611f\u89c9\u53cc\u51fb\u7a0b\u5e8f\u542f\u52a8\u627e\u4e0d\u5230\u8def\u5f84\u7684\u95ee\u9898\u8fd8\u662f\u5b58\u5728\u65e2\u7136\u8fd9\u6837\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u4f3c\u4e4e\u4e5f\u6ca1\u5565\u6027\u4ef7\u6bd4\u4e86"}),(0,t.kt)("inlineCode",{parentName:"h3"},"rebuild")," \u786e\u5b9e\u662f\u4e00\u5927\u89e3\u836f\uff0c",(0,t.kt)("inlineCode",{parentName:"h3"},"rebuild"),"\u5b8c\u4e4b\u540e\u8fd8\u8981\u628a",(0,t.kt)("inlineCode",{parentName:"h3"},"prisma"),"\u79fb\u5230\u5bf9\u5e94\u7684",(0,t.kt)("inlineCode",{parentName:"h3"},"node_modules"),"\u76ee\u5f55\u65c1\uff0c\u8fd0\u884c\u4e00\u904d",(0,t.kt)("inlineCode",{parentName:"h3"},"prisma generate"),"\uff0c\u76ee\u524d\u6211\u4e00\u5957\u6d41\u7a0b\u8d70\u4e0b\u6765\uff0c\u5c06",(0,t.kt)("inlineCode",{parentName:"h3"},"prisma"),"\u4e00\u6b65\u6b65\u540c\u6b65\uff0c\u6548\u679c\u8fd8\u884c\uff1b\u53ea\u4e0d\u8fc7\u6700\u540e\u4e00\u6b65\u8fd8\u662f\u6709\u95ee\u9898\uff0c\u611f\u89c9\u53cc\u51fb\u7a0b\u5e8f\u542f\u52a8\u627e\u4e0d\u5230\u8def\u5f84\u7684\u95ee\u9898\u8fd8\u662f\u5b58\u5728\u3002\u65e2\u7136\u8fd9\u6837\uff0c\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u4f3c\u4e4e\u4e5f\u6ca1\u5565\u6027\u4ef7\u6bd4\u4e86"),(0,t.kt)("h3",c({},{id:"\u518d\u6d4b\u8bd5\u4e00\u4e0b\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u662f\u5426\u53ef\u4ee5\u88c5-windows\u5982\u679c\u4e5f\u4e0d\u884c\u6211\u5c31\u76f4\u63a5\u653e\u5f03-prisma-\u4e86"}),"\u518d\u6d4b\u8bd5\u4e00\u4e0b\u6b65\u6b65\u540c\u6b65\u7684\u65b9\u5f0f\u662f\u5426\u53ef\u4ee5\u88c5 windows\uff0c\u5982\u679c\u4e5f\u4e0d\u884c\uff0c\u6211\u5c31\u76f4\u63a5\u653e\u5f03 prisma \u4e86"),(0,t.kt)("p",null,"\u786e\u5b9e\u4e0d\u884c\uff0c\u53ea\u6709",(0,t.kt)("inlineCode",{parentName:"p"},"darwin"),"\uff0c\u6ca1\u6709\u770b\u5230\u7ed9",(0,t.kt)("inlineCode",{parentName:"p"},"win"),"\u7528\u7684 query-engine."),(0,t.kt)("h3",c({},{id:"\u5728-binary-\u91cc\u9700\u8981\u7528npm-i-prisma\u5b89\u88c5\u811a\u672c"}),"\u5728 binary \u91cc\u9700\u8981\u7528",(0,t.kt)("inlineCode",{parentName:"h3"},"npm i prisma"),"\u5b89\u88c5\u811a\u672c"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"\u279c  app git:(main) \u2717 ls node_modules/.bin\ndetect-libc  needle       node-pre-gyp rc           semver       sshpk-sign   uuid\nmkdirp       node-gyp     nopt         rimraf       sshpk-conv   sshpk-verify which\n\u279c  app git:(main) \u2717 npm i prisma\n\nadded 2 packages in 2s\n\n3 packages are looking for funding\n  run `npm fund` for details\n\u279c  app git:(main) \u2717 ls node_modules/.bin\ndetect-libc  needle       node-pre-gyp prisma       rc           semver       sshpk-sign   uuid\nmkdirp       node-gyp     nopt         prisma2      rimraf       sshpk-conv   sshpk-verify which\n\u279c  app git:(main) \u2717 which prisma\nprisma not found\n")),(0,t.kt)("p",null,"\u4f46\u5c3d\u7ba1\u5982\u6b64\uff0c\u5728\u7a0b\u5e8f\u4e2d\u4f9d\u65e7\u662f\u4e0d\u53ef\u4ee5\u76f4\u63a5\u7528",(0,t.kt)("inlineCode",{parentName:"p"},"prisma"),"\u7684 cli \u547d\u4ee4\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u4f9d\u8d56\u4e8e\u5168\u5c40",(0,t.kt)("inlineCode",{parentName:"p"},"prisma"),"\u3002 ",(0,t.kt)("img",{alt:"picture 40",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641325864607-2eef51948928ecdea5945715cbcc3849ddc26853568fff06053836804a64d967.png",width:"480"})),(0,t.kt)("p",null,"\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u6307\u5b9a\u811a\u672c\u3002"),(0,t.kt)("img",{alt:"picture 41",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641326080156-7dc342f49aac66cb4bd0494096f70a72c692f9a64faaf0141bae89788a5701fc.png",width:"480"}),(0,t.kt)("p",null,"\u4e0d\u8fc7\u811a\u672c\u91cc\u7528\u76f8\u5bf9\u8def\u5f84\u9700\u8981\u683c\u5916\u5c0f\u5fc3\uff0c",(0,t.kt)("inlineCode",{parentName:"p"},".|.."),"\u7684\u62fc\u63a5\uff0c\u662f\u76f8\u5bf9\u4e8e\u811a\u672c\u6267\u884c\u8005\u7684\u8def\u5f84\u800c\u8a00\u7684\uff0c\u800c\u4e0d\u662f\u811a\u672c\u6587\u4ef6\uff01"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),"const absDir = require('path').resolve('../../node_modules/.bin/prisma');\n")),(0,t.kt)("p",null,"\u6bd4\u5982\u8fd9\u53e5\u8bdd\uff0c\u5728\u6211\u4f7f\u7528",(0,t.kt)("inlineCode",{parentName:"p"},"open ./MacOS/HJXH-DATA-ANALYSIS"),"\u6253\u5f00\u65f6\uff0c\u56e0\u4e3a\u811a\u672c\u6267\u884c\u8005\u662f",(0,t.kt)("inlineCode",{parentName:"p"},"~"),"\uff0c\u5373",(0,t.kt)("inlineCode",{parentName:"p"},"/Users/mark"),"\uff0c\u6240\u4ee5\u5b83\u5176\u5b9e\u4ee5\u8fd9\u4e2a\u8def\u5f84\u4e3a\u57fa\u51c6\uff0c\u6700\u7ec8\u8f6c\u6362\u6210\u4e86",(0,t.kt)("inlineCode",{parentName:"p"},"/node_modules/.bin/prisma"),"\uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u5bf9\u7684\u3002"),(0,t.kt)("img",{alt:"picture 42",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641327264657-175bfcdadaca7a51529cbd8825454b81f68a210316fe55ddff53e5dbde64d1eb.png",width:"480"}),(0,t.kt)("p",null,"\u6240\u4ee5\u5728\u62fc\u63a5\u65f6\u8981\u8fde\u63a5\u4e0a\u6587\u4ef6\u8def\u5f84\uff0c\u50cf\u8fd9\u6837\u5c31\u5bf9\u4e86\u3002"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),"const absDir = require('path').resolve(\n  __dirname,\n  '../../node_modules/.bin/prisma',\n);\nconsole.log(\n  `database: \"prisma db push\", curDir: ${__dirname}, targetPrisma: ${absDir}`,\n);\n")),(0,t.kt)("img",{alt:"picture 43",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641327334520-499a53220b0945365efd324d7b3b608b7c6f5434cff333074c7eba9734bcc3e2.png",width:"480"}),(0,t.kt)("p",null,"\u4e0d\u8fc7\u63a5\u4e0b\u6765\u53c8\u62a5\u6587\u4ef6\u627e\u4e0d\u5230\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u662f\u5c0f\u4e8b\uff0c\u9a6c\u4e0a\u89e3\u51b3\u3002"),(0,t.kt)("p",null,"\u8fd9\u91cc\u603b\u7ed3\u4e00\u4e0b\uff1a"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"\u5728\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u91cc\uff0c\u7528\u5168\u5c40\u547d\u4ee4\u662f\u4e0d\u5408\u9002\u7684\uff0c\u6bd4\u8f83\u597d\u7684\u662f\u7528\u81ea\u5df1\u5305\u91cc\u7684\u547d\u4ee4\uff0c\u4f46\u8fd9\u4e0d\u50cf\u5f00\u53d1\u73af\u5883\u90a3\u6837\u4eff\u4f5b\u5929\u751f\u5c31\u6709\uff0c\u5177\u4f53\u8981\u5148",(0,t.kt)("inlineCode",{parentName:"li"},"npm i prisma"),"\u5b89\u88c5\u751f\u6210",(0,t.kt)("inlineCode",{parentName:"li"},".bin/prisma"),"\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u7136\u540e\u518d\u7528\u7edd\u5bf9\u8def\u5f84\u53bb\u5f15\u7528\u5b83\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u65e2\u7136\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\u884c\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5bfc\u51fa\u4e00\u4e2a\u53d8\u91cf\u3002"),(0,t.kt)("li",{parentName:"ol"},"PASS: \u5c06 prisma \u547d\u4ee4\u5bfc\u51fa\uff0c\u8fd9\u6837\uff0c\u5728\u5176\u4ed6\u5730\u65b9\u90fd\u53ef\u4ee5\u7528 prisma \u4e86")),(0,t.kt)("h3",c({},{id:"\u6307\u5b9a-prisma-\u6587\u4ef6"}),"\u6307\u5b9a prisma \u6587\u4ef6"),(0,t.kt)("p",null,"\u6ce8\u610f\u770b\u4e0a\u9762\u7684\u62a5\u9519\uff0c\u5176\u5b9e\u5b83\u5df2\u7ecf\u63d0\u4f9b\u4e86\u6211\u4eec\u65b9\u6cd5\u4e86\uff0c\u5c31\u662f\u5c06",(0,t.kt)("inlineCode",{parentName:"p"},"schema.prisma"),"\u653e\u5230\u6307\u5b9a\u4f4d\u7f6e\uff0c\u5373",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/"),"\u4e0b\u3002"),(0,t.kt)("p",null,"\u4e0d\u8fc7\u8fd9\u91cc\u4e5f\u80fd\u770b\u51fa\uff0c\u4ed6\u4eec\u7684\u4ee3\u7801\u89c4\u8303\u4e0d\u7edf\u4e00\uff0c\u6bd4\u5982",(0,t.kt)("inlineCode",{parentName:"p"},"prisma.schema"),"\u5728\u4e3b\u7a0b\u5e8f\u4e2d\uff0c\u88ab\u641c\u7d22\u7684\u8def\u5f84\u53ef\u4e0d\u6b62\u8fd9\u70b9\uff0c\u800c\u4e14\u8c8c\u4f3c\u8fd8\u662f\u4ee5",(0,t.kt)("inlineCode",{parentName:"p"},"schema."),"\u4f18\u5148\u7684\uff0c\u800c\u4e0d\u662f",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/schema.prisma"),"\u3002"),(0,t.kt)("p",null,"\u65b9\u6cd5 1. \u5728",(0,t.kt)("inlineCode",{parentName:"p"},"package.json"),"\u4e2d\u52a0\u5165",(0,t.kt)("inlineCode",{parentName:"p"},"prisma.schema"),"\u5b57\u6bb5\u65b9\u6cd5 2. \u79fb\u52a8\u76ee\u524d\u7684\u6587\u4ef6\uff08\u4ece",(0,t.kt)("inlineCode",{parentName:"p"},"schema.prisma"),"\u5230",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/schema.prisma"),"\uff09"),(0,t.kt)("p",null,"\u8fd9\u91cc\u5c31\u7528\u65b9\u6cd5 1 \u4e86\uff1a"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-json"}),'// app/package.json\n  6   "prisma": {\n  7     "schema": "dist/main/schema.prisma"\n  8   },\n')),(0,t.kt)("p",null,"\u7136\u800c\u8fd8\u662f\u62a5\u9519\u4e86\u3002"),(0,t.kt)("img",{alt:"picture 45",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641328243751-1aca13f23cfe42d39a7e6e163f36b408ca1825b281f5c7046af681baf4572ac0.png",width:"480"}),(0,t.kt)("p",null,"\u6211\u9a8c\u8bc1\u4e86\u4e00\u4e0b\u8def\u5f84\uff0c\u662f\u6ca1\u95ee\u9898\u7684\uff0c\u4e8e\u662f\u987a\u7740\u94fe\u63a5\u53bb\u5b98\u7f51\u770b\u4e86\u770b\uff0c\u7a81\u7136\u5c31\u610f\u8bc6\u5230\u4e86\uff0c\u8fd9\u53ef\u80fd\u53c8\u662f\u76f8\u5bf9\u8def\u5f84\u7684\u95ee\u9898\u3002"),(0,t.kt)("img",{alt:"picture 44",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641328226861-1929fd1ce321d98fdd99aae4fc2230af695176fa38764dd25687793f3b1ee4d6.png",width:"480"}),(0,t.kt)("p",null,"\u4e3a\u9a8c\u8bc1\u6211\u7684\u60f3\u6cd5\uff0c copy \u4e00\u4efd\u4e3a",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/schema.prisma"),"\uff0c\u9884\u671f\u5e94\u8be5\u8fd8\u662f\u4e0d\u884c\uff0c\u56e0\u4e3a\u90fd\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u6839\u636e\u5b98\u7f51\u7684\u641c\u7d22\u8def\u5f84",(0,t.kt)("inlineCode",{parentName:"p"},"./prisma/schema.prisma"),"\u5c31\u53d8\u6210\u4e86",(0,t.kt)("inlineCode",{parentName:"p"},"~/prisma/schema.prisma"),"\uff0c",(0,t.kt)("inlineCode",{parentName:"p"},"./schema.prisma"),"\u5c31\u53d8\u6210\u4e86",(0,t.kt)("inlineCode",{parentName:"p"},"~/schema.prisma"),"\u3002"),(0,t.kt)("p",null,"\u4e0d\u51fa\u6240\u6599\uff0c\u679c\u7136\uff01\u5373\u4fbf\u6211\u8def\u5f84\u91cc\u5df2\u7ecf\u5305\u542b\u4e86\u4e24\u79cd",(0,t.kt)("inlineCode",{parentName:"p"},"prisma"),"\uff0c\u5b83\u90fd\u627e\u4e0d\u5230\uff0c\u5c31\u662f\u56e0\u4e3a\u76f8\u5bf9\u8def\u5f84\u62fc\u63a5\u9519\u8bef\u3002"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-text"}),"\u279c  main git:(main) \u2717 tree .\n.\n\u251c\u2500\u2500 main.js\n\u251c\u2500\u2500 main.js.LICENSE.txt\n\u251c\u2500\u2500 preload.js\n\u251c\u2500\u2500 prisma\n\u2502\xa0\xa0 \u2514\u2500\u2500 schema.prisma\n\u2514\u2500\u2500 schema.prisma\n")),(0,t.kt)("p",null,"\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u81ea\u5df1\u6307\u5b9a\u8def\u5f84\u4e86\uff0c\u65e2\u7136\u8fd9\u6837\uff0c\u90a3\u4e48\u5728",(0,t.kt)("inlineCode",{parentName:"p"},"package.json"),"\u4e2d\u6307\u5b9a\u8def\u5f84\u4e5f\u6ca1\u6709\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u7edd\u5bf9\u8def\u5f84\u80af\u5b9a\u8981\u57fa\u4e8e\u6587\u4ef6\u8def\u5f84\u62fc\u63a5\u7684\uff0c\u6240\u4ee5\u53ea\u80fd\u5728\u7a0b\u5e8f\u4e2d\u52a8\u6001\u62fc\u63a5\u3002"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),'  3 const _p = require("path");\n  4\n  5 const schemaExePath = _p.resolve(\n  6     __dirname, "../../node_modules/.bin/prisma");\n  7\n  8 const schemaFilePath = _p.resolve(__dirname, "schema.prisma");\n  9\n 10 console.log(`database: "prisma db push", curDir: ${__dirname}, targetPrismaExeP    ath: ${schemaExePath}, targetPrismaFilePath: ${schemaFilePath}`);\n 11\n 12 i.default.exec(`${schemaExePath} db push --schema ${schemaFilePath}`,\n')),(0,t.kt)("h3",c({},{id:"prismaclient"}),(0,t.kt)("inlineCode",{parentName:"h3"},"prisma/client")),(0,t.kt)("p",null,"OK\uff01\u7528\u8def\u5f84\u62fc\u63a5\u8f6c\u7edd\u5bf9\u8def\u5f84\u7684\u65b9\u5f0f\uff0c\u89e3\u51b3\u4e86\u4e0a\u9762\u7684\u95ee\u9898\u3010TODO:\u7ed9 prisma \u63d0\u4e00\u4e2a pr\uff0c\u8003\u8651\u4e00\u6ce2\u57fa\u4e8e\u6587\u4ef6\u7684\u8def\u5f84\u62fc\u63a5\uff0c\u800c\u975e process\uff0c\u8981\u70e6\u6b7b\u4e86\u3011\uff0c\u65b0\u7684\u95ee\u9898\u5c31\u662f\u88c5\u4e00\u4e0b",(0,t.kt)("inlineCode",{parentName:"p"},"prisma/client"),"\uff0c"),(0,t.kt)("img",{alt:"picture 46",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641329044401-924bc44ed86e843bbf3d7f95bd397b823454b6390a2bdd8434d17585f4680012.png",width:"480"}),(0,t.kt)("p",null,"\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\u3002\u4e0d\u8fc7\u4e5f\u6709\u4e24\u79cd\u529e\u6cd5\uff1a"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"\u76f4\u63a5\u547d\u4ee4\u884c\u5b89\u88c5\uff1a",(0,t.kt)("inlineCode",{parentName:"li"},"npm i @prisma/client")),(0,t.kt)("li",{parentName:"ol"},"FAILED:\u5c1d\u8bd5\u628a\u5916\u90e8\u5305\u5bfc\u5165\u770b\u770b\u662f\u4e0d\u662f\u5c31\u4e0d\u9700\u8981\u88c5\u4e86")),(0,t.kt)("p",null,"\u8fd9\u91cc\u7528\u7b2c\u4e00\u79cd\u529e\u6cd5\uff1a"),(0,t.kt)("img",{alt:"picture 47",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641329276722-1de83c864711b6136a77e6b4d78546bb25b06af805a31f86b886daa26c62ca12.png",width:"480"}),(0,t.kt)("p",null,"\u6210\u4e86\uff01"),(0,t.kt)("h3",c({},{id:"\u6700\u540e\u4e00\u4e2a\u95ee\u9898query-engine-2022-01-06-020734-update-obviously-not-the-last"}),"\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c",(0,t.kt)("inlineCode",{parentName:"h3"},"query-engine")," \uff082022-01-06 02:07:34 update: obviously not the last\uff09"),(0,t.kt)("p",null,"It seems to place the engine dirctly under th project, would b a nice solution."),(0,t.kt)("img",{alt:"picture 48",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641341198622-23c03a1d8768467ff5da78eea2a3ecf820345938d9dc330e11c6871fce27c874.png",width:"480"}),(0,t.kt)("p",null,"A full logo about no query-engine:"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-text"}),'01:51:49.127 \u203a database: try to insert one iterm into `user`\n01:51:49.133 \u203a Error: Query engine library for current platform "darwin" could not be found.\nYou incorrectly pinned it to darwin\n\nThis probably happens, because you built Prisma Client on a different platform.\n(Prisma Client looked in "/Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist/main/libquery_engine-darwin.dylib.node")\n\nSearched Locations:\n\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/.prisma/client\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/node_modules/@prisma/client\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist/main\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist/main\n  /tmp/prisma-engines\n  /Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist/main\n\n\nTo solve this problem, add the platform "darwin" to the "binaryTargets" attribute in the "generator" block in the "schema.prisma" file:\ngenerator client {\n  provider      = "prisma-client-js"\n  binaryTargets = ["native"]\n}\n\nThen run "prisma generate" for your changes to take effect.\nRead more about deploying Prisma Client: https://pris.ly/d/client-generator\n    at cb (/Users/mark/Documents/mark_projects/hjxh/hjxh_express_match/erb/release/build/mac/HJXH-DATA-ANALYSIS.app/Contents/Resources/app/dist/main/main.js:2:1130669)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n\n')),(0,t.kt)("h2",c({},{id:"query-engine-in-windows-another-not-positive-problem"}),"query-engine in Windows, another not positive problem"),(0,t.kt)("img",{alt:"picture 11",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-prisma-sqlite-2-1641406097880-52fd7d1b52661bbda1bcaaae269428e75a623e465b6113661d46264c107ec00a.png"}),(0,t.kt)("p",null,"PASS: try to use keyword of ",(0,t.kt)("inlineCode",{parentName:"p"},"native")),(0,t.kt)("h3",c({},{id:"\u6781\u5c0f\u81ea\u52a8\u5316\u7a0b\u5e8f\u642d\u5efa"}),"\u6781\u5c0f\u81ea\u52a8\u5316\u7a0b\u5e8f\u642d\u5efa"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},"prisma init and generate --\x3e in order to generate target table"),(0,t.kt)("li",{parentName:"ol"},"change ",(0,t.kt)("inlineCode",{parentName:"li"},"findSync")," function to fasten speed --\x3e in order to avoid search from pc root, which would cause even minutes wait"),(0,t.kt)("li",{parentName:"ol"},"move ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.prisma")," into ",(0,t.kt)("inlineCode",{parentName:"li"},"release/app/")," --\x3e easy and default for programme search, which is consistent when in local development since ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.prisma")," is besides ",(0,t.kt)("inlineCode",{parentName:"li"},"index.js")," under ",(0,t.kt)("inlineCode",{parentName:"li"},"node_modules/.prisma/client/")),(0,t.kt)("li",{parentName:"ol"},"use path-merge to generate ABSOLUTE path, both for ",(0,t.kt)("inlineCode",{parentName:"li"},".bin/prisma")," and ",(0,t.kt)("inlineCode",{parentName:"li"},"schema.prisma")," --\x3e in case for the default merge behavior of prisma is wrong when the base path is offered by programme rather then by file."),(0,t.kt)("li",{parentName:"ol"},"install ",(0,t.kt)("inlineCode",{parentName:"li"},"prisma"),"/",(0,t.kt)("inlineCode",{parentName:"li"},"@prisma/client")," in binary or try to pre-install")),(0,t.kt)("h2",c({},{id:"\ufe0f-prisma-in-binary"}),"\u2611\ufe0f ",(0,t.kt)("inlineCode",{parentName:"h2"},"prisma")," in binary"),(0,t.kt)("img",{alt:"picture 5",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641244081948-ae8a83efcb1be3facf26b469c01373c949ac5290b5992996fd678650b16b2e87.png",width:"480"}),(0,t.kt)("p",null,"When I didn't install ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," globally, neither had I placed ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," into binary, then the error ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma command not found")," occurred:"),(0,t.kt)("img",{alt:"picture 7",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641245007081-71ea6e315a6d7d980e03a74450dc5e57661ec5497791211443a37785d0e70f98.png",width:"480"}),(0,t.kt)("p",null,"When I installed ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," globally, the error then came from ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma file not found"),"."),(0,t.kt)("img",{alt:"picture 6",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641244869137-b8237c6a5828025fe176e7e26acb08823ae96da2413a6cf25cf701e609913f38.png",width:"480"}),(0,t.kt)("p",null,"So:"),(0,t.kt)("p",null,"| install prisma globally | \u2705 | \u274c |"),(0,t.kt)("p",null,"But when I added ",(0,t.kt)("inlineCode",{parentName:"p"},"prisma")," file in the ",(0,t.kt)("inlineCode",{parentName:"p"},"package.json"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-json"}),'// package.json\n    "extraResources": [\n      "./assets/**",\n      "prisma/schema.prisma"\n    ],\n')),(0,t.kt)("p",null,"And it did go to the target application at: ",(0,t.kt)("inlineCode",{parentName:"p"},"build/mac/\u7687\u5bb6\u5c0f\u864e\u5feb\u9012\u5206\u6790\u7cfb\u7edf.app/Contents/Resources/prisma/schema.prisma")),(0,t.kt)("p",null,"The file cannot be found yet in fact."),(0,t.kt)("img",{alt:"picture 8",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641245255584-de651b38a5327b83e309e98e63ef7891f33b30bd48eb015d2f95dd66614b67f5.png",width:"480"}),(0,t.kt)("p",null,"I thought of adding into ",(0,t.kt)("inlineCode",{parentName:"p"},"files")," so that it can go to the ",(0,t.kt)("inlineCode",{parentName:"p"},"app.asar"),", but in vain:"),(0,t.kt)("img",{alt:"picture 9",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/readme-1641245688562-d7a4098c6a0ea4b5e465de2c2186a9c557dfd71b493ed7afdc533d6d0f407c10.png",width:"480"}),(0,t.kt)("p",null,"Also failed for (in case it uses the relative path to ",(0,t.kt)("inlineCode",{parentName:"p"},"release/app"),"):"),(0,t.kt)("pre",null,(0,t.kt)("code",c({parentName:"pre"},{className:"language-js"}),'     "../../prisma/schema.prisma",\n')),(0,t.kt)("h2",c({},{id:"\u6700\u5927\u7684\u95ee\u9898\u4e0d\u540c\u542f\u52a8\u65b9\u5f0f\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c\u4e0d\u4e00\u6837prisma-\u5728\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u627e\u4e0d\u5230"}),"\u6700\u5927\u7684\u95ee\u9898\uff0c\u4e0d\u540c\u542f\u52a8\u65b9\u5f0f\uff0c\u7a0b\u5e8f\u8fd0\u884c\u7ed3\u679c\u4e0d\u4e00\u6837\uff0cprisma \u5728\u53ef\u6267\u884c\u7a0b\u5e8f\u4e2d\u627e\u4e0d\u5230"),(0,t.kt)("img",{alt:"picture 14",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-prisma-sqlite-2-1641411307188-d2cfa0eb9f1bd80388ace2bf6f77188117e396c52a3ac4e5fa90b1fcd436b1d3.png"}),(0,t.kt)("p",null,"\u540e\u6765\u628a\u7a0b\u5e8f\u79fb\u5230",(0,t.kt)("inlineCode",{parentName:"p"},"/Application/"),"\u91cc\u540e\u5c31\u53d8\u5feb\u4e86\uff0c\u751a\u81f3\u8fd0\u884c\u5176\u4ed6\u7a0b\u5e8f\u90fd\u53d8\u5feb\u4e86\u2026\u2026\u56e0\u4e3a\u5b83\u4eec\u5b9e\u9645\u7528\u7684\u662f",(0,t.kt)("inlineCode",{parentName:"p"},"/Application/"),"\u91cc\u7684\u90a3\u4e2a",(0,t.kt)("inlineCode",{parentName:"p"},"schema dir"),"\u3002"),(0,t.kt)("p",null,"prisma \u76ee\u524d\u7684\u8def\u5f84\u8bbe\u8ba1\u4e0e\u673a\u5236\uff0c\u771f\u5730\u9002\u5408\u670d\u52a1\u7aef\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u8def\u5f84\u6bd4\u8f83\u56fa\u5b9a\uff0c\u5ba2\u6237\u7aef\u662f\u771f\u5730\u8981\u75af\uff0c\u7a0b\u5e8f\u542f\u52a8\u7684\u4f4d\u7f6e\u5343\u5947\u767e\u602a\uff0c\u53d8\u52a8\u4e5f\u5f88\u9891\u7e41\uff0c\u5bfc\u81f4 prisma \u90a3\u5957\u4f9d\u8d56\u6587\u4ef6\u81ea\u52a8\u751f\u6210\u7684\u673a\u5236\u53d8\u5f97\u590d\u6742\u4e14\u96be\u4ee5\u7ba1\u7406\u3002"),(0,t.kt)("p",null,"\u7efc\u4e0a\uff0celectron \u4e0d\u9002\u5408\u4e0e prisma \u642d\u914d\uff0celectron \u8fd9\u79cd\u968f\u5904\u8fd0\u884c\u7684\u7a0b\u5e8f\u5e94\u8be5\u9009\u62e9\u673a\u5236\u66f4\u7075\u6d3b\u7684\u4e00\u4e9b\u5e93\uff0c\u6bd4\u5982\u539f\u751f\u7684",(0,t.kt)("inlineCode",{parentName:"p"},"node-sqlite3"),"\u4e4b\u7c7b\u3002"),(0,t.kt)("p",null,"\u5206\u6790\u5230\u6b64\u4e3a\u6b62\uff0c\u548c prisma \u8bf4\u62dc\u62dc\u4e86\uff01"))}f.isMDXComponent=!0}}]);