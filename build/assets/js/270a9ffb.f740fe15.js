"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[44275],{21092:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>k,default:()=>N,frontMatter:()=>m,metadata:()=>f,toc:()=>w});var a=n(35318),o=n(46461),r=Object.defineProperty,l=Object.defineProperties,i=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&d(e,n,t[n]);if(p)for(var n of p(t))c.call(t,n)&&d(e,n,t[n]);return e},h=(e,t)=>l(e,i(t));const m={},k="electron howto",f={unversionedId:"coding/Languages/JS/Electron/electron-howto",id:"coding/Languages/JS/Electron/electron-howto",title:"electron howto",description:"1. electron best practice",source:"@site/my-documents/docs/coding/Languages/JS/Electron/electron-howto.md",sourceDirName:"coding/Languages/JS/Electron",slug:"/coding/Languages/JS/Electron/electron-howto",permalink:"/docs/coding/Languages/JS/Electron/electron-howto",draft:!1,editUrl:"https://github.com/markshawn2020/docusaurus/edit/master/my-documents/docs/coding/Languages/JS/Electron/electron-howto.md",tags:[],version:"current",lastUpdatedAt:1726564669,formattedLastUpdatedAt:"2024\u5e749\u670817\u65e5",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"electron-bugfix",permalink:"/docs/coding/Languages/JS/Electron/electron-bugfix"},next:{title:"electron prisma sqlite 2",permalink:"/docs/coding/Languages/JS/Electron/electron-prisma-sqlite-2"}},g={},w=[{value:"electron best practice",id:"electron-best-practice",level:2},{value:"design of dependency workflow",id:"design-of-dependency-workflow",level:3},{value:"app path, storing db, log, etc",id:"app-path-storing-db-log-etc",level:3},{value:"log into file",id:"log-into-file",level:3},{value:"electron test",id:"electron-test",level:2},{value:"sqlite best practice",id:"sqlite-best-practice",level:2},{value:"don&#39;t use relative path as sqlite position",id:"dont-use-relative-path-as-sqlite-position",level:3},{value:"log electron",id:"log-electron",level:2},{value:"TODO: idealog color configuration",id:"todo-idealog-color-configuration",level:3},{value:"build for Windows on Mac",id:"build-for-windows-on-mac",level:2},{value:"build native dependencies and for multi platforms",id:"build-native-dependencies-and-for-multi-platforms",level:2},{value:"custom app logo",id:"custom-app-logo",level:2},{value:"a good start",id:"a-good-start",level:3},{value:"customize icon for unpacked app",id:"customize-icon-for-unpacked-app",level:3},{value:"square .icon",id:"square-icon",level:3},{value:"electron-builder <code>files</code> map",id:"electron-builder-files-map",level:2},{value:"\u2b50\ufe0f\u2b50\ufe0f\u2b50\ufe0f debug binary electron",id:"\ufe0f\ufe0f\ufe0f-debug-binary-electron",level:2},{value:"<code>ipcRenderer</code> communication",id:"ipcrenderer-communication",level:2},{value:"hwo to use <code>preload.ts</code>",id:"hwo-to-use-preloadts",level:2},{value:"the <code>preload</code> script won&#39;t run if we just start the main process",id:"the-preload-script-wont-run-if-we-just-start-the-main-process",level:3},{value:"it&#39;s ok when we just use <code>preload.js</code>",id:"its-ok-when-we-just-use-preloadjs",level:3},{value:"what about using a <code>preload.ts</code>",id:"what-about-using-a-preloadts",level:3},{value:"remedy 1, the <code>tsc</code> solution",id:"remedy-1-the-tsc-solution",level:4},{value:"how to remedy the <code>electron-react-boilerplate</code> project",id:"how-to-remedy-the-electron-react-boilerplate-project",level:3}],b={toc:w};function N(e){var t=e,{components:n}=t,r=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&p)for(var a of p(e))t.indexOf(a)<0&&c.call(e,a)&&(n[a]=e[a]);return n})(t,["components"]);return(0,a.kt)("wrapper",h(u(u({},b),r),{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",u({},{id:"electron-howto"}),"electron howto"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#electron-best-practice"}),"electron best practice"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#design-of-dependency-workflow"}),"design of dependency workflow")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#app-path-storing-db-log-etc"}),"app path, storing db, log, etc")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#log-into-file"}),"log into file")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#electron-test"}),"electron test")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#sqlite-best-practice"}),"sqlite best practice"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#dont-use-relative-path-as-sqlite-position"}),"don't use relative path as sqlite position")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#log-electron"}),"log electron"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#todo-idealog-color-configuration"}),"TODO: idealog color configuration")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#build-for-windows-on-mac"}),"build for Windows on Mac")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#build-native-dependencies-and-for-multi-platforms"}),"build native dependencies and for multi platforms")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#custom-app-logo"}),"custom app logo"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#a-good-start"}),"a good start")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#customize-icon-for-unpacked-app"}),"customize icon for unpacked app")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#square-icon"}),"square .icon")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#electron-builder-files-map"}),"electron-builder ",(0,a.kt)("inlineCode",{parentName:"a"},"files")," map")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#%EF%B8%8F%EF%B8%8F%EF%B8%8F-debug-binary-electron"}),"\u2b50\ufe0f\u2b50\ufe0f\u2b50\ufe0f debug binary electron")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#ipcrenderer-communication"}),(0,a.kt)("inlineCode",{parentName:"a"},"ipcRenderer")," communication")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#hwo-to-use-preloadts"}),"hwo to use ",(0,a.kt)("inlineCode",{parentName:"a"},"preload.ts")),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#the-preload-script-wont-run-if-we-just-start-the-main-process"}),"the ",(0,a.kt)("inlineCode",{parentName:"a"},"preload")," script won't run if we just start the main process")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#its-ok-when-we-just-use-preloadjs"}),"it's ok when we just use ",(0,a.kt)("inlineCode",{parentName:"a"},"preload.js"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#what-about-using-a-preloadts"}),"what about using a ",(0,a.kt)("inlineCode",{parentName:"a"},"preload.ts")),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#remedy-1-the-tsc-solution"}),"remedy 1, the ",(0,a.kt)("inlineCode",{parentName:"a"},"tsc")," solution")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",u({parentName:"li"},{href:"#how-to-remedy-the--electron-react-boilerplate-project"}),"how to remedy the ",(0,a.kt)("inlineCode",{parentName:"a"},"electron-react-boilerplate")," project"))))),(0,a.kt)("h2",u({},{id:"electron-best-practice"}),"electron best practice"),(0,a.kt)("h3",u({},{id:"design-of-dependency-workflow"}),"design of dependency workflow"),(0,a.kt)("img",{alt:"picture 35",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641598093588-a14b7935afbcc384502d11ece03eab4f86772b695bfe904cd39f8180e934d21b.png"}),(0,a.kt)("p",null,"How to organize your project structure quite depends on your project scale and realization."),(0,a.kt)("p",null,"For example, since my project is not too big, I combined almost all the constant variables into one file ",(0,a.kt)("inlineCode",{parentName:"p"},"const.ts")," in each module, containing ",(0,a.kt)("inlineCode",{parentName:"p"},"channels")," , ",(0,a.kt)("inlineCode",{parentName:"p"},"error_types"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"defined variables"),", etc."),(0,a.kt)("h3",u({},{id:"app-path-storing-db-log-etc"}),"app path, storing db, log, etc"),(0,a.kt)("p",null,"Since the ",(0,a.kt)("inlineCode",{parentName:"p"},"userData")," is the sub path of ",(0,a.kt)("inlineCode",{parentName:"p"},"appData")," with the name of our application, so it's better to put all of our data into ",(0,a.kt)("inlineCode",{parentName:"p"},"userData"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"// src/main/base/utils.ts\nexport const getRootPath = () => app.getPath('userData');\n\nexport const getLogPath = () => path.join(getRootPath(), 'main.log');\n\nexport const getDbPath = () => path.join(getRootPath(), 'hjxh_data.sqlite');\n")),(0,a.kt)("p",null,"!!!tip If run under the development, since the app is run via ",(0,a.kt)("inlineCode",{parentName:"p"},"electron ."),", so the ",(0,a.kt)("inlineCode",{parentName:"p"},"userData")," points to the ",(0,a.kt)("inlineCode",{parentName:"p"},"Electron"),", which is different from the real build version with the actual name defined in our ",(0,a.kt)("inlineCode",{parentName:"p"},"package.json/build"),"."),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://www.electronjs.org/docs/v14-x-y/api/app#appgetapppath"}),"app | Electron"))),(0,a.kt)("h3",u({},{id:"log-into-file"}),"log into file"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"log.transports.file.resolvePath = () => getLogPath();\nlog.transports.file.format = '{y}-{m}-{d} {h}:{i}:{s}.{ms} {level}: {text}';\n")),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://github.com/megahertz/electron-log#overriding-consolelog"}),"megahertz/electron-log: Just a simple logging module for your Electron application"))),(0,a.kt)("h2",u({},{id:"electron-test"}),"electron test"),(0,a.kt)("p",null,"When all the ",(0,a.kt)("inlineCode",{parentName:"p"},"ts-node / esm")," relative environment is prepared well, there still exists some problems."),(0,a.kt)("p",null,"For example, concerning about database, since I use it derived from app runtime, and then it would not be mocked unless we start our script as a real electron app rather than a script for unittest."),(0,a.kt)("img",{alt:"picture 36",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641634838700-73855e534fc5987fd8ae13abe4a70a08ac88078a46f1dafa4857981f244c0484.png"}),(0,a.kt)("h2",u({},{id:"sqlite-best-practice"}),"sqlite best practice"),(0,a.kt)("h3",u({},{id:"dont-use-relative-path-as-sqlite-position"}),"don't use relative path as sqlite position"),(0,a.kt)("p",null,"When using relative path, many packages including system would treat it on the base of current process directory."),(0,a.kt)("p",null,"However, if the application is build into binary and run by click, then the behavior would become a bit different since e.g. in Mac the application is run with ",(0,a.kt)("inlineCode",{parentName:"p"},"process.cwd() = '/'"),"."),(0,a.kt)("p",null,"And then if we write our data into a sqlite which is created with relative path, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"./test.db"),", then the error would arise up because of permission."),(0,a.kt)("p",null,"So the best practice is to use ",(0,a.kt)("inlineCode",{parentName:"p"},"AppData")," directory via ",(0,a.kt)("inlineCode",{parentName:"p"},"path.join(app.getPath('appData'), dbName)"),"."),(0,a.kt)("h2",u({},{id:"log-electron"}),"log electron"),(0,a.kt)("p",null,"There are two places where console.log output goes:"),(0,a.kt)("p",null,"If you log in the renderer process, you can see it in the console in the browser window. If you open the dev tools programmatically you can see this console even after building."),(0,a.kt)("p",null,"If you log in the main process, you can see these messages ",(0,a.kt)("strong",{parentName:"p"},"if you start the installed app or the unpacked binary via command line"),". In windows this would be the app.exe in the win-unpacked directory that electron-builder creates."),(0,a.kt)("p",null,"Another alternative would be a logger like ",(0,a.kt)("inlineCode",{parentName:"p"},"electron-log")," that writes the log messages into a configured file."),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://stackoverflow.com/questions/51866016/electron-where-does-logging-go/51881711"}),"node.js - Electron - Where does logging go? - Stack Overflow"))),(0,a.kt)("p",null,"And I am surprised to find that it has been in the ",(0,a.kt)("inlineCode",{parentName:"p"},"electron-react-typescript")," boilerplate."),(0,a.kt)("img",{alt:"picture 9",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641400174339-197d9edb335e41d6d68eae58bf512f6cec757749415defd5fa87fb63c537ac0e.png"}),(0,a.kt)("p",null,"And it's used for ",(0,a.kt)("inlineCode",{parentName:"p"},"Auto-Update"),"."),(0,a.kt)("img",{alt:"picture 10",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641400215835-87f663610072a1e27f1da23a200f39b21f3e3f798a27270d1e9e5dd5d37ea255.png"}),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",u({parentName:"p"},{href:"https://github.com/megahertz/electron-log"}),"megahertz/electron-log: Just a simple logging module for your Electron application"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",u({parentName:"p"},{href:"https://stackoverflow.com/questions/41140960/where-can-i-find-the-logs-for-my-electron-app-in-production"}),"logging - Where can I find the logs for my Electron app in production? - Stack Overflow")))),(0,a.kt)("p",null,"However, it may not work since the output still goes into the terminal."),(0,a.kt)("h3",u({},{id:"todo-idealog-color-configuration"}),"TODO: idealog color configuration"),(0,a.kt)("h2",u({},{id:"build-for-windows-on-mac"}),"build for Windows on Mac"),(0,a.kt)("p",null,"Using this command:"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-sh"}),"electron-builder build --win\n")),(0,a.kt)("img",{alt:"picture 4",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641369861536-a425061cf7dc95030f6e2d90279fa39a62333acf181bd5f415d5fc6d9c245643.png",width:"480"}),(0,a.kt)("p",null,"But then: ",(0,a.kt)("img",{alt:"picture 5",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641370003105-4c933a2dae29f931f023269210b3a2d609cd218edd24c205643bfa2518f9aa2f.png",width:"480"})),(0,a.kt)("p",null,"Hence, we need a mirror."),(0,a.kt)("h2",u({},{id:"build-native-dependencies-and-for-multi-platforms"}),"build native dependencies and for multi platforms"),(0,a.kt)("p",null,"It seems this is auto finished by ",(0,a.kt)("inlineCode",{parentName:"p"},"electron-builder"),", which is described at: ",(0,a.kt)("a",u({parentName:"p"},{href:"https://www.electronjs.org/docs/latest/tutorial/using-native-node-modules#:~:text=This%20module%20can%20automatically%20determine%20the%20version%20of%20Electron%20and%20handle%20the%20manual%20steps%20of%20downloading%20headers%20and%20rebuilding%20native%20modules%20for%20your%20app."}),"This module can automatically determine the version of Electron and handle the manual steps of downloading headers and rebuilding native modules for your app.")),(0,a.kt)("img",{alt:"picture 1",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641369455356-de2696cc998305e33a63cfa320438182cb1058f3219da95df2b3993541d870fe.png",width:"480"}),(0,a.kt)("h2",u({},{id:"custom-app-logo"}),"custom app logo"),(0,a.kt)("h3",u({},{id:"a-good-start"}),"a good start"),(0,a.kt)("p",null,"All we need to do is to follow: ",(0,a.kt)("a",u({parentName:"p"},{href:"https://medium.com/fantageek/changing-electron-app-icon-acf26906c5ad"}),"Changing electron app icon. Generate icns | by Khoa Pham | Fantageek | Medium")),(0,a.kt)("p",null,"In which it directs us to download ",(0,a.kt)("a",u({parentName:"p"},{href:"https://github.com/onmyway133/IconGenerator"}),"onmyway133/IconGenerator: \ud83c\udf71 A macOS app to generate app icons")),(0,a.kt)("p",null,"success when run after pack."),(0,a.kt)("img",{alt:"picture 1",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641367831443-9ec96d4bce17056e6abf363cd144266c952a154a3aa7fec43afc2145d5ca028a.png",width:"480"}),(0,a.kt)("h3",u({},{id:"customize-icon-for-unpacked-app"}),"customize icon for unpacked app"),(0,a.kt)("p",null,"If we wanner the icon does work in unpacked environment, we need to replace the default icon in the module."),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-sh"}),"cp ./assets/icon.icns node_modules/electron/dist/Electron.app/Contents/Resources\n")),(0,a.kt)("p",null,"Or we can follow the above article, right click app, and change the icon."),(0,a.kt)("h3",u({},{id:"square-icon"}),"square .icon"),(0,a.kt)("p",null,"When I pack for windows, it told me the icon size is at least '256 x 256'."),(0,a.kt)("p",null,"However I checked the raw image ",(0,a.kt)("inlineCode",{parentName:"p"},"xx.png"),", and admitted that the size is far bigger than this, but only to be converted to '256 x 204'."),(0,a.kt)("p",null,"I realized it may be owing to the size ratio, and I changed the image file into a square one. ",(0,a.kt)("img",{alt:"picture 2",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641369646888-cd19bed16ca970d1b078ca722f2464221a47f054162de3bf10154efd5a1759e6.png",width:"480"})),(0,a.kt)("p",null,"And then, it worked!"),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://stackoverflow.com/questions/58351575/how-to-change-electronjs-app-default-icon"}),"angular - How to Change ElectronJS App default Icon? - Stack Overflow"))),(0,a.kt)("h2",u({},{id:"electron-builder-files-map"}),"electron-builder ",(0,a.kt)("inlineCode",{parentName:"h2"},"files")," map"),(0,a.kt)("p",null,"The current problem has become clarified, that is files not found."),(0,a.kt)("p",null,"We need a map, since I tried ",(0,a.kt)("inlineCode",{parentName:"p"},"files")," but in vain."),(0,a.kt)("img",{alt:"picture 1",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641148225241-7024811ff97dcbf12b0b6fbbd55ba645706c76be5464f6709b699d2bbd239c5f.png",width:"480"}),(0,a.kt)("p",null,"Now, the problem is that the database would auto create after first query, while it's empty and then causes errors."),(0,a.kt)("img",{alt:"picture 2",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/electron-howto-1641152259910-b7c6267ebdebb2f92da0194da0c417ea56039d03d07c10cc0726155b9b3b3e35.png",width:"480"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://github.com/prisma/prisma/issues/9613"}),"Using Prisma with the Electron Framework \xb7 Issue #9613 \xb7 prisma/prisma"))),(0,a.kt)("h2",u({},{id:"\ufe0f\ufe0f\ufe0f-debug-binary-electron"}),"\u2b50\ufe0f\u2b50\ufe0f\u2b50\ufe0f debug binary electron"),(0,a.kt)("p",null,"Here's what worked for me on Mac."),(0,a.kt)("p",null,"In terminal type ",(0,a.kt)("inlineCode",{parentName:"p"},"lldb path/to/build.app")," In the opened debugger type ",(0,a.kt)("inlineCode",{parentName:"p"},"run --remote-debugging-port=8315"),". It should open a window of your app. Open Chrome at ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:8315/")," Click on the name of the app. For example, Webpack App. If you don't see anything in the opened tab, focus on the window of your app."),(0,a.kt)("p",null,"ref: ",(0,a.kt)("a",u({parentName:"p"},{href:"https://stackoverflow.com/a/56634497/9422455"}),"https://stackoverflow.com/a/56634497/9422455")),(0,a.kt)("h2",u({},{id:"ipcrenderer-communication"}),(0,a.kt)("inlineCode",{parentName:"h2"},"ipcRenderer")," communication"),(0,a.kt)("p",null,"It deserves my attention that the msg interface from main process is so-called ",(0,a.kt)("inlineCode",{parentName:"p"},"ipcMainEvent")," which is not exported."),(0,a.kt)("img",{alt:"picture 79",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640678460651-electron-howto-12d652220f222d268d792307f8e0523bfc5b47ea28c4b56795c240ed44fce75b.png",width:"480"}),(0,a.kt)("p",null,"So, for typescript support, I need to define a 'hooked ipcMainEvent' like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-ts"}),"interface IpcMainEvent extends Event {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  reply: Function;\n}\n")),(0,a.kt)("p",null,"And when communicating, I should be careful with the difference between ",(0,a.kt)("inlineCode",{parentName:"p"},"on")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"once"),", and don't forget to close the channel if need."),(0,a.kt)("img",{alt:"picture 74",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640672448044-electron-howto-940254219636fb7b6bbdfea1faf735478526cefe89f48a4e6d2cef6acfe509e6.png",width:"480"}),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",u({parentName:"p"},{href:"https://www.electronjs.org/docs/latest/api/structures/ipc-main-event"}),"IpcMainEvent Object extends ",(0,a.kt)("inlineCode",{parentName:"a"},"Event")," | Electron"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("a",u({parentName:"p"},{href:"https://www.electronjs.org/docs/latest/api/ipc-renderer"}),"ipcRenderer | Electron")))),(0,a.kt)("h2",u({},{id:"hwo-to-use-preloadts"}),"hwo to use ",(0,a.kt)("inlineCode",{parentName:"h2"},"preload.ts")),(0,a.kt)("p",null,"ref:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",u({parentName:"li"},{href:"https://stackoverflow.com/questions/49076033/using-typescript-in-electrons-preload-scripts"}),"Using typescript in Electron's preload scripts - Stack Overflow"))),(0,a.kt)("p",null,"suppose:"),(0,a.kt)("pre",null,(0,a.kt)("code",u({parentName:"pre"},{className:"language-yaml"}),"MAIN: src/electron/main\nRENDERER: src/renderer/index\nPRELOAD_TS: src/electron/preload.ts\nPRELOAD_JS: src/electron/preload.js\nRUN_MAIN: electron MAIN, or like\nRUN_RENDERER: webpack serve --config WEBPACK_DEV_CONFIG_RENDERER.js, or like\n")),(0,a.kt)("h3",u({},{id:"the-preload-script-wont-run-if-we-just-start-the-main-process"}),"the ",(0,a.kt)("inlineCode",{parentName:"h3"},"preload")," script won't run if we just start the main process"),(0,a.kt)("p",null,"First, if we only run ",(0,a.kt)("inlineCode",{parentName:"p"},"electron MAIN")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"electron -r ts-node/register/transpile-only MAIN")," (ts support), the electron window would run successfully no matter we pointed a ",(0,a.kt)("inlineCode",{parentName:"p"},"preload")," file or not since the file would only run just before the renderer process, i.e. after the main process and separate."),(0,a.kt)("h3",u({},{id:"its-ok-when-we-just-use-preloadjs"}),"it's ok when we just use ",(0,a.kt)("inlineCode",{parentName:"h3"},"preload.js")),(0,a.kt)("p",null,"If we just use ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.js"),", then no matter we use webpack or not, the programme would run well."),(0,a.kt)("h3",u({},{id:"what-about-using-a-preloadts"}),"what about using a ",(0,a.kt)("inlineCode",{parentName:"h3"},"preload.ts")),(0,a.kt)("p",null,"The main problem concerning with ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.ts")," is that when we use electron, we are likely to use different pack method for main process and the renderer one, and the core concept is whether the ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.ts")," had been compiled into ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.js")," and executed by the renderer."),(0,a.kt)("h4",u({},{id:"remedy-1-the-tsc-solution"}),"remedy 1, the ",(0,a.kt)("inlineCode",{parentName:"h4"},"tsc")," solution"),(0,a.kt)("p",null,"If we first created a ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.ts")," file and it doesn't export anything to with the main or renderer codes, then the only change we need to do is that to add ",(0,a.kt)("inlineCode",{parentName:"p"},"tsc PRELOAD_TS && ")," before the ",(0,a.kt)("inlineCode",{parentName:"p"},"RUN_RENDERER"),"."),(0,a.kt)("p",null,"It can be expected to see the ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.ts")," changed into ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.js")," and all the things goes ok."),(0,a.kt)("p",null,"For example, we can write pure ",(0,a.kt)("inlineCode",{parentName:"p"},"ts")," type of ",(0,a.kt)("inlineCode",{parentName:"p"},"preload"),", and it in fact needs no extra modification since the interface is perfect except a little dangerous since we didn't put constraint on the api request. More can be found refer to: ",(0,a.kt)("a",u({parentName:"p"},{href:"https://www.electronjs.org/docs/latest/tutorial/context-isolation#:~:text=over%20the%20bridge.-,security%20considerations"}),"Security considerations")),(0,a.kt)("img",{alt:"picture 62",src:"https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640619986956-electron-howto-1ce7cdbe555ac69cf6f36e74efe332354d4bfda0fc47257f55efb8c46d629538.png",width:"480"}),(0,a.kt)("p",null,"I do care about the safe problem if this is a huge app developed for commercial use."),(0,a.kt)("p",null,"But If I write more apis, then it would drive me to separate my apis in another file, and the renderer, as well as the main, would read from the file together. At the same time, ",(0,a.kt)("inlineCode",{parentName:"p"},"tsc")," would compile the ",(0,a.kt)("inlineCode",{parentName:"p"},"preload.ts")," along with the separate file to ",(0,a.kt)("inlineCode",{parentName:"p"},".js"),", then a ",(0,a.kt)("inlineCode",{parentName:"p"},"emit skipped")," error may happen if the electron main to read a ",(0,a.kt)("inlineCode",{parentName:"p"},"interface.ts")," file but to find there exists both ",(0,a.kt)("inlineCode",{parentName:"p"},"interface.ts")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"interface.js"),"."),(0,a.kt)("h3",u({},{id:"how-to-remedy-the-electron-react-boilerplate-project"}),"how to remedy the ",(0,a.kt)("inlineCode",{parentName:"h3"},"electron-react-boilerplate")," project"),(0,a.kt)("p",null,"Dive into the source coe of ",(0,a.kt)("a",u({parentName:"p"},{href:"https://github.com/electron-react-boilerplate/electron-react-boilerplate#:~:text=electron-react-boilerplate%0A%20%20%0A%20%20%2F-,electron-react-boilerplate,-Public%20template"}),"electron-react-boilerplate")," , we can know the programme startup flow under the development environment is as the following:"),(0,a.kt)(o.G,h(u({},{chart:"flowchart TD\n\nsubgraph Start[npm run start]\nPreStart[check port in use] --\x3e\nStartRender\nend\n\n\nsubgraph StartRender[\\`npm run start:renderer\\`]\n\nsubgraph WebpackDev[\\`webpack serve --dev.config\\`]\nsubgraph BeforeRun[before run: \\`npm run start:main\\`]\nElectronStart[run electron main]\n\nend\nend\nend"}),{mdxType:"Mermaid"})))}N.isMDXComponent=!0}}]);