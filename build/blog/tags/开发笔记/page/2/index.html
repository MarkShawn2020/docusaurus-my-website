<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">9 篇博文 含有标签「开发笔记」 | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/blog/tags/开发笔记/page/2"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="9 篇博文 含有标签「开发笔记」 | 南川笔记"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/blog/tags/开发笔记/page/2"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/tags/开发笔记/page/2" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/tags/开发笔记/page/2" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a class="navbar__item navbar__link" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_P3nc thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_VrjY margin-bottom--md">All Posts</div><ul class="sidebarItemList_OSkG clean-list"><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-INFP与ENTJ的日日夜夜">2024/2422-INFP与ENTJ的日日夜夜</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-从FP走向TJ">2024/2422-从FP走向TJ</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/06/21/Rabbit-R1分享会">Rabbit-R1分享会</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/05/01/2419-信仰一跃">2419-信仰一跃</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/04/30/飞脑">飞脑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/discarded/微信聊天记录备份指南">微信聊天记录备份指南</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/01/14/觉醒的硅基">觉醒的硅基</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/31/index">[03-27-digital-travel] 南川数字游民之旅01：</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/27/南川骑行川藏线（下）">南川骑行川藏线（下）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白">十年 —— 一位自学者、技术工作者、理想主义者的独白</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/18/南川骑行川藏线（中）">南川骑行川藏线（中）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/09/25/当我想做一款吹羽毛小游戏……">当我想做一款吹羽毛小游戏……</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦">Poketto.AI: 每一个人的哆啦A梦</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/12/31/this-year">this-year</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/29/coding-cries">代码有所能，有所不能</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/03/taiwan-data-research">关于台湾进出口临时政策与历史数据的研究</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/01/wechat-hack">微信数据库破解</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/11/prose-I-am-me">札记 | 我与我周旋久，我亦是我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/11/dev-gopro-1">编程 | GoPro 01: 全天候自动 4K 延时摄影</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/06/dev-ios-automation">编程 | iOS 自动化实现王者荣耀一键换装</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/23/dev-mp3-meta">编程 | 逼哥的音乐元数据修复</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/22/evaluation-breo-dream6">评测 | Breo Dream6 按摩仪</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/15/prose-is-not-easy">札记 | 须知，活好是很不容易的</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/14/dev-voice2srt">编程 | 视频剪辑自动转写字幕</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/04/22/research-mbti/mark_mbti">研究 | 基于 MBTI 的人生复盘与计划（上）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/27/prose-321-air-crash">札记 | 愿逝者安息生者坚强，你我迎风奔跑向阳而生</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/09/dev-douban-renting">编程 | 北京租房系统设计、研究与经验 0.1.0</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/21/ad-beike-hiring">推广 | 贝壳新业务 VR 全职开发招募</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts">编程设计艺术思考（持续更新）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/03/prose-living">札记 | 2022，活着</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/02/dev-linux">编程 | Linux 笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/01/prose-2022-begining">札记 | 关于近几年的一些感悟</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/23/prose-engineer-cultivation">札记 | 一位工程师的自我修养（序）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/20/prose-first-job">札记 | 是的，我入职了</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/01/prose-my-2021">札记 | 我的 2021：混沌与洞见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/24/dev-webpack">编程 | 记与 Webpack 十二小时的奋战</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/一道“全军覆灭”的数学题">一道“全军覆灭”的数学题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/考研数学试题编辑">考研数学试题编辑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/28/今天南川学习十小时了吗？是的。">关于正态分布表的一个有趣发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/09/浅谈我自学编程的经历与经验">浅谈我自学编程的经历与经验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/28/关于有人想仲裁我">关于有人想仲裁我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/27/十月：无题">十月：无题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/18/王者荣耀打野上分经验总结（全干货）">王者荣耀打野上分经验总结</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/06/27/毕业一年：我的得与失">南川二一零六：毕业一年，我的失与得</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/05/12/记逆向攻破拼多多加密系统">南川逆向笔记 | 攻破 PDD 风控系统（一）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/04/14/从0到1搭建一个Electron应用">Electron 开发笔记 - 从 0 到 1 搭建一个 Electron 应用</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/03/12/shamghai-rent-lesson">记与上海无良房东斡旋经验与教训</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/01/09/评测-南川Effie使用初体验">南川 Effie 使用初体验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/11/20/拜登获胜演讲稿">拜登获胜演讲稿</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）">五台山论道（节选自《遥远的救世主》）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：一路失败，我到底学到了什么">大学沉思录：一路失败，我到底学到了什么</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：意向调查">大学沉思录：意向调查</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/22/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/15/投资：凯利公式">“中一千万”与“挣一千万”到底哪个更容易</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/bug_fix">BUG FIX</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/home">南川笔记中文首页</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/todo-old">待办事项</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/release-notes">更新日志</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/guestbook">留言墙</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/12/经验与发现">经验与发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/10/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/开发常用命令行">开发常用命令行</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/my_university">谨以此文，纪念我在大学的这四年</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/VuePress-Journal">VuePress你好，VuePres再见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/vue开发笔记">vue开发笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/博客开发之导航设计方案">博客开发之导航设计方案</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/如何向ElementUI一样封装Message全局组件">如何向ElementUI一样封装Message全局组件</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/如何给右键添加任何启动程序">如何给右键添加任何启动程序</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/我谈《三十而已》">我谈《三十而已》</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/极客运营手册/">极客运营手册</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/ssg-ssr">When to Use Static Generation v.s. Server-side Rendering</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/pre-rendering">Two Forms of Pre-rendering</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>9 篇博文 含有标签「开发笔记」</h1><a href="/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/05/14/dev-voice2srt">编程 | 视频剪辑自动转写字幕</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-05-14T00:00:00.000Z" itemprop="datePublished">2022/05/14</time> · <!-- -->阅读需 15 分钟</div></header><div class="markdown" itemprop="articleBody"><ol><li>语音转写市场概览</li><li>网易见外的缺点<ol><li>FCPX 不支持网易见外导出的 srt 字幕文件</li><li>网易见外的转写结果需要手动进行长度切割</li><li>网易见外只支持后期文本替换，而不支持前期预设词库</li><li>网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放</li></ol></li><li>讯飞转写<ol><li>讯飞服务价格</li><li>讯飞语音转写控制台</li><li>讯飞语音转写的使用</li><li>讯飞语音转写使用分词</li><li>讯飞语音转写程序</li></ol></li><li>基于 Automator 实现右键语音文件后台自动转写</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="语音转写市场概览">语音转写市场概览<a class="hash-link" href="#语音转写市场概览" title="标题的直接链接">​</a></h2><p>目前国内中文语音转文字，做的最好的应该是科大讯飞（可惜要付费）：</p><ul><li><a href="https://console.xfyun.cn/services/lfasr" target="_blank" rel="noopener noreferrer">控制台-讯飞开放平台</a></li></ul><p>所以其实很多 UP 主用的是网易见外之类的免费转写产品。</p><p>其他转写平台还有，比如：</p><ul><li><a href="https://github.com/PaddlePaddle/PaddleSpeech" target="_blank" rel="noopener noreferrer">百度的飞桨</a></li><li><a href="https://github.com/opensourceteams/google-sdk-speech-to-text" target="_blank" rel="noopener noreferrer">谷歌识别</a></li><li>……</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外的缺点">网易见外的缺点<a class="hash-link" href="#网易见外的缺点" title="标题的直接链接">​</a></h2><p>我实际体验下来，网易见外还是不太能满足我的需求的，主要如下：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fcpx-不支持网易见外导出的-srt-字幕文件">FCPX 不支持网易见外导出的 srt 字幕文件<a class="hash-link" href="#fcpx-不支持网易见外导出的-srt-字幕文件" title="标题的直接链接">​</a></h3><p>这个我之前就了解了一下，发现大家都是用一些第三方软件再将网易见外的 srt 转换成另一种 srt，不禁引起了我的好奇，到底为啥网易见外的 srt 不支持 fcpx 导入。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437655118-c3c5e4b27ab7ff01d6860b73a89f616fff6cd87264153c70010e5802280ee68b.png" alt="picture 9" class="img_vXGZ"></p><p>我对比了讯飞转写和网易见外的 srt 文件，发现两者的唯一区别就在于编序下标不同：网易见外从 0 开始标记，而讯飞转写从 1 开始：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437563419-c6548e1349f50fa454cc6d34842da5852007a8d589514d968974963ce1751cf1.png" alt="picture 8" class="img_vXGZ"></p><p>由此大胆猜测：FCPX 对 srt 文件的硬性要求就是从 1 开始编码！</p><p>于是我将网易见外的第 0 号编码对应的字幕内容去掉，重新导入 FCPX，结果成功了，此即证实了我的猜想。</p><p>了解了原因之后，这个问题就变得不那么恐怖了，随便用什么脚本语言把网易见外的 srt 文件里的序号全部加 1，或者干脆把第一条去掉即可。不是什么难事。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外的转写结果需要手动进行长度切割">网易见外的转写结果需要手动进行长度切割<a class="hash-link" href="#网易见外的转写结果需要手动进行长度切割" title="标题的直接链接">​</a></h3><p>网易见外的默认转写字幕长度是偏长的。这其实可以理解，因为长一点有助于基于上下文分析提高转写的准确度。</p><p>但问题就在于，想把分好的每句字幕再切小一点，则需要手动的在网页上点击分隔按钮一个个地调整，这个工作量就变得无法接受了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437965030-0e0c5d1f23c071c4b8621142912eeb55bdbf32bec4663afaa6854b30f47fbf4c.png" alt="picture 10" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外只支持后期文本替换而不支持前期预设词库">网易见外只支持后期文本替换，而不支持前期预设词库<a class="hash-link" href="#网易见外只支持后期文本替换而不支持前期预设词库" title="标题的直接链接">​</a></h3><p>对于学过机器学习的程序员或者用过<code>jieba</code>分词之类开源代码库的人都知道，预设词库在文本分析相关领域是非常重要的，显著影响算法识别的准确度和使用体验。</p><p>然而网易见外是不支持转写之前预设词库，只可以转完之后在页面点击文本替换，由此可见网易转写的机器学习模型（如果有的话）比较低级，它只有通用的一个，不支持用户自己输入词库进行模型微调。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放">网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放<a class="hash-link" href="#网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放" title="标题的直接链接">​</a></h3><p>这个是讯飞转写的一个很友好的功能，并且在技术是线上我认为也不是很难的一件事，但很可惜，网易见外也未能把这个用户体验做起来。</p><p>基于以上原因，我认为网易见外是远未达到我对一个智能转写软件平台的目标要求的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞转写">讯飞转写<a class="hash-link" href="#讯飞转写" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞服务价格">讯飞服务价格<a class="hash-link" href="#讯飞服务价格" title="标题的直接链接">​</a></h3><p>如果没有开通过讯飞的服务，可以申请免费使用。不过有一定要求，比如企业用户需要提交工商执照相关信息，而个人用户，看声明貌似要 19 年的新用户……反正我是不符合了（我以前应该用过）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431323538-20c35f16a1a4cedc75b65c5c69614ddc05521d1e6608e1bc485f523af6b8d8e9.png" alt="picture 6" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写控制台">讯飞语音转写控制台<a class="hash-link" href="#讯飞语音转写控制台" title="标题的直接链接">​</a></h3><p>在控制台，可以查看自己所购买的讯飞服务详情，最主要的就是确认自己购买的是“讯飞转写”的服务，然后至少要支持中英文转写，最后在个性化热词里可以加入自己的特殊词库（用于提高准确率，非常有用）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431465004-4f6c800430b3f09d8917e0e0009af5ba5668169312f800f2e236fcda51ac55a0.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写的使用">讯飞语音转写的使用<a class="hash-link" href="#讯飞语音转写的使用" title="标题的直接链接">​</a></h3><p>可以使用讯飞语音转写的 api，在该页可以下载各大语音（例如 python）的 demo：<a href="https://www.xfyun.cn/doc/asr/lfasr/API.html" target="_blank" rel="noopener noreferrer">语音转写 API 文档 | 讯飞开放平台文档中心</a></p><p>建议直接对着 demo 改，否则从 0 到 1 写会很麻烦，因为要很多加密相关参数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431132707-614749d87f3bee0e5b8675061e1330fb9b700080406a936bc8c7f30a4cb929ce.png" alt="picture 5" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写使用分词">讯飞语音转写使用分词<a class="hash-link" href="#讯飞语音转写使用分词" title="标题的直接链接">​</a></h3><p>在 <code>/prepare</code> 接口的参数中如果加上 <code>has_participle = true</code>，则会返回带每个词语识别的结果。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652461333188-95a3f302b742e110b3cbdf3f0227cbc525d8869298487f4929c0fa8ad037a333.png" alt="picture 11" class="img_vXGZ"></p><p>不过深入去使用词级别的解析结果也是一件不太容易的事情，因为需要我们自己去处理断句的问题。比如说要通过<code>&#x27;wordsName&#x27;: &#x27;，&#x27;</code>去判别是个断句。</p><p>基于这个角度来看，网易见外不支持按长度的智能分句，似乎也变得不是那么不能接受了。</p><p>但尽管如此，讯飞的结果依旧要比网易见外好很多。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写程序">讯飞语音转写程序<a class="hash-link" href="#讯飞语音转写程序" title="标题的直接链接">​</a></h3><p>已同步在个人仓库：<a href="https://github.com/MarkShawn2020/mark_keeps_learning/blob/master/mark_scripts/voice2srt/main.py" target="_blank" rel="noopener noreferrer">https://github.com/MarkShawn2020/mark_keeps_learning/blob/master/mark_scripts/voice2srt/main.py</a></p><p>具体脚本内容如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   author: yanmeng2, xunfei api relative</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   author: markshawn2020, xunfei result to srt-format file, 2022-05-13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   config: https://console.xfyun.cn/services/lfasr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   doc: https://www.xfyun.cn/doc/asr/lfasr/API.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hashlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hmac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lfasr_host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://raasr.xfyun.cn/api&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 请求的接口名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_prepare </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/prepare&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_upload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/upload&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_merge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/merge&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_get_progress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/getProgress&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_get_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/getResult&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 文件分片大小10M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_piece_sice </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10485760</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ——————————————————转写可配置参数————————————————</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数可在官网界面（https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html）查看，根据需求可自行在gene_params方法里添加修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 转写类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lfasr_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 是否开启分词</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">has_participle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;false&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">has_seperate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 多候选词个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_alternatives </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 子用户标识</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每隔N秒获取一次进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SliceIdGenerator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;slice id生成器&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;aaaaaaaaa`&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNextSliceId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cj </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;z&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -------------------- 从讯飞结果到srt的转换函数 -----------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time2stamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    将整数时间（毫秒）转化为srt的时间戳，即 HH:MM:SS,mmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param s:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mmm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MM </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">HH</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">MM</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">SS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">mmm</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">03</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pickle_srt_item</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mm_start</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mm_end</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    构建srt字幕文件的基本单元</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param index: 字幕序号，从1开始，手动创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param mm_start: 该字幕单元起始毫秒数</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param mm_end: 该字幕单元结束毫秒数</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param content: 该字幕单元的文本内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">index</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">time2stamp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">mm_start</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> --&gt; </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">time2stamp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">mm_end</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xunfei_json2srt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    将讯飞转写的输出转成srt字幕文本内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param items:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pickle_srt_item</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bg&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ed&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;onebest&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RequestApi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secret_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_appid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_secret_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> secret_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upload_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">splitext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.srt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--- initialized ---&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 根据不同的apiname生成不同的参数,本示例中未使用全部参数您可在官网(https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html)查看后选择适合业务场景的进行更换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slice_id</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_secret_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        upload_file_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        m2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        m2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        md5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> m2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        md5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">md5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 以secret_key为key, 上面的md5为msg， 使用hashlib.sha1加密结果为signa</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hmac</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secret_key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> md5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signa</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signa</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getsize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        param_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_prepare</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># slice_num是指分片数量，如果您使用的音频都是较短音频也可以不分片，直接将slice_num指定为1即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            slice_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> file_piece_sice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> file_piece_sice </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;app_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;signa&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ts&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;file_len&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;file_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;slice_num&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">slice_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_upload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;app_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;signa&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ts&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;task_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;slice_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> slice_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_merge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;app_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;signa&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ts&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;task_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;file_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_get_progress </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_get_result</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;app_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;signa&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ts&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;task_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> param_dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 请求和结果解析，结果中各个字段的含义可参考：https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lfasr_host </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ok&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{} success:&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;{} error:&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 预处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">prepare_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">api_prepare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_prepare</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 上传</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_object </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rb&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SliceIdGenerator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_piece_sice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;filename&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;slice_id&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                   slice_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getNextSliceId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ok&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic"># 上传分片失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;upload slice fail, response: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;upload slice &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27; success&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                index </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&#x27;file index:&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 合并</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">merge_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_merge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_merge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_progress_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_progress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_progress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_result_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">all_api_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 1. 预处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pre_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prepare_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pre_result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 2 . 分片上传</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 3 . 文件合并</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 4 . 获取任务进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 每隔N秒获取一次任务进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            progress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_progress_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            progress_dic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> progress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;err_no&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;err_no&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26605</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;task error: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;failed&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                task_status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> task_status</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;status&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;task &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> taskid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27; finished&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;The task &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> taskid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27; is in processing, task status: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 每次获取进度间隔N S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 5 . 获取结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        srt_json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_result_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        srt_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xunfei_json2srt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">srt_json</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;w&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">srt_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;has written converted result into path: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RequestApi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;XUNFEI_APP_ID&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret_key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;XUNFEI_APP_SK&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        upload_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all_api_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-automator-实现右键语音文件后台自动转写">基于 Automator 实现右键语音文件后台自动转写<a class="hash-link" href="#基于-automator-实现右键语音文件后台自动转写" title="标题的直接链接">​</a></h2><p>目前我们写的脚本，输入是一个文件路径，特别的，是指我们待转的音频文件，根据讯飞接口要求，对输入的文件有以下限制：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533014083-ec6a9f68a140717a16bb63397a987c5ce2e8abc80fe3f8a0959e1ca0ad3c0dbc.png" alt="picture 8" class="img_vXGZ"></p><p>从音频格式来看，除了<code>aac</code>格式不支持，其他常用的例如<code>mp3, wav, m4a</code>都支持了，所以还是挺广泛的。</p><p>但是每次手动调用程序去转写一个音频文件，未免还是感觉有点麻烦，尤其是对于程序员来说。</p><p>比如现在我们转写一个音频文件，需要在命令行执行如下命令：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token operator" style="color:#393A34">~</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mark_keeps_learning</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mark_scripts</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">voice2srt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py 目标音频文件路径</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然我们也可以使用<code>alias</code>手段，把这一串命令缩短成一个词，以方便我们直接使用<code>voice2srt 目标音频文件路径</code> 的命令完成目标，但还是要基于命令行，多有不便。</p><p>主要是，我们也不需要修改其他参数（基本按照默认即可，热词已经在讯飞官网配好了）。</p><p>那么这种纯粹基于文件的操作，在 mac 平台上最好的办法是写一个<code>automator</code>脚本：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652532742053-608328c5fa3dc43bb127e4acf67d24ca3a9b96c3dc785f182745c4301b002348.png" alt="picture 7" class="img_vXGZ"></p><p>这样我们就可以直接在 finder 里面右键我们的音频文件，然后在快捷菜单中找到我们的 automator 脚本选项，鼠标一点就自动转成了，非常方便！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533417457-750a70456486d620a0f3e313e6e431fbe6530aa99aa51b04b6899cb39f4defa9.png" alt="picture 9" class="img_vXGZ"></p><p>十秒钟之后，就自动在当前文件夹内生成一个讯飞转写后的字幕文件了，非常方便：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533472130-84eedb0ba0b9f481f2ae1d09fffb8d14c58ff3543e83d8225237eed6627be5f3.png" alt="picture 10" class="img_vXGZ"></p><p>并且我将标准输出重定位到了根目录的 log 文件，这样就可以在程序出错时复查：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533562489-e40a4b0b90122321cf4ca18cc2a9ffdf12deaa944aa86ca2cc3fcc421d5809e7.png" alt="picture 11" class="img_vXGZ"></p><p>Automator 是一个很有用的工具，我也对它越来越感兴趣了，比如说还写了一个网易云音乐 ncm 转 mp3 的快捷操作，这样右键一个 ncm 文件，就能转成 mp3 了，非常方便。</p><p>但愿本文对你有帮助~</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/字幕">字幕</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/03/09/dev-douban-renting">编程 | 北京租房系统设计、研究与经验 0.1.0</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-03-09T00:00:00.000Z" itemprop="datePublished">2022/03/09</time> · <!-- -->阅读需 66 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>通过一天使用程序化手段获取两万多套房源转租信息，继而再通过程序化粗筛成两百多套，紧接着人工细筛出十几套，最后两天内实地考察九套。</p><p>在北京快速的、低成本的找房，我是如何做到的，我又有什么经验心得与启示，这是本文所要阐述的。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="个人背景概要">个人背景概要<a class="hash-link" href="#个人背景概要" title="标题的直接链接">​</a></h2><p>大学实习基本都是在上海，租过远到嘉定每天来回四小时的自如、租过虹口差点要不回钱的蛋壳，租过和别人同睡一张床第二天赶紧溜走连押金都不想要的复旦老破小，租过闵大荒开始闹到威胁后续被窗外幼儿园治愈的公寓式开间，也为把项目做好租过浦东近万的酒店。</p><p>所以租房，尤其是在一线租房，确实是个头疼的问题。</p><p>现在，作为一名北漂狗，是时候认真研究一下了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="租房方案设计">租房方案设计<a class="hash-link" href="#租房方案设计" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="个人需求分析">个人需求分析<a class="hash-link" href="#个人需求分析" title="标题的直接链接">​</a></h3><p>在每个人讨论租房这个问题之前，第一个就是个人需求的剖析。</p><p>就我接触下来，99%的人对价格还是相对敏感的，在此基础之上， 有些人更重视通勤时间（比如我），有些人更重视独卫的便利性（比如某互联网男生），有些人更重视卫生条件（某金融业女生）。</p><p>而预算方面也会因为因人而异，有预算 2000 的，3000 的，4000 的，甚至 6000 的，等等。</p><p>因此从需求、预算角度，每个人所适合的策略就不太一样。</p><p><strong>本文主要介绍的是汇总租房帖然后逐步筛选的方案，理论上适合一切找房群体，同时更适合希望较低成本找房的朋友</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="公寓-vs-民宅">公寓 vs 民宅<a class="hash-link" href="#公寓-vs-民宅" title="标题的直接链接">​</a></h3><p>我过往的经历，应该来说，住公寓与酒店比较多，现在的年轻人应该大多都是这样。</p><p>公寓也并非不好，尤其是身边同学或者朋友一起住青年公寓那种，就特有氛围。</p><p>但如果是长租，以下问题就不能忽视：</p><ol><li>首先是价格方面，同面积情况下，公寓普遍租金更高，另外商水商电大概是民水民电费用的三倍左右，比如夏天可能开着空调，民水民电的民宅花 150，但公寓就可能是 450，当然这个估算可能不准确，也因人而异</li><li>公寓由于自建等原因，隔音效果普遍不是很好，如果喜欢安静的一定要注意这一点</li><li>公寓往往缺少家的感觉</li></ol><p>如果你能容忍或者确认以上几点，那就很适合选住公寓，因为公寓的配套设施一般更完善，比如自习室、健身房、大厅，甚至食堂等等。</p><p>总之，考虑到我的个人经历与接下来的规划，我就没有考虑公寓了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上-vs-线下">线上 vs 线下<a class="hash-link" href="#线上-vs-线下" title="标题的直接链接">​</a></h3><p>租房大致分纯线上、线上转线下与纯线下三种方式。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="纯线下方案">纯线下方案<a class="hash-link" href="#纯线下方案" title="标题的直接链接">​</a></h4><p>首先讲一下纯线下，如果你是经济非常紧张、对居住环境不是很重视，同时社交能力较强（或长的比较友好），希望以最低成本租房的，根据一些文章指出，你可以线下走街串巷，多和低收入人群（保安、清洁工等等）聊一聊，他们通常能给你非常具有性价比的推荐。</p><p>我虽然没有通过这种方式找房，但我确实曾经在拉萨坐人力拉车时和车夫聊过，他就住在大昭寺附近，一个月印象中好像是 300（也有可能是 600）的房子，总之，是很低了，即使我们住青旅，也要三四十一天，一个月下来也是近千的。</p><p>其实吧，我觉得纯线下的最主要条件，还是你要能来事，理论上不单单是光和低收入人群聊，你有能耐的话，也可以和包租婆聊，说不定更能找到非常具有吸引力的房源，对不~</p><p>但对于北漂狗来说，纯线下方案并不是那么容易操作。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="纯线上方案">纯线上方案<a class="hash-link" href="#纯线上方案" title="标题的直接链接">​</a></h4><p>接着是纯线上方案，这个方案，应该是很多学生党比较喜欢的方式，照片视频一看，或者根据平台品牌，一下就入了。</p><p>我便是这么走过来的。我甚至是线上看好后，直接拖着箱子再去看房的，这绝对是大忌！</p><p>当然这也不是不行，比如嫌麻烦与不缺钱，就可以无脑 all in 自如（公寓相关的分析接下来章节会说），至少能保证下限。</p><p>但如果你想选民宅的话，纯线上的最大挑战，是要有足够的鉴别能力。比如某中介在朋友圈发了某套房的房源信息，一般是位置加文字加图片，你需要第一时间能够识别出信息的真实度如何，另外，同步查询这个小区的相关信息：小区建成于什么年代、附近的设施情况如何等等。</p><p>而在你未曾亲自线下跑楼之前，你其实对这些都没什么太大概念，比如什么是筒子楼、什么叫隔断、什么是团结户等等。</p><p>不过一旦你对这些概念逐步熟悉之后，看房，尤其是看中介与平台的线上房源，心中就会相对有数了，也就是说，至少不太容易出现预期差太多的情况了。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="线上转线下方案">线上转线下方案<a class="hash-link" href="#线上转线下方案" title="标题的直接链接">​</a></h4><p>相对来说，先在线上看够足够多的房源，再精挑几个去线下调研，应该是最好的。</p><p>这里，有两点，第一点就是尽量以正常通勤工具去看房，你不能因为远或者啥的去打车看房，毕竟你是来租房通勤用的，你必须还原你的真实使用场景去体会这是不是你想要的，所以从我的感受来看，离地铁超过 1 公里的房我就不会要了，走路实在需要太久。</p><p>第二点，就是怎么说呢，并不需要刻意排斥中介。</p><p>是，中介这个职业，总让人爱恨交加，尤其是碰到就为了多坑点你钱的，我也碰到过，并且不少。但别人也确实给你提供了一定帮助，或者说，insight。</p><p>你得明白整个租房市场是怎么回事，在一线城市，绝大多数租房都是相对饱和的，好的、性价比高的房子确实很抢手，比如在国贸上班的金融白领们租房一般就是围绕这一块，相应的就会有中介专门负责这几块小区的生意，一旦有一个房间空出来就会立马挂出来，然后数个中介就能找到数个客户对该房源感兴趣。</p><p>如果你排斥中介，拒绝接受中介，你怎么能获得这些房源信息？并不是所有人都会在豆瓣、咸鱼发帖转租什么的，所以中介仍旧是找房的一个重要途径，关键是看你怎么用。</p><p>我的看法是，不要只 follow 一个中介，你可以多加几个中介，综合他们的 insight，最终逐渐形成你的租房目标。但所谓的多加，也不是随便加，一定是你目标区域内的中介才是有效的，因此如何加到你目标区域内尽可能多的中介，依旧需要我们后续所用到的技术。</p><p>再总结一下，不需要排斥中介，但也不要随意加中介，如果碰到目标区域内的中介，不妨加了多和他们聊聊，可以更快地帮你熟悉目标区域。最重要的是，不要拖着箱子，然后坦诚地、大方地线下去走走，实地看看。说不定想去看的某套是不符合期望的，但其他套却很吸引你，这也是可能的。</p><p>当然，中介有风险，后面也会讲一些中介的平常套路。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上平台选择">线上平台选择<a class="hash-link" href="#线上平台选择" title="标题的直接链接">​</a></h3><p>现在其实有很多租房的平台，比如微信、豆瓣小组、咸鱼、小红书、贝壳找房、链家、58、安居客、自如、泊寓等等。</p><p>其中，个人房源主要集中在微信、豆瓣小组、咸鱼、58 等平台上，贝壳找房我试了试房源基本对接的自如的。这其中，58 和安居客据说假房源特别多，所以也未在我选择之列。咸鱼和小红书是我后来才知道的，但不在本次找房所使用工具之类。</p><p>本次找房主要使用的是微信和豆瓣小组，其实主要是豆瓣小组，微信的租房群也是通过豆瓣才找到的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总体设计">总体设计<a class="hash-link" href="#总体设计" title="标题的直接链接">​</a></h3><div class="language-mermaid codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-mermaid codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">flowchart TB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subgraph day1[Day 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">direction TB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subgraph platforms[租房平台]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        douban[豆瓣小组-北京租房]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --&gt; wechat[微信群聊-北京租房]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    douban</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 爬虫 --&gt; input[2w+近期租房条目数据]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wechat -- 表格 --&gt; input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input -- 清洗 --&gt; washed[100+符合基本条件的租房条目数据]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 一一标记确认 --&gt; marked[10+候选租房目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subgraph day2[Day 2-3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    marked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 微信逐个联系 --&gt; connected[&lt;10个线下考察目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 线下考察 --&gt; favorite[1-3个最终候选]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 抉择 --&gt; final[1个最终目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="租房前期准备">租房前期准备<a class="hash-link" href="#租房前期准备" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解行政区域规划">了解行政区域规划<a class="hash-link" href="#了解行政区域规划" title="标题的直接链接">​</a></h3><p>访问 <a href="https://www.zhihu.com/question/26731387" target="_blank" rel="noopener noreferrer">有没有一种电子地图，可显示详细的行政区域边界 ？ - 知乎</a> 可以很方便地查看行政区域规划地图，例如北京的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646042680293-b001d7afd4943a6e57041a22a615e5db3bba163a70866a5c2b8e22154ce68c91.png" alt="picture 1" class="img_vXGZ"></p><p>我也是第一次看行政区域地图，一一审查他们的区号发现还挺有规律，核心第一圈东西城区 01 和 02，接着第二圈从朝阳开始顺时针——朝阳（05）、丰台（06）、石景山（07）、海淀（08），接着第三圈从房山开始逆时针——房山（11）、通州（12）、顺义（13）、昌平（14），最后第四圈有点杂乱但整体依旧是逆时针：大兴（15）、怀柔（16）、平谷（17）、密云（18）、延庆（19）。</p><p>了解行政区划的目的，主要是分清自己大概会租什么位置的房子，因为现在大多数租房软件都会提供基于行政区划与地铁等多种筛选方式，也许地铁比行政区域更重要一些，但提前了解一下行政区域也会有一个比较重要的区位概念。</p><p>至少，我了解下来，断定，我大概会在朝阳与丰台这两个区之间做选择，这是比较重要的信息。也就是说，后续看到转租帖，不是这两个区的基本都可以 pass 了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解地铁线路规划">了解地铁线路规划<a class="hash-link" href="#了解地铁线路规划" title="标题的直接链接">​</a></h3><p>从我的角度，行政区域对自己的实际参考意义并不大，作为北漂狗，最重要的依据还是地铁，谁能把握住地铁的脉络，谁就能把握住性价比的尾巴。</p><p>所以首先找一张地铁线路图，这个随便一搜就能找到，比如这是百度地图里的北京地铁图：<a href="https://map.baidu.com/@12964228,4821466,13z" target="_blank" rel="noopener noreferrer">北京市地铁图 - 百度地图</a></p><p>由于公司在四惠南边，所以我从四惠站出发，沿各个方向延伸七站左右，其中遇到换乘加算一站。（七站大概是半小时）</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646439758370-c9709e7459acccd134efbdcd75ae097f557ce607223c072ea906e13f7d56c31c.png" alt="picture 1" class="img_vXGZ"></p><p>如此来看，其实我的可选范围还是挺多的，整个北京东南方向的一大块都包括了。</p><p>但为了控制成本，我特意标记了地铁外环的几个拐角，直觉上这里价格会略低些：</p><ol><li>百子湾，位于 7 号线拐角，同时也是离公司最近的侯选处，可以步行上班</li><li>北工大西门，位于 14 号线拐角，这里的最大优势是可以直达望京</li><li>分钟寺与成寿寺，位于 10 号线上，这两个地方是某北漂朋友推荐的地儿，确实便宜</li><li>青年路，6 号线，正好在环外，旁边就是朝阳公园</li><li>通州北苑，低处通州区，价格更低，旁边还有万达广场</li></ol><p>这几个锚定的区域都需要重点观察。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解周遭小区分布">了解周遭小区分布<a class="hash-link" href="#了解周遭小区分布" title="标题的直接链接">​</a></h3><p>我们可以在 <a href="https://map.lianjia.com/map/110000/ESF" target="_blank" rel="noopener noreferrer">北京地图找房<em>北京小区地图</em>北京房产地图(北京链家)</a> 简单看到大部分小区的分布情况，例如定位到我司附近的百子湾小区：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646616950694-d0638ca5546f123f967191de4f05b4dc2150e859c4a739c13f751e8bc4c05ec5.png" alt="picture 2" class="img_vXGZ"></p><p>再点击一次可以看到具体到每个小区的情况，下面部分有一大块的空白看样子是商区（不确定）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646616997536-91182e25417bd9bb8aedf65b1a78970868219ee4c5d7b84c93ed4469bbbaabb6.png" alt="picture 3" class="img_vXGZ"></p><p>由于我司位于源创空间大厦，离周围的地铁都比较远，步行距离接近 2 公里（通勤时间可以以步行的 10 分钟/公里计算），因此光是从最近的地铁站步行到公司都要花 20 分钟，所以在租房时要考虑这个问题。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646620679319-1651e3b2677652a26cd35557358018cb66cf2487a19d110410f4f89fb0ba5b3c.png" alt="picture 5" class="img_vXGZ"></p><p>具体地说，如果我的通勤时间要控制在半小时以内，那么大概率远距离的长地铁方案就要 GG 了。（长地铁方案：选择离公司较远、离地铁较近、具有较高性价比租房的方案）比如以我司以及周围的三/四个地铁站为中心，附近有数个小区（高德地图，链家看起来太费劲了，且不全）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646623707128-38cbad4291bfbf319eb81efa360e5cfb2d716cb4d1fd4bd8187a44dab56d3a12.png" alt="picture 6" class="img_vXGZ"></p><p>这些小区中，最优先考虑的应该是在四惠东、四惠、大郊亭、百子湾（逆时针）这几个地铁站之间的小区：金海国际、金都杭城、沿海赛洛城和百子湾家园。其中金海国际可能地铁位置最优（仅次于九龙山附近的珠江帝景）但最贵（二手房价格 6w+），沿海赛洛城性价比最高（离地铁次近，二手房价格 4w+），金都杭城与百子湾家园离地铁更远。</p><p>其次就是四惠河北部的惠民园、东恒时代、十里堡等。</p><p>最后是其他地区，例如大郊亭左边的后现代城、百子湾下面的光华新城、百子湾右边的燕宝保湾家园、四惠东右下角的西店村等。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="小区的选择依据">小区的选择依据<a class="hash-link" href="#小区的选择依据" title="标题的直接链接">​</a></h3><p>个人认为，无论预算是否充沛，最终是否直接选择离公司最近的小区，适当地过一遍周遭小区还是比较重要的，因为你选择这里的概率会比较大。</p><p>但并非必须选项，因为我们往往会考虑地铁沿线更远的区域，尤其是在我们把通勤时间放宽到一小时、公司本身离地铁也很近、最后一公里选择骑车而非步行等前提下。</p><p>但这样，我们就需要看<a href="#%E4%BA%86%E8%A7%A3%E5%9C%B0%E9%93%81%E7%BA%BF%E8%B7%AF%E8%A7%84%E5%88%92">了解地铁线路规划</a>中所圈点的更多地铁站旁边的更多小区，工作量指数级上升。</p><p>因此，关于其他小区的通勤距离这部分，我倾向于通过程序计算，找到后再单独看~</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房条目的数据获取">豆瓣小组租房条目的数据获取<a class="hash-link" href="#豆瓣小组租房条目的数据获取" title="标题的直接链接">​</a></h2><p>基于我们在<a href="#%E5%B9%B3%E5%8F%B0%E9%80%89%E6%8B%A9">平台选择</a>中的分析，豆瓣小组是本文的重点考察对象（后续可能会考虑再加入闲鱼，据说个人房源信息也不错）。</p><p>另外，至少有两种获取豆瓣小组租房信息的方式，一种是基于网络流传的 API，一种是基于我们自己的爬虫。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房信息获取的目标设计">豆瓣小组租房信息获取的目标设计<a class="hash-link" href="#豆瓣小组租房信息获取的目标设计" title="标题的直接链接">​</a></h3><ol><li>支持搜索小组名以获得所有相关的小组<ol><li>例如：“北京租房”</li><li>豆瓣支持小组名字相同，所以其实会有很多个同名小组</li><li>为了信息的完整性，我们最好捕捉所有符合要求的小组，然后一一进行处理</li></ol></li><li>支持基于小组名（实际是 id）获得该小组下的所有话题</li><li>基于话题的标题，进行地名提取与位置确认，进行转租筛选</li><li>支持基于话题再获得话题下的图片与文字<ol><li>如果有了图片，是很方便可以做一些可视化网站的，势必会比较方便</li><li>另外也可以做筛选，你说对方要把房子租出去，结果图都不晒一张，这合适吗，这不合适，这能要吗，这肯定不能要</li><li>尽管势必会有大量照骗党，杀猪磨盘，但是也不能因为这个而畏惧呢</li></ol></li><li>其他</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组-api-方案之分析与准备">豆瓣小组 API 方案之分析与准备<a class="hash-link" href="#豆瓣小组-api-方案之分析与准备" title="标题的直接链接">​</a></h3><p>之前就听说国内电影体系都是靠豆瓣的 api，因此首先就是先谷歌一下“豆瓣 api”，结果发现果然有 <a href="https://www.doubanapi.com/" target="_blank" rel="noopener noreferrer">豆瓣 Api V2（测试版） | doubanapi</a>，注意这两个 api_key，我一开始表示怀疑，后来发现竟然真能用……</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">0df993c66c0c636e29ecbb5344252a4a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b2bdeda43b5688921839c8ecb20399b</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069015501-f3babe3e1f58f4114ac50bf658a3da52d79e200b28b72ced5c3076d1fe45edd5.png" alt="picture 6" class="img_vXGZ"></p><p>但这个网页其实没有提供豆瓣小组的 api，于是我们继续搜索豆瓣小组是否有 api 的信息 <a href="https://www.zhihu.com/question/19889922" target="_blank" rel="noopener noreferrer">豆瓣小组是否提供 API？ - 知乎</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069095482-cd7bde3bddd77cf5f4c62e6e81840d8fb51af0ffafb4d482264517946f766c0d.png" alt="picture 8" class="img_vXGZ"></p><p>有几个有趣的回答，第一个给出了 api 地址与形式，并且附送了一个链接：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069147214-a4f1aa82861ed7aaecfc5ab9288b7fecb49b93b375fc6f684769dd5983c4b856.png" alt="picture 9" class="img_vXGZ"></p><p>不过这个所谓的”出处“链接到很有意思，是 2012 年的，最关键的是，打开后一闪而过，倒也没那么快，大概一秒钟之后跳转到了新的页面，看最后一个网址就知道，是被重定位了。</p><p>刚刚是手快，截了一下，但是光截图看不到后面的内容，而想中途拉动又不可能。</p><p>这个时候，抓包神器的作用就体现了，所有网页加载都有记录，直接把 html 文件导出，再在本地打开，就发现全出来了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069414627-ac205b0b2a3e63c2d70881af9db7713beaf7a6acbc183a13ff3bfc6e73b575d3.png" alt="picture 13" class="img_vXGZ"></p><p>最有意思的是，这个帖子似乎是有两个“小黑客”在尝试破译豆瓣的接口，好吧，也就是我正在做的事了。</p><p>读下来饶有味道：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069515981-f924e7f446421c41878794949b567c207dab0d410a2e8f57dc20317bc26ca0e0.png" alt="picture 14" class="img_vXGZ"></p><p>不过他们所描述的获取 access_token 的形式，我也不清楚豆瓣是怎么想的，可能他们同时有两套接口吧，一套 oauth2，一套 api_key。总之，我们目前应该是不需要 access_token 的，直接用 api_key 就可以，并且是固定的。</p><p>比如按照上面的截图，获取豆瓣小组里话题列表的 api 是<code>https://api.douban.com/v2/group/${GROUP_NAME}/topics</code>，例如：<code>https://api.douban.com/v2/group/husttgeek/topics</code>，这个时候如果我们在浏览器中直接打开这个网址，会遇到缺少 api_key 的警告：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069782706-7895041f12fbe4b18f9ee659be5f9a4fe6ae923807f0c070d73c32550a3abf33.png" alt="picture 15" class="img_vXGZ"></p><p>这不，我们一开始搜的豆瓣 api 就有用了吗，把那个 api，比如<code>0df993c66c0c636e29ecbb5344252a4a</code>复制过来，拼接到网址上去，重新访问，结果就有了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069859534-e798528b3ca706fde7d6b4c1e0736d259c35d77969cd40a7810b6bdee936a845.png" alt="picture 16" class="img_vXGZ"></p><p>得来全不费工夫！</p><p>至此，其实我们的思路已经大致确定了，不过那个知乎帖子下面还有两个 git 项目，其中一个是监控小组的，倒是确有一点意义，可供闲暇参考，分别罗列如下：</p><ul><li><a href="https://github.com/yaodi833/rental_house_douban" target="_blank" rel="noopener noreferrer">yaodi833/rental_house_douban: 本项目基于（非公开）豆瓣 api，实时监控多个豆瓣租房小组发布租房信息，并支持小组订制，关键词订制，邮件推送等功能</a></li><li><a href="https://gist.github.com/iamsk/1bc0760dfeeeb950f18e" target="_blank" rel="noopener noreferrer">doubangroupapi</a></li></ul><p>基于以上分析，可见，豆瓣的 api 还是比较稳定可用的，否则该失效早失效了。</p><p>不过有些东西还差一点。其中，我们目前只知道第二点（罗列话题）与第四点（获取话题内容）应该是有了现成的 api，而第一点（搜索小组）则没有，需要我们自己破解。另外第三点是我们后续的算法部分，与豆瓣 api 无关，故暂且可以先不谈。</p><blockquote><p>豆瓣小组 API 方案之如何获取搜索小组的 API</p></blockquote><p>按照直觉，我们可以通过对比正常访问的网页地址与已经明确了的 api 之间的关系，得到 $f(x) = y$，然后再把这个 $f$ 作用到正常搜索网页的网址上去。</p><p>我们先试试。</p><p>但是很快我发现搜索接口是比较独立的，是一个集中式的接口，和那些分别对应的不太一样。</p><p>紧接着我又意识到，其实这么多小组，取前几个就已经比较够了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646074421380-f0780837200fe37fca1e9afb372a7bca1320e805c7dd6730ccd6eed4add691a0.png" alt="picture 17" class="img_vXGZ"></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">function getGroups() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    curl https://www.douban.com/search\?q\=$1 2&gt; /dev/null \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | grep -E &quot;小组.*&lt;a href&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | gsed -E &quot;s/.*group%2F(.*?)%2F.*/\1/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样我们就得到了豆瓣小组的前几个小组的 id，例如：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646074500899-e2a15145ced09f9749a69989d26e2156bf8958d2d5f78adbdd550f752fd5cc08.png" alt="picture 18" class="img_vXGZ"></p><p>这样，我们的第一步就也痛了，于是乎，第一步获取小组 id 列表，第二步获取小组内的主题，第四步获取小组主题内容，这几步都没有技术上的问题了，接下来就是写程序，以及加上第三步算法部分。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组-api-方案之设计与实现">豆瓣小组 API 方案之设计与实现<a class="hash-link" href="#豆瓣小组-api-方案之设计与实现" title="标题的直接链接">​</a></h3><p>可以直接访问 <code>https://api.douban.com/v2/group/beijingzufang/topics?apikey=0df993c66c0c636e29ecbb5344252a4a</code> 获取 demo 结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646644258095-3634cb35cb1b70e95cb77450a2e48ea9636d06dbcf5789fdb02cdbe5c19567fc.png" alt="picture 2" class="img_vXGZ"></p><p>基于这个返回结果，可设计数据结构如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Author</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_suicide</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avatar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># UserType</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    large_avatar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Dimension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Photo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dimension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seq_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_private</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    liked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    like_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comment_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    share_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    photos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Photo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopicResultSuccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    请求成功时的结构体</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 0 - 100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># default: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopicResultFailure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    当请求失败时，就会返回这个结构体</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;access_error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 403</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    localized_message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有了 apikey 可以直接调用 api，获取 json 结果，然后解析，因此本过程省略，以下主要记录一下核心续爬代码：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_get_topics_of_group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> limit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">403</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finished_reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;此请求已触及该apikey&lt;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">_apikey</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&gt;限制&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> item </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;topics&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;start&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;count&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;total&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finished_reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;不容易，所有数据已全部提取完毕&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;finished, reason: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> finished_reason</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组爬虫方案之设计与实现">豆瓣小组爬虫方案之设计与实现<a class="hash-link" href="#豆瓣小组爬虫方案之设计与实现" title="标题的直接链接">​</a></h3><p>豆瓣的前端页面并不复杂，就是一个传统的 table 结构，按序解析即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646637351707-b2675d6892f4102387b6588f435516597ca8711072a5e22543218683452c6c05.png" alt="picture 1" class="img_vXGZ"></p><p>豆瓣小组的特定小组内条目的字段主要有：<code>讨论 | 作者 | 回应 | 最后回应</code>四个基本字段，相应的在程序设计中我编码成了六个字段：<code>post_title | post_url | author_name | author_url | response_count | response_latest_time</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646635247259-62e1f827aaf997bd418f03538e9fe955b1fd5f371ab15ccbe1e47eeb05999b8e.png" alt="picture 7" class="img_vXGZ"></p><p>有一个问题，是关于多个小组的，由于豆瓣小组针对某一话题会有多个不同的小组，甚至名字相同（但 id 唯一），这就导致需要我们对每个小组分别进行数据提取。有一种办法可以避免这样，那就是集中采集 <a href="https://www.douban.com/group/" target="_blank" rel="noopener noreferrer">我的小组讨论</a>页面。</p><p>比如，我所有的小组都是关于租房的，一共有三个小组：<code>北京租房 | 北京无中介租房 | 北京租房房东联盟（中介勿扰）</code>，因此这个页面就是这些小组里所有最新的帖子情况。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646635533016-b6ae0771f901dd12faed61e6d68875d1deb95c60645d5ccc84f7dda033394837.png" alt="picture 8" class="img_vXGZ"></p><p>但这种办法的缺点有二，一个是你要主动过滤非租房相关的小组，另一个就是不支持提供发帖者相关的信息，这在筛选上，缺失了一个比较有用的维度（不过其实我并没有使用这个维度）。</p><p>于是，基于特定小组的话题列表的字段设计如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Topic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_latest_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TopicColumns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;response_latest_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;post_title&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;post_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;author_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;author_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;response_count&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接使用 python 的爬虫基操（<code>requests + beautifulsoup4</code>）即可，核心解析代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> soup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;#content .article tr&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(1) a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;title&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(1) a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;href&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(2) a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;href&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(2) a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(3)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;td:nth-of-type(4)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;20&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datetime_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># test if it&#x27;s year of 20XX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        datetime_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">now</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">year</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">-</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_str</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_latest_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strptime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datetime_str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%Y-%m-%d %H:%M&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> Topic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">post_title</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> post_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">post_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">author_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                author_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">author_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response_count</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">response_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response_latest_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">response_latest_time</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房条目的数据分析">豆瓣小组租房条目的数据分析<a class="hash-link" href="#豆瓣小组租房条目的数据分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="筛选条件分析">筛选条件分析<a class="hash-link" href="#筛选条件分析" title="标题的直接链接">​</a></h3><p>在获取到豆瓣租房的目标条目之后，第一步要做的就是程序化筛选。</p><p>目前使用的可供筛选的组合条件如下：</p><ul><li>（推荐）发布日期在近十日之内（好房子一般都会较快被租出，因此过长还未租出的房子不值得一看，N 目前可设置为 7 或者 10，是一个比较合理的值）</li><li>（推荐）如果是男生求租，标题中带“女生”、“限女”等字样的一般不予考虑，并且此类房间不在少数</li><li>（参考）基于一些简单规则提取标题中的价格信息，例如“3000”或者“3 千”等，如果匹配上，便使用预设的价格区间进行筛选</li><li>（参考）对评论数进行筛选，评论数一定程度上代表着房源的质量，或发帖者的积极性（有些发帖者会自己给自己顶帖，说明不是中介），因此筛选评论数大于 0 是非常有意义的，但需要谨慎，因为有很多帖子评论数为 0 但房源确实是有效的</li><li>（参考）继续下爬发帖者的个人信息，鉴定其豆瓣的活跃度，以筛选出非中介的发帖者，但这个就涉及到二级页面的爬取，是一个比较大的开销，需要平衡是否有必要</li><li>（参考）由于帖子的标题比较个性化，小区名、地铁线路信息、行政区域信息等的曝光度均不同，因此基于正向筛选有可能会误杀一些帖子（例如以标题中存在朝阳二字筛选帖子，就有可能把只写了朝阳内部小区名字的帖子给误过滤掉），与此相比反向筛选比较有效（例如如果标题中出现了大兴二字，一般就肯定不是朝阳区域的房源）</li><li>（推荐）本项目最有意思的一点是做了智能测距筛选，具体做法就是将豆瓣标题信息喂给高德的区位编码 api 得到经纬度，再结合目标公司经纬度使用高德的线路规划 api 算出通勤时间，然后再进行筛选，该解决方案应该是目前网络上独一份，实际使用下来，也许有误杀，但很有效。</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-之申请-key-配置">高德 API 之申请 Key 配置<a class="hash-link" href="#高德-api-之申请-key-配置" title="标题的直接链接">​</a></h3><p>访问 <code>https://console.amap.com/dev/user/permission/authenticate/person</code> 基于支付宝实名认证申请 key：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230621370-8e2266b9ff7e8ae36a3ea31057a1e1ced330b6dec2dd177fc03103ef979b4c41.png" alt="picture 1" class="img_vXGZ"></p><p>很快，认证成功：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230728166-e6eac393225fbb258d38f3bd15ec765cdc5c21d207d055e3e4b4be8af345347e.png" alt="picture 2" class="img_vXGZ"></p><p>创建一个 key:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646236116312-8c6441396a6cf4bbbb00be0cb9a0bc1b1a6404dd3bea04ea196ccef0ded3888f.png" alt="picture 4" class="img_vXGZ"></p><p>获得 key：<code>33e2719dbfXXXXXXXX1b2e6786052</code></p><p>最后再看一下服务配额：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230812661-489a0477c092e063fb341624a4dcdd16a23746e3b9d336e1bc81564ae095e8db.png" alt="picture 3" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-调用之地理编码与逆地理编码">高德 API 调用之地理编码与逆地理编码<a class="hash-link" href="#高德-api-调用之地理编码与逆地理编码" title="标题的直接链接">​</a></h3><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/georegeo#geo" target="_blank" rel="noopener noreferrer">地理/逆地理编码-API 文档-开发指南-Web 服务 API | 高德地图 API</a> 可以知道，高德地理编码就是将地址文本转成经纬度。而后续的比如说查询两个点之间的通勤距离都是基于经纬度的，因此地理编码 api 非常重要。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646663384858-3009c4fcd2cc161deb9d658141155664cf851d0516e307136276acf599deb7b0.png" alt="picture 3" class="img_vXGZ"></p><p>重点参数是 <code>address</code>，即输入的地址。尽管 api 介绍说是一个结构化地址信息，但实际经过我的测试，一个非结构化的但包含地址的句子也是可以的，高德比较智能，会提取出它认为最有可能的地址，这个非常有用！因为允许我们将豆瓣帖子标题直接喂进地理编码而不需要预先提取出地理信息，这让我原先设想的基于 jieba 分词并多次调用高德 api 进行测试的复杂、低效、高耗方案变得不再需要！</p><p>第二个重要参数是<code>city</code>，我们只需要指定为<code>北京</code>，这样便免去了全国搜索，速度更快准确度更高。</p><p>第三个重要参数是<code>batch</code>，这个允许我们在一次 api 调用里同时返回多个关键字的搜索结果，这或许可以大幅降低我们的 api 开销，因为高德 api 有额度限制（但我不确定最终计算时，是以单词算，还是 N 次算，我暂时没用）</p><hr><p>同样，参考 <a href="https://lbs.amap.com/api/webservice/guide/api/georegeo#regeo" target="_blank" rel="noopener noreferrer">地理/逆地理编码-API 文档-开发指南-Web 服务 API | 高德地图 API</a> 我们可以知道逆地理编码就是从经纬度得到结构化地址。</p><p>但值得注意的是，地理编码与逆地理编码之间的输入输出并不完全互逆，因为输入的地理信息也许是非标准化的地址，但输出的逆地理编码信息一定是高德内部标准化的。</p><p>这个 api，可以用，也可以不用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-调用之公线路规划与步行规划">高德 API 调用之公线路规划与步行规划<a class="hash-link" href="#高德-api-调用之公线路规划与步行规划" title="标题的直接链接">​</a></h3><p>在同城通勤线路规划中，我们主要用公交地铁线路规划（长距离），或者步行规划（短距离）。</p><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/direction#bus" target="_blank" rel="noopener noreferrer">路径规划-API 文档-开发指南-Web 服务 API|高德地图 API</a> 可以知道公交路径规划的实际含义是<code>transit/integrated</code>，也就是综合了各类公共（火车、公交、地铁）交通方式的通勤方案。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646664403794-18935acd99bfc9137a34d5e208c8f25f12d681b528371e7a58e4b01164ca63f0.png" alt="picture 4" class="img_vXGZ"></p><p>因此，这个 api 就是我们在手机高德地图里最常用的导航方案之一，基于公交、地铁、步行的灵活规划。其中<code>origin</code>和<code>destination</code>是出发地和目的地的经纬度，这个可以通过我们之前说的地理编码 api 获得，city 依旧和之前的 city 保持一致即可（比如：北京）。值得注意的是<code>strategy</code>参数，我个人倾向于使用<code>3：最少步行模式</code>，也许也会有人倾向于使用<code>1：最经济模式</code> 或者 <code>0：最快捷模式</code>，这个因人而异。</p><p>而我们最关心的输出则是里面的<code>duration</code>字段，它是我们通勤方案所需要的秒数，我们将基于这个进行地点筛选。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666336508-39ff1c9464c7afd16b7973b6c4cbc8ae6f2e6fc9a1d63ffa62a2eb2e37a23b2a.png" alt="picture 5" class="img_vXGZ"></p><hr><p>但仅通过公交线路规划是不够的，因为如果出发地和目的地距离很近（例如不超过一站），则会没有结果，此时就需要使用步行规划接口。</p><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/direction#walk" target="_blank" rel="noopener noreferrer">路径规划-API 文档-开发指南-Web 服务 API|高德地图 API</a> ，我们只需要输入起始地和目的地的经纬度即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666508845-8a7fae2f2f3c84f2da90243b3897cc1a7a43042a02a7176ad315776659a725c0.png" alt="picture 6" class="img_vXGZ"></p><p>结果里依旧只需要提取<code>duration</code>字段，单位还是秒。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666555658-15a4764c18044c987c8b7e3b1fcefef6caee19597b5cf68516de5a8034b36a8f.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-封装设计与实现">高德 API 封装设计与实现<a class="hash-link" href="#高德-api-封装设计与实现" title="标题的直接链接">​</a></h3><p>理清我们需要的输入与输出。</p><p>我们通过豆瓣的 API 或者爬虫可以获得 N 条租房帖条目，其中包括标题，但是不包括具体地址，我们需要通过标题知道这个帖子是否符合自己的通勤目标。</p><ol><li>将标题直接喂入高德地理编码 api，得到经纬度 A1</li><li>将经纬度 A1 与提前算好的目的地（公司）的经纬度 A2 同时喂进公交路径规划<ol><li>如果公交路径规划有结果，则选取第一条；否则再将 A1、A2 喂进步行路径规划</li><li>如果步行路径规划有结果，则选第一条；否则报错、丢弃（推荐）或者人工审查</li></ol></li><li>基于算好的通勤时间进行筛选，例如控制在 30 分钟以内或者 60 分钟以内，因人而异</li></ol><p>由于每个高德 api 都需要 key，因此可以使用<code>requests.Session</code>直接预先设置好固定的 key 参数。</p><p>设计如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XXXXXXXXXXX&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CITY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;北京&quot;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 地理编码更快</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STRATEGY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 步行距离最短方案</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置全局字典，减少高德调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADDR_NAME2LOC_DICT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 地理编码全局字典</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DURATION_DICT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 计算两个经纬度之间的距离，统一用&quot;-&quot;拼接成字符串，方便序列化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;key&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用地理编码api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    使用全局字典减少高德api调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> addr_name </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://restapi.amap.com/v3/geocode/geo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;city&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;count&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 不报错，但是赋值为空</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;geocodes&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;location&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用步行路径规划api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_get_walking_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://restapi.amap.com/v3/direction/walking&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token string" style="color:#e3116c">&quot;origin&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token string" style="color:#e3116c">&quot;destination&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;count&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 用一个不可能的值表示没有找到任何规划</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;route&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;paths&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;duration&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用公交路径规划api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_get_transit_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;https://restapi.amap.com/v3/direction/walking&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;origin&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;destination&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;strategy&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 0：最快捷模式, 1：最经济模式, 2：最少换乘模式, 3：最少步行模式, 5：不乘地铁模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;city&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CITY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;count&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 如果没有公交路径，就使用步行路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _get_walking_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;route&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;transits&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;duration&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    使用全局字典减少高德api调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">from_loc</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">-</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">to_loc</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> DURATION_DICT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DURATION_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _get_transit_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> DURATION_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    测试demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;天坛公园&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_addr   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;天安门广场&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_loc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_loc   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;from_addr&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;from_loc&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;to_addr&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;to_loc&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;duration&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> duration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基于-pandas-进行筛选">基于 pandas 进行筛选<a class="hash-link" href="#基于-pandas-进行筛选" title="标题的直接链接">​</a></h3><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> gaode </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> get_transit_duration_between_coords</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get_addr_name_from_coords</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TARGET_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token builtin">globals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dump_dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DATA_FROM_DOUBAN_DIR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data_from_douban&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FILENAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2022-03-02-zhufang.csv&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DATA_FROM_DOUBAN_DIR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FILENAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;reading file from: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># convert response_latest_time format into datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">response_latest_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">response_latest_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&#x27;2022-02-25&#x27; &lt; response_latest_time&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter personal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;女生&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;个人&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;直租&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;转租&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;shape: &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get coords from title</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;getting coords from title&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;addr_coords&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get addr from coords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;getting addr name from coords&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;addr_name&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;addr_coords&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_addr_name_from_coords</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get duration between coords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;getting distance from coords&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;transit_minutes&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;addr_coords&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> get_transit_duration_between_coords</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TARGET_ADDRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;filter duration&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;transit_minutes &lt; 60&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sort</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;sort&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;transit_minutes&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dump</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dump&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;.csv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_filter.csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;utf-8&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>结果如下，注意右边的三列<code>addr_coords | addr_name | transit_minutes</code>，就是我们基于程序计算出来的通勤相关数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646678956572-83aed2a3ecc8f6bb14055492003109ec2080830b354fabf54d76a91ba877bd00.png" alt="picture 8" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="人工筛选环节">人工筛选环节<a class="hash-link" href="#人工筛选环节" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="表格迭代标注法">表格迭代标注法<a class="hash-link" href="#表格迭代标注法" title="标题的直接链接">​</a></h3><p>我个人初步的预算其实是 2000-3000、通勤在一小时内、最好能有个独卫，后续证明这在大北京确实是一个相当困难的目标。</p><p>所以后续为了能有合适的标的，把预算上升到了 4000。</p><p>在经过我的程序化简单筛选后（基于明显不符合自己要求的标题、日期，以及基于标题与高德求解的路径耗时），两张 1w+的表格均被晒成了不足 100 个。</p><p>紧接着，我将逐一打开这些链接，进一步确定是否尝试联系或者直接 pass，并进行标记：<code>-</code>表示 pass，<code>+</code>表示有意愿。</p><p>例如，这是“北京租房”小组的表格经过手动标注后按照 choice 列降序的结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646726767185-88d0b9e7e4790687cbbf2f2a6a9368728ca195d7369b6c77b449d73a57f6ff64.png" alt="picture 9" class="img_vXGZ"></p><p>在处理“北京无中介租房”小组时，觉得单纯的加与减的级别控制还不太够，所以又使用了<code>+ | ++ | +++</code>三种级别，加号越多表示越想要，从而排序。而这些加号前面的<code>-</code>号，则表示后续在线联系或者线下考察后决定拒绝或者放弃。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646726999168-01d44eca006d3e7ca282d70a8cb76a7d681b77b1a9b2a45b4fb97f8e5ca77276.png" alt="picture 10" class="img_vXGZ"></p><p>因此标注、再标注，这是一个循环迭代的过程，最终我们将只会有很少甚至没有符合目标期望的房源。亦或者，我们将选用最后一个被排除的房源。</p><p>这有点像相亲，硬性条件不达标我们一定会 pass，可容忍的缺点我们尝试去磨合，宁缺毋滥。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上联系也有一些困难">线上联系也有一些困难<a class="hash-link" href="#线上联系也有一些困难" title="标题的直接链接">​</a></h3><p>因为豆瓣其实不是一个主打即时社交的平台，很多朋友只是在这里发个帖子，然后就可能……人都找不到了， 或者好几天才回。</p><p>在我的目标候选房源中，有一个超小的单身独卫房，非常廉价，但却始终联系不上： <a href="https://www.douban.com/group/topic/261047442/?_i=62974230uaXoRO" target="_blank" rel="noopener noreferrer">6 号线青年路 次卧转租—无隔断 独立卫生间 独立阳台 6 号线青年路 次卧转租—无隔断 独立卫生间 独立阳台</a></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646727973605-f7e07f6c93ee80ae944c877722d1ce688d18242edf52e4a8597e5311c32f61d9.png" alt="picture 11" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646727993779-1a8c7a3e89a723fe1e013399fe0c42bbbd4053acefa71e1ea17238d236383448.png" alt="picture 12" class="img_vXGZ"></p><p>但也许是很快就租出去了吧？反正，豆瓣私信一直联系不上。</p><p>所以，错过了见识一下目前认知里最小的独卫房的机会。</p><p>其他的基本联系上了，但有些确实比较慢。</p><p>通过线上联系直接被 pass 的主要分三种吧，发现是中介、限女生、价格过高等。</p><p>也有一些非常热情的朋友（小姐姐居多），聊天、谈房的感觉还是很愉悦的，所以转租确实比冷冰冰的中介体验感要好很多，你更大概率能感觉到真实、安心。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="线下跑房环节">线下跑房环节<a class="hash-link" href="#线下跑房环节" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="时间与路线规划">时间与路线规划<a class="hash-link" href="#时间与路线规划" title="标题的直接链接">​</a></h3><p>再经过一两个小时的手动筛选与一一联系之后，就基本决定了线下跑房的计划。</p><p>基于豆瓣租房的筛选，我两天内一共跑了九套房，其中第一天晚上原定五套实看四套，第二天下午原定四套实看五套。</p><p>当时还挺天真，每两套之间计划只用半小时，结果发现严重不够，最后还鸽了几个……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733639926-a1dc3ab4dacead50365079b9c1be3c22ea480862b978ff0d3bee9762b41ee8cb.png" alt="picture 13" class="img_vXGZ"></p><p>第二天吸取教训，把每套房控制在了一小时的间隔：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733824670-2066610fc106663cd5f2fb5821b0a98df72743c52a53180a1451908df1b9f6c5.png" alt="picture 14" class="img_vXGZ"></p><p>以及路线方面：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733878429-bb6209a0e6373d216a3fe35736356a6bcbcdb3254c2655273a474e34cff91ac2.png" alt="picture 15" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房110-望京附近3000">跑房（1/10）: 望京附近，3000<a class="hash-link" href="#跑房110-望京附近3000" title="标题的直接链接">​</a></h3><p>第一个房是在望京附近，因为我们甲方爸爸在那，我可能较长一段时间都在那。</p><p>当时也是第一次使用豆瓣租房找房，于是找了一所，是个小姐姐，某天晚上过去看了一下。</p><p>后续觉得还是得以公司为中心比较好，所以之后开始使用程序手段进行豆瓣小组租房信息爬取与筛选。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房2103-31陆翔佳园_3200">跑房（2/10）：3-3<em>1</em>陆翔佳园<!-- -->_<!-- -->3200<a class="hash-link" href="#跑房2103-31陆翔佳园_3200" title="标题的直接链接">​</a></h3><p>三月三号晚上整体的跑房策略，就是一路向东，第一个房是在百子湾附近，是一个中介，谈的是金海国际，初步价格是在 3200-3500。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646735935957-362e48d3bd873cdcc856122bbcbc548d0af445ff1da3523964a440eaef02ea83.png" alt="picture 16" class="img_vXGZ"></p><p>我看着房子还算不错，另外也 check 了地图，是离大郊亭地铁站（这个地铁站位置还行，比百子湾更近中心一点，左边一站就是 14 号线上的九龙山）最近的一个小区。</p><p>然而，当我到了之后，有两个中介，好像一位是另一位的上级，我跟着另一位坐上了小电驴……路上问我的价位预期和要求……</p><p>我千辛万苦筛选的豆瓣租房，还是从中介的一辆小电驴，开始出发了……</p><p>然而，我们最后还是没有去金海国际，因为如果想要金海国际的独卫，预算至少估计要 4000 起，我说我最多只愿意开到 3500，于是我们到了一个小区：陆翔佳园。</p><p>【视频：3-3<em>1</em>陆翔佳园<!-- -->_<!-- -->3200.mp4】</p><p>这个小区的开价是 3500，有独卫，空间也不小，朝南，有飘窗，听说是部委房。我特意还去看了一下其他次卧的公共洗手间，非常狭窄，说实话觉得“他们”真地很不容易。</p><p>中介一直劝说我不用看客厅走廊别人的卫生间什么的，因为我住在主卧，但走廊什么的都很挤很暗，因此觉得还是难以让我满意。</p><p>另外，还有一个把我怵到了的地方，就是独卫里竟然还有个大石墩子。中介说可能是用于坐的，房东的，搬也搬不走。我当时竟然还脑补了 maybe 是一个小浴桶……但后续却始终想不明白……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646737156337-a1e512119b3d4cbdcb0abce22e4499e2bba278bb577d3b0e426ff036ec46d50d.png" alt="picture 17" class="img_vXGZ"></p><p>和这个令人想不明白的石墩墩同处一室的还有一个高级马桶，是所有房中最高级的，有点像外滩外企的马桶，emm，也忘记看是啥牌子了……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房3103-32珠江绿洲_3800">跑房（3/10）：3-3<em>2</em>珠江绿洲<!-- -->_<!-- -->3800<a class="hash-link" href="#跑房3103-32珠江绿洲_3800" title="标题的直接链接">​</a></h3><p>看完第一个陆翔佳园的房子其实已经 7 点 40 多了印象中， 于是原定于 7 点半的慈云寺的房子就肯定早已经被鸽了，事实上，最后即使租完房也没去成，彻彻底底地鸽了……</p><p>因此直接奔赴预定 8 点钟传媒大学附近珠江绿洲的房源，不过看起来是一路向东， 其实并没有那么简单……饶了一个大圈呢：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646755819160-19479abe2a639272ae78addccc932d891f19bce62b217873cf1dcae7f78c0d60.png" alt="picture 18" class="img_vXGZ"></p><p>珠江绿洲这个房源让我很放心，因为是个人，并且是刚毕业的两个小姐姐，非常热情，早早地在小区门口等待我。交流下来，非常地纯粹、坦诚，而且有趣地是她们竟然也是（准）程序员，一个做前端，一个做数据分析。</p><p>珠江绿洲给我的感觉怎么说呢，房间很大，是主卧，并且有独卫，据小姐姐反馈，原先她们是住三个人的……现在是住两个，并且有两张床……显然，对于我来说，一方面有点多余，另一方面则有点奢侈了。</p><p>【视频：3-3<em>2</em>珠江绿洲<!-- -->_<!-- -->3800.mp4】</p><p>我也开始动摇对独卫的执着，房源未必没有，但独卫的主要适用对象真不是我这种单身狗……而且价格实在太贵了，有 3800……是所有我看的房源中最贵的，并且离公司更远，也离市中心更远。</p><p>不过这个小区倒是很繁华，一楼的各种店铺一应俱全，游乐场、小公园的什么的都有，说实话，很宜居。</p><p>由于两位小姐姐其实已经找到了新的合租房，并且不在这里，所以我看完后就一起下楼了，一直亲送我到天桥附近，这份真诚让我很是感动，我也是真地很想接手她们的房源以免刚毕业的她们承受不菲的违约费用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房4103-33周井大院_2900">跑房（4/10）：3-3<em>3</em>周井大院<!-- -->_<!-- -->2900<a class="hash-link" href="#跑房4103-33周井大院_2900" title="标题的直接链接">​</a></h3><p>从珠江路景出来后，继续往东，奔赴周井大院，下了地铁后还要走大概 1.5 公里……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646756354749-459044fa0477642f9d914944bad4ee836f95a78c9819e8aa9a423d0bb9177a56.png" alt="picture 19" class="img_vXGZ"></p><p>这个房是两室一厅一卫，内部空间还是挺大的，小屋也被布置的比较温馨，地面还铺了条毯子。租客是一位在北京工作八年多的小姐姐，做餐饮行业，不知道是原来在大兴现在要去望京还是原来在望京现在要去大兴于是想转租出去。</p><p>【视频：3-3<em>3</em>周井大院<!-- -->_<!-- -->2900.mp4】</p><p>我仔细问了小姐姐平常她的交通工具是什么，毕竟离地铁比较远，她说自己是骑小电驴到地铁的，我便恍然大悟了。</p><p>不过有一说一，对于长租的人来说，离地铁远一点，配个小电驴，确实能显著提升生活体验，拥有近乎最高的性价比。</p><p>不过这个房除了区位较偏、地铁较远、小区较老（没有电梯）外还有个问题，原先帖子里说的是隔壁是有个很 nice 的小哥哥，现在被告知是一对情侣。除此之外，我觉得还行。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房5103-34珠江帝景_3500">跑房（5/10）：3-3<em>4</em>珠江帝景<!-- -->_<!-- -->3500<a class="hash-link" href="#跑房5103-34珠江帝景_3500" title="标题的直接链接">​</a></h3><p>接下来就是当晚最后一间房了，位于九龙山附近的珠江帝景。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646756511567-fa68bd26a7de703442cb9107f378812e2decbc602e8c25d61ff357e92537cf87.png" alt="picture 20" class="img_vXGZ"></p><p>理论上来说，这个房的地理位置应该是最好的，因为九龙山这里连通 14、7 号线，到达望京只需 50 分钟，到达四惠的公司只要 3.5 公里，比较适合骑车，地铁路线里只有大郊亭到百子湾段是重合的。</p><p>珠江帝景也是中介推荐房，两个人把我领了上去。</p><p>【视频：3-3<em>4</em>珠江帝景<!-- -->_<!-- -->3500.mp4】</p><p>看了一圈下来，空间肯定没有珠江绿洲的大，但其实有的一拼，不过珠江帝景对于我来说，这个阳台的造型与风景更加的有范，比较中我意，但没有独卫则是它的硬伤，否则 3500 的价格在这个地段、这个小区，那是相当值得。</p><p>但让我感到不是很舒服的两点之一，珠江帝景这个房是转租，在豆瓣帖上写的很清楚不要中介费和服务费，但是在问中介费用时却仍在算，说给个 500 什么的，我说帖子上不是这么写的，中介立即反应说是嘛，这块晚点确认一下，然后又聊了几句之后我再次确认费用核算时，中介已经没有提中介费相关问题，你细评。</p><p>第二点是关于服务费的，因为正常转租，人比较好的或者急于转的一般都会在帖子里说服务费就让给你了不用你交了，等到期再自己和房东与中介谈，这种就是比较友好的，比如珠江绿洲的两个小姐姐就是这样做的。但这里情况就不一样，是要我继续交接下来几个月服务费的，关键是，租客非常同意这一点，说不要在意那么点钱，他自己交了一年都不讲究。租客是一个 tony，也许工资确实比我高？但我觉得我就是很在意这个问题，中介凭什么能收两次服务费，除非，是转给“你”的吧。</p><p>不过说来也巧，过了几天后我刷到了一个动画视频，里面的房型竟然几乎和珠江帝景一样！让我哭笑不得。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646757175331-7eddac638f1b4110912d1a32f334b43e4112505667211f27767cec1670beda00.png" alt="picture 21" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房6103-41劲松七区_3000">跑房（6/10）：3-4<em>1</em>劲松七区<!-- -->_<!-- -->3000<a class="hash-link" href="#跑房6103-41劲松七区_3000" title="标题的直接链接">​</a></h3><p>第二天，吸取昨天的教训，放弃独卫的要求，从而尝试更多高性价比与高质量的房源。</p><p>从中午一点起，第一个房源是位于二环的劲松七区，价格 3000。</p><p>当天风超级大，出门时打电话都听不大清的那种。而在劲松七区内还看到一条被拴住的小狗，非常可怜。</p><p>【视频：大风中的小狗】</p><p>这个小区没有电梯，款式较老，有一个小学，感觉像学区房。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646759356077-ee8948e1bb0b902624d92c0d035e876b3ab249324021e64c6019284cc48b8089.png" alt="picture 22" class="img_vXGZ"></p><p>“受命”转租的是一位非常 nice 的小姐姐，待转租的是她的一位已经结婚准备回去生孩子的室友。另一位室友也是女生，做行政工作。</p><p>房间在六楼，从地铁走过来一点几公里还要再爬六楼着实还是有一点辛苦。</p><p>好在小姐姐很热情，消除了我很多的顾虑，我想的是如果租这个房至少能有一个非常好的室友关系，因为这位室友是做财务的，和我本科专业很有联系。</p><p>【视频：3-4<em>1</em>劲松七区<!-- -->_<!-- -->3000.mp4】</p><p>但最大的问题是，这个房子需要三月底才能搬，这对于我来说，并不太可行，因为这几天为了租房一直在住酒店，我需要尽快搞定租房问题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房7103-42惠生园_3300">跑房（7/10）：3-4<em>2</em>惠生园<!-- -->_<!-- -->3300<a class="hash-link" href="#跑房7103-42惠生园_3300" title="标题的直接链接">​</a></h3><p>紧接着就是惠生园，我预留了两小时，正好能赶上。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646760068701-a4e3d80f9d7d21ca18d4d1620e0b2a285aa9918a657be930231932b012b94f16.png" alt="picture 23" class="img_vXGZ"></p><p>其实从地图上看，惠生园已经离地铁很近了，但我依旧走了较长时间，所以，一点几公里的步行，可能才是人生常态……</p><p>带我看房的是租户的室友，一位刚辞职可能准备创业的很斯文的男生，房间里还有一台大打印机。租户是位女生，房间很明亮。</p><p>【视频：3-4<em>2</em>惠生园<!-- -->_<!-- -->3300.mp4】</p><p>我能够接受房子价格高于 3000，但我不能接受高于 3000 还没有独卫……另一方面，它似乎离地铁与公司有点远。</p><p>但事实上，这也有可能是出于路线偏差。在来看这个房前因为已经走了很长的路（包括去劲松七区、走错地铁、走到惠生园等），看这个房之后又走了很长的路（2-4 公里）到公司附近得了另一套房，所以强化了惠生园走路很远的印象，然而事实上可能并不是，不过惠生园到公司确实不近，并且没法做地铁。</p><p>又查了下地图，好像只要两公里，可能当时走绕了……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646804776040-338f544c70d3599e48ad4bfd90021c2641f9dde09acca9cad3aa95363b276bce.png" alt="picture 24" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房8103-43沿海赛洛城_2200">跑房（8/10）：3-4<em>3</em>沿海赛洛城<!-- -->_<!-- -->2200<a class="hash-link" href="#跑房8103-43沿海赛洛城_2200" title="标题的直接链接">​</a></h3><p>下一站是沿海赛洛城，就在公司南边 1.2 公里，是一个中介介绍，只要 2200 很便宜的房子。</p><p>实际上惠生园到公司与沿海赛洛城到公司距离差不多，两者到地铁距离也差不多，惠生园接近 1 号线，沿海赛洛城接近 7 号线（也可以往上去 1 号线），所以惠生园应该来说地理位置更好一些，但沿海赛洛城去公司不需要经过快速路，相对比较安全。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646804990842-99ab1be20299a833b54627c41b174f1ce625702af781d63bc91fe0b2be2b4f71.png" alt="picture 25" class="img_vXGZ"></p><p>房客是一个看起来很精致、大方的女孩，经问住了两年了，这次是到期搬走而不像其他的转租一样是中途搬走（因此需要重新交中介费与服务费等）。</p><p>【视频：3-4<em>3</em>沿海赛洛城<!-- -->_<!-- -->2200.mp4】</p><p>也许是受这女孩感染，查看了她的房后，觉得这个房间虽小，却也能够容纳很多人的生活与梦想，有种很温馨的感觉。</p><p>但让我觉得比较遗憾的是，这个窗户太小，并且是朝东的……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房9103-44百子湾家园_2500">跑房（9/10）：3-4<em>4</em>百子湾家园<!-- -->_<!-- -->2500<a class="hash-link" href="#跑房9103-44百子湾家园_2500" title="标题的直接链接">​</a></h3><p>看完上个房后，中介说还有一个房，更大一些，要 2500，我看现在离下一个房还有点时间，所以也答应去看了。</p><p>【视频：3-4<em>4</em>百子湾家园<!-- -->_<!-- -->2500.mp4】</p><p>这个房确实就比 2200 的更明亮许多了，窗户很大，但是厨房比较脏，洗手间的水龙头竟然还打不开，这让我很不能接受。也许是正在维修什么的，但毕竟我今天是来“查房”，第一印象不好那后续就更麻烦了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房10103-45垂杨柳百里_3500">跑房（10/10）：3-4<em>5</em>垂杨柳百里<!-- -->_<!-- -->3500<a class="hash-link" href="#跑房10103-45垂杨柳百里_3500" title="标题的直接链接">​</a></h3><p>看的最后一套房是一个很奇葩的户型：团结户，我也过来见见世面。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646806309702-f56180da34c2a4773bcddb09896f13e275eabd23d460a8fd4e15fede6b331cce.png" alt="picture 26" class="img_vXGZ"></p><p>接待我的是一个中介，屋子还坐着一个，好像也是中介，地道的北京人。</p><p>【视频：3-4<em>5</em>垂杨柳百里<!-- -->_<!-- -->3500.mp4】</p><p>这个房是个老房子了，据说墙体十分结实，后来过来一个 89 岁高龄的老爷爷，跟我们说住这已经五十多年了，唐山大地震那会对面 70 年代的“新”楼都裂缝了，这个房一点事都没有，还是十二人十二天盖一层楼搞定的……听的我直愣。</p><p>【照片：老爷爷】</p><p>老爷爷问了这个房的价格，中介来之前说是 3500，然后今早房东说要加价 100，所以是 3600，老爷爷听完说那还好，一楼的那个房厨房面积比这小一半前两年还要 3800……</p><p>由于这是我看的最后一套房了，所以聊了很久，中介也很会看人，见我已经从原来的室内站到门口了，说让我进来再坐会再聊聊，聊我的工作和家乡地，还讲了点南京的段子，还是挺有意思的。北京人就是实诚，有话就说，也能说会道，这个我还挺欣赏的。</p><p>以上就是全部跑房相关内容的记录了，更多问题可以私聊我。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="投票环节">投票环节<a class="hash-link" href="#投票环节" title="标题的直接链接">​</a></h2><p>如果是您，您会选择哪一所房源：</p><p>【投票：房源】</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="info">info<a class="hash-link" href="#info" title="标题的直接链接">​</a></h2><ul><li>author: 南川</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-010">version: 0.1.0<a class="hash-link" href="#version-010" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-09</li><li>content:<ol><li>完成全部代码封测，并开源，项目地址： <a href="https://github.com/mark-applications/data-science_douban-houses" target="_blank" rel="noopener noreferrer">mark-applications/data-science_douban-houses</a></li><li>使用该项目为身边某位正为租房而发愁的朋友无偿提供帮助</li></ol></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-004">version: 0.0.4<a class="hash-link" href="#version-004" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-08</li><li>content: 增加人工筛选与线下跑房环节</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-003">version: 0.0.3<a class="hash-link" href="#version-003" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-07</li><li>content: 完成高德 API 部分</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-002">version: 0.0.2<a class="hash-link" href="#version-002" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-05</li><li>content: 完成豆瓣小组 api 部分</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-001">version: 0.0.1<a class="hash-link" href="#version-001" title="标题的直接链接">​</a></h3><ul><li>date: 2022-02-28</li><li>content: 完成租房方案设计部分</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/租房">租房</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/豆瓣">豆瓣</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/02/02/dev-linux">编程 | Linux 笔记</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-02-02T00:00:00.000Z" itemprop="datePublished">2022/02/02</time> · <!-- -->阅读需 59 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>很久以前，自打我刚开始学计算机，就有一个认知：精通 linux 的人都是大神。</p><p>但，我是不需要学的。</p><p>很长一段时间，我都是这么认为的。</p><p>直到这两年，我选择了 Mac 作为自己的主力开发工具，两年的摸爬滚打，尤其是始于对<code>iTerm + zsh + oh-my-zsh</code>颜值的惊艳，到现在能够在 mac、ubuntu、centos、windows 等各大操作系统之间自如切换，并逐渐意识到命令行系统对于现代操作系统的重要性，命令行熟练度对于提升工作效率的重要性，我知道，我已经走向了一条与计算机越来越近的不归路。</p><p>而这一切中间的桥梁，正是 linux，于我而言，不认识不掌握 linux，不可谓入了程序的真正世界。</p><p>因此，本系列第一篇，献给 linux，一方面是致敬我心中曾经那触不可及的信仰，另一方面也是为了能重新认识它，对它说一句它可能真正想听的：&quot;hello linux, I&#x27;m mark&quot;。</p><p>因为每一个 linux 的学习者最后都会发现，linux 并不神秘，而 linux 真正启迪人的，是它的设计哲学，与对你工作流的重塑。</p><p>在此，我斗胆把 python 之禅搬于此，因为在我心中，它于 linux，是心有灵犀，同样适用：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643723806431-00b5b858aa9372ebc4b9dfc37178554d0d0d4eb62c854edb6cd2385e15333e07.png" alt="picture 16" class="img_vXGZ"></p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="首先linux-是什么">首先，linux 是什么<a class="hash-link" href="#首先linux-是什么" title="标题的直接链接">​</a></h2><p>作为南川的核心开发笔记（从实际工作经验中提炼出来的笔记），我无意过多展开一些基本的背景介绍，因此也不会花时间去讲述 linux 和 unix 和 mac 之间的关系，这些读者们都可以很方便地在互联网找到答案。</p><p>我只简单地如下描述，目前用于个人使用的电脑系统，主要分为 windows 和 mac。</p><p>windows 的最大优点，是价格相对平民，生态丰富，交互习惯最符合人类直觉。</p><p>mac 的最大优点，是审美一流，做工一流，触控板和屏幕天花板的存在，然后于我而言最大的优点，是其 unix 系统，可以允许我像 linux 一样方便地使用命令行。</p><p>所以，我在使用了五年的 windows 后，毅然投入了 mac 的怀抱，而其中的目的之一，就是为了更好地掌握 linux。</p><p>（当然，纯粹使用 linux 我是不会接受的，我还是觉得追求审美也是生活中很重要的一部分，于是乎，<del>我现在已经极其极其不想看到任何 windows 的界面</del>）</p><p>说了这么多，还是没说 linux 是什么。</p><p>没错，就应该这样，这篇是核心开发笔记，非核心的，可以出门右转某乎，比如：</p><ul><li><a href="https://www.zhihu.com/question/434914458/answer/1664277013" target="_blank" rel="noopener noreferrer">(19 封私信 / 67 条消息) 作为开发者，你更喜欢用 macOS、Linux 还是 Windows 操作系统？为什么？ - 知乎</a></li><li><a href="https://www.zhihu.com/question/24261540/answer/80418621" target="_blank" rel="noopener noreferrer">(19 封私信 / 67 条消息) Linux 各大发行版有什么特色？ - 知乎</a></li></ul><p>PS: 以上链接，我都没有看过，只是随手一搜。😄</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其次如何拥有一台-linux">其次，如何拥有一台 linux<a class="hash-link" href="#其次如何拥有一台-linux" title="标题的直接链接">​</a></h2><p>有很多种方法。</p><p>如果你是 windows 10+用户，最方便的方法，是基于内置的<code>wsl</code>系统，不知道是什么？出门右转。</p><p>至于内置的<code>wsl</code>会不会有什么限制和性能损耗？这个我也不知道，我不用，如果你知道，欢迎留言，我还挺想知道的，只要你愿意留我就愿意听，并且可能会影响我接下来的认知。</p><p>但我不会因为这个出门右转，我已经为了给大家示范如何出门右转，已经出门一次了，寒冬腊月，怪冷的。</p><p>这是其一。</p><p>其二，装一个双系统。</p><p>我一直想装个双系统，并且尝试到了最后一步，因为工作需要。当时我给我的 mac 装 ubuntu 的双系统，结果到了安装界面，鼠标和键盘没有响应，查了查好像我的版本 mac 2020 pro 的鼠标和键盘不走 usb，而是总线？</p><p>不清楚，后续我可能会继续尝试装个双系统，目前我用的是虚拟机。</p><p>PS：友情提示，小白不要轻易尝试双系统，容易留下不学无术后悔的泪。</p><p>其三，装一个虚拟机，比如<code>vmware</code>或者<code>virtual box</code>。两个都尝试下来，个人比较喜欢<code>vmware</code>。</p><p>至于怎么装，怎么配置，出门右转，或者等我后续系列，会有虚拟机/双系统专刊的，应该（如果不懒的话）。</p><p>我目前的虚拟机（内部运行的 ubuntu，可以同时运行多个操作系统）界面如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643725375163-c76c9d50a6632d532665d3bbbffb45379f7a72060170528ffbba377ad4a0d461.png" alt="picture 17" class="img_vXGZ"></p><p>其四，阿里云/腾讯云/华为云/亚马逊云……租一个 linux 服务器或者操作系统等。这是业界搭建后端必备。我之前一直用的阿里云/腾讯云，因为以前做全栈多一些。</p><p>目前市面上，服务端应该用 centos 比较多，客户端应该用 ubuntu 比较多，主要原因可能是 centos 默认没有界面，程序较为稳定；ubuntu 的界面很好看，比较适合个人鼓捣。</p><p>我目前使用的 ubuntu 界面如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643725414611-b8cc4126f345748e9f692843738ed6d80aa61c82103b1321308468c70443c356.png" alt="picture 18" class="img_vXGZ"></p><p>这里值得注意的是，有一些企业可能购置了类似于 windows server 之类的服务端，这种本质上还是 windows 系统，不是 linux 系统，只不过一直跑在公司网络上。</p><p>所以当我们谈到服务器的时候，可能并不一定是 linux 系统，这是值得注意的。</p><p>我为啥知道这玩意呢，因为之前碰到一个项目是这样的，我本来写好的 linux 的后端，想着直接移到目标公司网上，结果一看，windows server，把我给整不会了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="接着如何登录-linux">接着，如何登录 linux<a class="hash-link" href="#接着如何登录-linux" title="标题的直接链接">​</a></h2><p>理论上，登录这个动作，不应该是个问题，但那仅限于是登录自己的本地的每天都用的电脑。</p><p>linux 一般都是在服务端的，一般涉及到远程访问，所以通用做法是用<code>ssh</code>。</p><p>基本的 ssh 用法出门右转即可，本文只记录如何免密登录 ssh。</p><p>因为 ssh 默认每次都会输入密码，很不畅快。更严重的是，如果涉及到写批运行脚本，则密码输入会成为脚本杀手，至少会让脚本更难理解，出错概率更高。</p><p>很简单，第一步，先<code>ssh USERNAME@SERVER</code>，其中<code>USERNAME</code>和<code>SERVER</code>是目标服务器的用户名和 IP 地址（或者域名，如果有的话）。</p><p>一般，默认的<code>USERNAME</code>是<code>root</code>，密码也是<code>root</code>，虽然这很不推荐，不安全，但对于新手却是很友好。</p><p>尽管我的密码更简单，简单到你会拍案惊奇。</p><p>当你第一次<code>ssh</code>之后，会在本机的当前用户文件夹下（mac 和 linux 都是<code>~</code>文件夹，windows 是<code>C:\\Users\\XXX</code>）生成一个<code>.ssh/id_rsa.pub</code>，这是公钥。</p><p>这个文件的内容，涉及到了 rsa 算法等密码学相关内容，不展开。而你要做的，就是把里面的文本复制，粘贴到目标服务器的<code>~/.ssh/authorization_keys</code>文件内（如果文件不存在，则新建；如果文件已有内容，则另起一行，补在后面即可）。</p><p>以下给出一键脚本：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">USERNAME=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER=&quot;xxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file=&quot;id_rsa.pub&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp ~/.ssh/$file $USERNAME@$SERVER:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh $USERNAME@$SERVER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file &gt;&gt; .ssh/authorized_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm $file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个脚本里的<code>scp</code>是在本地与服务器之间交换文件的意思，最后一个冒号表示当前文件夹，而<code>$USERNAME@SERVER</code>即目标服务器的用户文件夹，这就对上了。</p><p><code>cat</code>是读取所有文本内容到输出流，<code>&gt;&gt;</code>是把输出流内容添加到目标文件的末尾。</p><p><code>rm</code>是删除，这里代表传送的<code>file</code>是一个中转文件的意思，为啥要中转，你猜。</p><p>最后，为了防止<code>ssh</code>超时断开，可以在本地（客户端）的<code>ssh</code>配置文件中补一下以下配置，这样每分钟发送一次消息给服务端，服务端就不会主动清理客户端了。相信我，如果不解决这个问题，后续你会很头疼的。</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># /etc/ssh/ssh_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServerAliveInterval 60</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后如何掌控-linux以下给出一部分经验笔记">最后，如何掌控 Linux，以下给出一部分经验笔记<a class="hash-link" href="#最后如何掌控-linux以下给出一部分经验笔记" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="-------------------------------------">-------------------------------------<a class="hash-link" href="#-------------------------------------" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-ubuntu-initialization">BEST-PRACTICE: ubuntu initialization<a class="hash-link" href="#best-practice-ubuntu-initialization" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-0-install">step 0. install<a class="hash-link" href="#step-0-install" title="标题的直接链接">​</a></h3><ul><li><a href="https://releases.ubuntu.com/18.04/" target="_blank" rel="noopener noreferrer">Ubuntu 18.04.6 LTS (Bionic Beaver)</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-1-config-apt-source">step 1. config apt source<a class="hash-link" href="#step-1-config-apt-source" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="1-change-apt-source">1. change apt source<a class="hash-link" href="#1-change-apt-source" title="标题的直接链接">​</a></h4><p>ref:</p><ul><li><a href="https://zhuanlan.zhihu.com/p/61228593" target="_blank" rel="noopener noreferrer">【Ubuntu】Ubuntu 18.04 LTS 更换国内源——解决终端下载速度慢的问题 - 知乎</a></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="fastestscript-way-直接修改etcaptsourceslist">fastest/script way: 直接修改<code>/etc/apt/sources.list</code><a class="hash-link" href="#fastestscript-way-直接修改etcaptsourceslist" title="标题的直接链接">​</a></h5><p><del>其中，第一种方案虽然可行，但是有两个缺点，一个是侵入性高，所以一般都会先备份一下原文件，然后使用替换命令。</del></p><p>Update 2022-01-24：实际上所有方式底层都是通过修改 apt sources.list 文件配置的，所以没有什么侵入性一说，都会先做备份。</p><p>GUI 版（也就是<code>softwares &amp; update</code> app 里会提供测试，自动修改，改完之后触发更新操作，而这些其实可以自己用脚本完成，响应也更快！</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># backup source file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCES_LIST_FILE=/etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp $APT_SOURCES_LIST_FILE $APT_SOURCES_LIST_FILE.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCE=&quot;http://mirrors.yun-idc.com/ubuntu/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i  &quot;s|deb \S+|deb $APT_SOURCE|g&quot; $APT_SOURCES_LIST_FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># update source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另一个就是，只能填入自己想填的源，但很可能不是最好的源。比如我一直以为阿里云的源很好，结果这次发现，极其地慢，我确认在<code>update</code>时走的是<code>cn.xxx</code>，但依旧只有十几 k。</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="robustestrecommend-for-newbie-way-在softwares--update里修改-server">robustest/recommend-for-newbie way: 在<code>softwares &amp; update</code>里修改 server<a class="hash-link" href="#robustestrecommend-for-newbie-way-在softwares--update里修改-server" title="标题的直接链接">​</a></h5><p>第二种办法就是在<code>softwares &amp; update</code>里自动测试最好的服务器，然后选择它。我测出来是<code>yun-idc</code>最好，但是因为我没用过，所以当时没考虑它，后来被阿里云折磨的不行了，就试了它，结果飞快，十兆每秒！</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="use-others-way-使用别人写好的-git-仓库进行配置">use others way: 使用别人写好的 git 仓库进行配置<a class="hash-link" href="#use-others-way-使用别人写好的-git-仓库进行配置" title="标题的直接链接">​</a></h5><p>第三种办法，由于我还没配好源，所以也没 git，而此时下载 git 又会极其地慢，所以也不考虑。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="2-update-apt">2. update apt<a class="hash-link" href="#2-update-apt" title="标题的直接链接">​</a></h4><p>!!!tip If the following commands warn that files are locked, then wait for some minutes, or use <code>lsof FILE</code> to have a check, more refer to: - <a href="https://zhuanlan.zhihu.com/p/126538251" target="_blank" rel="noopener noreferrer">解决 apt-get /var/lib/dpkg/lock-frontend 问题 - 知乎</a></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get upgrade</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-2-config-git">step 2. config git<a class="hash-link" href="#step-2-config-git" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git config --global user.name YOUR_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git config --global user.email YOUR_EMAIL</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-3-config-terminal">step 3. config terminal<a class="hash-link" href="#step-3-config-terminal" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-4-config-language">step 4. config language<a class="hash-link" href="#step-4-config-language" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-config-chinese-input-source-via-ibus">resolution 1: config chinese input source via ibus<a class="hash-link" href="#resolution-1-config-chinese-input-source-via-ibus" title="标题的直接链接">​</a></h4><p>ibus 输入方式和搜狗输入法之间不是很兼容，如果出现两者都无法输入中文的情况，建议根据<a href="https://www.jianshu.com/p/c04a4b03d30f" target="_blank" rel="noopener noreferrer">Ubuntu 18.04LTS 安装中文输入法以及快捷键设置 - 简书</a>先卸载搜狗输入法，确认 ibus 是可以用的，具体就是：<code>sudo apt-get remove fcitx*</code></p><p>确认以下配置：</p><ol><li>设置 - 地区与语言 - 输入法，中要添加包含智能拼音：</li></ol><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642268594063-def6bf87b276425161475a3ce55fbb05d8bb305b913ae5b39cc6e9708a6e32ae.png" class="img_vXGZ"><ol start="2"><li><p>语言支持中，要启用 ibus 方案</p><img loading="lazy" alt="picture 7" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642268691854-043dc8408c8326d13213bc92302c26f2d85b2be6a2892dbc58cf3d3349c9c8bc.png" class="img_vXGZ"><p>注销账号重新登录即可。</p></li><li><p>如果注销账号还不行， 就要尝试<code>sudo reboot</code>一下。</p></li></ol><h4 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-resolution-2-config-chinese-input-source-via-sougou">FIXME: resolution 2: config chinese input source via sougou<a class="hash-link" href="#fixme-resolution-2-config-chinese-input-source-via-sougou" title="标题的直接链接">​</a></h4><p>虽然按照官网走了好几遍，但始终还是没有配成这套方案，我也不知道什么原因。</p><p>而且 ibus 方案也必须在 fcitx 卸载之后才能正常使用。</p><p>参考官网：</p><ul><li><a href="https://pinyin.sogou.com/linux/" target="_blank" rel="noopener noreferrer">搜狗输入法 for linux</a></li></ul><p>更新：确保：</p><ol><li>输入源中只有一个英文（不要有 ibus 的中文，否则会干扰）</li></ol><img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642273187873-a0b1b31105b8e9fdea3ea0c576bc3e81e15cd6dec9c1dfb55a43d3a64ece559d.png" class="img_vXGZ"><ol start="2"><li>输入系统用<code>fcitx</code></li></ol><img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642273215269-68b870e74dbe7fecdac78268144d73dc987602eddc24098c4e10763b540eb6bb.png" class="img_vXGZ"><p>再更新：算了吧，我个人觉得搜过 ubuntu 的 bug 是真地多，一会能用一会不能用，尤其是我在调成中文版能用后又调成英文版，然后用不了了，接着再怎么调中文版都用不了了，非常蛋疼。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-switch-language-input-source">how to switch language input source<a class="hash-link" href="#how-to-switch-language-input-source" title="标题的直接链接">​</a></h4><p>The best way is to directly install the Chinese version of ubuntu, since the Chinese feature is built-in.</p><p>However, what we download directly from the official ubuntu website, may not support chinese choice natively. So it highly depends on what distribution version of ubuntu we download.</p><p>ref:</p><ul><li><a href="https://blog.csdn.net/qq_31290747/article/details/94555163" target="_blank" rel="noopener noreferrer">(20 条消息) ubuntu 切换中文输入法<!-- -->_<em>g_y</em>的博客-CSDN 博客<!-- -->_<!-- -->ubuntu 切换中文输入法</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-language-to-english">how to change language to english<a class="hash-link" href="#how-to-change-language-to-english" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo export LANGUAGE=en_US.UTF-8 |  sudo tee -a ~/.bashrc</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/133318/how-do-i-change-the-language-via-a-terminal" target="_blank" rel="noopener noreferrer">command line - How do I change the language via a terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="improve-a-script-to-init-ubuntu-may-not-work">IMPROVE: a script to init ubuntu (may not work)<a class="hash-link" href="#improve-a-script-to-init-ubuntu-may-not-work" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version: 0.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">features:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1. disable sudo password so running commands faster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2. disable apt password so installing packages faster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3. enable arrow up/down to backward/forward search prefix command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4. auto change deb(apt) source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5. auto install zsh, config oh-my-zsh, set as the default shell, you may need to switch to bash when build android in case of errors, it&#x27;s easy just to input `bash` in terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6. re-login to make these changes work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># !IMPORTANT: config global variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PASSWORD=&quot; &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># write password variable into bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;export PASSWORD=$PASSWORD&quot; &gt;&gt; ~/.bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># disable sudo password, ref: https://askubuntu.com/a/878705</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$USER ALL=(ALL:ALL) NOPASSWD: ALL&quot; | sudo tee -a /etc/sudoers.d/$USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1.5 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable backward/forward prefix commands search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&quot;\e[A&quot;: history-search-backward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;\e[B&quot;: history-search-forward&#x27; &gt;&gt; ~/.inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bind -f ~/.inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1.7 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change timezone, so that time display ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;export TZ=&#x27;Asia/Shanghai&#x27;&quot; &gt;&gt; ~/.profile # need relogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 2 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># update apt and install packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change apt source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCE=&quot;http://mirrors.yun-idc.com/ubuntu/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCES_LIST_FILE=/etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i.bak -r  &quot;s|deb \S+|deb $APT_SOURCE|g&quot; $APT_SOURCES_LIST_FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Y&quot; | sudo apt update # need confirm but skipped since configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Y&quot; | sudo apt upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTALLED_PACKAGES=&quot;vim git htop zsh terminator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $INSTALLED_PACKAGES | xargs sudo apt install -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 3 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># modify timezone (need relogin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export &quot;TZ=Asia/Shanghai&#x27;\n&quot; &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 4 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># configure zsh (installed in \$INSTALLED_PACKAGES) / oh-my-zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install oh-my-zsh (built-in backward search)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ref: https://ohmyz.sh/#install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh -c &quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 5 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># diy zsh based on &#x27;oh-my-zsh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add dynamical time display</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;PROMPT=&quot;%{$fg[yellow]%}%D{%Y/%m/%d} %D{%H:%M:%S} %{$fg[default]%}&quot;$PROMPT&#x27; &gt;&gt; ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set zsh as the default terminal (need relogin!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chsh -s $(which zsh) # after configed sudo, no need to input password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable zsh changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 6 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># re-login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-connection-ssh">BEST-PRACTICE: linux connection (<code>ssh</code>)<a class="hash-link" href="#best-practice-linux-connection-ssh" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-generate-public-keys">ssh generate public keys<a class="hash-link" href="#ssh-generate-public-keys" title="标题的直接链接">​</a></h3><p>ref: <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key" target="_blank" rel="noopener noreferrer">https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key</a></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -o</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-no-secretpassword">ssh no secret/password<a class="hash-link" href="#ssh-no-secretpassword" title="标题的直接链接">​</a></h3><div class="theme-admonition theme-admonition-tip alert alert--success admonition_O4V7"><div class="admonitionHeading_mM4K"><span class="admonitionIcon_Wsqb"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_wp6k"><p>最近遇到了发现即使加了 authorization_keys 还是不行，搜了很多帖子，大致理出了解决办法</p><p>首先可以在服务器上使用 <code>/usr/sbin/sshd -d -p 2222</code> 开启sshd调试，然后在client上使用 <code>ssh -vv xxx@xxx</code> 进行调试，主要看服务端报什么错，例如：<code>esca</code>算法不支持啥的，然后就意识到了是 ssh 版本太低，要升级。</p><p>不过由于 ssh-client 依赖于 ssh-server，所以也可能还比较难升，具体的办法可以用：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt purge openssh-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install openssh-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install openssh-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart sshd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart ssh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>It&#x27;s easy that if only you generate a <code>id_rsa.pub</code> and <code>scp</code> to your <code>~/.ssh/authorization_keys</code> then things all done.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="solution-1">Solution 1<a class="hash-link" href="#solution-1" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">username=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server=&quot;xxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file=&quot;~/.ssh/id_rsa.pub&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file | ssh $username@$server &quot;cat - &gt;&gt; ~/.ssh/authorized_keys&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file | ssh aosp@192.168.1.242 &quot;cat - &gt;&gt; ~/.ssh/authorized_keys&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="solution-2">Solution 2<a class="hash-link" href="#solution-2" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">username=&quot;xxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server=&quot;xxxxx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file=&quot;~/.ssh/id_rsa.pub&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp $file $username@$server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh $username@$server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file &gt;&gt; .ssh/authorized_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm $file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://alvinalexander.com/linux-unix/how-use-scp-without-password-backups-copy/" target="_blank" rel="noopener noreferrer">How to use the Linux ‘scp’ command without a password to make remote backups | alvinalexander.com</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-keep-connection-alive">ssh keep connection alive<a class="hash-link" href="#ssh-keep-connection-alive" title="标题的直接链接">​</a></h3><p>the simplest way is to force the client to keep sending <!-- -->[a null]<!-- --> message(packet) to the server, in case that the server closed the connection beyond the time limitation, and what you need to do is just to modify 2 lines in your <code>/etc/ssh/ssh_config</code> file.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim /etc/ssh/ssh_config</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>change into these:</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServerAliveInterval 60</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>finally, maybe you should restart your client. If you use the mac, you can:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># restart-ssh, reference: https://gist.github.com/influx6/46c39709a67f09908cc7542ca444fca2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo launchctl stop com.openssh.sshd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo launchctl start com.openssh.sshd</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-env-management">BEST-PRACTICE: linux env management<a class="hash-link" href="#best-practice-linux-env-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-apt-source">how to change apt source<a class="hash-link" href="#how-to-change-apt-source" title="标题的直接链接">​</a></h3><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/104695/how-do-i-change-mirrors-in-ubuntu-server-from-regional-to-main" target="_blank" rel="noopener noreferrer">command line - How do I change mirrors in Ubuntu Server from regional to main? - Ask Ubuntu</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-manual-change-from-the-app-of-softwares--updates">resolution 1: manual change from the App of <code>Softwares &amp; Updates</code><a class="hash-link" href="#resolution-1-manual-change-from-the-app-of-softwares--updates" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-modify-the-configuration-manually-from-the-terminal">resolution 2: modify the configuration manually from the terminal<a class="hash-link" href="#resolution-2-modify-the-configuration-manually-from-the-terminal" title="标题的直接链接">​</a></h4><blockquote><p>CONCLUSION</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">MIRROR_FROM=&quot;us.archive.ubuntu.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIRROR_TO=&quot;mirrors.tuna.tsinghua.edu.cn&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_FILE=&quot;/etc/apt/sources.list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i &quot;s|${MIRROR_FROM}|${MIRROR_TO}|g&quot; ${APT_FILE}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>DETAIL</p></blockquote><p>There are a few mirror servers can be used in China:</p><ul><li>mirrors.tuna.tsinghua.edu.cn</li><li>ftp.sjtu.edu.cn</li><li>mirrors.aliyun.com</li><li>mirrors.huaweicloud.com</li><li>mirrors.yun-idc.com</li><li>...</li></ul><p>The format of these mirrors may be as <code>http://${MIRROR_URL}/ubuntu/</code></p><p>And the default configuration of ubuntu servers are at <code>/etc/apt/sources.list</code>, with a copy of backup at <code>/etc/apt/sources.list.save</code>.</p><p>Here is what the <code>save</code> contents are:</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">// /etc/apt/sources.list.save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#deb cdrom:[Ubuntu 18.04.6 LTS _Bionic Beaver_ - Release amd64 (20210915)]/ bionic main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># newer versions of the distribution.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Major bug fix updates produced after the final release of the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## distribution.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## team. Also, please note that software in universe WILL NOT receive any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## review or updates from the Ubuntu security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## team, and may not be under a free licence. Please satisfy yourself as to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## your rights to use the software. Also, please note that software in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## multiverse WILL NOT receive any review or updates from the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository may not have been tested as</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## extensively as that contained in the main release, although it includes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## newer versions of some series which may provide useful features.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Also, please note that software in backports WILL NOT receive any review</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## or updates from the Ubuntu security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backports main restricted universe multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Uncomment the following two lines to add software from Canonical&#x27;s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## &#x27;partner&#x27; repository.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## This software is not part of Ubuntu, but is offered by Canonical and the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## respective vendors as a service to Ubuntu users.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb http://archive.canonical.com/ubuntu bionic partner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://archive.canonical.com/ubuntu bionic partner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security multiverse</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-whats-the-os-platform">how to know what&#x27;s the os platform<a class="hash-link" href="#how-to-know-whats-the-os-platform" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># mac: Darwin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if platform is mac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [[ $(uname) == Darwin ]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">then XXX;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else YYY;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/3466166/how-to-check-if-running-in-cygwin-mac-or-linux" target="_blank" rel="noopener noreferrer">bash - How to check if running in Cygwin, Mac or Linux? - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-configure-python-environment">how to configure python environment<a class="hash-link" href="#how-to-configure-python-environment" title="标题的直接链接">​</a></h3><ol><li>install the python on the server, the version of which would better correspond with the one of the local in case of unexpected error caused by version difference</li><li>use <code>virtualenv</code> to create an env based on this python version named <code>venv_py</code> under this working directory</li><li>activate this env</li><li>use <code>pip</code> to install the <code>requirements.txt</code></li><li>run!</li></ol><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PY_VERSION=python3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install the target python version based on its version number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if you don&#x27;t use these two lines, then you would suffer from `wget blablabla...` when you checked what the hell the python repo url is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install software-properties-common -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo add-apt-repository ppa:deadsnakes/ppa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install ${PY_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># use `virtualenv` to create and activate a new python env fast~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install virtualenv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virtualenv -p ${PY_VERSION} venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source venv_py/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install all the requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if you need to dump all the requirements of a python project used, you can use `pip freeze &gt; requirements.txt` so that a file named of `requirements.txt` would be generated under the current directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run our backend of `fastapi`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python main.py</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-cannot-use-sudo-apt-get-install-xxx-to-install-packages">✅ cannot use <code>sudo apt-get install xxx</code> to install packages<a class="hash-link" href="#-cannot-use-sudo-apt-get-install-xxx-to-install-packages" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cd /var/lib/dpkg/updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf ./*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get disk-upgrade # it may cost a little of time</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><p>I changed the suggestion in this article from <code>rm -r</code> to <code>rm -rf</code>, otherwise not successful.</p><ul><li><a href="https://www.codeprj.com/blog/a352621.html" target="_blank" rel="noopener noreferrer">E:dpkg was interrupted, you must manually run&#x27;dpkg 配置&#x27;to correct the problem. - 码上快乐</a></li></ul><p>This discussion seems wonderful but didn&#x27;t get my problem solved.</p><ul><li><a href="https://askubuntu.com/questions/410045/the-package-lists-or-status-file-could-not-be-parsed-or-opened" target="_blank" rel="noopener noreferrer">apt - &quot;The package lists or status file could not be parsed or opened&quot; - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-file-system-management">BEST-PRACTICE: linux file system management<a class="hash-link" href="#best-practice-linux-file-system-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="mkdir-if-not-exist">mkdir if not exist<a class="hash-link" href="#mkdir-if-not-exist" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://pubs.opengroup.org/onlinepubs/009695399/utilities/mkdir.html" target="_blank" rel="noopener noreferrer">mkdir</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ls-and-delete-files">ls and delete files<a class="hash-link" href="#ls-and-delete-files" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ls | grep STR | xargs rm -f</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>WARNING! Since the operation pipeline is silent, <a href="https://stackoverflow.com/questions/20858524/delete-a-list-of-files-with-find-and-grep#:~:text=you%20are%20likely%20to%20remove%20files%20that%20you%20did%20not%20intend%20to%20remove" target="_blank" rel="noopener noreferrer">you are likely to remove files that you did not intend to remove</a>.</p><p>Hence, you&#x27;d better use <code>ls | grep STR</code> first to check whether all the files to remove meet your expectation.</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fastest-delete-file">fastest delete file<a class="hash-link" href="#fastest-delete-file" title="标题的直接链接">​</a></h3><p>Don&#x27;t bother checking if the file exists, just try to remove it.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">rm -f PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install dialog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm PATH 2&gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -name &#x27;test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ &quot;$BLEG&quot; != xxx ]; then command; fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Test</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/31318068/shell-script-to-remove-a-file-if-it-already-exist/31318262" target="_blank" rel="noopener noreferrer">shell script to remove a file if it already exist - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-show-absolute-path-of-file-from-relative">how to show absolute path of file from relative<a class="hash-link" href="#how-to-show-absolute-path-of-file-from-relative" title="标题的直接链接">​</a></h3><p>I cannot use <code>brew install realpath</code> like their <code>apt install realpath</code>, but I can use <code>realpath</code>, which may be pre-built-in.</p><p>Plus, later I saw that maybe realpath is a submodule of mac package, which is named as <code>findutils</code>.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">realpath FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/4175264/how-to-retrieve-absolute-path-given-relative" target="_blank" rel="noopener noreferrer">bash - How to retrieve absolute path given relative - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-copy-file-into-clipboard">how to copy file into clipboard<a class="hash-link" href="#how-to-copy-file-into-clipboard" title="标题的直接链接">​</a></h3><p>core ref: <a href="https://apple.stackexchange.com/a/15327" target="_blank" rel="noopener noreferrer">https://apple.stackexchange.com/a/15327</a></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="its-easy-to-copy-a-text-file">it&#x27;s easy to copy a text file<a class="hash-link" href="#its-easy-to-copy-a-text-file" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbcopy &lt; FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># paste to command line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbpaste</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># paste to a new file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbpaste &gt; FILE2</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But attention, the <code>pbpaste</code> would cause corruption when deals with binary file.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="but-it-cannot-be-done-for-a-binary-file">but it cannot be done for a binary file<a class="hash-link" href="#but-it-cannot-be-done-for-a-binary-file" title="标题的直接链接">​</a></h4><p>Since the traditional <code>command + c | command + v</code> is just copy the reference of file into clipboard, instead of the content itself, we had no way to use <code>pbcopy</code> to copy a file, and then use <code>command + v</code> to paste at another place.</p><p>A solution is to use osascript.</p><div class="language-osascript codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-osascript codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/osascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on run args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set abs_path to do shell script &quot;/usr/local/bin/greadlink -f -- &quot; &amp; (first item of args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set the clipboard to POSIX file abs_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://apple.stackexchange.com/questions/15318/how-to-use-terminal-to-copy-a-file-to-the-clipboard" target="_blank" rel="noopener noreferrer">mac - How to use terminal to copy a file to the clipboard? - Ask Different</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-show-file-size">how to show file size<a class="hash-link" href="#how-to-show-file-size" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># -l show detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -h show &#x27;human readable size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -lh FILE/DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.tutorialrepublic.com/faq/how-to-make-ls-command-to-show-file-sizes-in-megabytes-in-ubuntu.php" target="_blank" rel="noopener noreferrer">How to Make ls Command to Show File Sizes in Megabytes in Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-compare-between-files-diff--vimdiff">how to compare between files (<code>diff</code> &amp; <code>vimdiff</code>)<a class="hash-link" href="#how-to-compare-between-files-diff--vimdiff" title="标题的直接链接">​</a></h3><ul><li>see: <a href="https://stackoverflow.com/questions/17195308/unix-diff-side-to-side-results" target="_blank" rel="noopener noreferrer">bash - unix diff side-to-side results? - Stack Overflow</a></li></ul><p>There is a few of <code>diff</code> commands for us to choose.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-diff-f1-f2">resolution 1: <code>diff F1 F2</code><a class="hash-link" href="#resolution-1-diff-f1-f2" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517649112-cb2bf00d7a0d7d954fdc039c3862869a96a67c75fc4190101616cd5b3ad0495a.png" alt="picture 9" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-diff--y-f1-f2-or-sdiff-f1-f2">resolution 2: <code>diff -y F1 F2</code> or <code>sdiff F1 F2</code><a class="hash-link" href="#resolution-2-diff--y-f1-f2-or-sdiff-f1-f2" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517708938-fd8d1056dcc311fca0ff60316445a2fea77f670b4d7353cea9d6034775beb75a.png" alt="picture 10" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-3-vimdiff-f1-f2">resolution 3: <code>vimdiff F1 F2</code><a class="hash-link" href="#resolution-3-vimdiff-f1-f2" title="标题的直接链接">​</a></h4><p>It&#x27;s awesome! Isn&#x27;t it?</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517738027-4beec462aa9bda3ff2127c563de64a20d8703edc7774603372fce03807992a96.png" alt="picture 12" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="todo-resolution-4-git-diff">TODO: resolution 4: git diff<a class="hash-link" href="#todo-resolution-4-git-diff" title="标题的直接链接">​</a></h4><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-how-to-copymove-directory-files-correctly-to-soft-links-under-target-directory-without-affecting-git">FIXME: how to copy/move directory files correctly to soft links under target directory without affecting git?<a class="hash-link" href="#fixme-how-to-copymove-directory-files-correctly-to-soft-links-under-target-directory-without-affecting-git" title="标题的直接链接">​</a></h3><p>example:</p><p>When I zipped one modified <code>frameworks/native</code> directory to be e.g. <code>RAW</code>, and then reset the <code>frameworks/native</code> to be the init.</p><p>Then I move all the files under <code>RAW</code> to <code>frameworks/native</code> with the command:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp -r RAW/* TARGET/frameworks/native/</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error arose up since there are soft links under <code>frameworks/native</code>, such as <code>libs/ui</code> which is indeed <code>libs/ui -&gt; XXX/ui</code>.</p><p>However, in my zipped file of <code>RAW</code>, the links seemingly have turned to be the real files/dirs, which introduced the problem <code>directory --&gt; non-directory</code>.</p><p>The wanted effect is copying/moving all the files under conflicted directory to where they should be.</p><p>However, the git marked those files as <code>TypeChange</code>...</p><p>ref:</p><ul><li><p><a href="https://superuser.com/questions/1395407/cp-cannot-overwrite-directory-with-non-directory/1395410" target="_blank" rel="noopener noreferrer">linux - cp: cannot overwrite directory with non-directory - Super User</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/555985/cp-recursively-into-a-directory-that-symlinks-to-dirs-of-same-name-as-in-source" target="_blank" rel="noopener noreferrer">cp recursively into a directory that symlinks to dirs of same name as in source - Unix &amp; Linux Stack Exchange</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-disk-management">BEST-PRACTICE: linux disk management<a class="hash-link" href="#best-practice-linux-disk-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ncdu-disk-space-tui"><code>ncdu</code>, disk space tui<a class="hash-link" href="#ncdu-disk-space-tui" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="baobab-disk-space-gui"><code>baobab</code>, disk space gui<a class="hash-link" href="#baobab-disk-space-gui" title="标题的直接链接">​</a></h3><p>ref:</p><ul><li><p><a href="https://askubuntu.com/questions/73160/how-do-i-find-the-amount-of-free-space-on-my-hard-drive" target="_blank" rel="noopener noreferrer">disk usage - How do I find the amount of free space on my hard drive? - Ask Ubuntu</a></p></li><li><p><a href="https://formulae.brew.sh/formula/baobab" target="_blank" rel="noopener noreferrer">baobab — Homebrew Formulae</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="install-problem">install problem<a class="hash-link" href="#install-problem" title="标题的直接链接">​</a></h4><p>When installing <code>ncdu</code>, error ocurred: <a href="https://stackoverflow.com/questions/44678437/no-such-file-or-directory-rb-sysopen-ruby" target="_blank" rel="noopener noreferrer">No such file or directory @ rb_sysopen ruby - Stack Overflow</a></p><p>The reason is that some dependency is missing, we can first install it and then install the target.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install librsvg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install baobab</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="effects">effects<a class="hash-link" href="#effects" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642600987157-8df330aac5a1fedd7d6c5f6d46f98256fedfcfa18b3f4f3ba05914fc06e19ac4.png" alt="picture 7" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-shells-management">BEST-PRACTICE: linux shells management<a class="hash-link" href="#best-practice-linux-shells-management" title="标题的直接链接">​</a></h2><p>ref:</p><p>this article is enough and recommended:</p><ul><li><p><a href="https://www.cyberciti.biz/faq/how-to-change-shell-to-bash/" target="_blank" rel="noopener noreferrer">How To Change Shell To Bash in Linux / Unix - nixCraft</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/140286/how-to-find-list-of-available-shells-by-command-line" target="_blank" rel="noopener noreferrer">How to find list of available shells by command-line? - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://www.cyberciti.biz/tips/how-do-i-find-out-what-shell-im-using.html" target="_blank" rel="noopener noreferrer">How do I find out what shell I am using on Linux/Unix? - nixCraft</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="list-all-the-shells">list all the shells<a class="hash-link" href="#list-all-the-shells" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /etc/shells # list valid login shells</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/rbash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/dash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="background-sh-is-different-with-bash">background: <code>sh</code> is different with <code>bash</code><a class="hash-link" href="#background-sh-is-different-with-bash" title="标题的直接链接">​</a></h3><p>When I write <code>source</code> in shell script, and run by <code>sh xx.sh</code>, then it failed with <code>no permission</code>.</p><p>However, when I use <code>bash xx.sh</code>, then everything runs well.</p><p>Thus, the <code>sh</code> definitely doesn&#x27;t equal as <code>bash</code>, and it seems that function of <code>sh</code> is the subset of <code>bash</code>.</p><p>If so, why I still need to use <code>sh</code>? Just for short?</p><img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640152196813-linux-howto-84174e9e7dbb6fcc489b015f68e1c88b23fc19874bfcba40c3171f17cc8051a1.png" width="480" class="img_vXGZ"><p>ref: <a href="https://stackoverflow.com/a/48785960/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/48785960/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="see-whats-the-current-shell">see what&#x27;s the current Shell<a class="hash-link" href="#see-whats-the-current-shell" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">[1:42:41]:~$ echo $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1:43:25]:~$ echo $0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1:43:29]:~$ ps -p $$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PID TTY          TIME CMD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 29657 pts/2    00:00:00 zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="switch-shell">switch shell<a class="hash-link" href="#switch-shell" title="标题的直接链接">​</a></h3><p>You can change your default shell using the chsh (“change shell” ) command as follows.</p><p>The syntax is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s {shell-name-here}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s {shell-name-here} {user-name-here}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s /bin/bash $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="set-zsh-as-the-default-terminal-need-re-login">set zsh as the default terminal (need re-login)<a class="hash-link" href="#set-zsh-as-the-default-terminal-need-re-login" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s $(which zsh)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://askubuntu.com/questions/131823/how-to-make-zsh-the-default-shell" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/131823/how-to-make-zsh-the-default-shell</a></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-terminal-management">BEST-PRACTICE: linux terminal management<a class="hash-link" href="#best-practice-linux-terminal-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-the-terminal-cannot-up-down-after-editing">✅ the terminal cannot up down after editing<a class="hash-link" href="#-the-terminal-cannot-up-down-after-editing" title="标题的直接链接">​</a></h3><p>This is a problem confused me for a long time.</p><p>Today, I finally knows what&#x27;s the hell at: <a href="https://stackoverflow.com/questions/18489216/how-to-scroll-up-and-down-in-sliced-screen-terminal" target="_blank" rel="noopener noreferrer">linux - How to scroll up and down in sliced &quot;screen&quot; terminal - Stack Overflow</a></p><p>Anyway, terminal is hard to learn, I just know <code>control + a</code> can help me exit the so-called copy mode.</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="todo-bind-option--arrow-to-jump-word-in-zsh-on-ubuntu-vmware-on-macos">TODO: bind <code>option + arrow</code> to jump word in zsh on ubuntu vmware on MacOS<a class="hash-link" href="#todo-bind-option--arrow-to-jump-word-in-zsh-on-ubuntu-vmware-on-macos" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li>✨ <a href="https://help.ubuntu.com/stable/ubuntu-help/shell-keyboard-shortcuts.html.en" target="_blank" rel="noopener noreferrer">Useful keyboard shortcuts</a></li><li><a href="https://www.google.com/search?newwindow=1&amp;sxsrf=AOaemvJocqqP64PM0tOaO5QuVGhGgwR1kw%3A1643272448532&amp;lei=AFnyYY_8H8G4mAWLj7C4Cg&amp;q=zsh%20jump%20word&amp;ved=2ahUKEwiP_MD0wtH1AhVBHKYKHYsHDKcQsKwBKAN6BAg-EAQ&amp;biw=1629&amp;bih=945&amp;dpr=2.2" target="_blank" rel="noopener noreferrer">zsh jump word - Google Search</a></li><li><a href="https://superuser.com/questions/427163/altarrow-moving-between-words-in-zsh-and-iterm2" target="_blank" rel="noopener noreferrer">keyboard shortcuts - ALT+arrow moving between words in zsh and iTerm2 - Super User</a></li><li><a href="https://support.apple.com/en-hk/guide/terminal/trmlshtcts/mac" target="_blank" rel="noopener noreferrer">Keyboard shortcuts in Terminal on Mac - Apple Support (HK)</a></li><li><a href="https://superuser.com/questions/349439/how-to-bind-command-key-in-zsh" target="_blank" rel="noopener noreferrer">key binding - How to bind command key in zsh? - Super User</a></li><li><a href="https://gist.github.com/YumaInaura/27bb1f79881a63bed2fb9635cbaed73b" target="_blank" rel="noopener noreferrer">Zsh — Mac OS option key for bindkey</a></li><li><a href="https://www.google.com/search?q=what+key+i%27m+pressing&amp;oq=what+key+i+am&amp;aqs=chrome.1.69i57j0i10j0i22i30l8.6503j0j4&amp;sourceid=chrome&amp;ie=UTF-8" target="_blank" rel="noopener noreferrer">what key i&#x27;m pressing - Google Search</a></li><li><a href="https://en.key-test.ru/" target="_blank" rel="noopener noreferrer">&quot;Key-Test&quot; - keyboard test online</a></li><li><a href="https://unix.stackexchange.com/questions/58870/ctrl-left-right-arrow-keys-issue" target="_blank" rel="noopener noreferrer">zsh - Ctrl + left/right arrow keys issue - Unix &amp; Linux Stack Exchange</a></li><li><a href="https://stackoverflow.com/questions/12382499/looking-for-altleftarrowkey-solution-in-zsh" target="_blank" rel="noopener noreferrer">shell - Looking for ALT+LeftArrowKey solution in zsh - Stack Overflow</a></li><li><a href="https://unix.stackexchange.com/questions/94331/how-can-i-delete-a-word-backward-at-the-command-line-bash-and-zsh" target="_blank" rel="noopener noreferrer">keyboard shortcuts - How can I delete a word backward at the command line (bash and zsh)? - Unix &amp; Linux Stack Exchange</a></li><li><a href="https://askubuntu.com/questions/1017287/how-to-delete-words-in-the-terminal-with-ctrl-backspace-like-in-the-rest-of-ubun" target="_blank" rel="noopener noreferrer">command line - How to delete words in the terminal with Ctrl-Backspace like in the rest of Ubuntu? - Ask Ubuntu</a></li><li><a href="https://askubuntu.com/questions/162247/why-does-ctrl-left-arrow-not-skip-words" target="_blank" rel="noopener noreferrer">12.04 - Why does ctrl + left arrow not skip words? - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-commands-management">BEST-PRACTICE: linux commands management<a class="hash-link" href="#best-practice-linux-commands-management" title="标题的直接链接">​</a></h2><blockquote><p>⚠️</p><ol><li>be careful to use `<!-- -->`<!-- -->` in terminal / shell since it&#x27;s would be treated as executable commands: <img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1641501462043-6790c46051fa5db1246b560e795c5b1737d5e508faf7a9247b1c52e1ce4abdbc.png" class="img_vXGZ"><br>see: <a href="https://blog.csdn.net/Luckiers/article/details/103501168" target="_blank" rel="noopener noreferrer">(20 条消息) shell 基础知识-echo 及单引号、反引号和双引号详解<!-- -->_<!-- -->Luckiers 的博客-CSDN 博客<!-- -->_<!-- -->echo 单引号和双引号</a></li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-auto-input-in-command">how to auto input in command<a class="hash-link" href="#how-to-auto-input-in-command" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-input-password-for-sudo-commands">auto input password for sudo commands<a class="hash-link" href="#auto-input-password-for-sudo-commands" title="标题的直接链接">​</a></h4><blockquote><p>sparkles: Use <code>sudo -S</code> to read input from stdin.</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$USER ALL=(ALL:ALL) NOPASSWD: ALL&quot; | sudo tee -a /etc/sudoers.d/$USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://superuser.com/questions/67765/sudo-with-password-in-one-command-line" target="_blank" rel="noopener noreferrer">shell - sudo with password in one command line? - Super User</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-yes-for-some-command-yes--">auto yes for some command (<code>yes | </code>)<a class="hash-link" href="#auto-yes-for-some-command-yes--" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yes | COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yes | sh ./install.sh # install oh-my-zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/7642674/how-do-i-script-a-yes-response-for-installing-programs/34176780" target="_blank" rel="noopener noreferrer">linux - How do I script a &quot;yes&quot; response for installing programs? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-yes-for-apt-installing-packages--y">auto yes for <code>apt</code> installing packages (<code>-y</code>)<a class="hash-link" href="#auto-yes-for-apt-installing-packages--y" title="标题的直接链接">​</a></h4><p>Just add a <code>-y</code> in the command.</p><p>Example:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y htop</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/448358/apt-get-install-with-assume-yes-is-still-prompting-me-to-install-dependencies" target="_blank" rel="noopener noreferrer">apt-get install with --assume-yes is still prompting me to install dependencies - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-search-commands-by-prefix-history-search-backwardforward">how to search commands by prefix (<code>history-search-backward/forward</code>)<a class="hash-link" href="#how-to-search-commands-by-prefix-history-search-backwardforward" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ~/.inputrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Respect default shortcuts.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$include /etc/inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># choice 1: recommended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;\e[A&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backward     </span><span class="token comment" style="color:#999988;font-style:italic"># arrow up      --&gt; backward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;\e[B&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forward      </span><span class="token comment" style="color:#999988;font-style:italic"># arrow down    --&gt; forward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># choice 2: if prefer to the page up/down</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;\e[5~&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backward    </span><span class="token comment" style="color:#999988;font-style:italic"># page up       --&gt; backward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">&quot;\e[6~&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forward     </span><span class="token comment" style="color:#999988;font-style:italic"># page down     --&gt; forward</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>;warning: you should <strong>Close and re-open all terminals for the new behavior to become effective.</strong></p></blockquote><p>ref:</p><ul><li><p><a href="https://askubuntu.com/a/59855" target="_blank" rel="noopener noreferrer">https://askubuntu.com/a/59855</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/231605/search-for-a-previous-command-with-the-prefix-i-just-typed" target="_blank" rel="noopener noreferrer">bash - Search for a previous command with the prefix I just typed - Unix &amp; Linux Stack Exchange</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-repeat-command">how to repeat command<a class="hash-link" href="#how-to-repeat-command" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">#  only show the last result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch -n X command # X: X seconds; command may need quotes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># show all the result history</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while true; do command; sleep X; done; # command may need quotes</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/430382/repeat-a-command-every-x-interval-of-time-in-terminal" target="_blank" rel="noopener noreferrer">bash - Repeat a command every x interval of time in terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-use-variable-as-multi-args">how to use variable as multi args<a class="hash-link" href="#how-to-use-variable-as-multi-args" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># when there&#x27;s only one arg as a variable, it&#x27;s ok to directly use it, and the following two methods are equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGE_TO_INSTALL=&quot;vim&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGE_TO_INSTALL=vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y $PACKAGE_TO_INSTALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># However, if there are multi args as a variable, we need to use [`echo`](https://stackoverflow.com/a/30061925/9422455) to escape the &#x27;hidden quotes&#x27; if I didn&#x27;t understand wrongly. And also, the quotes can&#x27;t be omitted, or use slashes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL=&quot;vim git htop zsh terminator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL=vim\ git\ htop\ zsh\ terminator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y $(echo $INSTALLED_PACKAGES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Since the `echo` is not safe, another way is to use [`xargs`](https://stackoverflow.com/a/51242645/9422455), which seems more professional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL=&quot;vim git htop zsh terminator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $PACKAGE_TO_INSTALL | xargs sudo apt install -y</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><p><a href="https://stackoverflow.com/questions/9733338/shell-script-remove-first-and-last-quote-from-a-variable" target="_blank" rel="noopener noreferrer">string - Shell script - remove first and last quote (&quot;) from a variable - Stack Overflow</a></p></li><li><p><a href="https://stackoverflow.com/questions/30061682/bash-send-string-argument-as-multiple-arguments" target="_blank" rel="noopener noreferrer">bash send string argument as multiple arguments - Stack Overflow</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/637496/escaping-quotes-inside-a-quoted-string" target="_blank" rel="noopener noreferrer">shell - Escaping quotes inside a quoted string - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="http://mywiki.wooledge.org/BashFAQ/050" target="_blank" rel="noopener noreferrer">BashFAQ/050 - Greg&#x27;s Wiki</a></p></li><li><p><a href="https://stackoverflow.com/questions/5819423/bash-variables-with-spaces" target="_blank" rel="noopener noreferrer">Bash variables with spaces - Stack Overflow</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/327784/how-to-assign-a-string-with-multiple-spaces-to-a-variable-in-bash" target="_blank" rel="noopener noreferrer">shell script - How to assign a string with multiple spaces to a variable in bash? - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://stackoverflow.com/questions/7454526/variable-containing-multiple-args-with-quotes-in-bash" target="_blank" rel="noopener noreferrer">Variable containing multiple args with quotes in Bash - Stack Overflow</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-set-an-alias">how to set an alias<a class="hash-link" href="#how-to-set-an-alias" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-in-terminal">resolution 1: in terminal<a class="hash-link" href="#resolution-1-in-terminal" title="标题的直接链接">​</a></h4><blockquote><p>⚠️ this solution only works upon the next command, which can work immediately when executed in shell script file</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># don&#x27;t add any other characters after alias in order to catch bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias sed=gsed</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-write-into-bash_aliases">resolution 2: write into <code>~/.bash_aliases</code><a class="hash-link" href="#resolution-2-write-into-bash_aliases" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># ~/.bash_aliases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias update=&#x27;sudo yum update&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>⚠️ this solution needs to ensure the <code>.bash_aliases</code> enabled in <code>.bashrc</code></p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-howto-1643117544205-afe713493b26becfe498fda953bdc5c1d098accaf07b4e4b6b5e117b4d3671a1.png" alt="picture 47" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-resolution-3-use-bash_aliases-with-zsh">✨ resolution 3: use <code>.bash_aliases</code> with <code>zsh</code><a class="hash-link" href="#-resolution-3-use-bash_aliases-with-zsh" title="标题的直接链接">​</a></h4><p>Just add one line in <code>~/.zshrc</code>:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bash_aliases</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.cyberciti.biz/faq/create-permanent-bash-alias-linux-unix/" target="_blank" rel="noopener noreferrer">How to create a permanent Bash alias on Linux/Unix - nixCraft</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="unalias">unalias<a class="hash-link" href="#unalias" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unalias logout</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.tecmint.com/create-alias-in-linux/" target="_blank" rel="noopener noreferrer">How to Create and Use Alias Command in Linux</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-compare-between-outputs-from-two-commands">how to compare between outputs from two commands<a class="hash-link" href="#how-to-compare-between-outputs-from-two-commands" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">diff &lt;(ls old) &lt;(ls new)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/229447/how-do-i-diff-the-output-of-two-commands" target="_blank" rel="noopener noreferrer">How do I diff the output of two commands? - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-accounts-management">BEST-PRACTICE: linux accounts management<a class="hash-link" href="#best-practice-linux-accounts-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="init-user-with-root-config">init user with root config<a class="hash-link" href="#init-user-with-root-config" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">脚本：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER_=chuanmx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOME_=/home/$USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add user with password and home directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$USER_\n$USER_&quot; | sudo -S -k passwd $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -a -G dev $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mkdir $HOME_/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp -rf ~/.oh-my-zsh $HOME_/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp  ~/.zshrc $HOME_/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chsh --shell /bin/zsh $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable user grant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R $USER_:$USER_ $HOME_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># avoid typing password when using sudo command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$USER_  ALL=(ALL) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/$USER_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-create-user">how to create user<a class="hash-link" href="#how-to-create-user" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># create user with a home directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -la /home/$USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create user [under root]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create passwd [under root]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd $USER_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-log-out">how to log out<a class="hash-link" href="#how-to-log-out" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-1110-and-above">resolution 1 (11.10 and above)<a class="hash-link" href="#resolution-1-1110-and-above" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">gnome-session-quit</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2">resolution 2<a class="hash-link" href="#resolution-2" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/15795/how-can-you-log-out-via-the-terminal" target="_blank" rel="noopener noreferrer">command line - How can you log out via the terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="set-a-shorter-password-for-ubuntu">set a shorter password for ubuntu<a class="hash-link" href="#set-a-shorter-password-for-ubuntu" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd &lt;USER&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642479990429-35424184b62d147dc0744f2bcb9bca97f27b9efc9df47373a458c76442b30003.png" alt="picture 7" class="img_vXGZ"></p><ul><li><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/180402/how-to-set-a-short-password-on-ubuntu" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/180402/how-to-set-a-short-password-on-ubuntu</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-net-management">BEST-PRACTICE: linux net management<a class="hash-link" href="#best-practice-linux-net-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-my-public-ip-address">how to know my public ip address<a class="hash-link" href="#how-to-know-my-public-ip-address" title="标题的直接链接">​</a></h3><ul><li>resolution 1:</li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># https://apple.stackexchange.com/questions/20547/how-do-i-find-my-ip-address-from-the-command-line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl ifconfig.me</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>resolution 2:</li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># https://www.digitalocean.com/community/tutorials/how-to-configure-remote-access-for-mongodb-on-ubuntu-20-04#:~:text=curl%20%2D4%20icanhazip.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -4 icanhazip.com</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-monitor-network-traffic">how to monitor network traffic<a class="hash-link" href="#how-to-monitor-network-traffic" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install nethogs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nethogs</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/368002/network-usage-top-htop-on-linux" target="_blank" rel="noopener noreferrer">networking - Network usage top/htop on Linux - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-check-proxy">FIXME: check proxy<a class="hash-link" href="#fixme-check-proxy" title="标题的直接链接">​</a></h3><p>In <a href="https://releases.ubuntu.com/18.04/" target="_blank" rel="noopener noreferrer">Ubuntu 18.04.6 LTS (Bionic Beaver)</a>, it introduced two methods to see what/which proxies are we using:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">## approach 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $http_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## approach 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env | grep -i proxy</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, when I configured the proxies in <code>Manual Proxy</code>, I am surprised to find nothing using either commands in the above, while the ping to <code>google.com</code> does work so that I use it as the measure then.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ping google.com</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And another wield thing is before the system was restarted, the <code>env | grep -i proxy</code> even shows duplicated results and the change in <code>Manual Proxy</code> doesn&#x27;t work, which is quite confusing.</p><p>Maybe we can do more tests later.</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-datetime-management">BEST-PRACTICE: linux date/time management<a class="hash-link" href="#best-practice-linux-datetime-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-format-date-in-terminal">how to format date in terminal<a class="hash-link" href="#how-to-format-date-in-terminal" title="标题的直接链接">​</a></h3><blockquote><p>⚠️</p><ol><li>the space in formatter should be using <code>\ </code> or anything other ways</li><li><code>date</code>是一个函数，不是变量，变量采用<code>$XX</code>或者<code>${XX}</code>的形式，但是函数要用<code>$(XX)</code>，并且不能在字符串中</li></ol></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># directly output date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date +%Y-%m-%d\ %H:%M:%S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output date into variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T=&#x27;the date is &#x27;$(date +%Y-%m-%d\ %H:%M:%S)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/549415/how-to-concatenate-a-date-variable-and-string-variable-in-unix" target="_blank" rel="noopener noreferrer">shell script - How to concatenate a date variable and string variable in unix? - Unix &amp; Linux Stack Exchange</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-timezone-and-time">how to change timezone (and time)<a class="hash-link" href="#how-to-change-timezone-and-time" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-conclusion-directly-export">resolution 1 (conclusion): directly export<a class="hash-link" href="#resolution-1-conclusion-directly-export" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;export TZ=&#x27;Asia/Shanghai&#x27;\n&quot; &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER --force</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-detail-choose-following-directions">resolution 2 (detail): choose following directions<a class="hash-link" href="#resolution-2-detail-choose-following-directions" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># check current time, as well as timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date -R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if the ending is `+0800`, then it&#x27;s ok, otherwise you need to change (e.g. `-0800`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change timezone (just choose as directed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tzselect</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And finally you will get a command suggestion to write into profile file, that is <a href="#solution-1-directly-export">#solution-1-directly-export</a></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-system-management">BEST-PRACTICE: linux system management<a class="hash-link" href="#best-practice-linux-system-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-a-stop-job-is-running-for-session-c2-of-user--1min-30s">✅ <code>A stop job is running for Session c2 of user ... (1min 30s)</code><a class="hash-link" href="#-a-stop-job-is-running-for-session-c2-of-user--1min-30s" title="标题的直接链接">​</a></h3><blockquote><p>resolution</p></blockquote><ol><li>restart system</li><li><code>journalctl -p5</code></li><li>search <code>timed out. Killing</code></li><li>analyze the target process of <code>Killing process 1234 (jack_thru) with signal SIGKILL.</code></li></ol><blockquote><p>⚠️ 注意，也有其他几种解决方案，比如装<code>watchdog</code>和缩短<code>timeout</code>时间的，这些都侵入性太高了，并且不是治本之策，所以还是得从 log 来分析原因找对应政策。尤其是装<code>watchdog</code>的方案，我简单看了一下，大致是每分钟检查一下系统的情况，但问题是，为什么很久以前系统就没有这种问题呢？那个时候也没装 <code>watchdog</code> 啊，所以对于这个问题，我们不能偷懒!</p></blockquote><p>.</p><blockquote><p>result</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-bugfix-1643550947015-7ed703f287400ec8593914f35740044149d43c47e7b97df89135a6ffff3681a5.png" alt="picture 9" class="img_vXGZ"></p><p>It tells me the last one is because of <code>adb</code>, since I do open the <code>adb</code> and not responding then.</p><p>And I also checked the last few times when <code>timed out</code>, but to find they are different.</p><p>So I confirmed the timeout error is temporary, since now I am not going to run any <code>adb</code>.</p><p>I tried to restart again, and the system does well which identified what I think.</p><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://unix.stackexchange.com/questions/273876/a-stop-job-is-running-for-session-c2-of-user/297318" target="_blank" rel="noopener noreferrer">systemd - A stop job is running for Session c2 of user - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://qastack.cn/unix/273876/a-stop-job-is-running-for-session-c2-of-user" target="_blank" rel="noopener noreferrer">用户的会话 c2 正在运行停止作业</a></p></li><li><p><a href="https://bbs.archlinux.org/viewtopic.php?id=264233" target="_blank" rel="noopener noreferrer">systemd stop job for Session 2 on shutdown / Newbie Corner / Arch Linux Forums</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="-----------------------------------">-----------------------------------<a class="hash-link" href="#-----------------------------------" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-common-commands">BEST-PRACTICE: linux common commands<a class="hash-link" href="#best-practice-linux-common-commands" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtar">command:tar<a class="hash-link" href="#commandtar" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># x: extract, f: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xf FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># v: verbose, logging output, careful when extracting big files, e.g. AOSP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -vxf FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://linuxize.com/post/how-to-extract-unzip-tar-gz-file/" target="_blank" rel="noopener noreferrer">How to Extract (Unzip) Tar Gz File | Linuxize</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandperl">command:perl<a class="hash-link" href="#commandperl" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-use-perl-to-replace-multi-lines">how to use perl to replace multi-lines<a class="hash-link" href="#how-to-use-perl-to-replace-multi-lines" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">perl -0pe &#x27;s/search/replace/gms&#x27; file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><code>-0</code>: without the <code>-0</code> argument, Perl processes data line-by-line, which causes multiline searches to fail.</li><li><code>-p</code>: loop over all the lines of a file</li><li><code>-e</code>: execute the following arg as a perl script</li><li><code>/s</code>: changes the behavior of the dot metacharacter <code>.</code> so that it matches any character at all. Normally it matches anything except a newline &quot;\n&quot;, and so treats the string as a single line even if it contains newlines.</li><li><code>/m</code>: modifies the caret <code>^</code> and dollar <code>$</code> metacharacters so that they match at newlines within the string, treating it as a multi-line string. Normally they will match only at the beginning and end of the string.</li><li><code>/g</code>: global replace(not sure)</li></ol><p>ref:</p><ul><li><p>explaining <code>-0</code>: <a href="https://stackoverflow.com/questions/1030787/multiline-search-replace-with-perl" target="_blank" rel="noopener noreferrer">Multiline search replace with Perl - Stack Overflow</a></p></li><li><p>explaining <code>/m | /s</code>: <a href="https://stackoverflow.com/questions/22962588/understanding-perl-regular-expression-modifers-m-and-s" target="_blank" rel="noopener noreferrer">regex - Understanding Perl regular expression modifers /m and /s - Stack Overflow</a></p></li></ul><p>special thanks to: <a href="https://unix.stackexchange.com/a/378991" target="_blank" rel="noopener noreferrer">Not sure if you know, but sed has a great feature where you do not need to use a / as the separator.</a></p><ul><li><p><a href="https://www.mankier.com/1/perl#Description" target="_blank" rel="noopener noreferrer">perl man page - perl-interpreter - General Commands</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/555948/replace-multi-line-string-with-multi-line-string-without-escaping-by-hand" target="_blank" rel="noopener noreferrer">perl - Replace multi line string with multi line string without escaping by hand - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://www.runoob.com/perl/perl-regular-expressions.html" target="_blank" rel="noopener noreferrer">Perl 正则表达式 | 菜鸟教程</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/378990/find-and-replace-with-sed-with-slash-in-find-and-replace-string" target="_blank" rel="noopener noreferrer">quoting - find and replace with sed with slash in find and replace string - Unix &amp; Linux Stack Exchange</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandfind">command:find<a class="hash-link" href="#commandfind" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-ignore-case">how to ignore case<a class="hash-link" href="#how-to-ignore-case" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">find -iname</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/32155/find-command-how-to-ignore-case" target="_blank" rel="noopener noreferrer">Find command: how to ignore case? - Unix &amp; Linux Stack Exchange</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-specify-search-type">how to specify search type<a class="hash-link" href="#how-to-specify-search-type" title="标题的直接链接">​</a></h4><p>Use <code>-type</code> to specify the search type (default is <code>c</code> for <code>file</code>), here I used <code>d</code> for <code>directory</code>, ref: <a href="https://man7.org/linux/man-pages/man1/find.1.html#:~:text=true%20%20Always%20true.-,%2Dtype%20c,-File%20is%20of" target="_blank" rel="noopener noreferrer">find type</a></p><p>And then, when I search directory, it would search all the sub-folders with &#x27;/&#x27; concatenated, so I need to specify <code>-d 1</code> in order to only search the top current directory.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support find . -name &#x27;*electron*&#x27; -type d -d 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./electron-react-boilerplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./electron-react-typescript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support rm -rf electron-react-boilerplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support rm -rf electron-react-typescript</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir">how to exclude dir<a class="hash-link" href="#how-to-exclude-dir" title="标题的直接链接">​</a></h4><p>TODO: in fact, I really can&#x27;t catch why <code>-prune</code> is combined with <code>-o</code> (or)</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. use `-not -path`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find -name &quot;*.js` -not -path &quot;./directory/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. use `-path xx -prune`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path ./misc -prune -o -name &#x27;*.txt&#x27; -print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. use multiple prune (need to add escaped bracket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -type d \( -path ./dir1 -o -path ./dir2 -o -path ./dir3 \) -prune -o -name &#x27;*.txt&#x27; -print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. use regex prune (-name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -type d -name node_modules -prune -o -name &#x27;*.json&#x27; -print</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/4210042/how-to-exclude-a-directory-in-find-command" target="_blank" rel="noopener noreferrer">linux - How to exclude a directory in find . command - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="todo-how-to-find-file-with-time-used">TODO: how to find file with time used<a class="hash-link" href="#todo-how-to-find-file-with-time-used" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-find-efficiency-comparison">tip: find efficiency comparison<a class="hash-link" href="#tip-find-efficiency-comparison" title="标题的直接链接">​</a></h4><p>Use a specified directory is the best and fastest;</p><p>If not, limit the <code>maxdepth</code> to a number small enough is also ok;</p><p>And then consider the directory prune.</p><p>Finally bared run is the worst.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find .imgs  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find .imgs -name   0.00s user 0.00s system 52% cpu 0.005 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 3  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 3 -name   0.01s user 0.05s system 70% cpu 0.079 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 4  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 4 -name   0.06s user 0.69s system 87% cpu 0.854 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 5  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 5 -name   0.14s user 1.86s system 93% cpu 2.137 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 6  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 6 -name   0.26s user 3.21s system 94% cpu 3.683 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find .  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -name   0.44s user 5.85s system 51% cpu 12.172 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -path &#x27;./.imgs/*&#x27;  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path &#x27;./.imgs/*&#x27; -name   0.46s user 5.93s system 51% cpu 12.299 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -path &#x27;./.imgs/*&#x27;  ! -path &quot;**/node_modules/*&quot;  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path &#x27;./.imgs/*&#x27; ! -path &quot;**/node_modules/*&quot; -name   0.46s user 5.91s system 51% cpu 12.268 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandgrep">command:grep<a class="hash-link" href="#commandgrep" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir---exclude-dirdir">how to exclude dir (<code>--exclude-dir=dir</code>)<a class="hash-link" href="#how-to-exclude-dir---exclude-dirdir" title="标题的直接链接">​</a></h4><p>Recent versions of GNU Grep (&gt;= 2.5.2) provide:</p><p><code>--exclude-dir=dir</code></p><p>which excludes directories matching the pattern dir from recursive directory searches.</p><p>So you can do:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">grep -R --exclude-dir=node_modules &#x27;some pattern&#x27; /path/to/search</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/6565471/how-can-i-exclude-directories-from-grep-r" target="_blank" rel="noopener noreferrer">linux - How can I exclude directories from grep -R? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-limit-depth--maxdepth">how to limit depth (<code>-maxdepth</code>)<a class="hash-link" href="#how-to-limit-depth--maxdepth" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> find . -maxdepth 4 -type f -exec grep &quot;11.0.0_r1&quot; {}  \;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/111722/how-to-do-max-depth-search-in-ack-and-grep" target="_blank" rel="noopener noreferrer">How to do max-depth search in ack and grep? - Unix &amp; Linux Stack Exchange</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-grep-by-lines-context-is-much-faster-than-grep-by-words-context-and-even-better-for-output">tip: grep by lines context is MUCH FASTER than grep by words context, and even better for output<a class="hash-link" href="#tip-grep-by-lines-context-is-much-faster-than-grep-by-words-context-and-even-better-for-output" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb git:(main) ✗ time (cat release/build/mac/皇家小虎快递分析系统.app/Contents/Resources/app/dist/main/main.js | tr &quot;;&quot; &quot;\n&quot; | grep --context=3 &#x27;fake-database&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># var n=this&amp;&amp;this.__importDefault||function(e){return e&amp;&amp;e.__esModule?e:{default:e}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Object.defineProperty(t,&quot;__esModule&quot;,{value:!0}),t.isDbFinished=t.initDbUpdateResult=t.initDbInsertResult=t.DB_UPDATE_DECLINED=t.DB_UPDATED=t.DB_INSERT_DUPLICATED=t.DB_INSERT_SUCCESS=t.DB_UNKNOWN=t.DB_TIMEOUT=t.DB_TABLE_NOT_EXISTED=t.prisma=void 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># const i=r(72298),a=`file:${n(r(71017)).default.join(i.app.getPath(&quot;userData&quot;),&quot;express_match.sqlite.db&quot;)}?connection_limit=1`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># process.env.DATABASE_URL=a,console.log({__dirname,rawDBPath:&quot;file:dev.db?connection_limit=1&quot;,newDBPath:a}),t.prisma={erp:{create:()=&gt;{console.log(&quot;fake-database: creating one&quot;)},findMany:()=&gt;{console.log(&quot;fake-database: finding many&quot;)},upsert:()=&gt;{console.log(&quot;fake-database: upserting one&quot;)}}},t.DB_TABLE_NOT_EXISTED=&quot;DB_TABLE_NOT_EXISTED&quot;,t.DB_TIMEOUT=&quot;DB_TIMEOUT&quot;,t.DB_UNKNOWN=&quot;DB_UNKNOWN&quot;,t.DB_INSERT_SUCCESS=&quot;DB_INSERT_SUCCESS&quot;,t.DB_INSERT_DUPLICATED=&quot;DB_INSERT_DUPLICATED&quot;,t.DB_UPDATED=&quot;DB_UPDATED&quot;,t.DB_UPDATE_DECLINED=&quot;DB_UPDATE_DECLINED&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.initDbInsertResult=()=&gt;({nTotal:0,nInserted:0,nDuplicated:0,nTimeout:0,nUnknown:0,nTableNotExist:0})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.initDbUpdateResult=()=&gt;({nTotal:0,nUpdated:0,nDropped:0,nTimeout:0,nUnknown:0,nTableNotExist:0})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.isDbFinished=e=&gt;{let t=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">( cat  | tr &quot;;&quot; &quot;\n&quot; | grep --color=auto  --context=3 &#x27;fake-database&#x27;; )  0.20s user 0.01s system 121% cpu 0.169 total</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb git:(main) ✗ time ( grep -iEo &#x27;.{255}fake-database.{255}&#x27; release/build/mac/皇家小虎快递分析系统.app/Contents/Resources/app/dist/main/main.js | tr &#x27;;&#x27; &#x27;\n&#x27; )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># =`file:${n(r(71017)).default.join(i.app.getPath(&quot;userData&quot;),&quot;express_match.sqlite.db&quot;)}?connection_limit=1`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># process.env.DATABASE_URL=a,console.log({__dirname,rawDBPath:&quot;file:dev.db?connection_limit=1&quot;,newDBPath:a}),t.prisma={erp:{create:()=&gt;{console.log(&quot;fake-database: creating one&quot;)},findMany:()=&gt;{console.log(&quot;fake-database: finding many&quot;)},upsert:()=&gt;{console.log(&quot;fake-database: upserting one&quot;)}}},t.DB_TABLE_NOT_EXISTED=&quot;DB_TABLE_NOT_EXISTED&quot;,t.DB_TIMEOUT=&quot;DB_TIMEOUT&quot;,t.DB_UNKNOWN=&quot;DB_UNKNOWN&quot;,t.DB_INSERT_SUCCESS=&quot;D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">( grep --color=auto --exclude-dir={.bzr,CVS,.git,.hg,.svn,.idea,.tox} -iEo  t)  3.27s user 0.01s system 99% cpu 3.279 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-grep-by-negative-captured-group-needs-to-use-ggrep">tip: grep by negative captured group needs to use <code>ggrep</code><a class="hash-link" href="#tip-grep-by-negative-captured-group-needs-to-use-ggrep" title="标题的直接链接">​</a></h4><p>Examples Given the string foobarbarfoo:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">bar(?=bar)     # finds the 1st bar (&quot;bar&quot; which has &quot;bar&quot; after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bar(?!bar)     # finds the 2nd bar (&quot;bar&quot; which does not have &quot;bar&quot; after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;=foo)bar    # finds the 1st bar (&quot;bar&quot; which has &quot;foo&quot; before it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;!foo)bar    # finds the 2nd bar (&quot;bar&quot; which does not have &quot;foo&quot; before it)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also combine them:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># finds the 1st bar (&quot;bar&quot; with &quot;foo&quot; before it and &quot;bar&quot; after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;=foo)bar(?=bar)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/2973436/regex-lookahead-lookbehind-and-atomic-groups" target="_blank" rel="noopener noreferrer">lookaround - Regex lookahead, lookbehind and atomic groups - Stack Overflow</a></li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">grep -Pio &#x27;(?&lt;=heads\/)(.*?)(?=\n)&#x27; text.txt # P option instead of E</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref: <a href="https://stackoverflow.com/a/45534127/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/45534127/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtree">command:tree<a class="hash-link" href="#commandtree" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-display-chinese--n">how to display chinese (<code>-N</code>)<a class="hash-link" href="#how-to-display-chinese--n" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">tree -N</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://blog.csdn.net/cxrsdn/article/details/100006348" target="_blank" rel="noopener noreferrer">(23 条消息) linux 下 tree 命令中文字符乱码解决方案<!-- -->_<!-- -->cxrsdn 的博客-CSDN 博客<!-- -->_<!-- -->linux tree 中文</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir-i">how to exclude dir(<code>-I</code>)<a class="hash-link" href="#how-to-exclude-dir-i" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># use `|` to split choices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># exclude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree -I &quot;XXX|YYY&quot;   # maybe it means &#x27;ignore&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/61074/tree-command-for-multiple-includes-and-excludes" target="_blank" rel="noopener noreferrer">tree command for multiple includes and excludes - Unix &amp; Linux Stack Exchange</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandhead">command:head<a class="hash-link" href="#commandhead" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="head-basic-usage">head basic usage<a class="hash-link" href="#head-basic-usage" title="标题的直接链接">​</a></h4><p>head 这个命令行其实没有什么要讲的，用法非常简单。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># output the first 5 lines (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output the first N lines (replace &quot;N&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head -n &quot;N&quot; FILES</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-the-last-k-rows">how to exclude the last k rows<a class="hash-link" href="#how-to-exclude-the-last-k-rows" title="标题的直接链接">​</a></h4><p>但是今天 2022-01-26 碰到了一个问题，就是要获取前 n-1 行，然后试了 stackoverflow 上的方案好像都不对。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">head -n -1 FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>后来才知道，是因为 mac 的原因，要用<code>ghead</code>才行……</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install coreutils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghead -n -4 main.m</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而 <code>ghead</code> 是在 <code>coreutils</code> 里面，这个名字一看我就有，所以也不用装了。</p><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/16206507/head-command-to-skip-last-few-lines-of-file-on-mac-osx" target="_blank" rel="noopener noreferrer">shell - head command to skip last few lines of file on MAC OSX - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="discuss-use-head-or-sed">discuss: use <code>head</code> or <code>sed</code><a class="hash-link" href="#discuss-use-head-or-sed" title="标题的直接链接">​</a></h4><p>今天之所以用到 head 其实是因为我想对一个流做 sed 处理，但略去最后一行。</p><p>我一开始想用 sed 里的范围标识（地址），但一直没试出来。</p><p>后来我把地址标识换成最简单的<code>1,4s/find/replace/</code>之后才意识到，我的思路是不对的。</p><p><code>1,4</code>是一个确实被处理的范围选择，但结果就是，N 行中，前四行都被 sed 替换了，但是后面的行尽管没替换依旧会打印出来，而这正是 sed 的默认行为，它是一个流转换器。</p><p>那如果纯粹基于 sed，进行转换，并且去掉最后一行，就要用到<code>-o</code>结合好像是<code>/p</code>的 identifier，具体我也记不大清了。意思就是输出所有被匹配的行，但如果这样的话被匹配的行就会输出两遍了（两遍不必相同（NOT-SURE），一个是转换前，一个是转换后），所以另一个标识符就是阻止原内容的输出，这样就只输出匹配的行的处理结果。</p><p>所以，这个思路其实有问题，它可以对，也可以不对，它如果保证匹配 n-1 行，则对；否则就不满足需求了，我们的需求是处理前 n-1 行，并且不管匹配不匹配，都要输出，尽管实际上是都匹配的。</p><p>总之，理解到这层后，既可以用纯 sed 的方案，也可以用 head+sed 的方案，一个负责改，一个负责删即可，至于先后，结果都一样，也许 head 在前效率会更高一些。</p><p>所以，还是挺有意思的，这个。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtop">command:top<a class="hash-link" href="#commandtop" title="标题的直接链接">​</a></h3><p>Today(2022-01-27) I finally understood how to use the command of <code>top</code> (though <code>htop</code> is better for display but possibly more costly).</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-commands-1643248016619-b1ac7d3bcd2a9eb546a53a0e5da199d11d573f85a61a9317d679d002d98012fa.png" alt="picture 88" class="img_vXGZ"></p><p>I can switch the display format of memory usage when <code>top</code> has gone to the interactive interface.</p><p>The first option I can use is <code>E</code>, which allows to switch memory unit between <code>KiB | MiB | GiB | TiB</code>.</p><p>And the second option I can use is <code>m</code>, which switches the memory display type between pure text, columns graph and block graph.</p><blockquote><p>⚠️</p><ol><li>不可以在命令行中直接用 <code>top -M</code> （显示以<code>MB</code>为单位的内存使用量），因为<code>top -h</code>的帮助中写的很清楚，只支持部分选项。在 stackoverflow 上有 <code>top -M</code> 的建议(see: <a href="https://unix.stackexchange.com/questions/105908/how-to-display-meminfo-in-megabytes-in-top" target="_blank" rel="noopener noreferrer">linux - How to display meminfo in megabytes in top? - Unix &amp; Linux Stack Exchange</a>)，但可能我的版本（Ubuntu 18）不支持。正确的做法，是先进入<code>top</code>交互界面，然后按<code>E</code>，这样就会切换单位，比如按两次切换到<code>GB</code>单位。另外，独立的，还可以按<code>m</code>去切换内存的显示样式，比如像<code>htop</code>那种竖条状！</li><li>以上只在 ubuntu 上测试通过，在 mac 上我刚试了，不行！所以到底怎么用命令，还得根据平台自身！</li><li>具体的，可以通过 <code>COMMAND -h</code>去看简洁版的帮助页面，或者<code>man COMMAND</code> (e.g. <a href="https://manpages.ubuntu.com/manpages/bionic/en/man1/top.1.html" target="_blank" rel="noopener noreferrer">Ubuntu Manpage: top - display Linux processes</a>) 去看完整版的帮助页面！</li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandcat">command:cat<a class="hash-link" href="#commandcat" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-write-raw-string-into-file-using-cat">how to write raw string into file using <code>cat</code><a class="hash-link" href="#how-to-write-raw-string-into-file-using-cat" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOPATH=$HOME/my-go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export GOPATH=$GOPATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/2500436/how-does-cat-eof-work-in-bash" target="_blank" rel="noopener noreferrer">linux - How does &quot;cat \&lt;\&lt; EOF&quot; work in bash? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="usage-how-to-know-whats-the-bash-string">usage: how to know what&#x27;s the bash string<a class="hash-link" href="#usage-how-to-know-whats-the-bash-string" title="标题的直接链接">​</a></h4><p>When using <code>bash</code> or <code>zsh</code>, we are supposed to use the function of <code>bindKey</code>.</p><p>However, the key we typed are always hard to remember, e.g. what&#x27;s the <code>ctrl</code> key?</p><p>Luckily, there&#x27;s a super easy (and also interactive) way for us to know it via <code>cat</code>, just to type <code>cat</code> followed by <code>enter</code> in terminal, and then the terminal would display what the character would be when we typing them.</p><p>E.g. here is what&#x27;s the result when we combine <code>control | option | command</code> with arrow left and arrow right would be:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-commands-1643287045491-0d652ec4cf50fd00bdfe265d1bcbc4df4482ffc562e30624d26218fd2d841adf.png" alt="picture 114" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandunzip">command:Unzip<a class="hash-link" href="#commandunzip" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-unzip-to-specific-directory">how to unzip to specific directory<a class="hash-link" href="#how-to-unzip-to-specific-directory" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">unzip file.zip -d TARGET_DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/994611/how-to-unzip-into-a-given-directory" target="_blank" rel="noopener noreferrer">bash - How to unzip into a given directory - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandkill">command:kill<a class="hash-link" href="#commandkill" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> ps aux  |  grep -i  electron |  awk &#x27;{print $2}&#x27;  |  xargs sudo kill -9</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><p><a href="https://stackoverflow.com/a/30486159/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/30486159/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandscp">command:scp<a class="hash-link" href="#commandscp" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R USER_NAME REMOTE_FOLDER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod 777 REMOTE_FOLDER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the <code>-R</code> means &quot;recursively&quot; since there may be file deeply in the target folder that won&#x27;t allow you to write.</p><p>Hence, you can know, you can specifically claim your authority on the file or directory, since it would not automatically transfer.</p><p>Thus, a flexible approach is that just add a <code>-R</code> flag.</p><p>reference: <a href="https://unix.stackexchange.com/a/347412" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/a/347412</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandlsof">command:lsof<a class="hash-link" href="#commandlsof" title="标题的直接链接">​</a></h3><p>check status of port occupation</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">lsof -i:8888</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandufw">command:ufw<a class="hash-link" href="#commandufw" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># check status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># white list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://blog.csdn.net/jiaochiwuzui/article/details/80907521" target="_blank" rel="noopener noreferrer">(20 条消息) Ubuntu 防火墙的开启，关闭，端口的打开，查看<!-- -->_<!-- -->jiaochiwuzui 的博客-CSDN 博客<!-- -->_<!-- -->ubuntu 查看防火墙开启的端口</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtime">command:time<a class="hash-link" href="#commandtime" title="标题的直接链接">​</a></h3><p>I can directly using <code>time ( COMMAND_1 | COMMAND_2 )</code>, so that it can calculate the final time of this pipe.</p><p>However, time calculation is a little more sophisticated than what would I have thought, refer more to: <a href="https://unix.stackexchange.com/questions/364156/how-can-i-time-a-pipe/364157" target="_blank" rel="noopener noreferrer">bash - How can I time a pipe? - Unix &amp; Linux Stack Exchange</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtr">command:tr<a class="hash-link" href="#commandtr" title="标题的直接链接">​</a></h3><p>It&#x27;s useful to split line to lines.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo &quot;111;222;333&quot; | tr &#x27;;&#x27; &#x27;\n&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">222</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">333</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># use `nl` to add the line number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat main.js | tr &#x27;;&#x27; &#x27;\n&#x27; | nl -ba | head -6</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandcd">command:cd<a class="hash-link" href="#commandcd" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="usage-a-superb-scene-using-cd-">usage: a superb scene using <code>cd .</code><a class="hash-link" href="#usage-a-superb-scene-using-cd-" title="标题的直接链接">​</a></h4><img loading="lazy" alt="picture 10" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-howto-1641284537356-d66d64fc07918dc1e98e62dd2dd70454a9ff16b2b2cc6da39fe18cbc6a5b07a1.png" width="480" class="img_vXGZ"><p>ref:</p><ul><li><a href="https://superuser.com/questions/702402/how-do-i-refresh-directory-in-bash" target="_blank" rel="noopener noreferrer">linux - How do I refresh directory in BASH? - Super User</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandsed">command:sed<a class="hash-link" href="#commandsed" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="noopener noreferrer">✨✨✨ sed, a stream editor✨✨✨</a></p></li><li><p><a href="https://www.grymoire.com/Unix/Sed.html" target="_blank" rel="noopener noreferrer">Sed - An Introduction and Tutorial</a></p></li><li><p><a href="https://www.mankier.com/1/sed" target="_blank" rel="noopener noreferrer">sed man page - General Commands | ManKier</a></p></li></ul><p>a good start:</p><ul><li><a href="https://www.geeksforgeeks.org/sed-command-in-linux-unix-with-examples/" target="_blank" rel="noopener noreferrer">Sed Command in Linux/Unix with examples - GeeksforGeeks</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-print-only-matched-lines">how to print only matched lines<a class="hash-link" href="#how-to-print-only-matched-lines" title="标题的直接链接">​</a></h4><ol><li><code>-n</code> means &quot;No automatically print the each line&quot;</li><li><code>/p</code> means &quot;Print the processed line&quot;</li></ol><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># print only the matched lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -n &quot;s|find|replace|p&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># don&#x27;t print any line (so useless)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -n &quot;s|find|replace|&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print all the line each, with matched line again(twice, and it&#x27;s the same)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed &quot;s|find|replace|p&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TODO: print the processed, and apply function on it.</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/17511639/sed-print-only-matching-group" target="_blank" rel="noopener noreferrer">regex - sed: print only matching group - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-how-to-increment-version-number">✨ how to increment version number<a class="hash-link" href="#-how-to-increment-version-number" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-use-echo-based-on-e">resolution 1: use <code>echo</code> based on <code>//e</code><a class="hash-link" href="#resolution-1-use-echo-based-on-e" title="标题的直接链接">​</a></h5><p>special thanks to: <a href="https://stackoverflow.com/a/14348899/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/14348899/9422455</a></p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-answer">resolution 2: answer<a class="hash-link" href="#resolution-2-answer" title="标题的直接链接">​</a></h5><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">gsed -i -E &#x27;s|(.*)&quot;version&quot;: &quot;([0-9]+)\.([0-9]+)\.([0-9]+)&quot;|echo &quot;\1\\&quot;version\\&quot;: \\&quot;\2.\3.$((\4+1))\\&quot;&quot;|e&#x27; package.json</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>test what happened using <code>//pe</code></p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb_sqlite git:(main) head -3 release/app/package.json                                                                                                                                           [7-01-22 | 4:18:17]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;mark.hjxh.express_match&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;0.2.2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb_sqlite git:(main) gsed -E &#x27;s|(.*)&quot;version&quot;: &quot;([0-9]+)\.([0-9]+)\.([0-9]+)&quot;|echo &quot;\1\\&quot;version\\&quot;: \\&quot;\2.\3.$((\4+1))\\&quot;&quot;|pe&#x27; release/app/package.json                                        [7-01-22 | 4:08:57]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;mark.hjxh.express_match&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;  \&quot;version\&quot;: \&quot;0.2.$((2+1))\&quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;0.2.3&quot;,</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>explanation</p></blockquote><p>In fact, the <code> &quot;version&quot;: &quot;0.2.2&quot;,</code> is changed into <code>echo &quot; \&quot;version\&quot;: \&quot;0.2.$((2+1))\&quot;&quot;,</code>.</p><p>And then the <code>e</code> syntax indicates run this sequency string as a command, so that it finally turns into <code> &quot;version&quot;: &quot;0.2.3&quot;,</code></p><blockquote><p>attention</p></blockquote><ol><li>the <code>&quot;</code> needs to be escaped, and to escape <code>&quot;</code>, we need to use a <code>\</code>, and to let the <code>\</code> work in the <code>echo</code> function, we need to escape it again, that is to be <code>\\&quot;</code></li><li><code>sed</code> will match all line (including the leading space), and the <code>e</code> would execute all line. So if I just replace the version number part into <code>echo &quot;\\&quot;0.2.3\\&quot;&quot;</code>, then all the line would turns into <code> &quot;version&quot;: echo &quot;\\&quot;0.2.3\\&quot;&quot;</code>, which is certainly unwanted and deserves reflection.</li></ol><blockquote><p>core ref</p></blockquote><p><a href="https://stackoverflow.com/questions/14348432/how-to-find-replace-and-increment-a-matched-number-with-sed-awk" target="_blank" rel="noopener noreferrer">bash - How to find/replace and increment a matched number with sed/awk? - Stack Overflow</a></p><p><code>perl | awk</code> alternative</p><ul><li><a href="https://stackoverflow.com/questions/8653126/how-to-increment-version-number-in-a-shell-script" target="_blank" rel="noopener noreferrer">bash - How to increment version number in a shell script? - Stack Overflow</a></li></ul><blockquote><p>official hack way (but I failed)</p></blockquote><p>sh #!/usr/bin/sed -f</p><p>/<sup id="fnref-0-9-ccff32"><a href="#fn-0-9-ccff32" class="footnote-ref">0-9</a></sup>/ d</p><h1>replace all trailing 9s by <!-- -->_<!-- --> (any other character except digits, could</h1><h1>be used)</h1><p>:d s/9<!-- -->(<em>*<!-- -->)<!-- -->$/</em>\1/ td</p><h1>incr last digit only. The first line adds a most-significant</h1><h1>digit of 1 if we have to add a digit.</h1><p>s/^<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/1\1/; tn s/8<!-- -->(<strong>)<!-- -->$/9\1/; tn s/7<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/8\1/; tn s/6<!-- -->(</strong>)<!-- -->$/7\1/; tn s/5<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/6\1/; tn s/4<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/5\1/; tn s/3<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/4\1/; tn s/2<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/3\1/; tn s/1<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/2\1/; tn s/0<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/1\1/; tn</p><p>:n y/<!-- -->_<!-- -->/0/</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [sed, a stream editor](https://www.gnu.org/software/sed/manual/sed.html#Increment-a-number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### how to match digits (`[0-9]` or `:digit:`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ref:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thanks for the direction to sed official documentation in this post.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [regex - Why doesn&#x27;t `\d` work in regular expressions in sed? - Stack Overflow](https://stackoverflow.com/questions/14671293/why-doesnt-d-work-in-regular-expressions-in-sed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### how to insert text before first line of file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suppose the text is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind base;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind utilities;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and the file is <code>public/style.css</code></p><p>first, export this variable for better understanding of commands:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">T=&#x27;@tailwind base;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind utilities;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F=&#x27;public/style.css&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and copy file as a backup:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp $F ${F}_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then the reset command is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp ${F}_ $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-use-cat-and-">resolution 1: use <code>cat</code> and <code>;</code><a class="hash-link" href="#resolution-1-use-cat-and-" title="标题的直接链接">​</a></h5><p>The <code>cat</code> approach meets our intuition, but needs a temp file.</p><p>First, we dump the <code>T</code> into <code>temp</code> file, then append <code>F</code> into temp, finally replace <code>F</code> with temp, that is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T &gt; temp; cat $F &gt;&gt; temp; mv temp $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be careful about the second operator of <code>&gt;&gt;</code> since it means <code>append</code> otherwise the <code>$T</code> would be flushed, then <code>$F</code> keeps unchanged.</p><p>refer:</p><ul><li><a href="https://unix.stackexchange.com/questions/159513/what-are-the-shells-control-and-redirection-operators" target="_blank" rel="noopener noreferrer">What are the shell&#x27;s control and redirection operators? - Unix &amp; Linux Stack Exchange</a></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-use-cat-and-">resolution 2: use <code>cat</code> and <code>|</code><a class="hash-link" href="#resolution-2-use-cat-and-" title="标题的直接链接">​</a></h5><p>In last solution, we used 2 &#x27;;&#x27;, and there is an easy way to change it to just 1 &#x27;;&#x27;.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | cat - $F &gt; temp; mv temp $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this solution, the <code>$T</code> echoed into second pipe, and <code>cat</code> used <code>-</code> to capture it then joined with <code>$F</code> and dumped into temp, which surely is faster.</p><p>refer:</p><ul><li><p><a href="https://superuser.com/questions/1388584/what-does-the-last-hyphen-mean-in-options-of-bash" target="_blank" rel="noopener noreferrer">linux - What does the last &quot;-&quot; (hyphen) mean in options of <code>bash</code>? - Super User</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/16357/usage-of-dash-in-place-of-a-filename" target="_blank" rel="noopener noreferrer">shell - Usage of dash (-) in place of a filename - Unix &amp; Linux Stack Exchange</a></p></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-3-use-sed-s-command">resolution 3: use sed s-command<a class="hash-link" href="#resolution-3-use-sed-s-command" title="标题的直接链接">​</a></h5><p>In the above 2 solutions, we both need an IO, i.e. first saving into a &#x27;temp&#x27; file and move to override the raw file, which could be low-efficiently and not elegant.</p><p>There&#x27;s a way allowing us to finish the &#x27;join&#x27; action just in the pipe and finally leads to inplace-modify target file. That is &quot;sed&#x27;s s-command&quot;.</p><img loading="lazy" alt="picture 24" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379168300-linux-howto-90b435ef191284a35f21cb8cac698769b8548bfe2b3f90db2be5ea988a56c636.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 25" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379622241-linux-howto-e51b228ec26d453924d9731bc86f94185eccbc8ea4d43954698c4217845ca262.png" width="480" class="img_vXGZ"><p>When using <code>s-command</code>, we can easily apply regex grammar to achieve what we want.</p><img loading="lazy" alt="picture 26" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379819166-linux-howto-c717ac5a605fb416fa2f472e202a74949ed8b34c3556d06ca6b70c8202d70901.png" width="480" class="img_vXGZ"><p>Like this, we can easily insert text in front of a sequency of text based on regex of &#x27;^&#x27;, which means the beginning of text.</p><p>And then, since the basic grammar of how to insert text before specific line of an input file in <code>sed</code> is <code>sed -i &#x27;Ni TEXT&#x27; $F</code> , the problem then converts to how to join &#x27;1i&#x27; with $T. That is what we just learned can be put into practice:</p><img loading="lazy" alt="picture 27" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640380337394-linux-howto-d8bfb544ab1b2db098a1fd9138401997b9b11814af6cbf639243453526a91c02.png" width="480" class="img_vXGZ"><p>You see, now all the commands have nothing to do with the io, and the principle behind this command chain is straightforward: join into <code>1i $T</code> then use it as <code>sed -i</code>’s parameter (via <code>-f-</code> which is the former pipe).</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-4-use-sed-e-command">resolution 4: use sed e-command<a class="hash-link" href="#resolution-4-use-sed-e-command" title="标题的直接链接">​</a></h5><img loading="lazy" alt="picture 16" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375147417-linux-howto-e0475887ff34e4a4a0be217c3596e054d2bdfa01f28f360f2459123e0b2175f7.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 17" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375169955-linux-howto-57609e425971259dd89c05c571047e701cb2c44dcc4deac43b0724a7295d8f44.png" width="480" class="img_vXGZ"><p>I&#x27;d think the e-command is quite confusing, but does good job.</p><p>I made some tests on the e-command to help myself understand.</p><p>In the above introduction, it indicates that if &#x27;without parameters, the e command executes the command that is found in space and replace the pattern space with the output&#x27;.</p><p>suppose we have <code>a=&#x27;aaa\necho &quot;bbb&quot; \nccc&#x27;</code>, then if we runs <code>echo $a | gsed &#x27;2e&#x27;</code>, that&#x27;s to say run the second line as a command and let others stay as what they are: <img loading="lazy" alt="picture 18" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375663511-linux-howto-18fd2906bf27a739476740fbe2c713a3c42b40de5865cebd14c08e696ed0b39a.png" width="480" class="img_vXGZ"></p><p>However, &#x27;if a parameter is specified, instead, the e command interprets it as a command and sends its output to the output stream.&#x27;</p><p>I made an example which may help us to understand what&#x27;s the mechanism of <code>gsed &#x27;ne xxx</code>, in which <code>xxx</code> is the so-called &#x27;parameter&#x27;.</p><img loading="lazy" alt="picture 19" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640376208972-linux-howto-5309698b6833082cf93b3b0f69cda3616678ad00d3e5141895bcec14b8684f57.png" width="480" class="img_vXGZ"><p>You can see, as the following shows, since a is a three-line text and sent into the pipe as stream, so first line shows &#x27;aaa&#x27;, and second line shows &#x27;echo &quot;bbb&quot;&#x27;, as what we preset.</p><p>The most notable point is that since <code>gsed</code> sets a <code>3e</code> command which means &#x27;it will execute following commands at 3rd row of stream&#x27;. Thus, the following commands <code>xxx\n echo &quot;yyy&quot;...</code> are executed as separate commands split by lines.</p><p>Obviously, neither <code>xxx</code> nor <code>zzz</code> is a valid command and turned into an error. Plus, since the level of error usually is a bit higher than normal output, the error of <code>zzz</code> came before <code>yyy</code> and then is <code>AAA</code>.</p><p>Finally, when all the commands were executed, the next stream in pipe came, i.e. <code>ccc</code>, and all the sequences came into end.</p><p>ref:</p><p><a href="https://www.gnu.org/software/sed/manual/sed.html#:~:text=by%20standard%20seds.-,e%20%5Bcommand%5D,-This%20command%20allows" target="_blank" rel="noopener noreferrer">sed e-command</a></p><p>Still, we had other topics to talk about.</p><img loading="lazy" alt="picture 20" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377292421-linux-howto-27ab701a1d1cca335a1476e71b742a60b9f6817b5d08521c70c766bfae21290d.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 22" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377315692-linux-howto-ea510349e79dd47d4ca01d17200defcf7e8b8b8ebda0b0785c1833ba932c625d.png" width="480" class="img_vXGZ"><p>We can know the classic usage of <code>sed</code> is <code>sed SCRIPT INPUTFILE</code>, and if <code>-e</code> option is used to specify a script, with all non-option parameters taken as input files.</p><p>So what would happen when we combine the <code>-e</code> and an input file.</p><p>Back to what we covered the above, we can move a step further now.</p><img loading="lazy" alt="picture 23" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377647537-linux-howto-8099c8c4212b90dd4f7fa22449dc22ef8135c485c97674a561b87769121c750b.png" width="480" class="img_vXGZ"><p>In this example, we can see that <code>gsed</code> first read one line from <code>../temp</code> file which is <code>AAA</code>, and then paused since the <code>2e</code> flag to execute <code>cat -</code> command which shows all the input stream from <code>echo $a</code>, and finally continued to read the remaining rows of <code>BBB</code> and <code>CCC</code>.</p><p>So what about if we specify a <code>-i</code> option, which means <code>change in position</code>?</p><p>It&#x27;s easy to understand, that is all the output would be sent into <code>../temp</code>, so that <code>../temp</code> changes to the output just like the result in this example shows.</p><p>Hence, we can derive from our conclusion: if we use the following command:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i &#x27;1e cat -&#x27;  $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then the goal of inserting text before first line can be achieved just on the fly~</p><p>How amazing and beautiful it is!</p><p>ref:</p><ul><li><a href="https://www.gnu.org/software/sed/manual/sed.html#:~:text=sed%20%C2%A0%20%5BContents%5D%5BIndex%5D-,2.1%20overview,-Normally%20sed%20is" target="_blank" rel="noopener noreferrer">gsed overview</a></li></ul><blockquote><p>conclusion</p></blockquote><p>G1. To insert lines at the beginning of one file:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. dump, dump, and move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T &gt; temp; cat $F &gt;&gt; temp; mv temp $F;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. join, dump, and move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | cat - $F &gt; temp; mv temp $F;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. [sed s-command] concat-string, inplace-insert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed &#x27;1s/^/1i /&#x27; | gsed -i -f- $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. [sed e-command] ... hard to conclude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i &#x27;1e cat -&#x27; $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G2. To insert lines at specific line:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. if text is single line, refer: https://stackoverflow.com/a/6537587/9422455</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsed -i &#x27;Ni $T&#x27; $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. if text is multi lines, refer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i &#x27;Ne cat -&#x27; $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>FIXME: (failed) G3. To insert content after matched position:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. [sed r-command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i &#x27;$P/r -&#x27; $F #  the &#x27;-&#x27; is same for &#x27;/dev/stdin&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G4. To insert multi lines manually:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1, when lines are already multiplied, just add `\` after each line, refer: https://askubuntu.com/a/702693</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2, when lines are in one, using `\n`, refer: https://askubuntu.com/a/702690</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G5. To insert lines after matched line with the same leading space format:</p><blockquote><p>⚠️ 嵌套 sed 正则注意事项</p><ol><li>输入的文本不能与分隔符相同，否则需要转义。比如本次为了在代码中加入注释<code>//</code>，就不方便用<code>/</code>当分隔符</li><li>嵌套正则的时候，为了能分清一级与二级，可以应用不同的分隔符，比如本次更新用了<code>|</code>作为一级，<code>_</code>作为二级</li></ol></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. [sed s-command] leading space align with $P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># failed at 2022-01-25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo $T | gsed &#x27;s/^.*$/s\/(^.*?)($P.*$)\/\\1\\2\\n\0\//&#x27; | gsed -E -f- $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># updated at 2022-01-25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed &#x27;s|^.*$|s_^(.*?)(&#x27;$P&#x27;.*)$_\\1\\2\\n\\1\0_|&#x27; | gsed -E -f- $F | grep --context=3 $T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># FIXME: (failed) 2. [sed s-command with named-pipe] [more straightforward]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;(echo -n &quot;s/(^.*?)($P.*?$)/\1\2\\\\n\1&quot; &amp; echo -n $T &amp; echo -n &quot;/&quot;) | gsed -E -f- $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 29" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640385997938-linux-howto-41e634caf1122f991d08d485202adfb56ab71cdfdb7d5ad76ad4f57ca751cbaa.png" width="480" class="img_vXGZ"><p>ref:</p><ul><li><a href="https://serverfault.com/questions/171095/how-do-i-join-two-named-pipes-into-single-input-stream-in-linux" target="_blank" rel="noopener noreferrer">shell - How do I join two named pipes into single input stream in linux - Server Fault</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2021/12/24/dev-webpack">编程 | 记与 Webpack 十二小时的奋战</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2021-12-24T00:00:00.000Z" itemprop="datePublished">2021/12/24</time> · <!-- -->阅读需 13 分钟</div></header><div class="markdown" itemprop="articleBody"><p>2021 年 12 月 24 日</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="content">Content<a class="hash-link" href="#content" title="标题的直接链接">​</a></h2><p>这篇必须用中文记录，而且直到目前还没有完全解决，只实现了一个还可以接受的替代方案，背后还有一些东西没弄明白。</p><p>先直接说结论：</p><ol><li>如果所有的依赖包都是<code>commonjs</code>形式（使用<code>require</code>和<code>module.export</code>），子包的<code>package.json</code>中没有定义<code>type: &quot;module&quot;</code>，则 webpack 无论怎么写，基本都不会出错，直接运行<code>webpack --config xxx.webpack.config.js</code>即可</li><li>如果<code>xxx.config.js</code>文件中使用了<code>import xxx from xx</code>或者子包都是用的<code>type: &quot;module&quot;</code>，则在项目的<code>package.json</code>中定义一些<code>type: &quot;module&quot;</code>，也可以解决问题</li><li>如果出现了<code>commonjs</code>和<code>esm</code>混用的情况，则会报错，要么导致<code>Cannot use import statement outside a module</code>，要么导致<code>mjs</code>等等无法导入因为有<code>type: module</code>之类的问题，下面着重说一下在该种情况下的解决方案</li></ol><p>我碰到的问题就是，我直接 clone 的 github 上的两个 boilerplate，一个是<code>electron-react-typescript-webpack-boilerplate</code>，还有一个是<a href="https://github.com/diego3g/electron-typescript-react#:~:text=electron-typescript-react" target="_blank" rel="noopener noreferrer">electron-typescript-react</a>，这两个 boilerplate 虽然配置有些差异，而且一个用到了<code>babel</code>一个没用，但是共同点就是<code>webpack.config.js</code>中都没有使用<code>import</code>语法，<code>webpack</code>的所有依赖也都是<code>commonjs</code>。</p><p>而我为了将<code>markdown</code>文件在前端渲染出来，虽然我可以直接使用<code>marked</code>或者<code>react-markdown</code>这类 package，但是基于以前<code>nextjs | gatsby</code>等框架的经验，直接基于<code>webpack</code>进行<code>markdown</code>解析体验会比较好（毕竟两个项目都用上<code>webpack</code>了）。</p><p>但是问题来了，我在<code>webpack</code>官网中找到加载<code>markdown</code>相关的<code>loaders</code>的 <a href="https://webpack.js.org/loaders/remark-loader/#inspiration" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a> 章节时，实际使用发现<code>remark-html</code>是<code>esm</code>，没法直接用，我的<code>webpack</code>会报错。</p><p>接着我就经历了 12 个小时的奋斗，尝试了几乎所有能找到的方案，从最基础的改<code>type: &quot;module&quot;</code>，到用上<code>babel-register</code>，甚至详细去读了<code>webpack</code>、<code>babel</code>的相关内容，最后不得不都以失败告终。其中应该说最有影响力、提供解决方案最多（然而最终都失败）的帖子应该是下面这个：</p><ul><li><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></li></ul><p>问题说的很清楚，就是要在<code>webpack.config.js</code>中使用<code>ES6</code>。</p><p>但答案都不 OK，最终，我在万念俱灰无数次之后，偶然在 <a href="https://github.com/vercel/next.js/discussions/27758" target="_blank" rel="noopener noreferrer">Bug at render-markdown stage of tutorial: Must use import to load ES Module · Discussion #27758 · vercel/next.js</a> 这个帖子里找到了一句话：<code>npm install remark@13 remark-html@13</code>，凭着经验，我一下就知道是怎么回事了，因为前两天我刚刚与万恶的<code>webstorm</code>不支持<code>tailwindcss</code>最新版最终不得不安装<code>tailwindcss@2.0.1-compat</code>做了同样艰苦的斗争！</p><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640346360145-webpack-bugfix-349711dd9f694e145b5dc4a1ddae42e2955043d9a23747857b50d1423368dd9f.png" width="480" class="img_vXGZ"><p>果然，安装指定的版本后，项目终于成功运行：</p><img loading="lazy" alt="picture 6" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640346477725-webpack-bugfix-7d4cd572dc5ec9fe5ad511c4156c56e047cbe30184b88b8c95601c1d21b1b02e.png" width="480" class="img_vXGZ"><p>至此，所有与<code>webpack</code>的斗争，应该说告一段落了，不然，我下一个更艰苦卓绝的打算，可能就是去看<code>nextjs</code>之类重型框架的源码，剖析它们是怎么高大上地使用<code>webpack</code>了。。</p><p>所以，目前，我可以确定的就是，只要保证所有<code>webpack</code>依赖的库都是<code>commonjs</code>，就可以不借助<code>babel</code>使项目运行，毕竟当一个前端项目需要用上<code>babel</code>的时候，它肯定就已经是另一个项目了，于是，一键 DELETE 恢复世界清净。</p><img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347058731-webpack-bugfix-901426db9195c9d0a7ec92ef0370f3a94d57f35b9b78808b330f4929e3341574.png" width="480" class="img_vXGZ"><p>不过事实上，就像我开头说的，我 clone 了两个项目，其中一个用了 babel，用于转换<code>jsx</code>之类的文件的，它是基于<code>electron-forge</code>的，为了弄清楚当时的报错我还特意去看了这个库，说实话也没怎么弄明白。它的这个<code>boilerplate</code>对我最大的启发，应该是写了一个标准的<code>main</code>和<code>renderer</code>之间通信的接口，即：</p><ol><li>main 中暴露 api 给 renderer 使用的接口定义</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/@types/bridge.d.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;electron/bridge&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> global </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// eslint-disable-next-line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Window</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Main</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>main 中对 api 使用的收发封装</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// electron/bridge.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">contextBridge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ipcRenderer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;electron&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * Here you can expose functions to the renderer process</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * so they can interact with the main (electron) side</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * without security problems.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * The function below can accessed using `window.Main.sendMessage`</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">sendMessage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipcRenderer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;message&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * Provide an easier way to listen to events</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">on</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callback</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Function</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipcRenderer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contextBridge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exposeInMainWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Main&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这两个文件，包括 main 和 render 程序中如何使用这两个文件的写法对我还是有很好的指导作用的，至少 electron 官网上对 typescript 的范式介绍比较少，这就需要从这些 boilerplate 中寻找指点。</p><p>但除此之外，这个 boilerplate 对我的意义就不大了，而且，我也不怎么看得懂它给定的几个<code>scripts</code>，其实无法就是开发版、生产版、运行、打包与测试的不同命令，但是被他搞的有点负责，相比较之下，另一个 boilerplate 就很好，清晰明白，也有可能上半年我在学习 electron 的时候正好用的就是第二个 boilerplate，但无论怎样，确实第二个更好。</p><img loading="lazy" alt="picture 10" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347712904-webpack-bugfix-5b369e0dff7ff239ccac2debcdc0a1dbf626a177b96e8f07b9fb9cf1e9ef977c.png" width="480" class="img_vXGZ"><hr><img loading="lazy" alt="picture 11" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347790778-webpack-bugfix-dec8b0f034c1fea196744e1f5f4d8772efad854d0a2d28d7858995617024a57e.png" width="480" class="img_vXGZ"><p>但为了确信这一点（2 比 1 好），我又重新去确认了一下 github 的 star 数，结果，并不是这样的，第一个 boilerplate 的 star 有 1.2k，而第二个只有 176，好家伙……我的直觉真不靠谱。</p><p>不过这也解释地通，因为第一个是叫<code>electron-typescript-react</code>，第二个叫<code>electron-react-typescript-webpack-boilerplate</code>，表面上后者是前者的具化，因为名词更多。</p><p>但事实上，恰恰相反，在<code>electron-typescript-react</code>中反而既有<code>webpack</code>也有<code>babel</code>，其实比另一个涉及的东西还有多……从这个角度想，第一个 boilerplate 星多，应该至少归结于三个点：</p><ol><li>名字短</li><li>加了<code>babel</code>，让使用者有了更多发挥的空间</li><li><code>bridge</code>的接口写的棒，对使用者有更大的价值</li><li>...</li></ol><p>Anyway，这大概就是关于目前这个问题的所有思考，和两个 boilerplate 带给我的启发。</p><p>接下来，才是工作的重头戏，那就是手上工具顺了，就要立即投身到业务实现上了。</p><p>但仍然，我开头说的还有一些问题是没有解决的，罗列如下：</p><ol><li>为什么<code>webpack</code>官网的所有<code>loader</code>的配置都是<code>import</code>导入的，难道他们所有的 dependencies 都是 esm 吗？</li><li>有可能不是，因为我还看到他们的有些 loader 可以使用<code>type: &quot;auto&quot;</code>这种配置，应该就是自动对多种 type 的 js 采取不同的策略智能打包的意思，但这个可以作用于<code>config.js</code>的抬头吗？好像不可以吧，因为我看他们是用在<code>rules</code>里的。</li><li>肯定存在很多<code>commonjs</code>和<code>esm</code>混用的项目的，如果不引入<code>babel</code>，<code>webpack</code>是否可以有策略正常运行呢？目前，他们都是基于<code>babel</code>的吗？</li><li>如果是基于<code>babel</code>，我认为我之前尝试装那么多<code>babel</code>依赖，应该也可以正常运行啊，为什么就不能奏效呢？</li></ol><p>关于第三点，我突然想到我上半年也写过脚本，翻出来看了一下： <img loading="lazy" alt="picture 12" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640348790672-webpack-bugfix-66129064c7e8a8c55c2161aad0bcce67f18e484b1cf913921f14bd01688a3542.png" width="480" class="img_vXGZ"></p><p>可以看到，确实是要用<code>babel_register</code>进行子程序注册的，并且我也确实是用<code>import</code>进行导包的： <img loading="lazy" alt="picture 13" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640348883256-webpack-bugfix-a0039a63671200450ee7bc85582444eecf757b3c9393f8bd3443e2b72b79dedd.png" width="480" class="img_vXGZ"></p><p>人老了啊，记性不行了，当时应该研究这些东西也花了一星期的，结果都一点印象没了，幸好好记性不如烂笔头，整理了当时的代码库。再回想开头看的那个关于<code>babel_register</code>的解决方案，内心突然就有些豁然开朗了： <img loading="lazy" alt="picture 14" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640349025625-webpack-bugfix-045d3c71ca84950c4a03136ad85db57f3652e3aa1f0600b59ebcdfd8eaf8c66f.png" width="480" class="img_vXGZ"></p><p>不过呢，至少这个项目，我应该暂时不需要了 hhh，如果需要，到时候<code>yarn add</code>一顿乱装，加个<code>babel-register</code>脚本，改一下启动命令行，应该就行了，hhh，肯定不会像今天这样头疼了。</p><p>那就暂时先这样，对该问题的记录到此为止。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="former-record">Former Record<a class="hash-link" href="#former-record" title="标题的直接链接">​</a></h2><blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="problem-syntaxerror-cannot-use-import-statement-outside-a-module">[Problem]<!-- --> SyntaxError: Cannot use import statement outside a module<a class="hash-link" href="#problem-syntaxerror-cannot-use-import-statement-outside-a-module" title="标题的直接链接">​</a></h3><p>This discussion is very close to what I happened to, however they gave no solution, except pointed out that there may be some package using <code>es</code> which seems <strong>not proper for webpack</strong>, and inspired me to have a check at <a href="#the-target-package-of-remark-html-i-wanted-to-import">the target package</a> I wanted to import as official webpack suggested me to.</p><ul><li><a href="https://stackoverflow.com/questions/70114861/why-does-error-syntaxerror-cannot-use-import-statement-outside-a-module-when" target="_blank" rel="noopener noreferrer">javascript - Why does Error &#x27;SyntaxError: Cannot use import statement outside a module &#x27; when I try to use ES Modules? - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="the-target-package-of-remark-html-i-wanted-to-import">The target package of <code>remark-html</code> I wanted to import<a class="hash-link" href="#the-target-package-of-remark-html-i-wanted-to-import" title="标题的直接链接">​</a></h3><ul><li><a href="https://webpack.js.org/loaders/remark-loader/#root" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="failed-solution-of-babel-node">[Failed]<!-- --> Solution of <code>babel-node</code><a class="hash-link" href="#failed-solution-of-babel-node" title="标题的直接链接">​</a></h3><p>It seems that <code>babel-node</code> is a possible solution to this problem, since it when I installed it, it automatically detected what&#x27;s going wrong of all my webpack loaders.</p><img loading="lazy" alt="picture 1" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640327908025-webpack-bugfix-51cf4a831368a2ef7d3cf8957e88c6c5f9528ec63aa21ab93ff4602781cdc6cd.png" width="480" class="img_vXGZ"><h3 class="anchor anchorWithStickyNavbar_rB0w" id="failed-solution-of-babelregister">[Failed]<!-- --> Solution of <code>@babel/register</code><a class="hash-link" href="#failed-solution-of-babelregister" title="标题的直接链接">​</a></h3><ul><li><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></li></ul></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="真正唯一的收获">真正唯一的收获<a class="hash-link" href="#真正唯一的收获" title="标题的直接链接">​</a></h2><p>前段时间有个字节的小姐姐，和我表述想转码的意愿，聊下来觉得前端对她可以一试，毕竟目前各种开发岗位里前端是相对来说最容易上手的了……</p><p>但是！</p><p>这说的只是十二十年前纯粹用<code>html + css + jquery</code> 或者 <code>php</code>的时代！</p><p>现在，前端技术突飞猛进，各种范式层出不穷，变得越来越复杂了，三大框架<code>AngularJS | React | Vue</code>就不说了，<code>webpack</code>和<code>babel</code>绝对能让大厂的前端开发掉一层皮……</p><p>但 anyway，如果不论这些，平时写写前端真地能让人心情大好，获得感十足，用一位朋友对开发的态度来说：“平时自己写些玩玩挺好的，当做工作就太无聊了”，确实如是~</p><p>保持学习，保持热爱！ <img loading="lazy" alt="picture 15" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640349694440-webpack-bugfix-7adf1882ddf381568cee583516f84f77d56237f255c73a5bcceb153755794696.png" width="480" class="img_vXGZ"></p><p>reference:</p><ul><li><p><a href="https://blog.logrocket.com/transpile-es-modules-with-webpack-node-js/" target="_blank" rel="noopener noreferrer">How to transpile ES modules with webpack and Node.js - LogRocket Blog</a></p></li><li><p><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></p></li><li><p><a href="https://github.com/diego3g/electron-typescript-react" target="_blank" rel="noopener noreferrer">diego3g/electron-typescript-react: An Electron boilerplate including TypeScript, React, Jest and ESLint.</a></p></li><li><p><a href="https://github.com/Devtography/electron-react-typescript-webpack-boilerplate" target="_blank" rel="noopener noreferrer">Devtography/electron-react-typescript-webpack-boilerplate: Pre-configured boilerplate for Electron + React + TypeScript + Webpack</a></p></li><li><p><a href="https://webpack.js.org/loaders/remark-loader/#inspiration" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a></p></li><li><p><a href="https://github.com/vercel/next.js/discussions/27758" target="_blank" rel="noopener noreferrer">Bug at render-markdown stage of tutorial: Must use import to load ES Module · Discussion #27758 · vercel/next.js</a></p></li><li><p><a href="https://www.electronforge.io/templates/typescript-+-webpack-template" target="_blank" rel="noopener noreferrer">TypeScript + Webpack - Electron Forge</a></p></li><li><p><a href="https://www.electronjs.org/zh/docs/latest/api/ipc-main" target="_blank" rel="noopener noreferrer">ipcMain | Electron</a></p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/webpack">Webpack</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/前端">前端</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/tags/开发笔记"><div class="pagination-nav__label">较新的博文</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>