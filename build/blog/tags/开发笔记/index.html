<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">9 篇博文 含有标签「开发笔记」 | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/blog/tags/开发笔记"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="9 篇博文 含有标签「开发笔记」 | 南川笔记"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/blog/tags/开发笔记"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/tags/开发笔记" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/tags/开发笔记" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a class="navbar__item navbar__link" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_P3nc thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_VrjY margin-bottom--md">All Posts</div><ul class="sidebarItemList_OSkG clean-list"><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-INFP与ENTJ的日日夜夜">2024/2422-INFP与ENTJ的日日夜夜</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-从FP走向TJ">2024/2422-从FP走向TJ</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/06/21/Rabbit-R1分享会">Rabbit-R1分享会</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/05/01/2419-信仰一跃">2419-信仰一跃</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/04/30/飞脑">飞脑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/discarded/微信聊天记录备份指南">微信聊天记录备份指南</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/01/14/觉醒的硅基">觉醒的硅基</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/31/index">[03-27-digital-travel] 南川数字游民之旅01：</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/27/南川骑行川藏线（下）">南川骑行川藏线（下）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白">十年 —— 一位自学者、技术工作者、理想主义者的独白</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/18/南川骑行川藏线（中）">南川骑行川藏线（中）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/09/25/当我想做一款吹羽毛小游戏……">当我想做一款吹羽毛小游戏……</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦">Poketto.AI: 每一个人的哆啦A梦</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/12/31/this-year">this-year</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/29/coding-cries">代码有所能，有所不能</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/03/taiwan-data-research">关于台湾进出口临时政策与历史数据的研究</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/01/wechat-hack">微信数据库破解</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/11/prose-I-am-me">札记 | 我与我周旋久，我亦是我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/11/dev-gopro-1">编程 | GoPro 01: 全天候自动 4K 延时摄影</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/06/dev-ios-automation">编程 | iOS 自动化实现王者荣耀一键换装</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/23/dev-mp3-meta">编程 | 逼哥的音乐元数据修复</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/22/evaluation-breo-dream6">评测 | Breo Dream6 按摩仪</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/15/prose-is-not-easy">札记 | 须知，活好是很不容易的</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/14/dev-voice2srt">编程 | 视频剪辑自动转写字幕</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/04/22/research-mbti/mark_mbti">研究 | 基于 MBTI 的人生复盘与计划（上）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/27/prose-321-air-crash">札记 | 愿逝者安息生者坚强，你我迎风奔跑向阳而生</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/09/dev-douban-renting">编程 | 北京租房系统设计、研究与经验 0.1.0</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/21/ad-beike-hiring">推广 | 贝壳新业务 VR 全职开发招募</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts">编程设计艺术思考（持续更新）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/03/prose-living">札记 | 2022，活着</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/02/dev-linux">编程 | Linux 笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/01/prose-2022-begining">札记 | 关于近几年的一些感悟</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/23/prose-engineer-cultivation">札记 | 一位工程师的自我修养（序）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/20/prose-first-job">札记 | 是的，我入职了</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/01/prose-my-2021">札记 | 我的 2021：混沌与洞见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/24/dev-webpack">编程 | 记与 Webpack 十二小时的奋战</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/一道“全军覆灭”的数学题">一道“全军覆灭”的数学题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/考研数学试题编辑">考研数学试题编辑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/28/今天南川学习十小时了吗？是的。">关于正态分布表的一个有趣发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/09/浅谈我自学编程的经历与经验">浅谈我自学编程的经历与经验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/28/关于有人想仲裁我">关于有人想仲裁我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/27/十月：无题">十月：无题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/18/王者荣耀打野上分经验总结（全干货）">王者荣耀打野上分经验总结</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/06/27/毕业一年：我的得与失">南川二一零六：毕业一年，我的失与得</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/05/12/记逆向攻破拼多多加密系统">南川逆向笔记 | 攻破 PDD 风控系统（一）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/04/14/从0到1搭建一个Electron应用">Electron 开发笔记 - 从 0 到 1 搭建一个 Electron 应用</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/03/12/shamghai-rent-lesson">记与上海无良房东斡旋经验与教训</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/01/09/评测-南川Effie使用初体验">南川 Effie 使用初体验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/11/20/拜登获胜演讲稿">拜登获胜演讲稿</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）">五台山论道（节选自《遥远的救世主》）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：一路失败，我到底学到了什么">大学沉思录：一路失败，我到底学到了什么</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：意向调查">大学沉思录：意向调查</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/22/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/15/投资：凯利公式">“中一千万”与“挣一千万”到底哪个更容易</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/bug_fix">BUG FIX</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/home">南川笔记中文首页</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/todo-old">待办事项</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/release-notes">更新日志</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/guestbook">留言墙</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/12/经验与发现">经验与发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/10/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/开发常用命令行">开发常用命令行</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/my_university">谨以此文，纪念我在大学的这四年</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/VuePress-Journal">VuePress你好，VuePres再见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/vue开发笔记">vue开发笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/博客开发之导航设计方案">博客开发之导航设计方案</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/如何向ElementUI一样封装Message全局组件">如何向ElementUI一样封装Message全局组件</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/如何给右键添加任何启动程序">如何给右键添加任何启动程序</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/我谈《三十而已》">我谈《三十而已》</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/极客运营手册/">极客运营手册</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/ssg-ssr">When to Use Static Generation v.s. Server-side Rendering</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/pre-rendering">Two Forms of Pre-rendering</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>9 篇博文 含有标签「开发笔记」</h1><a href="/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-07-02T00:00:00.000Z" itemprop="datePublished">2022/07/02</time> · <!-- -->阅读需 18 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>近日，我叔为我弟高考志愿填报的事情焦头烂额。（江苏高考志愿填报竟然能多达 40 个了，你敢信！）</p><p>我心想，也许可以为他们做点数据分析工作。于是……</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="设计">设计<a class="hash-link" href="#设计" title="标题的直接链接">​</a></h2><p>高考志愿填报的核心难点，在于学校、专业众多，普通人很难抉择，尤其是中档学生，一本线以上、211 勉强，对于他们来说，可能选得好就是天堂选不好就是地狱（也只是可能，最终还得看自身）。</p><p>他正好位于这档。</p><p>（不过在日益强大的数据分析工具面前，这个问题变得不再有挑战性，回想起我曾经填志愿时还只能傻傻地拿着一本大书慢慢比对，不得不感叹当年的我还是年轻。）</p><p>在母校曹老师的援助下，我很快地拿到了权威的去年志愿数据（来源：<a href="https://www.jseea.cn/webfile/index/index_zkxx/2021-07-17/24917.html;jsessionid=8A742AC473A754778E35DFAC962B7F7A.s107_7" target="_blank" rel="noopener noreferrer">江苏省 2021 年普通类本科批次投档线（物理等科目类） - 招考信息</a>），里面有物理学科本科院校志愿最低分的数据情况，长如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766839465-3dd91a5a19354795df88ff375103b519196d6cf4c89ee94de197c944072e33f2.png" alt="picture 2" class="img_vXGZ"></p><p>这样，很快地，我们的思路就出来了，只要把我弟的数据录进去，再和这些学校比对，筛选出在他分数上下的院校即可，最好是 985、211、双一流。</p><p>因此我们的工作大致有以下几个：</p><ol><li>清洗这张表格</li><li>为这张表格加上学校标签标识</li><li>将分数录入，进行筛选</li></ol><p>以下详细展示整个流程。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="投档线数据清洗">投档线数据清洗<a class="hash-link" href="#投档线数据清洗" title="标题的直接链接">​</a></h2><p>首先查看表格，是传统的 excel，还有最让编程人员烦的跨行合并的多层标题栏，那么第一步就是重构标题栏。</p><p>根据经验，表格的跨行合并，实际上真实数据都在合并的第一行（其他为空），例如取消合并后如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766993094-7635f2a2ce0217a1f39d40ad8bf81d013b2273c86fd5200338887f632cbffe5c.png" alt="picture 4" class="img_vXGZ"></p><p>由此可以敏锐地发现，我们只需要把标题栏向下填充，使之全部对齐到第五行，就是可以被程序读取的标题栏了。而这个操作，就是 pandas 内所谓的<code>frontfill</code>（向前填充）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767020562-a50a20840b8b27bf3dea6a408e87562e13b4e05675565795bf4b63451ae212cc.png" alt="picture 5" class="img_vXGZ"></p><p>接着标题栏都是中文，并且命名过长，影响编程效率，所以有必要重命名。</p><p>此外，接着看内容，“院校、专业组（再选科目要求）”这一列信息量比较大，包含了学校名、专业组和专业限制。</p><p>其中专业组是指填报汇总后是根据大专业划分，几个比较近的属于某个专业组，例如计算机、软件、电子信息就很有可能属于同一个专业组，有点类似一级学科的意思，但也不太一样，主要是按招生对象不同，比如说中外合作的就可能在同一专业组，与其他的专业组可能专业内容上倒是相近的。这个就需要那本大书去查，网上还没有太好的信息。</p><p>专业限制是江苏专用的一套规则，按照“3+1+2”的要求，学生在语数外之外先要在“物理”和“历史”中首选一门，作为文理划分的依据；接着在剩余的 4 门（历史、政治、地理、生物）中任选两门，专业限制就是针对这两门，在曹老师的指导下我们了解到它分“不限”、“A”、“A 或 B”、“A 和 B”四种可能，分别属于不同的交并补关系（一开始我以为只有“不限”或者“A 或 B”两种可能，导致程序设计缺陷，这是我的疏忽，由于时间关系，没有做好前期统计的工作）。</p><p>因此，我们首先要做的就是把这列拆分，尤其对于专业组限制这块，一开始以为只有“或”的关系，我就把它拆成了一个数组，后来发现还有“和”的关系，这么做就不妥了，因此需要保留原字符串，后续以我弟的具体学科使用函数单独处理。</p><p>由此写出我们第一段程序，数据已经变成很干净的结构：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767765128-03a51d1d3951b6781fb07b9da0683d99840e35154dc957c85a591d82ae7fd024.png" alt="picture 7" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773876476-c52acb4fe7a714e492466d7118974935b74e9923d36e74371ce6e1d2b2ea2d56.png" alt="picture 32" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分数据结构设计">考分数据结构设计<a class="hash-link" href="#考分数据结构设计" title="标题的直接链接">​</a></h2><p>为了通用性，我们在设计考分数据结构时，设计的相对比较保守，因为里面存在一些勾稽关系，所以使用<code>@property</code>保证数据的一致性。此外，由于每年分数线差异，因此需要做换算，所以加入了<code>bias</code>乘数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767932103-7981dfd9a59b69827e93d1fc4b2589159fcf45e4dc8b3b2b64859421163813dd.png" alt="picture 8" class="img_vXGZ"></p><p>在<code>bias</code>上，默认是 1 这个很好理解；考虑到我们可能有多次对标不同年份的需求（江苏没有，因为江苏改革目前才是第二年），所以需要不断地调整 bias，因此最好的做法，是调整后再返回类本身，这样可以实现链式操作。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768075428-c7aca4cf071f20a24eb678803ce9dcec6861f3299539eee12aaeb86a969ca3a2.png" alt="picture 9" class="img_vXGZ"></p><p>链式操作示范：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768172602-572b8b5f9fd071eb6f8de7f75f3397f077051c88fb173ffc5c835fd103889bc0.png" alt="picture 10" class="img_vXGZ"></p><p>我们还在数据分的基础上，加入了排名，不过实际没有用上，因为我们没有投档线对应的排名数据。</p><p>以上就是整体的数据结构设计。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分录入年份修正风险偏好">考分录入、年份修正、风险偏好<a class="hash-link" href="#考分录入年份修正风险偏好" title="标题的直接链接">​</a></h2><p>在录入上，直接初始化即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768324016-07135822436a2483b55726287dc8bdb1d6bae7a5c98ce64a07c553b8e7e2a6cb.png" alt="picture 11" class="img_vXGZ"></p><p>在年份修正上，则有些讲究。它本质的问题是确定，今年的分数在往年值多少分的问题。</p><p>我原先想用一本分数线做测度，但是江苏已经取消一本线了，只有本科线（也就是二本线）。</p><p>我想了一下，反正这块肯定有误差，在非对标顶级 985 的情况下，直接用二本线比值作为乘数似乎也没什么不妥。</p><p>比如去年本科线是 417，今年是 429，比值是 0.97，也就是今年的 1 分等于去年的 0.97 分。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768462360-9e2dc54ba2633efd5d2238816426b980bdd189834884e9c7caa0332fa49faf1f.png" alt="picture 12" class="img_vXGZ"></p><p>在年份修正的前提下，我们还得考虑一下风险偏好，目前我们看到的都是最低志愿投档线，因此实际已经很有风险，也即是现在看到的贵校的 N 分，实际进入该专业的学生可能都是 N<!-- -->*<!-- -->k 分，k 显著大于 1。</p><p>所以正常情况下，我们得在折合分上再乘以一个系数，降低一下自身的体位，可能 0.98 比较合适，但是不排除有些人特别 risky，就想搏一搏，单车变摩托，所以我们在筛选的时候也可以适当调高点范围，这就是风险系数，我把它设置成了最高 1.02，这样能多看十分（基数是五百多）的学校。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768677788-0b18d662fcbf5800ff9947403a3a1bff8335e4666f611fe12bf9bb429b60dfb5.png" alt="picture 13" class="img_vXGZ"></p><p>看的时候，以风险调整后的分为最高分，从上往下筛学校即可。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于学科进行筛选">基于学科进行筛选<a class="hash-link" href="#基于学科进行筛选" title="标题的直接链接">​</a></h2><p>在学科筛选上，可以写的很复杂，也可以写的很简单。</p><p>比较复杂的是一遍遍地 for 循环，然后用 if 去判断，到底符不符合。</p><p>我后来想了一种比较简单的，就是用集合的思想去设计。</p><p>如果目标专业组要求是“A 和 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该等于<code>{A, B}</code>。</p><p>如果目标专业组要求是“A 或 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该与<code>{A, B}</code>有交集，也就是 $<!-- -->{<!-- -->C, D<!-- -->}<!-- --> \cap <!-- -->{<!-- -->A, B<!-- -->}<!-- --> \ne \varnothing$。</p><p>如果目标专业只有一个，也就是必须要选修它，则是子集关系。</p><p>如果目标专业为“不限”，则是恒真关系。</p><p>于是，我们可以写成这样：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769521413-46849b76826934ca106c73b9a7701078e2a4f3a490671bcaa2c05380ea5a5537.png" alt="picture 15" class="img_vXGZ"></p><p>这样，我们就把 2200 多条筛成了 17000 多条了，减少了 20%，是很不错的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-985211-筛选">基于 985、211 筛选<a class="hash-link" href="#基于-985211-筛选" title="标题的直接链接">​</a></h2><p>我们首先关注的是 985、211 类大学，看看有没有什么机会。</p><p>我们要先拿到一个标签表。</p><p>简单搜索后，我们决定使用来自这份博客<a href="https://blog.csdn.net/weixin_40683253/article/details/88417600" target="_blank" rel="noopener noreferrer">对照表 - 用心整理了一份国内 985/211 大学名单及其一流学科<!-- -->_<!-- -->黄饱饱<!-- -->_<!-- -->bao 的博客-CSDN 博客</a>的数据。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769729876-6ec048f8a3514c61dab87039788e4dad276193d4e76ebc2fa4223f0977de1134.png" alt="picture 16" class="img_vXGZ"></p><p>这是一张排版很标准的表格，如果你用 F12 去检查的话确实是标准的<code>table</code>标签。</p><p>我们如何把这个数据提取下来呢？</p><p>这可是表格，而非文字，直接复制处理起来很麻烦（但有时也未必不可以）。</p><p>要用爬虫吗？又觉得杀鸡焉用牛刀。</p><p>这时候，我突然想起来很多软件都自带表格数据提取工具，比如 excel 就有网站源数据刷新功能。</p><p>重点是，pandas 也不例外！</p><p>一行代码，轻松搞定，只要喂一下网址即可！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769873501-7d6c39430b4fb107df808e5a0e24bedc0f1b62eed6b2c395fb768b9f5e9b8c41.png" alt="picture 17" class="img_vXGZ"></p><p>看到这，你是否会很想知道它的内部实现？没错，我也想，有时间再研究研究，估计是<code>requests + beautifulsoup</code>工作流？</p><p>简单清洗后，再与原先的那张表做左联操作：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770240516-8ea1c31af98253cca91922a0aac56400e6f6e083820fbbedf6bd88ce0e5fb329.png" alt="picture 19" class="img_vXGZ"></p><p>左联操作，就是以左表（投档线表）为基础，加上额外的右表信息（不存在的就是标记缺失）。这个操作，也是数据分析中最常用的。</p><p>我们还额外地简单封装了这个染色操作，将不同风险偏好的分数段做染色处理，逻辑如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770341081-6998c83936ecc24ba531deac77fe3f58ca262143c1a8808c1e06864d19be1b0f.png" alt="picture 20" class="img_vXGZ"></p><p>这样风险偏好保守的就看绿色部分就可以，高的可以看看红色（或者作为参考）。</p><p>不过很遗憾的是，我弟这个分数 985、211 只能去到很偏远的地方，或者都是中外合作办学项目。</p><p>此路似乎不通。</p><p>也许我们可以试一试双一流。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于双一流筛选">基于双一流筛选<a class="hash-link" href="#基于双一流筛选" title="标题的直接链接">​</a></h2><p>我们同样需要双一流的标签数据，之前那个 985/211 的表里虽然也有双一流信息，但是不全，因为有些双非也是有双一流的。</p><p>我们在<a href="https://www.zhijiao.cn/syl.shtml" target="_blank" rel="noopener noreferrer">“第一轮双一流”建设高校及建设学科名单<!-- -->_<!-- -->中国教育在线</a>这里找到了我们要的数据。</p><p>于是，使用 pandas 梅开二度：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770576448-e9b1e2692c2db0c2ea3e3bea561b0ed055d42991035ceb241eb5e81c598e741b.png" alt="picture 21" class="img_vXGZ"></p><p>这样就有 140 所学校了，可选性大了些（比 92 多了 20 所左右）。</p><p>不过，既然是基于双一流专业，我们肯定更以专业为主（而非学校），所以我们需要额外加一点基于专业的筛选操作。</p><p>比如，我们预设几个计算机相关的专业，然后在双一流学科名单中筛选，看看有没有相关的关键字，再结合分数，结果……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770672616-ff47941ea168d1fadd08988e0456ccbb00b7034eb220ea73bca466601aba6e74.png" alt="picture 22" class="img_vXGZ"></p><p>Emmm.....</p><p>我陷入了良久的沉思……</p><p>既然专业好也可以，那我们为何不试试专业排名（而非紧盯双一流呢？）</p><p>这么一想，思路就开阔了，那就是软科排名！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于软科排名筛选">基于软科排名筛选<a class="hash-link" href="#基于软科排名筛选" title="标题的直接链接">​</a></h2><p>软科的排名可以在官网找到：<a href="https://www.shanghairanking.cn/rankings/bcmr/2022" target="_blank" rel="noopener noreferrer">权威发布|2022 软科中国大学专业排名|中国大学本科最好专业|就业率最高的专业</a></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770818534-227fe64e604260d36186637bab6b7cd316ffa28898512b5c944a054639535779.png" alt="picture 23" class="img_vXGZ"></p><p>我们可以在这里搜索不同的学科排名。</p><p>我们通过 F12 分析后端接口，发现有结构良好的 json 数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770883806-8dadd0900400c59c6a851d2077d3b2d6d8b23f5a7339968a677687287b7644ce.png" alt="picture 24" class="img_vXGZ"></p><p>因此，可以考虑直接用爬虫的手段，毕竟每个搜索结果都要翻页十二十次，这显然是必须走自动化了。</p><p>经过测试，如果不加 cookie，则获取时只会返回前 20 条，加了 cookie 就可以返回完整结果。</p><p>cookie 也就是这个：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770970159-0ae108ab6bd0574e833f4bd2a18024a6c47d10756f69d4ecb2cab4364f3b39c2.png" alt="picture 25" class="img_vXGZ"></p><p>我们把它复制出来，封装一下，就可以设计出得到任意学科的排名数据的接口了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771058309-c544701861ec45612783fb4431526257be2ddda268f7c61409431d984ab5b7d0.png" alt="picture 26" class="img_vXGZ"></p><p>此外，我们注意到这个接口需要传入学科的编码，因此我们还要设计一个接口获得完整的编码列表。</p><p>经过分析，发现任何一个排名接口里已经包含了这份数据（的拷贝），因此我们可以首先调用任意一个专业的排名接口，然后解析出编码列表，代码如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771264185-63f98497dd56ca34dac37663c757faefde4e26b0d6fd0cf561fcaa46a22ea22b.png" alt="picture 28" class="img_vXGZ"></p><p>但这只是我们编码好的字典，还不具备输入一个学科名就返回一个学科编号的功能，因此还要封装一个检索函数：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771335922-69e0acfca3bdbe912eda019c67b32ee84ef240c4a990adb99939982c3407b63a.png" alt="picture 29" class="img_vXGZ"></p><p>手动修正所有目标专业的准确名称后，我们就可以正式进行分析工作了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773095464-9a349621f747035122e030e8cfd4cc51b7c7e659c8448cbfcf229141a32abb55.png" alt="picture 30" class="img_vXGZ"></p><p>此处唯一多需要注意的是，软科 api 里的<code>ranking</code>是字符串格式的整数，然后到我们 pandas 中也默认是字符串。</p><p>如果我们需要对<code>ranking</code>进行排序，就要先转换成整数；但如果我们在联表的的时候没有把非排名院校给筛掉（每份排名名单只有小几百所学校），就会导致数据缺失（变成<code>pd.NaN</code>），从而无法转换成整数，这是需要注意的。</p><p>解决办法就是要么直接把那些学校筛掉（比如本例）；要么就是使用<code>pd.numeric</code>函数，里面有两个参数<code>errors</code>和<code>downcast</code>可以控制异常如何处理。</p><p>技术部分就是这样！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="复盘">复盘<a class="hash-link" href="#复盘" title="标题的直接链接">​</a></h2><p>其实本期最大的收获就是：</p><ul><li><p>对于有 211 分的，直接对照 985、211、双一流名单去选就好了；</p></li><li><p>对于有一本分的，建议对照软科排名去选</p></li><li><p>对于其他的……</p></li></ul><p>我今天终于了解到了二本怎么选的了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773375309-4cb693ae7f66b693d8fe2ab68b0c049f09d7e728c376b15ffd822cf0537d3d68.png" alt="picture 31" class="img_vXGZ"></p><p>哈哈哈，不得不说这是一个很好的思路！</p><p>以上！</p><p>（全部<code>ipynb</code>程序文件可以后台回复“<strong>使用 pandas 研究高考志愿填报</strong>”。）</p><p>最后感谢我叔提供的素材，以及再次感谢曹老师的热心援助，希望我弟和天下学子最终都能选到心仪的学校，学有所成，不枉此生！</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/数据分析">数据分析</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-06-16T00:00:00.000Z" itemprop="datePublished">2022/06/16</time> · <!-- -->阅读需 22 分钟</div></header><div class="markdown" itemprop="articleBody"><ol><li>方案 1：物理手段解决</li><li>方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算</li><li>方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<ol><li>浮层大小</li><li>浮层内容</li><li>浮层位置</li><li>二维码生成</li><li>二维码使用</li><li>缺陷</li><li>其他用处</li></ol></li><li>*<!-- -->方案 3 个人笔记<ol><li>LAB01: how to install the labs firmware</li><li>LAB02: QR Controls For Settings</li><li>LAB03: add an overlay to viedeo</li></ol></li><li>最后一点感受</li></ol><p>在上一期【文章：gopro】中，我们提供了一种借助 gopro 基于延时摄影从而底层本高质量地全程记录个人生活的解决方案，实测中这个方案仍然有一些不足之处，本期就重点探讨时间戳相关的问题。</p><p>这个问题其实很关键，因为我们正在做的事情是长时间无感拍摄，目的是为了后期复盘，但在复盘过程中，由于延时时间跨度过长，我们希望知道视频里的每一帧所拍摄的实际时间，比如是某月某日的下午两点还是夜间十点，这是一个很自然的需求。</p><p>但很可惜，这个问题并不容易解决。</p><p>以下便基于这个问题，提供实际可行的三种方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-1物理手段解决">方案 1：物理手段解决<a class="hash-link" href="#方案-1物理手段解决" title="标题的直接链接">​</a></h2><p>如果你是一个比较传统的、具有较强时间观的人，也许这种方案特别适合你，那就是直接选购一款挂钟（这也是我在上篇文章中所采用的方法）。</p><p>例如，我们这里有一段使用挂钟时期的成品视频：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655354709985-843159c3c155958989a9d5791053dbaecaca765cf48c91ebed9afd66f5c1d33a.png" alt="picture 3" class="img_vXGZ"></p><p>将我们的挂钟摆在所拍摄视频中的合理位置，既增强了画面构图感，也能实时知道每一帧所对应的真实时间，这确实有一石二鸟之效。</p><p>但很可惜，这种方案，并未能坚持多久，原因是，廉价的挂钟机芯转动声音影响到了自己的睡眠。</p><p>按照我对睡眠无声的要求，在依次关闭空调、窗户、电脑散热器、硬盘柜之后，室内的声音强度耳测应该已经低于 30 分贝，此时挂钟的声音就显得尤为明显了。</p><p>尽管它不大，但确实也没那么动听，至少甚至不如星际穿越的曲子《Tick-Tock》的前奏。</p><p>除非我愿意花更多的时间与金钱去筛选到另一款真正无声的挂钟，但作为一名程序猿，也许有更廉价与炫酷的方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-2借助opencv基于文件创建时间进行推算">方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算<a class="hash-link" href="#方案-2借助opencv基于文件创建时间进行推算" title="标题的直接链接">​</a></h2><blockquote><p>本节参考：- <a href="https://www.theeminentcodfish.com/gopro-timestamp/" target="_blank" rel="noopener noreferrer">GoPro TimeStamp - The Eminent Codfish</a></p></blockquote><p>事实上，由于我们的延时摄影采用了固定时间间隔的方案（有关“自动时间间隔”与“固定时间间隔”方案的差异与优劣，也在上篇文章中有阐述），因此只要我们知道视频的任何一帧所对应的真实物理时间，我们就可以基于等差数列算法进行推算。</p><p>而这，恰恰可行，因为 gopro 的视频输出格式为 mp4，里面保存了文件的创建时间。</p><p>不过，这个文件创建时间，可不是我们在电脑上看到的那个文件创建时间，这不是同一个概念。</p><p>例如，我们这里有一段视频的开头显示是 6 月 15 日 10 点 05 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355366257-b01f6386d8aaa7fc57ca802956a6fd73fc4f6628385437e0055b8bd94622b6f9.png" alt="picture 4" class="img_vXGZ"></p><p>但在我们的文件管理器上查看该文件的创建时间却是 6 月 16 日 10 点 57 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355421774-dc43ac335c5f11ebcbda9c81edde670f3e7f285321771c5f1a0ad443f8f22e2a.png" alt="picture 5" class="img_vXGZ"></p><p>这显然不是时区的问题，而是操作系统问题，即在操作系统里定义的文件创建时间是该文件在本地磁盘上首次产生的时间，而非文件本身的首次创建时间（对于该视频来说，尤指该视频开始拍摄的时间）。</p><p>但我们并非没有手段获取实际视频创建时间，答案就是基于软件解析的手段：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655356074973-cf5d985ee99cf99c2e87527c0ea19e095d2c433ceb7bed96d27be097804bb0ba.png" alt="picture 6" class="img_vXGZ"></p><p>上述代码使用了<code>ffprobe</code>这个指令解析了我们的 mp4 文件，从结果中的<code>creation_time</code>标签得到了我们想要的视频创建的真实时间，于是乎，最难的问题解决了。</p><p>接下来，我们就基于视频领域的一些基本概念为我们的视频加上时间戳信息。</p><p>第一步是关于帧的。</p><p>在之前文章中我们说我们的视频是每 5 秒延时拍摄一帧，也就是每过一帧实际时间就要<strong>大致</strong>加五秒，这是一个很重要的信息。</p><p>而整个流程就是使用 opencv 读取我们视频的每一帧，然后算出该帧的时间，然后将格式化的时间戳放到那一帧上面去，最后再输出成一个新的视频，这个过程就叫“烧录”。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ref: - [GoPro TimeStamp - The Eminent Codfish](https://www.theeminentcodfish.com/gopro-timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> subprocess </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tqdm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tqdm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> get_file_creation_time </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FONT_COLOR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># blue, green, red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;_with-timestamp&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Opens the video import and sets parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VideoCapture</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isOpened</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;failed to open video of </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">file_path</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FPS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_WIDTH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_HEIGHT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frames_cnt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_COUNT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># float -&gt; int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> frames_cnt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initializes time origin of the video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_creation_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_frame_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;frames_cnt: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, FPS: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">FPS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, initial_timestamp: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cur_frame_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, dimension: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> x </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, duration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Command to send via the command prompt which specifies the pipe parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ffmpeg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-y&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (optional) overwrite output file if it exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-f&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Input is raw video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-pix_fmt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bgr24&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Raw video format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-s&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># size of one frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-r&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># frames per second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-i&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The input comes from a pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-an&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Tells FFMPEG not to expect any audio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mpeg4&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-b:v&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10M&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sets a maximum bit rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># output file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Open the pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stdin</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== OpenCV is processing =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_time_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Reads through each frame, calculates the cur_frame_time, places it on the frame and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># exports the frame to the output video.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tqdm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frames_cnt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;ERROR: failed to read frame of [</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur_frame_time </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Date: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Time: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> image </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== finished =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_used_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> process_time_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;used time: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, video period: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, multiplier: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time </span><span class="token string-interpolation interpolation operator" style="color:#393A34">/</span><span class="token string-interpolation interpolation"> duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stderr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/Volumes/Disk1/videos/gopro日常/gopro延时生活/2022-06-14/GH011701.MP4&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358120832-aa46758f93ddc61e960a10c274e8fb7ea49276b152f7d3fa6e343d02c1e2bc9a.png" alt="picture 7" class="img_vXGZ"></p><p>可以看到，基本一比一的处理速度，也就是说原视频时间有多长，程序运行时间就有多长，对于延时摄影来说，一天的录制输出大概就是十分钟的视频，因此脚本每天的运行时长也就是在十分钟左右，这是可以接受的。</p><p>不过这个脚本也有一点点小问题。</p><p>第一个问题是每次读取到第二十帧的时候就会报错，之后就没问题，不明白什么原因，也似乎不影响程序的表现，这个属于 opencv 范畴的问题了，留到以后再考虑了。</p><p>第二个问题就是输出的视频文件比原文件要小很多，直接差了十倍……：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358301337-0a3bc21ac1b530ed8f43053e33a9dc99fc89d90bd464a0e3335c942c9c01ab41.png" alt="picture 8" class="img_vXGZ"></p><p>我们放在一起比对了一下，发现分辨率是没区别的，区别可能是在编码上：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358410672-57cab49192da7b59eed7ba618c39d6d255cee16c69296294643a68eff01f401d.png" alt="picture 9" class="img_vXGZ"></p><p>实际看了一下，发现确实画质上有较大区别，比如原视频的白墙很光滑：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358467434-475e70206879f5478766392201a3660654973eec188934dfe157dbd2a24e0bb0.png" alt="picture 10" class="img_vXGZ"></p><p>但编码后的白墙就明显有那种类似波纹的效果了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358486566-93f149d18618d08ed0741e37dce78415d64e105c79d847a015f57ce19da5d9f1.png" alt="picture 11" class="img_vXGZ"></p><p>从这个角度上说，如果不考虑修改脚本，使之输出原质量的视频，那么我们的脚本输出的视频就只能当做备份与参照视频了，毕竟十倍的比率确实也有一些用武之地。</p><p>然而，这个脚本实际上还有另一个问题，那就是时间不一定能对齐。</p><p>比如刚刚文件对比图上，一个是 20 秒，一个是 19 秒，当然这个其实没有太大所谓了（虽然很非遗所以，也许就是和上面那个有两帧无法处理的问题有关），我更关心的是另一个对齐问题，曝光与时间间隔。</p><p>就是，怎么说呢，我现在并不确定 gopro 的曝光与拍摄间隔之间的关系，比如说，假设我们设置拍摄间隔为 2 秒，曝光时长为 1 秒，那么它是每 3 秒拍一次照片还是每 2 秒拍一张呢？</p><p>如果是每 3 秒拍一次照片，那么我们的算法每一帧加 5 秒就有问题，因为没有算上曝光时间，这样就会导致累积时间变少。</p><p>但如果是每 2 秒拍一张照片，那么更极端的一个情况，例如拍摄间隔为 1 秒，曝光时长为 2 秒，则似乎就无法拍摄了……</p><p>所以，这里有研究一下的必要。</p><p>总之，这种借助 opencv 进行后期处理的手段还是有一定实用价值，适用于很多其他的领域，是一种通用技术手段，我们有必要掌握，并且我对熟练掌握 opencv 之后输出我们想要的视频结果的可能性抱有很高的期望，除了曝光与拍摄间隔对齐的问题之外。</p><p>但输出的画面质量不佳（若提高质量（假设可行），势必速度会下降）与额外脚本运行的不便等因素，使我最后选择了第三种更干净的方案：<code>GoPro Labs</code>。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3借助gopro-labs添加时间戳浮层">方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<a class="hash-link" href="#方案-3借助gopro-labs添加时间戳浮层" title="标题的直接链接">​</a></h2><p>如果说第二种方案属于后期，那么本方案则属于前期了。</p><p>众所周知，防患于未然，能从前期着手的方案，基本都是最优的。</p><p>而 GoPro Labs 就能帮助我们实现这点。</p><p>我们要做的事情就是：</p><ol><li>下载 GoPro Labs 的固件版本，完成固件升级（我的 GoPro 是 9，是支持的）</li><li>制作我们的时间戳浮层二维码，扫描后使用</li></ol><p>主要通过这个网站： <a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a> 生成我们所需的二维码，这里的每个参数都比较重要，我们一一解释：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层大小">浮层大小<a class="hash-link" href="#浮层大小" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359589767-225e990742d950f8587e2c402e3368a9e244f5412a936ac5d47065be0bfe3eea.png" alt="picture 12" class="img_vXGZ"></p><p><code>vertical size</code>是浮层的整体高度，而非单个文字的高度，由于浮层支持多行文本，因此为了目标字体大小，多行文本时对应的竖直高度也要变高，我们设置为 60，对应三行文本，（也就是每行 20，单位大概是像素），效果不错</p><p><code>horizontal size</code>是浮层的整体宽度，因为这个底层是按行排版文本，因此我们直接设置成 0，让它自动调整浮层的宽度即可，即所有行中最长的行的宽度</p><p><code>offset from the edge</code>是与画面边缘（应该是 Y 轴，因为 X 轴距离可以通过下文的换行符控制）的距离， 目前使用的是 10，效果还不错</p><p><code>Limit dispaly time</code>设置成 unlimited 即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层内容">浮层内容<a class="hash-link" href="#浮层内容" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359884415-4a3b036583d6c3be88ca734bf9e9e51f76a3f6600c7ca7d3a5fd2751f4609384.png" alt="picture 13" class="img_vXGZ"></p><p>这个就是配置我们的自定义文本与时间、日期的地方，它是一行行下来的，可以自己用<code>\n</code>分隔符换行（但不可以换顺序，所以时间始终在日期之前）。</p><p>为了从简，我没有加任何个人自定义短语（一开始加了自己的昵称，后来觉得太冗余了，所以还是留空了），但我在尾部加了两个空行，这是为了主动地增加相机与底部（X 轴）的边距，这样输出的视频里的时间戳在我 mac 电脑上预览时不会被进度条挡住。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层位置">浮层位置<a class="hash-link" href="#浮层位置" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360216872-e9f80b49b95e94ae25f967b4693cdd17aef45684d829b5e2986a0b246b40e314.png" alt="picture 16" class="img_vXGZ"></p><p>我将时间戳放在了左下角，因为我平常会在右下角办公，而画面中上部则是主体区域。</p><p>我们的场景中不需要使用 GPS。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码生成">二维码生成<a class="hash-link" href="#二维码生成" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360265681-720de6db987621a49e2a200321fcffca430ef8a599e20145dd6d7804e5b3aba5.png" alt="picture 17" class="img_vXGZ"></p><p>在生成二维码附近还有是否选择<code>active</code>的选项，我之前一开始捣鼓 lab 时弄出了 bug，在 模式设置：<a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a> 中设置出了一个没有的模式，导致系统死掉，最后刷回 GoPro9 1.5 的稳定固件版本，然后重新升级到 lib 版本才恢复，这其中既有可能是模式问题，也有可能是这个浮层当时选了<code>permanent</code>选项，因此我现在已经完全不敢点这个选项了。但并不影响我目标功能的实现。</p><p>基于这些，最终的二维码就生成了，它对应的 QR Command 是：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)[BLHH:MM:SSaa mm-dd-yyyy]\n&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以后我直接基于这个 Command 字符串进行修改即可，还是很方便的，比如加上自定义前缀与后缀的结果如下：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)哈哈哈[BLHH:MM:SSaa mm-dd-yyyy]略略略\n&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们用函数去表达这个字符串输出就是：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_gopro_overlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_edge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_leading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_ending</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;g0oMBRNO=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_edge</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">oMBURN=&quot;(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_leading</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">[BL</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_fornat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_ending</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意到，我们的时间格式也是可以自定义的，并且如果我们基于从字符串（而非网页交互）出发去生成二维码，那么我们就可以定义日期在前时间在后的格式了，比如<code>yyyyy-mm-dd HH:MM:SSaa</code>。虽然这一点未经过测试，但想必是可行的（写文章时才意识到的，hh~）</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码使用">二维码使用<a class="hash-link" href="#二维码使用" title="标题的直接链接">​</a></h3><p>只需要将升级成 lab 固件版本的 gopro 打开后对准我们的二维码，就会自动识别并应用了，然后“BOOM”，一个可爱的浮层就出现了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360991571-d8d1b7e0310840ea24d4942d811b06c8afce5eb567d92a10db6ca0642adcd2f5.png" alt="picture 18" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="缺陷">缺陷<a class="hash-link" href="#缺陷" title="标题的直接链接">​</a></h3><ol><li>除了上文提到的容易导致系统挂掉之外，正常操作不会有问题</li><li>经测试，我们的时间戳浮层对照片和夜间延时没有效果，对普通视频与正常延时有效果。经过思考，我这个项目一开始采用夜间延时的方案现在觉得不太适用，因为实测下来在夜间我屋子几乎全黑的环境下即使开了夜间延时也几乎无法拍出能看清的画面，而白天看投影时又会导致曝光过高，因此直接放弃夜间的效果即可。当初拍夜间是为了监测睡眠，那段时间也会在睡觉时留一盏小灯（戴眼罩）以获得最好的拍摄效果，现在睡眠项目已经结项了，因此不需要了。我也更喜欢无声+全黑的睡眠环境。</li><li>关于上一点，也好像不是没有解决方案，正如我笔记中记载的 <a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a> 这篇帖子里的小哥貌似碰到的就是和我差不多的问题并有一个解决方案，但我暂时已经不需要了，以后有机会再研究吧！</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="其他用处">其他用处<a class="hash-link" href="#其他用处" title="标题的直接链接">​</a></h3><p>GoPro Labs 的功能不仅限于添加浮层这一项，恰恰相反，这是里面最小的一个应用之一。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655361326041-ae5359c76c082cda93c03f928c7e5ad513c1636b7dd46f1865dbf5e6b75e3da9.png" alt="picture 19" class="img_vXGZ"></p><p>它还有很多其他有趣的场景应用，必须运动检测、自动切换模式等，详情可参考：</p><ul><li><p><a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p><a href="https://www.youtube.com/watch?v=YaXcu0E10WM" target="_blank" rel="noopener noreferrer">(151) GoPro Labs: How to Use QR Codes to Instantly Switch Your Settings - YouTube</a></p></li><li><p><a href="https://www.youtube.com/watch?v=0LCGiO7jMEw" target="_blank" rel="noopener noreferrer">(151) GoPro Labs 2021 New Features for Hero 9, Max, Hero 8, Hero 7: Hands-on Details &amp; Explainer - YouTube</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3-个人笔记">*<!-- -->方案 3 个人笔记<a class="hash-link" href="#方案-3-个人笔记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab01-how-to-install-the-labs-firmware">LAB01: how to install the labs firmware<a class="hash-link" href="#lab01-how-to-install-the-labs-firmware" title="标题的直接链接">​</a></h3><p>see <a href="https://gopro.com/en/us/support/hero9-black-product-update" target="_blank" rel="noopener noreferrer">Hero9 Black Product Update | GoPro</a>, but I failed to generate the target firmware in this site.</p><p>So I downloaded it in other place, e.g. - <a href="https://www.goproforums.com/threads/need-hero9-black-firmware-update-v1-5.87636/" target="_blank" rel="noopener noreferrer">Need HERO9 Black firmware update v1.5 | GoPro Forums</a>, which directed me to the dropbox download page: - <a href="https://www.dropbox.com/s/edh41nffo6d6gns/GoPro%20Hero%209%20firmwares%20fishycomics.zip?dl=0" target="_blank" rel="noopener noreferrer">GoPro Hero 9 firmwares fishycomics.zip</a></p><p>And finally, I saved two different firmwares in local disk, one for stable version, one for the lib one:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655351979322-5f9d394f99b48f506a3fb28de9adadfd94be9ebc9f57562d3925e88635f16863.png" alt="picture 2" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655340186034-7e904daaa952ca0a5c3457c103fcddaa9eaee79362a7051a179ef1ca14576416.png" alt="picture 1" class="img_vXGZ"></p><p>ref:</p><ul><li><a href="https://community.gopro.com/s/article/GoPro-Labs?language=en_US" target="_blank" rel="noopener noreferrer">GoPro Labs Information</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab02-qr-controls-for-settings">LAB02: QR Controls For Settings<a class="hash-link" href="#lab02-qr-controls-for-settings" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><p>documentation: <a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p>custom qr control: <a href="https://gopro.github.io/labs/control/custom/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/custom/</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab03-add-an-overlay-to-viedeo">LAB03: add an overlay to viedeo<a class="hash-link" href="#lab03-add-an-overlay-to-viedeo" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a></li></ul><p>ref:</p><ul><li><p><a href="https://community.gopro.com/s/question/0D53b00008HOPq7CAH/how-do-i-add-timestamp-to-hero-10-videos?language=en_US" target="_blank" rel="noopener noreferrer">How do I add timestamp to Hero 10 videos?</a></p></li><li><p><a href="https://www.reddit.com/r/gopro/comments/pt6u8j/burning_timestamp_on_gopro_movie/" target="_blank" rel="noopener noreferrer">Burning timestamp on GoPro movie : gopro</a></p></li></ul><p>bugfix: gopro labs won&#x27;t add timestamp to interval videos, see:</p><ul><li><a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后一点感受">最后一点感受<a class="hash-link" href="#最后一点感受" title="标题的直接链接">​</a></h2><p>国外的极客生态真地很繁荣，一个小小的 gopro 就能玩出这么多的花样，反观国内，似乎还停留在各种参数的堆砌与各种大饼的圈画上，实则看不到太多对待一个具体的事物（而非钱）研究的诚意与专注的热爱。</p><p>之前携国货之光大疆无人机奔赴川藏线，它真地很好。但现在身处帝都，最终还是无用武之地，幸好有位天体物理博士愿意收购它，让它继续发光发热。而我，则只有尽我可能，把一些有趣的东西搞的更明白一些、更有用一些、更好玩一些。</p><p>gopro 的话题，从上篇的 open-gopro 到本篇的 GoPro Labs，基本已经涉及了 gopro 核心开发生态的方方面面，朋友们需要时完全可以顺着这两篇一窥 gopro 的里子，进而玩出新的花样。</p><p>下一期，我们聊聊最近做的另外一个有趣的小东西：投影与手机遥控器。</p><p>Best Wishes to All of You.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/go-pro">GoPro</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/06/11/dev-gopro-1">编程 | GoPro 01: 全天候自动 4K 延时摄影</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-06-11T00:00:00.000Z" itemprop="datePublished">2022/06/11</time> · <!-- -->阅读需 19 分钟</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>北京难得下雨，因此，一旦下雨就会想起什么。</p><p>可是，人的记忆力总是有限的，也是虚无的。</p><p>人毕竟是肉体凡胎，人与人之间需要有实体的互动。</p><p>而最有效的实体，便是从古代的文字，到近代的照片，再到现在的短视频。</p><p>这是时代的进步，但我想，或许还可以更进一步，例如随着 CPU、硬盘等信息技术的升级，未来建立全息个人档案的可行性将会逐渐增大，以至于，人类或许能够拥有完整追溯一个人过往以及重生一个人的能力。</p><p>但这项技术落入大众消费的范畴还远不可敢想，然，并非绝无希望的可能。</p><p>最近，恰好因了疫情的肆虐，我偶然间探索出了一种以视频完整记录人生的解决方案。</p><p>那就是：全天候自动 4K 延时摄影！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h2><p>首先我们要明确我们的目标，我们想完整录制自己的人生，如果可行，需要什么条件。</p><p>首先，我想，分辨率不能太低，不然没眼看，因此至少也得是 1080p，最好是 4K，因为 4K 基本能看清我们任意想看的细节。</p><p>我们就以 4K 为例，探讨一下硬件要求。</p><p>以 GoPro 摄像机为例，4K30 帧录制 10 分钟的文件大小大约在 4.5G，于是一小时便是 27G，一天便是 648G，一年便是 231T。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654933516441-c8e243bc1634d339e694d3bdb9d0a308e5125301669d0575f125f5087595bb0f.png" alt="picture 3" class="img_vXGZ"></p><p>231T 是什么概念。。。</p><p>显然不可行。</p><p>有段时间，我下决心解决我睡眠质量不好的问题，我想到了一个方案，把自己每天的睡眠录制下来，那个时刻，我第一反应便是延时！</p><p>没错，延时摄影非常适合长时间观察某个对象的场景：睡眠监控、人生监控，都非常适合。</p><p>说干就干，我监控了自己一周的睡眠：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654933983322-9d01b4747ab1a07349b3818fb8af23b5f42218ad6e0e2f821c56731b55adb5d9.png" alt="picture 4" class="img_vXGZ"></p><p>不过一开始由于没有啥经验，因此每天复盘自己的拍摄成果，至少解决了以下几个问题：</p><ol><li>gopro 的电池容量并不大，4k 视频录制一小时就要关机了，因此需要配一根充电线保持实时输电状态录制。</li><li>一开始选用的是夜景延时的默认自动时长选项，这导致了拍摄出来的延时短片没光时帧少，有光时帧多，这是有好处的，对后期非常方便。但其实不太适合我们的需求，因为我们只需要平凡的记录，不需要做啥后期，忽快忽慢的拍摄不利于自己对时间的把握，尤其是有光的时候，gopro 拍的太快了，导致文件体积增大，也可能不太符合预期。后来摸索得出，把每帧时长控制在 5 秒，既可以控制 10 分钟内拍完一整晚，输出的文件不用分片。5 秒的帧间隔有啥意义呢，按照 30p 来算的话，一秒本来需要 30 帧，而现在 30 帧对应了真实世界的 150 秒，所以等于把实际世界压缩了一百多倍。回想我们之前说的 231T，如果除以 150，我们得到了 2，也就是一年的延时录制只需要 2T 的硬盘就可以了，我们买一张 16T 的机械硬盘，将允许我们录制 5 年以上！因此，硬盘方面的问题解决了。</li><li>尽管我们使用了固定的帧间隔，我们很多时候还是想知道拍摄的任意一帧是处于什么时间，我查阅了一些资料，有个比较复杂的 python 脚本可以允许对 gopro 的视频添加时间层信息，但我觉得没有必要。我想到了一个有意思的办法，那就是买了个挂钟，能同时显示日期和时间的挂钟（不需要很贵），这样就很直观了： <a href="https://item.jd.com/63986225561.html" target="_blank" rel="noopener noreferrer">康巴丝（Compas）挂钟时尚卧室客厅办公时钟日历挂表简约创意石英钟表 2941Y 日历黑白色直径 30cm【图片 价格 品牌 报价】-京东</a></li><li>gopro 的无线方案其实远比想象地要复杂，官网介绍的是通过手机 gopro quik 软件连接 gopro，并支持预览和操控 gopro，而 pc 端的话要用 usb 连接读卡器，从而完成文件管理。这个步骤其实很繁琐，我想尝试无线的方案。后来我找到了 gopro 的开源代码库：<code>open-gopro</code>、<code>goprocam</code>，前者是 gopro 官方代码库，后者是某个人开发的 wifi api。前者功能比较全面与底层，后者 sdk 做的比较友好方便，但支持 wifi。从理论上说，我们使用<code>goprocam</code>的 wifi api 可以在电脑已经连接到 gopro 后，直接使用程序完成自动下载、清理存储的目标，但仍不够自动化，于是我又花了整整一天的时间研究明白了不需要手机 app 直接全程在电脑端控制 gopro 的原理与实现路径。</li><li>全自动化。由于我们最终设计出了完全可以自动的程序，所以又花了一下午研究清楚了基于<code>crontab</code>的定时工具，完成了全流程自动化，一切，是那样完美地运行着。</li></ol><p>接下来，将详细展开该解决方案中的一些问题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-gopro-的全天候自动-4k-延时摄影系统设计">基于 GoPro 的全天候自动 4K 延时摄影系统设计<a class="hash-link" href="#基于-gopro-的全天候自动-4k-延时摄影系统设计" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="设备依赖">设备依赖<a class="hash-link" href="#设备依赖" title="标题的直接链接">​</a></h3><ol><li>一台 gopro 9+设备（否则不支持<code>open-gopro</code>），可持续充电，固定房间某个角落</li><li>一台电脑，安装了<code>python 3.8+</code>，定时运行转储程序</li><li>一个 2T 以上空间的机械硬盘，定时转储视频</li><li>不需要网络，在转储时，gopro 会自动开启一个本地局域网（但为了不影响实际 wifi 工作，我们的程序还是做了无线网络切换模块）</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="全自动化流程">全自动化流程<a class="hash-link" href="#全自动化流程" title="标题的直接链接">​</a></h3><div class="language-mermaid codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-mermaid codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">flowchart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start[开始]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ConnectGoproViaBle[&quot;PC蓝牙连接gopro设备（将自动打开gopro）&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ShutterOff[&quot;关闭gopro的摄影（否则无法执行文件传输）&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; EnableWifiAndConnect[打开gopro的wifi并连接]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; TransferFiles[讲gopro的文件转储到PC磁盘]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; DisableWifi[&quot;关闭gopro的wifi，复原PC的wifi连接&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Switch2NightLapseMode[&quot;切换GoPro到夜景延时模式，设置好参数&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ShutterOn[开启gopro的摄影]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- &quot;一天后（十分钟的延时输出）&quot; --&gt; ConnectGoproViaBle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pc-端直接控制-gopro-拍摄下载清空的实现方案">PC 端直接控制 gopro 拍摄、下载、清空的实现方案<a class="hash-link" href="#pc-端直接控制-gopro-拍摄下载清空的实现方案" title="标题的直接链接">​</a></h2><p>首先，我们要知道 gopro 的无线通信框架，参见：<a href="https://gopro.github.io/OpenGoPro/" target="_blank" rel="noopener noreferrer">Open GoPro : Open GoPro</a>可以知道 gopro 只可以被蓝牙唤醒，然后被蓝牙、wifi 或者 usb 控制，文件管理功能只允许 wifi 或者 usb。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654935369129-4e3b66fb37ca6630f9389861c10eea1305355c9dc0b659bc5d74036a531bec75.png" alt="picture 5" class="img_vXGZ"></p><p>因此要先启动蓝牙连接，成功后再开启 wifi 进行文件传输。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> binascii </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hexlify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> bleak </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BleakScanner</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BleakClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">const </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> COMMAND_REQ_UUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_WIFI_BASE_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_WIFI_GP_COMMAND</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_MEDIA_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> CONFIG_WIFI_GOPRO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CONFIG_WIFI_HOME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CURRENT_DATA_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_media_online_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wifi </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> connect_wifi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_wifi_connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># suppress unnecessary mac ble error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;bleak.backends.corebluetooth.scanner&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">setLevel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CRITICAL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyGoPro</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_current_data_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CURRENT_DATA_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">notification_handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;&lt;--- Response: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">handle</span><span class="token string-interpolation interpolation operator" style="color:#393A34">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">hexlify</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:#e3116c">&quot;:&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation conversion-option punctuation" style="color:#393A34">!r</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Notify the writer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;\n==== datetime: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">now</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;电脑第一次与gopro配对时，需要保持gopro处于设置面板选中quik应用连接界面，直到收到所有返回消息方可确认配对成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;程序运行之时，请确保没有其他进程正在执行，手机quik不要处于预览状态，否则将导致连接不上！&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gopro_device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 1. 扫描蓝牙设备。正常情况下，要扫描1-2遍。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> gopro_device</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;---- Scanning for bluetooth devices... [#</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">count</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 需要蓝牙权限，例如pycharm、terminal、iterm之类的应用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> device </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> BleakScanner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">discover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;detected ble device: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;GoPro&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        gopro_device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;found gopro：</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">gopro_device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 2. 连接蓝牙设备。配对自动进行，mac平台跳过（待确认）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;----- Establishing BLE connection to </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">gopro_device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BleakClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gopro_device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 太短的话会导致连接失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BLE Connected!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 3. 获取通知。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;---- Enabling notifications...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> service </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> char </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">characteristics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;notify&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> char</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Enabling notification on char </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">char</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">uuid</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_notify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">char</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> notification_handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Done enabling notifications&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Connection establishment failed: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> desc </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Sending command of: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;---&gt; Requesting: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> desc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_gatt_char</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COMMAND_REQ_UUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">bytearray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Wait to receive the notification response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 比如开启wifi之间就需要时间间隔</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_load_timelapse_preset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://gopro.github.io/OpenGoPro/ble_2_0#commands-quick-reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x04</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x3E</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xEA</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Loading timelapse preset&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Control shutter: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ON&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> on </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OFF&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        wifi名称和密码的程序化获取方式，参见`tutorial_5_connect_wifi/wifi_enable.py`</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :param on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Control wifi: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ON&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> on </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OFF&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_check_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">func</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        对需要使用wifi的函数装饰检查与修复</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> is_wifi_connected</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> wrapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GOPRO_WIFI_BASE_URL </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/gopro/media/list&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        date_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">today</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;media_list_</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">date_</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;w&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> indent</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">download_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;downloading file: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fn</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_media_online_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_current_data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;saving into: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;√&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GOPRO_WIFI_GP_COMMAND </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/storage/delete&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> res </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;√&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delete_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> media_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        删除单个文件时，网址结尾的&quot;delete&quot;不能带&quot;/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :param media_name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;deleting media: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">media_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">option</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;?p=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">GOPRO_MEDIA_DIR</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">media_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delete_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;deleting all the media&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/all&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">task_daily_download_all_the_videos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my_gopro </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MyGoPro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># connect_ble part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># wifi part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># wifi打开之间需要停止拍摄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connect_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">CONFIG_WIFI_GOPRO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;---- downloading all the media&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">dir</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">list_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;media&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;traverse media in dir: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">dir</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;d&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">dir</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;fs&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;n&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">download_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># TODO：将gopro无线桥接到路由器，从而化简该步</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 最终要保证wifi回来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connect_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">CONFIG_WIFI_HOME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># continue part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_load_timelapse_preset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 若以下任务是类的一个方法，则需要使用loop，如果是一个全局函数，则可以直接用run，参考：https://cloud.tencent.com/developer/article/1598240</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task_daily_download_all_the_videos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该代码主要参考<code>open-gopro</code>仓库里的<code>samples</code>，做了不少的修改与自己的封装，核心难点是<code>asyncio.Event</code>的使用。</p><p>除去技术上的难点，在产品上也有不少的坑。首先官网和绝大多数文章都只告诉你怎么用手机连 gopro，而鲜有用电脑无线练的。</p><p>我也是抱着尝试的心态，在 gopro hero 9 中打开“连接设备-quik 应用”后，直接在电脑端启动脚本成功连上的，这说明，手机 gopro quik 软件的连接原理和<code>open-gopro</code>仓库是等同的。</p><p>另外，蓝牙连接要使用到<code>bleak</code>底层库，也有一些可以忽略的<code>Error</code>信息，这些都需要花时间去鉴别，幸而没有大问题。</p><p>紧接着，由于蓝牙属于系统的敏感权限，因此脚本启动时，需要确保有蓝牙权限，一般情况下会弹窗，否则得自己加（比如<code>terminal.app</code>、<code>iTerms.app</code>、<code>/usr/sbin/cron</code>等），这一步将直接劝退对操作系统不怎么熟的程序员，因为你几乎找不到任何相关的资料。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654936750010-9948c6c0a74e620066ed5e9a6a952f1f0961b37c910bbc5e6186dc774ed7098c.png" alt="picture 6" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于crontab自动化的定时程序">基于<code>crontab</code>自动化的定时程序<a class="hash-link" href="#基于crontab自动化的定时程序" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化的必要性">自动化的必要性<a class="hash-link" href="#自动化的必要性" title="标题的直接链接">​</a></h3><p>尽管程序我们写好了，已经可以运行，自动控制 gopro 的开启、录制、转储等功能，但是得每天都运行一遍，否则 gopro 的存储卡（我放的是一张 128G 的存储卡）将很快被撑爆（尤其是录制视频而非延时的话）。</p><p>而每天手动执行是很烦的，并且由于执行过程中需要连接到 gopro 的无线网络，因此本地就没法联网了。所以最适合的办法是让电脑自动夜间执行，达到无感的目的。</p><p>我想了想，最佳的时间点是凌晨五点，此时大多数情况下环境已有微光，能看清，而自己一般都在熟睡，不会有太大的动作；而 gopro 自动操作的哔哔哔声，也一定程序上有益于自己的早起。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化的充分性">自动化的充分性<a class="hash-link" href="#自动化的充分性" title="标题的直接链接">​</a></h3><p>我们要回到项目的起点上，我们做这个工程的意义是什么？</p><p>是为了如实地记录自己的人生，而非是一场作秀，对不？</p><p>那就尽量做到无感，甚至忘记这个项目！</p><p>当一切做到自动化之后，很多时间里自己都不知道自己是处于被记录的状态，这才是我们最想要的。</p><p>因此，我们需要自动化</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化方案选择">自动化方案选择<a class="hash-link" href="#自动化方案选择" title="标题的直接链接">​</a></h3><p>在 mac 平台上，至少有两种，一种是基于<code>crontab</code>，这也是 linux 通用的解决方案。</p><p>还有一种是使用<code>launchtl</code>和<code>plist</code>的方案。</p><p>考虑到兼容性，以及自己在 linux 平台上的经验，我选择使用<code>crontab</code>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="crontab自动化的核心难点"><code>crontab</code>自动化的核心难点<a class="hash-link" href="#crontab自动化的核心难点" title="标题的直接链接">​</a></h3><p>理论上当我们的程序已经写完之后，将程序喂给<code>crontab</code>然后自动化运行，是再自然不过的事情了。</p><p>然而，我们的项目却有点不一样。</p><p>首先就是我们刚刚说的蓝牙权限的问题。由于<code>crontab</code>是一个后台程序，因此不会弹窗提醒你要不要允许系统权限，而是直接报错。</p><p>所以我们首先要跟踪<code>crontab</code>的输出，这是写自动化脚本的基本素养。</p><p>其次在定位到问题之后，要把我们的蓝牙权限交给<code>cron</code>。</p><p>另外还有一个问题，在我们的程序中，我们调用了 mac 的系统调用去控制 wifi，其中在 mac 平台上连接名称为 A 密码为 B 的 wifi 的命令如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">networksetup </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">setairportnetwork en0 A B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但这里有两个问题，首先是如果我们的名称里有引号，则会被 unix 系统识别错误，我们需要这么写：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">networksetup </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">setairportnetwork en0 </span><span class="token string" style="color:#e3116c">&quot;A&#x27;s wifi&quot;</span><span class="token plain"> B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>open-gopro</code>项目里这部分代码就写的很粗糙，他们直接用单引号去包括 wifi 的名称和密码，这在 wifi 名称或密码里包含单引号时将导致错误。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937659590-88b30ece6e4293f6afb3eb8ae4aede13181898295cbdc091e4018cb7820f6716.png" alt="picture 7" class="img_vXGZ"></p><p>其次还有个问题：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  ~ which cron</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/cron</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  ~ which networksetup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/networksetup</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然<code>cron</code>和<code>networksetup</code>都处于<code>/usr/sbin/</code>目录下，但当<code>cron</code>运行时，系统路径里却只有少的可怜的<code>PATH</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937962014-a80cc8825496fdadf5accafe126bebf7946caa645260b2c11dcab3f1714b00ce.png" alt="picture 8" class="img_vXGZ"></p><p>因此在<code>cron</code>程序中，无法直接调用<code>networksetup</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937983944-008f34e4649edee4440f96ea27e4393531862f2afb22b537bdaaf21c89d52102.png" alt="picture 9" class="img_vXGZ"></p><p>最简单的做法，是在我们的程序中显式指定<code>networksetup</code>的路径：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/networksetup en0 A B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，将原程序配置到<code>crontab</code>实现自动化的所有问题都解决了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654938110099-ae0481c9ff2f6985d6600f24ebde0b9e42a8e769a2aac5f16b198fc263d8dcd7.png" alt="picture 10" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="说在最后的话">说在最后的话<a class="hash-link" href="#说在最后的话" title="标题的直接链接">​</a></h2><p>绝大多数人的生命都是平淡如水的，因为我们不是 Harry Porter，不是那个&quot;The Chosen One&quot;，甚至连被 Voldemort 选中的资格都没有。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939590506-29c337c9cec89eabb7e6c8dc7b37c5f7065924b240cb6048257c5a59839adbdf.jpg" alt="picture 14" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939607377-f83d60721de76b09feb989c7caaeca87e37d56a62a6ebe6aee8e1e473875bde6.jpg" alt="picture 15" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939631870-02c8906434c94a7a8cd9def6fd0a9e403bedff56f85490c819248e0e503a7d7f.jpg" alt="picture 16" class="img_vXGZ"></p><p>我们有的只是当下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654938185985-7bd847c645a3d6c3b71a7b9fb712c384dba992c7efb1f44292faadd5366bec1a.png" alt="picture 11" class="img_vXGZ"></p><p>最后借一部短片 <a href="https://www.bilibili.com/video/BV1Rv4y1w7hA?p=1&amp;share_medium=iphone&amp;share_plat=ios&amp;share_session_id=FC6EA2F7-5433-42F2-B9E1-1ED0F5A232A1&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1654581591&amp;unique_k=0kUaMFS&amp;vd_source=9cb028fe6c978c6816626901d9249eb1" target="_blank" rel="noopener noreferrer">“cheems，你要去码头整点薯条吗？”<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a> 结束本文：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot2.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot3.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot4.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot5.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot6.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot7.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot8.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot9.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot10.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot11.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot12.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot13.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot14.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot15.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot16.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot17.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot18.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot19.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot20.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot21.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot22.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot23.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot24.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot25.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot26.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot27.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot28.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot29.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot30.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot31.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot32.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot33.jpg" alt="xxx" class="img_vXGZ"></p><p>【音乐：The Time To Run(Finale)】</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/go-pro">GoPro</a></li></ul></div><div class="col text--right col--3"><a aria-label="阅读 编程 | GoPro 01: 全天候自动 4K 延时摄影 的全文" href="/blog/2022/06/11/dev-gopro-1"><b>阅读更多</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/06/06/dev-ios-automation">编程 | iOS 自动化实现王者荣耀一键换装</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-06-06T00:00:00.000Z" itemprop="datePublished">2022/06/06</time> · <!-- -->阅读需 32 分钟</div></header><div class="markdown" itemprop="articleBody"><ol><li>概要</li><li>秒换装概念与分析<ol><li>秒换装的难度阶梯</li><li>备战出装换装的优点</li><li>备战出装换装的缺点</li><li>换指定装的实现分析</li></ol></li><li>iOS 秒换装实现之语音控制（Voice Control）实现自定义手势</li><li>iOS 秒换装实现之越狱、第三方应用</li><li>秒换装实现之基于外设硬件</li><li>iOS 秒换装实现之基于 iOS 自动化：<code>facebook-wda</code>（WebDriverAgent）</li><li>UI 自动化的缺点（行走中的触控集成问题）<ol><li>多点触控集成</li><li>封号的风险</li><li>需要 USB 接入</li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概要">概要<a class="hash-link" href="#概要" title="标题的直接链接">​</a></h2><p>本篇主要讲解在 iOS 平台上如何实现王者荣耀一键换装。安卓由于有<code>adb</code>的存在，自动化远比 iOS 简单的多得多，因此不在本文探讨范畴内，感兴趣地可以参阅以前发的笔记：</p><p>【文章：安卓系统】</p><p>（其实主要是自己目前用 iOS 比较多，所以懒得再写 Android 部分）</p><p>本文核心参考：</p><ul><li><p><a href="https://www.jianshu.com/p/da1e00777273" target="_blank" rel="noopener noreferrer">IOS + Appium 自动化教程 - 简书</a></p></li><li><p><a href="https://github.com/openatx/facebook-wda" target="_blank" rel="noopener noreferrer">openatx/facebook-wda: Facebook WebDriverAgent Python Client Library (not official)</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装概念与分析">秒换装概念与分析<a class="hash-link" href="#秒换装概念与分析" title="标题的直接链接">​</a></h2><p>众所周知，王者荣耀的高端局经常涉及到两个骚操作：秒换装、三指操作。本篇主要将秒换装的操作，三指的话随缘说吧。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装的难度阶梯">秒换装的难度阶梯<a class="hash-link" href="#秒换装的难度阶梯" title="标题的直接链接">​</a></h3><p>不同的换装顺序难度是不同的。</p><p>最简单的是换复活甲，因为复活甲的缓冲时间是 2 秒，并且大多数情况下复活甲是用在对方一波技能打完之后：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417265352-4adad444d58e652ab28960d7be6a3ce444de0f1759ae52d635e21db60a393f67.png" alt="picture 1" class="img_vXGZ"></p><p>其次是换金身，缓冲时间是 1.5 秒。但直到现在，我金身换其他（复活甲、名刀）等都换不来，原因是金身是主动释放，一般都是躲技能的紧急时刻，手忙脚乱的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417294961-eca0d2824084e1fba5f20ec52ad44f50b7e36e7c4e62d05ebc59a9503d92b744.png" alt="picture 2" class="img_vXGZ"></p><p>接着是名刀，缓冲时间只有 1 秒，远程英雄（例如我的诸葛）直接减半。0.5 秒是真地只能换个锤子了。不过名刀其实比金身要好一些，因为触发名刀的场景大多数情况下是在跑路的时候，这个时候不需要什么其他操作，边走边换就可以。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417411153-c17a01f9f0f7b77a407b263dbbd036c4a2ac81c7b8f7debc33da0bdb8a67c1b6.png" alt="picture 3" class="img_vXGZ"></p><p>而换装的核心操作，就是首先先在商店预选好下一件装备（通常走在路上的时候），或者基于预先设置好的出装顺序（缺点等会说）。然后就可以通过四次点击实现换装，在不引起混淆的情况下，我们称这种换装为“一键换装”：</p><ol><li>点击商店</li><li>点击卖出</li><li>点击关闭</li><li>点击购买（第一个推荐装备，如果钱够的话）</li></ol><p>换的核心是卖掉一个再买进一个，如果格子还没满，钱又多，就不存在换的问题，直接就到第四步，这个没啥操作。但如果格子满了，或者钱不够，就需要极快地时间内精准地按下四个键，这个要求是很高的。反正我也曾经尝试在训练营中练过会，表示紧张时刻并不能跟的上。</p><p>因此需要自动化！毕竟，为这样一款游戏苦练换装的手速是不值得的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="备战出装换装的优点">备战出装换装的优点<a class="hash-link" href="#备战出装换装的优点" title="标题的直接链接">​</a></h3><p>备战出装换装的优点也是很显著的，我们可以很简单地备战最后一套出装顺序是复活甲、金身、名刀、血手、炽热支配者。</p><p>这样，假设我们有一键换装脚本，即可轻轻松松地按顺序秒换复活甲、金身、名刀、血手、炽热支配者，十秒换五装。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418687276-36ebbc351388d23a3489aa3b6dcc3d0e6b77794643b4892fcb1e238cc2933d00.png" alt="picture 5" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418656646-e6fc345e3680afe24a83524181fdcb2dd12b94b000e5af6fc6cfcb5e87e20555.png" alt="picture 4" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418923667-471c1cc58cd7497a08732c9a5e9ed57b95fac43a413d6970912f95157b347991.png" alt="picture 6" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="备战出装换装的缺点">备战出装换装的缺点<a class="hash-link" href="#备战出装换装的缺点" title="标题的直接链接">​</a></h3><p>首先是不灵活，局越高端，就越需要针对对方阵容出装，此时的备战出装如果只有一套的话，就很不灵活了。</p><p>我很久以前喜欢玩中单诸葛的时候，就预设了三套出装：暴力（回响+帽子+大书）、防近身（帽子换面具、大书换法穿棒）、防回血（回响换梦魇）。现在比较喜欢在局中随机应变了，但这就引发了新的问题：顺序问题，即如果局中先买了其他装备，则有可能会影响预期顺序。</p><p>例如假设原先六神装最后两件一次是法穿杖、复活甲，由于逆风局中途先出了个魔女抗压，然后快六神的时候，按照顺序第六件变成了法穿杖，第七件才是复活甲，所以按照默认顺序的话，危机关头一键换装就没有换到想要的复活甲。</p><p>所以”手动“预选下一件换装装备的必要性还是有的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="换指定装的实现分析">换指定装的实现分析<a class="hash-link" href="#换指定装的实现分析" title="标题的直接链接">​</a></h3><p>有些场景下，我们需要换指定装，尤其是复活甲。</p><p>比如无论你在玩什么英雄，并且玩的很顺风，突然不小心有个失误被集火了，如果能瞬间换个复活甲，等待队友的输出，可能就对局势有至关重要的影响；或者在最后守水晶或者冲水晶时需要自己用复活甲换对面的输出。</p><p>换指定装的核心难题，最主要的难题是要卖掉哪件装备。</p><p>大多数情况下，最合适的选择，是卖掉鞋子，因为太便宜了，后期的附属属性就不高；其次是最贵的装备，否则可能买不起指定装。</p><p>由于格子是顺序装装备的，因此实际上，我们不太清楚要卖的装备一定在哪个格子里。所以市面上有比如说预先设置好卖掉第六个格子然后买新装备的这种，我认为必要性不高。个人认为，换指定装最佳的方式，还是在和平时提前选好要卖的装备与要买的装备，然后在战时直接使用一键换装。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之语音控制voice-control实现自定义手势">iOS 秒换装实现之语音控制（Voice Control）实现自定义手势<a class="hash-link" href="#ios-秒换装实现之语音控制voice-control实现自定义手势" title="标题的直接链接">​</a></h2><p>在 iOS 平台上，目前最适合小白用户使用的官方办法，是基于语音控制。</p><p>所谓的语音控制，倒不是各种 AI 或者 siri 之类的智能语音控制，而是 iOS 自带的辅助功能里的语音控制，用户可以自己自定义一条语音指令，并未其搭配上手机要执行的输入或者点击动作。</p><p>于是我可以指定一条比如“乌拉”，然后设置其的动作为在屏幕上依次点击四个点（一键换装）的位置。保存之后，就可以通过大喊一声“乌拉”去触发它。</p><p>听起来很酷，但这种办法有几个缺点。</p><p>第一个缺点，是在配置这个点击动作时，它展示的是一个纯白的界面，实际上你不知道自己点的位置对应游戏里的哪个点。</p><p>这几乎只能从硬件上解决：比如我撕了几块小胶带，对照着截图提前贴在屏幕上的对应位置上，有些 B 站视频是用了记号笔，我没有这种可以画在贴膜上的记号笔。</p><p>第二个缺点，是一键换装的点击位置比较靠近边缘（购买键、关闭键），而 iOS 的手势定制时则必须先点击下方的“隐藏控制”，然后才能完整录入四个点的位置，并等待十秒后才能退出（虽然不影响后续操作，但每次都要运行 10 秒的脚本确实不够理想，从完美主义角度来说）。而最关键的就是即使屏幕上有四个标识好的坐标，手指去按时，也很难按照顺序按到最快，毕竟人手始终有反应速度的问题。因此理论上可能至少要 0.5 秒，实际在 1 秒左右。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654518617422-360051627d089bd41668ad94c8f5109559d3c87a2f93740a294b15f693c1ff1d.png" alt="picture 1" class="img_vXGZ"></p><p>如果前两个缺点还只是可以克服的小问题，那么第三个缺点就无法忽视了，那就是启动延时。由于 iOS 的语音控制，需要经过一套算法去识别你有没有喊“乌拉”这个词，因此需要时间，而这个时间，在恒定的一秒左右。所以通过这个办法，至少我测试下来，当我从喊乌拉时到换装完成，实际耗时要在 2.5 秒左右。这个时间，说实话，很不可以接受。</p><p>比如我玩诸葛时有套“富贵险中求”的连招就是“2 冲刺+1+3+金身+2 追击或者撤退”，一套操作都是几乎瞬间完成的，此时如果我们在用完金身后再语音控制进行换装，那基本上是不现实了。</p><p>考虑到这种情况，我后来想了个办法，就是提前喊口令。因为在喊完口令后，要大概一秒才会触发换装，所以我就在准备冲锋时先喊“乌拉”，再按“2+1+3+金身”，此时等待换装完成，然后再后续操作。</p><p>这听起来有点奇怪，非常奇怪，有种蒙太奇的感觉，但它确实是某些场景的有效的解决方案。</p><p>哦对了，最后，说一下语音控制中英文的问题，由于中文指令至少要四个字起步，因此建议配置英文指令，可以很简单的比如说用“f<!-- -->*<!-- -->*<!-- -->k”完成，乌拉不属于英文，但你可以自己配置“wula”的词汇。再者，中文的识别难度肯定比英文大，苹果毕竟是美国的公司，用英文都已经 1 秒延迟了，别说中文了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之越狱第三方应用">iOS 秒换装实现之越狱、第三方应用<a class="hash-link" href="#ios-秒换装实现之越狱第三方应用" title="标题的直接链接">​</a></h2><p>刚刚讲了用苹果官方的语音控制来实现自定义手势以完成一键换装的办法，缺点最主要的是执行时的延迟。</p><p>那有没有其他的软件可以帮助我们更快的反应呢？</p><p>有。但如果我们不越狱的话，几乎没有可用的，比如按键精灵之类。</p><p>反正病毒风险很高，也基本都要收费。</p><p>越狱是不需要收费的，但越狱代价是很高的，普通小白肯定没必要考虑，不然手机就不保修了。</p><p>另一种办法是通过外设实现。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装实现之基于外设硬件">秒换装实现之基于外设硬件<a class="hash-link" href="#秒换装实现之基于外设硬件" title="标题的直接链接">​</a></h2><p>就我所了解到的，国内至少有飞智和北通两家公司在做基于王者荣耀、吃鸡等游戏的外设生态开发，用户只需要购买他们的手柄接上，就能在软件里自定义每个按键的宏动作，从而实现一键换装、英雄连招等操作了。</p><p>我实际体验过北通 H2 和飞智黄蜂 2 两款外设，首先值得肯定的是他们的外设确实是有效的，完全没有上述语音控制的延时问题了。</p><p>但接着个手柄（单手柄或者双手柄）玩王者之类的游戏，还是有点奇怪，因为实际没有完全脱离屏幕，比如比较畅销的黄蜂 2 左手手柄，确实右手的放技能还得在屏幕上比较方便，毕竟每个技能都要摇动，不是一般手柄能够实现的。一般的游戏手柄只有两个摇杆。</p><p>但也有不少问题。北通 H2 的硬件连接、手感、颜值上要逊色于飞智黄蜂 2（当然北通价格也更便宜点），此处暂时不展开对北通 H2 的评价了，是我去年体验的，不太记得了。飞智黄蜂 2 最近体验了一下，说一下它的优缺点。</p><p>首先是优点吧，颜值、做工（据说是日本摇杆）、连接、软件上整体做的都非常不错，体验很好。</p><p>缺点的话，苹果的横屏游戏默认是顺时针旋转 90 度，也就是屏幕顶部是左边。而苹果 13 的摄像头是凸起的，此时如果接黄蜂飞智 2 的左手手柄，会发现不够稳定（如果是接右边则非常贴合），当然由于上下还是能够用力压住，所以还是能用，只是摄像头那部分被压着，感觉不太好。</p><p>这里完全不建议用户把手机开启自动旋转后，逆时针转 90 度后搭配飞智黄蜂 2 玩，否则会发现按键位置完全反了，没法用。飞智官方是推荐大家关闭旋转使用的。但我实际体验下来，通过先逆时针旋转 90 度然后锁定方向后，再去飞智里重新配置（进去再保存再出来，不用更改），其实也能用，只是偶尔会转来转去，这点上是飞智自己的软件没优化到位，或者不愿意担风险，因为硬件操控屏幕的原理是物理坐标点固定的，旋转屏幕后坐标点没变，但游戏中却变了。飞智毕竟是通过软件提前固定好坐标点，所以如果不关闭自动旋转，用户在游戏中旋转手机后则必然出现问题。</p><p>不过对于我来说，还有几个小问题。</p><p>首先是性能过剩，飞智黄蜂 2 配备了摇杆、A 键、B 键、LT 键、LB 键、扳机键，键位对我来说太多了，我其实只要一个键就可以了，这款手柄更适合玩吃鸡。更适合我的其实是飞智的另一款手柄：<a href="https://item.jd.com/100026396908.html" target="_blank" rel="noopener noreferrer">壹柄</a>，它只有一个摇杆和按键。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654520323055-0d1446ea4ae813235202b5d5307b68dbb6a36bf250d31342094d62afe68cc00b.png" alt="picture 3" class="img_vXGZ"></p><p>另一个黄蜂 2 的问题，就是摇杆的位置太偏上了，导致我的手型不是特别舒服，不像直接在屏幕上玩，虎口的角度大概在 45 度，用飞智直接变成 5 度了。</p><p>综上这些考虑，我还是把黄蜂 2 退掉了，毕竟那个价格给我的体验达不到期望，性能也绝对过剩。</p><p>壹柄的话后续我也没有继续考虑，因为我在研究飞智的软件时，同步研究了不越狱情况下对 iOS 自动化的实现办法，而这最终成功了，那就是大名鼎鼎的 wda：WebDriverAgent。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之基于-ios-自动化facebook-wdawebdriveragent">iOS 秒换装实现之基于 iOS 自动化：<code>facebook-wda</code>（WebDriverAgent）<a class="hash-link" href="#ios-秒换装实现之基于-ios-自动化facebook-wdawebdriveragent" title="标题的直接链接">​</a></h2><p>wda 是什么？从名字来看：WebDriverAgent，网页驱动代理，这个对于我（一名专业的爬虫工程师）来说太熟悉不过了，我们平常用的 selenium 自动化框架其实背后都需要一个 driver，比如 phantom、google 的 chromedriver 或者 firefox 的 geckodriver。</p><p>那 wda 的作用就是把整个手机系统的 ui 操作，集中到这个 wda 身上，通过 wda 向下调用系统的 ui 操作指令，从而完成自动化。</p><p>在 iOS 平台上，这个系统 ui 操作指令的框架，是苹果自带的<code>UiAutomation</code>（已废弃）和<code>XCTest.framwork</code>。</p><p>在我配置 wda 的过程中，经历了漫长而又痛苦的调试过程，一开始我是直接用 facebook 官方的<code>WebDriverAgent</code>进行配置的，结果各种 bug，主要是我的 xcode、我的手机系统（iOS15）太新了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521247615-7aa64babfae21ba5e4aa3f7312675df1823496646c8005d524c0cd502dc50db3.png" alt="picture 4" class="img_vXGZ"></p><p>爬坑的过程可以参考：- <a href="https://www.cnblogs.com/hong-fithing/p/15203980.html" target="_blank" rel="noopener noreferrer">WebDriverAgent 重签名爬坑记 - 温一壶清酒 - 博客园</a></p><p>当时就是卡在了第二步，百般搜索都得不到解决办法，结果竟然找到一个国人把四步都走完了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521364105-3d2dd53b80df2fd385b651734d5867196d488eedae1961875d73b22dadab17ad.png" alt="picture 5" class="img_vXGZ"></p><p>但尽管如此，基于 facebook 的这个 wda，我最终还是有一步没有搞定，那就是<code>inspector</code>不出截屏图片，我看了原因，还是有一句代码没过，所以这个代码确实太老了。</p><p>最终，我选择了文章里说的方法二，也就是基于 appium 里面的 wda，一下就成功了，果然代码还是得用新的。</p><p>新的 wda 里也没有<code>inspector</code>，而且<code>session</code>默认返回<code>null</code>了，我以为又是我的操作的问题，后来在 <a href="https://testerhome.com/topics/23554" target="_blank" rel="noopener noreferrer">返回的 json 串 sessionId 为什么是 null · TesterHome</a>确认了是新的版本设计。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521693689-9d8b15bb0e192e41c9d11220eb29b5e68314d402eaf407d714543a2a5f31c2d6.png" alt="picture 6" class="img_vXGZ"></p><p>最后一切 ok 之后，使用<code>facebook-wda</code>的 python 客户端进行连接，果然成功了，然后就可以通过代码控制屏幕的触摸手势了，一切都非常丝滑。</p><p>不过使用<code>WebDriverAgent</code>也有一些问题，最大的问题是由于底层使用了 iOS 自带的 Test 框架，所以会有两行字“Automation Running, Hold...”在屏幕上随机浮动，有时会长时间不提示，有时就会一直都在，虽然是层“Overlay”半透明的，但是很烦，这个没法去除。</p><p>另外有一个问题是屏幕没动作每隔两三秒就会自动变暗，于是我在执行脚本的时候启动了两个线程，一个线程捕获键盘动作执行脚本，另一个线程每隔 2 秒钟点击一下屏幕上的（0, 0）处坐标，保持屏幕常量，实测有效。</p><p>以下是现成的执行代码脚本：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> wda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># wda.DEBUG = True # default False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTP_TIMEOUT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># default 60.0 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DURATION </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IS_RUNNING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># url = &quot;http://169.254.101.229:8100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># url = &quot;http://192.168.1.3:8100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://localhost:8100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># session_id = &#x27;B957CEB2-26D7-489E-A659-B37F24823ABD&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;00008110-000634163E9B801E&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># c = wda.Client(url=url)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># c = wda.Client()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果只有一个设备也可以简写为</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If there is only one iPhone connected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">USBClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Show status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Wait WDA ready</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait_ready</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 等待300s，默认120s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_Y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8837606837606837</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.34360189573459715</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_6 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.6994470774091627</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_X_INTERVAL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0711690363349131</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (CHOOSE_6 - CHOOSE_1) / 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> IS_SHOPPING_OPEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> IS_SHOPPING_OPEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;打开商店&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.06872037914691943</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.4111111111111111</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     print(&quot;商店已打开&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;卖出装备&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8270142180094787</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.8017094017094017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;购买装备（在商店中）&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8270142180094787</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.9017094017094017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> IS_SHOPPING_OPEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> IS_SHOPPING_OPEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;关闭商店&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8609794628751974</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.08034188034188035</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     print(&quot;商店已关闭&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;购买第一件推荐装备&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.13361769352290679</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.40615384615384615</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_k_bought</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    选中第i个已买的装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param i: 从1到6</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;选择第</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">格已买装备&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CHOOSE_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> CHOOSE_X_INTERVAL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_move</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;筛选【移动】（鞋子）&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.13230647709320695</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.6068376068376068</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;筛选【攻击】&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.12717219589257503</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.30256410256410254</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_defense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;筛选【防御】&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.12717219589257503</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.55056410256410254</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    购买名刀</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;购买名刀&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 滑动到名刀页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">swipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.45</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    购买复活甲</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;购买复活甲&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_defense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 滑动到复活甲页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">swipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.65</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&gt;&gt;&gt; 一键购买复活甲&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&gt;&gt;&gt; 购买名刀&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_switch_for_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    一键换预选装</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&gt;&gt;&gt; 一键换装&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&gt;&gt;&gt; 清空装备&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select_k_bought</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_buy_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&gt;&gt;&gt; 购买推塔装&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        速击之枪</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42101105845181674</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.8008547008547009</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        风暴巨剑</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42338072669826227</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.1811965811965812</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 买攻速鞋</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_move</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42101105845181674</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.8257264957264957</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 再买攻速装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_keep_awake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_monitor_input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> keyboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ESC&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27; &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_switch_for_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;f&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;m&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;q&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;g&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_buy_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> threading </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Thread</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_monitor_input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_keep_awake</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> daemon</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这些硬编码的坐标也需要通过一个脚本获取，我是基于 opencv 实现的：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">ref:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    - [Displaying the coordinates of the points clicked on the image using Python-OpenCV - GeeksforGeeks](https://www.geeksforgeeks.org/displaying-the-coordinates-of-the-points-clicked-on-the-image-using-python-opencv/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    - [How to draw Chinese text on the image using `cv2.putText`correctly? (Python+OpenCV) - Stack Overflow](https://stackoverflow.com/questions/50854235/how-to-draw-chinese-text-on-the-image-using-cv2-puttextcorrectly-pythonopen)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># importing the module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> jstyleson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jstyleson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># function to display the coordinates of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># of the points clicked on the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">click_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flags</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># checking for left mouse clicks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EVENT_LBUTTONDOWN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the Shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27; &#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the image window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        font </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_SIMPLEX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> font</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        coors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># checking for right mouse clicks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EVENT_RBUTTONDOWN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the Shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27; &#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the image window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        font </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_SIMPLEX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        g </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> font</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># driver function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;脚本名：&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># reading the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;assets/攻击.png&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;w: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">w</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, h: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">h</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># setting mouse handler for the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># and calling the click_event() function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">setMouseCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> click_event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># wait for a key to be pressed to exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">waitKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># close the window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destroyAllWindows</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coors</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fn</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;w&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> indent</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ui-自动化的缺点行走中的触控集成问题">UI 自动化的缺点（行走中的触控集成问题）<a class="hash-link" href="#ui-自动化的缺点行走中的触控集成问题" title="标题的直接链接">​</a></h2><p>最后说说 UI 自动化的缺点。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="多点触控集成">多点触控集成<a class="hash-link" href="#多点触控集成" title="标题的直接链接">​</a></h3><p>首先是影响可行性的一个问题：多点触控集成。</p><p>这个问题在我去年做安卓触控开发的时候就发现了，为此我当时写了一个触控集成中心，当做系统触控事件的代理人、中间人，实测有效，但有点 bug，由于时间有限最后也没有去修复。</p><p>这个问题到底是啥呢？那就是安卓与苹果系统的触控事件单元，不是基于手指的，而是基于时间戳的。</p><p>啥意思呢？</p><p>意思就是，当我手指在屏幕上点击一个点时，系统报的是一个单指点击的动作；而如果是两根手指点击了两个点时，系统报的是一个双指点击的动作。那么问题来了，当我在游戏中使用左手控制方向盘移动时，系统报的是一个单指按压移动的动作；此时如果我用自动化控制脚本再发送一个点击动作，则不可行，因为此时应该是一个双指动作，但现在缺少那么一个中枢告诉系统，我现在是双指了，因为屏幕是屏幕，脚本是脚本，如果用脚本，那么手指在屏幕上最好别动。否则脚本在动，手指也在动，系统就会犯迷糊，这是最大的问题。</p><p>我当时做的就是首先监控屏幕上的手指，把它拦截；同时监控外设的输出，也把它拦截，然后把两个根据安卓的规则再封装，再往下传，这是可行的。但我们的 iOS 平台上的 wda，我目测下来是不行的。</p><p>所以平常我可以边移动，边用另一根手指打开商店进行换装。</p><p>但现在，使用脚本，你只能移动停止后，再启动脚本换装完成，然后再恢复移动，中间一定不要碰屏幕，否则轻则导致换装失败，重则脚本直接挂掉，因为会让 iOS 觉得这个触控事件输入有问题。</p><p>好在，这个问题其实不大，我之前用一开始的脚本录了一个视频，这里面可以看到换装的时间还比较长的。</p><p>【视频：一键换装】</p><p>后来考虑到了这个问题，不能长，所以我修改了程序里面每个按键的默认时长，都改为了 0.01 秒完成按键动作，然后换装就直接飞快，这绝对不是人手可以点出来的速度，但它就是有效的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654522860291-7e2aabde59c6f2a614466c859c1df9ba13587f20a621833665adaef5a4d0a05f.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="封号的风险">封号的风险<a class="hash-link" href="#封号的风险" title="标题的直接链接">​</a></h3><p>那点这么快，会不会有封号风险？</p><p>哈哈哈，其实不会，以我多年的经验，可以肯定的说，首先我们基于的是苹果自带的自动化控制框架，因此每个点击动作都是有苹果系统官方背书的，一个处于应用层的游戏，只有老老实实接受系统输入的份。</p><p>并且，我们的换装，基本上只占游戏全程极其小的一部分，有时候甚至一局都没有一次换装，因此即使 TX 的反作弊数据分析部分再牛掰，怕也是无法找到你自动化的蛛丝马迹。尤其是如果我再在程序里加入随机抖动算法的话，尽管显然没那个必要。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="需要-usb-接入">需要 USB 接入<a class="hash-link" href="#需要-usb-接入" title="标题的直接链接">​</a></h3><p>我非常希望能像安卓平台上的 adb 一样，先用有线接上，再断开用无线。</p><p>我看到<code>facebook-wda</code>里面提供了无线连接的方式，但很可惜我没能实现，无论是使用<code>iproxy</code>端口转发的操作还是啥，我都必须有线连着脚本才能正常运行，这让我打游戏时的感觉很怪。</p><p>因为其实我已经接了一个散热背夹，没错，其实比起自动化脚本，散热才是更更更重要的关注点，否则这个夏天，一局还没打完就已经手机发热然后掉帧、烫手，然后你就输了。</p><p>推荐这款，我用下来感觉还不错：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654523305583-742fbd49ea5da78a8dcf2ae54748db5a20070c78cba4069e4178243e39dd675c.png" alt="picture 8" class="img_vXGZ"></p><p>不过由于最近已经不玩游戏了，所以退了所有的游戏外设。</p><p>要说为啥，因为找到了新的乐趣来源，那就是这今年一直要做的另一件事：读尽世间书，阅尽天下片！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654523407342-6a07577f0784c5843c8675af4047ea7683594b5190c575b9d3d1b3472db6cfde.png" alt="picture 9" class="img_vXGZ"></p><p>毕竟游戏玩的再好，也只是一盘一盘的重复，但人生却是无止尽的向前。我们，未来再见！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524260027-4acc458ab3f551e86fc146ef482635fc3abce31562c1dfa4c5022556d12ea70c.jpg" alt="picture 15" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524266932-49215831f445e85f707c234a12f7540194a522edaf45dd2a98ce28df80f9b765.jpg" alt="picture 16" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524282234-9c7803fd45febc00cca65ee75d18d4918fbacf2e70d8189f875a8bca74511aaa.jpg" alt="picture 17" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524311716-968fecfb2e55e90262ca2e5af7f086197938f3357d6850ebba043553e38056d1.jpg" alt="picture 18" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524075184-69bc3ee3d3732781910a1736339886d88886682816ddb5ec72fcbdb6df943a11.jpg" alt="picture 14" class="img_vXGZ"></p><p>【音乐：Saturn】</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/自动化">自动化</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/i-os">iOS</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/王者荣耀">王者荣耀</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/05/23/dev-mp3-meta">编程 | 逼哥的音乐元数据修复</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-05-23T00:00:00.000Z" itemprop="datePublished">2022/05/23</time> · <!-- -->阅读需 4 分钟</div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310547240-0ba20a542cc9ebc6cf5540ad60c8e4ec8ae831b74d05ee16d60e98dba83e91ae.png" alt="picture 1" class="img_vXGZ"></p><p>今日在 Apple Music 中导入逼哥的音乐库时，出现了信息乱码：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310695038-ed58410316d27f140f6d1df184971f369407b68053846151b1271578df0946ea.png" alt="picture 2" class="img_vXGZ"></p><p>可以看到，主要是<code>title</code>和<code>author</code>列出现了问题，这不禁引起了我的兴趣。</p><p>我第一反应便是去对应的原素材文件夹，右键 get info，可以看到确实是有两个属性是乱码（左边是原来的，右边是后续修复的）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310814595-e051efe2bf22ee099843f2cade8051e1d0ec73864ba0540e7a27ac86faea5c7e.png" alt="picture 3" class="img_vXGZ"></p><p>我原以为可以直接在属性窗上修改，结果不行。</p><p>于是我就想到，可能需要借助一些专业软件。果然，<strong>涉及到 apple music 列表显示的关键信息，是 mp3 文件的 meta 数据</strong>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310896397-b120adf7f15be2c82193521a2a0dbcc92abf91708af94d195fa03a8ee44a0752.png" alt="picture 4" class="img_vXGZ"></p><p>按照老经验，去我们的破解专用软件站去下载：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310917717-96c26a3d5605a5736b8575c3946b946d627eac259ac48017ed8d361fec5ee494.png" alt="picture 5" class="img_vXGZ"></p><p>使用起来很简单，导入我们的文件夹，然后一个个修改 mp3 原数据的信息即可：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310979865-312e6d473496ab4b99c3ef50bbbc7e49640ec2ff0f91d66f8ba8da5b3a68c0ef.png" alt="picture 6" class="img_vXGZ"></p><p>但既然了解了背后的原理，一个个手动修改元数据未免太慢了。</p><p>考虑到我导入的音乐，其文件名本身是良好定义的，所以直接写个程序去批量化处理比较好。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311076592-c5fac94b7c1c9fbac41da0763a2b415c7eeb97a1a8af5bc0577497b97fada43e.png" alt="picture 7" class="img_vXGZ"></p><p>它们用的是<code>eyeD3</code>这个库：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311105001-491e73b2c2fdcaf3c0a822892515284a07555e8bc4f07f2da2242b0b8edc9283.png" alt="picture 8" class="img_vXGZ"></p><p>使用方法也非常简单，一看就明白：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311130085-98b0cb7b131b2ea6a9f72142e5ed18ceba98e24d5392f6bef5b782df861ceb2a.png" alt="picture 9" class="img_vXGZ"></p><p>那就轻松了，我们直接写程序即可。</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> eyed3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">edit_mp3_meta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fp_: &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eyed3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://stackoverflow.com/a/67541983/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">artist </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">u&#x27;%s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">u&#x27;%s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> title</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://stackoverflow.com/a/32908607/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eyed3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ID3_DEFAULT_VERSION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;李志&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理第一个乱码文件夹，它们内部的命名是 “李志 - 歌名（专辑）.mp3&quot;，用正则提取比较方便</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># dir = &#x27;/Volumes/Disk2/resources/乐/lizhi-18砖/2015年《i.O》 (2014-2015李志跨年音乐会)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># for fn in os.listdir(dir):</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     fp_ = os.path.join(dir, fn)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     song_name_match = re.match(f&#x27;{author} - (.*?)\(2014i／O版\).mp3&#x27;, fn)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     assert song_name_match, fn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     song_name = song_name_match.groups()[0]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     edit_mp3_meta(fp_, song_name, author)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理第二个乱码文件夹，里面有两个CD文件夹，因此使用`walk`迭代，音乐命名是其本身，因此直接提取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dirs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fns </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">walk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/Volumes/Disk2/resources/乐/lizhi-18砖/2013《108个关键词》&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> fn </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> fns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mp3&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                song_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                edit_mp3_meta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> song_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>处理完后，我们重新导入这些音乐，就发现，apple music 中的属性都正常了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311311787-92d45f8fae2b0ac6518f4bcaeb3db6e71d3a3ebaebd8a239a1d8657b0f0e2b50.png" alt="picture 10" class="img_vXGZ"></p><p>希望对你有用~</p><p>查询参考：</p><ul><li><a href="https://www.google.com.hk/search?q=mac+get+info+%E4%B9%B1%E7%A0%81&amp;newwindow=1&amp;ei=TXuLYrGBDf_N2roPw_Sf6AM&amp;ved=0ahUKEwjx27uRzfX3AhX_plYBHUP6Bz0Q4dUDCA4&amp;uact=5&amp;oq=mac+get+info+%E4%B9%B1%E7%A0%81&amp;gs_lcp=Cgdnd3Mtd2l6EANKBAhBGAFKBAhGGABQuAVYjQhg2AtoAXAAeACAAZ0BiAGJBJIBAzAuNJgBAKABAcABAQ&amp;sclient=gws-wiz" target="_blank" rel="noopener noreferrer">mac get info 乱码 - Google 搜索</a></li><li><a href="https://www.google.com.hk/search?q=mp3+modify++title+and+author" target="_blank" rel="noopener noreferrer">mp3 modify title and author - Google 搜索</a></li><li><a href="https://www.mp3tag.de/en/download.html" target="_blank" rel="noopener noreferrer">Mp3tag - Download</a></li><li><a href="https://macwk.com/soft/mp3tag" target="_blank" rel="noopener noreferrer">Mp3tag 1.2.2 中文破解版 for Mac 音频元数据编辑工具</a></li><li><a href="https://www.google.com.hk/search?q=python+modify+mp3+tag" target="_blank" rel="noopener noreferrer">python modify mp3 tag - Google 搜索</a></li><li><a href="https://stackoverflow.com/questions/8948/accessing-mp3-metadata-with-python" target="_blank" rel="noopener noreferrer">Accessing MP3 metadata with Python - Stack Overflow</a></li><li><a href="https://eyed3.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Welcome to eyeD3 — eyeD3 0.9.4 documentation</a></li><li><a href="https://www.google.com.hk/search?q=eyed3+unicode&amp;oq=eyed3+unicode&amp;aqs=chrome..69i57j69i60.3349j0j7&amp;sourceid=chrome&amp;ie=UTF-8" target="_blank" rel="noopener noreferrer">eyed3 unicode - Google 搜索</a></li><li><a href="https://stackoverflow.com/questions/30388411/processing-chinese-character-using-eyed3-in-python" target="_blank" rel="noopener noreferrer">encoding - Processing chinese character using eyed3 in python - Stack Overflow</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/音乐">音乐</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tags/开发笔记/page/2"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>