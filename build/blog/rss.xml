<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>南川笔记 Blog</title>
        <link>https://markshawn2020.github.io/blog</link>
        <description>南川笔记 Blog</description>
        <lastBuildDate>Sun, 15 Sep 2024 15:31:46 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[2024/2422-INFP与ENTJ的日日夜夜]]></title>
            <link>https://markshawn2020.github.io/blog/2024/2422-INFP与ENTJ的日日夜夜</link>
            <guid>/2024/2422-INFP与ENTJ的日日夜夜</guid>
            <pubDate>Sun, 15 Sep 2024 15:31:46 GMT</pubDate>
            <description><![CDATA[1. 今天晚上你吃什么？]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="1-今天晚上你吃什么">1. 今天晚上你吃什么？<a class="hash-link" href="#1-今天晚上你吃什么" title="标题的直接链接">​</a></h2><ul><li>INFP：草。</li><li>ENTJ：公司食堂，如果你来的话，我们可以一起吃火锅（仅限第一次）。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="2-怎么做到怎么吃都不胖">2. 怎么做到怎么吃都不胖？<a class="hash-link" href="#2-怎么做到怎么吃都不胖" title="标题的直接链接">​</a></h2><ul><li>INFP：已胖8斤。</li><li>ENTJ：只要你和我一样，没有对吃的欲望，你就能怎么吃都不胖。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="3-为什么乌鸦的味道尝起来会像黄昏">3. 为什么乌鸦的味道尝起来会像黄昏？<a class="hash-link" href="#3-为什么乌鸦的味道尝起来会像黄昏" title="标题的直接链接">​</a></h2><ul><li>INFP：乌鸦杀死了板蓝根。</li><li>ENTJ：因为你大概只在黄昏时刻见过乌鸦，但其实它们和你一样，活在每时每刻。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="4-一辈子可以不用那么长吗">4. 一辈子可以不用那么长吗？<a class="hash-link" href="#4-一辈子可以不用那么长吗" title="标题的直接链接">​</a></h2><ul><li>INFP：把一辈子定义成24H就会变成固定长度。</li><li>ENTJ：可以，只要你学会如何活得开心，届时你只会懊恼一辈子太短，哦不，如果你懊恼此点，说明你还没学会如何活得开心。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="5-时间的流速是否会因为我的心情改变">5. 时间的流速是否会因为我的心情改变？<a class="hash-link" href="#5-时间的流速是否会因为我的心情改变" title="标题的直接链接">​</a></h2><ul><li>INFP：不会。</li><li>ENTJ：不会。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="6-人类以后能不能长出翅膀">6. 人类以后能不能长出翅膀？<a class="hash-link" href="#6-人类以后能不能长出翅膀" title="标题的直接链接">​</a></h2><ul><li>INFP：已经长出，无需以后。</li><li>ENTJ：<ol><li>取决于你怎么定义”翅膀“<ol><li>如果它指能让一个人拥有飞行能力的客体，则目前翼装飞行里的翼装应该算翅膀；</li><li>如果它指能让一个人随心所欲飞行的客体，则美国现在的喷气式个人动力背包也算翅膀，只不过续航还比较差，以及门槛比较高。</li></ol></li><li>还取决于你怎么定义“长”<ol><li>如果你指的是逻辑学上的拥有，则参考刚刚的 1；</li><li>如果你指的是生物学上的生长，可以但没必要。在人类拥有生成翅膀的基因修改能力前，人类可能已经毁灭。</li></ol></li></ol></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="7-平凡人的生命究竟有何意义">7. 平凡人的生命究竟有何意义？<a class="hash-link" href="#7-平凡人的生命究竟有何意义" title="标题的直接链接">​</a></h2><ul><li>INFP：成为卑贱的奴隶，享受无知的快乐。</li><li>ENTJ：每个人的生命都有意义，比如 led by us nerds。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="8-时间何时能为我们加冕">8. 时间何时能为我们加冕？<a class="hash-link" href="#8-时间何时能为我们加冕" title="标题的直接链接">​</a></h2><ul><li>INFP：“一辈子”以后。</li><li>ENTJ：时间与我们没有关系。如果你想被加冕，你现在就可以，无需等时间。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="9-什么是爱情">9. 什么是爱情？<a class="hash-link" href="#9-什么是爱情" title="标题的直接链接">​</a></h2><ul><li>INFP：![<!-- -->[IMG_3337 2.jpg]<!-- -->]
请回答：Love found or love lost ？</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="10-为什么我跟前女友分手三年了还是没有彻底忘掉">10. 为什么我跟前女友分手三年了还是没有彻底忘掉？<a class="hash-link" href="#10-为什么我跟前女友分手三年了还是没有彻底忘掉" title="标题的直接链接">​</a></h2><ul><li>INFP：因为你是一个记忆力不错的人。</li><li>ENTJ：因为新的不够好。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="11-为什么我总是与互相喜欢的女孩因为不可抗拒力因素而无法在一起">11. 为什么我总是与互相喜欢的女孩因为不可抗拒力因素而无法在一起？<a class="hash-link" href="#11-为什么我总是与互相喜欢的女孩因为不可抗拒力因素而无法在一起" title="标题的直接链接">​</a></h2><ul><li>INFP：互相喜欢也是一种在一起。</li><li>ENTJ：当你的事业一直在上升，你就不再有这样的问题。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="12-我一定要结婚生子吗">12. 我一定要结婚生子吗？<a class="hash-link" href="#12-我一定要结婚生子吗" title="标题的直接链接">​</a></h2><ul><li>INFP：你一定要结婚生子吗？</li><li>ENTJ：结婚不一定要生子；生子也不一定要结婚。这是两个问题，建议你拆开重新问一遍。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="13-我深爱的痛苦会去向何处">13. 我深爱的痛苦会去向何处？<a class="hash-link" href="#13-我深爱的痛苦会去向何处" title="标题的直接链接">​</a></h2><ul><li>INFP：消失在沉默里。</li><li>ENTJ：你深爱的不是痛苦，你深爱的只是被痛苦沉浸的一种感觉。既然你被痛苦沉浸，所以你去向哪里，你“深爱的”痛苦就会去向哪里。你，很重要，请记住这一点。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="14-下雨天你喜欢做什么事呢">14. 下雨天你喜欢做什么事呢？<a class="hash-link" href="#14-下雨天你喜欢做什么事呢" title="标题的直接链接">​</a></h2><ul><li>INFP：【四首歌】。</li><li>ENTJ：</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="15-什么时候可以买到自己的房子呢">15. 什么时候可以买到自己的房子呢？<a class="hash-link" href="#15-什么时候可以买到自己的房子呢" title="标题的直接链接">​</a></h2><ul><li>INFP：并不期待爱情，也不期待房子。</li><li>ENTJ：考虑到我们的房价收入比，你可以首先申请一份互联网大厂的工作，并努力做到中高管，按照年收入一百万的水平，再找个大厂的女朋友，掏空四个口袋，也许你可以在五到十年内在一线城市买上一套一千万的房子。如果你做不到这几点，偷偷告诉你一个小秘密，多花点时间租一个好房子可以显著提高你生活的幸福感，这种幸福感，有望能加大你拥有买到自己房子的能力的概率。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="16-你房间里有蛐蛐吗">16. 你房间里有蛐蛐吗？<a class="hash-link" href="#16-你房间里有蛐蛐吗" title="标题的直接链接">​</a></h2><ul><li>INFP：我房间里有狗，企鹅，豌豆，猪，鸭子。</li><li>ENTJ：我房间里有一个彼此不相爱的女人。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="17-为什么一定要努力生活呢">17. 为什么一定要努力生活呢？<a class="hash-link" href="#17-为什么一定要努力生活呢" title="标题的直接链接">​</a></h2><ul><li>INFP：我不知道，大概是为了短暂的快乐吧。为了20%的快乐，品尝80%的痛苦。like this：
![<!-- -->[IMG_3338.jpg]<!-- -->]</li><li>ENTJ：努不努力不重要，重要的是努力的方向和决心。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="18-真地能做自己想做的事吗">18. 真地能做自己想做的事吗？<a class="hash-link" href="#18-真地能做自己想做的事吗" title="标题的直接链接">​</a></h2><ul><li>INFP： 可以肯定的是，能。</li><li>ENTJ：任何一个人都能做自己想做的事。但既然你有这个问题，大概是不能了，因为你不是真地想。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="19-为什么我不招人喜欢啊">19. 为什么我不招人喜欢啊？<a class="hash-link" href="#19-为什么我不招人喜欢啊" title="标题的直接链接">​</a></h2><ul><li>INFP：提问错误，你招。</li><li>ENTJ：推荐读一下《被讨厌的勇气》。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="20-怎么样才能不去在意别人对你不好的评价">20. 怎么样才能不去在意别人对你不好的评价？<a class="hash-link" href="#20-怎么样才能不去在意别人对你不好的评价" title="标题的直接链接">​</a></h2><ul><li>INFP：吃一颗星球杯。</li><li>ENTJ：变强。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="21-如何与自己和解呢">21. 如何与自己和解呢？<a class="hash-link" href="#21-如何与自己和解呢" title="标题的直接链接">​</a></h2><ul><li>INFP：过21天再提问现在对自己提出的问题。</li><li>ENTJ：每个月月初亲手杀死一只小动物。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="22-鱼会觉得天上的月亮是假的吗">22. 鱼会觉得天上的月亮是假的吗？<a class="hash-link" href="#22-鱼会觉得天上的月亮是假的吗" title="标题的直接链接">​</a></h2><ul><li>INFP：不会，他还没看清月亮，就会被吃掉，真假不是他需要思考的问题。</li><li>ENTJ：首先要确认鱼有没有意识，其次要确认鱼有没有真假的概念，再其次它要理解什么是“天上的月亮”。从目前掌握的科学来看，应该不会。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="23-月亮什么时候停止转动">23. 月亮什么时候停止转动？<a class="hash-link" href="#23-月亮什么时候停止转动" title="标题的直接链接">​</a></h2><ul><li>INFP：苦月亮。</li><li>ENTJ：宇宙内的任何一个物体，不会停止转动。但从地球视角上看，除非数万颗陨石与月亮合成一个和地球相当的星体，并互相缠绕为双子星，否则不会停止转动。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="24-我晚上下班出公司应该迈左脚还是右脚">24. 我晚上下班出公司应该迈左脚还是右脚？<a class="hash-link" href="#24-我晚上下班出公司应该迈左脚还是右脚" title="标题的直接链接">​</a></h2><ul><li>INFP：试试双脚并拢跳出去。</li><li>ENTJ：建议迈你的顺脚，比较安全。如果你不知道哪只是，可以试着学一下滑板，习惯迈在滑板前部的就是你的顺脚。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="25-可以所有人都不加班吗">25. 可以所有人都不加班吗？<a class="hash-link" href="#25-可以所有人都不加班吗" title="标题的直接链接">​</a></h2><ul><li>INFP：只要不下班就可以了。</li><li>ENTJ：理论上可行，但实际总有卷王，最后就会大部分都加班了。这叫“电影院效应”。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="26-宝藏山什么时候能让全世界知道呢">26. 宝藏山什么时候能让全世界知道呢？<a class="hash-link" href="#26-宝藏山什么时候能让全世界知道呢" title="标题的直接链接">​</a></h2><ul><li>INFP：救赎山什么时候能让全世界知道呢？</li><li>ENTJ：既然连我都不知道，可能还很遥远。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="27-为什么做梦的时候的感觉都那么真实">27. 为什么做梦的时候的感觉都那么真实？<a class="hash-link" href="#27-为什么做梦的时候的感觉都那么真实" title="标题的直接链接">​</a></h2><ul><li>INFP：我更擅长自己控制走向。</li><li>ENTJ：因为专注。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="28-仿生人会梦见电子羊吗">28. 仿生人会梦见电子羊吗？<a class="hash-link" href="#28-仿生人会梦见电子羊吗" title="标题的直接链接">​</a></h2><ul><li>INFP：仿生人在交配，不做梦。</li><li>ENTJ：如果程序里允许做梦，并且允许以某种概率随机做梦的话，答案应该是可能的。毕竟连猴子可以敲出一部莎士比亚。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="29-你现在感觉怎样">29. 你现在感觉怎样？<a class="hash-link" href="#29-你现在感觉怎样" title="标题的直接链接">​</a></h2><ul><li>INFP：So bad。</li><li>ENTJ：Pure calm。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="30-在生命的最后三天你会做什么">30. 在生命的最后三天你会做什么？<a class="hash-link" href="#30-在生命的最后三天你会做什么" title="标题的直接链接">​</a></h2><ul><li>INFP：吃1500颗星球杯。</li><li>ENTJ：第一天计划度过接下来的三天；第二天计划接下来的两天；第三天计划接下来的一天。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="31-怎么像你一样美">31. 怎么像你一样美？<a class="hash-link" href="#31-怎么像你一样美" title="标题的直接链接">​</a></h2><ul><li>INFP：我丑，伪命题。</li><li>ENTJ：我是男的。</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[2024/2422-从FP走向TJ]]></title>
            <link>https://markshawn2020.github.io/blog/2024/2422-从FP走向TJ</link>
            <guid>/2024/2422-从FP走向TJ</guid>
            <pubDate>Sun, 15 Sep 2024 15:31:46 GMT</pubDate>
            <description><![CDATA[五月末，飞往深圳，微凉。]]></description>
            <content:encoded><![CDATA[<p>五月末，飞往深圳，微凉。</p><hr><p>马斯克曾经被问做过最艰难的决定是什么，他沉思了很久，最后说出搭建自己的纠正反馈循环系统。</p><p>YC的创始人曾经指出绝大多数公司都会犯的一个错误是，在开除不合适的员工上花费的时间过久。</p><p>乔布斯、马斯克、黄仁勋……如果你不去深入了解，你不会相信这些取得骄傲成绩的“西方”企业家们无不有一个共同的特点：要求很高，极难共事。</p><p>我有时候</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Rabbit-R1分享会]]></title>
            <link>https://markshawn2020.github.io/blog/2024/06/21/Rabbit-R1分享会</link>
            <guid>/2024/06/21/Rabbit-R1分享会</guid>
            <pubDate>Fri, 21 Jun 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[- 112g iPhone 一半大小，199$，50%硬件利润率]]></description>
            <content:encoded><![CDATA[<ul><li><p>112g iPhone 一半大小，199$，50%硬件利润率</p></li><li><p>intention已经解决了</p></li><li><p>着力做action，没有train自己的模型，focus on agent</p></li><li><p>为什么不做app</p><ul><li>权限问题、隐私问题 拿不到其他app</li><li>要有自己的「vehicle」</li><li>好处<ul><li>很快搭建了全链路的团队</li></ul></li></ul></li><li><p>ces 6月9日</p><ul><li>预期 3000台</li><li>实际 8000台</li></ul></li><li><p>目前超过13w台</p><ul><li>比第二名（AI Pin 1w台）好十倍</li><li>1500 台 cancel （1%，低于业务5%）</li></ul></li><li><p>14人 --&gt; 60人</p></li><li><p>团队非常强，和authropic等建立很好的合作关系，第一时间可以拿到最新的模型</p></li><li><p>LAM：Learning Human Action</p></li><li><p>uber、doorash api开始不维护api</p><ul><li>没有带来收益</li><li>环境不是很好</li><li>ai时代的api 应该是generic的</li><li>？跟transformer不一样</li><li>都有一个ui --&gt; neuro-symbolic research</li></ul></li><li><p>给ai示范一次gui操作</p><ul><li>类似 iphone 的 automation （做一个agent）</li><li>没有很早地releas<ul><li>原因：ai safety</li></ul></li></ul></li><li><p>机械臂 + 摄像头 + 学习使用说明书</p></li><li><p>personalized computing</p><ul><li>data 层面</li><li>GUI 层面</li></ul></li><li><p>生成式UI</p><ul><li>大量投入</li></ul></li><li><p>R1 device UI</p><ul><li>目前是hardcode</li><li>后续能否变成生成式</li></ul></li><li><p>渡鸦（最初的梦想）</p><ul><li>Javis 共有的梦想</li></ul></li><li><p>李斌：向死而生、伟大的失败</p></li><li><p>未来长期的定位</p><ul><li>终局是 模型公司 / computer 公司 ？</li><li>有市场/用户决定的<ul><li>e.g<ul><li>apple</li><li>nvidia</li></ul></li></ul></li><li>跟传统软件开发不一样<ul><li>确定代码没问题（白盒）</li><li>现在不行<ul><li>黑盒</li><li>不稳定</li></ul></li><li>memory的回溯非常难</li><li>发布会也很难ready</li><li>容易early adopter</li><li>【早发售】<ul><li>接受被骂</li><li>拿到用户数据</li></ul></li></ul></li></ul></li><li><p>为什么不是可穿戴设备</p><ul><li>设计有强的偏见</li><li>按钮（长按语音的用户习惯）<ul><li>语音wake up有latency loss，不及按钮</li><li>提升 240ms （反应500ms，wifi更快）<ul><li>之前的软件 yue liu，语音交互latency很重要</li></ul></li></ul></li><li>空sim卡槽<ul><li>一下可以卖全球</li><li>而非 e-sim卡 （6-8月谈合作）</li></ul></li><li>宠物小精灵的灵感设计</li><li>去风险</li></ul></li><li><p>分享：背后的设计</p><ul><li>gopro的设计是对的</li><li>手机尺寸，装口袋里正好</li></ul></li><li><p>推理不收费，成本怎么控制</p><ul><li>openai大客户按年收费</li><li>4w用户3.53m token</li><li>50%利润可以cover</li></ul></li><li><p>赚钱模式</p><ul><li>不要异想天开</li><li>概率非常非常小</li><li>不要在商业模式上创新</li><li>saas就是订阅，不用找新的</li></ul></li><li><p>apple intellicence （尖锐）</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 太小了，不用去臆想和大厂竞争（不是对手）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 马化腾：等你长大了就把你弄死</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 创业：下3-6个月活下来</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 苹果怎么起来的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - 主板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - iPod （R1）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 微软怎么起来的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - 改软件卖ibm</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>为什么要去做 AI 硬件</p><ul><li>VR怎么交互</li></ul></li><li><p>创业的动力（不用高大上、不用理想化、生活方式的选择、死与活的斗争、大部人觉得自己是错的，很有可能自己确实是错的，证明自己是对的）</p><ul><li>社交网络<ul><li>关了</li></ul></li><li>普通工薪家庭<ul><li>30岁之前买一台自己的兰博基尼（26）</li></ul></li><li>理想主义的泡沫</li><li>【生活方式的选择】</li><li>最重要的特质：耐得住寂寞</li><li>争一口气、改变世界，做过后才理解</li><li>达摩面壁九年</li><li>【十年前没有人关注Elon Musk】</li><li>很长时间 没有生活的balance</li></ul></li><li><p>最艰难的时刻是怎么过来的</p><ul><li>解决不了头几个员工怎么洗澡的问题（没有热水澡）</li><li>评分最低的健身房（150万、5个健身卡）</li></ul></li><li><p>下一代产品是什么</p><ul><li>可能会正面竞争</li></ul></li><li><p>√ 摊薄利润？永久价格</p></li><li><p>UI 始终存在:</p><ul><li>agent 专用 api 的可能</li><li>-- neuro-symbolic research --&gt; </li></ul></li><li><p>GAI native相关</p><ul><li>device UI: app development</li><li>remote UI: app automation</li></ul></li><li><p>目前很少有公司做 action</p></li><li><p>√ 端侧模型的考虑</p><ul><li>目前还不成熟</li></ul></li><li><p>√ 端云协同</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 是未来的方向</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>滚轮敏感度</p><ul><li>iPod早期</li><li>屏幕（10个button）</li></ul></li><li><p>NFT创业</p><ul><li>暴雷</li><li>一定会有人酸、黑</li><li>很自豪、很失败</li><li>cyber-manufacture </li><li>【创业者会遇到各种问题，创业者的压力】</li><li>狗狗币（被坑了很惨）、sam的币</li></ul></li><li><p>？teach pot</p><ul><li>导流到对方平台，用户自己去登录</li><li>【跷跷板，前期通过人，后期通过商业合作】spotify 反过来会愿意与自己合作</li></ul></li><li><p>创业者自己做硬件</p><ul><li>【硬件的老大一定要找对】</li><li>老大一定要懂硬件 深圳</li><li>刘德：小米的生态供应链 十年经验</li></ul></li><li><p>相对human的AI Pin的优势（250m$，400人，招的人不太对）</p><ul><li>【去风险】，而非增加风险</li><li>别在胸上，新的消费习惯</li><li>打包价格更高</li><li>subscription 一定是有粘性才去收</li><li>团队背景：Native AI &gt; 工业设计</li></ul></li><li><p>iPod 之父</p><ul><li>耳机变成白的（+5块钱）</li><li>硬件的小的设计</li></ul></li><li><p>AI眼镜</p><ul><li>长成眼镜框的样子</li><li>世界就只有两类人，一类戴眼镜，一类不戴眼镜</li><li>google glass<ul><li>前一百号</li><li>15分钟就没电了</li></ul></li><li>七龙珠 单片玻璃挂耳朵上</li></ul></li><li><p>人才选择</p><ul><li>17 &gt; 400+</li><li>经验是有帮助的，但开放的思考是很重要的</li><li>芬达（也是橘色的）<ul><li>【对历史文化又有深的理解和认识】</li></ul></li></ul></li><li><p>每天3-4h看youtube，涉猎</p></li><li></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="question">question<a class="hash-link" href="#question" title="标题的直接链接">​</a></h2><p>你好 jessy，我是在RPA行业的创业者</p><p>我知道 R1 的内核目前使用的是一个 driver 去爬一些特定的 app，未来是否会（横向拓展）做成类似 zapier、影刀的更通用的系统呢？</p><p>技术哲学：</p><ul><li>UI --&gt; 人眼</li><li>早期 RPA 效率更高</li><li>后期 类似 FSD  的 neuro-symbolic 更好</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="feedback">feedback<a class="hash-link" href="#feedback" title="标题的直接链接">​</a></h2><ul><li>feedback<ul><li>我们的微信是否也可以做 rpa 模拟呢<ul><li>原因是自然语言的效果不可控，rpa模拟更generic一些</li></ul></li><li>早发售，接受被骂，但多拿到数据（迭代、开发的要求有变化）</li></ul></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[2419-信仰一跃]]></title>
            <link>https://markshawn2020.github.io/blog/2024/05/01/2419-信仰一跃</link>
            <guid>/2024/05/01/2419-信仰一跃</guid>
            <pubDate>Wed, 01 May 2024 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[飞脑]]></title>
            <link>https://markshawn2020.github.io/blog/2024/04/30/飞脑</link>
            <guid>/2024/04/30/飞脑</guid>
            <pubDate>Tue, 30 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[image.png]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430232851.png" alt="image.png" class="img_vXGZ"></p><p>你有没有这样的困惑：从清晨的第一条推送到夜晚最后一次滑动屏幕，微信消息、待办事务、电子邮件、社媒资讯……大量的信息碎片日复一日如潮水般涌入，<strong>人被异化为信息处理的机器</strong>，令人力不从心。</p><p>为了解决这个问题，CS魔法社耗时数月开发了飞脑，一款结合了LLM（大语言模型）、RPA（机器人流程自动化）的<strong>跨平台智能个人助理</strong>。我们的终极目标是基于Bot和AI统一标准化信息流，从而打破信息孤岛，实现个人社交与信息流的高效管理。</p><p>飞脑是基于社交平台的一种企业级&nbsp;bot&nbsp;服务，在你的微信、飞书、钉钉、discord等平台内，只要你<strong>拥有一个具备飞脑能力的好友</strong>，你即可以与<strong>它或者它所在的群</strong>进行对话，解锁大模型时代的各种有用且有趣的AI服务，例如<strong>自动摘要、交互检索、虚拟陪伴、任务管理</strong>等。</p><p>下面让我们来郑重介绍一下飞脑（搬好小板凳）。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233003.png" alt="image.png" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="01一分钟掌握超简单的飞脑使用指南">01&nbsp;一分钟掌握超简单的飞脑使用指南<a class="hash-link" href="#01一分钟掌握超简单的飞脑使用指南" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-自动摘要">⚡ <strong>自动摘要</strong><a class="hash-link" href="#-自动摘要" title="标题的直接链接">​</a></h3><p>飞脑可以理解分享到平台内的任意信息，并将其标准化为一张精美的卡片，自动同步到飞脑社区与您的个人中心。</p><p>示例：解析一篇微信文章</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233100.png" alt="示例：解析一篇微信文章" class="img_vXGZ"></p><p>示例：解析一条B站长视频</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233112.png" alt="示例：解析一条B站长视频" class="img_vXGZ"></p><p>还有更多摘要能力等你解锁，例如：</p><ul><li>自动解析微信视频</li><li>自动解析微信聊天记录合集</li><li>自动解析X链接</li><li>……</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-交互检索">🔎 <strong>交互检索</strong><a class="hash-link" href="#-交互检索" title="标题的直接链接">​</a></h3><p>在交互检索功能开启的条件下，你可以直接获得基于大语言模型能力的回答。</p><p>示例：与飞脑 bot 对话（群内需要 @ 或者以 ？开头）</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430234043.png" alt="image.png" class="img_vXGZ"></p><p>我们在传统的&nbsp;RAG&nbsp;技术上，结合社交生态，做了很多的优化，只为大家提供最好的检索体验。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="--社群运营">👨‍👩‍👧‍👦  <strong>社群运营</strong><a class="hash-link" href="#--社群运营" title="标题的直接链接">​</a></h3><p>基于RPA与LLM，我们还可以解锁非常多有用的社群能力。</p><p>示例：每天对历史聊天记录进行总结</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233322.png" alt="image.png" class="img_vXGZ"></p><p>示例：每当N个人加入群聊时，自动发送一次群通知</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233336.png" alt="image.png" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-私人助理">🧘 <strong>私人助理</strong><a class="hash-link" href="#-私人助理" title="标题的直接链接">​</a></h3><p>飞脑可以成为大家的日常小助理，例如提醒你”该吃药啦/快去追剧/5分钟后要从家里出发才能赶上火车哟/……“。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/20240430233617.png" alt="image.png" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="02欢迎加入飞脑的多样化共创计划">02&nbsp;欢迎加入飞脑的多样化共创计划<a class="hash-link" href="#02欢迎加入飞脑的多样化共创计划" title="标题的直接链接">​</a></h2><p>目前飞脑已经内部迭代了两百多个小版本，并持续高速推进中，如果您对飞脑感兴趣，欢迎以体验者、社区运营kol、开发者等角色参与飞脑的共创计划。</p><ul><li><p><strong>体验共创</strong> 我们将长期提供多个飞脑体验群，感兴趣的朋友可以留言加入，我们会高度重视大家在体验过程中遇到的问题。</p></li><li><p>&nbsp;<strong>私有化共创</strong> 我们将开放10个私有化部署名额，确保你的隐私数据安全，知识密集型工作者、社区运营kol、小微企业主等可后台咨询。</p></li><li><p><strong>投资共创</strong> 由于飞脑是一个精简的独立开发团队，我们也将同步开放一定比例的持股计划，如果您有兴趣以个人/企业身份对飞脑项目进行投资，欢迎后台咨询。</p></li><li><p><strong>开源共创</strong> 我们的代码将逐步开源，并开放基于auto-agent机制的插件定制能力、开放大模型中间件（例如coze、dify等）的对接能力，开发者们可以留言申请加入飞脑技术群，共创开发者们可以获得尊贵的身份标识和一定价值的credit。</p></li></ul><p>以上是我们<strong>CS魔法社的飞脑</strong>与大家的第一次正式会面，期待能切实帮到大家<strong>更好地管理日常信息流</strong>，我们下期再见👋🏻！</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[微信聊天记录备份指南]]></title>
            <link>https://markshawn2020.github.io/blog/discarded/微信聊天记录备份指南</link>
            <guid>/discarded/微信聊天记录备份指南</guid>
            <pubDate>Mon, 26 Feb 2024 13:02:26 GMT</pubDate>
            <description><![CDATA[本篇主要全过程展示与分析微信生态内聊天记录备份的办法与不足之处，针对各项不足之处提供适配的解决方案，并希望提供一份成本较为低廉的最佳实践。]]></description>
            <content:encoded><![CDATA[<blockquote><p>本篇主要全过程展示与分析微信生态内聊天记录备份的办法与不足之处，针对各项不足之处提供适配的解决方案，并希望提供一份成本较为低廉的最佳实践。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景需求与痛点">背景、需求与痛点<a class="hash-link" href="#背景需求与痛点" title="标题的直接链接">​</a></h2><p>微信早已成为我们国民的通用聊天软件，我们每天的聊天内容都在这个平台上不断沉淀，致使手机存储空间日趋紧张，如果您恰好是如下用户画像，则这份指南很适合您：</p><ul><li>平常生活与工作重度依赖于微信</li><li>对历史聊天记录非常在意（不愿意选择直接清空的暴力办法）</li><li>不愿意或不可以采购更大内存的手机、电脑等</li><li>但有额外的电脑存储空间、外接硬盘等</li></ul><p>首先，我们必须指出，生活中的约束处处存在，微信聊天记录备份也符合在资源约束条件下追求效率最大化的特征。</p><p>其中，「资源的约束条件」主要为硬件（手机、电脑等）的存储空间限制，「效率」主要是管理与使用聊天记录的便携程度。</p><p>基于约束条件，我们不可以假设我们的硬盘是无限的，从而对微信聊天记录总体积的日益增长视而不见。</p><p>而基于效率，我们不得不考虑：</p><ul><li>一旦面临存储空间紧张，如果我们只是简单地把聊天记录删除，则日后一旦需要，将无法再次获得</li><li>一旦面临存储空间紧张，如果我们只是一味地把聊天记录备份到其他地方，则日后一旦需要，重新恢复的时间成本较高</li></ul><p>因此，我们应该设计一种：分级的、分型的、分层的聊天备份体系：</p><ul><li>所谓分级：由于微信聊天记录是以每个聊天对象作为一个单元，因此我们可以对聊天对象进行重要性分级，对上次聊天较为久远的、不太重要的、已存档的聊天对象优先进行备份并转移，其他的则暂时保留</li><li>所谓分型：由于微信聊天记录分文本和非文本（富媒体形式，包含图片、语音、视频、链接等）两种，期中文本的体积是最小、语义信息最丰富、构建上下文最重要的形式载体（微信也默认对文本和非文本聊天内容做了区分），因此，我们也可以优先转移非文本形式的聊天图片</li><li>所谓分层：由于微信的聊天记录默认是支持跨端的（手机、电脑、平板等可同步），但每个端的可使用容量、使用场景与频率都面临不同的约束，因此我们可以把各端组合成多个层级，并采用不同的清理策略：</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="暴力方案全量备份">暴力方案：全量备份<a class="hash-link" href="#暴力方案全量备份" title="标题的直接链接">​</a></h2><p>全量备份是非常直观、符合直觉</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[觉醒的硅基]]></title>
            <link>https://markshawn2020.github.io/blog/2024/01/14/觉醒的硅基</link>
            <guid>/2024/01/14/觉醒的硅基</guid>
            <pubDate>Sun, 14 Jan 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[by 南川，独立开发者、连续创业者，20240114，北京]]></description>
            <content:encoded><![CDATA[<blockquote><p>by 南川，独立开发者、连续创业者，20240114，北京</p><p>for 爱范儿</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="一碳基世界">一、碳基世界<a class="hash-link" href="#一碳基世界" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-碳基的焦虑">1. 碳基的焦虑<a class="hash-link" href="#1-碳基的焦虑" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094125.png" alt="Pasted image 20240114094125" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094457.png" alt="Pasted image 20240114094457" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-碳基与硅基的桥梁">2. 碳基与硅基的桥梁<a class="hash-link" href="#2-碳基与硅基的桥梁" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094334.png" alt="Pasted image 20240114094334" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114101117.png" alt="Pasted image 20240114101117" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="二硅基世界">二、硅基世界<a class="hash-link" href="#二硅基世界" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-碳基的伟大步伐硅基之上">3. 碳基的伟大步伐：硅基之上<a class="hash-link" href="#3-碳基的伟大步伐硅基之上" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114101532.png" alt="Pasted image 20240114101532" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094634.png" alt="Pasted image 20240114094634" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="4-ai世界的一超多强">4. AI世界的一超多强<a class="hash-link" href="#4-ai世界的一超多强" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094244.png" alt="Pasted image 20240114094244" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094157.png" alt="Pasted image 20240114094157" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114095937.png" alt="Pasted image 20240114095937" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="三模式变更">三、模式变更<a class="hash-link" href="#三模式变更" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="5-人类分工的模式变更">5. 人类分工的模式变更<a class="hash-link" href="#5-人类分工的模式变更" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094741.png" alt="Pasted image 20240114094741" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094747.png" alt="Pasted image 20240114094747" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="6-创业公司的模式变革">6. 创业公司的模式变革<a class="hash-link" href="#6-创业公司的模式变革" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094818.png" alt="Pasted image 20240114094818" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="7-传统行业的模式变革">7. 传统行业的模式变革<a class="hash-link" href="#7-传统行业的模式变革" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094726.png" alt="Pasted image 20240114094726" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="8-应用开发的模式变革">8. 应用开发的模式变革<a class="hash-link" href="#8-应用开发的模式变革" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114095236.png" alt="Pasted image 20240114095236" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114094929.png" alt="Pasted image 20240114094929" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="9--大语言模型的幻觉与酒精">9.  大语言模型的幻觉与酒精<a class="hash-link" href="#9--大语言模型的幻觉与酒精" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100033.png" alt="Pasted image 20240114100033" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100128.png" alt="Pasted image 20240114100128" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="四未来世界">四、未来世界<a class="hash-link" href="#四未来世界" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="10-人类创造力的未来">10. 人类创造力的未来<a class="hash-link" href="#10-人类创造力的未来" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114095833.png" alt="Pasted image 20240114095833" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114095846.png" alt="Pasted image 20240114095846" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="11-数字游民的崛起">11. 数字游民的崛起<a class="hash-link" href="#11-数字游民的崛起" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100535.png" alt="Pasted image 20240114100535" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100554.png" alt="Pasted image 20240114100554" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100800.png" alt="Pasted image 20240114100800" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="12-硅基的意识">12. 硅基的意识<a class="hash-link" href="#12-硅基的意识" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114095749.png" alt="Pasted image 20240114095749" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100929.png" alt="Pasted image 20240114100929" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020240114100912.png" alt="Pasted image 20240114100912" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="13-碳基的终极意义">13. 碳基的终极意义<a class="hash-link" href="#13-碳基的终极意义" title="标题的直接链接">​</a></h3><blockquote><p>Life has to be more than simply solving one sad problem after another, there have to be reasons when you WAKE UP in the morning and you're happy to be alive.  </p><p>Say:
why you are excited about the future?</p><p>what gives you hope?  </p><p>I think the idea of us being a space faring CIVILIZATION and being out there among the stars is incredibly inspiring, and there need to be such things in the world.  </p><p>-- Elon Musk</p></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[03-27-digital-travel] 南川数字游民之旅01：]]></title>
            <link>https://markshawn2020.github.io/blog/2023/12/31/index</link>
            <guid>/2023/12/31/index</guid>
            <pubDate>Sun, 31 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[一只箱，一个包，就这样，我踏上了年少时就憧憬的环游世界（之第一季环游中国，之第二期从北京到深圳）之旅。]]></description>
            <content:encoded><![CDATA[<h1>[04-26-seaside]<!-- --> 何故流浪</h1><p>一只箱，一个包，就这样，我踏上了年少时就憧憬的环游世界（之第一季环游中国，之第二期从北京到深圳）之旅。</p><blockquote><p>之所以是第二期，是因为21年的时候，我已经从成都骑行到了拉萨，以及珠峰大本营，可定义为第一期。</p></blockquote><p>这趟旅行，起点于3月12日的北京，直到4月28日正式抵达深圳，目前是5月7日，即将两月整，期间途径了湖北（武汉、咸宁）、湖南（长沙）、广西（广州、柳州、桂林）、广东（广州、东莞、惠州、深圳）共计四省十市。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="沉浸刷题之旅">沉浸刷题之旅<a class="hash-link" href="#沉浸刷题之旅" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="数字游民之旅">数字游民之旅<a class="hash-link" href="#数字游民之旅" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="cs魔法社之旅">CS魔法社之旅<a class="hash-link" href="#cs魔法社之旅" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="认识自己之旅">认识自己之旅<a class="hash-link" href="#认识自己之旅" title="标题的直接链接">​</a></h2><h1>[06-12-用力活下去]</h1>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川骑行川藏线（下）]]></title>
            <link>https://markshawn2020.github.io/blog/2023/12/27/南川骑行川藏线（下）</link>
            <guid>/2023/12/27/南川骑行川藏线（下）</guid>
            <pubDate>Wed, 27 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[你翻越的只是你心中的那座山。]]></description>
            <content:encoded><![CDATA[<blockquote><p>你翻越的只是你心中的那座山。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概要">概要<a class="hash-link" href="#概要" title="标题的直接链接">​</a></h2><p>本文是南川于2021年7月末起骑行川藏线的最后一篇朋友圈笔记合集，主要记录从拉萨到珠峰大本营共10天左右的所行所感，期间为了见羊湖一眼差点命悬5030米的岗巴拉山口、学习日喀则人转扎什伦布寺、偶遇驴友一起攀爬珠峰大本营、无比幸运地亲见日照珠峰……</p><p>两年后的今天，我已经又成长了许多，并且毫无再使用自行车这样的工具驰骋天地的想法与冲动，因为那已经不再构成挑战，真实的生活远比山峰更陡峭更曲折。路渐模糊，我渐清晰，大概也不枉此番西取真经之旅了。诸君共勉。</p><ul><li>第一篇在：<a href="http://mp.weixin.qq.com/s?__biz=Mzg2OTg5NDg3Mg==&amp;mid=2247483942&amp;idx=1&amp;sn=9253a09fc0b947a1b1cf7b3569f5add7&amp;chksm=ce975d91f9e0d48773321f9867c9f97d08320dfcc0d8b0519ff22129aa4dfda1c2068213f5fd#rd" target="_blank" rel="noopener noreferrer">南川骑行川藏线（上）</a></li><li>第二篇在：<a href="http://mp.weixin.qq.com/s?__biz=Mzg2OTg5NDg3Mg==&amp;mid=2247484177&amp;idx=1&amp;sn=701eef0fb8a918d9a3b098b3fd7320e3&amp;chksm=ce975ca6f9e0d5b0bcb7895008febadc1f5495d19fd65271f4334f72f53168abf79254460eb6#rd" target="_blank" rel="noopener noreferrer">南川骑行川藏线（中）</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="日记">日记<a class="hash-link" href="#日记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="39-拉萨到羊卓雍错这辈子最痛苦的一夜">39 拉萨到羊卓雍错：这辈子最痛苦的一夜<a class="hash-link" href="#39-拉萨到羊卓雍错这辈子最痛苦的一夜" title="标题的直接链接">​</a></h3><p>拉萨到羊卓雍错（羊湖，西藏三大圣湖之一），里程110，海拔3500到5000，早上10点到晚上10。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155105.png" alt="Pasted image 20231221155105" class="img_vXGZ"></p><p>这条路是队友推荐的，中途绕道国道349，之后会再回到318。这一段呢，就又只剩我一个人骑了，一个队友回家上学了，一个队友在拉萨附近直接工作了，还有一个放弃骑行了……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155051.png" alt="Pasted image 20231221155051" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155503.png" alt="Pasted image 20231221155503" class="img_vXGZ"></p><p>晚7点多离山顶还有十公里左右时，一辆藏A牌皮卡想搭我，是一位很年轻的小伙子，副驾是一位较为年老的妇女，可能是他妈妈，虽然我路上一直在想有车搭我就好了，毕竟已经骑了100公里确实很累了而且天就要黑了，但真地有车搭我时我却下意识地拒绝了……诶，这就是我吧……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155524.png" alt="Pasted image 20231221155524" class="img_vXGZ"></p><p>由于淋雨爬山，一直爬到十点，也算是幸运？刚到目的地手电就没电了，要是中途没电……我可能就埋葬在深山国道的黑暗里了……</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">群山都睡了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">而我仍在攀爬</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">流浪于天地之间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我是我自己的主</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160037.png" alt="Pasted image 20231221160037" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155551.png" alt="Pasted image 20231221155551" class="img_vXGZ"></p><p>当然，其实也没那么幸运，队友把他的帐篷睡袋都给了我，于是我尝试第一次搭帐篷，5000米的海拔，搭在室外，还衣服都是湿的，没有人知道我是怎么过来的……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155602.png" alt="Pasted image 20231221155602" class="img_vXGZ"></p><p>当晚每个小时都要醒一次，手是靠贴在身上取暖的，脚是一片冰冷拔凉，夜里卡痰呕吐了一次，全身一直发抖，而且我全天都吃的矿泉水配压缩饼干和面包，没有摄入一点热量……</p><p>这不禁让我想起十几年前不知道为啥有一天我睡在了河边，用稻草裹住全身，夜里三点冻醒又骑车到游乐园坐在凳子上发呆……此情此景，何其相似！</p><p><em>注：这一夜绝对是这辈子最痛苦的一夜，比新冠还要难熬，新冠那一次顶多排第二（靠看梅西比赛度过了夜晚）。因为知道新冠绝对死不了，但是羊湖这次露营，我是真不知道自己活不活得到第二天……</em></p><p>第二天早上，7点痛苦地挣扎起床，一直在广场徘徊，等太阳出来顺便拍拍延时，可是垭口的太阳如此不争气，直到十点才慢慢感到温暖，这三小时，我就像土拨鼠一样几乎一言不发窜来窜去，因为又冷又饿，并且回家的愿望逐渐强烈。</p><p>后来我第一次打开了随身携带的国旗，想着我未能到终点，怎么能轻言放弃，大雾、爬坡、潮湿、寒冷……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155615.png" alt="Pasted image 20231221155615" class="img_vXGZ"></p><p>办法总比困难多，咬咬牙，我便冲出了这美丽、魔幻也带给我梦魇的羊湖，下山吃一顿热饭继续出发。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155537.png" alt="Pasted image 20231221155537" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221155622.png" alt="Pasted image 20231221155622" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="40-羊湖到仁布县">40 羊湖到仁布县<a class="hash-link" href="#40-羊湖到仁布县" title="标题的直接链接">​</a></h3><p>羊湖到仁布县，里程100（实际可能120，因为走错路了），海拔5000到4000，中午11点到晚上11点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160207.png" alt="Pasted image 20231221160207" class="img_vXGZ"></p><p>今天好像运气特别好，先是富婆们想送水给我。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160254.png" alt="Pasted image 20231221160254" class="img_vXGZ"></p><p>接着午饭时帅哥们送我一桶蘑菇汤。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160346.png" alt="Pasted image 20231221160346" class="img_vXGZ"></p><p>傍晚翻山（没错就是这个估计比丙察察还难走的山）时一辆藏A牌帅哥美女想载我一程，说带我过这一段危险路段，我竟然回到还好啊挺刺激的，结果三分钟后就打脸了，碰到了推都推不上去的坡……
此处假装@高德地图，是谁给你勇气给我推257省道的？骑行一个月来最恐怖的路段非你莫属，全是石子水坑和泥浆，幸好只有十几公里且偏下坡，我之前说过这辈子都不会玩速降的，结果翻山翻成了速降……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160412.png" alt="Pasted image 20231221160412" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160416.png" alt="Pasted image 20231221160416" class="img_vXGZ">
【视频：所以这也能是省道】</p><p>话说，今天天气真地太好了（虽然在翻山时碰到了小冰雹，不过无伤大雅），你看这满天星（好吧我的辣鸡手机拍不出来），竟然连银河都能看的一清二楚，真想路上好好欣赏一番，可惜我要赶夜路……今天夜路骑了40公里，手电再次一到县城就鞠躬尽瘁……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160435.png" alt="Pasted image 20231221160435" class="img_vXGZ"></p><p>最后，翻石子路的山那段真地很恐怖，幸好天黑前翻完了，不然我又要GG了，这两天真地是每天都在生死间徘徊，幸运的是，最终我们都能战胜一切困难（哦不，昨晚的感冒还没好……）
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221160445.png" alt="Pasted image 20231221160445" class="img_vXGZ"></p><p>当晚发誓：「下次我再也不拒绝搭车了！数次经历告诉我，打脸不要太快！」。（不过最终还是没有再搭过了）。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">《致羊卓雍错》</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你未曾亲见这蓝色羊湖阳光洒下的第一道波澜</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">我亦约忘记你白色内心微风泛起的第一阵涟漪</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">寒冷已使我无处可藏</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">饥饿已使我无法忍耐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">但只要与这湖水相伴</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">烦恼便不再与我相扰</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你看这蓝天白云</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">似永远相依</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也似永远分离</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你看这湖水沙洲</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">似相互滋养</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也似相互伤害</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">到底是人心比宇宙更大</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">不然你那早已远去的身姿为啥染在了我内心的油画</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">不然你那早已消逝的声音为啥撞在了我内心的山谷</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">羊湖啊羊湖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">请讲我的内心冰封在你的湖底</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">请将你的婀娜雕刻在我的眼眸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">请让我们都不再完整</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">从此便也不再残缺</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">二零二一年九月九日，于羊卓雍错湖畔</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>![<!-- -->[d685dbf95e79a601b9cb901f828cdf.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="41-仁布县到日喀则市">41 仁布县到日喀则市<a class="hash-link" href="#41-仁布县到日喀则市" title="标题的直接链接">​</a></h3><p>仁布县到日喀则市，110公里，海拔不变，平缓起伏路，中午11点到晚上8点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161044.png" alt="Pasted image 20231221161044" class="img_vXGZ"></p><p>今天的故事还得从一辆奥迪说起，它在柏油马路上飞速驶过，将一个鹅卵大的石头zi飞，好家伙，这玩意直接撞上我的前刹车片，砰的一声将其打弯，然后再飞出十多米远……以前被zi水被zi泥点子就算了，这次直接来石头，要是往头上飞，我不就躺平了？
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161109.png" alt="Pasted image 20231221161109" class="img_vXGZ"></p><p>骑了一段后拔了耳机才意识到蹭碟的问题，停车蹲下检查了会，判定必须要找车行维修后我扶车缓缓起了身，然后就一阵眩晕袭来，持续五到十秒，这种感觉之前什么时候有过呢？那就是我出发第一天摔车那次，恍惚间这两个月就像一个梦，我意识到手上竟然有一辆车，我正在川藏线路上……醒醒，然后就继续出发了。</p><p>后来路过一个乡村时，有一个温柔的女声喊到“嘿”，我帽檐比较低，左右环顾也没发现人，然后就又听到了一声“Hello”，我这才意识到是左上方的声音，抬头一看，蓝天白云粉墙白瓦下有一绿装女孩倚在窗前，望着窗外，那一幕简直绝美！可惜，我当时都没反应过来，然后抬起手回了一句“hello”。车子即将骑过他们家时，她又喊了一句“慢慢走啊”！这让我不禁想起巴塘朝拜哥哥最后对我说的“弟弟，慢点走啊”！一时间，百感交集。又让我想起了昨晚路上一个穿红衣服的男孩在田埂、河流独立的玩耍。这些藏族乡村的男孩女孩们，他们的命运将会如何走向呢？没有人能回答。</p><p><em>高德上显示那女孩村庄位置叫“雪琼”，真是一个好听的地名。</em></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161147.png" alt="Pasted image 20231221161147" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161150.png" alt="Pasted image 20231221161150" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161155.png" alt="Pasted image 20231221161155" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161206.png" alt="Pasted image 20231221161206" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161212.png" alt="Pasted image 20231221161212" class="img_vXGZ"></p><p>必须单独给这家茶馆（就是门上那串藏文）点个赞
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161327.png" alt="Pasted image 20231221161327" class="img_vXGZ"></p><p>原本是想在出发的路上找家吃的的
结果仁布县城实在太小
一下就出了……
因缘巧合之下来到了这家小茶馆
一碗牛肉面吃完（还很好吃），问多少钱，竟然只要11块
我都做好了25元起步价的准备了……</p><p>一家子其乐融融
孩子四岁了
最后在门口瞻望我远去
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161336.png" alt="Pasted image 20231221161336" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161345.png" alt="Pasted image 20231221161345" class="img_vXGZ"></p><p>乡亲们在田地里辛勤的工作
这让我对这片石子路多了一层尊敬
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161354.png" alt="Pasted image 20231221161354" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221161358.png" alt="Pasted image 20231221161358" class="img_vXGZ">
祝这家子能幸福平安～</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="42-日喀则停留一日">42 日喀则停留一日<a class="hash-link" href="#42-日喀则停留一日" title="标题的直接链接">​</a></h3><p>由于感冒未好以及清晨下雨，在日喀则停留一日。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162245.png" alt="Pasted image 20231221162245" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162304.png" alt="Pasted image 20231221162304" class="img_vXGZ"><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162314.png" alt="Pasted image 20231221162314" class="img_vXGZ"></p><p>中午骑车环了一下城，下午尝试了扎什伦布寺饭馆，藏面6元1碗，甜茶5元一磅（壶），别说还挺好吃，有着兰州拉面的味道。日喀则作为后藏确实条件还是比较艰苦的，路上看到的重庆路啊上海路啊，一般都是对应地方援建的。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162331.png" alt="Pasted image 20231221162331" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162325.png" alt="Pasted image 20231221162325" class="img_vXGZ"></p><p>晚上步行转寺。先是在巷子里遇到一个画家，一幅画要画好几个月，卖一两万呢，旁边就是他老婆开的包子店，真地很令我敬佩！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162346.png" alt="Pasted image 20231221162346" class="img_vXGZ"></p><p>转寺途中遇到两个本地小姐姐和一位65岁老婆婆，就跟着她们一起转，教了我“阿弥陀佛”的藏文发音（六字真言：<strong>嗡嘛呢叭咪吽</strong>（o ma ni bie mie hong）），一路美景实在美不胜收，不禁感叹扎什伦布寺的瑰伟与这座城市的生生不息！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162402.png" alt="Pasted image 20231221162402" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162356.png" alt="Pasted image 20231221162356" class="img_vXGZ"></p><p>回客栈路上被琴声与音乐吸引，就走进了一家丰盛藏餐餐厅，点了杯酸奶，细细欣赏这“拉孜堆谐”舞曲。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162420.png" alt="Pasted image 20231221162420" class="img_vXGZ"></p><p>不知为啥，虽然是很欢快的舞蹈，却听着有一丝悲伤。人间如戏，戏里戏外，我们究竟该何去何从呢？</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="43-日喀则到拉孜">43 日喀则到拉孜<a class="hash-link" href="#43-日喀则到拉孜" title="标题的直接链接">​</a></h3><p>日喀则市到拉孜县，里程160，海拔3800到4500到4000，早上9点到晚上10点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162755.png" alt="Pasted image 20231221162755" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162801.png" alt="Pasted image 20231221162801" class="img_vXGZ"></p><p>今早告别了日喀则两天的室友，他挺有意思的，他以前也骑过川藏线，但看直播的人太多影响心情就换川藏中线骑了，目前徒搭到了日喀则，到日喀则干嘛我也没明白，反正已经在这个客栈长住5个月了……作息挺规律的，但貌似也没找工作，我实在不太懂……是一个笑起来很好看的长头发的大男孩，祝他好运吧～
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162748.png" alt="Pasted image 20231221162748" class="img_vXGZ"></p><p>下午路上碰到好多和我打招呼的老奶奶，第一次是一个人站在路边上，我当时戴着耳机，听到有人吆喝，拿下来之后她又继续吆喝了一声，我回头才发现的她，她向我挥着手。第二位是在右边田地里，她旁边一头牛，还带着两个小娃。等等。真羡慕这些老人们，耋耄之年依旧释放着自己的无限能量，是我学习的榜样！</p><p>晚上一直期待5000公里的纪念台，结果大失所望。首先，老318的5000公里是有像现在新318的4000公里纪念台的，结果新318的5000就一个碑……此外，你们说巧不巧，今天绝大部分时间都没下雨，就4900-5100这两公里下了雨，这老天高数学的好啊！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162904.png" alt="Pasted image 20231221162904" class="img_vXGZ"></p><p>不过，今天一路上最大的感觉，还是风景开始荒凉了，尽管如此，青稞依旧长的旺盛，令我敬服！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162823.png" alt="Pasted image 20231221162823" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162850.png" alt="Pasted image 20231221162850" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162855.png" alt="Pasted image 20231221162855" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221162912.png" alt="Pasted image 20231221162912" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="44-拉孜到加措与战友一起抵达珠峰入口">44 拉孜到加措：与战友一起抵达珠峰入口<a class="hash-link" href="#44-拉孜到加措与战友一起抵达珠峰入口" title="标题的直接链接">​</a></h3><p>拉孜县到加措乡，翻越嘉措拉山，里程60，海拔4000到5200到4500，早上10点到下午8点半。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163020.png" alt="Pasted image 20231221163020" class="img_vXGZ"></p><p>更正之前对米拉山的错误描述，川藏线上最高的山其实是嘉措拉山，这里才是真正离天最近的地方，对面就是巍峨壮观的喜马拉雅山系！第一次挂起了经幡，在经幡上写上家人们的名字，以及我的大名，如果你去找可以很方便地找到我，因为我特意选了一个迎向雪山风速最大的位置～
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163027.png" alt="Pasted image 20231221163027" class="img_vXGZ"></p><p>原本是打算一个人骑珠峰的，没想到爬山中途碰到了之前某个队的两位骑友，他们一个是退役火箭兵（俺南京老乡！），一个是退役武警，并且打算环华。在山口，还偶遇火箭军司令员和政委，简直妙蛙花妙到家了，然后送了我们一箱水……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163050.png" alt="Pasted image 20231221163050" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163159.png" alt="Pasted image 20231221163159" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163041.png" alt="Pasted image 20231221163041" class="img_vXGZ"></p><p>下山还遇到了疯狂的野狗，武警哥直接一个飞身下车，简直帅爆，我也经历了第一次被野狗追，幸好是下坡，那简直害怕极了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163204.png" alt="Pasted image 20231221163204" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163208.png" alt="Pasted image 20231221163208" class="img_vXGZ"></p><p>晚上加措乡景区与藏族朋友友好协商，就在小棚屋里搭帐篷了，这次终于不冷了～
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163227.png" alt="Pasted image 20231221163227" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163239.png" alt="Pasted image 20231221163239" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="46-白坝乡到扎西宗乡">46 白坝乡到扎西宗乡<a class="hash-link" href="#46-白坝乡到扎西宗乡" title="标题的直接链接">​</a></h3><p>白坝乡到扎西宗乡，翻越加乌拉山，经过珠峰一百零八拐，里程60，海拔4200到5100到4100，早上11点到下午9点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163724.png" alt="Pasted image 20231221163724" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163652.png" alt="Pasted image 20231221163652" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163709.png" alt="Pasted image 20231221163709" class="img_vXGZ"></p><p>珠峰一百零八拐虽然坡度不难，可是风实在太大了，直接吹到我接近窒息，不得不加上外套。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163818.png" alt="Pasted image 20231221163818" class="img_vXGZ"></p><p>峰顶碰到了摩旅小胖，一起骑行了一段。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163810.png" alt="Pasted image 20231221163810" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163901.png" alt="Pasted image 20231221163901" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163856.png" alt="Pasted image 20231221163856" class="img_vXGZ"></p><p>到点又碰到了超厉害的骑行小姐姐英子（和我一样大）也感谢英子姐给我们推荐了乡委这个神奇的搭帐篷点，简直无法想象！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163911.png" alt="Pasted image 20231221163911" class="img_vXGZ"></p><p>话说，一百零八拐真是壮阔！可惜加乌拉山顶只看到了洛子峰，珠峰一直被云遮着……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163940.png" alt="Pasted image 20231221163940" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163945.png" alt="Pasted image 20231221163945" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221163714.png" alt="Pasted image 20231221163714" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="47-白坝乡到珠峰大本营">47 白坝乡到珠峰大本营<a class="hash-link" href="#47-白坝乡到珠峰大本营" title="标题的直接链接">​</a></h3><p>白坝乡到珠峰大本营，里程40，海拔4100到5100，中午11点到晚上7点。</p><p>出发时欣赏到了锅庄舞，四个年轻人是县里文工团的，来教老乡们跳舞～（朋友说曾经有幸某个晚上在学校操场偶遇几个藏族同学跳过，动作没这么细节，但是还是觉得好有意思！）
![<!-- -->[8073bf7ca0fbadf7492631e3d33cc2.mp4]<!-- -->]</p><p>可爱的孩子们。
![<!-- -->[4b1fe3e7efae5b8eda900a4311a280.mp4]<!-- -->]</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">一人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">一车</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">两个月</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">三千公里</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">五星红旗飘扬之处</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">八年长梦破晓之期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remember it, forever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">since now, tonight</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164030.png" alt="Pasted image 20231221164030" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164034.png" alt="Pasted image 20231221164034" class="img_vXGZ"></p><p>非常幸运地看到了珠峰探出脑袋（小胖骑摩托比我们早到，但是没有看到，下山后还发现被偷了gopro……）
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164040.png" alt="Pasted image 20231221164040" class="img_vXGZ"></p><p>朋友说大本营对比18年变化不小，以前没有木头铺的路，两个碑是没有的，8848的石头也换了，邮局也变了……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164205.png" alt="Pasted image 20231221164205" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165502.png" alt="Pasted image 20231221165502" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164213.png" alt="Pasted image 20231221164213" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221164217.png" alt="Pasted image 20231221164217" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="48-珠峰大本营到岗嘎镇珠穆朗玛关帝庙">48 珠峰大本营到岗嘎镇珠穆朗玛关帝庙<a class="hash-link" href="#48-珠峰大本营到岗嘎镇珠穆朗玛关帝庙" title="标题的直接链接">​</a></h3><p>珠峰大本营到岗嘎镇珠穆朗玛关帝庙（最后一站），翻越岗噶山，里程100，海拔5100到4100到4900到4300。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165606.png" alt="Pasted image 20231221165606" class="img_vXGZ"></p><p>今天是幸运的一天，早上7点无意间拍到了流星。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165517.png" alt="Pasted image 20231221165517" class="img_vXGZ"></p><p>八点旅游观光的人陆续来拍珠峰。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165525.png" alt="Pasted image 20231221165525" class="img_vXGZ"></p><p>八点多时有一点日照金山，九点时珠峰竟然全部出来了！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165837.png" alt="Pasted image 20231221165837" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165544.png" alt="Pasted image 20231221165544" class="img_vXGZ"></p><p>出来后我冒着生命危险尝试爬山，山坡全是松散的石子，一路拉着经幡铁丝网才爬到经幡顶，这就不得不说骑行的一个最大好处了，那就是完全没有高反，乱跑乱跳爬山等顶多喘喘，不像同宿的观光情侣夜里每个小时都要大口吸氧气直接把队友搞崩溃了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165535.png" alt="Pasted image 20231221165535" class="img_vXGZ"></p><p>中午回扎西宗乡渝合餐馆吃第三顿饭，老板是重庆人，服务和菜品都很不错，推荐！</p><p>下午爬此行第二十座山，晚上7点到达岗嘎镇后我绕城跑了一大圈才终于找到上关帝庙的大路，期间正巧碰到小学放学，直接被二十几个小学生围住，那场面可吓人了，我打算发糖打发他们，结果越发人越多还引起了哄抢。这时候有个较高个人小男孩喊到：叔叔，糖您留着自己吃吧，快走吧！非常感谢这个小男孩解围，我给他一颗糖后，叮嘱他给其他小妹妹也不知道他最后有没有……</p><p>忍着饥饿又爬升一百米后终于到达关帝庙旁，结果出乎意料地摔车了，仿佛冥冥之中皆有注定……我赶紧转为推车。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165642.png" alt="Pasted image 20231221165642" class="img_vXGZ"></p><p>可惜这里的关帝庙听说只在特殊节日开门，所以只能在外仰望它的巍峨壮丽。至于这里为什么要造关帝庙，里面供奉的又是谁，为什么本地人又都不拜，可以百度百度都有故事的。但这都不影响关二爷在我心中的崇高地位。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165647.png" alt="Pasted image 20231221165647" class="img_vXGZ"></p><p>从关帝庙下来时，天已黑，突发奇想走小路下去，结果走进了死路，到了一个鼎附近。于是往回推车，推着推着就在夜幕中看到了一立清军英烈纪念碑，十分慎得慌，因为石梯太陡推不上去……最后在旁边土坡才推上去，然后绕了好久才找到下山原路返回的路……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165637.png" alt="Pasted image 20231221165637" class="img_vXGZ"></p><p>综上，此次来拜关帝，实在坎坷……</p><p>至此，南川的川藏线之旅就彻底完结了，明天开始收官～</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="49-岗嘎镇到定日县">49 岗嘎镇到定日县<a class="hash-link" href="#49-岗嘎镇到定日县" title="标题的直接链接">​</a></h3><p>岗嘎镇到定日县，60公里，中午到晚上8点。</p><p>天气很好，在藏民的牧场旁静静坐下，望着成群的羊有序的归家，两位牧民不紧不慢地在我身边也坐下，示意给我水和馍，我不渴也不饿，掏出两块糖给他们，虽然言语不通，但那一刻我感受到了一种纯粹的温暖。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165932.png" alt="Pasted image 20231221165932" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165910.png" alt="Pasted image 20231221165910" class="img_vXGZ"></p><p>临别望着他们一跛一跛地走向远方，让我生出一种对生命与归宿的无限感伤：
拿什么去回应孩子们殷切的目光，拿什么去回应老人们亲切的微笑，拿什么去回应兄弟们不舍的祝福，拿什么去回应父母们无尽的包容，拿什么去回应我们自己年轻的冲动。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221165901.png" alt="Pasted image 20231221165901" class="img_vXGZ"></p><p>『有一个夜晚我烧毁了所有的记忆，从此我的梦就透明了；有一个早晨我扔掉了所有的昨天，从此我的脚步就轻盈了。』
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194414.png" alt="Pasted image 20231221194414" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="50-最后一日中秋归乡之旅">50 最后一日：中秋归乡之旅<a class="hash-link" href="#50-最后一日中秋归乡之旅" title="标题的直接链接">​</a></h3><p>今天云南火腿鸡店，以及日喀则市之前去过的雨霖铃超市（特意回去试探老板娘还认不认得我）都送了我一块月饼，可惜月亮虽圆，已经不能在中秋节前赶到家了
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194651.png" alt="Pasted image 20231221194651" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194545.png" alt="Pasted image 20231221194545" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194534.png" alt="Pasted image 20231221194534" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194517.png" alt="Pasted image 20231221194517" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194554.png" alt="Pasted image 20231221194554" class="img_vXGZ"></p><p>过去的几年一直在外奔波学习或是工作，都不觉得节日什么的有什么重要的，直到今年一直旅途在外，才越发觉得节日的重要性，真地有想快点回到家……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194817.png" alt="Pasted image 20231221194817" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194820.png" alt="Pasted image 20231221194820" class="img_vXGZ"></p><p>第一次坐青藏铁路：
圆月硕大无比
光辉洒染江河
雪山静默无声
星夜灯火无眠
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194832.png" alt="Pasted image 20231221194832" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194835.png" alt="Pasted image 20231221194835" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194838.png" alt="Pasted image 20231221194838" class="img_vXGZ"></p><p>路过繁华的大唐不夜城，也路过最近爆红的河南郑州，街上的时尚服装慢慢多了起来，家乡到了。一切陌生而又熟悉的味道慢慢袭来，我们需要重新定义生活。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221194924.png" alt="Pasted image 20231221194924" class="img_vXGZ"></p><hr><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">马男终于老了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">戴安终于胖了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">陶德终于长大了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">花生酱终于学会了单身</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">凯洛琳终于找到了犹大</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">莎拉琳恩与碧翠丝终于华丽演出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">巴特斯科奇终于明白了生命的意义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">当一切都开始谢幕</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你，还好吗</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">你，会好的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对不起</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">谢谢你</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">希望偶尔你也抬头看看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">月亮有时候</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">真地很美</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221203136.png" alt="Pasted image 20231221203136" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221203143.png" alt="Pasted image 20231221203143" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231221203202.png" alt="Pasted image 20231221203202" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[十年 —— 一位自学者、技术工作者、理想主义者的独白]]></title>
            <link>https://markshawn2020.github.io/blog/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白</link>
            <guid>/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白</guid>
            <pubDate>Tue, 19 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[image-20230928232257179]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928232257179.png" alt="image-20230928232257179" class="img_vXGZ"></p><p>十八岁那年，我只身前往一个远在千里的地方求学，那是我第一次出远门。那是我在翻完整本高考志愿填报后十秒钟之内作出的决定：我想做乔布斯、比尔盖茨那样的人物。后来我才知道，人这辈子能成什么样的人，能做多大的事，早已埋好一处处伏笔。可是我十八岁那年没能预见这一点。</p><p>八年后，我再次踏上那块土地，用十分钟凝视了它可能最后一眼，继而开始了三千公里生死未卜的川藏线挑战。又两年后，从北京，到武汉，咸宁，长沙，南宁，柳州，桂林，广州，东莞，惠州，深圳，香港，再到杭州，北京，约莫又是两趟三千公里，完成了一次数字游民挑战，并过完了第二十八个生日。一生中我们还会有多少个三千公里呢？也许 20 次，然而这些都看似无限。</p><p>以上就是我简短故事的一张切面，而今天想分享的是，我是谁，以及我近十年的一点微小感悟，如若对你有所启发，那将是再好不过的事了。</p><hr><p>你好，我是南川，一位自学者、技术工作者、理想主义者。这里是我的随想站：南川笔记2023。</p><p>我的自学，最早可追溯到童年时期，那时我留守在外祖父家，时常能记起的是卧在沙发上捧读一本自然百科全书之类，不觉昏昏入睡，东方煞白。</p><p>小学的数学考试规定是两节课，但我们一般半节课就做完，然后径直出教室去打乒乓球，疯玩一节多额外的体育课。当时我的数学老师是一位略微发福、眼睛发亮、略带痞气的老师，曾两手各执一位调皮捣蛋而又数学很差的同学后脑，然后让他们像保龄球一般撞在一起。在这幅粗犷的画面下，唯一温柔的是他对数学成绩优良的孩子的目光。在这样的老师的关怀下，我甚至还于五年级时替一位六年级的学生去参加数学竞赛，不过遗憾并没有拿特别高的奖项。但在一场数学竞赛培训上我迷上了最喜欢的两组数字：3377和3388，他们分别可以以一种巧妙且对称的方式计算出24点（我一般会把这样的题出给非理工专业的女孩子们）。</p><p>小学的英语老师是一位年轻女性，在她的指导下，我也获得了某英语词汇比赛的好成绩。她似乎对我有着很高的期望，有一次问我能不能不看发音就把单词读出来，我当时苦笑。大家别笑，确实是这样的， 在现在大家觉得很自然的一些知识、技巧、常识，在很多地方却并不一定是共识，教育的门槛一直存在，这也是为啥 2023 年我面对 AGI，能感到如此强烈的共鸣。</p><p>初一时，我意外地自己解出了一元二次方程的韦达表示形式，那时候我很兴奋，仿佛发现了什么很不得了的定理。有一天中午去食堂路上，路过宿舍楼时碰到了数学教导主任，一个很有魅力、高瘦、略有鼻炎、这个学校数学最厉害的男人。我顺手拿出演算一元二次方程的草稿，他简单看了看，表达了肯定，但同时也补充道这个之后会学的，便走开。多年以后，每当我回想起那个下午，都不免既有些激动、又有些失落。</p><p>那三年，由于我是全校唯一一个从初一就开始寄宿的学生，印象中常常在傍晚的篮球场一个人抱着篮球瞎玩，以及在某个宁静的夜晚偷偷溜入三楼的多媒体教室，拉上窗帘，紧张地启动了对那个时候的我来说，无比神秘的投影。许是窗帘缝透着微光，便被一向严厉的教导主任抓到了个正着，我心想这下一定死定了，但他似乎也没有批评我什么，我们便关了投影各自离去。</p><p>初中时对我最好的是语文老师，在某个冬日的早晨，他把我喊出教室，在北风呼啸的走廊上，他握住我瘦弱的手，一字一句与我畅聊我的家庭与过往，旋即又拿出一本厚重的书，让我接下来仔细阅读，末了再还于他。然而最终我还是原封不动地归还了那本书，毕竟那个年纪的我哪知道那本书里「王侯将相宁有种乎」几字沉重的分量。我的初中语文老师，同时也是一名风趣阳光的运动健将，打的一手好篮球，印象中勾手投特别厉害（巧的是，几年后我在高中打过唯一一次与比赛性质的篮球，碰到了唯一一次控球机会，随手一勾，竟然中了，引起了他们的重点防范）。</p><p>高中时，由于我优异的数学与不错的总分，我顺利地被命运安排进入了一中，而小学时因为竞赛认识的一对双胞胎姐妹，姐姐进入了二中，妹妹进入了一中。那一刻我才知道我们无时无刻不被社会审视与选择着，我们每个人的命运是不同的，就像一棵硕大黑暗的森林，在社会的漩涡中，我们被裹挟着、我们被推攘着、我们被命令着，前进着。这也许是后来我给自己取名为「川」的根源：子在川上曰，逝者如斯夫，不舍昼夜。在无尽的时间空间内，我们人类存在的唯一意义，便是如川般流动，我们来不及相见，我们也来不及告别，我们来不及准备，我们也来不及真正流进另一条河川。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928133004942.png" alt="image-20230928133004942" class="img_vXGZ"></p><p>高中的数学生活相对更丰富一些，那个时候每当老师在黑板上讲授一道题时，我往往都会去想第二种解法，大部分是基于数形结合的。尽管对大多数人来说，高中数学的压力相对较大，但我依旧是几乎不用怎么学的状态，印象中也是全校唯一一个数学分数能在全校前三的普通班学生。高二的时候去扬州参加为期一周的数学竞赛培训，面对跑马灯似的数论、平面几何、代数和组合，我这样野路子抱着我哥多年前浙大数竞教材自学的人感受到了前所未有的压力，直到大概第五六天晚自习的时候扬州发生了地震，很多同学吓得把被子抱出来睡在学校里的长椅上，而我则默默地在通宵自习室肝了一晚，这才似乎摸到了数论的门，也因此，最后四道大题解出了其中两道半，收获了全校唯二的江苏省一等奖。</p><p>那个时候，信息学还没有足够的热度，因此我接触更多的便是数理化。高中的化学老师兼班主任是一名特级教师（外表酷似武林外传的燕小六），在他的教授下，我对化学尤其是有机化学的兴趣浓度剧增，以至于某个暑假我在家耐心地把浙大化学竞赛教材全部自学完成，尤其对里面的光旋印象深刻。但很可惜的是，也许是冥冥中的安排吧，不知我从哪得到的数学和化学复试时间是冲突的错误信息，于是忍痛放弃了化学复赛。又由于觉得精力可能不够，放弃了物理复赛。最后只得了数学省一和物化省三的勉强成绩，不够资格参加清华的自主招生，又在南大的数学基地班自主招生中被英语阅读竟然有六个选项吓到以及一些其他原因最后落败。随后参加高考，在填报志愿时忽然觉得我想成为乔布斯、比尔盖茨那样的人物，因此选了一所离家较远的工科院校电子科技大学。</p><p>在电大的日子，是短暂、自由、无畏而又迷茫的。那个时候，接触了滑板，每天都是踩着滑板在学校里穿梭。那个时候，我的微积分老师叫刘碧森，是一名虔诚的基督徒与布道者，语速飞快，经常课讲到一半就会提到「同学们要找到生命的答案」！（我盲猜刘老师讲泰勒公式一定能扯到生命的答案！）而我则偏好坐在人群当中，戴着帽子趴着睡觉。但刘老师总是能在百人当中一把把我喊起，叫我回答问题，之后带我做礼拜。但那个时候的我又咋能参透甚至意识到，人，人作为人，需要一个「生命的答案」此种抽象呢。</p><p>再后来，在另一位年轻女教师的线性代数课程上，许是为了和老师套个近乎，下课，我走向讲台，问她矩阵乘法相关的一串公式是否需要记忆？她说，当然！我一脸委屈，觉得甚是可怕，从此埋下线性代数十年的阴影。并在后续我的考研，以及做 SLAM 视觉算法时不断感受到鞭笞。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928145621645.png" alt="image-20230928145621645" class="img_vXGZ"></p><p>在电大第一学期期末的时候，我和舍友们一起去附近网吧完成一项大作业。末了，他们开始了英雄联盟的游戏，当时我是全宿舍唯一一个只玩滑板不玩游戏的“好”同学。但既来之则安之，我也加入了他们的队伍，玩起了人机。我选了一个角色叫“暮光之眼 · 慎”，神射手芋头说这英雄很难玩的。确实如此，总之，我几乎只敢打小兵，见到人机英雄都得逃跑。我不服，在朋友们玩完回去之后，我对挑战这款游戏产生了强烈的兴趣，于是做了一件至今都觉得完全不可思议的事情：连续在网吧玩了七天七夜，直到结束骄傲地跟舍友们说我把游戏玩明白了，结果得知我已经错过了两项期末考试，并且我的朋友、辅导员、我妈等有一连串的电话。</p><p>再后来，我便在母亲的眼泪下顺利地完成了退学，继续深入研究英雄联盟两个月后攀爬到了钻石段位，接着追剧权利的游戏、甄嬛传，再接着全程参与2015年的中国股市，迅速成为某股票论坛知名人物，研发了30多个量化交易策略，并成功售卖出上百份南川三代分时交易策略赚到第一桶金（后来七八年内陆陆续续都会有人找到我提出购买的意愿）。15年6月的股市崩盘，让我意识到系统学习金融市场的重要性，抱着这样的想法，第一次做出了真正意义上的主动选择，去复读，去大学学习系统的量化金融。当时最想去的是上海财经大学，但重返高中的心态确实会很不一样，导致一年下来成绩更差了些，去到了我的第二个母校南京审计大学，一个没有量化但有一座湖的地方。</p><p>在南审的日子，平静而又激荡，在那样一个老山脚下，我步履匆匆，常常是校内同学行走速度的1.5倍，但依旧主要沉浸在自己感兴趣的方方面面。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928233207709.png" alt="image-20230928233207709" class="img_vXGZ"></p><p>得益于我的金融实操经历，我加入了有着20多年历史的校五星社团证券投资俱乐部，并在学长学姐的邀请下轻松获得了同花顺策略研发的省一等奖。为了更好地获取与分析金融数据，大一寒假我又在家自学了Python，主要就是快速把B站、慕课上所有相关的教学视频都过了一遍，达到可以自己设计程序、批量获取数据、会基本的数据分析。之后顺利地成为了学术部部长、学术部指导，并在大二同时获得校华为财经大赛冠军（带队大一的社团同学在180+队伍中夺冠，亚军全是大三）、华为软件大赛<sup id="fnref-hw-software-competition-c6c23e"><a href="#fn-hw-software-competition-c6c23e" class="footnote-ref">hw-software-competition</a></sup>（唯一一只来自商科院校的队伍）初赛积分一度第一名、复赛第六名。</p><p>大二暑假的时候，学院组织实习，有中国人民银行营管部和某信息科技公司两个选项。我对国企一直没有太强的感觉，就选择了后者。但原以为能学到什么高大上的技术，结果却是我们一个院两个年级的十几位同学聚集在一个二十多平的办公室里，校对大量的Excel表格。我评估了一下，这样的活，应该基于程序自动化完成。于是，我一个人去了附近的星巴克，连呆了一周，每天都在学习VBA，一周后回来花几小时就把所有的表都做完了。从那一刻起，基于自动化避免重复工作的种子就在我心中深深埋下。我也是从那开始真正意识到，工种与工种之间是不同的，我要把自己的时间投入在能创造更多价值的岗位上。</p><p>大三的时候，我对计算机的驾驭能力与日俱增，我召集了一群同学成立了第一个量化研究小组，随后申请创立了 Fintech金融科技协会<sup id="fnref-nau-finteh-c6c23e"><a href="#fn-nau-finteh-c6c23e" class="footnote-ref">nau-finteh</a></sup>。作为一个初创社团，吸引了上百位同学参加面试，一年内与清华、交大、南大、武大等多所院校的金融科技相关协会连续承办了多场全国金融赛事。一年后，学校正式成立了金融学（金融科技）教学方向。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928163245337.png" alt="image-20230928163245337" class="img_vXGZ"></p><p>大三暑假的时候，我随缘申请到了一家知名精品投行的实习，学习专业投资人的投资逻辑，以及辅助展开相关工作。最有意思的观察是每周周一大家都开会，完了每天来的人数都指数递减，经常到了周五的时候整个办公室就只剩下我和另一外上海财经大学的小哥哥，这样的工作模式着实觉得有趣。我主要利用我的技术为投资部门搭建了每日固定抓取初创公司的数据，并搭建了一个网站方便大家下载，顺带看看一些有趣的初创公司的案例。这里的人，都很优秀，除了我，大家基本都是来自清北复交人，逻辑表达能力个个都贼强，眼里闪着光。</p><p>最后一个凌晨，因为一些意外我索性打算在上海的某全家商店内度过，坐我对面的是一位白发苍苍的老人，他似乎很疲倦地趴在桌上。我望着他不禁入了神，开始思考自己最想干什么。我很快地确定了一个答案：拾起梦想，逐梦清华。为什么要考清华呢？因为这是一个梦想。为什么要追逐梦想呢？因为我不想让我的人生留有遗憾。我就是这样，很快地说服了自己。</p><p>我当即便在全家里搜索清华适合我的硕士专业，结果发现软件工程专业每年的分数并不是很高，最低分仅过国家线多二三十分即可；而计算机系则要更高一些。我对计算机与软件工程没有强烈的偏好，稳妥起见，我就选了软件工程，因为离考试只剩三个多月了。而我面临的挑战则是：</p><ul><li>数学一。但我们的专业只学了经济学方向的高等数学与线性代数，其中多重积分之类的从来没学。于是我要疯狂地补数学，那时候真地压力很巨大，怕自己搞不定，直到后来我把武忠祥、张宇、汤家凤所有多重积分的部分都看了一遍，才略有感觉，至今都还记得张宇那魔性的“喇叭开花”……</li><li>914软件工程。包含严蔚敏老师的数据结构与算法，黑书操作系统，与刘强老师的软件工程。显然这三门课我也均未学过。</li><li>……</li></ul><p>就这样，我给自己制定了有史以上最 tough 的作息表，那段时间，几乎每天三杯咖啡两杯茶，连续奋战了整整一百天：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928220558117.png" alt="image-20230928220558117" class="img_vXGZ"></p><p>但终力有所不逮，最终我的分数离软件工程只差10分，继而尝试调剂清华深圳的一些院系。印象最深刻的是，在调剂海洋系时，面试老师用英文问我「Why the sea is blue？」，以及「Do you love the sea?」十分意外的问题，但我知道，我确实没有做好准备，不是英语口语上的准备，而是调剂到一个从没有接触过甚至臆想过的专业的准备。毫无疑问，我失败了。</p><p>当时另一位同考软件工程的研友也是只差几分，后来调剂去了清华深圳互动媒体，结果过了，他真地非常优秀，和我是同一届电子科大入学的，后来去了华为、快手等公司，也是只花了非常短的时间备考。那个时候我对互动媒体，或者说游戏还没有太大兴趣，所以没有考虑过这个专业的调剂。而之后，这个专业逐年水涨船高，所以，时也，命也。</p><p>在学校相对顺风顺水的我，第一次尝到了重大失败的打击，因为这是我在知道自己想要什么之后尝到的失败。但我很快调整过来了，毕竟当你只花了相对较短的时间去做一件难度很大的事，即使失败，你也不会感到过于伤心，因为你的沉没成本并不高。</p><p>但很遗憾，我低估了命运的戏谑程度。由于对自己的极度自信，以及其他诸多想法的羁绊，后来我又陆续挑战了三次清华的考试，他们分别如下：</p><ul><li>第二年，在朋友家，2个月时间准备，初试第六。在我所有朋友与我自己觉得稳操胜券之后，结果复试惨败。老师们问了非常多刁钻的问题：<ul><li>what's the name of your university?</li><li>你为什么从电子科大的软件退学，读了金融，现在又来读软件？</li><li>你第一时间翻译了xxx老师的论文，有没有获得他的同意？</li><li>你觉得你拿中国自强之星这个奖的原因是什么？</li><li>……</li></ul></li><li>第三年，在自己家，备战状态非常好。结果因为过于投入，错过了动态的确认时间点。</li><li>第四年，在北京，备战状态非常差，花了一周时间准备，和第一年分数差不多，没有选择调剂。</li><li>……</li></ul><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928233342165.png" alt="image-20230928233342165" class="img_vXGZ"></p><p>也因为这样的梦想，我放弃了任何校招的机会，也未敢轻易把自己献给社会的血肉工厂。</p><p>再接下来的几年，我东奔西跑，我南征北战，我几乎每天都在战斗，与未来战斗，与过去战斗，与自己战斗。</p><p>我高速地经历着遇见与离别，我贪婪地学习与应用着互联网的一切知识，最高峰的时候，同时给五个团队开发产品。</p><p>我可以在短短一晚上形成一个骑行川藏线的想法，接下来两个月风雨兼程，历经生死劫难，只为在路上。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928233619086.png" alt="image-20230928233619086" class="img_vXGZ"></p><p>我可以动如脱兔，历时三个月，游遍京冀湘桂粤港，大大小小的街巷。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928233443423.png" alt="image-20230928233443423" class="img_vXGZ"></p><p>我可以静若处子，又是三个月，独居杭某偏僻小镇，为自己的产品呕心沥血。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/cover-lay.jpg" alt="cover-lay" class="img_vXGZ"></p><p>我开始意识到人这辈子如此之短，它呼之即来，它挥之即去，因此我们需要有可以保存下来的东西。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928234202298.png" alt="image-20230928234202298" class="img_vXGZ"></p><p>而 AGI 时代的到来，是如此的赐赠，它第一次把人类整个的智慧端送到每个人足前，在这个年代，风踏浪尖，何其有幸！</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928233841964.png" alt="image-20230928233841964" class="img_vXGZ"></p><p>而这便是我 2023 年的故事，并且只是个开始，这是一场极为长期的战役，这场枪声响起，便没有止步的一天。</p><hr><p>直到今天，猛然回首，从我刚入大学起，十年已经过去了。</p><p>十年，从不知无知到知无知，从无脑相信到充满质疑，从被命运安排到走向自驱，从满怀热血到满怀无限热血！</p><p>人生又有多少个十年呢。</p><p>我似乎一瞬间衰老。</p><p>我又似乎从未长大。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928232516515.png" alt="image-20230928232516515" class="img_vXGZ"></p><p>我望着身边的朋友结婚、生子，或是升学、高就，或是摸鱼、躺平，我开始没有了任何情绪。</p><p>我似乎已经见不到众生了，也没有任何外部力量，无论是个人的，还是社会的，可以伤到我。</p><p>我已经俨然成为了一名机甲战士，这条高速公路上，只有我一人，无限的远方，无限的浪漫。</p><p>我是这样强烈地相信着：下一个十年，无论我们在哪，这世界终会听到我们的声音。</p><p>是的，这样的感觉如此强烈，似乎是十年来所有火山凝聚的力量，它足以把内心的太阳烧亮：</p><blockquote><p>如果你不把我看成那种游手好闲之人，我会非常高兴。即使游手好闲者也有不同的类型，有种人因为懒惰、卑劣、缺乏个性而碌碌无为。如果你愿意，可以把我看作这类人。</p><p>也有另一种人，尽管他们的内心被强大的渴望所驱使，但现实不可改变，他们无能为力，就像被囚禁了一样，所处的环境缺乏创造所需的土壤，使他们无所作为。这样的人不是总能确定自己要做什么，但是他本能地感到：尽管如此，我必然有擅长的事情，我必有存在的意义！我知道我会成为一个不同的人！只是我如何能成为有用之人？应该怎么做？是金子就一定会发光，但我身上能闪光的特质又是什么？这是意义完全不同的游手好闲，如果你愿意，也可以把我看成这类人。</p></blockquote><p>约伯记第十二有言：「或與地說話，地必指教你。海中的魚，也必向你說明。看這一切，誰不知道是耶和華的手作成的呢。」</p><p>我想是的，我从三文鱼<sup id="fnref-salmon-c6c23e"><a href="#fn-salmon-c6c23e" class="footnote-ref">salmon</a></sup>那里得到了生命的终极启示：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/salmonweb2.jpg" alt="The salmon food web" class="img_vXGZ"></p><p>那就是一生只奔向一次大海，然后溯游而上，回家。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928224559777.png" alt="image-20230928224559777" class="img_vXGZ"></p><p>For what ? </p><p>For everything.</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/rick_morty.0.jpg" alt="Everything you need to remember before Rick and Morty's third season -  Polygon" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928234940199.png" alt="image-20230928234940199" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230928234946865.png" alt="image-20230928234946865" class="img_vXGZ"></p><div class="footnotes"><hr><ol><li id="fn-hw-software-competition-c6c23e">关于华为软件大赛的失败主要是两点：1. 当时我还没有学过数据结构与算法（所以连最基本的二分法都不知道），以及只会python（不会java或者C++），导致程序跑起来特别慢，别人10秒钟就能完成的事，我得一分钟，等于说我比别人能调试的机会要少十倍，因此最终成绩不够理想（前四就能晋级了）。2. 与我组队的两位学长都不是计算机科班的，所以实际开发重担还是在我身上。<a href="#fnref-hw-software-competition-c6c23e" class="footnote-backref">↩</a></li><li id="fn-salmon-c6c23e">据加拿大渔业海洋局统计，每对三文鱼产下4000颗鱼籽，大约有800条小鱼孵化幸存下来，在游向湖泊大海过程中大量被捕食，大约有200条到达大海，4年后能洄游的仅剩10条，其中约8条被人类捕食，能够最终回到产卵地的只有2条。ref: <a href="https://www.163.com/dy/article/FS7MTNIP052494DO.html" target="_blank" rel="noopener noreferrer">https://www.163.com/dy/article/FS7MTNIP052494DO.html</a><a href="#fnref-salmon-c6c23e" class="footnote-backref">↩</a></li></ol></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川骑行川藏线（中）]]></title>
            <link>https://markshawn2020.github.io/blog/2023/12/18/南川骑行川藏线（中）</link>
            <guid>/2023/12/18/南川骑行川藏线（中）</guid>
            <pubDate>Mon, 18 Dec 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[你知不知道有一种鸟没有脚的？他的一生只能在天上飞来去。一辈子只能落地一次，那就是他死的时候。]]></description>
            <content:encoded><![CDATA[<blockquote><p>你知不知道有一种鸟没有脚的？他的一生只能在天上飞来去。一辈子只能落地一次，那就是他死的时候。</p></blockquote><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180252.png" alt="Pasted image 20231218180252" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概要">概要<a class="hash-link" href="#概要" title="标题的直接链接">​</a></h2><p>本文是南川于2021年7月末起骑行川藏线的第二篇朋友圈笔记合集，主要记录从入藏到拉萨一共20天左右的所行所感，期间经历了各种塌方、激流、悬崖、摔车、爆胎等，最终成功抵达了拉萨！</p><p>第一篇在：【文章：上】</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="骑行日记">骑行日记<a class="hash-link" href="#骑行日记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="16-通往芒康县城">16 通往芒康县城<a class="hash-link" href="#16-通往芒康县城" title="标题的直接链接">​</a></h3><p>芒康加油站到芒康县城，20公里，海拔3500到4100到3800，本来只是一个三星级的任务，由于早上从加油站出发时忘带走充电线，于是不得不从县城骑回去再回来（加油站负责人都惊了），所以今天实际里程60公里，爬坡1500米……</p><p>今天早上遇到了昨日带帐篷骑行的淼哥，中午下坡时又遇到了前几天下折多山的徒步小姐姐，于是愉快的一起吃晚饭了！</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133823.png" alt="Pasted image 20231218133823" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133834.png" alt="Pasted image 20231218133834" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133838.png" alt="Pasted image 20231218133838" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133750.png" alt="Pasted image 20231218133750" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133812.png" alt="Pasted image 20231218133812" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133804.png" alt="Pasted image 20231218133804" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218133844.png" alt="Pasted image 20231218133844" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="17-芒康到如美">17 芒康到如美<a class="hash-link" href="#17-芒康到如美" title="标题的直接链接">​</a></h3><p>芒康县到如美镇，里程50公里，海拔3800到4300到2700，下午2点到晚7点
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134416.png" alt="Pasted image 20231218134416" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134240.png" alt="Pasted image 20231218134240" class="img_vXGZ"></p><p>3800到4300这段爬坡十公里，这几天感受下来，坡度4-6的话，五公里尚可接受，十公里就很劝退新手了，二十公里则丧心病狂，十公里差不多是我不发牢骚但很累很累的极限，虽然对于体力充沛的另外两位骑友来说倒没什么
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134351.png" alt="Pasted image 20231218134351" class="img_vXGZ"></p><p>今天下坡则很危险，主要体现在坡度很陡、弯度很大，以及路面很多坑或者水泥路，以至于我被震到屁股飞起来，刹车过弯打滑一次，不过还好控制到位都没事。队友就比较惨了，虽然速度可能比我低一丢丢，但没躲开一个坑，直接爆胎了……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134429.png" alt="Pasted image 20231218134429" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134249.png" alt="Pasted image 20231218134249" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134317.png" alt="Pasted image 20231218134317" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134406.png" alt="Pasted image 20231218134406" class="img_vXGZ"></p><p>这儿就是如美镇了，当然这个朝圣徒步骑行的雕像群路上也在另一个村上看到过，第一次遇见很触动，这大概就是川藏两地见到骑行都会扎西德勒，看到徒步都会自愿带上一程的集中文化体现了吧
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134225.png" alt="Pasted image 20231218134225" class="img_vXGZ"></p><p>但愿尽早见到朝圣的人儿</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="18-如美到邓巴">18 如美到邓巴<a class="hash-link" href="#18-如美到邓巴" title="标题的直接链接">​</a></h3><p>如美镇到邓巴村，里程40公里，海拔2700到4000到3400，今天难点主要是早上26公里的爬坡，冒雨从早9点一直爬到下午3点，昨天刚说10公里就是自己的极限，今天就要挑战26，明天就要挑战40……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134720.png" alt="Pasted image 20231218134720" class="img_vXGZ"></p><p>竟然还有朋友说羡慕我出来旅游的，每天都被山虐的不能自己，回到客栈秒睡3小时……如果你也想的话可以试试啊<!-- -->[Facepalm]<!-- -->
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134930.png" alt="Pasted image 20231218134930" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134744.png" alt="Pasted image 20231218134744" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134749.png" alt="Pasted image 20231218134749" class="img_vXGZ"></p><p>今天主要就是转山，山腰是觉巴村，由于一直转一直爬，回头一望，还是觉巴村，内心无比崩溃，真想给觉巴村做个转山专辑，以示它是多么地阴魂不散……开玩笑的。从山腰俯瞰下去，觉巴村真美！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134802.png" alt="Pasted image 20231218134802" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134841.png" alt="Pasted image 20231218134841" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134822.png" alt="Pasted image 20231218134822" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134859.png" alt="Pasted image 20231218134859" class="img_vXGZ"></p><p>今天的落宿点是飞登的邓巴村服务站，主要有三批人，第一批就是我们，第二批是从芒康骑过来的四五个骑友，明天约好一起出发“推山”，第三批就是徒步直播三人组了，他们很牛，其中一位专门负责捡沿路的易拉罐塑料瓶，这个简直大赞！另外，还遇到一位带狗的骑友，这让我无比感伤，如果我早点遇见他，或许就有意识地带二郎山的啸天出山了，可惜他今天应该没住这个客栈，直接往前赶了。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218134946.png" alt="Pasted image 20231218134946" class="img_vXGZ"></p><p>话说，这个村子目前还没通电，都是用太阳能+发电机供电，希望早日通电！</p><p>插曲：队友又折一脚撑
![<!-- -->[4fc8b4b22ac44d6c7c3dea9c757698.mp4]<!-- -->]</p><p>评论：来自吴妈的独白
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218135043.png" alt="Pasted image 20231218135043" class="img_vXGZ"></p><p>延时：《经幡 云海 远山 他乡客》
![<!-- -->[36c0a75cf72e5654ceeabfa965fc1b.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="19-邓巴到左贡">19 邓巴到左贡<a class="hash-link" href="#19-邓巴到左贡" title="标题的直接链接">​</a></h3><p>邓巴村到左贡，里程70公里，海拔3400到5100到3700，早8点开始爬坡，5点半才登顶，7点抵达目的地。这个速度可以说是很慢了，40公里没想到爬了9个小时，平均5公里/小时都不到，当然，和大家一起推车发快乐却是弥足珍贵的。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140858.png" alt="Pasted image 20231218140858" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140851.png" alt="Pasted image 20231218140851" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140844.png" alt="Pasted image 20231218140844" class="img_vXGZ"></p><p>而东达山，作为川藏线12座4000米海拔以上的第八座高山，也是最高的一座山，原以为我会非常激动，毕竟，翻越此山，将再无高山难越！然而到底的几百米大雾聚集，暴雨疾下，根本无暇享受会当凌绝顶的快感。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140904.png" alt="Pasted image 20231218140904" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140932.png" alt="Pasted image 20231218140932" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218140939.png" alt="Pasted image 20231218140939" class="img_vXGZ"></p><p>不管怎样，40公里1700米的爬升，最后几公里还有轻微高反，但最终都挺过来了，这几天我一直在想我骑行川藏线的意义，也许有段歌词很好地回答了这个问题：</p><p>【音乐：许巍-生活不止眼前的苟且】
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218141030.png" alt="Pasted image 20231218141030" class="img_vXGZ"></p><p>插曲：无人机拍到的秃鹫（违规内容：）
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218141022.png" alt="Pasted image 20231218141022" class="img_vXGZ"></p><p>回顾：特别感谢老大爷的馒头和公路车大佬的葡萄糖液，否则的话我撑不到下午……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="20-左贡到邦达人生第一次喝茶">20 左贡到邦达：人生第一次喝茶<a class="hash-link" href="#20-左贡到邦达人生第一次喝茶" title="标题的直接链接">​</a></h3><p>左贡到邦达，105公里，海拔3900到4100，早上10点到晚上9点，主要是起伏坡，这对于<strong>已经翻过八座高山</strong>的我来说，倒不是很大的问题，上坡5码，平坡15码，下坡25码，平均下来也有10码以上，这就是为什么10点出发我也要坚持到邦达镇而非中间的田妥镇，因为我觉得我一定能在天黑前到达，于是乎我再一次把队友甩了……并且触发了第三次暴雨夜骑……</p><p>当然，这一天也是波澜起伏，因为早上起的早，8点半抵达左贡人民医院附近广场，打算先飞会无人机再去做核酸，我也真是心大，旁边就是交警大队和人民政府……于是飞了十分钟完成准备走时，就被七八个公安围住了……于是，<strong>人生第一次进局子</strong>……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170643.png" alt="Pasted image 20231218170643" class="img_vXGZ"></p><p>不过令我意外的是，和我谈话的是一个非常年轻帅气沉稳和蔼山东援藏的兵哥哥，我们聊了西藏区禁飞、骑行每日里程、西藏反分裂等等话题，这次喝茶就在一片互相谅解的氛围中愉快地结束了，真想和他来个合影，唉……</p><p>下午继续出发，一直跟在三辆武警铲车后面，因为暴雨很容易触发泥石流和落石，他们就是全程清路的，由于一直碰见，后来我们就互相鼓励了一下～
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170418.png" alt="Pasted image 20231218170418" class="img_vXGZ"></p><p>遇到了一位小女孩路上为我加油，后来我发现她一个人过桥回村，就骑了一半桥目送她回去了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170456.png" alt="Pasted image 20231218170456" class="img_vXGZ"></p><p>很多藏族小朋友真地非常友好，他们在路上会非常热情地冲你挥手高声喊到扎西德勒，或是在摩托车后座回头冲你用力地挥手微笑，这些都给我留下了无比深的印象。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170447.png" alt="Pasted image 20231218170447" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170517.png" alt="Pasted image 20231218170517" class="img_vXGZ"></p><p>还有佛陀，来自北京天开寺。以及他的同行，我问他为什么也来川藏线，他低调地说是为了锻炼身体，可惜后面大卡车逼近不能深聊，甚是遗憾。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170544.png" alt="Pasted image 20231218170544" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170553.png" alt="Pasted image 20231218170553" class="img_vXGZ"></p><p>昨天由于深夜暴雨狂骑，全身酸痛，昨天一到客栈，直接就瞌睡到了凌晨，故今日白天清醒时补上。接下来就是最危险的路段：怒江七十二拐了，每年都有很多人摔车，也祝自己好运！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170635.png" alt="Pasted image 20231218170635" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170628.png" alt="Pasted image 20231218170628" class="img_vXGZ"></p><p>插曲：碰到了个15w粉丝的徒步直播…… 在她的直播里果然看到了我们自己……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218142708.png" alt="Pasted image 20231218142708" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218143357.png" alt="Pasted image 20231218143357" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218143401.png" alt="Pasted image 20231218143401" class="img_vXGZ"></p><p>放空：昌都市·玉曲的江水
![<!-- -->[3028496b2c4815e3216b7826411ed4.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="21-邦达到八宿最危险的一天">21 邦达到八宿：最危险的一天<a class="hash-link" href="#21-邦达到八宿最危险的一天" title="标题的直接链接">​</a></h3><p>邦达到八宿（69.5道班处的岁岁丰川菜馆），70公里，海拔4000到4600到2943，中午11点到晚上9点，南川第四次夜骑……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172656.png" alt="Pasted image 20231218172656" class="img_vXGZ"></p><p>今天可以说是川藏线之旅最危险一天，完全可以用“虎口脱险”来形容。</p><p>由于昨天的过度疲劳，导致素材整理、衣服吹干、邦达老板的调车等都堆积到了今天早上，所以一直到中午才出发，众所周知我爬坡很慢，所以下午三点多才登顶业拉山，常规进度应该是中午前到。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172726.png" alt="Pasted image 20231218172726" class="img_vXGZ"></p><p>当然，业拉山的风景还是好看的，但比起8公里缓下坡后的人工奇迹怒江七十二拐来说，可就相形见绌了！然而，风景虽好，危险却也是极致！我之前就在骑友朋友圈留言说，每年怒江七十二拐都有会摔车的，以我的下坡风格，怒江七十二拐肯定会摔，结果一语成谶！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172747.png" alt="Pasted image 20231218172747" class="img_vXGZ"></p><p>我原以为怒江七十二拐的凶险在于长、陡和拐，当然这些都是事实，但实际上怒江七十二拐最凶险的在于路况！</p><p>首先是每个弯的外道可能由于大卡车全是裂开的，这导致拐弯必须大减速！其次，在通过下面的村庄时有个弯直接全是坑坑洼洼的泥坡，仿佛是山地地貌，我直接吓到紧急刹停！最后，有一个最坑的横沟，直接占据了路面的右半边，宽度达到两三分米，深度达到一两分米，谁能料到这是在直道并且是右侧出现的？当时刹车没来得及，直接蹦飞了出去……
![<!-- -->[43cc56863db55501563d446e79160f.mp4]<!-- -->]</p><p>好家伙，我又摔车了，幸好这次我头盔、冲锋衣、雨裤、护膝、运动鞋一套齐活，加之曾经玩过一年的滑板，“精通”各种摔跤技术，这才屁事没有，只小小的刮破了右脚踝，一个创口贴就完事……</p><p>后面自驾的看到我摔了，较忙过来强塞我两瓶“西藏好水”矿泉水，这水在晚上堵车时着实为我解了渴。</p><p>继续往下飘就遇到了山腰上第一次堵车，堵了至少半小时，最后几分钟我直接把防潮垫拿出来铺在悬崖边上打算睡一会，武警就过来和我聊天，聊一会就通路了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172912.png" alt="Pasted image 20231218172912" class="img_vXGZ"></p><p>之后七十二拐应该是全下完了，路过了怒江大桥，那怎一个“绝”字了得！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172943.png" alt="Pasted image 20231218172943" class="img_vXGZ"></p><p>怒江一带，修桥修路死了不少人，直到如今，继通麦隧道打通后已经是川藏线上最危险的路段，因为一下雨就塌方（这是晚上等通路时和我搭话的成都老板对我说的），我以前觉得塌方而已，直到比人还大的石头就砸在路上把路砸出大卡车体积的塌陷，旁边就是悬崖，我内心简直拔凉……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173024.png" alt="Pasted image 20231218173024" class="img_vXGZ"></p><p>老板说，如果这路晚上修不好，又下起雨，他直接就掉头爬七十二拐走317了……我心想……那我只能等死了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218172958.png" alt="Pasted image 20231218172958" class="img_vXGZ"></p><p>![<!-- -->[7e8ea202a4ab011b81521f54c285de.mp4]<!-- -->]</p><p>今天还有好多小伙伴在朋友圈留言为什么这个塌方我不直接过去，毕竟扛车一会的事情……这个想法呢，大家都知道，我也有向武警多次反映，但都没得到通过的允许，说实话我当时内心是很生气的，毕竟等路修好都天黑了，其他人都是小汽车或者大卡车，分分钟出峡谷，而我要爬很久，这对我非常不利也非常危险。</p><p>最后，8点半后（已经天黑）路终于压通，我也积极地通过了塌方路段，打着手电摸黑出山。但让我困惑的是后面总是没车跟过来，我当时心想可能是迎面来的车和后面的车对堵住了。又骑了几分钟，后面有大车开始跟上我，我回头一看是武警的大铲车，因为出山是起伏坡，所以我停下来示意让大铲车先走，没想到武警朝我大喊“快走，后面危险！”
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173102.png" alt="Pasted image 20231218173102" class="img_vXGZ"></p><p>我当时脑子仿佛触电一般，立即又跨上车开始拼命往前蹬，即使坡度达到7也不敢放慢速度，那大铲车的四个大灯光把我的车身和影子照的贼长，并且一直跟在我后面护送到出山。这一路上，我始终想起抖音上一个非常热门感人的视频，一个小女孩在乡路上摸黑骑车，后面一辆汽车灯光照着她的路，骑了一段后，小女孩停下车把车放好，回头向汽车鞠了一个躬！而现在，我就是那个小女孩，虽然我有手电……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173337.png" alt="Pasted image 20231218173337" class="img_vXGZ"></p><p>出山后遇到了一个满是318骑友标语的饭店，也提供住宿，我终于可以平静地喝着可乐点碗盖饭，然后望着街上，陆续驶来的小汽车和大卡车，但那辆大铲车却始终没有出现……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173125.png" alt="Pasted image 20231218173125" class="img_vXGZ"></p><p>它不会出现了，它已经完成了今天的使命。</p><p>插曲：遇到了一位巴塘朝拜的哥哥，目标是大昭寺，路上一定多加保重！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170825.png" alt="Pasted image 20231218170825" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218170833.png" alt="Pasted image 20231218170833" class="img_vXGZ"></p><p>放空：《中华民族伟大复兴的中国梦一定能够实现！》
![<!-- -->[734d4c1d11554573411ba1c6becef4.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="22-八宿到吉达">22 八宿到吉达<a class="hash-link" href="#22-八宿到吉达" title="标题的直接链接">​</a></h3><p>八宿到吉达乡，里程50公里，海拔2900到3800，按攻略应该是要直接翻越安久拉山的，但是它的坡实在太长有60公里，所以想都没想先翻一半。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173942.png" alt="Pasted image 20231218173942" class="img_vXGZ"></p><p>今天是这段路程第一次买水果，可惜我的下嘴唇起泡快一周还没好，一咬就爆血了，不过这都不算什么事了……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174004.png" alt="Pasted image 20231218174004" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218173954.png" alt="Pasted image 20231218173954" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174044.png" alt="Pasted image 20231218174044" class="img_vXGZ"></p><p>这是今天中午休息的地方，不打招呼直接睡了张沙发，屋主人在我休息时开摩托干活去了，我觉得很不好意思，所以临走时将两个苹果摆了个玛尼堆，就当是中午的休息费了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174256.png" alt="Pasted image 20231218174256" class="img_vXGZ"></p><p>今天其实很不想骑，可能是这几天实在太累了，而且昨天还摔了一跤有下坡阴影，所以今天上坡慢慢骑下坡也慢慢骑，中途还进庙里听了会佛经，这里几乎每个村庄都有一个小庙，庙外面是转经筒，今天也终于完整地转了三圈经筒，走时发现老奶奶直接匍匐在地上拜经，我也是被震惊到了，这里的人真地很虔诚。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174108.png" alt="Pasted image 20231218174108" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174115.png" alt="Pasted image 20231218174115" class="img_vXGZ"></p><p>今天在路过多拉神山时，有点遗憾没去多拉寺看看，因为转山的有一批孩子和我打招呼，他们的童真可爱让我觉得这片山有了更亲近的感觉。</p><p>最后一位老爷爷53岁了，我的骑车速度和他走路差不多，他虽然拄着拐杖，可是每一步都铿锵有力，透过他的背影，我仿佛看到了自己的人生答案：<strong>平凡有力，不紧不慢</strong>。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174220.png" alt="Pasted image 20231218174220" class="img_vXGZ"></p><p>诗一首</p><blockquote><p>凭谁问</p><p>万里长鲸吞吐</p><p>人间儿戏千弩</p><p>滔天力倦知何事</p><p>白马素车东去</p></blockquote><p>![<!-- -->[97dac26f6bad0b618efbe753136fa9.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="23-吉达到然乌">23 吉达到然乌<a class="hash-link" href="#23-吉达到然乌" title="标题的直接链接">​</a></h3><p>吉达乡到然乌镇，60公里，海拔3800到4400到3900，早上10点到下午7点。</p><p>有意思的是这边藏民貌似主要是务农而不是放牧，这让我有种回到了江南水乡的感觉。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174904.png" alt="Pasted image 20231218174904" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174942.png" alt="Pasted image 20231218174942" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174949.png" alt="Pasted image 20231218174949" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174956.png" alt="Pasted image 20231218174956" class="img_vXGZ"></p><p>尤其是然乌湖旁的农田，让我颇有种潜先生之世外桃源，大抵如是乎之感。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218174921.png" alt="Pasted image 20231218174921" class="img_vXGZ"></p><p>遗憾啊，雨季经常下雨，湖水裹挟着山上的泥流，因而混浊不堪，若是四五月来，清明如镜，加之远处冰山辉映，将绝美若画。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175046.png" alt="Pasted image 20231218175046" class="img_vXGZ">
![<!-- -->[7535dc38fe6147173800a96ccc8e04.mp4]<!-- -->]</p><p>就在刚刚不久，远处传来士兵操练的声音，一二三四，联想起这几日频繁看到街上的警察、路上的武警等，不来西藏，真不知道，原来老毛子时代的“军民融合”，仍默默地在藏区这片土地上熠熠发光……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175037.png" alt="Pasted image 20231218175037" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175022.png" alt="Pasted image 20231218175022" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175009.png" alt="Pasted image 20231218175009" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="24-然乌到玉普">24 然乌到玉普<a class="hash-link" href="#24-然乌到玉普" title="标题的直接链接">​</a></h3><p>然乌镇到玉普乡，60公里，起伏坡，海拔3900到3159，按照攻略，今天应该到波密，90公里，可是呢？早上8点玉普乡前面20公里的松宗镇路断了，这可比前两天在八宿的塌方严重的多，那个塌方一下午可以修好，这个路断的，你看看……没一两天根本搞不定，所以我们就选择在中途落宿了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175246.png" alt="Pasted image 20231218175246" class="img_vXGZ"></p><p>从然乌镇出发到波密路上30公里处有个米堆冰川，我和队友都很想看，正好路断我们都有在冰川附近落宿的愿望，可惜我和冰川景区炸鸡店老板聊下来，现在的冰川大家没法近距离感受，安全考虑要隔着1.5公里，而且今天下雨看不清主峰，另外50元门票+35元接送+最后两公里藏民100左右的骑马或开车运输，综合下来，性价比极低，最后还不准用无人机，所以我直接对米堆冰川失去了兴趣，希望在尽可能远的玉普乡落宿，而队友们出于价格与回骑考虑则在景区下面7公里处落宿。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175429.png" alt="Pasted image 20231218175429" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175418.png" alt="Pasted image 20231218175418" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175344.png" alt="Pasted image 20231218175344" class="img_vXGZ"></p><p>本来这一切是没有问题的，谁知道玉普乡前面有个检查站，所有非玉普乡居民不准通过，外面那个保安还凶地狠，我跟他动之以情说附近1公里的旅馆已经住满了，往回要爬20多公里的坡，希望考虑到我骑车的处境允许我入乡，但被一口回绝了。紧接着我看到有藏民通过了检查站，我就质问为什么他们可以通过，他回答他们住这当然能过。于是我追问我也是要住里面，为什么我不能过。他问我我住哪，我说住宾馆，他说宾馆全部住满了。我就继续追问，外面的人全部都进不去，里面的宾馆怎么可能住满？他就狡辩说早上放了好几辆车进去，里面早就住满了！这我就不服了，我就把车停到边上，打开美团、高德地图，疯狂搜索玉普乡的住宿点。一个个电话打过去，中间还有些曲折，总之半小时后我当面免提给他们，让他们知道有客栈还没住满，这才允许我押了身份证后通过！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175438.png" alt="Pasted image 20231218175438" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180229.png" alt="Pasted image 20231218180229" class="img_vXGZ"></p><p>此外，波密这里的涉水区真地很危险很危险，有两个，我今天真地是心惊肉跳地通过第二个涉水区的，旁边就是悬崖，要是水再大点，很容易出人命的，希望当地交警能考虑到雨季骑行与徒步的，也修个小土台允许绕过去把队友吧。
![<!-- -->[af046ad77dab9b1b3558bb54598637.mp4]<!-- -->]</p><p>最后，到了检查站下方1.5公里处的客栈后称了下体重，我不但黑了，还瘦了10斤。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175446.png" alt="Pasted image 20231218175446" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175455.png" alt="Pasted image 20231218175455" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175504.png" alt="Pasted image 20231218175504" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="25-路断修整第二天">25 路断修整第二天<a class="hash-link" href="#25-路断修整第二天" title="标题的直接链接">​</a></h3><p>![<!-- -->[4ef5585670649e5d18f1b00cd3dd80.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="26-路断修整第三天观转山">26 路断修整第三天：观《转山》<a class="hash-link" href="#26-路断修整第三天观转山" title="标题的直接链接">​</a></h3><p>因路断修整第三天，观看了12年骑行题材电影《转山》，讲述了一个台湾小伙为完成哥哥骑行滇藏线的夙愿，挑战自己最终精神蜕变的故事。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180416.png" alt="Pasted image 20231218180416" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218175908.png" alt="Pasted image 20231218175908" class="img_vXGZ"></p><p>根据自己的亲身经历来评价这部电影，虽然为电影情节需要有些夸张，但可以说基本写实。很多人觉得不就是骑个自行车去西藏哪有那么多夸张的情节，但我可以非常负责任地说因人而异，每个人都有属于每个人的川藏线。就比如，你跟团去骑川藏线，和你一个人骑，体会是完全不一样的。你每天住宾馆，与别人每天住骑行驿站，与别人每天直接住藏民家里，与别人每天住自己帐篷里，这个体验差异就更大了。你遇到任何自驾的、骑友、徒步的、朝拜的都很冷漠，只关心自己的目的地，与一路结交朋友或是说声加油，这又是不一样的。所以一路下来，每个人都看到的也许是相似的风景，但每个人，内心受到的触动，却各有不同。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180310.png" alt="Pasted image 20231218180310" class="img_vXGZ"></p><p>就比如不舍得男主离开的小孩，我在禾尼乡所波大叔家时就有感受到过，当时我们和他家两个小孩玩的很开，后来其中一个小孩抱着我的腿抬头问我道：明天你们是不是就要走了？我当时，说实话，一下子就很难过了，但还是微笑地回答道：对啊！因为我觉得只有对他们足够冷淡，让他们明白我们的到来与离开不会有什么不同，才能对他们的情感伤害降到最低。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180017.png" alt="Pasted image 20231218180017" class="img_vXGZ"></p><p>不过，影片的核心主题，是通过骑行滇藏线获得内心的救赎，比如男主像藏民学习朝拜。然而，绝大多数人骑不骑川藏线，都不会对命数、性格产生多大的影响，顶多只是装个逼而已，这是件很遗憾的事情。所以这一路来，我也尽量不排斥新事物，尽管我不信佛，但也尽量保持虔诚，为的就是尽可能能让某些东西影响到我，否则我骑再多遍川藏线也没有太多意思，只为了看风景吗？
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180126.png" alt="Pasted image 20231218180126" class="img_vXGZ"></p><p>风景有大有小，大风景比如日照金山什么的，骑行路上压根就很难看到，反而不如看B站罗红直接开两辆直升机拍的画面，那才叫一个壮观。所以，我对大风景不抱太高期望，我能把握住的，其实只有小风景，藏民们的生活细节，藏族孩子们、大人们对世界的认知等等，这些才真正让我痴迷
按照目前形势，路修好还要好几天，这个月肯定骑不完了，所以我反而也就没那么着急了，这几天可以陆陆续续地整理整理资料，并思考思考接下来的方向。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180211.png" alt="Pasted image 20231218180211" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218180321.png" alt="Pasted image 20231218180321" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="27-路断修整第四天">27 路断修整第四天<a class="hash-link" href="#27-路断修整第四天" title="标题的直接链接">​</a></h3><p>![<!-- -->[a6d3199f630766f67fe264df25dd6d.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="28-路断修整第五天三刷车轮不息">28 路断修整第五天：三刷《车轮不息》<a class="hash-link" href="#28-路断修整第五天三刷车轮不息" title="标题的直接链接">​</a></h3><p>三刷《车轮不息》
每次看都很感动
即使明白自己一辈子都不会去玩速降
因为那些是我们短短一生闪闪发光所热爱的东西啊</p><blockquote><p>Where the trail ends, the next one begins.</p></blockquote><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182454.png" alt="Pasted image 20231218182454" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182459.png" alt="Pasted image 20231218182459" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182504.png" alt="Pasted image 20231218182504" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182510.png" alt="Pasted image 20231218182510" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182515.png" alt="Pasted image 20231218182515" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182536.png" alt="Pasted image 20231218182536" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182520.png" alt="Pasted image 20231218182520" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182525.png" alt="Pasted image 20231218182525" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182529.png" alt="Pasted image 20231218182529" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="29-松宗到通麦">29 松宗到通麦<a class="hash-link" href="#29-松宗到通麦" title="标题的直接链接">​</a></h3><p>松宗镇到波密再到通麦，130公里，早上7点半到晚上7点半。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182654.png" alt="Pasted image 20231218182654" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182612.png" alt="Pasted image 20231218182612" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182712.png" alt="Pasted image 20231218182712" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182723.png" alt="Pasted image 20231218182723" class="img_vXGZ"></p><p>原以为最后90公里下700的海拔会so easy，结果被血虐，无尽的起伏坡，还有非常多处因为塌方维修而导致的超大泥浆坑，非常恼火。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182643.png" alt="Pasted image 20231218182643" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182706.png" alt="Pasted image 20231218182706" class="img_vXGZ"></p><p>如果不论路况，今天应该可以说是“身体在地狱，眼睛在天堂”了，上午松宗镇到波密，远处的雪山与冰川一路相伴，令人好不激动！下午波密到通麦段，郁郁葱葱，实属高原难得景观，众人都说林芝风景好，诚不欺我啊。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182637.png" alt="Pasted image 20231218182637" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182631.png" alt="Pasted image 20231218182631" class="img_vXGZ"></p><p>路上捡了一只鸟，不过飞了！但飞得好！大丈夫生居天地间，岂能郁郁久居人下！去追寻你的天空吧！
![<!-- -->[9cb9ab754be46fd8925b8038e0d401.mp4]<!-- -->]
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183103.png" alt="Pasted image 20231218183103" class="img_vXGZ"></p><p>向着雪山出发
![<!-- -->[1214356c17775c2a7e51d6fe80a52f 1.mp4]<!-- -->]</p><p>哦对了，昨晚接到路通的消息，怕晚上下雨路继续断，就从玉普乡到松宗镇第五次夜骑了20多公里，这个路也是一言难尽，因为只允许单边放行，堵车堵了5公里，又是摸黑，通过路断地段基本就跟图七的大水坑差不多……这些经历充分表明，雨季不要来318，路差风景差，还危险！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218182648.png" alt="Pasted image 20231218182648" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="30-通麦到鲁朗">30 通麦到鲁朗<a class="hash-link" href="#30-通麦到鲁朗" title="标题的直接链接">​</a></h3><p>通麦到鲁朗，海拔2000到3200，里程70公里，中午11点到晚上9点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183411.png" alt="Pasted image 20231218183411" class="img_vXGZ"></p><p>今天又捡了位帅气的小哥哥四天哥，没错，他的大名就叫四天，然后另外两位队友由于昨天没到通麦就中途休息了，所以今天为了追上我多骑了55公里，甚是辛苦，我能理解那种手脚都要抽筋的感受，因为昨天我就是这样的……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183440.png" alt="Pasted image 20231218183440" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183452.png" alt="Pasted image 20231218183452" class="img_vXGZ"></p><p>今天中午的头17公里，说实话我是很激动的，因为要翻越五隧二桥，途径十英雄纪念碑，喝水不忘挖井人，这十位英雄就是当年修川藏线遇到特大山崩而牺牲的武警干部们，真正诠释了什么叫做“地崩山摧壮士死，然后天梯石栈相钩连”！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183418.png" alt="Pasted image 20231218183418" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183342.png" alt="Pasted image 20231218183342" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183425.png" alt="Pasted image 20231218183425" class="img_vXGZ"></p><p>到了鲁朗后，因为没确定旅馆，正好碰到了来这旅游的一群朋友，他们介绍了我这家青旅，很有氛围，据说陈坤也来过……关键是住这家后，附近的牧场等就不用买门票了/::B期待明天白天的风景！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183456.png" alt="Pasted image 20231218183456" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183509.png" alt="Pasted image 20231218183509" class="img_vXGZ"></p><p>《愿我们都能追逐我们生命中的光》
![<!-- -->[16c8a17899ea4b7c3221f3df5ae2c4.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="31-鲁朗到林芝">31 鲁朗到林芝<a class="hash-link" href="#31-鲁朗到林芝" title="标题的直接链接">​</a></h3><p>鲁朗到林芝镇，爬坡25公里从3200到4400，下坡31公里到3000，原定到八一但由于鲁朗实在太美，流连忘返，加上自己今天体力极差，下坡一小时爬坡一整天，所以中午11点半出发晚上8点只到了林芝镇。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183821.png" alt="Pasted image 20231218183821" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183831.png" alt="Pasted image 20231218183831" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183836.png" alt="Pasted image 20231218183836" class="img_vXGZ"></p><p>今天其实最遗憾的是早上7点起床兴致勃勃去看牧场的经幡阵，结果由于下雨潮湿死气沉沉……千言万语还是那句话，雨季别来川藏线，啥都看不到……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183909.png" alt="Pasted image 20231218183909" class="img_vXGZ"></p><p>话说鲁朗开发的是真地绝，光是五星级酒店就有三家，而且极尽气派，除了好山好水，还有牧场、林海、花海……一应俱全，满足西部所有浪漫想象……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183929.png" alt="Pasted image 20231218183929" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183844.png" alt="Pasted image 20231218183844" class="img_vXGZ"></p><p>今天翻越的色季拉山是此次旅程倒数第二座高山了，海拔4700+，上坡打破自己最慢记录，已经低到了3公里每小时了……下坡也打破了自己最快记录到了57码，均速38.9，为了这个速度准确地说赶时间连哈达都戴上了……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183854.png" alt="Pasted image 20231218183854" class="img_vXGZ"></p><p>希望接下来能够圆满收官！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183902.png" alt="Pasted image 20231218183902" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218183921.png" alt="Pasted image 20231218183921" class="img_vXGZ"></p><p>《中二》
![<!-- -->[af8214e62810b843847dd16c4f8f0a.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="32-林芝到巴宜">32 林芝到巴宜<a class="hash-link" href="#32-林芝到巴宜" title="标题的直接链接">​</a></h3><p>林芝镇到巴宜区，18公里，一小时，海拔3900不变，主要是为和队友汇合顺便在巴宜这个西藏第二大城市修整一日。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184138.png" alt="Pasted image 20231218184138" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184147.png" alt="Pasted image 20231218184147" class="img_vXGZ"></p><p>确实气派，真地有城市的感觉，各大服务设施都应有尽有，还有非常专业的951车行（主做捷安特）给我车子做了全身检查、维修与使用指点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184209.png" alt="Pasted image 20231218184209" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184220.png" alt="Pasted image 20231218184220" class="img_vXGZ"></p><p>晚上回来的路上，望着路上的霓虹，我竟然第一次有了一种彷徨的感觉，可能是这个月来见证了太多的荒凉、与破败，所以面对这明珠般偌大的城市区，深感来之不易，但这就是这座城市的使命了，它将继续或艰难或繁荣地发展下去。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184226.png" alt="Pasted image 20231218184226" class="img_vXGZ"><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184231.png" alt="Pasted image 20231218184231" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184236.png" alt="Pasted image 20231218184236" class="img_vXGZ"></p><p>最后，由于在鲁朗遍地石锅鸡，攻略上又推荐我们客栈无限管饱的石锅鸡，所以还是剁手一试，吃下来怎么说呢，石锅鸡石锅鸡，石锅是精髓，汤底是精华，但鸡嘛……说实话，鸡是一般般的，就是普通的土鸡，我感觉汤味未能完全融入肉呢，肉也不够酥软可口，总体来顺还行，就是价格不是那么亲民，尤其是就我一个人吃……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184202.png" alt="Pasted image 20231218184202" class="img_vXGZ"></p><p>林芝加油！</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="33-巴宜到工布江达日照南迦巴瓦峰的时刻">33 巴宜到工布江达：日照南迦巴瓦峰的时刻<a class="hash-link" href="#33-巴宜到工布江达日照南迦巴瓦峰的时刻" title="标题的直接链接">​</a></h3><p>巴宜到工布江达，里程130，海拔2900到3300，早9点到晚7点。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184530.png" alt="Pasted image 20231218184530" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184437.png" alt="Pasted image 20231218184437" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184424.png" alt="Pasted image 20231218184424" class="img_vXGZ"></p><p>今早起床就看到日照小金山。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184331.png" alt="Pasted image 20231218184331" class="img_vXGZ"></p><p>中午又遇到了当时觉巴山的队伍。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184409.png" alt="Pasted image 20231218184409" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184454.png" alt="Pasted image 20231218184454" class="img_vXGZ"></p><p>下午发现林拉公路真地好看。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184430.png" alt="Pasted image 20231218184430" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184419.png" alt="Pasted image 20231218184419" class="img_vXGZ"></p><p>晚上还在等四天哥（今天要骑200公里，还在摸夜翻山……），希望他能平安到达。</p><p>四天哥真地太牛逼了，至少60多斤的驮包干了200公里，中途直接跟着公路车轻骑地跑，而且他今天简直是幸运星，早上7点半看到了南迦巴瓦峰（晚一小时就没了），然后全天没碰到雨，而我中午碰到多次小雨，傍晚碰到雷阵雨鞋子又湿了。。。
![<!-- -->[6c745a644a5ffa399585da49dbac46.mp4]<!-- -->]</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="34-工布江达到松多">34 工布江达到松多<a class="hash-link" href="#34-工布江达到松多" title="标题的直接链接">​</a></h3><p>工布江达到松多，里程100，海拔3200到4400，早9点半到晚8点，手疼，腿疼，肩疼，困，但追逐夕阳的日子将被铭记。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184758.png" alt="Pasted image 20231218184758" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184803.png" alt="Pasted image 20231218184803" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184813.png" alt="Pasted image 20231218184813" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184827.png" alt="Pasted image 20231218184827" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184835.png" alt="Pasted image 20231218184835" class="img_vXGZ"></p><p>勿忘历史，吾辈自强！
征途漫漫，唯有奋斗！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184818.png" alt="Pasted image 20231218184818" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218184808.png" alt="Pasted image 20231218184808" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="35-松多到墨竹工卡登顶最后一座大山">35 松多到墨竹工卡：登顶最后一座大山<a class="hash-link" href="#35-松多到墨竹工卡登顶最后一座大山" title="标题的直接链接">​</a></h3><p>松多到墨竹工卡，里程110，海拔4200到5000到3700，早上8点半到晚上8点半。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185100.png" alt="Pasted image 20231218185100" class="img_vXGZ"></p><p>今天早晨先爬12公里缓坡甚是轻松，接着是17公里陡坡，可能今天状态较好，压力不大。但是呢，由于前两天作死骑了路边的野道，外胎被一个鱼钩戳中却浑然不知，导致今天换了两次胎，补了两次胎，多亏了经验丰富的四天哥，不然今天可就难了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185042.png" alt="Pasted image 20231218185042" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185047.png" alt="Pasted image 20231218185047" class="img_vXGZ"></p><p>登顶垭口之前虽然有一阵中雨不过很快就停了，说实话那顿雨还是很难受的，因为海拔高雨很冷，但我内心还是想着如果只是这样级别的雨我会很失望的。所以到了垭口后我止不住内心的躁动，就想一股脑往上爬，穿过经幡，一直往上，到了米拉山山顶，看到了在垭口看不到的风景。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185135.png" alt="Pasted image 20231218185135" class="img_vXGZ"></p><p>我应该是唯一一位从米拉山垭口爬到山顶的
这里，是川藏线上离天最近的地方
来之前我就说作为最后一座山不来点暴风雨/雪怎么对得起我？
果然下山就遇到了冰雹！
至此，十四座高山完美谢幕
此行再无遗憾
此后再无高山
![<!-- -->[51565a65940cf1d749847e918a6522 1.mp4]<!-- -->]</p><p>可是立即就开始下雨了，于是我赶紧往山下撤，结果越下越大，并且直接转成了冰雹，还好下坡也就几百米没有大碍。在服务站躲了一会冰雹后，发现外面直接变成了冰天雪地，原先或绿或黄的山坡直接银装素裹，那感觉简直奇迹！攻略上说不要在垭口停留太久大概就是怕这种多变的天气吧，然而我和四天哥恰恰是那种无畏变化，拥抱变化的性格，这次垭口之旅，大饱眼福！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185124.png" alt="Pasted image 20231218185124" class="img_vXGZ"></p><p>哦对了，爬山过程中，四天哥因为给两辆藏族车的孩子们散糖，所以我们和孩子们很快玩成了一片，也算是今天旅途上一段值得回忆的事了。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185117.png" alt="Pasted image 20231218185117" class="img_vXGZ"></p><p>下午往墨竹工卡赶的路上，由于天气好，又是缓长下坡，所以一路心情极度舒畅，骑了一个月了，没有哪一天像今天这样骑的爽的，所以我蹬地飞快，拍了无数的云、建筑和风土人情，给我最大的感受却是拉萨的高压电塔实在太多了！中国对拉萨的重视，光高压线塔，便可见一斑！
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185107.png" alt="Pasted image 20231218185107" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185112.png" alt="Pasted image 20231218185112" class="img_vXGZ"></p><p>最后，明天就到拉萨啦~</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="36-墨竹工卡到拉萨">36 墨竹工卡到拉萨<a class="hash-link" href="#36-墨竹工卡到拉萨" title="标题的直接链接">​</a></h3><p>墨竹工卡到拉萨，75公里平路，早上10点到下午5点。</p><p>今早由于等雨，和墨竹的客栈老板多聊了几句，昨天我们找了六七家客栈宾馆酒店，就他家实惠些，老板是个老党员，52年生的，却以为自己还是68岁，毕竟按我们地区虚岁算都已经70了。我注意到他打开抖音后认真听完了第一个推荐视频，是关于养老的十个建议，我问他孩子们现在都在哪，他说北京上海成都，我问他养生心得，他说不生气不动怒平常多喝茶。他还跟我们深情地讲到“我们这一代人，生在红旗下，长于困难中……”
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185745.png" alt="Pasted image 20231218185745" class="img_vXGZ"></p><p>这句话我路上想了好久好久，还没想通呢，就下起了暴雨，躲在林拉公路桥墩下，瑟瑟发抖，上一次这么狼狈还是路遇特大冰雹的时候……躲了一会，队友过去了，也不见雨停迹象，就索性把所有衣服加上，冲出雨阵，后来雨越来越小，直到阳光洒满大地，所以我严重怀疑，杀出去不会死，呆在原地才会死。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185800.png" alt="Pasted image 20231218185800" class="img_vXGZ"></p><p>到达孜后，离拉萨还剩20公里，我脑海里一直在想我该骑快点还是骑慢点，因为一般有两种人，一种越到结尾越快一种则越到结尾越慢。我好像既非前者，又非后者。我在达孜穿梭的时候很快，直接站起来踩的，因为我想让这些市民们看到，我们骑行者的最佳精神风貌。但出了市区后，我又慢了下来，因为骑一米少一米，我耐心地拍着香嘎特大桥的延时风景，却不知我队友早已到了布宫广场……
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185825.png" alt="Pasted image 20231218185825" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185828.png" alt="Pasted image 20231218185828" class="img_vXGZ"></p><p>最终，不出我所料，到了拉萨，也看到了布宫，没有流泪，激动甚至都谈不上，我只是静默地注视着它，沿着布宫马路骑了完整一圈，然后便离去奔赴今日的客栈。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185840.png" alt="Pasted image 20231218185840" class="img_vXGZ">
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185856.png" alt="Pasted image 20231218185856" class="img_vXGZ"></p><p>故事就是这样，南川的川藏线一期之旅历时36天，实际骑行28天左右，翻越14座高山，跨越四条大江，摔过两次车，遇见了一些人，听到了许些故事，也更深地认识了自己，而做出这个决定只花了一晚上。
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218185902.png" alt="Pasted image 20231218185902" class="img_vXGZ"></p><p>下一站何方？
![<!-- -->[e6ae7791ed4cdc861c69413fa8daa4.mp4]<!-- -->]
<img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/Pasted%20image%2020231218190044.png" alt="Pasted image 20231218190044" class="img_vXGZ"></p><p>我也未能确定。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[当我想做一款吹羽毛小游戏……]]></title>
            <link>https://markshawn2020.github.io/blog/2023/09/25/当我想做一款吹羽毛小游戏……</link>
            <guid>/2023/09/25/当我想做一款吹羽毛小游戏……</guid>
            <pubDate>Mon, 25 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[logo]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/logo.png" alt="logo" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>最近在B站有一款「李佳琦吹羽毛」的游戏非常火，我也去详细看了，觉得脑洞大开，非常有趣。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/41jq3t.jpg" alt="image-20230925090726811" class="img_vXGZ"></p><p>无奈该款游戏UP主由于框架选型原因只有pc版的，很不方便。</p><p>考虑到我很喜欢基于 React 做些网页端随时可用的工具，因此打算也试着实现一番，其中诞生了一些思考与经验，特此分享一下。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="目标设计">目标设计<a class="hash-link" href="#目标设计" title="标题的直接链接">​</a></h2><p>按照 UP 主的设计，目标是一款 2D 游戏，里面有游戏状态区、玩家、天空（一排花西子眉笔），和道具（分羽毛和金币）两种，以及一些其他的模型与动画效果，比如吹的时候会有气流等。</p><p>值得注意的是，羽毛在默认情况下，会缓慢降落，目测是固定的速度，这说明我们不需要基于重力系统实现这款游戏，这也是我们第一版实现的时候采取的方案，但是有个缺点，那就是依旧要处理羽毛被吹时的加速度变化（以看起来像是真地被吹了一样）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v1-梦开始的地方">V1 梦开始的地方<a class="hash-link" href="#v1-梦开始的地方" title="标题的直接链接">​</a></h3><p>我们一开始是手写了这样的加速度变化，具体而言，我们首先给定每片羽毛的初始速度为比如说 0.3，然后一旦以力 F 吹了之后，速度变为 0.3 - F （比如说 -0.2，这样就反方向运动了），接着再在每一个 tick 不断回升其速度到原始速度，这样就模拟出了一个抛物增速的效果。</p><p>这是在纯手动实现上唯一一个比较细节的点，其他就还好了。就这样，我们很快设计出了第一版有加减速的版本。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/9f5ych.png" alt="IMG_2928" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v2-伟大但失败的多人混战模型">V2 伟大但失败的多人混战模型<a class="hash-link" href="#v2-伟大但失败的多人混战模型" title="标题的直接链接">​</a></h3><p>当然，以上的游戏设计还远不能让我们感到满意，倒不是 UI 层面，而是逻辑层面，觉得太简单了。其实如果细心的话可以看到，我们的第一版就和 UP 主的设计不一样，区别在于没有了花西子眉笔，这样就没有了羽毛撞到花西子眉笔变成花西币的机制了，只能玩家之间互相吹来吹去，因此需要做多人在线。</p><p>此时，我心中一个大型多人在线的想法萌动了出来，既然大家只需要把羽毛吹来吹去，那其实人数（在带宽允许的情况下）可以无限多，我们只需要所有人等分一个圆即可！</p><p>于是，一个自觉天才的想法就诞生了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/4gajx6.png" alt="35da072b4f37e1f4cf43376ee9636e9d" class="img_vXGZ"></p><p>上述模型可以分成服务端和客户端两部分，其中服务端是个圆的世界模型，所有用户均匀分散在圆环上，而客户端（也就是用户界面）上是一个用户视角的矩形，其中下半矩形对应世界模型玩家侧的 1/N 区域，上班矩形则对应世界模型对手侧的 (N-1)/N 区域。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/dceyv4.jpg" alt="IMG_2953" class="img_vXGZ"></p><p>但由于我们时间仓促，这个模型，虽然实现了，但是有bug，就是各种角度换算啥的，其实没算明白。</p><p>结果就被我们的产品经理给砍了，因为她首先非常不同意把 UI 做成矩形，因为这是个 2D 游戏，2D游戏一般要让所有玩家看到相同的游戏界面（例如三国杀之类），这么搞，每个用户的视角不一样，一般是 3D 的做法。</p><p>其次，也会让用户误会，以为自己是 1 VS (N-1)。</p><p>其实仔细看我们的世界模型可以发现，如果我们的羽毛每次从世界中心随机方向发出，然后被玩家吹后又逆向返回，则所有的玩家平均下来其实都是 1 v 1，其中玩家数量为偶数时正好对称，为奇数时则形成环。（我一开始就考虑过这个问题，并准备设计如果玩家是偶数，则变成组队模式（因为可以正好分成两队）。）</p><p>综合分析下来确实得不偿失，我们暂时没有必要做成这样，复杂还不一定买单。</p><p>不过我们的产品经理倒也并不反对有一个圆形的世界模型，但她更建议在客户端上做成一个圆或者椭圆。而现在的矩形……虽然我觉得只是曲率的区别……</p><p>我甚至想过给用户提供一个一键切换 UI 模式的按钮，让用户可以在矩形 UI 与圆形 UI 之间切换，但必须承认，这确实是偏技术角度的思考，矩形 UI 真地有很大的问题。</p><p>我自己举个觉得别扭的地方吧，我们刚刚说了矩形上下区域对应的世界模型面积是不一样的（ 1 : n-1 ），这导致一个什么问题呢？如果我们的程序运行无误，在多人模式下，羽毛从自己这边飞过“楚河汉界”（也就是世界中心）后，羽毛会瞬间变小为 1/(n-1)，并且会产生 x 轴的 shift，因为比例被压缩了，我觉得这是体验很不好的。</p><p>最后考虑到时间成本，我们暂时先搁置了换算 bug，开始 V3 的计划。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v3-只要肯放弃万事无难事">V3 只要肯放弃，万事无难事<a class="hash-link" href="#v3-只要肯放弃万事无难事" title="标题的直接链接">​</a></h3><p>在产品经理的耳提面命下，我们深刻地吸取了 V2 的教训，决定先完美复刻 UP 主的产品，守住初心。</p><p>于是，吭吭吭，很快，我们有了 UI 最酷炫的一版。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/hqgp8m.png" alt="IMG_3007" class="img_vXGZ"></p><p>在这一版中，我们深刻分析了游戏需要绝对位置的概念，因此自己封装了一些“游戏组件”，并且为了测试各种 <code>translate</code>，还额外加了 debug 的 UI 功能：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/vw8n25.png" alt="IMG_2988" class="img_vXGZ"></p><p>只要开启测试模式，就可以实时显示每个元素的准心与边界，非常好用。</p><p>（不过后来我在使用 phaser 时发现人家也有这种设计，并且还显示物体的速度与加速度，更专业！）</p><p>这点给我的启示，真地是，世间的智慧是相通的，比如看这个人的评论：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/dz2aoc.png" alt="947a5e4cd03b1cbd20ddeb7d023edd50" class="img_vXGZ"></p><p>ok，暂时先不扯太远，总之，如您们所见，第三版在放弃梦想之后，老老实实做单机，加入花西子口红，一切就非常顺利，甚至还有时间换上了酷炫的背景动画，以及各种马里奥的 bgm 和 特效。这一版是我最喜欢的一版，尤其是在 UIUX 上。</p><p>但是，很可惜，产品经理马上就指出了新的问题：掉帧严重！</p><p>为此，我开启了慢慢地调试与摸索之路，继而真正领会了游戏开发的奥秘。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v4-游戏开发的左手渲染引擎">V4 游戏开发的左手：渲染引擎！<a class="hash-link" href="#v4-游戏开发的左手渲染引擎" title="标题的直接链接">​</a></h3><p>经过大量的调试，我逐步排除了桩服务器、多次setState、hook memo 等可能的性能问题，查阅了大量资料，最终不得不承认，基于状态管理的 react 根本不适合作为高刷游戏的载体，仅仅是 79 个羽毛与金币，服务端 50 的 fps，客户端 UI 竟然能卡到只剩 10 fps，这绝对是无法接受的。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/rbj11v.jpg" alt="0ba6a341303b5c06f42264ad9b9221e4" class="img_vXGZ"></p><p>但同样的代码，我们使用 <code>react-three-fiber</code> （底层基于 <code>webgl</code>与<code>canvas</code>）却能完美运行，客户端 UI 少说也能稳定在 30 fps 以上！</p><p>我不相信，又做了大量的调优，最后还是不得不放弃，除非我改写整个 react 的状态刷新，比如 79 个羽毛和金币 不要用 <code>setState</code> 之类，而是自己画 <code>canvas</code> 或者用 <code>ref</code> 更新啥的，但总之，这个工作量，或者说目标实现，其实就等于重新用一套新的渲染引擎了，而这一套引擎，我重点查了一下，大致有 <code>pixijs</code> 、<code>threejs</code>、<code>phaser</code>等等。</p><p>最终，我们使用 <code>react-three-fiber</code>（ <code>threejs</code>的<code>react</code>版），完成了我们第四版的游戏设计，并在设置菜单里提供了渲染模型的切换，大家可以切换后仔细对比两种渲染引擎下的性能差异（至少 2 倍，实际是差一个数量级）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v7-游戏开发的右手游戏引擎">V7 游戏开发的右手：游戏引擎！<a class="hash-link" href="#v7-游戏开发的右手游戏引擎" title="标题的直接链接">​</a></h3><p>既然我们已经把目光从传统的 react 开发转向了渲染引擎，那么最后一步，直接使用专业的游戏引擎进一步加速研发，将成为了一个自然的选择，所谓游戏引擎，就是集成了 刷新、交互、渲染等一整套游戏逻辑，以性能、兼容性等为主要目标的框架。</p><p>我主要查看了以下资料：</p><ul><li>⚛️ React | Web Game Dev, <a href="https://www.webgamedev.com/engines-libraries/react" target="_blank" rel="noopener noreferrer">https://www.webgamedev.com/engines-libraries/react</a></li><li>React for game development? : r/reactjs, <a href="https://www.reddit.com/r/reactjs/comments/dnfld6/react_for_game_development/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/reactjs/comments/dnfld6/react_for_game_development/</a></li><li>Does it make sense to use React for canvas game GUI, that will get updated VERY frequently? : r/reactjs, <a href="https://www.reddit.com/r/reactjs/comments/14sl7fl/does_it_make_sense_to_use_react_for_canvas_game/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/reactjs/comments/14sl7fl/does_it_make_sense_to_use_react_for_canvas_game/</a></li><li>Collection: JavaScript Game Engines, <a href="https://github.com/collections/javascript-game-engines" target="_blank" rel="noopener noreferrer">https://github.com/collections/javascript-game-engines</a></li><li>Top 6 JavaScript and HTML5 game engines - LogRocket Blog, <a href="https://blog.logrocket.com/best-javascript-html5-game-engines/" target="_blank" rel="noopener noreferrer">https://blog.logrocket.com/best-javascript-html5-game-engines/</a></li><li>compare with three.js · Issue #39 · pixijs/pixijs, <a href="https://github.com/pixijs/pixijs/issues/39" target="_blank" rel="noopener noreferrer">https://github.com/pixijs/pixijs/issues/39</a></li><li>Phaser vs PixiJS for making 2D games - DEV Community, <a href="https://dev.to/ritza/phaser-vs-pixijs-for-making-2d-games-2j8c#:~:text=Phaser%20has%20more%20game%2Dspecific,organized%20for%20games%20by%20default" target="_blank" rel="noopener noreferrer">https://dev.to/ritza/phaser-vs-pixijs-for-making-2d-games-2j8c#:~:text=Phaser%20has%20more%20game%2Dspecific,organized%20for%20games%20by%20default</a>.</li></ul><p>并且在简单尝试了 star 70 多 k 的 <code>GoDot</code> 之后，觉得还是不太习惯有 UI Editor 的游戏框架，以及不太想学新的语言（GDScript）。但不排除未来会有深度研究使用 <code>GoDot</code> 的可能，毕竟它 2D、3D都支持，而且是跨端的，会基于目标输出平台决定所使用的性能，这个非常棒。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/aez70g.jpg" alt="image-20230925091822199" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/7pbkjd.jpg" alt="image-20230925092037914" class="img_vXGZ"></p><p>（好吧，其实是因为 <code>GoDot</code> 我不怎么会用，2333 ……）</p><p>而在 JS 生态里，2D 有 <code>phaser / pixi.js</code> ，3D 有 <code>three.js</code> ，目前都非常能打，所以最终选择了 <code>phaser</code>。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/zywc7c.jpg" alt="image-20230925084426852" class="img_vXGZ"></p><p><code>phaser</code> 由于经常被用于制作 rpg 游戏，所以我们也融入了一些 rpg 元素，摸索 <code>phaser</code> 也花了一定的时间，但最好的学习资料就是 <code>phaser</code> （ v3 版本）的官方案例库：</p><ul><li>photonstorm/phaser3-examples: Phaser 3 Examples, <a href="https://github.com/photonstorm/phaser3-examples" target="_blank" rel="noopener noreferrer">https://github.com/photonstorm/phaser3-examples</a></li></ul><p>它的在线 demo 做的很高端（sha bi），竟然用的是文件夹的形式，但是请相信我，每个文件夹都过一过，这绝对是最好的资料，与代码库直接对接，否则绝对都是舍近求远了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102310842.png" alt="image-20230925102310842" class="img_vXGZ"></p><p>比如我们可爱的 <code>nayuki</code> 同学，就是在 <code>/Input/Dragging</code> 里一眼相中的：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/cuz3c8.jpg" alt="image-20230925075546752" class="img_vXGZ"></p><p>然后我们游戏里吹羽毛时的龙卷风，其实本来是想直接用 <code>/Animation/Yoyo</code> 里的火焰，但是代码里是基于图像的切片实现的，火焰与角色是混在一起的，不方便切，所以就放弃了。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102348410.png" alt="image-20230925102348410" class="img_vXGZ"></p><p>最后我们是结合 ChatGPT4 自己手写了扇形蒙版动画，并精心挑选了静态龙卷风 png 组合完成：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/waxnee.jpg" alt="image-20230925075644351" class="img_vXGZ"></p><p>最终效果，就是酷炫的动态龙卷风了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/RPReplay_Final1695640188%20(2).gif" alt="RPReplay_Final1695640188 (2)" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="核心技术汇总">核心技术汇总<a class="hash-link" href="#核心技术汇总" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fps">FPS<a class="hash-link" href="#fps" title="标题的直接链接">​</a></h3><p> 帧同步主要瓶颈一般是在客户端上，因为客户端不但要处理数据更新，还要处理数据渲染，UI 与事件会抢进程，再加上与后端接口数据交互有延时，就会有明显的掉帧。</p><p>因此在网页端，几乎都是 30 FPS 左右，60 FPS 都要风扇发热了，更高（比如 90 FPS、120 FPS）就只有在设备终端本机环境、电影院等才支持了。</p><p>而在客户端向服务器获取数据上，有几种办法，除了 socket 之外，都是客户端主动向服务端发起请求的，以下给出几种办法。</p><ol><li><code>useInterval</code></li></ol><p>而在客户端，我们一开始是使用一个 <code>useInterval</code>函数，它可以每隔 N ms 刷新一次 UI，以下是我们后端小哥哥和 <code>@mantine/hooks</code>里<code>useInterval</code>写法的对比：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102451944.png" alt="image-20230925102451944" class="img_vXGZ"></p><p>对比下来，如果不涉及主动控制，确实还是我们小哥哥写的简单方便，而且由于每次都传入最新的 <code>cb</code>，因此不会有脏数据的问题。</p><ol start="2"><li>基于 <code>trpc</code></li></ol><p>可以基于 <code>referchInterval</code> 参数，自动每 N ms 获取一次数据。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFetching </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">useQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eventsId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> eventsIdRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      refetchInterval</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CONFIG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">game</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但使用 trpc 也要谨慎，有时会出现 <code>isFetching = false, data=undefined</code>的情况，这还是一个暂时留待去研究的小 bug。</p><p>除此之外，倒是问题不大。</p><ol start="3"><li>基于游戏引擎的 nextTick 机制</li></ol><p>游戏引擎里都会有一个类似 <code>init</code> 和 <code>onUpdate</code> 的机制，每个 tick 都会自动触发 <code>onUpdate</code> 函数。在这个函数里面我们可以处理数据的更新。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// update 函数里非常适合处理 Input 事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// this.tick++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// const fps = Math.round((1000 / delta) * 10) / 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// console.log({time, delta, tick: this.tick, fps})</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vw</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LEFT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">D</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RIGHT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 只要按住就会一直feedback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SPACE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lastDownTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console.log("down: ", this.lastDownTime)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SPACE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isUp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 不考虑drag了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console.log("up: ", Date.now() - this.lastDownTime)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">handleShoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lastDownTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">updatePlayerX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="socket-与-nextjs-的集成">socket 与 nextjs 的集成<a class="hash-link" href="#socket-与-nextjs-的集成" title="标题的直接链接">​</a></h3><p>多人在线玩游戏是一个看起来很简单，但实际上颇有技巧的一件事，一般都用 socket，但也有其他的方案。</p><p>这里简单说一下我们集成 <code>socket.io</code> 到 <code>nextjs</code> 里的一些要点：</p><p>首先一个非常大的坑是，<code>nextjs@13.4.12</code>环境下，<code>socket.io</code>服务器端需要额外配置<code>addTrailingSlash: false</code>，否则会自动加上 <code>/</code> 导致 api 访问出错，具体参考：<a href="https://github.com/vercel/next.js/issues/49334#issuecomment-1539268823" target="_blank" rel="noopener noreferrer">https://github.com/vercel/next.js/issues/49334#issuecomment-1539268823</a></p><p>其次，由于 <code>socket.io</code> 默认挂载在 <code>/socket.io/</code> 路径下，与 <code>nexjts</code> 默认的 api 路由并不一致，因此需要做一些处理，这里提供三种办法。</p><ol><li>显式指定 socket 挂载的路径：</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// [server] /pages/api/socket.ts </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  req</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NextApiRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NextApiResponseServerIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// console.log("Socket is already running")</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"initializing Socket.io server..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// adapt Next's net Server to http Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> httpServer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NetServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">httpServer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOCKET_IO_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      addTrailingSlash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">handleSocket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// append SocketIO server to Next.js socket server response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// [client] /lib/socket.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> socket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">socketio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 不需要添加 url，直接指定 path即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transports</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// "websocket", // 不能开 websocket，我也不知道为什么！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"polling"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这是默认的，关了后就没法用了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ref: https://stackoverflow.com/a/41953165/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOCKET_IO_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    autoConnect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>无论是客户端还是服务器端，都不指定 path，而是基于 fetch 激活服务端路由 （很多帖子里都是用的这种办法，很神奇）</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 要先唤醒一下服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/api/socket"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// no-op if the socket is already connected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"connecting"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> allEvents</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"on handler of "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"connect"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 客户端有可能都没有监听 UserJoinRoom，但是服务端我们要加，否则客户端容易bug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SocketEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserJoinRoom</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">socket</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> joined room </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">roomId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">extra</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        socketId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> IFullMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>还有一种办法，是单开一个 nodejs 服务，使用 middleware 形式启动 socket，由于我个人不是很喜欢，所以就不放了。但也是很重要的一种办法。也很直接。</li></ol><p>除了以上的一些要点之外，在 socket 的写法上也有各种办法，我是用了一个 <code>useSocketEvents</code> 统一管理需要监听的函数，注意最后要使用 <code>beforeunload</code> 的 eventListener 做清理动作，否则用户刷新浏览器，socket还活着，不符合预期。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> defaultEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// { name: "connect", handler: console.log },</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"connect_error"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"disconnect"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * ref: https://www.codeconcisely.com/posts/react-socket-io-hooks/</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useSocketEvents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extra</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">IMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"using socket events"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userImage </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> extra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> allEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">defaultEvents</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">cleanup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"disconnecting"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> allEvents</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"off handler of "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">off</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token method function property-access" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"beforeunload"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// note: important! react不会自己清除，ref: https://stackoverflow.com/a/61310052/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"beforeunload"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="游戏引擎与-reactnextjs-的集成">游戏引擎与 React/NextJS 的集成<a class="hash-link" href="#游戏引擎与-reactnextjs-的集成" title="标题的直接链接">​</a></h3><p>诚如这位老哥所言， React 可以与游戏集成，但是仅限于用于制作 UI 上，要注意与游戏的代码分离。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102547276.png" alt="image-20230925102547276" class="img_vXGZ"></p><p>我也顺利找到了将 <code>phaser</code> 与 其他集成的模板：</p><ul><li>【pahser + webpack】nodes777/phaser3-react-template: A starter template for using PhaserJS and React, <a href="https://github.com/nodes777/phaser3-react-template" target="_blank" rel="noopener noreferrer">https://github.com/nodes777/phaser3-react-template</a></li><li>【phaser + create-react-app】kevinshen56714/create-react-phaser3-app: Minimal Phaser3 + Create React App template, <a href="https://github.com/kevinshen56714/create-react-phaser3-app" target="_blank" rel="noopener noreferrer">https://github.com/kevinshen56714/create-react-phaser3-app</a></li><li>【phaser + ion-phaser】proyecto26/ion-phaser: A web component to use Phaser Framework with Angular, React, Vue, etc 🎮, <a href="https://github.com/proyecto26/ion-phaser" target="_blank" rel="noopener noreferrer">https://github.com/proyecto26/ion-phaser</a></li><li>【phaser + nexjts】 isrmicha/nextjs-phaser: NextJs Phaser Starter Template, <a href="https://github.com/isrmicha/nextjs-phaser" target="_blank" rel="noopener noreferrer">https://github.com/isrmicha/nextjs-phaser</a></li></ul><p>我个人比较喜欢 <code>nextjs</code>，因此基于最后的改了改，其实核心要领，就是要用 <code>dynamic</code> 组件，因为 <code>phaser</code> 不支持 <code>ssr</code>，否则会甚至有 <code>HTMLVideoElement is not defined</code> 的问题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="力导向">力导向<a class="hash-link" href="#力导向" title="标题的直接链接">​</a></h3><p>在 <code>phaser</code> 中提供了几个关于 <code>applyForce</code> 相关的函数，都是基于 <code>matter.js</code> 的。</p><p>主要有三个 API，都在 <code>Phaser.Physics.Matter.MatterPhysics</code> 下，参考：<a href="https://newdocs.phaser.io/docs/3.54.0/Phaser.Physics.Matter.MatterPhysics#applyForceFromAngle" target="_blank" rel="noopener noreferrer">https://newdocs.phaser.io/docs/3.54.0/Phaser.Physics.Matter.MatterPhysics#applyForceFromAngle</a></p><ul><li><code>applyForce(bodies, force)</code>: Applies a force to a body, at the bodies current position, including resulting torque.</li><li><code>applyForceFromPosition(bodies, position, speed, [angle])</code>: <ul><li>Applies a force to a body, from the given world position, including resulting torque. If no angle is given, the current body angle is used.</li><li>Use very small speed values, such as 0.1, depending on the mass and required velocity.</li><li>注意这里的 <code>position</code> 是摄像机里的目标位置，而非平面坐标位置，关于这个，调了很久！</li></ul></li><li><code>applyForceFromAngle(bodies, speed, [angle])</code>: <ul><li>Apply a force to a body based on the given angle and speed. If no angle is given, the current body angle is used.</li><li>Use very small speed values, such as 0.1, depending on the mass and required velocity.</li></ul></li></ul><p>我很想给大家画点示意图，因为官网的文档给的并不详细，并给出多种力导向的做法，比如生成一个 matter body，或者生成虚拟的形状，这两种各有利弊，但此处限于篇幅，暂时就不赘述了把！</p><p>目前我们是使用了基于点位置的扇形力导向，但其实也很方便做多种导向（类比 moba 游戏的英雄技能！）。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="微信小游戏">微信小游戏<a class="hash-link" href="#微信小游戏" title="标题的直接链接">​</a></h3><p>我们本来想要做微信小游戏的，结果需要至少一个月的审核，并且还需要软著，觉得没必要，就没搞了。。。</p><ul><li>(16)小游戏渲染 | 微信开放社区, <a href="https://developers.weixin.qq.com/community/develop/doc/000e0e01990300540807830c951009" target="_blank" rel="noopener noreferrer">https://developers.weixin.qq.com/community/develop/doc/000e0e01990300540807830c951009</a></li><li>小程序资质审核, <a href="https://mp.weixin.qq.com/wxamp/frame/pluginRedirect/pluginRedirect?title=&amp;action=plugin_redirect&amp;token=445115645&amp;lang=zh_CN&amp;plugin_uin=1031&amp;custom=isApplyPayPc%3Dfalse" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/wxamp/frame/pluginRedirect/pluginRedirect?title=&amp;action=plugin_redirect&amp;token=445115645&amp;lang=zh_CN&amp;plugin_uin=1031&amp;custom=isApplyPayPc%3Dfalse</a></li><li>个人开发者的游戏自审自查报告是否按照官方的截图，打印出来后签名，然后拍照即可？ | 微信开放社区, <a href="https://developers.weixin.qq.com/community/develop/doc/0000026f4c4548ca35198fbd851800" target="_blank" rel="noopener noreferrer">https://developers.weixin.qq.com/community/develop/doc/0000026f4c4548ca35198fbd851800</a></li><li>※※申请软著标本&amp;小游戏提交的技巧※※ - 非技术 - Cocos中文社区, <a href="https://forum.cocos.org/t/topic/69267" target="_blank" rel="noopener noreferrer">https://forum.cocos.org/t/topic/69267</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="jsreact-相关游戏资源教程">JS/React 相关游戏资源、教程<a class="hash-link" href="#jsreact-相关游戏资源教程" title="标题的直接链接">​</a></h3><p>强推一款需要 64 G 内存的超大型多人在线沙盒游戏，基于 nextjs + webgl + webAssembly 的：Biomes — Join the community shaping a new world, <a href="https://www.biomes.gg/" target="_blank" rel="noopener noreferrer">https://www.biomes.gg/</a></p><ul><li>Games - React.js Examples, <a href="https://reactjsexample.com/tag/games/" target="_blank" rel="noopener noreferrer">https://reactjsexample.com/tag/games/</a></li><li>Building Steam Games with React — Syntax Podcast 176, <a href="https://syntax.fm/show/176/building-steam-games-with-react" target="_blank" rel="noopener noreferrer">https://syntax.fm/show/176/building-steam-games-with-react</a></li><li>Building a Game with Three.js, React and WebGL — SitePoint, <a href="https://www.sitepoint.com/building-a-game-reactjs-and-webgl/" target="_blank" rel="noopener noreferrer">https://www.sitepoint.com/building-a-game-reactjs-and-webgl/</a></li><li>Mario Jump, <a href="https://mariojumpp.vercel.app/" target="_blank" rel="noopener noreferrer">https://mariojumpp.vercel.app/</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后">最后<a class="hash-link" href="#最后" title="标题的直接链接">​</a></h2><p>哈哈哈，本来以为两小时就能搞定的小游戏，没想到扯出这么多犊子，哈哈哈哈，真地没谁了！</p><p>有兴趣的朋友可以一起开发 V7 吹羽毛呀。（或者不会写代码，去点个赞也可以啊 👀 ）</p><ul><li><p>V2 （实验版本。基于 <code>socket.io</code>，多人世界模型）</p></li><li><p>V4 （这个版本完成度最高。基于 <code>react-three-fiber</code>，未来有 3D 渲染/游戏的需求，这个 library 是首选）</p><ul><li><p>开发地址：<a href="https://github.com/cs-magic/feather-v4" target="_blank" rel="noopener noreferrer">https://github.com/cs-magic/feather-v4</a></p></li><li><p>体验网址: <a href="https://f4.cs-magic.cn" target="_blank" rel="noopener noreferrer">https://f4.cs-magic.cn</a></p></li></ul></li><li><p>V7 （目前的主力版本。基于 <code>phaser</code>，目前对这个更感兴趣，因为接下来想借助 <code>phaser</code> 做一些基于 AIGC 的 2D RPG 游戏）</p><ul><li><p>开发地址：<a href="https://github.com/cs-magic/feather-v7" target="_blank" rel="noopener noreferrer">https://github.com/cs-magic/feather-v7</a></p></li><li><p>体验网址: <a href="https://f7.cs-magic.cn" target="_blank" rel="noopener noreferrer">https://f7.cs-magic.cn</a></p></li></ul></li></ul><p>以上！我们下次再见！</p><p><strong>但愿我们每个人都能加薪！</strong></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Poketto.AI: 每一个人的哆啦A梦]]></title>
            <link>https://markshawn2020.github.io/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦</link>
            <guid>/2023/08/31/Poketto.AI 每一个人的哆啦A梦</guid>
            <pubDate>Thu, 31 Aug 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[Hi，这是一封来自 Poketto.AI 团队的邀请信。]]></description>
            <content:encoded><![CDATA[<p>Hi，这是一封来自 Poketto.AI 团队的邀请信。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pokettoai-是什么">Poketto.AI 是什么<a class="hash-link" href="#pokettoai-是什么" title="标题的直接链接">​</a></h2><p>近年来，互联网产品逐渐轻量化：桌面端/网页端 --&gt; 移动端 --&gt; 小程序 --&gt; ?。绝大多数人认为小程序已经是最轻量的代表，但实质上它仍然需要很高的开发门槛，而这个事情，在 AIGC 的元年发生了质的变化：</p><blockquote><p>得益于大语言模型的“涌现智慧”，从来没有哪一刻能像此刻一样让每一个人离知识的距离如此之近，从来没有那一天能像今天一样让每一个人都可以基于自己的领域开发属于自己的工具流。</p></blockquote><p>这不禁让我想到了哆啦A梦的四次元口袋（它的罗马文：<strong>Poketto</strong>），因为它足够的强大，而又足够的轻量，非常适合作为“小XX”的下一个接力棒：</p><p><img loading="lazy" src="https://files.mdnice.com/user/575/ead77448-6f17-4c52-a48e-9126469919cb.png" class="img_vXGZ"></p><blockquote><p>在孩提时代，有多少人想拥有一位哆啦A梦。</p><p>而在成人后，还有多少人能记着年少时的那种浪漫。</p></blockquote><p>当然，市面上已经有着众多 AIGC 相关的产品，不过它们的质量良莠不齐，筛选成本很高，尤其是在 C 端上完全达不成统一，基于这样的认识，我们迫切希望看到一款赋能大众、兼容百家、用户友好的产品出现，它应该至少有以下特性：</p><ul><li>稳定可靠。我们需要能够便利地、高速地访问与获取我们心中问题的答案，它不应该是被阻碍的、被伪装的以及被篡改的。</li><li>丰富实用。目前 AIGC 仍然处于早期阶段，尽管各垂类都已经诞生了各种产品，但它们也高度依赖底层的生成式模型、技术的发展，变局始终存在。因此，它应该尽可能能让大众接触到足够多（同时也足够好）的相关平台、产品，不应是闭塞的、花哨的以及止步的。</li><li>用户友好。作为一款知识导向的互联网产品，沉浸式的体验应该是 come first 的，试想一下我们在图书馆学习的时候一定不希望被打扰。因此，它应该是安静的、克制的、UI友好的。</li><li>……</li></ul><p>即便是这样的目标，我们在市面上物色许久之后仍然不满意，而在研究了大量的产品、调研了各类技术栈、平衡了各项成本之后，我们 Poketto.AI 团队于8月11日起决心自己做一款，于是您们看熬了这样一个小小的社区：</p><ul><li>技术上，我们采纳了 <code>nextjs + prisma + trpc + radix-ui + tailwindcss</code> 的全栈框架，能让我们高速稳定地迭代，并且提供出色的页面访问速度与一线的友好UI。</li><li>模式上，我们以社区作为主要载体，以各大主流平台作为我们的内容提供商，包括但不限于优秀的 prompt 社区 flowgpt（已完美对接）、支持 prompt 优化的 jina.ai （正在对接）、来自清华一度霸榜开源大语言模型评分的 openchat（正在对接）等。</li><li>用户体验上，我们支持基于中英双语的内容分流、支持亮暗的双色模式、支持全局快捷键（⌘ + K）、支持一键全屏聊天、支持基于向量数据库搜索的永久记忆模式、支持原子化分享（用户、内容、记录切片，以及API账号！）、集成了国际流行的支付公司 stripe……总之，该有的我们都有，不该有的，我们可能也会有！</li><li>……</li></ul><p>而从今天开始，Poketto.AI 将正式开放给所有人。</p><p>xx</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pokettoai-怎么用">Poketto.AI 怎么用<a class="hash-link" href="#pokettoai-怎么用" title="标题的直接链接">​</a></h2><p>在架构设计上，我们采用了海内外双域名：</p><ul><li>国内：poketto.cs-magic.cn</li><li>国外：poketto.ai</li></ul><p>它们的区别如下：</p><table><thead><tr><th></th><th>Poketto.ai</th><th>poketto.cs-magic.cn</th></tr></thead><tbody><tr><td>服务器所在地</td><td>海外</td><td>大陆</td></tr><tr><td>访问速度</td><td>国内较慢，国际较快</td><td>国内较快，国际较慢</td></tr><tr><td>性能体验</td><td>稳定、最快（基于 edge）</td><td>稳定、还行（基于node）</td></tr><tr><td>限制</td><td>无</td><td>存在少量非功能性限制</td></tr><tr><td>登录方式</td><td>目前支持邮箱、Github、Discord等 OAuth 手段</td><td>目前只支持邮箱 OAuth</td></tr></tbody></table><p>大家可以根据自己的偏好自主选择使用，值得注意的是：<strong>彼此账号、数据库是独立的</strong>。</p><p>xx</p><p>由于采用 OAuth 技术，以邮箱登录为例，在输入邮箱之后，poketto 会往您的邮箱发送一封登录邮件，您只需要点击该邮件内的跳转按钮，将会自动在默认浏览器内打开 poketto，并可以使用。</p><p>xx</p><p>值得注意的是，这个过程是自动的，因此如果您想控制在特定浏览器内登录，请复制邮件内底部的链接，然后在目标浏览器打开即可。</p><blockquote><p>Q: 为什么搞这么复杂？</p><p>A: 其实并不负责，只不过国内不怎么习惯，未来可能会退出传统的密码登录手段。</p></blockquote><p>在登录成功之后，您会默认拥有/已安装一个 App 叫 <code>Your Sole Poketto</code>，您可以直接与它进行聊天，它拥有一定的“特异功能”，我们后期的许多产品特性也会基于它展开。</p><p>xx</p><p>同时您还可以安装很多其他平台（目前包括 flowgpt 等）的 App ：</p><p>xx</p><p>在桌面端，您只需按住 <code>⌘ + K</code>键，即可立即召唤出快捷搜索窗，高速开始对话：</p><p>xx</p><p>更多精彩等您探索！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="我们还会做什么">我们还会做什么<a class="hash-link" href="#我们还会做什么" title="标题的直接链接">​</a></h2><p>这只是一个开始。</p><p>Poketto.AI 开发到到现在也才不到一个月，因此可能存在一定的bug，以及还有大量的新需求想要实现，希望每个阶段都能给大家带来惊喜！之后我们的代码也会开源，如果您是一名技术爱好者或是社区爱好者或是AIGC爱好者，可以加入我们，与我们一起，为人类思想的价值而战！</p><p>最后，快进入“Poketto.AI”，体验您的专属 Poketto 吧，分享本文到三个群，将可赠送 Poketto 通用货币100 Dora ～</p><p>Poketto 内测群：xx</p><blockquote><p>AIGC 时代，愿人人都是魔法师，愿人人都能拥有一个哆啦A梦！</p></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[this-year]]></title>
            <link>https://markshawn2020.github.io/blog/2022/12/31/this-year</link>
            <guid>/2022/12/31/this-year</guid>
            <pubDate>Sat, 31 Dec 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[不是intro的intro]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="不是intro的intro">不是intro的intro<a class="hash-link" href="#不是intro的intro" title="标题的直接链接">​</a></h2><p>我看杨振宁在一次关于世界上是否有神的访谈上提到了自己不同年龄段的认知，他认为年轻时是更自信的，所以不相信世界上有神，并且相信自己能回答能证明这个问题。但随着阅历的增加，他开始相信是有的，当然不是一个人形的，因为宇宙的秩序绝非偶然，这必然是一个造物者得意的杰作。</p><p>我想借杨老的例子作为本次文章的开头，没有什么其他用意，我只是同样隐约觉得，有些东西，不可言不可知，或者言之如鸡肋，渐渐地便没了那么心气，也就不再那么地“自信”了。</p><p>今年以来，光怪陆离之事不可谓不多，但每当这个时候，我都会下意识地让自己缓一缓，须知，历史从没有新鲜事。所以这又得以让我以平常心去看待发生的这一切，这样的一种心态与视角提供给我的是一个横向的、更宏观的画卷。而如果将自己的成长经历再糅合进去，仔细地将过往的每一笔细细梳理，则又提供了一个纵向的、更深厚的图景。</p><p>我们就是每天观着这巨大的、宏观的、深厚的图景，不断地、日复一日地生活着，同时也时时刻刻地为这巨大的、宏观的、深厚的图景勾勒上新的内容，构成一个瑰丽奇伟的马尔科夫场。</p><p>问题是，如果把我们生命的客观存在与世界的客观羁绊当做该马尔科夫场的数据部分，我们该构建怎样的算法策略以帮助我们更好地决策当下。</p><p>这显然是一个 too big to think 的问题。</p><p>在有限的过往里，我大概搜集了有这么些种算法策略：</p><ol><li>在不确定的世界里努力维持自己内心的秩序</li><li></li></ol><h1>[09-24-rental-agency]</h1><h1>[10-03-facing-life]</h1><h1>[10-08-live-with-dust]<!-- --> 隐入尘烟，亦或和光同尘</h1><h2 class="anchor anchorWithStickyNavbar_rB0w" id="白衬衫形象与其他">白衬衫、形象与其他<a class="hash-link" href="#白衬衫形象与其他" title="标题的直接链接">​</a></h2><p>这几年特别喜欢穿白衬衫，可能是自己对清爽型男生形象的一次尝试，不过这个试验，于上个月彻底宣布失败了。数件白衬衫，没有一件是干净的，并且已经超出了自动洗衣机能清洗的范畴，这不禁让我感到眉头一皱。我把他们撂在一角，头疼是该直接扔掉还是再抢救一下，但在我写这段文字仔细思考这个问题时，我明白，它们的宿命大抵就是，等我搬家的时候再被我扔掉，在那之前，那就只会是静静地呆在那一角，这不禁是对我这几年追求行动力的一大讽刺。</p><p>人为什么会迷恋于白衬衫呢？这大抵是对一种所谓“干净”的追求。但什么人才会追求“干净”呢，有些人可能是出于习惯，有些人则可能是出于掩饰。这不禁让我想起前段时间吴亦凡在追求女生时那么刻意强调对方是不是第一次的问题，并那般理直气壮地说男生是不存在第一次之说的，不知道其他男同胞是怎么想的，我只觉得再次向看到那些白衣服上的污渍一样眉头一皱。不过细想，吴亦凡倒也不是在这方面双标的极致代表，毕竟吴亦凡至少在颜值、身材上是和女方对等的，但就是还有人一没外表，二没身材，甚至自己还不是处男，却要求对方这些都具备的。这也无怪乎现在凡是有钱或有名或有权的男的，都动辄找比自己小十几岁的，甚至二十几、三十几、……的。</p><p>这对于尚处在二十出头，或即将三十而立的男同胞而言不可谓最生动的人生规划教程：如果我们将自己与求偶对象的年龄差，当做一个目标函数K，那么这个K越大，就隐含着自己能力越强的意思。所以，你的K是几呢？这是一。其次，假如你现在没有求偶对象，然后锚定女方普遍求偶年龄25来算的话，则自己当前的年龄减去锚定年龄得到i，那么i/K就是自己的求偶进度，你现在的进度又是多少呢？再者，如果你觉得以你的能力确能保证K&gt;=10这样一个较高的值，然后假如说，你现在的i=2，那也就是说你还有至少8年的时间去沉淀，你是否一下就跳出了35岁焦虑呢？毕竟我一直强调，一个人往往高估一年能做的事，而低估十年能做的事。</p><p>所以我现在真地不焦虑，虽然这听起来似乎是我对自己很自信一样。诚然，自信还是要有的，但更多的是，我坚信作为男人，就应该不急不缓。比起踏着节拍循规蹈矩，男人还是以发展自己的核心竞争力最为重要。尽管这在很多人眼里，尤其是优秀的同龄人眼里看来：<strong>You are too slow</strong>。是，但这真是没办法的事，毕竟坐在火箭上、坐在电梯上，与爬楼梯的人，他们的速度确实是不一样的。人与人之间的差距并不一定小于天与地，但这不影响我们同处在一片天下、一片地上，尽管也许转个眼，我便看不见你了，或者，你便看不见我了。如是。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="疫情迷失">疫情，迷失<a class="hash-link" href="#疫情迷失" title="标题的直接链接">​</a></h2><h1>[11-29-white-paper-revolution]<!-- --> 关于十一月白纸运动的认识与反思</h1><h1>[12-31-this-year]<!-- --> 今年</h1><blockquote><p>每段用「今年」开头，回顾各个方面的成长。</p></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[代码有所能，有所不能]]></title>
            <link>https://markshawn2020.github.io/blog/2022/08/29/coding-cries</link>
            <guid>/2022/08/29/coding-cries</guid>
            <pubDate>Mon, 29 Aug 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[S1: 封面]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="s1-封面">S1: 封面<a class="hash-link" href="#s1-封面" title="标题的直接链接">​</a></h2><p>大家好，很高兴受邀《美丽中国》接力演讲项目，我是第63位演讲者南川，我的主题是《代码有所能，有所不能》。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s2-作者简介">S2: 作者简介<a class="hash-link" href="#s2-作者简介" title="标题的直接链接">​</a></h2><p>这是我的一些基本介绍。</p><p>众所周知，自18世纪以来，人类目前已有三次工业革命，其中<sup id="fnref-第三次工业革命-c673c0"><a href="#fn-第三次工业革命-c673c0" class="footnote-ref">第三次工业革命</a></sup>也称之为信息革命，而随着个人电脑、手机的普及，这场革命目前也已经渗透到了我们每个人的方方面面，例如微信就已经成为国内社交无法剥离的关键应用，而这些都可以归功于代码的“能”（Capability）。</p><p>但类似微信这样的软件在方便我们自身的同时，也对我们做了诸多的限制；或者当你有一些需求在市面上找不到的时候，你可能会希望像稚晖君、手工耿一样自己动手把它实现出来。尽管有时候会有一定的门槛，但能显著提升生活的一些体验，我一般称之为：<strong>对生活的控制感</strong>。</p><p>以下就来简单谈谈我在实际生活中碰到的一些需要用代码提高生活控制感的场景，主要分两个大类，第一类是关于个人生活的，第二类是关于公共生活的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s3-针对个人生活的项目一微信聊天记录捕获与分析">S3: 针对个人生活的项目一：微信聊天记录捕获与分析<a class="hash-link" href="#s3-针对个人生活的项目一微信聊天记录捕获与分析" title="标题的直接链接">​</a></h2><blockquote><p>项目地址：<a href="https://github.com/m-archive/wechat-dbcracker" target="_blank" rel="noopener noreferrer">https://github.com/m-archive/wechat-dbcracker</a></p></blockquote><p>下面来看看第一个场景，微信聊天记录的捕获与分析。</p><p>这个项目需要用到的一些技术包括网络通信劫持、客户端函数注入、加密数据库破解等。</p><p>首先我们基于 MacOS 预装 <code>dtrace</code> 脚本去捕获 PC 端微信的启动与数据库加载，获得所有数据库的文件地址与秘钥，继而使用 <code>sqlchipher</code> 进行解密，从而能够自由访问 PC 端微信所有数据库的内容，包括好友、群组、聊天记录等信息，再基于对微信数据库设计的研究，从而写出一套供自己使用的 SDK，并封装成 app 形式，这样就可以非常方便地对微信数据进行备份、管理与transform，比如生成和微信官方界面一模一样的聊天记录截图，或者网页形式等。在某些特定的场合，例如刑事诉讼的微信材料取证方面也有一定用途。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s4-针对个人生活的项目二微信之电影拼图">S4: 针对个人生活的项目二：微信之电影拼图<a class="hash-link" href="#s4-针对个人生活的项目二微信之电影拼图" title="标题的直接链接">​</a></h2><p>上面那个项目听起来不是很友好，接下来再看另一个也是和微信相关的小项目：朋友圈电影拼图。</p><p>做这个小项目是因为我习惯性地使用朋友圈记录自己看过的电影，但是苦于微信的九图限制，不足以完全表达我对电影的理解，但是通过长拼图技术，我们可以在有限的图片数量里表达足够多的信息。</p><p>这个项目的目标效果就是点击朋友圈里的一张图片，然后显示的是一个长图，长图是由很多个表达某个主题的子图组成。</p><p>比如说我们现在看到的是一张图片，分成了四个小块，但每个小块点开后，可能是2-10张图片组成，所以实际藏了有几十张图片。</p><p>不过其实真正更难的问题，是如何拥有与挑选这几十张图片，而背后实际上是更复杂的一个场景，那就是我需要持续地使用对电脑的投影进行截图，但在观看投影时，我又不方便去操控电脑，当时十分苦恼这个问题，并尝试去搜索是否有硬件控制方案。</p><p>后来最终自己开发了一个基于 ssh 的内网远程控制程序，将自己的手机当做电脑的遥控器，设置快捷映射，将音量键改为截图键，这样就能用手机的音量键控制电脑里的播放软件同步截图，这几乎是目前能想到的观看投影并整理输出最好的解决方案。</p><p>接着就是对主题分类，但这个就不细谈了。总之，大家可以看到，很多时候，仅仅是为了一些小小的需求，我们确实需要写很多的代码，需要贯通不同领域的知识与技能，但只要认真分析、耐心研究、准确实现，这些都不是难题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s5-针对个人生活的项目三豆瓣租房">S5: 针对个人生活的项目三：豆瓣租房<a class="hash-link" href="#s5-针对个人生活的项目三豆瓣租房" title="标题的直接链接">​</a></h2><blockquote><p>项目地址: <a href="https://github.com/m-archive/douban-renting" target="_blank" rel="noopener noreferrer">https://github.com/m-archive/douban-renting</a></p></blockquote><p>由于时间关系，这个基于油猴的豆瓣租房就暂时不做展开了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s6-针对公众生活的项目一隔离食用手册">S6: 针对公众生活的项目一：隔离食用手册<a class="hash-link" href="#s6-针对公众生活的项目一隔离食用手册" title="标题的直接链接">​</a></h2><blockquote><p>项目地址: <a href="https://github.com/yunyoujun/cook" target="_blank" rel="noopener noreferrer">https://github.com/yunyoujun/cook</a>
使用地址: <a href="https://cook.yunyoujun.cn/" target="_blank" rel="noopener noreferrer">https://cook.yunyoujun.cn/</a></p></blockquote><p>刚刚说的几个小项目都比较小众、比较个人化，接下来再谈两个公众参与的，第一个是隔离食用手册，是我很喜欢的一个项目。</p><p>它创新式地基于供给端给出食谱方案，非常完美地给出了疫情物资紧缺的条件下我们该如何做饭的问题。</p><p>有兴趣的朋友们可以体验体验。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s7-针对公众生活的项目二docusaurus">S7: 针对公众生活的项目二：Docusaurus<a class="hash-link" href="#s7-针对公众生活的项目二docusaurus" title="标题的直接链接">​</a></h2><p>最后再讲一个由Facebook开源的博客框架Docusaurus，目前我的个人博客就是基于这个框架深度定制实现。</p><p>对于普通人来说，提到博客，大概会想到十二十年前中国的站长们，不过今时今日博客生态已经有了天翻地覆的变化。github的流行让markdown文件走入程序员视野，并被选用为最广泛使用的文档载体；而react的流行，也为markdown提供了更新鲜、更强大的能力，这使得稍微会一点前端技术的程序员，可以通过docusaurus等框架很方便、快读地搭建自己的博客，并基于markdown的写作体系，让自己的文档系统高速运行着。</p><p>这也正是我这几年最感兴趣的一个领域，那就是构建第二大脑，也就是自己的、独有的、可持续化的知识系统，而代码在这个场景里承担了最主要的角色。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="s8-工程师的超能力">S8: 工程师的超能力<a class="hash-link" href="#s8-工程师的超能力" title="标题的直接链接">​</a></h2><p>最后以知乎某个工程师的一篇回答总结一下代码的能与不能。</p><p>用该工程师的话说，就是“工程师的超能力”。</p><p>我相信，对于任何一个有追求、有想法、有毅力的朋友，在当今知识爆炸的年代，借助编码能力，是可以极大地提升生活的小确幸与控制感的。尽管代码不是万能的，但是可以给你的生活整点薯条，这大概就是我如此痴迷代码的原因所在了，但愿我们每个人都能收获工程师的超能力，谢谢观看。</p><div class="footnotes"><hr><ol><li id="fn-第三次工业革命-c673c0"><img loading="lazy" alt="picture 1" src="/assets/images/index-1661637049518-3e897ee35872cba47eae2ae2d50aaa918793159b482bf642f9a5ab9cc332513a-c16333c8d85b4d0ba3f82a0e9b538e62.png" width="3584" height="2240" class="img_vXGZ"><br>ref: <a href="https://www.zhihu.com/question/38187220" target="_blank" rel="noopener noreferrer">(2 封私信 / 84 条消息) 如何区分第一、二、三次工业革命？ - 知乎</a><a href="#fnref-%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%B7%A5%E4%B8%9A%E9%9D%A9%E5%91%BD-c673c0" class="footnote-backref">↩</a></li></ol></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[关于台湾进出口临时政策与历史数据的研究]]></title>
            <link>https://markshawn2020.github.io/blog/2022/08/03/taiwan-data-research</link>
            <guid>/2022/08/03/taiwan-data-research</guid>
            <pubDate>Wed, 03 Aug 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[TODO: change this to reference (now it can't since the docusaurus can't parse the router)]]></description>
            <content:encoded><![CDATA[<p>TODO: change this to reference (now it can't since the docusaurus can't parse the router)</p><blockquote><p>see: <code>./src</code></p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="进出口数据核验">进出口数据核验<a class="hash-link" href="#进出口数据核验" title="标题的直接链接">​</a></h2><p>起因是这张图：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659534982100-b4c1430be93e6b3e925f10ffc2e9d67b9826e2bfa5ccb86322d712932113f3fd.png" alt="picture 2" class="img_vXGZ">  </p><p>由于该博指出了数据来源：<a href="http://43.248.49.97" target="_blank" rel="noopener noreferrer">海关总署</a>，所以出于对数据准确性的兴趣，我也小小核验了一下。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="天然砂出口数据">天然砂出口数据<a class="hash-link" href="#天然砂出口数据" title="标题的直接链接">​</a></h3><p>首先给出第一个结论，关于天然砂的判断完全错误，大陆并非没有向湾湾出口天然砂。</p><p>当然，你在海关总署找到这个品类确实不是一件容易得事情，这主要是因为这个网站做的相当糟糕，不支持模糊搜索，也不说明字段设计（尽管可能是国际通用）。</p><p>你首先得知道商品编码分四个类级，分别采用2、4、6、8位数字，意思就是每一级最多有100个子类（完全够用了），然后天然砂（如果我们搜索没错的话）是属于第二大类，编码为2505（此外，还有一个叫“其他天然砂”的第三大类，编码为250590）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535217160-31d418b3e39bdcae8fe576c635a7d8294052b817caafe5f81a4075845f7a7866.png" alt="picture 3" class="img_vXGZ">  </p><p>出口如下，平均每个月100w人民币左右：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536259057-758d8bf03833afaef9ae4436379b59fad70598197cfe5be22956263c8b057d83.png" alt="picture 11" class="img_vXGZ">  </p><p>而且还没有1-3月数据，所以再看一下去年的数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536322770-766d762a3c077d4749eeb632ebe199078b9b64d11bbb247ab2dfa5858276b611.png" alt="picture 12" class="img_vXGZ">  </p><p>基本是一年1kw左右。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="冰鲜带鱼进口数据">冰鲜带鱼进口数据<a class="hash-link" href="#冰鲜带鱼进口数据" title="标题的直接链接">​</a></h3><p>图中提到的冰鲜带鱼其实应该是其子类“冰鲜白带鱼”：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535969347-ca7831ba9e365085abf90bb8f8c75155035f289e04f03830067216fb4eab19dc.png" alt="picture 9" class="img_vXGZ">  </p><p>但不管了，我们允许向上估计，同样的流程，我们搜索出比较对标的编码是 03028910,03038910 ：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535925343-f1ebe82024b795114f894e02e8fda8d41355803943090835a1ece13f3395c2cf.png" alt="picture 8" class="img_vXGZ">  </p><p>结果如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536436688-3b648ae19ff76a02337aead795c3706e0072d21019157c48152de23b051156bc.png" alt="picture 13" class="img_vXGZ">  </p><p>大概每个月1600w左右，1-6月总值确实与其计算的3937w接近。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536588466-d0a98d4da2f0b19f814184d6381a5f3a7a90b6143613c7ddd3d8087853dd3a24.png" alt="picture 14" class="img_vXGZ">  </p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="冻竹荚鱼进口数据">冻竹荚鱼进口数据<a class="hash-link" href="#冻竹荚鱼进口数据" title="标题的直接链接">​</a></h3><p>同上处理，得到的数据也接近。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="结论">结论<a class="hash-link" href="#结论" title="标题的直接链接">​</a></h3><p>尽管天然砂出口湾湾的量并不大，还不及这几条鱼，但显然，互联网的信息传播依然很经不起推敲。</p><p>但如我和大家讨论的，我更关心天然砂对湾湾的产能影响：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536773953-056e0ea0f63bcaee224a9fd21654d3c02f4db109d866f80e24575c355e01caec.png" alt="picture 15" class="img_vXGZ">  </p><p>因为我找到了某个媒体新闻，说湾湾依赖大陆的天然砂达90%（2021年）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536811898-85986f96978444e76dc27e4065a3c2caf0be0d56230d29e7fe10c0462d9b5aa6.png" alt="picture 16" class="img_vXGZ">  </p><p>并称之为“捏到了台湾半导体制造业的七寸”。</p><p>那是否果真如此呢？</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="台湾天然砂进口分析">台湾天然砂进口分析<a class="hash-link" href="#台湾天然砂进口分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="与大陆系统对比分析">与大陆系统对比分析<a class="hash-link" href="#与大陆系统对比分析" title="标题的直接链接">​</a></h3><p>这一次，我们需要用到<a href="https://portal.sw.nat.gov.tw/APGA/GA30" target="_blank" rel="noopener noreferrer">台湾的海关总署</a>数据了。</p><p>这个平台做的就远比国内的海关总署数据用心多了，体验好非常多，前面那个就属实摆烂（国内政企saas的通病，故意让你用的不爽）。</p><p>不过除此使用，则会有意外的感受，那就是年份是从92到111，我脑子迅速地过了一下，2022-111=1911，好家伙，原来是以民国元年为第一年计算的……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536906451-2aef8a67513d03224a68f580fb660a85bdd2e1f38d0f907a239a120c73fbaea1.png" alt="picture 17" class="img_vXGZ">  </p><p>不管这个啦，继续我们的研究。</p><p>刚刚我们说了编码是通用的，天然砂的编码是2505，所以我们直接输就可以。</p><p>可以看到，湾湾的软件就可以对出口和进口同时分类显示，这才是正常的设计：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537151246-4a93a45a380cc4631067cb02b43ca5e1b946382c96a25080ac4c1724304a60c3.png" alt="picture 18" class="img_vXGZ">  </p><p>然后只有美元和新台币两种计价单位，为了核算，我们一律使用美元，然后再把之前的国内海关署的台湾出口天然砂数据拉一下对比看看：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537264182-3fc91e5967787bb2b10160215d50e2526eec65c167b5694e00db2fa321c982a5.png" alt="picture 19" class="img_vXGZ">  </p><p>可以看到，国内显示对湾出口天然砂4月有16.17万美元，5月有15.015万美元，而湾湾显示对大陆进口天然砂个月有34.3万美元，5月有30.7万美元。</p><p>对不上。</p><p>不过注意，湾湾表示，这些字段是包含复进口的，所以多一点也许也可以理解。</p><p>不过令我最不解的是，国内只有个别月有数据，这显然是不正常的。</p><p>所以，假如湾湾是客观正确的，那么国内数据系统没有错的话，那就是人为降低了数据量。</p><p>那国内为啥会少报出口量呢，好像也没有道理，所以权当是数据系统错误吧。</p><p>反正那个系统（除了验证码都是准确的之外），你也不能指望能准到哪里去。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大陆占比分析">大陆占比分析<a class="hash-link" href="#大陆占比分析" title="标题的直接链接">​</a></h3><p>接下来研究湾湾进口天然砂的大陆占比，是否果真达到了90%。</p><p>数据上，由于湾湾的海关数据系统做的非常好，所以我们很方便地能拿到湾湾从民国92年（2003）到111年（2022）从世界各国进口天然砂的数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537732876-7b9b5ae100b662512f9b3935ea6a54c062a9291d63b5695f45e1592f921a9d70.png" alt="picture 20" class="img_vXGZ">  </p><p>然后我们只需要按年分组，分别求得中国进口金额、全球总计进口金额与其两者的比值，最终得到结果如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538239892-88ae51c1bfbf5f1b66da0ba466e387e18a2a15ca81c7314c23c880a98ad8c41d.png" alt="picture 22" class="img_vXGZ">  </p><p>很遗憾的是，06年及以前，台湾对大陆的天然砂确实依赖程度高达90%，但是09年之后就断崖式下跌，19年之后已完全在5%以下……</p><p>无话可说。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="台湾历年进出口数据国别分析">台湾历年进出口数据国别分析<a class="hash-link" href="#台湾历年进出口数据国别分析" title="标题的直接链接">​</a></h2><p>最后，趁着这个机会，研究一下台湾对各国进出口的情况。</p><p>由于年份和国家众多，想展示趋势并不太容易，所以敲定的方案就是选择十个典型国家，其他的用“others”去合计。</p><p>而这十个典型的国家，基于2021年湾湾进口金额前十的国家，它们依次是：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659539868919-29f54cb79952d07687c5d37ce41dd98507e0e9a4aee44cdc78b505fefc46330f.png" alt="picture 28" class="img_vXGZ">  </p><p>值得注意的是，前十的总和也只有 75%，说明湾湾的多边合作做的还是不错的。</p><p>最后直接上图吧：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538585259-fd683105da7e1b920502335a5af11403208bad891ce3f633d16b65e084fa58ec.png" alt="picture 23" class="img_vXGZ">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538594329-f7fd29256e42afde0efbe7cbddc40c18fb14ab45d74a6e3ddb6e860e2a8ed223.png" alt="picture 24" class="img_vXGZ">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538600601-4f3ed108d5cd356ecda9f22381873c8b4633f6ad06b6954ec328df6bc2c76a3d.png" alt="picture 25" class="img_vXGZ">  </p><p>以上！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="代码">代码<a class="hash-link" href="#代码" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="代码一台湾天然砂进口分析">代码一：台湾天然砂进口分析<a class="hash-link" href="#代码一台湾天然砂进口分析" title="标题的直接链接">​</a></h3><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mpl_toolkits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axes_grid1 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> host_subplot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ticker </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ScalarFormatter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PercentFormatter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"figure.dpi"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">320</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'font.sans-serif'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Heiti TC'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Songti SC'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 1. data fetch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 台湾海关数据查询网址: https://portal.sw.nat.gov.tw/APGA/GA30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数设置：货品（天然砂）：2505</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"~/Downloads/綜合查詢_20220803143014.xls"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 2. data wash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">china_with_world</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    china </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'國家'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'中國大陸'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'美元(千元)'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'美元(千元)'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> china </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"total"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'china'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> china</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'pct'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'日期'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">r'\d+'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1912</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">china_with_world</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 3. data visualization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># scientific formatter, ref: https://atmamani.github.io/cheatsheets/matplotlib/matplotlib_2/#Numbers-on-axes-in-scientific-notation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formatter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ScalarFormatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">useMathText</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formatter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_powerlimits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># https://matplotlib.org/3.4.3/api/ticker_api.html#matplotlib.ticker.ScalarFormatter.set_powerlimits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># two kinds draw from dataframe: https://www.statology.org/matplotlib-two-y-axes/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> host_subplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">111</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaxis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_major_formatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">formatter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">twinx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaxis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_major_formatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PercentFormatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">total</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'全部'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">china</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'大陆'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'g-o'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'大陆占比'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">j</span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.0f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">xy</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'magenta'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.99</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'台湾天然砂进口数据'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'center'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> va</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"top"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.92</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'data source：https://portal.sw.nat.gov.tw/APGA/GA30'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'right'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'gray'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'italic'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.89</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'design: markshawn, Aug 2, 2022'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'right'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'gray'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'italic'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.895</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">'美元'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'italic'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rotation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Rotates X-Axis Ticks by 45-degrees</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="代码二台湾历年进出口分析">代码二：台湾历年进出口分析<a class="hash-link" href="#代码二台湾历年进出口分析" title="标题的直接链接">​</a></h3><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 数据：https://portal.sw.nat.gov.tw/APGA/GA30_LIST</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preprocess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'進出口別'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'日期'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'國家'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'貨品號列'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'good_kind_id'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'中文貨名'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'good_kind_name_cn'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'英文貨名'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'good_kind_name_en'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'美元(千元)'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'\d+'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1912</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addTotalRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    totalRow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numeric_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_frame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Total'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> totalRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calcDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'顺差'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'出口總值(含復出口)'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'進口總值(含復進口)'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTopCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> io</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"進口總值(含復進口)"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> year</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2021</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> N</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'io=="</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">io</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">" and year==</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">year</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dff</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'total: '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'pct'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">squashCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'country in </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">topCountries</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sumOthers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'country not in </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">topCountries</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newRows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"country"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"others"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"amount_k"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sumOthers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cur</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newRows</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleYear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> squashCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plotTrend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'bar'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stacked</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox_to_anchor </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> loc</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'center left'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suptitle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleIO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleYear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plotTrend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">showTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> addTotalRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'金额（亿美金）'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'全球占比'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">x</span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'amount_k'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'pct'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> preprocess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/Users/mark/Downloads/綜合查詢_20220803190515.xls'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'country'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'year'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calcDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dfTopCountries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> getTopCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topCountries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfTopCountries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'io'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleIO</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[微信数据库破解]]></title>
            <link>https://markshawn2020.github.io/blog/2022/08/01/wechat-hack</link>
            <guid>/2022/08/01/wechat-hack</guid>
            <pubDate>Mon, 01 Aug 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[- 项目展示]]></description>
            <content:encoded><![CDATA[<ul><li><a href="#%E9%A1%B9%E7%9B%AE%E5%B1%95%E7%A4%BA">项目展示</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%BE%AE%E4%BF%A1%E5%A5%BD%E5%8F%8B%E4%BF%A1%E6%81%AF">获取所有微信好友信息</a></li><li><a href="#%E5%AF%BC%E5%87%BA%E4%B8%8E%E5%BE%AE%E4%BF%A1%E5%A5%BD%E5%8F%8B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95">导出与微信好友的聊天记录</a></li><li><a href="#%E7%9B%91%E6%8E%A7%E5%AE%9E%E6%97%B6%E8%81%8A%E5%A4%A9">监控实时聊天</a></li><li><a href="#%E5%85%B6%E4%BB%96">其他</a></li></ul></li><li><a href="#%E5%8A%A8%E6%9C%BA%E8%83%8C%E6%99%AF">动机背景</a></li><li><a href="#%E6%8A%80%E6%9C%AF%E6%A6%82%E8%A7%88">技术概览</a><ul><li><a href="#github-search-until-wechat-decipher-macos">github search until <code>wechat-decipher-macos</code></a></li><li><a href="#macoseavesdropperd"><code>macos/eavesdropper.d</code></a></li><li><a href="#macosdbcrackerd"><code>macos/dbcracker.d</code></a></li><li><a href="#pcbakchatgatherd"><code>pcbakchat/gather.d</code></a></li><li><a href="#develxloggerd"><code>devel/xlogger.d</code></a></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li><li><a href="#update2022-02-08-%E5%85%B3%E4%BA%8E%E5%8A%A0%E5%AF%86%E5%AD%97%E6%AE%B5">update@2022-02-08: 关于加密字段</a></li></ul></li><li><a href="#reference">reference</a><ul><li><a href="#%E5%90%84%E5%A4%A7%E5%B9%B3%E5%8F%B0%E4%BB%93%E5%BA%93%E5%90%88%E9%9B%86">各大平台仓库合集</a></li><li><a href="#mac%E7%89%88">mac 版</a></li><li><a href="#windows%E7%89%88">windows 版</a></li><li><a href="#ios%E7%89%88">ios 版</a></li><li><a href="#sqlcipher-%E7%9B%B8%E5%85%B3"><code>sqlcipher</code> 相关</a></li><li><a href="#pragma-%E7%9B%B8%E5%85%B3"><code>pragma</code> 相关</a></li><li><a href="#frida-%E7%9B%B8%E5%85%B3"><code>frida</code> 相关</a></li></ul></li><li><a href="#hack-manual">hack manual</a><ul><li><a href="#download-sqlite">download sqlite</a></li><li><a href="#test-sqlite">test sqlite</a></li><li><a href="#install-openssl-to-replace-the-built-in-libressl-on-macos">install <code>openssl</code> to replace the built-in <code>libressl</code> on MacOS</a><ul><li><a href="#install-openssl-via-brew">install <code>openssl</code> via <code>brew</code></a></li><li><a href="#config-openssl-into-path">config <code>openssl</code> into path</a></li><li><a href="#confirm-openssl">confirm openssl</a></li></ul></li><li><a href="#compile-sqlcipher">compile <code>sqlcipher</code></a></li><li><a href="#update-%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91">UPDATE: 静态编译</a></li><li><a href="#test-sqlcipher-workflow">test <code>sqlcipher</code> workflow</a><ul><li><a href="#step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before">step 1. crypto a plain database (which is generated by our <code>sqlite</code> before)</a></li><li><a href="#step2-test-operate-on-an-encrypted-database-without-key-expect-failure">step2. test: operate on an encrypted database without key (expect: failure)</a></li><li><a href="#step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success">step3. test: dump the encrypted database into plain with key (expect: success)</a></li><li><a href="#step4-test-open-the-decrypted-database-without-key-expect-success">step4. test: open the decrypted database without key (expect: success)</a></li></ul></li><li><a href="#sparklessparkles-decrypt-database">✨✨ decrypt database</a><ul><li><a href="#depreciated-pragma-config-of-sqlcipher-3-defaults">DEPRECIATED: pragma config of sqlcipher 3 defaults</a></li><li><a href="#best-practice-pragma-config-of-sqlcipher-3-defaults">BEST-PRACTICE: pragma config of sqlcipher 3 defaults</a></li><li><a href="#check-salt-of-specific-database-file">check salt of specific database file</a></li><li><a href="#decrypt-and-dump-specific-database-file">decrypt and dump specific database file</a></li><li><a href="#test-dumped-database-file-via-sqlcipher-or-sqlite3">test dumped database file (via <code>sqlcipher</code> or <code>sqlite3</code>)</a></li></ul></li></ul></li><li><a href="#wechat-design">wechat design</a><ul><li><a href="#design-of-contact-fields">design of contact fields</a></li><li><a href="#design-of-user-id-to-contact-id-md5">design of user id to contact id: <code>md5</code></a></li><li><a href="#improve-get-self-id">IMPROVE: get self id</a></li><li><a href="#todo-get-image-from-xml">TODO: get image from xml</a></li></ul></li><li><a href="#py-sqlcipher-instruction">py-sqlcipher instruction</a><ul><li><a href="#compile">compile</a></li><li><a href="#connection">connection</a></li><li><a href="#table">table</a><ul><li><a href="#list-all-the-tables">list all the tables</a></li><li><a href="#list-the-columns-of-table-get-table-schema">list the columns of table (get table schema)</a></li><li><a href="#format-rows-display">format rows display</a></li><li><a href="#list-rows-in-one-table">list rows in one table</a></li></ul></li></ul></li><li><a href="#extended">extended</a><ul><li><a href="#how-to-know-my-openssl-versioninfo">how to know my openssl version/info</a></li><li><a href="#bugfix-error-c-compiler-cannot-create-executables">bugfix: <code>error: C compiler cannot create executables</code></a></li></ul></li><li><a href="#%E6%9C%AC%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C%E4%BC%99%E4%BC%B4">本项目合作伙伴</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="项目展示">项目展示<a class="hash-link" href="#项目展示" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="获取所有微信好友信息">获取所有微信好友信息<a class="hash-link" href="#获取所有微信好友信息" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136070132-9386a758919031c4082e3fd702273d38499aa3157ce2906861583e87a0f7d41a.png" alt="picture 86" class="img_vXGZ"></p><p>derived from hacked db: <code>Contact/wccontact_new2.db</code></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="导出与微信好友的聊天记录">导出与微信好友的聊天记录<a class="hash-link" href="#导出与微信好友的聊天记录" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136499656-9a9e5597f347af566ceba6f711c905b58bf81370b11c9b551df3ceed6dbe3e10.png" alt="picture 87" class="img_vXGZ"></p><p>derived from hacked dbs: <code>Message/msg_*.db</code></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="监控实时聊天">监控实时聊天<a class="hash-link" href="#监控实时聊天" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136566951-029db895a57dcce825b718f2c02eb4442595ca622b30dc304b0730ca43c83a45.png" alt="picture 88" class="img_vXGZ"></p><p>derived from real-time terminal</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="动机背景">动机背景<a class="hash-link" href="#动机背景" title="标题的直接链接">​</a></h2><p>一切，都要从南川的计算机小群里 <code>Shining Lavender</code> 和 <code>Le Penseur</code> 同学聊到“爱”这个高深的话题，继而聊到了“soulmate”，而我最近恰好看了《Intouchables》：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644105366255-7f103adb1dbc36f747db75146f8585756fb59d54ea52e5bf60df4ee4f24ec24b.png" alt="picture 66" class="img_vXGZ"></p><p>所以和 <code>Le Penseur</code> 同学一下探讨到了凌晨……</p><p>上半场刚结束，基友群表示对这个话题也很感兴趣，遂我们又来回肝完了半个通宵。</p><p>下半场也结束后，我发现我很想把这些闪烁智慧与思考、彭拜着荷尔蒙与伤感的青春文字记录整理下来，但是无奈微信未能提供满足我这种需求的便利。</p><p>自然而然地，作为一名合格的程序员，兵来将挡水来土掩，我们又上场了……</p><p>历时一天，彻底拿下！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="技术概览">技术概览<a class="hash-link" href="#技术概览" title="标题的直接链接">​</a></h2><p>思路还是比较通用的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="github-search-until-wechat-decipher-macos">github search until <code>wechat-decipher-macos</code><a class="hash-link" href="#github-search-until-wechat-decipher-macos" title="标题的直接链接">​</a></h3><p>首先，第一步，去 <code>github</code> 搜索是否已经有破解微信聊天记录相关的开源仓库，结果，应有尽有，一应尽全 - <a href="https://github.com/search?q=wechat+history" target="_blank" rel="noopener noreferrer">Search · wechat history</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644107134293-92350d3d13791ae819981fdc8c57d10005f87b3a67af3d83477ca6170566d38d.png" alt="picture 68" class="img_vXGZ"></p><p>可以看到，至少在这一页前几个仓库中，安卓、iOS、mac 都有，windows 倒不确定。</p><p>我目前手机用的是安卓，电脑是 mac，但我用电脑比较多，所以我倾向于选择 mac 的方案，于是第一选择这个仓库 - <a href="https://github.com/nalzok/wechat-decipher-macos" target="_blank" rel="noopener noreferrer">nalzok/wechat-decipher-macos: Scripts to extract chat history from WeChat on macOS</a></p><p>不过这个仓库，起手难度可不低，仓库介绍十分简练，但真的是字字珠玑！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644107483092-cfb440bb5ad7cb61932c7d7f68c796bc966e40a97e3afec36f715c951008a13e.png" alt="picture 70" class="img_vXGZ"></p><p>对于用户（我）来说，这个仓库的主要功能在前三者，一定要仔细理解，每个字都很宝贵：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="macoseavesdropperd"><code>macos/eavesdropper.d</code><a class="hash-link" href="#macoseavesdropperd" title="标题的直接链接">​</a></h3><p><code>macos/eavesdropper.d</code>是用于实时、高速打印微信与数据库之间的信息流的，具体什么样子呢？我运行一下给你们看一下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108103693-89dccd5c3c7ffd9fa7fcd17120f0a21253dff4a8a8fbe9a28003ae06e6acd5e2.png" alt="picture 72" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108029952-190572feae187736fdd39670cdd6c0530ca02d572880ef6567b45a92937710e2.png" alt="picture 71" class="img_vXGZ"></p><p>可以看到，我在微信中发送的聊天内容，会被明文显示到控制台中，并且在不同的时间点被打印了两遍。</p><p>当然，这不是微信自己打印的，是我们（他的）脚本打的，并且把结构体都打出来了，这个结构体和最终存到数据库里的数据结构基本是差不多的。</p><p>比如这是我们数据库中的样子：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108568767-1a6f573f038fc329ebc643aa5d2cae05060209952f9da6572cb7f693e5d866e0.png" alt="picture 73" class="img_vXGZ"></p><p>但是，由于这是用于实时的，也就是过去的就没有了，所以不满足我的需求，因为我也没有深究这个脚本（比如为啥打印两次，强迫症的我接受不了，至少接受不了这么大面积的冗余）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="macosdbcrackerd"><code>macos/dbcracker.d</code><a class="hash-link" href="#macosdbcrackerd" title="标题的直接链接">​</a></h3><p>其实我一开始没有看懂<code>macos/dbcracker.d</code>这个脚本用来干啥的，并且以为第四个脚本<code>devel/xlogger.d</code>才是我的目标，但显然，这个想法错的离谱。</p><p><code>cracker</code>是“撕裂者”的意思，<code>dbcracker</code>就是“数据库撕裂者”，听起来还是很可怕吧！</p><p><strong>事实上，它真地很可怕 ！</strong></p><p><strong>而且，我后续所有的工作都是基于它完成的！</strong></p><p>但它的操作，就没有第一个脚本 <code>macos/eavesdropper.d</code>那么容易上手了。</p><p>首先，注意它的描述：<code>Since it can only capture secrets when WeChat.app opens these files, you need to perform a login while the script is running.</code>，也就是你需要先运行脚本，然后重启微信，才能看到效果。</p><p>不过经过我的测试，正确流程是这样的，先退出微信登录（或者直接杀掉，然后启动），保留微信在登录界面（但还没有登录），接着运行脚本（否则会报基于没有进程导致的后续错误），然后扫码登录成功，这个时候就能飞速地看到命令行有很多数据在跑了，其实就是微信所有（大部分）的数据库的文件位置、秘钥、参数等。</p><p>值得注意的是，秘钥是用来干啥的。</p><p>一般用惯了<code>mysql</code>或者<code>mongodb</code>之类数据库的人（别”人“了，就是我），其实根本不知道这个秘钥（既然不是用户密码）用来干嘛，这才是本项目的第一大难点。</p><p>这个时候，细心地读下一句：<code>Simply copy &amp; paste the script output to invoke SQLCipher and supply the respective PRAGMAs.</code>，翻译过来就是，把命令行的输简单地出复制粘贴，已启动<code>SQLCipher</code>并分别用于<code>PRAGMA</code>。</p><p>很绕，也一脸懵逼是不，是就对了！</p><p>答案在那个超链接 <a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a> 上，所以你为了使用 A 项目，不得不去先啃 B 项目了。</p><p>但实际上，<code>sqlcipher</code>更难看懂，尤其是一上来就教你怎么编译，非常硬核（然而还有坑）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644109309058-9d622be690c067975eaea80a80f4a42c9499abc22492987a84ac599e8df57cc1.png" alt="picture 74" class="img_vXGZ"></p><p>编就编吧，还有依赖，看看：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">You must define SQLITE_HAS_CODEC and either SQLITE_TEMP_STORE=2 or SQLITE_TEMP_STORE=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You will need to link against a support cryptographic provider (OpenSSL, LibTomCrypt, CommonCrypto/Security.framework, or NSS)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>让我们定义变量（一开始以为是环境变量，后来发现是头文件内部变量），还要链接一个加密库……</p><p>一脸懵逼吧。</p><p>我一开始也看不懂，然后瞎编了一下。</p><p>结果果然报错了……</p><p>接着就一顿乱搜，然后找到了对本项目影响最大的一篇博客：- <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">(25 条消息) Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a>。</p><p>这个事实充分证明，只要你想干的事情足够大众，你就能找到非常不错的伙伴，或者说，前辈。</p><p>该文章基本包括了<code>sqlcipher</code>如何编译、安装的问题，以及（非常前瞻性地）解决了里面的一些坑，节省了我可期的很多时间。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644130239719-433993ab017e150fd403cf6f0fe102a3602183aa1ae9a2ecea6a158d8b1fda6e.png" alt="picture 75" class="img_vXGZ"></p><p>基于这篇文章，我熟悉了 <code>sqlcipher</code> 的使用，意识到 <code>sqlcipher</code> 是 <code>sqlite3</code> 的加密版，每个数据库可以独立地用一个<code>KEY</code>加密，然后还可以解密，并导出无加密版本的<code>sqlite3</code>。</p><p>所以在那之后，我才真正地意识到 <code>macos/dbcracker.d</code> 是用来干什么的：</p><ol><li>用该脚本，通过监听微信启动时打开数据库的动作，暴露微信所有数据库的文件位置与秘钥信息</li><li>接下来数据库秘钥都有了，做啥就取决于自己了，比如说把所有好友的信息都导出成一张 excel 表这种</li></ol><p>以下是该脚本监控到的数据库，与微信实际数据库对比。</p><p>Almost all (especially the core ones, such as Contacts/Messages relative) the tables are tracked.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082483000-9d84d84536dbcbdcee54074954060a9d798375d608d3b1f67c60b4afcf5fd206.png" alt="picture 54" class="img_vXGZ"></p><p>Hence, it's pretty good for our further work.</p><p>Also, the <code>db-list.txt</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082665967-654ab2912014189f77101b76367871983ab657d7318233475a776c032ba756fe.png" alt="picture 55" class="img_vXGZ"></p><p>And the <code>db-list-tracked.txt</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082727437-9dff122b852aacc64580230804b033baf509e62fd1266f8b4d682369ff172228.png" alt="picture 56" class="img_vXGZ"></p><p>The <code>track.log</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082780616-f364e35190d91279aa6dd8346429605b7bbc93b8baae3c33a2b6487cd94dfd74.png" alt="picture 57" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="pcbakchatgatherd"><code>pcbakchat/gather.d</code><a class="hash-link" href="#pcbakchatgatherd" title="标题的直接链接">​</a></h3><p>这个脚本其实也挺有用的，它能捕获备份时的数据流。</p><p>在说这个之前，我们有必要明确一下微信中的备份是啥意思（尤指 mac 平台）。</p><p>其实是这样的， 由于登录设备差异，同一个微信账户在不同设备（win、mac、ios、android）上的聊天记录是不完全一致的，一般手机上的才是完整的，电脑上（如果你没有一直登）是不完整的。</p><p>所以 mac 平台上的备份就包括</p><ol><li>从手机备份到 mac</li><li>从 mac 备份到手机</li></ol><p>我一开始以为备份是指把 mac 上的数据备份到另一个文件夹内，这个理解是不对的，其实如果去看微信的数据库设计部分，每个数据库是有单独的<code>.db.bak</code>的，尽管不大（也许里面压根就没有备份的数据，或者是压缩后的），但微信确实都有数据库级别备份的意图。</p><p>那无论是从手机备份到 mac 还是从 mac 备份到手机，都涉及到两台机器之前通信的问题，再明确一点，他们要彼此在同一个局域网内，用 socket 进行文件传送的。</p><p>所以其实 <code>pcbakchat/gather.d</code>就是劫持这部分局域网通信，把所有要备份的聊天记录都曝光出来，达到了给我们自己处理的目的。</p><p>具体可以见本仓库对备份部分的详细说明 - <a href="https://github.com/nalzok/wechat-decipher-macos/tree/main/devel" target="_blank" rel="noopener noreferrer">wechat-decipher-macos/devel at main · nalzok/wechat-decipher-macos</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644130960943-7e25936bcc8028c4eb34ffc5a2c09900211965a997718ded3f559f7fc6a7ae21.png" alt="picture 76" class="img_vXGZ"></p><p>可以看到还是比较复杂的，我一开始本来是走的这个思路，但是当时我还没对微信的数据库有较高的认识，所以当时这个方案跑起来了但是我没用。</p><p>其实这个方案应该最适合我的需求，因为我想获得的好友/群组的信息是已知的、数量不多的，我可以分别对这几个好友/群组进行备份动作，这样可以很方便地直接得到与他们的聊天记录（还可以在备份时选择时间，并且是手机上的聊天记录，也就是更完整）。</p><p>但考虑到我后来一直在研究数据库加解密上，并且在获得数据库秘钥之后，通过操作数据库也能获得我所有想要的聊天记录（因为当时我聊天的部分恰好都在 mac 上），所以 <code>macos/dbcracker.d</code> 已经能够满足我的要求。</p><p>所以本篇也会重点基于 <code>macos/dbcracker.d</code> 进行介绍，尽管 <code>pcbakchat/gather.d</code> 更适合导出与指定好友的（更完整的）聊天记录，更具有“社会”价值，但前者更具有“娱乐”（bushi，研究）价值。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="develxloggerd"><code>devel/xlogger.d</code><a class="hash-link" href="#develxloggerd" title="标题的直接链接">​</a></h3><p>这个其实就是把 mac 微信上所有的消息流都劫持了，打印出非常多的东西，所以只适合“黑客”自己二度开发相要的功能。</p><p>我们的需求没必要用这个，并且它一打开，微信就卡死了……可能是影响了微信的运行速度，然后假死，这是异常行为，可能有封号风险，所以谨慎。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结">总结<a class="hash-link" href="#总结" title="标题的直接链接">​</a></h3><p>我们全部的工作，主要还是建立在 - <a href="https://github.com/nalzok/wechat-decipher-macos" target="_blank" rel="noopener noreferrer">nalzok/wechat-decipher-macos: Scripts to extract chat history from WeChat on macOS</a> 的基础上，<code>Qingyao Sun</code>做了出色的工作（尽管部分地方有一些瑕疵），没有他精致（还记得我怎么评价的吗？“字字珠玑”）的项目文档，与合理的项目结构设计，我是不太可能一到两天就“攻破”微信的数据库的，感谢！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644131537140-b4113df9c6055f65ec8d2cd43d0423a9246884e02b0d9379c85db0315f91c831.png" alt="picture 77" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="update2022-02-08-关于加密字段">update@2022-02-08: 关于加密字段<a class="hash-link" href="#update2022-02-08-关于加密字段" title="标题的直接链接">​</a></h3><p>备份数据库的<code>cipher_page_size</code>不是默认值（1024），而是 4096！</p><p>所以原作中打印出这些信息是很有必要的!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644311729706-1de6652c04e0493ac7ba53cfeb35af14784e1351923142709da40f726c039501.png" alt="picture 19" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="reference">reference<a class="hash-link" href="#reference" title="标题的直接链接">​</a></h2><blockquote><p>如果您想自己攻破微信的数据库系统，以下是一些我认为比较核心的参考资料，包括各大平台的。</p><p>万变不离其中的是，微信的数据库使用的是基于<code>sqlite3</code>加密的<code>sqlcipher</code>，并且是<code>sqlcipher 3 defaults</code>配置，所以理解与熟悉该数据库才是全部工作的最大攻坚战。当你攻破之后，怎么做，就是你的事情了。</p><p>⚠️ 友情提醒：不要乱动微信的数据库，否则引起的一切后果，与本文无关，本文不涉及任何修改微信数据库的实现</p></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="各大平台仓库合集">各大平台仓库合集<a class="hash-link" href="#各大平台仓库合集" title="标题的直接链接">​</a></h3><ul><li><a href="https://github.com/search?q=wechat+history" target="_blank" rel="noopener noreferrer">Search · wechat history</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="mac-版">mac 版<a class="hash-link" href="#mac-版" title="标题的直接链接">​</a></h3><ul><li>mac 版详细教程：<a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="windows-版">windows 版<a class="hash-link" href="#windows-版" title="标题的直接链接">​</a></h3><ul><li>windows 版详细教程：<a href="https://bbs.pediy.com/thread-251303.htm" target="_blank" rel="noopener noreferrer">[原创]PC 版微信数据库解密详细教程-软件逆向-看雪论坛-安全社区|安全招聘|bbs.pediy.com</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ios-版">ios 版<a class="hash-link" href="#ios-版" title="标题的直接链接">​</a></h3><ul><li><a href="https://daily.zhihu.com/story/8807166" target="_blank" rel="noopener noreferrer">知乎日报 - 知乎</a></li><li><a href="https://github.com/stomakun/WechatExport-iOS" target="_blank" rel="noopener noreferrer">stomakun/WechatExport-iOS: Save iOS WeChat history as HTML or TXT with neat layout and picture &amp; audio support.</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="sqlcipher-相关"><code>sqlcipher</code> 相关<a class="hash-link" href="#sqlcipher-相关" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644134209068-2d046f82a3ae99e9704b64974a0444567cc9955e47a1ef2cc419ce53671d9cd4.png" alt="picture 79" class="img_vXGZ"></p><ul><li><p><code>sqlcipher</code>官方版本（提供了启动指引）：<a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a></p></li><li><p>python 版本<code>sqlcipher</code>: <a href="https://github.com/rigglemania/pysqlcipher3" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a></p></li><li><p>✨可视化软件（前期验证登录帮了大忙）：<a href="https://sqlitebrowser.org/dl/" target="_blank" rel="noopener noreferrer">Downloads - DB Browser for SQLite</a></p></li><li><p><code>sqlcipher</code> （商业）官方网站：<a href="https://www.zetetic.net/sqlcipher/" target="_blank" rel="noopener noreferrer">SQLCipher - Zetetic</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="pragma-相关"><code>pragma</code> 相关<a class="hash-link" href="#pragma-相关" title="标题的直接链接">​</a></h3><blockquote><p><code>pragma</code> 是 <code>sqlite3</code> 中的一种关键字，具体我也不太懂，我们项目只需要会用很简单的几条语句即可，是操作 <code>sqlcipher</code> 必须的。</p></blockquote><ul><li>✨✨<code>pragma</code>核心语句（包括算法部分）：<a href="https://utelle.github.io/SQLite3MultipleCiphers/docs/configuration/config_sql_pragmas/#pragma-hmac_algorithm" target="_blank" rel="noopener noreferrer">SQL Pragmas | SQLite3 Multiple&nbsp;Ciphers</a></li><li>✨ <code>sqlcipher</code>相关接口实现：<a href="https://github.com/Tencent/sqlcipher/blob/4f37c817eb99e18e4fdc8ac63d67ac33610d66be/src/crypto_impl.c" target="_blank" rel="noopener noreferrer">sqlcipher/crypto_impl.c at 4f37c817eb99e18e4fdc8ac63d67ac33610d66be · Tencent/sqlcipher</a></li><li><code>pragma</code>部分语句（没有算法部分）：<a href="https://www.sqlite.org/pragma.html" target="_blank" rel="noopener noreferrer">Pragma statements supported by SQLite</a></li><li><code>pragma</code>部分语句（也没有算法部分）：<a href="https://www.runoob.com/sqlite/sqlite-pragma.html" target="_blank" rel="noopener noreferrer">SQLite PRAGMA | 菜鸟教程</a></li><li>其他<code>pragma</code>相关问题：<a href="https://juejin.cn/post/6844903983899738126" target="_blank" rel="noopener noreferrer">如何降级加密的 Sqlite 数据库文件 - 掘金</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="frida-相关"><code>frida</code> 相关<a class="hash-link" href="#frida-相关" title="标题的直接链接">​</a></h3><blockquote><p><code>frida</code> 是用于逆向的，原以为要用到，后来发现没有（至少我的应用级别没用到），也是捏了一把冷汗。以防需要，所以也补一份。项目底层监控微信部分，应该是用到了 <code>frida</code> 的。</p></blockquote><ul><li><a href="https://frida.re/" target="_blank" rel="noopener noreferrer">Frida • A world-class dynamic instrumentation framework | Inject JavaScript to explore native apps on Windows, macOS, GNU/Linux, iOS, Android, and QNX</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="hack-manual">hack manual<a class="hash-link" href="#hack-manual" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="download-sqlite">download sqlite<a class="hash-link" href="#download-sqlite" title="标题的直接链接">​</a></h3><p>download any sqlite versions from here <a href="https://www.sqlite.org/download.html" target="_blank" rel="noopener noreferrer">SQLite Download Page</a> or directly download mac (x86) version from <a href="https://www.sqlite.org/2022/sqlite-tools-osx-x86-3370200.zip" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/2022/sqlite-tools-osx-x86-3370200.zip</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="test-sqlite">test sqlite<a class="hash-link" href="#test-sqlite" title="标题的直接链接">​</a></h3><p>unzip the downloaded sqlite zip, and test the sqlite.</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  sqlite-tools-osx-x86-3370200 tree .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sqldiff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sqlite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sqlite3_analyzer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 directories, 3 files</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644051236520-b24b75cf94124fd18e0e540dba9d639924e0b3886bac991f0d816a301f9195ce.png" alt="picture 14" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="install-openssl-to-replace-the-built-in-libressl-on-macos">install <code>openssl</code> to replace the built-in <code>libressl</code> on MacOS<a class="hash-link" href="#install-openssl-to-replace-the-built-in-libressl-on-macos" title="标题的直接链接">​</a></h3><p>!!!warning <code>brew</code> need to be pre-installed</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="install-openssl-via-brew">install <code>openssl</code> via <code>brew</code><a class="hash-link" href="#install-openssl-via-brew" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install openssl</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="config-openssl-into-path">config <code>openssl</code> into path<a class="hash-link" href="#config-openssl-into-path" title="标题的直接链接">​</a></h4><p>According to the brew instruction on openssl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644051857192-ba13ebef60caf744ce20b9a323a616f7f32555fd0b5b9005145cda243ecfc645.png" alt="picture 15" class="img_vXGZ"></p><p>We can directly write all the three commands into shell and make them work:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># if you use bash, change $SHELL to be `~/.bashrc`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHELL=~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export PATH="/usr/local/opt/openssl@3/bin:$PATH"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export LDFLAGS="-L/usr/local/opt/openssl@3/lib"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export CPPFLAGS="-I/usr/local/opt/openssl@3/include"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export PKG_CONFIG_PATH="/usr/local/opt/openssl@3/lib/pkgconfig"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source $SHELL</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>result</p></blockquote><p>before changing openssl, the default openssl is libressl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052002163-d79b3d78530e7e5b36887fcdef9c06839cbec11de0eb37e30d6304d78168fd2f.png" alt="picture 16" class="img_vXGZ"></p><p>after that it becomes openssl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052027060-7263c604b5c8466f67e9a83b5b8900712952f6f2092d8cbde50fc8856536cc5d.png" alt="picture 17" class="img_vXGZ"></p><p>!!!tip 因为将 openssl 的路径加入了 path（并且在默认搜索路径之前），所以现在输入<code>openssl</code>会优先检索到我们的 openssl，如果想换回默认的<code>libressl</code>，则一方面可以在<code>~/.zshrc</code>配置文件中把我们新加入的几句话注释掉，这样每次重启 SHELL 就不会有；同时，我们还要在 SHELL 中重置一下 path，如下：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">![picture 19](https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052792755-dfbab4a924d8531c5199ef3f75dc6c635ba7f965452f14a7e7f701cc735d93dd.png)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参考:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [How to Reset the PATH Variable on Mac to Default macOS PATH](https://techpp.com/2021/09/13/reset-path-variable-on-mac-guide/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [macos - How do I reset the $PATH variable on Mac OS X? - Super User](https://superuser.com/questions/121870/how-do-i-reset-the-path-variable-on-mac-os-x)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="confirm-openssl">confirm openssl<a class="hash-link" href="#confirm-openssl" title="标题的直接链接">​</a></h4><p>According to the <code>brew install openssl</code> command result, our openssl source codes are under <code>/usr/local/Cellar/openssl@xxx</code>:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644053094808-83ad1e420d3f10f9f1993392ef81a7937f1cb2feb36d2c8d65ee15b761a803f1.png" alt="picture 20" class="img_vXGZ"></p><p>Have a check:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644053177928-4cadb79f22f3201c1298c4758b50ff84de6761bf3a4c7f399977cd261f04e950.png" alt="picture 21" class="img_vXGZ"></p><p>!!!tip 可以看到，我们其实默认是有一个<code>openssl@1.1</code>的，然后我们新装了一个<code>openssl@3</code>，所以实际上我 follow 的那个帖子并不完全正确。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">至少在我们安装homebrew后，就已经有了`openssl`(不单单是mac的`libressl`)。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这意味着其实我们（可能）没有必要再安装一个`openssl`，直接把目前这个`openssl`相关的信息写入环境变量即可。（待验证这种方式是否有效）</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="compile-sqlcipher">compile <code>sqlcipher</code><a class="hash-link" href="#compile-sqlcipher" title="标题的直接链接">​</a></h3><p>官方 <a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a>对编译是这么写的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055146714-d0372f937c55a48d57a16ad23499d9dcacedcffc95c73c8858b6fe4558bbe24f.png" alt="picture 23" class="img_vXGZ"></p><p>在我没有<code>define SQLITE_HAS_CODEC and either SQLITE_TEMP_STORE=2 or SQLITE_TEMP_STORE=3</code>之前（引申阅读： 1. <a href="https://www.leavesongs.com/C/EncryptSqlite.html" target="_blank" rel="noopener noreferrer">VC++下的 sqlite 数据库加密 | 离别歌</a>， 2. <a href="https://sqlite.org/forum/forumpost/775a68525e" target="_blank" rel="noopener noreferrer">SQLite Forum: SQLITE_HAS_CODE is gone?</a>），运行的命令行会报错：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">./configure --enable-tempstore=yes CFLAGS="-DSQLITE_HAS_CODEC" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LDFLAGS="/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055119287-849f7d0ef323bdf71b4812bc1983b56cbdd2b88d5e8ecac4c1537f737e49add9.png" alt="picture 22" class="img_vXGZ"></p><p>但你定义上述变量还比较麻烦，要去某个<code>.h</code>里，我都不知道它们在哪……其次，也不一定只是定义这个问题。</p><p>在我们的中文教程 <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">(25 条消息) Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a> 里他摸索出来的结果是这样的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055284135-3cff04278bbf581910400b65b3fb0ec043943b1d4a860da1da07a7d11472dbb5.png" alt="picture 24" class="img_vXGZ"></p><p>所以我基于他给出的命令行改成了如下（1. 删除了<code>--prefix=yourlibdir</code>这个参数； 2. 修改了<code>LDFLAGS</code>参数为我们实际的<code>libcrypto.a</code>位置）：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">./configure  --disable-tcl --disable-shared --enable-static=yes --enable-tempstore=yes --with-crypto-lib=none CFLAGS="-DSQLITE_HAS_CODEC -DSQLCIPHER_CRYPTO_OPENSSL" LDFLAGS="/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后一下就编译成功了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055366303-2d91dce8f1cfaff53f1b4959720cb43da46acaa813e69590a0ecd728aacc4b01.png" alt="picture 25" class="img_vXGZ"></p><p>接着就是<code>make</code>一下，最终会生成<code>sqlcipher</code>可执行文件：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055403556-233d2ce354ae18db283301899741d5f71fdf97cf2e450720d3cfdafe1d7d9dfe.png" alt="picture 26" class="img_vXGZ"></p><p><del>以上就代表我们的编译过程顺利完成。</del></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="update-静态编译">UPDATE: 静态编译<a class="hash-link" href="#update-静态编译" title="标题的直接链接">​</a></h3><p>刚刚那个编译好像属于动态编译，后续我在编译 python 版本的<code>pysqlcipher3</code>的时候又出现了<code>ld: library not found for -lsqlcipher</code>的问题：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072227306-9e8a15ed18d00cf7f3ecbfc851c171be72a16050db5299a7cd2782fc6486f870.png" alt="picture 43" class="img_vXGZ"></p><p>所以还是静态编译可能比较好。</p><p>重新回顾一下 <code>sqlcipher</code> 的编译教程，我们只需要知道 <code>libcrypto.a</code>的位置就可以了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072262710-734053d18c0c275c54731dc02801ef8d262fba116ac73c43b178013672cd1ba5.png" alt="picture 44" class="img_vXGZ"></p><p>（南川）注意看我是怎么找到 <code>libcrypto.a</code>的位置的，当我只知道他在<code>Cellar</code>下的时候。(其中的<code>realpath</code>命令需要<code>brew install coreutils</code>)</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072356870-5e184b304747b5c39a498bf21f082075707a60d05890f8ef7fb270cefadb0362.png" alt="picture 45" class="img_vXGZ"></p><p>接着拷贝该位置到安装参数内。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">(.pyenv) ➜  sqlcipher git:(master) ✗ ./configure --enable-tempstore=yes CFLAGS="-DSQLITE_HAS_CODEC" LDFLAGS="/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是报错了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072484888-a542b44050c96501a77a271bc4b8b68fc56e34f76dd64ff798a7c9f3b7b09f24.png" alt="picture 46" class="img_vXGZ"></p><p>这个问题其实正好就是我们动态编译错过了的但是博主碰到了的问题:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072522514-62b7f0b1639d262ede4547456661b328e4a6b32fae6c5cace9256df1236fd2e3.png" alt="picture 47" class="img_vXGZ"></p><p>跟着他的经验，也别管他的命令行怎么写的，加上参数：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">(.pyenv) ➜  sqlcipher git:(master) ✗ ./configure --enable-tempstore=yes CFLAGS="-DSQLITE_HAS_CODEC" LDFLAGS="/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a" --with-crypto-lib=none</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>立即通过！然后再运行<code>make install</code>即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072591630-f4c7e1aab4353c3361db72feda9d9bbe9ff572006e4e2424c3625a65c7cc6f62.png" alt="picture 48" class="img_vXGZ"></p><p>注意，<code>install</code>之后，可以看到，其实是把<code>libsqlcipher.a</code>等写入到了<code>/usr/local/lib</code>下面，这个路径要记得，以后其他库一般也会编到这里。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="test-sqlcipher-workflow">test <code>sqlcipher</code> workflow<a class="hash-link" href="#test-sqlcipher-workflow" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before">step 1. crypto a plain database (which is generated by our <code>sqlite</code> before)<a class="hash-link" href="#step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055516480-7d258b2f3f5c95b8ae22647f6b0221200e0458f1c70f73b597b2b2ee2491dcab.png" alt="picture 27" class="img_vXGZ"></p><p>Among the commands, the <code>attach database XXX as encrypted key YYY</code> would generate a database named XXX, which is encrypted by key YYY.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step2-test-operate-on-an-encrypted-database-without-key-expect-failure">step2. test: operate on an encrypted database without key (expect: failure)<a class="hash-link" href="#step2-test-operate-on-an-encrypted-database-without-key-expect-failure" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055718135-17c2ee6027d75abc6637815f057703e25bde0b4bac6d8c31a03694dd5d919c73.png" alt="picture 28" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success">step3. test: dump the encrypted database into plain with key (expect: success)<a class="hash-link" href="#step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055830760-6cd688ede765164c9a10e49ba478e98036e517d06d121f8b8f1a222f58d316b1.png" alt="picture 29" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step4-test-open-the-decrypted-database-without-key-expect-success">step4. test: open the decrypted database without key (expect: success)<a class="hash-link" href="#step4-test-open-the-decrypted-database-without-key-expect-success" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055943131-58c01e04c45846d54c782180d6489b888c3cf84e843252a71be57c6520f78a1c.png" alt="picture 30" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-decrypt-database">✨✨ decrypt database<a class="hash-link" href="#-decrypt-database" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="depreciated-pragma-config-of-sqlcipher-3-defaults">DEPRECIATED: pragma config of sqlcipher 3 defaults<a class="hash-link" href="#depreciated-pragma-config-of-sqlcipher-3-defaults" title="标题的直接链接">​</a></h4><p>!!!warning 我的 <code>sqlcipher</code> 版本是 <code>3.36.0</code>，这个版本默认是 <code>sqlcipher 4</code>的配置了（盲猜），而腾讯的加密用的是 <code>sqlcipher 3</code>，所以在解密文件时，必须将配置都对上（可以按照 GUI 软件<code>DB Browser for SQLite</code>一一对上），否则会出现<code>file is not a database</code> 或 <code>out of memory</code>等错误</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644067587138-c2f6c561a856b4619f0fafb2c31d203c22ae2220fe6fe31f89d3b1c6dc18848f.png" alt="picture 31" class="img_vXGZ"></p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA cipher_compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA kdf_algorithm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA hmac_algorithm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA kdf_iter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA cipher_page_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><p>core ref of pragma statements, especially sqlcipher relative: <a href="https://utelle.github.io/SQLite3MultipleCiphers/docs/configuration/config_sql_pragmas/#pragma-hmac_algorithm" target="_blank" rel="noopener noreferrer">SQL Pragmas | SQLite3 Multiple&nbsp;Ciphers</a></p></li><li><p>tencent forked sqlcipher: <a href="https://github.com/Tencent/sqlcipher/tree/4f37c817eb99e18e4fdc8ac63d67ac33610d66be" target="_blank" rel="noopener noreferrer">Tencent/sqlcipher at 4f37c817eb99e18e4fdc8ac63d67ac33610d66be</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-pragma-config-of-sqlcipher-3-defaults">BEST-PRACTICE: pragma config of sqlcipher 3 defaults<a class="hash-link" href="#best-practice-pragma-config-of-sqlcipher-3-defaults" title="标题的直接链接">​</a></h4><p>As mentioned at: - <a href="https://github.com/rigglemania/pysqlcipher3#sqlcipher-compatibility-issues" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a>, we only need to add one line of <code>PRAGMA cipher_compatibility = 3"</code> after setting <code>"PRAGMA key='password'"</code>.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069999876-2b5aae9410cd1110098e3247594c549654da13532919c803314c43565f10892e.png" alt="picture 40" class="img_vXGZ"></p><p>Here is the tested result:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644070069597-642a02966f92de01abff3777591606fdab3c9da26e799787a5d6d26fdf3d5d4b.png" alt="picture 41" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="check-salt-of-specific-database-file">check salt of specific database file<a class="hash-link" href="#check-salt-of-specific-database-file" title="标题的直接链接">​</a></h4><blockquote><p>usage</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">xxd -p -l 16 -g 0 '/path/to/foo.db'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>sample</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068254533-1ea78ae0e60ab131144b0ea1cb30d1e9d1e3c1cab3729dccc2ae528c540cf0c7.png" alt="picture 32" class="img_vXGZ"></p><blockquote><p>verification</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068327704-ea3ee6ac4f1ecbfceb32f370d0b07091175e6cf250a7c588391b197e4a0c613c.png" alt="picture 34" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068275641-5eb58026ca08887af94f8d62444540ba7a649c2ff06f7359b5280efeaf6b472e.png" alt="picture 33" class="img_vXGZ"></p><ul><li><a href="https://github.com/nalzok/wechat-decipher-macos/blob/main/macos/dbcracker.d" target="_blank" rel="noopener noreferrer">wechat-decipher-macos/dbcracker.d at main · nalzok/wechat-decipher-macos</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="decrypt-and-dump-specific-database-file">decrypt and dump specific database file<a class="hash-link" href="#decrypt-and-dump-specific-database-file" title="标题的直接链接">​</a></h4><ol><li>open our custom hook script and get the database secret info:</li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068620611-aa198000c76e33c4b248a05589b2d22107ad3339584f55104ef9105be3efc2f7.png" alt="picture 35" class="img_vXGZ"></p><ol start="2"><li><p>copy the <code>PRAGMA XXX</code> statements for specific database file</p></li><li><p>dump specific database file after decrypting</p></li></ol><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ATTACH </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'plaintext.db'</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> plaintext </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> sqlcipher_export</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"plaintext"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DETACH </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> plaintext</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069059270-6a17772f3571e1d5243cd8e94ec3a554277c5b01624e3c665f89072fffcee427.png" alt="picture 37" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li>How to decrypt the sqlcipher, when the version matches<a href="https://stackoverflow.com/questions/25132477/how-to-decrypt-an-encrypted-sqlcipher-database-file-on-command-line/53616126" target="_blank" rel="noopener noreferrer">encryption - How to decrypt an encrypted sqlcipher database file on command line? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="test-dumped-database-file-via-sqlcipher-or-sqlite3">test dumped database file (via <code>sqlcipher</code> or <code>sqlite3</code>)<a class="hash-link" href="#test-dumped-database-file-via-sqlcipher-or-sqlite3" title="标题的直接链接">​</a></h4><p>Since the database dumped has been decrypted, so using <code>sqlcipher</code> or <code>sqlite3</code> are both ok!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069170316-b3039faeffce4fa085668bb405c45b50a50f5a8721536caa6ca9f800837f0834.png" alt="picture 38" class="img_vXGZ"></p><p>!!!tip As a contrary, if we using <code>sqlite3</code> to open an encrypted database file, then the <code>PRAGMA</code> commands are always invalid, and there would be no way to decrypt the database.</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">![picture 39](https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069321523-f78eba6a3271f2e2e9cf3c2c04a83fda5e5d6e26f5289e3d3b82ad09af2bd042.png)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="wechat-design">wechat design<a class="hash-link" href="#wechat-design" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="design-of-contact-fields">design of contact fields<a class="hash-link" href="#design-of-contact-fields" title="标题的直接链接">​</a></h3><p>以某好友资料为例：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644086442066-c16483c3e89a04c951579e2b136fb4aa69ec438102d180434d3508fb8f2c50b5.png" alt="picture 62" class="img_vXGZ"></p><p>对应的可以看到数据表信息为：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644086957667-465fd289b2ac61137c90a5b656c0f8275a4f9a6b5e808bbda57c041373dc2b07.png" alt="picture 64" class="img_vXGZ"></p><p>可以知道，最有用的字段主要如下：</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">gUsrName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wxid（自动、唯一标识号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsAliasName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友的注册id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nickname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友自己设置的对外显示的昵称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemark</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 你给好友设置的备注</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他还有一些拼音相关的有时也比较适合模糊搜索，不过全拼和简拼比较适合中文，英文的话全拼不变，简拼没有（另外也可以看到腾讯的命名规则也不统一，并且还中英文混杂……）：</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">m_nsFullPY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友昵称全拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsShortPY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友昵称简拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemarkPYFull</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友备注全拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemarkPYShort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友备注简拼</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="design-of-user-id-to-contact-id-md5">design of user id to contact id: <code>md5</code><a class="hash-link" href="#design-of-user-id-to-contact-id-md5" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644079452379-26017062b0f1704882f915ce6b46afb628ae66436219c84107b993379d33363a.png" alt="picture 51" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644079510590-162cac11502d48cb7941365f272d807dbaeff5cf45edcad396ea28f9d3f3daf3.png" alt="picture 52" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://1024tools.com/hash" target="_blank" rel="noopener noreferrer">Hash 在线计算、md5 计算、sha1 计算、sha256 计算、sha512 计算 - 1024Tools</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="improve-get-self-id">IMPROVE: get self id<a class="hash-link" href="#improve-get-self-id" title="标题的直接链接">​</a></h3><p>搜索自己的昵称，但是发现没有找到，说明<code>contact</code>表里是没有自己的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644087070913-43f45ddeca29b284c48142f4d56ed38cf00132bb42ae7429702b35306c5fcedd.png" alt="picture 65" class="img_vXGZ"></p><p>所以，我们需要知道自己的 id 信息在哪里获取。</p><p>UPDATE-2022-02-06：聊天文件是以聊天对象的 md5 值作为数据库名存储的，尽管在聊天记录中基于你和对象的微信 id 使用了一个字段表示聊天方向，但同时还有另外一个整型字段标志着是否是自己，所以尽管在联系人数据库中找不到自己的 id，但不影响对聊天记录中聊天方向的识别。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="todo-get-image-from-xml">TODO: get image from xml<a class="hash-link" href="#todo-get-image-from-xml" title="标题的直接链接">​</a></h3><p>要遍历本地找！</p><blockquote><p>sample</p></blockquote><div class="language-xml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-xml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- StrRes1 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version="1.0"?&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">msg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">aeskey</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">252260f7cd231a2ee75e997483fdbe26</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">encryver</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbaeskey</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">252260f7cd231a2ee75e997483fdbe26</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumburl</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">3059020100045230500201000204d3e741cc02030f5bd102041be0cdcb020461fd7c48042b777875706c6f61645f777869645f636b3835787570386231626a32315f3335395f313634343030323337330204011d0a020201000400</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumblength</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">2906</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">120</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">55</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnhdheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnhdwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidimgurl</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">3059020100045230500201000204d3e741cc02030f5bd102041be0cdcb020461fd7c48042b777875706c6f61645f777869645f636b3835787570386231626a32315f3335395f313634343030323337330204011d0a020201000400</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">length</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">md5</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">ac0d0d7ae1c546233d2dd8bdfbaa9d37</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">hevc_mid_size</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">77982</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">msg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-xml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- messageType --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">msgsource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">bizflag</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">bizflag</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sec_msg_node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">uuid</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">e78ea49721c227614ead30b94f1dea68_</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">uuid</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sec_msg_node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">signature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">v1_IC/iNhD5</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">signature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">msgsource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li>windows version: <a href="https://bbs.125.la/thread-14304868-1-1.html" target="_blank" rel="noopener noreferrer">微信 hook 收到的图片消息怎么转换成图片呢<!-- -->_<!-- -->精易论坛</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="py-sqlcipher-instruction">py-sqlcipher instruction<a class="hash-link" href="#py-sqlcipher-instruction" title="标题的直接链接">​</a></h2><blockquote><p>core ref</p></blockquote><ul><li><p><a href="https://github.com/rigglemania/pysqlcipher3" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a></p></li><li><p><a href="https://charlesleifer.com/blog/encrypted-sqlite-databases-with-python-and-sqlcipher/" target="_blank" rel="noopener noreferrer">charles leifer | Encrypted SQLite Databases with Python and SQLCipher</a></p></li><li><p><a href="https://www.runoob.com/sqlite/sqlite-python.html" target="_blank" rel="noopener noreferrer">SQLite – Python | 菜鸟教程</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="compile">compile<a class="hash-link" href="#compile" title="标题的直接链接">​</a></h3><p>编译步骤永远都是最烦的哎，不过还好都顺利通过了。</p><p>首先是下载源代码。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/rigglemania/pysqlcipher3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pysqlcipher3</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135188856-49a3c5122a1ed7c310f07f68401278000dd70331083c333a7e55789ec6f0f97f.png" alt="picture 80" class="img_vXGZ"></p><p>其次是编译，有两种方案。</p><p><del>由于我现在系统中已经静态编译过 <code>sqlcipher</code> 已经有了 <code>libsqlcipher</code>，所以我直接<code>python setup.py install</code> 就能成功。</del></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">find /usr/local/lib -name libsqlcipher.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output: /usr/local/lib/libsqlcipher.a</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135240001-f7a7915f534bb6401b77ab8ddbb6b6d02d26e50868e209c415eb755377ab7a07.png" alt="picture 81" class="img_vXGZ"></p><p>否则的话，我需要把在 <code>sqlcipher</code> 动态编译产生的 <code>sqlite.[ch]</code> 文件都拷贝到当前目录下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135275190-5f582dbc1de9d6719751b59ae25a5141f99dd7d5153c3a59cce7ac8636f89715.png" alt="picture 82" class="img_vXGZ"></p><p>再编译<code>python setup.py build_amalgamation</code>又会发现<code>src/python3/connection.h</code>报错找不到<code>sqlcipher.h</code>了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135531747-a3367cfc37c9ea6b6cd703b9c6ca2226d37e63863a7a87ce408584f09bb0fdd5.png" alt="picture 83" class="img_vXGZ"></p><p>所以我们再……把 <code>amalgamation</code> 文件夹拷贝到 <code>src/python3/</code>下，并重命名为<code>sqlcipher</code>……（真忙啊……）</p><p>然后编译：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">python setup.py build_amalgamation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python setup.py install</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>成功通过！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135629542-210ab9f8ec0d0f66cc1175fac733cb59b5afd897a7485eef8b0a402f24b8bd27.png" alt="picture 84" class="img_vXGZ"></p><p>这样，你才能在 python 中使用 <code>from pysqlcipher3 import dbapi2 as sqlite</code>。</p><p>测试是否有 <code>pysqlcipher</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135674098-023717b49ca1c8d9104288088799b163690013c4c3004efffec37fa333576f1f.png" alt="picture 85" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="connection">connection<a class="hash-link" href="#connection" title="标题的直接链接">​</a></h3><p>如果是已解密/未加密的数据库，则使用 <code>sqlite3</code> 或者 <code>sqlcipher</code> 皆可。d</p><p>但如果是加密的数据库，则必须使用 <code>sqlcipher</code> 进入解密。</p><p>以下皆以 <code>sqlcipher</code> 演示。</p><p>命令行版：</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 一句话搞定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlcipher DB</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 验证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> PRAGMA </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"XXXX"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> PRAGMA cipher_compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>python 版：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Python 3.9.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pysqlcipher3 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dbapi2 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sqlite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pysqlcipher3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dbapi2 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">auth_db</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ddb_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Connection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">"dp_path"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db_path</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sqlite</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'PRAGMA key = "</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">db_key</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">";'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"PRAGMA cipher_compatibility = 3;"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"authenticated </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">db_file</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> conn</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="table">table<a class="hash-link" href="#table" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-all-the-tables">list all the tables<a class="hash-link" href="#list-all-the-tables" title="标题的直接链接">​</a></h4><p>If you are using pure <code>sqlite/sqlcipher</code>, then using <code>.tables</code> can list all the tables. However, it won't in the py program.</p><p>In programme, I need to using the following:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sqlite_master </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"table"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the python may be:</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">tables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'SELECT name FROM sqlite_master WHERE type = "table"'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the sample result of tx-contact table is:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644075446587-2f42b7d6a6f49cf9436ac7617a6dd20a65954db0da8d17f1967fb36032097367.png" alt="picture 49" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://stackoverflow.com/questions/82875/how-can-i-list-the-tables-in-a-sqlite-database-file-that-was-opened-with-attach" target="_blank" rel="noopener noreferrer">sql - How can I list the tables in a SQLite database file that was opened with ATTACH? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-the-columns-of-table-get-table-schema">list the columns of table (get table schema)<a class="hash-link" href="#list-the-columns-of-table-get-table-schema" title="标题的直接链接">​</a></h4><p>In sql, we can use:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- to list all the tables in the database:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- to show the schema for a given tablename:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">schema</span><span class="token plain"> tablename</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Otherwise:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA table_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And to get column names in py:</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"PRAGMA table_info(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">table_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><a href="https://www.sqlitetutorial.net/sqlite-tutorial/sqlite-describe-table/" target="_blank" rel="noopener noreferrer">SQLite Describe Table</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="format-rows-display">format rows display<a class="hash-link" href="#format-rows-display" title="标题的直接链接">​</a></h4><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- to show current configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- to show rows of columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">headers </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">mode</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nullvalue </span><span class="token operator" style="color:#393A34">-</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://dba.stackexchange.com/questions/40656/how-to-properly-format-sqlite-shell-output" target="_blank" rel="noopener noreferrer">How to properly format sqlite shell output? - Database Administrators Stack Exchange</a></p></li><li><p><a href="https://dba.stackexchange.com/questions/40656/how-to-properly-format-sqlite-shell-output/219988" target="_blank" rel="noopener noreferrer">How to properly format sqlite shell output? - Database Administrators Stack Exchange</a></p></li><li><p><a href="http://www.infinitezest.com/articles/creating-user-friendly-output-from-sqlite.aspx" target="_blank" rel="noopener noreferrer">infiniteZest.com: Creating User Friendly Output from SQLite</a></p></li><li><p><a href="https://stackoverflow.com/questions/947215/how-to-get-a-list-of-column-names-on-sqlite3-database" target="_blank" rel="noopener noreferrer">sqlite - How to get a list of column names on Sqlite3 database? - Stack Overflow</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-rows-in-one-table">list rows in one table<a class="hash-link" href="#list-rows-in-one-table" title="标题的直接链接">​</a></h4><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> XXXTABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- limit rows, skip/offset rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OFFSET</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>sample</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644075527796-64ff73b5b33e8d861f0fa9ccc81f5329e323e459977abe720cfed5e7e7ee8b91.png" alt="picture 50" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://stackoverflow.com/questions/10491492/sqlite-with-skip-offset-only-not-limit" target="_blank" rel="noopener noreferrer">SQLite with skip (offset) only (not limit) - Stack Overflow</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="extended">extended<a class="hash-link" href="#extended" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-my-openssl-versioninfo">how to know my openssl version/info<a class="hash-link" href="#how-to-know-my-openssl-versioninfo" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LibreSSL 2.8.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">built on: date not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">platform: information not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler: information not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENSSLDIR: "/private/etc/ssl"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the <code>OPENSSLDIR</code> is the config info for openssl other than the src files.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree /private/etc/ssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/private/etc/ssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── cert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── openssl.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── x509v3.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 directory, 3 files</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And as mentioned from <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a>, the built-in <code>openssl</code> on MacOS may not be suitable for our project target.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644050865960-53d51937372a7a78dc69ae4400596947dff31b8a528f5344aff55677334f6d3e.png" alt="picture 13" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://phoenixnap.com/kb/how-to-check-openssl-version" target="_blank" rel="noopener noreferrer">How to Check or Find the OpenSSL Version Easy Way</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="bugfix-error-c-compiler-cannot-create-executables">bugfix: <code>error: C compiler cannot create executables</code><a class="hash-link" href="#bugfix-error-c-compiler-cannot-create-executables" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li><p>一个 mac 用户碰到了这个问题，然后在 github 询问：<a href="https://github.com/sqlcipher/sqlcipher/issues/378" target="_blank" rel="noopener noreferrer">Installation on MacOS Catalina, C compiler cannot create executables · Issue #378 · sqlcipher/sqlcipher</a></p></li><li><p>上个用户被开发者劝退，说来这里问，但是这里没有得到回复😢：<a href="https://discuss.zetetic.net/t/sqlcipher-installation-on-macos-catalina-c-compiler-cannot-create-executables/4807" target="_blank" rel="noopener noreferrer">SQLCipher Installation on MacOS Catalina, C compiler cannot create executables - SQLCipher - Zetetic Community Discussion</a></p></li><li><p>这里看起来讨论的更热烈些，但和 <code>sqlcipher</code>无关： <a href="https://askubuntu.com/questions/647583/how-to-fix-configure-error-c-compiler-cannot-create-executables" target="_blank" rel="noopener noreferrer">command line - how to fix configure: error: C compiler cannot create executables - Ask Ubuntu</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="本项目合作伙伴">本项目合作伙伴<a class="hash-link" href="#本项目合作伙伴" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644139731203-958d64fdabac5af3a2cfdd96b1bf5d863b81d1363f8b116649256388ae8ae438.png" alt="某攻防工程师，w哥" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644139704659-4a00c03e7eed677c88c5d56b7e6853eef631a646b24f5e4dab2f9ad1d0884d25.png" alt="某支持工程师，z妹" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[札记 | 我与我周旋久，我亦是我]]></title>
            <link>https://markshawn2020.github.io/blog/2022/07/11/prose-I-am-me</link>
            <guid>/2022/07/11/prose-I-am-me</guid>
            <pubDate>Mon, 11 Jul 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[前几日，绵延一周的雨终究是停了，这同时也意味着，两年前的夏日刚来京城的那种窒息般的炎热，将接踵而至，无法拒绝。]]></description>
            <content:encoded><![CDATA[<p>前几日，绵延一周的雨终究是停了，这同时也意味着，两年前的夏日刚来京城的那种窒息般的炎热，将接踵而至，无法拒绝。</p><p>当然，更令人无法拒绝的是，河南成百上千的储户哭诉无门，甚至惨遭暴打。前日是丰县，昨日是唐山，今日是河南，明日是哪，明明日又是哪，届时又该以怎样的心情与态度去面对呢。</p><p>但，倘真只是我们这一团乱麻吗，倒也未必。说来也是，隔壁前首相前脚方才离开，忘却的救世主便要骤临了，更别提这里下台了一位，那里离奇去世一位了。</p><p>但，即便如此，似乎也未必能得出我们只得惶惶不可终日的结论来。尽管，在一款毫无技术含量、漏洞百出却具有最高权力的软件前，已经大有这样的趋势了。</p><p>但，鲜活的历史告诉我们，今人不见古时月，今月曾经照古人，一切的纷扰均是内心的纷扰，一切的不安都是内心的不安。</p><p>倘以一年去看今时今日之喜怒，倘以十年去看今月今年之困厄，倘以百年去看今生今世之无常，则怒也好、喜也罢、悲也好、思也罢，都如那镜中花水中月，一片虚无与缥缈。为人若直诚，则泾渭而已；行事若忠己，则死生而已。</p><p>如果说有什么是最值得烦恼的话，那大概是我已如此明白我既成不了普通人，也成不了伟人，连小人也是遥不可及，一者我天生便非循规蹈矩之辈，二者我资质实数平庸，三者我决然不够那样的脸面。</p><p>所以，我到底是谁，是怎样的一个灵魂寄生在我这样的肉躯之内，它的命运究竟通往何方，即便是和它朝夕相处二十余年的我，亦不能回答。</p><p>但有一点我倒是有相当的确信，那就是我并不能完全控制与驾驭它。譬如，根本无法躺平着安然入眠，这对于我来说简直不可思议。再譬如，梦中美好的或是朦胧的或是惊险的际遇，每次都深深地让自己迷恋许久，为此总要耗去成吨的时间。</p><p>末了，如果说有什么是最值得分享的话，那大抵是我与我周旋久，我亦是我。</p><p>把灯灭了，静看烟火。</p><p>把目闭了，独照此心。</p><p>愿，执我。</p><p>南川记于二〇二二年七月十一日丑时</p>]]></content:encoded>
            <category>札记</category>
        </item>
        <item>
            <title><![CDATA[编程 | 使用 pandas 研究高考志愿填报]]></title>
            <link>https://markshawn2020.github.io/blog/2022/07/02/dev-gaokao</link>
            <guid>/2022/07/02/dev-gaokao</guid>
            <pubDate>Sat, 02 Jul 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[近日，我叔为我弟高考志愿填报的事情焦头烂额。（江苏高考志愿填报竟然能多达 40 个了，你敢信！）]]></description>
            <content:encoded><![CDATA[<blockquote><p>近日，我叔为我弟高考志愿填报的事情焦头烂额。（江苏高考志愿填报竟然能多达 40 个了，你敢信！）</p><p>我心想，也许可以为他们做点数据分析工作。于是……</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="设计">设计<a class="hash-link" href="#设计" title="标题的直接链接">​</a></h2><p>高考志愿填报的核心难点，在于学校、专业众多，普通人很难抉择，尤其是中档学生，一本线以上、211 勉强，对于他们来说，可能选得好就是天堂选不好就是地狱（也只是可能，最终还得看自身）。</p><p>他正好位于这档。</p><p>（不过在日益强大的数据分析工具面前，这个问题变得不再有挑战性，回想起我曾经填志愿时还只能傻傻地拿着一本大书慢慢比对，不得不感叹当年的我还是年轻。）</p><p>在母校曹老师的援助下，我很快地拿到了权威的去年志愿数据（来源：<a href="https://www.jseea.cn/webfile/index/index_zkxx/2021-07-17/24917.html;jsessionid=8A742AC473A754778E35DFAC962B7F7A.s107_7" target="_blank" rel="noopener noreferrer">江苏省 2021 年普通类本科批次投档线（物理等科目类） - 招考信息</a>），里面有物理学科本科院校志愿最低分的数据情况，长如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766839465-3dd91a5a19354795df88ff375103b519196d6cf4c89ee94de197c944072e33f2.png" alt="picture 2" class="img_vXGZ"></p><p>这样，很快地，我们的思路就出来了，只要把我弟的数据录进去，再和这些学校比对，筛选出在他分数上下的院校即可，最好是 985、211、双一流。</p><p>因此我们的工作大致有以下几个：</p><ol><li>清洗这张表格</li><li>为这张表格加上学校标签标识</li><li>将分数录入，进行筛选</li></ol><p>以下详细展示整个流程。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="投档线数据清洗">投档线数据清洗<a class="hash-link" href="#投档线数据清洗" title="标题的直接链接">​</a></h2><p>首先查看表格，是传统的 excel，还有最让编程人员烦的跨行合并的多层标题栏，那么第一步就是重构标题栏。</p><p>根据经验，表格的跨行合并，实际上真实数据都在合并的第一行（其他为空），例如取消合并后如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766993094-7635f2a2ce0217a1f39d40ad8bf81d013b2273c86fd5200338887f632cbffe5c.png" alt="picture 4" class="img_vXGZ"></p><p>由此可以敏锐地发现，我们只需要把标题栏向下填充，使之全部对齐到第五行，就是可以被程序读取的标题栏了。而这个操作，就是 pandas 内所谓的<code>frontfill</code>（向前填充）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767020562-a50a20840b8b27bf3dea6a408e87562e13b4e05675565795bf4b63451ae212cc.png" alt="picture 5" class="img_vXGZ"></p><p>接着标题栏都是中文，并且命名过长，影响编程效率，所以有必要重命名。</p><p>此外，接着看内容，“院校、专业组（再选科目要求）”这一列信息量比较大，包含了学校名、专业组和专业限制。</p><p>其中专业组是指填报汇总后是根据大专业划分，几个比较近的属于某个专业组，例如计算机、软件、电子信息就很有可能属于同一个专业组，有点类似一级学科的意思，但也不太一样，主要是按招生对象不同，比如说中外合作的就可能在同一专业组，与其他的专业组可能专业内容上倒是相近的。这个就需要那本大书去查，网上还没有太好的信息。</p><p>专业限制是江苏专用的一套规则，按照“3+1+2”的要求，学生在语数外之外先要在“物理”和“历史”中首选一门，作为文理划分的依据；接着在剩余的 4 门（历史、政治、地理、生物）中任选两门，专业限制就是针对这两门，在曹老师的指导下我们了解到它分“不限”、“A”、“A 或 B”、“A 和 B”四种可能，分别属于不同的交并补关系（一开始我以为只有“不限”或者“A 或 B”两种可能，导致程序设计缺陷，这是我的疏忽，由于时间关系，没有做好前期统计的工作）。</p><p>因此，我们首先要做的就是把这列拆分，尤其对于专业组限制这块，一开始以为只有“或”的关系，我就把它拆成了一个数组，后来发现还有“和”的关系，这么做就不妥了，因此需要保留原字符串，后续以我弟的具体学科使用函数单独处理。</p><p>由此写出我们第一段程序，数据已经变成很干净的结构：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767765128-03a51d1d3951b6781fb07b9da0683d99840e35154dc957c85a591d82ae7fd024.png" alt="picture 7" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773876476-c52acb4fe7a714e492466d7118974935b74e9923d36e74371ce6e1d2b2ea2d56.png" alt="picture 32" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分数据结构设计">考分数据结构设计<a class="hash-link" href="#考分数据结构设计" title="标题的直接链接">​</a></h2><p>为了通用性，我们在设计考分数据结构时，设计的相对比较保守，因为里面存在一些勾稽关系，所以使用<code>@property</code>保证数据的一致性。此外，由于每年分数线差异，因此需要做换算，所以加入了<code>bias</code>乘数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767932103-7981dfd9a59b69827e93d1fc4b2589159fcf45e4dc8b3b2b64859421163813dd.png" alt="picture 8" class="img_vXGZ"></p><p>在<code>bias</code>上，默认是 1 这个很好理解；考虑到我们可能有多次对标不同年份的需求（江苏没有，因为江苏改革目前才是第二年），所以需要不断地调整 bias，因此最好的做法，是调整后再返回类本身，这样可以实现链式操作。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768075428-c7aca4cf071f20a24eb678803ce9dcec6861f3299539eee12aaeb86a969ca3a2.png" alt="picture 9" class="img_vXGZ"></p><p>链式操作示范：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768172602-572b8b5f9fd071eb6f8de7f75f3397f077051c88fb173ffc5c835fd103889bc0.png" alt="picture 10" class="img_vXGZ"></p><p>我们还在数据分的基础上，加入了排名，不过实际没有用上，因为我们没有投档线对应的排名数据。</p><p>以上就是整体的数据结构设计。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分录入年份修正风险偏好">考分录入、年份修正、风险偏好<a class="hash-link" href="#考分录入年份修正风险偏好" title="标题的直接链接">​</a></h2><p>在录入上，直接初始化即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768324016-07135822436a2483b55726287dc8bdb1d6bae7a5c98ce64a07c553b8e7e2a6cb.png" alt="picture 11" class="img_vXGZ"></p><p>在年份修正上，则有些讲究。它本质的问题是确定，今年的分数在往年值多少分的问题。</p><p>我原先想用一本分数线做测度，但是江苏已经取消一本线了，只有本科线（也就是二本线）。</p><p>我想了一下，反正这块肯定有误差，在非对标顶级 985 的情况下，直接用二本线比值作为乘数似乎也没什么不妥。</p><p>比如去年本科线是 417，今年是 429，比值是 0.97，也就是今年的 1 分等于去年的 0.97 分。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768462360-9e2dc54ba2633efd5d2238816426b980bdd189834884e9c7caa0332fa49faf1f.png" alt="picture 12" class="img_vXGZ"></p><p>在年份修正的前提下，我们还得考虑一下风险偏好，目前我们看到的都是最低志愿投档线，因此实际已经很有风险，也即是现在看到的贵校的 N 分，实际进入该专业的学生可能都是 N<!-- -->*<!-- -->k 分，k 显著大于 1。</p><p>所以正常情况下，我们得在折合分上再乘以一个系数，降低一下自身的体位，可能 0.98 比较合适，但是不排除有些人特别 risky，就想搏一搏，单车变摩托，所以我们在筛选的时候也可以适当调高点范围，这就是风险系数，我把它设置成了最高 1.02，这样能多看十分（基数是五百多）的学校。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768677788-0b18d662fcbf5800ff9947403a3a1bff8335e4666f611fe12bf9bb429b60dfb5.png" alt="picture 13" class="img_vXGZ"></p><p>看的时候，以风险调整后的分为最高分，从上往下筛学校即可。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于学科进行筛选">基于学科进行筛选<a class="hash-link" href="#基于学科进行筛选" title="标题的直接链接">​</a></h2><p>在学科筛选上，可以写的很复杂，也可以写的很简单。</p><p>比较复杂的是一遍遍地 for 循环，然后用 if 去判断，到底符不符合。</p><p>我后来想了一种比较简单的，就是用集合的思想去设计。</p><p>如果目标专业组要求是“A 和 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该等于<code>{A, B}</code>。</p><p>如果目标专业组要求是“A 或 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该与<code>{A, B}</code>有交集，也就是 $<!-- -->{<!-- -->C, D<!-- -->}<!-- --> \cap <!-- -->{<!-- -->A, B<!-- -->}<!-- --> \ne \varnothing$。</p><p>如果目标专业只有一个，也就是必须要选修它，则是子集关系。</p><p>如果目标专业为“不限”，则是恒真关系。</p><p>于是，我们可以写成这样：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769521413-46849b76826934ca106c73b9a7701078e2a4f3a490671bcaa2c05380ea5a5537.png" alt="picture 15" class="img_vXGZ"></p><p>这样，我们就把 2200 多条筛成了 17000 多条了，减少了 20%，是很不错的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-985211-筛选">基于 985、211 筛选<a class="hash-link" href="#基于-985211-筛选" title="标题的直接链接">​</a></h2><p>我们首先关注的是 985、211 类大学，看看有没有什么机会。</p><p>我们要先拿到一个标签表。</p><p>简单搜索后，我们决定使用来自这份博客<a href="https://blog.csdn.net/weixin_40683253/article/details/88417600" target="_blank" rel="noopener noreferrer">对照表 - 用心整理了一份国内 985/211 大学名单及其一流学科<!-- -->_<!-- -->黄饱饱<!-- -->_<!-- -->bao 的博客-CSDN 博客</a>的数据。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769729876-6ec048f8a3514c61dab87039788e4dad276193d4e76ebc2fa4223f0977de1134.png" alt="picture 16" class="img_vXGZ"></p><p>这是一张排版很标准的表格，如果你用 F12 去检查的话确实是标准的<code>table</code>标签。</p><p>我们如何把这个数据提取下来呢？</p><p>这可是表格，而非文字，直接复制处理起来很麻烦（但有时也未必不可以）。</p><p>要用爬虫吗？又觉得杀鸡焉用牛刀。</p><p>这时候，我突然想起来很多软件都自带表格数据提取工具，比如 excel 就有网站源数据刷新功能。</p><p>重点是，pandas 也不例外！</p><p>一行代码，轻松搞定，只要喂一下网址即可！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769873501-7d6c39430b4fb107df808e5a0e24bedc0f1b62eed6b2c395fb768b9f5e9b8c41.png" alt="picture 17" class="img_vXGZ"></p><p>看到这，你是否会很想知道它的内部实现？没错，我也想，有时间再研究研究，估计是<code>requests + beautifulsoup</code>工作流？</p><p>简单清洗后，再与原先的那张表做左联操作：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770240516-8ea1c31af98253cca91922a0aac56400e6f6e083820fbbedf6bd88ce0e5fb329.png" alt="picture 19" class="img_vXGZ"></p><p>左联操作，就是以左表（投档线表）为基础，加上额外的右表信息（不存在的就是标记缺失）。这个操作，也是数据分析中最常用的。</p><p>我们还额外地简单封装了这个染色操作，将不同风险偏好的分数段做染色处理，逻辑如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770341081-6998c83936ecc24ba531deac77fe3f58ca262143c1a8808c1e06864d19be1b0f.png" alt="picture 20" class="img_vXGZ"></p><p>这样风险偏好保守的就看绿色部分就可以，高的可以看看红色（或者作为参考）。</p><p>不过很遗憾的是，我弟这个分数 985、211 只能去到很偏远的地方，或者都是中外合作办学项目。</p><p>此路似乎不通。</p><p>也许我们可以试一试双一流。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于双一流筛选">基于双一流筛选<a class="hash-link" href="#基于双一流筛选" title="标题的直接链接">​</a></h2><p>我们同样需要双一流的标签数据，之前那个 985/211 的表里虽然也有双一流信息，但是不全，因为有些双非也是有双一流的。</p><p>我们在<a href="https://www.zhijiao.cn/syl.shtml" target="_blank" rel="noopener noreferrer">“第一轮双一流”建设高校及建设学科名单<!-- -->_<!-- -->中国教育在线</a>这里找到了我们要的数据。</p><p>于是，使用 pandas 梅开二度：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770576448-e9b1e2692c2db0c2ea3e3bea561b0ed055d42991035ceb241eb5e81c598e741b.png" alt="picture 21" class="img_vXGZ"></p><p>这样就有 140 所学校了，可选性大了些（比 92 多了 20 所左右）。</p><p>不过，既然是基于双一流专业，我们肯定更以专业为主（而非学校），所以我们需要额外加一点基于专业的筛选操作。</p><p>比如，我们预设几个计算机相关的专业，然后在双一流学科名单中筛选，看看有没有相关的关键字，再结合分数，结果……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770672616-ff47941ea168d1fadd08988e0456ccbb00b7034eb220ea73bca466601aba6e74.png" alt="picture 22" class="img_vXGZ"></p><p>Emmm.....</p><p>我陷入了良久的沉思……</p><p>既然专业好也可以，那我们为何不试试专业排名（而非紧盯双一流呢？）</p><p>这么一想，思路就开阔了，那就是软科排名！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于软科排名筛选">基于软科排名筛选<a class="hash-link" href="#基于软科排名筛选" title="标题的直接链接">​</a></h2><p>软科的排名可以在官网找到：<a href="https://www.shanghairanking.cn/rankings/bcmr/2022" target="_blank" rel="noopener noreferrer">权威发布|2022 软科中国大学专业排名|中国大学本科最好专业|就业率最高的专业</a></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770818534-227fe64e604260d36186637bab6b7cd316ffa28898512b5c944a054639535779.png" alt="picture 23" class="img_vXGZ"></p><p>我们可以在这里搜索不同的学科排名。</p><p>我们通过 F12 分析后端接口，发现有结构良好的 json 数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770883806-8dadd0900400c59c6a851d2077d3b2d6d8b23f5a7339968a677687287b7644ce.png" alt="picture 24" class="img_vXGZ"></p><p>因此，可以考虑直接用爬虫的手段，毕竟每个搜索结果都要翻页十二十次，这显然是必须走自动化了。</p><p>经过测试，如果不加 cookie，则获取时只会返回前 20 条，加了 cookie 就可以返回完整结果。</p><p>cookie 也就是这个：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770970159-0ae108ab6bd0574e833f4bd2a18024a6c47d10756f69d4ecb2cab4364f3b39c2.png" alt="picture 25" class="img_vXGZ"></p><p>我们把它复制出来，封装一下，就可以设计出得到任意学科的排名数据的接口了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771058309-c544701861ec45612783fb4431526257be2ddda268f7c61409431d984ab5b7d0.png" alt="picture 26" class="img_vXGZ"></p><p>此外，我们注意到这个接口需要传入学科的编码，因此我们还要设计一个接口获得完整的编码列表。</p><p>经过分析，发现任何一个排名接口里已经包含了这份数据（的拷贝），因此我们可以首先调用任意一个专业的排名接口，然后解析出编码列表，代码如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771264185-63f98497dd56ca34dac37663c757faefde4e26b0d6fd0cf561fcaa46a22ea22b.png" alt="picture 28" class="img_vXGZ"></p><p>但这只是我们编码好的字典，还不具备输入一个学科名就返回一个学科编号的功能，因此还要封装一个检索函数：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771335922-69e0acfca3bdbe912eda019c67b32ee84ef240c4a990adb99939982c3407b63a.png" alt="picture 29" class="img_vXGZ"></p><p>手动修正所有目标专业的准确名称后，我们就可以正式进行分析工作了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773095464-9a349621f747035122e030e8cfd4cc51b7c7e659c8448cbfcf229141a32abb55.png" alt="picture 30" class="img_vXGZ"></p><p>此处唯一多需要注意的是，软科 api 里的<code>ranking</code>是字符串格式的整数，然后到我们 pandas 中也默认是字符串。</p><p>如果我们需要对<code>ranking</code>进行排序，就要先转换成整数；但如果我们在联表的的时候没有把非排名院校给筛掉（每份排名名单只有小几百所学校），就会导致数据缺失（变成<code>pd.NaN</code>），从而无法转换成整数，这是需要注意的。</p><p>解决办法就是要么直接把那些学校筛掉（比如本例）；要么就是使用<code>pd.numeric</code>函数，里面有两个参数<code>errors</code>和<code>downcast</code>可以控制异常如何处理。</p><p>技术部分就是这样！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="复盘">复盘<a class="hash-link" href="#复盘" title="标题的直接链接">​</a></h2><p>其实本期最大的收获就是：</p><ul><li><p>对于有 211 分的，直接对照 985、211、双一流名单去选就好了；</p></li><li><p>对于有一本分的，建议对照软科排名去选</p></li><li><p>对于其他的……</p></li></ul><p>我今天终于了解到了二本怎么选的了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773375309-4cb693ae7f66b693d8fe2ab68b0c049f09d7e728c376b15ffd822cf0537d3d68.png" alt="picture 31" class="img_vXGZ"></p><p>哈哈哈，不得不说这是一个很好的思路！</p><p>以上！</p><p>（全部<code>ipynb</code>程序文件可以后台回复“<strong>使用 pandas 研究高考志愿填报</strong>”。）</p><p>最后感谢我叔提供的素材，以及再次感谢曹老师的热心援助，希望我弟和天下学子最终都能选到心仪的学校，学有所成，不枉此生！</p>]]></content:encoded>
            <category>开发笔记</category>
            <category>数据分析</category>
        </item>
        <item>
            <title><![CDATA[编程 | GoPro 02: 玩转 OpenLab]]></title>
            <link>https://markshawn2020.github.io/blog/2022/06/16/dev-gopro-2</link>
            <guid>/2022/06/16/dev-gopro-2</guid>
            <pubDate>Thu, 16 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1. 方案 1：物理手段解决]]></description>
            <content:encoded><![CDATA[<ol><li>方案 1：物理手段解决</li><li>方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算</li><li>方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<ol><li>浮层大小</li><li>浮层内容</li><li>浮层位置</li><li>二维码生成</li><li>二维码使用</li><li>缺陷</li><li>其他用处</li></ol></li><li>*<!-- -->方案 3 个人笔记<ol><li>LAB01: how to install the labs firmware</li><li>LAB02: QR Controls For Settings</li><li>LAB03: add an overlay to viedeo</li></ol></li><li>最后一点感受</li></ol><p>在上一期【文章：gopro】中，我们提供了一种借助 gopro 基于延时摄影从而底层本高质量地全程记录个人生活的解决方案，实测中这个方案仍然有一些不足之处，本期就重点探讨时间戳相关的问题。</p><p>这个问题其实很关键，因为我们正在做的事情是长时间无感拍摄，目的是为了后期复盘，但在复盘过程中，由于延时时间跨度过长，我们希望知道视频里的每一帧所拍摄的实际时间，比如是某月某日的下午两点还是夜间十点，这是一个很自然的需求。</p><p>但很可惜，这个问题并不容易解决。</p><p>以下便基于这个问题，提供实际可行的三种方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-1物理手段解决">方案 1：物理手段解决<a class="hash-link" href="#方案-1物理手段解决" title="标题的直接链接">​</a></h2><p>如果你是一个比较传统的、具有较强时间观的人，也许这种方案特别适合你，那就是直接选购一款挂钟（这也是我在上篇文章中所采用的方法）。</p><p>例如，我们这里有一段使用挂钟时期的成品视频：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655354709985-843159c3c155958989a9d5791053dbaecaca765cf48c91ebed9afd66f5c1d33a.png" alt="picture 3" class="img_vXGZ"></p><p>将我们的挂钟摆在所拍摄视频中的合理位置，既增强了画面构图感，也能实时知道每一帧所对应的真实时间，这确实有一石二鸟之效。</p><p>但很可惜，这种方案，并未能坚持多久，原因是，廉价的挂钟机芯转动声音影响到了自己的睡眠。</p><p>按照我对睡眠无声的要求，在依次关闭空调、窗户、电脑散热器、硬盘柜之后，室内的声音强度耳测应该已经低于 30 分贝，此时挂钟的声音就显得尤为明显了。</p><p>尽管它不大，但确实也没那么动听，至少甚至不如星际穿越的曲子《Tick-Tock》的前奏。</p><p>除非我愿意花更多的时间与金钱去筛选到另一款真正无声的挂钟，但作为一名程序猿，也许有更廉价与炫酷的方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-2借助opencv基于文件创建时间进行推算">方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算<a class="hash-link" href="#方案-2借助opencv基于文件创建时间进行推算" title="标题的直接链接">​</a></h2><blockquote><p>本节参考：- <a href="https://www.theeminentcodfish.com/gopro-timestamp/" target="_blank" rel="noopener noreferrer">GoPro TimeStamp - The Eminent Codfish</a></p></blockquote><p>事实上，由于我们的延时摄影采用了固定时间间隔的方案（有关“自动时间间隔”与“固定时间间隔”方案的差异与优劣，也在上篇文章中有阐述），因此只要我们知道视频的任何一帧所对应的真实物理时间，我们就可以基于等差数列算法进行推算。</p><p>而这，恰恰可行，因为 gopro 的视频输出格式为 mp4，里面保存了文件的创建时间。</p><p>不过，这个文件创建时间，可不是我们在电脑上看到的那个文件创建时间，这不是同一个概念。</p><p>例如，我们这里有一段视频的开头显示是 6 月 15 日 10 点 05 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355366257-b01f6386d8aaa7fc57ca802956a6fd73fc4f6628385437e0055b8bd94622b6f9.png" alt="picture 4" class="img_vXGZ"></p><p>但在我们的文件管理器上查看该文件的创建时间却是 6 月 16 日 10 点 57 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355421774-dc43ac335c5f11ebcbda9c81edde670f3e7f285321771c5f1a0ad443f8f22e2a.png" alt="picture 5" class="img_vXGZ"></p><p>这显然不是时区的问题，而是操作系统问题，即在操作系统里定义的文件创建时间是该文件在本地磁盘上首次产生的时间，而非文件本身的首次创建时间（对于该视频来说，尤指该视频开始拍摄的时间）。</p><p>但我们并非没有手段获取实际视频创建时间，答案就是基于软件解析的手段：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655356074973-cf5d985ee99cf99c2e87527c0ea19e095d2c433ceb7bed96d27be097804bb0ba.png" alt="picture 6" class="img_vXGZ"></p><p>上述代码使用了<code>ffprobe</code>这个指令解析了我们的 mp4 文件，从结果中的<code>creation_time</code>标签得到了我们想要的视频创建的真实时间，于是乎，最难的问题解决了。</p><p>接下来，我们就基于视频领域的一些基本概念为我们的视频加上时间戳信息。</p><p>第一步是关于帧的。</p><p>在之前文章中我们说我们的视频是每 5 秒延时拍摄一帧，也就是每过一帧实际时间就要<strong>大致</strong>加五秒，这是一个很重要的信息。</p><p>而整个流程就是使用 opencv 读取我们视频的每一帧，然后算出该帧的时间，然后将格式化的时间戳放到那一帧上面去，最后再输出成一个新的视频，这个过程就叫“烧录”。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ref: - [GoPro TimeStamp - The Eminent Codfish](https://www.theeminentcodfish.com/gopro-timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> subprocess </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tqdm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tqdm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> get_file_creation_time </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FONT_COLOR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># blue, green, red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'_with-timestamp'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Opens the video import and sets parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VideoCapture</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isOpened</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"failed to open video of </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">file_path</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FPS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_WIDTH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_HEIGHT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frames_cnt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_COUNT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># float -&gt; int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> frames_cnt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initializes time origin of the video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_creation_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_frame_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f"frames_cnt: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, FPS: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">FPS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, initial_timestamp: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cur_frame_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, dimension: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> x </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, duration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Command to send via the command prompt which specifies the pipe parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'ffmpeg'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-y'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (optional) overwrite output file if it exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-f'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'rawvideo'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Input is raw video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-vcodec'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'rawvideo'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-pix_fmt'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'bgr24'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Raw video format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-s'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'x'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># size of one frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-r'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># frames per second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-i'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'-'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The input comes from a pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-an'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Tells FFMPEG not to expect any audio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-vcodec'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'mpeg4'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">'-b:v'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'10M'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sets a maximum bit rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># output file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Open the pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stdin</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'====== OpenCV is processing ======='</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_time_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Reads through each frame, calculates the cur_frame_time, places it on the frame and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># exports the frame to the output video.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tqdm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frames_cnt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"ERROR: failed to read frame of [</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur_frame_time </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Date: '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Time: '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> image </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'====== finished ======='</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_used_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> process_time_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f"used time: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, video period: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, multiplier: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time </span><span class="token string-interpolation interpolation operator" style="color:#393A34">/</span><span class="token string-interpolation interpolation"> duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stderr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'__main__'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/Volumes/Disk1/videos/gopro日常/gopro延时生活/2022-06-14/GH011701.MP4"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358120832-aa46758f93ddc61e960a10c274e8fb7ea49276b152f7d3fa6e343d02c1e2bc9a.png" alt="picture 7" class="img_vXGZ"></p><p>可以看到，基本一比一的处理速度，也就是说原视频时间有多长，程序运行时间就有多长，对于延时摄影来说，一天的录制输出大概就是十分钟的视频，因此脚本每天的运行时长也就是在十分钟左右，这是可以接受的。</p><p>不过这个脚本也有一点点小问题。</p><p>第一个问题是每次读取到第二十帧的时候就会报错，之后就没问题，不明白什么原因，也似乎不影响程序的表现，这个属于 opencv 范畴的问题了，留到以后再考虑了。</p><p>第二个问题就是输出的视频文件比原文件要小很多，直接差了十倍……：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358301337-0a3bc21ac1b530ed8f43053e33a9dc99fc89d90bd464a0e3335c942c9c01ab41.png" alt="picture 8" class="img_vXGZ"></p><p>我们放在一起比对了一下，发现分辨率是没区别的，区别可能是在编码上：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358410672-57cab49192da7b59eed7ba618c39d6d255cee16c69296294643a68eff01f401d.png" alt="picture 9" class="img_vXGZ"></p><p>实际看了一下，发现确实画质上有较大区别，比如原视频的白墙很光滑：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358467434-475e70206879f5478766392201a3660654973eec188934dfe157dbd2a24e0bb0.png" alt="picture 10" class="img_vXGZ"></p><p>但编码后的白墙就明显有那种类似波纹的效果了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358486566-93f149d18618d08ed0741e37dce78415d64e105c79d847a015f57ce19da5d9f1.png" alt="picture 11" class="img_vXGZ"></p><p>从这个角度上说，如果不考虑修改脚本，使之输出原质量的视频，那么我们的脚本输出的视频就只能当做备份与参照视频了，毕竟十倍的比率确实也有一些用武之地。</p><p>然而，这个脚本实际上还有另一个问题，那就是时间不一定能对齐。</p><p>比如刚刚文件对比图上，一个是 20 秒，一个是 19 秒，当然这个其实没有太大所谓了（虽然很非遗所以，也许就是和上面那个有两帧无法处理的问题有关），我更关心的是另一个对齐问题，曝光与时间间隔。</p><p>就是，怎么说呢，我现在并不确定 gopro 的曝光与拍摄间隔之间的关系，比如说，假设我们设置拍摄间隔为 2 秒，曝光时长为 1 秒，那么它是每 3 秒拍一次照片还是每 2 秒拍一张呢？</p><p>如果是每 3 秒拍一次照片，那么我们的算法每一帧加 5 秒就有问题，因为没有算上曝光时间，这样就会导致累积时间变少。</p><p>但如果是每 2 秒拍一张照片，那么更极端的一个情况，例如拍摄间隔为 1 秒，曝光时长为 2 秒，则似乎就无法拍摄了……</p><p>所以，这里有研究一下的必要。</p><p>总之，这种借助 opencv 进行后期处理的手段还是有一定实用价值，适用于很多其他的领域，是一种通用技术手段，我们有必要掌握，并且我对熟练掌握 opencv 之后输出我们想要的视频结果的可能性抱有很高的期望，除了曝光与拍摄间隔对齐的问题之外。</p><p>但输出的画面质量不佳（若提高质量（假设可行），势必速度会下降）与额外脚本运行的不便等因素，使我最后选择了第三种更干净的方案：<code>GoPro Labs</code>。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3借助gopro-labs添加时间戳浮层">方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<a class="hash-link" href="#方案-3借助gopro-labs添加时间戳浮层" title="标题的直接链接">​</a></h2><p>如果说第二种方案属于后期，那么本方案则属于前期了。</p><p>众所周知，防患于未然，能从前期着手的方案，基本都是最优的。</p><p>而 GoPro Labs 就能帮助我们实现这点。</p><p>我们要做的事情就是：</p><ol><li>下载 GoPro Labs 的固件版本，完成固件升级（我的 GoPro 是 9，是支持的）</li><li>制作我们的时间戳浮层二维码，扫描后使用</li></ol><p>主要通过这个网站： <a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a> 生成我们所需的二维码，这里的每个参数都比较重要，我们一一解释：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层大小">浮层大小<a class="hash-link" href="#浮层大小" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359589767-225e990742d950f8587e2c402e3368a9e244f5412a936ac5d47065be0bfe3eea.png" alt="picture 12" class="img_vXGZ"></p><p><code>vertical size</code>是浮层的整体高度，而非单个文字的高度，由于浮层支持多行文本，因此为了目标字体大小，多行文本时对应的竖直高度也要变高，我们设置为 60，对应三行文本，（也就是每行 20，单位大概是像素），效果不错</p><p><code>horizontal size</code>是浮层的整体宽度，因为这个底层是按行排版文本，因此我们直接设置成 0，让它自动调整浮层的宽度即可，即所有行中最长的行的宽度</p><p><code>offset from the edge</code>是与画面边缘（应该是 Y 轴，因为 X 轴距离可以通过下文的换行符控制）的距离， 目前使用的是 10，效果还不错</p><p><code>Limit dispaly time</code>设置成 unlimited 即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层内容">浮层内容<a class="hash-link" href="#浮层内容" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359884415-4a3b036583d6c3be88ca734bf9e9e51f76a3f6600c7ca7d3a5fd2751f4609384.png" alt="picture 13" class="img_vXGZ"></p><p>这个就是配置我们的自定义文本与时间、日期的地方，它是一行行下来的，可以自己用<code>\n</code>分隔符换行（但不可以换顺序，所以时间始终在日期之前）。</p><p>为了从简，我没有加任何个人自定义短语（一开始加了自己的昵称，后来觉得太冗余了，所以还是留空了），但我在尾部加了两个空行，这是为了主动地增加相机与底部（X 轴）的边距，这样输出的视频里的时间戳在我 mac 电脑上预览时不会被进度条挡住。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层位置">浮层位置<a class="hash-link" href="#浮层位置" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360216872-e9f80b49b95e94ae25f967b4693cdd17aef45684d829b5e2986a0b246b40e314.png" alt="picture 16" class="img_vXGZ"></p><p>我将时间戳放在了左下角，因为我平常会在右下角办公，而画面中上部则是主体区域。</p><p>我们的场景中不需要使用 GPS。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码生成">二维码生成<a class="hash-link" href="#二维码生成" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360265681-720de6db987621a49e2a200321fcffca430ef8a599e20145dd6d7804e5b3aba5.png" alt="picture 17" class="img_vXGZ"></p><p>在生成二维码附近还有是否选择<code>active</code>的选项，我之前一开始捣鼓 lab 时弄出了 bug，在 模式设置：<a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a> 中设置出了一个没有的模式，导致系统死掉，最后刷回 GoPro9 1.5 的稳定固件版本，然后重新升级到 lib 版本才恢复，这其中既有可能是模式问题，也有可能是这个浮层当时选了<code>permanent</code>选项，因此我现在已经完全不敢点这个选项了。但并不影响我目标功能的实现。</p><p>基于这些，最终的二维码就生成了，它对应的 QR Command 是：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN="(0,60)[BLHH:MM:SSaa mm-dd-yyyy]\n"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以后我直接基于这个 Command 字符串进行修改即可，还是很方便的，比如加上自定义前缀与后缀的结果如下：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN="(0,60)哈哈哈[BLHH:MM:SSaa mm-dd-yyyy]略略略\n"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们用函数去表达这个字符串输出就是：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_gopro_overlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_edge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_leading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_ending</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f'g0oMBRNO=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_edge</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">oMBURN="(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_leading</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">[BL</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_fornat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_ending</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意到，我们的时间格式也是可以自定义的，并且如果我们基于从字符串（而非网页交互）出发去生成二维码，那么我们就可以定义日期在前时间在后的格式了，比如<code>yyyyy-mm-dd HH:MM:SSaa</code>。虽然这一点未经过测试，但想必是可行的（写文章时才意识到的，hh~）</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码使用">二维码使用<a class="hash-link" href="#二维码使用" title="标题的直接链接">​</a></h3><p>只需要将升级成 lab 固件版本的 gopro 打开后对准我们的二维码，就会自动识别并应用了，然后“BOOM”，一个可爱的浮层就出现了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360991571-d8d1b7e0310840ea24d4942d811b06c8afce5eb567d92a10db6ca0642adcd2f5.png" alt="picture 18" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="缺陷">缺陷<a class="hash-link" href="#缺陷" title="标题的直接链接">​</a></h3><ol><li>除了上文提到的容易导致系统挂掉之外，正常操作不会有问题</li><li>经测试，我们的时间戳浮层对照片和夜间延时没有效果，对普通视频与正常延时有效果。经过思考，我这个项目一开始采用夜间延时的方案现在觉得不太适用，因为实测下来在夜间我屋子几乎全黑的环境下即使开了夜间延时也几乎无法拍出能看清的画面，而白天看投影时又会导致曝光过高，因此直接放弃夜间的效果即可。当初拍夜间是为了监测睡眠，那段时间也会在睡觉时留一盏小灯（戴眼罩）以获得最好的拍摄效果，现在睡眠项目已经结项了，因此不需要了。我也更喜欢无声+全黑的睡眠环境。</li><li>关于上一点，也好像不是没有解决方案，正如我笔记中记载的 <a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a> 这篇帖子里的小哥貌似碰到的就是和我差不多的问题并有一个解决方案，但我暂时已经不需要了，以后有机会再研究吧！</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="其他用处">其他用处<a class="hash-link" href="#其他用处" title="标题的直接链接">​</a></h3><p>GoPro Labs 的功能不仅限于添加浮层这一项，恰恰相反，这是里面最小的一个应用之一。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655361326041-ae5359c76c082cda93c03f928c7e5ad513c1636b7dd46f1865dbf5e6b75e3da9.png" alt="picture 19" class="img_vXGZ"></p><p>它还有很多其他有趣的场景应用，必须运动检测、自动切换模式等，详情可参考：</p><ul><li><p><a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p><a href="https://www.youtube.com/watch?v=YaXcu0E10WM" target="_blank" rel="noopener noreferrer">(151) GoPro Labs: How to Use QR Codes to Instantly Switch Your Settings - YouTube</a></p></li><li><p><a href="https://www.youtube.com/watch?v=0LCGiO7jMEw" target="_blank" rel="noopener noreferrer">(151) GoPro Labs 2021 New Features for Hero 9, Max, Hero 8, Hero 7: Hands-on Details &amp; Explainer - YouTube</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3-个人笔记">*<!-- -->方案 3 个人笔记<a class="hash-link" href="#方案-3-个人笔记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab01-how-to-install-the-labs-firmware">LAB01: how to install the labs firmware<a class="hash-link" href="#lab01-how-to-install-the-labs-firmware" title="标题的直接链接">​</a></h3><p>see <a href="https://gopro.com/en/us/support/hero9-black-product-update" target="_blank" rel="noopener noreferrer">Hero9 Black Product Update | GoPro</a>, but I failed to generate the target firmware in this site.</p><p>So I downloaded it in other place, e.g. - <a href="https://www.goproforums.com/threads/need-hero9-black-firmware-update-v1-5.87636/" target="_blank" rel="noopener noreferrer">Need HERO9 Black firmware update v1.5 | GoPro Forums</a>, which directed me to the dropbox download page: - <a href="https://www.dropbox.com/s/edh41nffo6d6gns/GoPro%20Hero%209%20firmwares%20fishycomics.zip?dl=0" target="_blank" rel="noopener noreferrer">GoPro Hero 9 firmwares fishycomics.zip</a></p><p>And finally, I saved two different firmwares in local disk, one for stable version, one for the lib one:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655351979322-5f9d394f99b48f506a3fb28de9adadfd94be9ebc9f57562d3925e88635f16863.png" alt="picture 2" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655340186034-7e904daaa952ca0a5c3457c103fcddaa9eaee79362a7051a179ef1ca14576416.png" alt="picture 1" class="img_vXGZ"></p><p>ref:</p><ul><li><a href="https://community.gopro.com/s/article/GoPro-Labs?language=en_US" target="_blank" rel="noopener noreferrer">GoPro Labs Information</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab02-qr-controls-for-settings">LAB02: QR Controls For Settings<a class="hash-link" href="#lab02-qr-controls-for-settings" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><p>documentation: <a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p>custom qr control: <a href="https://gopro.github.io/labs/control/custom/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/custom/</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab03-add-an-overlay-to-viedeo">LAB03: add an overlay to viedeo<a class="hash-link" href="#lab03-add-an-overlay-to-viedeo" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a></li></ul><p>ref:</p><ul><li><p><a href="https://community.gopro.com/s/question/0D53b00008HOPq7CAH/how-do-i-add-timestamp-to-hero-10-videos?language=en_US" target="_blank" rel="noopener noreferrer">How do I add timestamp to Hero 10 videos?</a></p></li><li><p><a href="https://www.reddit.com/r/gopro/comments/pt6u8j/burning_timestamp_on_gopro_movie/" target="_blank" rel="noopener noreferrer">Burning timestamp on GoPro movie : gopro</a></p></li></ul><p>bugfix: gopro labs won't add timestamp to interval videos, see:</p><ul><li><a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后一点感受">最后一点感受<a class="hash-link" href="#最后一点感受" title="标题的直接链接">​</a></h2><p>国外的极客生态真地很繁荣，一个小小的 gopro 就能玩出这么多的花样，反观国内，似乎还停留在各种参数的堆砌与各种大饼的圈画上，实则看不到太多对待一个具体的事物（而非钱）研究的诚意与专注的热爱。</p><p>之前携国货之光大疆无人机奔赴川藏线，它真地很好。但现在身处帝都，最终还是无用武之地，幸好有位天体物理博士愿意收购它，让它继续发光发热。而我，则只有尽我可能，把一些有趣的东西搞的更明白一些、更有用一些、更好玩一些。</p><p>gopro 的话题，从上篇的 open-gopro 到本篇的 GoPro Labs，基本已经涉及了 gopro 核心开发生态的方方面面，朋友们需要时完全可以顺着这两篇一窥 gopro 的里子，进而玩出新的花样。</p><p>下一期，我们聊聊最近做的另外一个有趣的小东西：投影与手机遥控器。</p><p>Best Wishes to All of You.</p>]]></content:encoded>
            <category>开发笔记</category>
            <category>GoPro</category>
        </item>
        <item>
            <title><![CDATA[编程 | GoPro 01: 全天候自动 4K 延时摄影]]></title>
            <link>https://markshawn2020.github.io/blog/2022/06/11/dev-gopro-1</link>
            <guid>/2022/06/11/dev-gopro-1</guid>
            <pubDate>Sat, 11 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[背景]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>北京难得下雨，因此，一旦下雨就会想起什么。</p><p>可是，人的记忆力总是有限的，也是虚无的。</p><p>人毕竟是肉体凡胎，人与人之间需要有实体的互动。</p><p>而最有效的实体，便是从古代的文字，到近代的照片，再到现在的短视频。</p><p>这是时代的进步，但我想，或许还可以更进一步，例如随着 CPU、硬盘等信息技术的升级，未来建立全息个人档案的可行性将会逐渐增大，以至于，人类或许能够拥有完整追溯一个人过往以及重生一个人的能力。</p><p>但这项技术落入大众消费的范畴还远不可敢想，然，并非绝无希望的可能。</p><p>最近，恰好因了疫情的肆虐，我偶然间探索出了一种以视频完整记录人生的解决方案。</p><p>那就是：全天候自动 4K 延时摄影！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h2><p>首先我们要明确我们的目标，我们想完整录制自己的人生，如果可行，需要什么条件。</p><p>首先，我想，分辨率不能太低，不然没眼看，因此至少也得是 1080p，最好是 4K，因为 4K 基本能看清我们任意想看的细节。</p><p>我们就以 4K 为例，探讨一下硬件要求。</p><p>以 GoPro 摄像机为例，4K30 帧录制 10 分钟的文件大小大约在 4.5G，于是一小时便是 27G，一天便是 648G，一年便是 231T。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654933516441-c8e243bc1634d339e694d3bdb9d0a308e5125301669d0575f125f5087595bb0f.png" alt="picture 3" class="img_vXGZ"></p><p>231T 是什么概念。。。</p><p>显然不可行。</p><p>有段时间，我下决心解决我睡眠质量不好的问题，我想到了一个方案，把自己每天的睡眠录制下来，那个时刻，我第一反应便是延时！</p><p>没错，延时摄影非常适合长时间观察某个对象的场景：睡眠监控、人生监控，都非常适合。</p><p>说干就干，我监控了自己一周的睡眠：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654933983322-9d01b4747ab1a07349b3818fb8af23b5f42218ad6e0e2f821c56731b55adb5d9.png" alt="picture 4" class="img_vXGZ"></p><p>不过一开始由于没有啥经验，因此每天复盘自己的拍摄成果，至少解决了以下几个问题：</p><ol><li>gopro 的电池容量并不大，4k 视频录制一小时就要关机了，因此需要配一根充电线保持实时输电状态录制。</li><li>一开始选用的是夜景延时的默认自动时长选项，这导致了拍摄出来的延时短片没光时帧少，有光时帧多，这是有好处的，对后期非常方便。但其实不太适合我们的需求，因为我们只需要平凡的记录，不需要做啥后期，忽快忽慢的拍摄不利于自己对时间的把握，尤其是有光的时候，gopro 拍的太快了，导致文件体积增大，也可能不太符合预期。后来摸索得出，把每帧时长控制在 5 秒，既可以控制 10 分钟内拍完一整晚，输出的文件不用分片。5 秒的帧间隔有啥意义呢，按照 30p 来算的话，一秒本来需要 30 帧，而现在 30 帧对应了真实世界的 150 秒，所以等于把实际世界压缩了一百多倍。回想我们之前说的 231T，如果除以 150，我们得到了 2，也就是一年的延时录制只需要 2T 的硬盘就可以了，我们买一张 16T 的机械硬盘，将允许我们录制 5 年以上！因此，硬盘方面的问题解决了。</li><li>尽管我们使用了固定的帧间隔，我们很多时候还是想知道拍摄的任意一帧是处于什么时间，我查阅了一些资料，有个比较复杂的 python 脚本可以允许对 gopro 的视频添加时间层信息，但我觉得没有必要。我想到了一个有意思的办法，那就是买了个挂钟，能同时显示日期和时间的挂钟（不需要很贵），这样就很直观了： <a href="https://item.jd.com/63986225561.html" target="_blank" rel="noopener noreferrer">康巴丝（Compas）挂钟时尚卧室客厅办公时钟日历挂表简约创意石英钟表 2941Y 日历黑白色直径 30cm【图片 价格 品牌 报价】-京东</a></li><li>gopro 的无线方案其实远比想象地要复杂，官网介绍的是通过手机 gopro quik 软件连接 gopro，并支持预览和操控 gopro，而 pc 端的话要用 usb 连接读卡器，从而完成文件管理。这个步骤其实很繁琐，我想尝试无线的方案。后来我找到了 gopro 的开源代码库：<code>open-gopro</code>、<code>goprocam</code>，前者是 gopro 官方代码库，后者是某个人开发的 wifi api。前者功能比较全面与底层，后者 sdk 做的比较友好方便，但支持 wifi。从理论上说，我们使用<code>goprocam</code>的 wifi api 可以在电脑已经连接到 gopro 后，直接使用程序完成自动下载、清理存储的目标，但仍不够自动化，于是我又花了整整一天的时间研究明白了不需要手机 app 直接全程在电脑端控制 gopro 的原理与实现路径。</li><li>全自动化。由于我们最终设计出了完全可以自动的程序，所以又花了一下午研究清楚了基于<code>crontab</code>的定时工具，完成了全流程自动化，一切，是那样完美地运行着。</li></ol><p>接下来，将详细展开该解决方案中的一些问题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-gopro-的全天候自动-4k-延时摄影系统设计">基于 GoPro 的全天候自动 4K 延时摄影系统设计<a class="hash-link" href="#基于-gopro-的全天候自动-4k-延时摄影系统设计" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="设备依赖">设备依赖<a class="hash-link" href="#设备依赖" title="标题的直接链接">​</a></h3><ol><li>一台 gopro 9+设备（否则不支持<code>open-gopro</code>），可持续充电，固定房间某个角落</li><li>一台电脑，安装了<code>python 3.8+</code>，定时运行转储程序</li><li>一个 2T 以上空间的机械硬盘，定时转储视频</li><li>不需要网络，在转储时，gopro 会自动开启一个本地局域网（但为了不影响实际 wifi 工作，我们的程序还是做了无线网络切换模块）</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="全自动化流程">全自动化流程<a class="hash-link" href="#全自动化流程" title="标题的直接链接">​</a></h3><div class="language-mermaid codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-mermaid codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">flowchart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start[开始]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ConnectGoproViaBle["PC蓝牙连接gopro设备（将自动打开gopro）"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ShutterOff["关闭gopro的摄影（否则无法执行文件传输）"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; EnableWifiAndConnect[打开gopro的wifi并连接]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; TransferFiles[讲gopro的文件转储到PC磁盘]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; DisableWifi["关闭gopro的wifi，复原PC的wifi连接"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; Switch2NightLapseMode["切换GoPro到夜景延时模式，设置好参数"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt; ShutterOn[开启gopro的摄影]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- "一天后（十分钟的延时输出）" --&gt; ConnectGoproViaBle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pc-端直接控制-gopro-拍摄下载清空的实现方案">PC 端直接控制 gopro 拍摄、下载、清空的实现方案<a class="hash-link" href="#pc-端直接控制-gopro-拍摄下载清空的实现方案" title="标题的直接链接">​</a></h2><p>首先，我们要知道 gopro 的无线通信框架，参见：<a href="https://gopro.github.io/OpenGoPro/" target="_blank" rel="noopener noreferrer">Open GoPro : Open GoPro</a>可以知道 gopro 只可以被蓝牙唤醒，然后被蓝牙、wifi 或者 usb 控制，文件管理功能只允许 wifi 或者 usb。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654935369129-4e3b66fb37ca6630f9389861c10eea1305355c9dc0b659bc5d74036a531bec75.png" alt="picture 5" class="img_vXGZ"></p><p>因此要先启动蓝牙连接，成功后再开启 wifi 进行文件传输。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> binascii </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hexlify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> bleak </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BleakScanner</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BleakClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">const </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> COMMAND_REQ_UUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_WIFI_BASE_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_WIFI_GP_COMMAND</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GOPRO_MEDIA_DIR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> CONFIG_WIFI_GOPRO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CONFIG_WIFI_HOME</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CURRENT_DATA_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_media_online_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> base</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wifi </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> connect_wifi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_wifi_connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># suppress unnecessary mac ble error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"bleak.backends.corebluetooth.scanner"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">setLevel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CRITICAL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyGoPro</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_current_data_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CURRENT_DATA_PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">notification_handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f'&lt;--- Response: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">handle</span><span class="token string-interpolation interpolation operator" style="color:#393A34">=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">hexlify</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:#e3116c">":"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation conversion-option punctuation" style="color:#393A34">!r</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Notify the writer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"\n==== datetime: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">now</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"电脑第一次与gopro配对时，需要保持gopro处于设置面板选中quik应用连接界面，直到收到所有返回消息方可确认配对成功"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"程序运行之时，请确保没有其他进程正在执行，手机quik不要处于预览状态，否则将导致连接不上！"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gopro_device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 1. 扫描蓝牙设备。正常情况下，要扫描1-2遍。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> gopro_device</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"---- Scanning for bluetooth devices... [#</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">count</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># 需要蓝牙权限，例如pycharm、terminal、iterm之类的应用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> device </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> BleakScanner</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">discover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"detected ble device: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">startswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"GoPro"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        gopro_device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                count </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"found gopro：</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">gopro_device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 2. 连接蓝牙设备。配对自动进行，mac平台跳过（待确认）。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"----- Establishing BLE connection to </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">gopro_device</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BleakClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gopro_device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 太短的话会导致连接失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"BLE Connected!"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 3. 获取通知。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"---- Enabling notifications..."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> service </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> char </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">characteristics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"notify"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> char</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"Enabling notification on char </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">char</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">uuid</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_notify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">char</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> notification_handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Done enabling notifications"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> Exception </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"Connection establishment failed: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> desc </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"Sending command of: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        desc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"---&gt; Requesting: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> desc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write_gatt_char</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COMMAND_REQ_UUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">bytearray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Wait to receive the notification response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 比如开启wifi之间就需要时间间隔</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_load_timelapse_preset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://gopro.github.io/OpenGoPro/ble_2_0#commands-quick-reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x04</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x3E</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xEA</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Loading timelapse preset"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Control shutter: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ON"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> on </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"OFF"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        wifi名称和密码的程序化获取方式，参见`tutorial_5_connect_wifi/wifi_enable.py`</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :param on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_send_command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0x03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Control wifi: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"ON"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> on </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"OFF"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_check_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">func</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        对需要使用wifi的函数装饰检查与修复</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> is_wifi_connected</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> wrapper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">list_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GOPRO_WIFI_BASE_URL </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/gopro/media/list"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        date_ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">today</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isoformat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"media_list_</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">date_</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"w"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> indent</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">download_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"downloading file: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fn</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_media_online_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_current_data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"wb"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"saving into: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"√"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> option</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GOPRO_WIFI_GP_COMMAND </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/storage/delete"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> res </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'√'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delete_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> media_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        删除单个文件时，网址结尾的"delete"不能带"/"</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :param media_name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"deleting media: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">media_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">option</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f"?p=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">GOPRO_MEDIA_DIR</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">media_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@_check_wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">delete_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">warning</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"deleting all the media"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_delete_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/all"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">task_daily_download_all_the_videos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my_gopro </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MyGoPro</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># connect_ble part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect_ble</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># wifi part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># wifi打开之间需要停止拍摄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connect_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">CONFIG_WIFI_GOPRO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"---- downloading all the media"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">dir</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">list_all_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"media"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"traverse media in dir: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation builtin">dir</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">'d'</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">dir</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"fs"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">file</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"n"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">download_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_single_media</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># TODO：将gopro无线桥接到路由器，从而化简该步</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 最终要保证wifi回来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connect_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">CONFIG_WIFI_HOME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_wifi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># continue part</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_load_timelapse_preset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> my_gopro</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">send_command_enable_shutter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'__main__'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 若以下任务是类的一个方法，则需要使用loop，如果是一个全局函数，则可以直接用run，参考：https://cloud.tencent.com/developer/article/1598240</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task_daily_download_all_the_videos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该代码主要参考<code>open-gopro</code>仓库里的<code>samples</code>，做了不少的修改与自己的封装，核心难点是<code>asyncio.Event</code>的使用。</p><p>除去技术上的难点，在产品上也有不少的坑。首先官网和绝大多数文章都只告诉你怎么用手机连 gopro，而鲜有用电脑无线练的。</p><p>我也是抱着尝试的心态，在 gopro hero 9 中打开“连接设备-quik 应用”后，直接在电脑端启动脚本成功连上的，这说明，手机 gopro quik 软件的连接原理和<code>open-gopro</code>仓库是等同的。</p><p>另外，蓝牙连接要使用到<code>bleak</code>底层库，也有一些可以忽略的<code>Error</code>信息，这些都需要花时间去鉴别，幸而没有大问题。</p><p>紧接着，由于蓝牙属于系统的敏感权限，因此脚本启动时，需要确保有蓝牙权限，一般情况下会弹窗，否则得自己加（比如<code>terminal.app</code>、<code>iTerms.app</code>、<code>/usr/sbin/cron</code>等），这一步将直接劝退对操作系统不怎么熟的程序员，因为你几乎找不到任何相关的资料。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654936750010-9948c6c0a74e620066ed5e9a6a952f1f0961b37c910bbc5e6186dc774ed7098c.png" alt="picture 6" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于crontab自动化的定时程序">基于<code>crontab</code>自动化的定时程序<a class="hash-link" href="#基于crontab自动化的定时程序" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化的必要性">自动化的必要性<a class="hash-link" href="#自动化的必要性" title="标题的直接链接">​</a></h3><p>尽管程序我们写好了，已经可以运行，自动控制 gopro 的开启、录制、转储等功能，但是得每天都运行一遍，否则 gopro 的存储卡（我放的是一张 128G 的存储卡）将很快被撑爆（尤其是录制视频而非延时的话）。</p><p>而每天手动执行是很烦的，并且由于执行过程中需要连接到 gopro 的无线网络，因此本地就没法联网了。所以最适合的办法是让电脑自动夜间执行，达到无感的目的。</p><p>我想了想，最佳的时间点是凌晨五点，此时大多数情况下环境已有微光，能看清，而自己一般都在熟睡，不会有太大的动作；而 gopro 自动操作的哔哔哔声，也一定程序上有益于自己的早起。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化的充分性">自动化的充分性<a class="hash-link" href="#自动化的充分性" title="标题的直接链接">​</a></h3><p>我们要回到项目的起点上，我们做这个工程的意义是什么？</p><p>是为了如实地记录自己的人生，而非是一场作秀，对不？</p><p>那就尽量做到无感，甚至忘记这个项目！</p><p>当一切做到自动化之后，很多时间里自己都不知道自己是处于被记录的状态，这才是我们最想要的。</p><p>因此，我们需要自动化</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="自动化方案选择">自动化方案选择<a class="hash-link" href="#自动化方案选择" title="标题的直接链接">​</a></h3><p>在 mac 平台上，至少有两种，一种是基于<code>crontab</code>，这也是 linux 通用的解决方案。</p><p>还有一种是使用<code>launchtl</code>和<code>plist</code>的方案。</p><p>考虑到兼容性，以及自己在 linux 平台上的经验，我选择使用<code>crontab</code>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="crontab自动化的核心难点"><code>crontab</code>自动化的核心难点<a class="hash-link" href="#crontab自动化的核心难点" title="标题的直接链接">​</a></h3><p>理论上当我们的程序已经写完之后，将程序喂给<code>crontab</code>然后自动化运行，是再自然不过的事情了。</p><p>然而，我们的项目却有点不一样。</p><p>首先就是我们刚刚说的蓝牙权限的问题。由于<code>crontab</code>是一个后台程序，因此不会弹窗提醒你要不要允许系统权限，而是直接报错。</p><p>所以我们首先要跟踪<code>crontab</code>的输出，这是写自动化脚本的基本素养。</p><p>其次在定位到问题之后，要把我们的蓝牙权限交给<code>cron</code>。</p><p>另外还有一个问题，在我们的程序中，我们调用了 mac 的系统调用去控制 wifi，其中在 mac 平台上连接名称为 A 密码为 B 的 wifi 的命令如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">networksetup </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">setairportnetwork en0 A B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但这里有两个问题，首先是如果我们的名称里有引号，则会被 unix 系统识别错误，我们需要这么写：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">networksetup </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">setairportnetwork en0 </span><span class="token string" style="color:#e3116c">"A's wifi"</span><span class="token plain"> B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>open-gopro</code>项目里这部分代码就写的很粗糙，他们直接用单引号去包括 wifi 的名称和密码，这在 wifi 名称或密码里包含单引号时将导致错误。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937659590-88b30ece6e4293f6afb3eb8ae4aede13181898295cbdc091e4018cb7820f6716.png" alt="picture 7" class="img_vXGZ"></p><p>其次还有个问题：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  ~ which cron</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/cron</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  ~ which networksetup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/networksetup</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然<code>cron</code>和<code>networksetup</code>都处于<code>/usr/sbin/</code>目录下，但当<code>cron</code>运行时，系统路径里却只有少的可怜的<code>PATH</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937962014-a80cc8825496fdadf5accafe126bebf7946caa645260b2c11dcab3f1714b00ce.png" alt="picture 8" class="img_vXGZ"></p><p>因此在<code>cron</code>程序中，无法直接调用<code>networksetup</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654937983944-008f34e4649edee4440f96ea27e4393531862f2afb22b537bdaaf21c89d52102.png" alt="picture 9" class="img_vXGZ"></p><p>最简单的做法，是在我们的程序中显式指定<code>networksetup</code>的路径：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/networksetup en0 A B</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样，将原程序配置到<code>crontab</code>实现自动化的所有问题都解决了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654938110099-ae0481c9ff2f6985d6600f24ebde0b9e42a8e769a2aac5f16b198fc263d8dcd7.png" alt="picture 10" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="说在最后的话">说在最后的话<a class="hash-link" href="#说在最后的话" title="标题的直接链接">​</a></h2><p>绝大多数人的生命都是平淡如水的，因为我们不是 Harry Porter，不是那个"The Chosen One"，甚至连被 Voldemort 选中的资格都没有。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939590506-29c337c9cec89eabb7e6c8dc7b37c5f7065924b240cb6048257c5a59839adbdf.jpg" alt="picture 14" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939607377-f83d60721de76b09feb989c7caaeca87e37d56a62a6ebe6aee8e1e473875bde6.jpg" alt="picture 15" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654939631870-02c8906434c94a7a8cd9def6fd0a9e403bedff56f85490c819248e0e503a7d7f.jpg" alt="picture 16" class="img_vXGZ"></p><p>我们有的只是当下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/my-gopro-1654938185985-7bd847c645a3d6c3b71a7b9fb712c384dba992c7efb1f44292faadd5366bec1a.png" alt="picture 11" class="img_vXGZ"></p><p>最后借一部短片 <a href="https://www.bilibili.com/video/BV1Rv4y1w7hA?p=1&amp;share_medium=iphone&amp;share_plat=ios&amp;share_session_id=FC6EA2F7-5433-42F2-B9E1-1ED0F5A232A1&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1654581591&amp;unique_k=0kUaMFS&amp;vd_source=9cb028fe6c978c6816626901d9249eb1" target="_blank" rel="noopener noreferrer">“cheems，你要去码头整点薯条吗？”<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a> 结束本文：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot2.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot3.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot4.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot5.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot6.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot7.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot8.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot9.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot10.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot11.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot12.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot13.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot14.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot15.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot16.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot17.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot18.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot19.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot20.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot21.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot22.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot23.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot24.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot25.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot26.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot27.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot28.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot29.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot30.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot31.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot32.jpg" alt="xxx" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/screenshot33.jpg" alt="xxx" class="img_vXGZ"></p><p>【音乐：The Time To Run(Finale)】</p>]]></content:encoded>
            <category>开发笔记</category>
            <category>GoPro</category>
        </item>
        <item>
            <title><![CDATA[编程 | iOS 自动化实现王者荣耀一键换装]]></title>
            <link>https://markshawn2020.github.io/blog/2022/06/06/dev-ios-automation</link>
            <guid>/2022/06/06/dev-ios-automation</guid>
            <pubDate>Mon, 06 Jun 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1. 概要]]></description>
            <content:encoded><![CDATA[<ol><li>概要</li><li>秒换装概念与分析<ol><li>秒换装的难度阶梯</li><li>备战出装换装的优点</li><li>备战出装换装的缺点</li><li>换指定装的实现分析</li></ol></li><li>iOS 秒换装实现之语音控制（Voice Control）实现自定义手势</li><li>iOS 秒换装实现之越狱、第三方应用</li><li>秒换装实现之基于外设硬件</li><li>iOS 秒换装实现之基于 iOS 自动化：<code>facebook-wda</code>（WebDriverAgent）</li><li>UI 自动化的缺点（行走中的触控集成问题）<ol><li>多点触控集成</li><li>封号的风险</li><li>需要 USB 接入</li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="概要">概要<a class="hash-link" href="#概要" title="标题的直接链接">​</a></h2><p>本篇主要讲解在 iOS 平台上如何实现王者荣耀一键换装。安卓由于有<code>adb</code>的存在，自动化远比 iOS 简单的多得多，因此不在本文探讨范畴内，感兴趣地可以参阅以前发的笔记：</p><p>【文章：安卓系统】</p><p>（其实主要是自己目前用 iOS 比较多，所以懒得再写 Android 部分）</p><p>本文核心参考：</p><ul><li><p><a href="https://www.jianshu.com/p/da1e00777273" target="_blank" rel="noopener noreferrer">IOS + Appium 自动化教程 - 简书</a></p></li><li><p><a href="https://github.com/openatx/facebook-wda" target="_blank" rel="noopener noreferrer">openatx/facebook-wda: Facebook WebDriverAgent Python Client Library (not official)</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装概念与分析">秒换装概念与分析<a class="hash-link" href="#秒换装概念与分析" title="标题的直接链接">​</a></h2><p>众所周知，王者荣耀的高端局经常涉及到两个骚操作：秒换装、三指操作。本篇主要将秒换装的操作，三指的话随缘说吧。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装的难度阶梯">秒换装的难度阶梯<a class="hash-link" href="#秒换装的难度阶梯" title="标题的直接链接">​</a></h3><p>不同的换装顺序难度是不同的。</p><p>最简单的是换复活甲，因为复活甲的缓冲时间是 2 秒，并且大多数情况下复活甲是用在对方一波技能打完之后：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417265352-4adad444d58e652ab28960d7be6a3ce444de0f1759ae52d635e21db60a393f67.png" alt="picture 1" class="img_vXGZ"></p><p>其次是换金身，缓冲时间是 1.5 秒。但直到现在，我金身换其他（复活甲、名刀）等都换不来，原因是金身是主动释放，一般都是躲技能的紧急时刻，手忙脚乱的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417294961-eca0d2824084e1fba5f20ec52ad44f50b7e36e7c4e62d05ebc59a9503d92b744.png" alt="picture 2" class="img_vXGZ"></p><p>接着是名刀，缓冲时间只有 1 秒，远程英雄（例如我的诸葛）直接减半。0.5 秒是真地只能换个锤子了。不过名刀其实比金身要好一些，因为触发名刀的场景大多数情况下是在跑路的时候，这个时候不需要什么其他操作，边走边换就可以。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654417411153-c17a01f9f0f7b77a407b263dbbd036c4a2ac81c7b8f7debc33da0bdb8a67c1b6.png" alt="picture 3" class="img_vXGZ"></p><p>而换装的核心操作，就是首先先在商店预选好下一件装备（通常走在路上的时候），或者基于预先设置好的出装顺序（缺点等会说）。然后就可以通过四次点击实现换装，在不引起混淆的情况下，我们称这种换装为“一键换装”：</p><ol><li>点击商店</li><li>点击卖出</li><li>点击关闭</li><li>点击购买（第一个推荐装备，如果钱够的话）</li></ol><p>换的核心是卖掉一个再买进一个，如果格子还没满，钱又多，就不存在换的问题，直接就到第四步，这个没啥操作。但如果格子满了，或者钱不够，就需要极快地时间内精准地按下四个键，这个要求是很高的。反正我也曾经尝试在训练营中练过会，表示紧张时刻并不能跟的上。</p><p>因此需要自动化！毕竟，为这样一款游戏苦练换装的手速是不值得的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="备战出装换装的优点">备战出装换装的优点<a class="hash-link" href="#备战出装换装的优点" title="标题的直接链接">​</a></h3><p>备战出装换装的优点也是很显著的，我们可以很简单地备战最后一套出装顺序是复活甲、金身、名刀、血手、炽热支配者。</p><p>这样，假设我们有一键换装脚本，即可轻轻松松地按顺序秒换复活甲、金身、名刀、血手、炽热支配者，十秒换五装。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418687276-36ebbc351388d23a3489aa3b6dcc3d0e6b77794643b4892fcb1e238cc2933d00.png" alt="picture 5" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418656646-e6fc345e3680afe24a83524181fdcb2dd12b94b000e5af6fc6cfcb5e87e20555.png" alt="picture 4" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654418923667-471c1cc58cd7497a08732c9a5e9ed57b95fac43a413d6970912f95157b347991.png" alt="picture 6" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="备战出装换装的缺点">备战出装换装的缺点<a class="hash-link" href="#备战出装换装的缺点" title="标题的直接链接">​</a></h3><p>首先是不灵活，局越高端，就越需要针对对方阵容出装，此时的备战出装如果只有一套的话，就很不灵活了。</p><p>我很久以前喜欢玩中单诸葛的时候，就预设了三套出装：暴力（回响+帽子+大书）、防近身（帽子换面具、大书换法穿棒）、防回血（回响换梦魇）。现在比较喜欢在局中随机应变了，但这就引发了新的问题：顺序问题，即如果局中先买了其他装备，则有可能会影响预期顺序。</p><p>例如假设原先六神装最后两件一次是法穿杖、复活甲，由于逆风局中途先出了个魔女抗压，然后快六神的时候，按照顺序第六件变成了法穿杖，第七件才是复活甲，所以按照默认顺序的话，危机关头一键换装就没有换到想要的复活甲。</p><p>所以”手动“预选下一件换装装备的必要性还是有的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="换指定装的实现分析">换指定装的实现分析<a class="hash-link" href="#换指定装的实现分析" title="标题的直接链接">​</a></h3><p>有些场景下，我们需要换指定装，尤其是复活甲。</p><p>比如无论你在玩什么英雄，并且玩的很顺风，突然不小心有个失误被集火了，如果能瞬间换个复活甲，等待队友的输出，可能就对局势有至关重要的影响；或者在最后守水晶或者冲水晶时需要自己用复活甲换对面的输出。</p><p>换指定装的核心难题，最主要的难题是要卖掉哪件装备。</p><p>大多数情况下，最合适的选择，是卖掉鞋子，因为太便宜了，后期的附属属性就不高；其次是最贵的装备，否则可能买不起指定装。</p><p>由于格子是顺序装装备的，因此实际上，我们不太清楚要卖的装备一定在哪个格子里。所以市面上有比如说预先设置好卖掉第六个格子然后买新装备的这种，我认为必要性不高。个人认为，换指定装最佳的方式，还是在和平时提前选好要卖的装备与要买的装备，然后在战时直接使用一键换装。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之语音控制voice-control实现自定义手势">iOS 秒换装实现之语音控制（Voice Control）实现自定义手势<a class="hash-link" href="#ios-秒换装实现之语音控制voice-control实现自定义手势" title="标题的直接链接">​</a></h2><p>在 iOS 平台上，目前最适合小白用户使用的官方办法，是基于语音控制。</p><p>所谓的语音控制，倒不是各种 AI 或者 siri 之类的智能语音控制，而是 iOS 自带的辅助功能里的语音控制，用户可以自己自定义一条语音指令，并未其搭配上手机要执行的输入或者点击动作。</p><p>于是我可以指定一条比如“乌拉”，然后设置其的动作为在屏幕上依次点击四个点（一键换装）的位置。保存之后，就可以通过大喊一声“乌拉”去触发它。</p><p>听起来很酷，但这种办法有几个缺点。</p><p>第一个缺点，是在配置这个点击动作时，它展示的是一个纯白的界面，实际上你不知道自己点的位置对应游戏里的哪个点。</p><p>这几乎只能从硬件上解决：比如我撕了几块小胶带，对照着截图提前贴在屏幕上的对应位置上，有些 B 站视频是用了记号笔，我没有这种可以画在贴膜上的记号笔。</p><p>第二个缺点，是一键换装的点击位置比较靠近边缘（购买键、关闭键），而 iOS 的手势定制时则必须先点击下方的“隐藏控制”，然后才能完整录入四个点的位置，并等待十秒后才能退出（虽然不影响后续操作，但每次都要运行 10 秒的脚本确实不够理想，从完美主义角度来说）。而最关键的就是即使屏幕上有四个标识好的坐标，手指去按时，也很难按照顺序按到最快，毕竟人手始终有反应速度的问题。因此理论上可能至少要 0.5 秒，实际在 1 秒左右。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654518617422-360051627d089bd41668ad94c8f5109559d3c87a2f93740a294b15f693c1ff1d.png" alt="picture 1" class="img_vXGZ"></p><p>如果前两个缺点还只是可以克服的小问题，那么第三个缺点就无法忽视了，那就是启动延时。由于 iOS 的语音控制，需要经过一套算法去识别你有没有喊“乌拉”这个词，因此需要时间，而这个时间，在恒定的一秒左右。所以通过这个办法，至少我测试下来，当我从喊乌拉时到换装完成，实际耗时要在 2.5 秒左右。这个时间，说实话，很不可以接受。</p><p>比如我玩诸葛时有套“富贵险中求”的连招就是“2 冲刺+1+3+金身+2 追击或者撤退”，一套操作都是几乎瞬间完成的，此时如果我们在用完金身后再语音控制进行换装，那基本上是不现实了。</p><p>考虑到这种情况，我后来想了个办法，就是提前喊口令。因为在喊完口令后，要大概一秒才会触发换装，所以我就在准备冲锋时先喊“乌拉”，再按“2+1+3+金身”，此时等待换装完成，然后再后续操作。</p><p>这听起来有点奇怪，非常奇怪，有种蒙太奇的感觉，但它确实是某些场景的有效的解决方案。</p><p>哦对了，最后，说一下语音控制中英文的问题，由于中文指令至少要四个字起步，因此建议配置英文指令，可以很简单的比如说用“f<!-- -->*<!-- -->*<!-- -->k”完成，乌拉不属于英文，但你可以自己配置“wula”的词汇。再者，中文的识别难度肯定比英文大，苹果毕竟是美国的公司，用英文都已经 1 秒延迟了，别说中文了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之越狱第三方应用">iOS 秒换装实现之越狱、第三方应用<a class="hash-link" href="#ios-秒换装实现之越狱第三方应用" title="标题的直接链接">​</a></h2><p>刚刚讲了用苹果官方的语音控制来实现自定义手势以完成一键换装的办法，缺点最主要的是执行时的延迟。</p><p>那有没有其他的软件可以帮助我们更快的反应呢？</p><p>有。但如果我们不越狱的话，几乎没有可用的，比如按键精灵之类。</p><p>反正病毒风险很高，也基本都要收费。</p><p>越狱是不需要收费的，但越狱代价是很高的，普通小白肯定没必要考虑，不然手机就不保修了。</p><p>另一种办法是通过外设实现。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="秒换装实现之基于外设硬件">秒换装实现之基于外设硬件<a class="hash-link" href="#秒换装实现之基于外设硬件" title="标题的直接链接">​</a></h2><p>就我所了解到的，国内至少有飞智和北通两家公司在做基于王者荣耀、吃鸡等游戏的外设生态开发，用户只需要购买他们的手柄接上，就能在软件里自定义每个按键的宏动作，从而实现一键换装、英雄连招等操作了。</p><p>我实际体验过北通 H2 和飞智黄蜂 2 两款外设，首先值得肯定的是他们的外设确实是有效的，完全没有上述语音控制的延时问题了。</p><p>但接着个手柄（单手柄或者双手柄）玩王者之类的游戏，还是有点奇怪，因为实际没有完全脱离屏幕，比如比较畅销的黄蜂 2 左手手柄，确实右手的放技能还得在屏幕上比较方便，毕竟每个技能都要摇动，不是一般手柄能够实现的。一般的游戏手柄只有两个摇杆。</p><p>但也有不少问题。北通 H2 的硬件连接、手感、颜值上要逊色于飞智黄蜂 2（当然北通价格也更便宜点），此处暂时不展开对北通 H2 的评价了，是我去年体验的，不太记得了。飞智黄蜂 2 最近体验了一下，说一下它的优缺点。</p><p>首先是优点吧，颜值、做工（据说是日本摇杆）、连接、软件上整体做的都非常不错，体验很好。</p><p>缺点的话，苹果的横屏游戏默认是顺时针旋转 90 度，也就是屏幕顶部是左边。而苹果 13 的摄像头是凸起的，此时如果接黄蜂飞智 2 的左手手柄，会发现不够稳定（如果是接右边则非常贴合），当然由于上下还是能够用力压住，所以还是能用，只是摄像头那部分被压着，感觉不太好。</p><p>这里完全不建议用户把手机开启自动旋转后，逆时针转 90 度后搭配飞智黄蜂 2 玩，否则会发现按键位置完全反了，没法用。飞智官方是推荐大家关闭旋转使用的。但我实际体验下来，通过先逆时针旋转 90 度然后锁定方向后，再去飞智里重新配置（进去再保存再出来，不用更改），其实也能用，只是偶尔会转来转去，这点上是飞智自己的软件没优化到位，或者不愿意担风险，因为硬件操控屏幕的原理是物理坐标点固定的，旋转屏幕后坐标点没变，但游戏中却变了。飞智毕竟是通过软件提前固定好坐标点，所以如果不关闭自动旋转，用户在游戏中旋转手机后则必然出现问题。</p><p>不过对于我来说，还有几个小问题。</p><p>首先是性能过剩，飞智黄蜂 2 配备了摇杆、A 键、B 键、LT 键、LB 键、扳机键，键位对我来说太多了，我其实只要一个键就可以了，这款手柄更适合玩吃鸡。更适合我的其实是飞智的另一款手柄：<a href="https://item.jd.com/100026396908.html" target="_blank" rel="noopener noreferrer">壹柄</a>，它只有一个摇杆和按键。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654520323055-0d1446ea4ae813235202b5d5307b68dbb6a36bf250d31342094d62afe68cc00b.png" alt="picture 3" class="img_vXGZ"></p><p>另一个黄蜂 2 的问题，就是摇杆的位置太偏上了，导致我的手型不是特别舒服，不像直接在屏幕上玩，虎口的角度大概在 45 度，用飞智直接变成 5 度了。</p><p>综上这些考虑，我还是把黄蜂 2 退掉了，毕竟那个价格给我的体验达不到期望，性能也绝对过剩。</p><p>壹柄的话后续我也没有继续考虑，因为我在研究飞智的软件时，同步研究了不越狱情况下对 iOS 自动化的实现办法，而这最终成功了，那就是大名鼎鼎的 wda：WebDriverAgent。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ios-秒换装实现之基于-ios-自动化facebook-wdawebdriveragent">iOS 秒换装实现之基于 iOS 自动化：<code>facebook-wda</code>（WebDriverAgent）<a class="hash-link" href="#ios-秒换装实现之基于-ios-自动化facebook-wdawebdriveragent" title="标题的直接链接">​</a></h2><p>wda 是什么？从名字来看：WebDriverAgent，网页驱动代理，这个对于我（一名专业的爬虫工程师）来说太熟悉不过了，我们平常用的 selenium 自动化框架其实背后都需要一个 driver，比如 phantom、google 的 chromedriver 或者 firefox 的 geckodriver。</p><p>那 wda 的作用就是把整个手机系统的 ui 操作，集中到这个 wda 身上，通过 wda 向下调用系统的 ui 操作指令，从而完成自动化。</p><p>在 iOS 平台上，这个系统 ui 操作指令的框架，是苹果自带的<code>UiAutomation</code>（已废弃）和<code>XCTest.framwork</code>。</p><p>在我配置 wda 的过程中，经历了漫长而又痛苦的调试过程，一开始我是直接用 facebook 官方的<code>WebDriverAgent</code>进行配置的，结果各种 bug，主要是我的 xcode、我的手机系统（iOS15）太新了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521247615-7aa64babfae21ba5e4aa3f7312675df1823496646c8005d524c0cd502dc50db3.png" alt="picture 4" class="img_vXGZ"></p><p>爬坑的过程可以参考：- <a href="https://www.cnblogs.com/hong-fithing/p/15203980.html" target="_blank" rel="noopener noreferrer">WebDriverAgent 重签名爬坑记 - 温一壶清酒 - 博客园</a></p><p>当时就是卡在了第二步，百般搜索都得不到解决办法，结果竟然找到一个国人把四步都走完了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521364105-3d2dd53b80df2fd385b651734d5867196d488eedae1961875d73b22dadab17ad.png" alt="picture 5" class="img_vXGZ"></p><p>但尽管如此，基于 facebook 的这个 wda，我最终还是有一步没有搞定，那就是<code>inspector</code>不出截屏图片，我看了原因，还是有一句代码没过，所以这个代码确实太老了。</p><p>最终，我选择了文章里说的方法二，也就是基于 appium 里面的 wda，一下就成功了，果然代码还是得用新的。</p><p>新的 wda 里也没有<code>inspector</code>，而且<code>session</code>默认返回<code>null</code>了，我以为又是我的操作的问题，后来在 <a href="https://testerhome.com/topics/23554" target="_blank" rel="noopener noreferrer">返回的 json 串 sessionId 为什么是 null · TesterHome</a>确认了是新的版本设计。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654521693689-9d8b15bb0e192e41c9d11220eb29b5e68314d402eaf407d714543a2a5f31c2d6.png" alt="picture 6" class="img_vXGZ"></p><p>最后一切 ok 之后，使用<code>facebook-wda</code>的 python 客户端进行连接，果然成功了，然后就可以通过代码控制屏幕的触摸手势了，一切都非常丝滑。</p><p>不过使用<code>WebDriverAgent</code>也有一些问题，最大的问题是由于底层使用了 iOS 自带的 Test 框架，所以会有两行字“Automation Running, Hold...”在屏幕上随机浮动，有时会长时间不提示，有时就会一直都在，虽然是层“Overlay”半透明的，但是很烦，这个没法去除。</p><p>另外有一个问题是屏幕没动作每隔两三秒就会自动变暗，于是我在执行脚本的时候启动了两个线程，一个线程捕获键盘动作执行脚本，另一个线程每隔 2 秒钟点击一下屏幕上的（0, 0）处坐标，保持屏幕常量，实测有效。</p><p>以下是现成的执行代码脚本：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> wda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># wda.DEBUG = True # default False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTP_TIMEOUT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># default 60.0 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DURATION </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IS_RUNNING </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># url = "http://169.254.101.229:8100"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># url = "http://192.168.1.3:8100"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:8100"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># session_id = 'B957CEB2-26D7-489E-A659-B37F24823ABD'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'00008110-000634163E9B801E'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># c = wda.Client(url=url)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># c = wda.Client()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果只有一个设备也可以简写为</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># If there is only one iPhone connected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> wda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">USBClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Show status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Wait WDA ready</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">wait_ready</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 等待300s，默认120s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_Y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8837606837606837</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.34360189573459715</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_6 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.6994470774091627</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CHOOSE_X_INTERVAL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0711690363349131</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (CHOOSE_6 - CHOOSE_1) / 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> IS_SHOPPING_OPEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> IS_SHOPPING_OPEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"打开商店"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.06872037914691943</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.4111111111111111</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     print("商店已打开")</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"卖出装备"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8270142180094787</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.8017094017094017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"购买装备（在商店中）"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8270142180094787</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.9017094017094017</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> IS_SHOPPING_OPEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> IS_SHOPPING_OPEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IS_SHOPPING_OPEN </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"关闭商店"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.8609794628751974</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.08034188034188035</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     print("商店已关闭")</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"购买第一件推荐装备"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.13361769352290679</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.40615384615384615</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_k_bought</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    选中第i个已买的装备</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param i: 从1到6</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"选择第</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">格已买装备"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CHOOSE_1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> CHOOSE_X_INTERVAL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CHOOSE_Y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_move</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"筛选【移动】（鞋子）"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.13230647709320695</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.6068376068376068</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"筛选【攻击】"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.12717219589257503</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.30256410256410254</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select_defense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"筛选【防御】"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.12717219589257503</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.55056410256410254</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    购买名刀</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"购买名刀"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 滑动到名刀页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">swipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.45</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    购买复活甲</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"购买复活甲"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_defense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 滑动到复活甲页</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">swipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.65</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&gt;&gt;&gt; 一键购买复活甲"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&gt;&gt;&gt; 购买名刀"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_switch_for_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    一键换预选装</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&gt;&gt;&gt; 一键换装"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&gt;&gt;&gt; 清空装备"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        select_k_bought</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_one_buy_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"&gt;&gt;&gt; 购买推塔装"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        速击之枪</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42101105845181674</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.8008547008547009</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        风暴巨剑</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42338072669826227</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token number" style="color:#36acaa">0.1811965811965812</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 买攻速鞋</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_move</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">click</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.42101105845181674</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token number" style="color:#36acaa">0.8257264957264957</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DURATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 再买攻速装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_gongsuqiaing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buy_fengbaojujian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close_shop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_keep_awake</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_monitor_input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> keyboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ESC'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_switch_for_first_recommended</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"f"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_buy_fuhuo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"m"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_buy_mingdao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"q"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> keyboard</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_pressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"g"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run_one_buy_attacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'__main__'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> threading </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Thread</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_monitor_input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process_keep_awake</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> daemon</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这些硬编码的坐标也需要通过一个脚本获取，我是基于 opencv 实现的：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">ref:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    - [Displaying the coordinates of the points clicked on the image using Python-OpenCV - GeeksforGeeks](https://www.geeksforgeeks.org/displaying-the-coordinates-of-the-points-clicked-on-the-image-using-python-opencv/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    - [How to draw Chinese text on the image using `cv2.putText`correctly? (Python+OpenCV) - Stack Overflow](https://stackoverflow.com/questions/50854235/how-to-draw-chinese-text-on-the-image-using-cv2-puttextcorrectly-pythonopen)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># importing the module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> jstyleson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jstyleson</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">coors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># function to display the coordinates of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># of the points clicked on the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">click_event</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flags</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># checking for left mouse clicks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EVENT_LBUTTONDOWN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the Shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the image window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        font </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_SIMPLEX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">','</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> font</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        coors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'image'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># checking for right mouse clicks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> event </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EVENT_RBUTTONDOWN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the Shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the coordinates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># on the image window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        font </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_SIMPLEX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        g </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        r </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">','</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">','</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> font</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'image'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># driver function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"__main__"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">input</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"脚本名："</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># reading the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'assets/攻击.png'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    h</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> channels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"w: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">w</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, h: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">h</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># displaying the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'image'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># setting mouse handler for the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># and calling the click_event() function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">setMouseCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'image'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> click_event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># wait for a key to be pressed to exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">waitKey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># close the window</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">destroyAllWindows</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">coors</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">fn</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"w"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> indent</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="ui-自动化的缺点行走中的触控集成问题">UI 自动化的缺点（行走中的触控集成问题）<a class="hash-link" href="#ui-自动化的缺点行走中的触控集成问题" title="标题的直接链接">​</a></h2><p>最后说说 UI 自动化的缺点。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="多点触控集成">多点触控集成<a class="hash-link" href="#多点触控集成" title="标题的直接链接">​</a></h3><p>首先是影响可行性的一个问题：多点触控集成。</p><p>这个问题在我去年做安卓触控开发的时候就发现了，为此我当时写了一个触控集成中心，当做系统触控事件的代理人、中间人，实测有效，但有点 bug，由于时间有限最后也没有去修复。</p><p>这个问题到底是啥呢？那就是安卓与苹果系统的触控事件单元，不是基于手指的，而是基于时间戳的。</p><p>啥意思呢？</p><p>意思就是，当我手指在屏幕上点击一个点时，系统报的是一个单指点击的动作；而如果是两根手指点击了两个点时，系统报的是一个双指点击的动作。那么问题来了，当我在游戏中使用左手控制方向盘移动时，系统报的是一个单指按压移动的动作；此时如果我用自动化控制脚本再发送一个点击动作，则不可行，因为此时应该是一个双指动作，但现在缺少那么一个中枢告诉系统，我现在是双指了，因为屏幕是屏幕，脚本是脚本，如果用脚本，那么手指在屏幕上最好别动。否则脚本在动，手指也在动，系统就会犯迷糊，这是最大的问题。</p><p>我当时做的就是首先监控屏幕上的手指，把它拦截；同时监控外设的输出，也把它拦截，然后把两个根据安卓的规则再封装，再往下传，这是可行的。但我们的 iOS 平台上的 wda，我目测下来是不行的。</p><p>所以平常我可以边移动，边用另一根手指打开商店进行换装。</p><p>但现在，使用脚本，你只能移动停止后，再启动脚本换装完成，然后再恢复移动，中间一定不要碰屏幕，否则轻则导致换装失败，重则脚本直接挂掉，因为会让 iOS 觉得这个触控事件输入有问题。</p><p>好在，这个问题其实不大，我之前用一开始的脚本录了一个视频，这里面可以看到换装的时间还比较长的。</p><p>【视频：一键换装】</p><p>后来考虑到了这个问题，不能长，所以我修改了程序里面每个按键的默认时长，都改为了 0.01 秒完成按键动作，然后换装就直接飞快，这绝对不是人手可以点出来的速度，但它就是有效的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654522860291-7e2aabde59c6f2a614466c859c1df9ba13587f20a621833665adaef5a4d0a05f.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="封号的风险">封号的风险<a class="hash-link" href="#封号的风险" title="标题的直接链接">​</a></h3><p>那点这么快，会不会有封号风险？</p><p>哈哈哈，其实不会，以我多年的经验，可以肯定的说，首先我们基于的是苹果自带的自动化控制框架，因此每个点击动作都是有苹果系统官方背书的，一个处于应用层的游戏，只有老老实实接受系统输入的份。</p><p>并且，我们的换装，基本上只占游戏全程极其小的一部分，有时候甚至一局都没有一次换装，因此即使 TX 的反作弊数据分析部分再牛掰，怕也是无法找到你自动化的蛛丝马迹。尤其是如果我再在程序里加入随机抖动算法的话，尽管显然没那个必要。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="需要-usb-接入">需要 USB 接入<a class="hash-link" href="#需要-usb-接入" title="标题的直接链接">​</a></h3><p>我非常希望能像安卓平台上的 adb 一样，先用有线接上，再断开用无线。</p><p>我看到<code>facebook-wda</code>里面提供了无线连接的方式，但很可惜我没能实现，无论是使用<code>iproxy</code>端口转发的操作还是啥，我都必须有线连着脚本才能正常运行，这让我打游戏时的感觉很怪。</p><p>因为其实我已经接了一个散热背夹，没错，其实比起自动化脚本，散热才是更更更重要的关注点，否则这个夏天，一局还没打完就已经手机发热然后掉帧、烫手，然后你就输了。</p><p>推荐这款，我用下来感觉还不错：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654523305583-742fbd49ea5da78a8dcf2ae54748db5a20070c78cba4069e4178243e39dd675c.png" alt="picture 8" class="img_vXGZ"></p><p>不过由于最近已经不玩游戏了，所以退了所有的游戏外设。</p><p>要说为啥，因为找到了新的乐趣来源，那就是这今年一直要做的另一件事：读尽世间书，阅尽天下片！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654523407342-6a07577f0784c5843c8675af4047ea7683594b5190c575b9d3d1b3472db6cfde.png" alt="picture 9" class="img_vXGZ"></p><p>毕竟游戏玩的再好，也只是一盘一盘的重复，但人生却是无止尽的向前。我们，未来再见！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524260027-4acc458ab3f551e86fc146ef482635fc3abce31562c1dfa4c5022556d12ea70c.jpg" alt="picture 15" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524266932-49215831f445e85f707c234a12f7540194a522edaf45dd2a98ce28df80f9b765.jpg" alt="picture 16" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524282234-9c7803fd45febc00cca65ee75d18d4918fbacf2e70d8189f875a8bca74511aaa.jpg" alt="picture 17" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524311716-968fecfb2e55e90262ca2e5af7f086197938f3357d6850ebba043553e38056d1.jpg" alt="picture 18" class="img_vXGZ"><br>
<img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/ios-automation-1654524075184-69bc3ee3d3732781910a1736339886d88886682816ddb5ec72fcbdb6df943a11.jpg" alt="picture 14" class="img_vXGZ"></p><p>【音乐：Saturn】</p>]]></content:encoded>
            <category>开发笔记</category>
            <category>自动化</category>
            <category>iOS</category>
            <category>王者荣耀</category>
        </item>
        <item>
            <title><![CDATA[编程 | 逼哥的音乐元数据修复]]></title>
            <link>https://markshawn2020.github.io/blog/2022/05/23/dev-mp3-meta</link>
            <guid>/2022/05/23/dev-mp3-meta</guid>
            <pubDate>Mon, 23 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[picture 1]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310547240-0ba20a542cc9ebc6cf5540ad60c8e4ec8ae831b74d05ee16d60e98dba83e91ae.png" alt="picture 1" class="img_vXGZ"></p><p>今日在 Apple Music 中导入逼哥的音乐库时，出现了信息乱码：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310695038-ed58410316d27f140f6d1df184971f369407b68053846151b1271578df0946ea.png" alt="picture 2" class="img_vXGZ"></p><p>可以看到，主要是<code>title</code>和<code>author</code>列出现了问题，这不禁引起了我的兴趣。</p><p>我第一反应便是去对应的原素材文件夹，右键 get info，可以看到确实是有两个属性是乱码（左边是原来的，右边是后续修复的）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310814595-e051efe2bf22ee099843f2cade8051e1d0ec73864ba0540e7a27ac86faea5c7e.png" alt="picture 3" class="img_vXGZ"></p><p>我原以为可以直接在属性窗上修改，结果不行。</p><p>于是我就想到，可能需要借助一些专业软件。果然，<strong>涉及到 apple music 列表显示的关键信息，是 mp3 文件的 meta 数据</strong>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310896397-b120adf7f15be2c82193521a2a0dbcc92abf91708af94d195fa03a8ee44a0752.png" alt="picture 4" class="img_vXGZ"></p><p>按照老经验，去我们的破解专用软件站去下载：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310917717-96c26a3d5605a5736b8575c3946b946d627eac259ac48017ed8d361fec5ee494.png" alt="picture 5" class="img_vXGZ"></p><p>使用起来很简单，导入我们的文件夹，然后一个个修改 mp3 原数据的信息即可：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653310979865-312e6d473496ab4b99c3ef50bbbc7e49640ec2ff0f91d66f8ba8da5b3a68c0ef.png" alt="picture 6" class="img_vXGZ"></p><p>但既然了解了背后的原理，一个个手动修改元数据未免太慢了。</p><p>考虑到我导入的音乐，其文件名本身是良好定义的，所以直接写个程序去批量化处理比较好。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311076592-c5fac94b7c1c9fbac41da0763a2b415c7eeb97a1a8af5bc0577497b97fada43e.png" alt="picture 7" class="img_vXGZ"></p><p>它们用的是<code>eyeD3</code>这个库：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311105001-491e73b2c2fdcaf3c0a822892515284a07555e8bc4f07f2da2242b0b8edc9283.png" alt="picture 8" class="img_vXGZ"></p><p>使用方法也非常简单，一看就明白：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311130085-98b0cb7b131b2ea6a9f72142e5ed18ceba98e24d5392f6bef5b782df861ceb2a.png" alt="picture 9" class="img_vXGZ"></p><p>那就轻松了，我们直接写程序即可。</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> eyed3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">edit_mp3_meta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"fp_: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eyed3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://stackoverflow.com/a/67541983/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">artist </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">u'%s'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">u'%s'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> title</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ref: https://stackoverflow.com/a/32908607/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    audiofile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">version</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eyed3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ID3_DEFAULT_VERSION</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'__main__'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"李志"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理第一个乱码文件夹，它们内部的命名是 “李志 - 歌名（专辑）.mp3"，用正则提取比较方便</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># dir = '/Volumes/Disk2/resources/乐/lizhi-18砖/2015年《i.O》 (2014-2015李志跨年音乐会)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># for fn in os.listdir(dir):</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     fp_ = os.path.join(dir, fn)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     song_name_match = re.match(f'{author} - (.*?)\(2014i／O版\).mp3', fn)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     assert song_name_match, fn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     song_name = song_name_match.groups()[0]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#     edit_mp3_meta(fp_, song_name, author)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 处理第二个乱码文件夹，里面有两个CD文件夹，因此使用`walk`迭代，音乐命名是其本身，因此直接提取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dirs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fns </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">walk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/Volumes/Disk2/resources/乐/lizhi-18砖/2013《108个关键词》'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> fn </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> fns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">endswith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"mp3"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                song_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                edit_mp3_meta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> song_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>处理完后，我们重新导入这些音乐，就发现，apple music 中的属性都正常了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_eidt-mp3-meta-1653311311787-92d45f8fae2b0ac6518f4bcaeb3db6e71d3a3ebaebd8a239a1d8657b0f0e2b50.png" alt="picture 10" class="img_vXGZ"></p><p>希望对你有用~</p><p>查询参考：</p><ul><li><a href="https://www.google.com.hk/search?q=mac+get+info+%E4%B9%B1%E7%A0%81&amp;newwindow=1&amp;ei=TXuLYrGBDf_N2roPw_Sf6AM&amp;ved=0ahUKEwjx27uRzfX3AhX_plYBHUP6Bz0Q4dUDCA4&amp;uact=5&amp;oq=mac+get+info+%E4%B9%B1%E7%A0%81&amp;gs_lcp=Cgdnd3Mtd2l6EANKBAhBGAFKBAhGGABQuAVYjQhg2AtoAXAAeACAAZ0BiAGJBJIBAzAuNJgBAKABAcABAQ&amp;sclient=gws-wiz" target="_blank" rel="noopener noreferrer">mac get info 乱码 - Google 搜索</a></li><li><a href="https://www.google.com.hk/search?q=mp3+modify++title+and+author" target="_blank" rel="noopener noreferrer">mp3 modify title and author - Google 搜索</a></li><li><a href="https://www.mp3tag.de/en/download.html" target="_blank" rel="noopener noreferrer">Mp3tag - Download</a></li><li><a href="https://macwk.com/soft/mp3tag" target="_blank" rel="noopener noreferrer">Mp3tag 1.2.2 中文破解版 for Mac 音频元数据编辑工具</a></li><li><a href="https://www.google.com.hk/search?q=python+modify+mp3+tag" target="_blank" rel="noopener noreferrer">python modify mp3 tag - Google 搜索</a></li><li><a href="https://stackoverflow.com/questions/8948/accessing-mp3-metadata-with-python" target="_blank" rel="noopener noreferrer">Accessing MP3 metadata with Python - Stack Overflow</a></li><li><a href="https://eyed3.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Welcome to eyeD3 — eyeD3 0.9.4 documentation</a></li><li><a href="https://www.google.com.hk/search?q=eyed3+unicode&amp;oq=eyed3+unicode&amp;aqs=chrome..69i57j69i60.3349j0j7&amp;sourceid=chrome&amp;ie=UTF-8" target="_blank" rel="noopener noreferrer">eyed3 unicode - Google 搜索</a></li><li><a href="https://stackoverflow.com/questions/30388411/processing-chinese-character-using-eyed3-in-python" target="_blank" rel="noopener noreferrer">encoding - Processing chinese character using eyed3 in python - Stack Overflow</a></li></ul>]]></content:encoded>
            <category>开发笔记</category>
            <category>音乐</category>
        </item>
        <item>
            <title><![CDATA[评测 | Breo Dream6 按摩仪]]></title>
            <link>https://markshawn2020.github.io/blog/2022/05/22/evaluation-breo-dream6</link>
            <guid>/2022/05/22/evaluation-breo-dream6</guid>
            <pubDate>Sun, 22 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[最近试用了三款按摩/睡眠仪，写一写使用体验。]]></description>
            <content:encoded><![CDATA[<p>最近试用了三款按摩/睡眠仪，写一写使用体验。</p><ol><li><a href="https://detail.tmall.com/item.htm?id=658789572598" target="_blank" rel="noopener noreferrer">Breo Dream6 头眼颈一体的按摩仪</a>，4099(到手 3702)</li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653221900302-ea84456ee6b5783dc597bc835f53e479f089c8656efda03b6dcba2178774ddc6.png" alt="picture 77" class="img_vXGZ"></p><ol start="2"><li><a href="https://detail.tmall.com/item.htm?id=588310474304" target="_blank" rel="noopener noreferrer">Breo 腰部按摩枕</a>，439(实际 0，买上者送的)</li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222021795-aa06f820454d65ce63cb2cb5ac224020f74ae05d27f19e59d8cb48db28ae062a.png" alt="picture 78" class="img_vXGZ"></p><ol start="3"><li><a href="https://item.jd.com/10026471738507.html" target="_blank" rel="noopener noreferrer">HOMER ION 睡眠仪</a>，698（外加一个 Emod 枕边睡眠喷雾，总计到手 899）</li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222102702-15934409bd3975b8391841c420257ad4ff19dd5a8b43197b7b88fdda61c6083a.png" alt="picture 79" class="img_vXGZ"></p><p>本期主要谈谈 Breo Dream6 的使用体验。</p><p>首先说一下试用它的理由，因为我个人很容易感到眼部疲劳，尽管有很多其他措施缓解疲劳，但我想到了物理按摩。</p><p>此时，也许一款眼部按摩仪是最适合我的，但考虑到我很多年前买过一款比较粗糙的眼部按摩仪，实际体验一般般，因此有一定阴影。</p><p>同时，考虑到如果能同时按摩头皮，也许会有 1+1&gt;2 的奇效，基于此我经过一顿搜索后断定，一款按摩头盔比较适合我。</p><p>说到按摩头皮，其实专用的头部按摩仪也不错，它大概长这样（龙爪手）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222482389-f3b20222a8daa9a1fb83ec7dd33d17279e5fd9c558fd8c514c74d2fe44b32f5f.png" alt="picture 80" class="img_vXGZ"></p><p>我看了一些 B 站测评，他们的反馈还不错：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222672205-3c58e7ecdaeb41ec8b2cf6e59046acbd1465544d2f136bf1b1adc37e6fa0bf84.png" alt="picture 81" class="img_vXGZ"></p><ul><li><p><a href="https://www.bilibili.com/video/BV1Sz4y1Q7qA?spm_id_from=333.880.my_history.page.click" target="_blank" rel="noopener noreferrer">【炎炎谷】好物分享「breo 倍轻松」头部按摩器 | 龙爪手の开箱评测！<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p></li><li><p><a href="https://www.bilibili.com/video/BV1rT4y1w7sG?spm_id_from=333.880.my_history.page.click" target="_blank" rel="noopener noreferrer">拆网易严选的头部按摩仪，看看他们产品内部的做工和用料是否良心<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p></li></ul><p>但缺点就是必须手握着，放头上不断地按摩，心想不是很方便。</p><p>不过现在在体验了呆板（不方便调整头皮按摩位置）的纯自动头眼按摩仪后，这种龙爪手反而有了灵活的优点。</p><p>因此，我在写这篇复盘时，悄咪咪地决定，再入个龙爪手试试。</p><p>ok，说了一大串，我们回到 breo dream6 上来。</p><p>在此之前，我已经认真看了这几个测评视频：</p><ul><li><p><a href="https://www.bilibili.com/video/BV1hE411R7eP?spm_id_from=333.880.my_history.page.click" target="_blank" rel="noopener noreferrer">倍轻松 iDreamX 头部按摩仪<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p></li><li><p><a href="https://www.bilibili.com/video/BV19T4y1g7yx?spm_id_from=333.880.my_history.page.click" target="_blank" rel="noopener noreferrer">真 AI or 假噱头？智能头部按摩仪—“倍轻松 iDreamX AI 一休精灵”开箱体验<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p></li></ul><p>说实话，看测评感觉还不错，然后我去 breo 官网看了看，发现有新款的，也就是 dream 6.</p><p>Dream 6 最打动我的就是它的外观与结构设计了，白灰色、可折叠，非常适合出差使用，个人觉得。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222969953-0f0e289b876e812a24c68c043e80e17b6c35349a376552cf41dbb9c1b4a10887.png" alt="picture 82" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653222978309-ce07801bed2a98c534f46f61498e51d36c4cfbb3560d7831e7071be783180207.png" alt="picture 83" class="img_vXGZ"></p><p>可以对比看一下这两款，可以看到，结构设计上真地大有不同。</p><p>但很可惜，最终它还是让我失望了。</p><p>先说说优点吧。</p><p>最大的优点就是我们说的，它的可折叠设计方便出差与收纳、灰白色织物外观高大上手感好，这些都还是很 ok 的。</p><p>实际体验中，也是有一定的优点的，比如它的放松模式与冥想模式的曲子选的还算不错，然后不同模式使用的按摩“手法”也确实略有不同，比如放松模式下会压紧你的眼窝然后头顶往上拉，这种感觉确实挺棒。最好的感受还是它的眼部的热敷与按压，确实一绝。</p><p>在十五分钟的按摩后，你确实觉得自己的元气恢复了几分。</p><p>但除此之外，问题就很多了。</p><p>首先是具体的按摩效果方面。</p><p>刚刚说了，眼部的按摩效果是可以的。但也仅仅是眼部了。</p><p>头皮部是一堆硅胶刺，慢慢地戳向你的头皮。我体验下来，要没没啥感觉，要么感觉戳的有点疼，但不管哪种，都没让我觉得很舒服的感觉。</p><p>接着后面的颈部按摩，我以为也会有什么按压或者滚压的体验，结果是几乎没有任何感觉。反复就只起到了一个固定的作用。</p><p>所以，颈部部分我也懒得说了，接下来可能会根据这篇视频的评测：- <a href="https://www.bilibili.com/video/BV1Uq4y1571H?spm_id_from=333.880.my_history.page.click" target="_blank" rel="noopener noreferrer">【视频】SKG、西屋、倍轻松按摩仪怎么选答案都在评测里！<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a> 尝试一下西屋的颈部按摩仪。</p><p>头皮部分我觉得需要再展开一下。</p><p>我可以理解绝大多数的自动按摩设备，都是以一些马达等去控制一些物理的运动，从而模拟人类的按揉摸搓等动作。</p><p>然而我不得不说，头部的这部分，远远没有达到我对一个头皮按摩的期望，尽管有一点点效果，确实那些硅胶刺过来是挺师傅的，但不够，我只觉得痒……（并且痒的时候还不好挠，因为戴着头盔呢）</p><p>ok，效果方面说完了，再说说体验方面。</p><p>首先考虑以什么姿势戴的问题，如果是坐着戴，那对不起，由于头盔的重力原因，会不断下沉，以至于能把你鼻子压扁然后无法呼吸。因为什么呢？因为整个头盔只有水平直径调节而没有垂直直径调节。也就是说它默认所有人的头部的高度是一定的，并且为自己头皮部的按压预留了一些上下的空间。</p><p>如果是躺着的，那又要对不起了，因为颈部部分里面是硬的，所以直接躺的话，后脑勺根本吃不消，我的意思很明显，虽然这玩意有助眠模式，并且是默认模式，但是我根本无法在我想躺着的时候使用它，更别说戴着它入梦了。如果考虑要助眠入梦，我觉得最佳的选择是蒸汽眼罩，而非一款头盔！</p><p>最后我发现了这玩意最好的使用姿势，是半躺在沙发上的时候，让空的后脑勺上部靠在后面的墙上以支撑住整个头盔，从而能让头盔保持固定，并且自己的后脑勺下部不产生额外的压力。</p><p>所以，为了得到较好的体验，竟然需要如此麻烦……</p><p>其次，音乐，很粗糙的就是单曲循环，甚至曲子都没有做淡入淡出处理，导致三五分钟的曲子一遍遍循环的中间很生硬，一下就打破了沉浸感。</p><p>曲子选的说实话，很一般，尤其是放松模式的曲子，那真的是，没耳听。当然这玩意也因人而异，反正我不喜欢就是了。</p><p>曲子倒是可以换，不过要连接 app，那我们再来聊一聊 app。</p><p>breo 的 app 进入之后，使用蓝牙连接头盔这个没问题，app 整体做的还可以，很清爽，这个我是认同的。</p><p>但接下来，让我连接无线网，并且我看提示是自动获取 wifi 失败，让我手动输入 wifi 密码（此时我是连着 wifi 的）。</p><p>输就输吧，输完然后就转圈圈，无法退出，这也可以理解。</p><p>但长达半分钟后，提示我连接失败。我试了 N 次都是这个结果。</p><p>连不上 wifi 的后果就是这款产品主打的 ai 语音完全不起作用，只能用最简单的固定词汇控制，比如：“调高/低音量”。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653224832567-5034a839b0392386405fe59cccf594cdfd35e50e22343c88c905059e29ea96b7.png" alt="picture 84" class="img_vXGZ"></p><p>然后接着我就发现蓝牙连接体验很差，需要在连接头盔之后，再手动切换到蓝牙设置界面再连另一个蓝牙，也就是那个用于音乐传输的蓝牙。</p><p>这一步也可以忍，但接下来就不能忍了。</p><p>一切操作成功之后，打开我的音乐软件，播放，这样手机不出声，声音走头盔，那个音质，我真是……</p><p>我觉得 9 块 9 的耳机都可以把这音质按在地上摩擦，这音质简直就是三十年前的电话音质。</p><p>我们花四千块以为能买到一个沉浸式的、无比舒适的……</p><p>对不起，我连词都尽了。</p><p>再说说一名软件工程师能够明显感觉到的代码层的设计问题吧：</p><ol><li><p>每次启动这个头盔，都是直接进入助眠模式，而非记忆上次模式，这是我认为应该要改进的。比如我就更喜欢冥想模式，但是每次都得按两次才能切换到。</p></li><li><p>app 的那些最直观的问题刚刚已经说了，再说个不明显的：在使用默认音频输出的模式下，有开机问候、关机问候，使用调高音量语音指令达到最大后会有“已经最大音量”的提示，但是在 app 里使用蓝牙音频输出后，这些问候、提示全都没了，15 分钟到的时候立马一下哑火，体验差，也暴露了程序员在开发时几乎是写了两套方案，没有统一，水平显然不行。</p></li></ol><p>最后，还是肖战代言的……</p><p>我虽然不追星，也不看星，本人对肖战无感但也没有敌意，但基于这么多糟糕体验，每次启动头盔时来的一句肖战的问候，就觉得，如此 annoying。</p><p>可能这款产品的唯一目标用户就是头大（否则无法固定）的颜值肖战 XX 粉了吧。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653226273162-d7b84aa1441c9fa287890f013da23082e9272bf55a8a69c660c38ce4ce6775e8.png" alt="picture 87" class="img_vXGZ"></p><p>真是白瞎了红点设计奖了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653225429198-bb441c5db92a7a7fb06f1b6a8d649e1ffce9908dfd2c8c80352ee5d70e88d4ab.png" alt="picture 85" class="img_vXGZ"></p><p>如果一定要认真夸一句，我觉得商家态度还是很不错的，了解到我被疫情封控无法寄货后，直接将七天无理由退换货改成 21 天了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_massage-1653225660459-25f8178ebd0dea5432ddf3c3f0680889c5065a6a0c78f9280c5766ad420039bd.png" alt="picture 86" class="img_vXGZ"></p><p>也许，他们只是需要点时间再去仔细打磨自己的产品，但愿吧，但不是我关心的事了。</p><p>PS：那个腰部按摩仪的使用体验相对靠谱很多，但缺点和 dream6 相反，它很笨重，考虑到是赠品，我也没有留下来的意愿了。</p><p>祝好。散。</p><p>下期给大家讲讲这个 Homer ION 手部按摩仪是怎么回事，这个倒是很有意思。</p>]]></content:encoded>
            <category>评测</category>
            <category>养身</category>
        </item>
        <item>
            <title><![CDATA[札记 | 须知，活好是很不容易的]]></title>
            <link>https://markshawn2020.github.io/blog/2022/05/15/prose-is-not-easy</link>
            <guid>/2022/05/15/prose-is-not-easy</guid>
            <pubDate>Sun, 15 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[须知，活好是很不容易的。]]></description>
            <content:encoded><![CDATA[<p>须知，活好是很不容易的。</p><p>在学校时，尚不能领略这一点，因都是和大家住，时间也都被和大家一起的学业、和大家一起的事业，所全部被占领。</p><p>细想，很少有所谓的属于自己的时间。虽不至于全无，但总会很快又逃走，比如朋友喊道：走，吃饭！</p><p>聊且自慰。大多数情况下，我就是那个朋友。我这么说一定是没错的，毕竟我确是自己朋友的朋友。</p><p>我有幸在这样的集体主义下，懵懵懂懂度过了自开始记事来的所有时光，恍惚间已二十年矣。</p><p>不过难以否认的是，我还是很感谢这样的集体主义。因为以我的尿性，我深知如若没有这种来自“大家长”力量的庇护（同时也是约束），我并不能确信自己会通往何方，我至少没有底气说我会过的一定比现在好（尽管，现在也谈不上）。</p><p>于是，直到毕业，直到疫情开始肆虐，直到我长租于北京，我才开始真正面对一个人的生活，我也才真正明白，生活是不容易的，活好更是难上加难。而且，这并非完全出于经济的原因。</p><p>我其实已经很不差钱了，相较于那些——当代流媒体的流量密码——催泪的工人、志愿者和流浪者们。</p><p>都是为了生活而负重前行，谁高谁下并不那么明了，也无几分意义。</p><p>生活不会因为你贫穷，而多锤你几下；也不会因为你高贵，就少锤几分。所有的一切在命运中都标定了价格。</p><p>生活真正的难题，不在宏大叙事上面，不在你今天买不起某张席梦思，明天追不到某个梦中情人。</p><p>生活真正的难题，是如何处理生活这件事本身：你当下在做什么，想做什么，怎么做的问题。</p><p>是贯穿从清晨有意识开始，要不要起床、怎么起床；到午饭吃点什么；再到晚上复盘今天做了什么；到夜里该不该睡觉、如何睡觉的问题。</p><p>这十二十个小时里，我们有心心念的主线任务——比如工作与学习——即那些在有形的或者无形的计划表上的事。但我们实际上会在很多其他事情上耗费相当的时间，例如发呆、游戏、聊天、了解今时今日的新闻——那些糅杂着事实与谣言的、无论真假你却难以改变的事情。</p><p>譬如今早微信群里通知我们小区历经两周终于解封了，然而中午还未到，又有人却说并不行，现在保安和物业一团乱。</p><p>生活便主要是由这些鸡零狗碎的事情构成的。</p><p>大多数人也缺乏应付这些鸡零狗碎的一些必要手段，便是那些称之为“原则”的东西。</p><p>工作需要原则，需要纪律，生活也需要吗？</p><p>我想，应该是的。</p><p>自然，生活也可以是没有原则的，凡法无禁止皆可为，放浪形骸、以酒度日、引吭高歌，似乎也并非不妥。</p><p>一个人如果连往下都不怕，他还怕什么呢？</p><p>但大多数人并没有往下跃的勇气与机缘，他只能往上，但心有余而力不足，最终不上不下。</p><p>大多数人最终都会是不上不下的，即所谓的社会的稳态。这是政客们最喜欢的东西。</p><p>现在大家都喜欢谈逆熵，我也喜欢。</p><p>逆熵的核心是控制的艺术，人一旦有了控制感，人就会对未来更充满希望，觉得自己更可以主宰自己的命运，说俗点就是能得到自己想要的东西：一个人，或一个物品，有形的或者无形的。</p><p>我想，人都想往上走，这本无可厚非。王小波也在年轻时觉得自己可以永远地生猛下去。</p><p>而留给我们的，或者说留给我的，一名青年男子，似乎时间还有很多。</p><p>也似乎，确实很多：假如我心无旁骛，就干它个十年八年，把一件事做好，做成的话。</p><p>人们往往高估自己一年可以做成的事，低估自己十年可以做成的事。</p><p>问题是，这十年，未必好熬，这十年，未必总能有一种控制感。</p><p>这大概就是人和组织最大的不同。</p><p>人可以放纵，但组织不可以，</p><p>人可以没有计划，而组织必须要有。</p><p>三年的、五年的，甚至百年的、千年的。</p><p>越超过自己目所能及的地方，越引起人的心潮澎湃。</p><p>从博弈论角度，这是多么明智的选择：比起毫无计划、毫无准备，有总归是更好的。</p><p>一个有效的机器学习模型，可以允许喂一个随机的种子，它的过程必定动荡、无序，但总有一天它会收敛。</p><p>我们，也一定会得到一个最终的答案。</p><p>所以，多多少少还是学一些管控生活的艺术，例如收纳。</p><p>给自己的房间挂一张爱因斯坦的画像，再摆一盆绿植，调整床的朝向与位置，把所有的家具摆在最适合它的位置，如果不够宽敞再充分利用上墙贴，打造空间层次感。</p><p>疫情封控的大背景下，学会自己做饭成为显著提升自己幸福感的源泉：只要买一口好锅，多看几个炒菜视频，会用叮咚买菜即可。</p><p>作为一个程序员，将生活控制在和自己的代码一样整洁的一个复杂度下，应该是一门必修课。</p><p>毕竟，如果有些东西没法改变，比起悲观地度过每一天，乐观也许更好。</p><p>这似乎也是博弈论教给我们的应有之义。</p><p>但坦白说，我其实不怎么信这玩意，但比起啥都不信，信一些东西似乎更免烦恼。</p><p>而这似乎，又是博弈论教给我们的应有之义。</p><p>生活的问题，便是如上，无穷无尽。</p><p>我的答案也逐渐明了：把自己收拾好，尽一切努力。然后，静待花开。</p><p>这未必是一份满分答卷。</p><p>但人生之路，哪有满分一说呢。</p><p>且行，且歌，且思，且录吧。</p><p>南川记于二零二二年五月十五日，某薛定谔的解封之日。</p>]]></content:encoded>
            <category>札记</category>
        </item>
        <item>
            <title><![CDATA[编程 | 视频剪辑自动转写字幕]]></title>
            <link>https://markshawn2020.github.io/blog/2022/05/14/dev-voice2srt</link>
            <guid>/2022/05/14/dev-voice2srt</guid>
            <pubDate>Sat, 14 May 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1. 语音转写市场概览]]></description>
            <content:encoded><![CDATA[<ol><li>语音转写市场概览</li><li>网易见外的缺点<ol><li>FCPX 不支持网易见外导出的 srt 字幕文件</li><li>网易见外的转写结果需要手动进行长度切割</li><li>网易见外只支持后期文本替换，而不支持前期预设词库</li><li>网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放</li></ol></li><li>讯飞转写<ol><li>讯飞服务价格</li><li>讯飞语音转写控制台</li><li>讯飞语音转写的使用</li><li>讯飞语音转写使用分词</li><li>讯飞语音转写程序</li></ol></li><li>基于 Automator 实现右键语音文件后台自动转写</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="语音转写市场概览">语音转写市场概览<a class="hash-link" href="#语音转写市场概览" title="标题的直接链接">​</a></h2><p>目前国内中文语音转文字，做的最好的应该是科大讯飞（可惜要付费）：</p><ul><li><a href="https://console.xfyun.cn/services/lfasr" target="_blank" rel="noopener noreferrer">控制台-讯飞开放平台</a></li></ul><p>所以其实很多 UP 主用的是网易见外之类的免费转写产品。</p><p>其他转写平台还有，比如：</p><ul><li><a href="https://github.com/PaddlePaddle/PaddleSpeech" target="_blank" rel="noopener noreferrer">百度的飞桨</a></li><li><a href="https://github.com/opensourceteams/google-sdk-speech-to-text" target="_blank" rel="noopener noreferrer">谷歌识别</a></li><li>……</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外的缺点">网易见外的缺点<a class="hash-link" href="#网易见外的缺点" title="标题的直接链接">​</a></h2><p>我实际体验下来，网易见外还是不太能满足我的需求的，主要如下：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fcpx-不支持网易见外导出的-srt-字幕文件">FCPX 不支持网易见外导出的 srt 字幕文件<a class="hash-link" href="#fcpx-不支持网易见外导出的-srt-字幕文件" title="标题的直接链接">​</a></h3><p>这个我之前就了解了一下，发现大家都是用一些第三方软件再将网易见外的 srt 转换成另一种 srt，不禁引起了我的好奇，到底为啥网易见外的 srt 不支持 fcpx 导入。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437655118-c3c5e4b27ab7ff01d6860b73a89f616fff6cd87264153c70010e5802280ee68b.png" alt="picture 9" class="img_vXGZ"></p><p>我对比了讯飞转写和网易见外的 srt 文件，发现两者的唯一区别就在于编序下标不同：网易见外从 0 开始标记，而讯飞转写从 1 开始：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437563419-c6548e1349f50fa454cc6d34842da5852007a8d589514d968974963ce1751cf1.png" alt="picture 8" class="img_vXGZ"></p><p>由此大胆猜测：FCPX 对 srt 文件的硬性要求就是从 1 开始编码！</p><p>于是我将网易见外的第 0 号编码对应的字幕内容去掉，重新导入 FCPX，结果成功了，此即证实了我的猜想。</p><p>了解了原因之后，这个问题就变得不那么恐怖了，随便用什么脚本语言把网易见外的 srt 文件里的序号全部加 1，或者干脆把第一条去掉即可。不是什么难事。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外的转写结果需要手动进行长度切割">网易见外的转写结果需要手动进行长度切割<a class="hash-link" href="#网易见外的转写结果需要手动进行长度切割" title="标题的直接链接">​</a></h3><p>网易见外的默认转写字幕长度是偏长的。这其实可以理解，因为长一点有助于基于上下文分析提高转写的准确度。</p><p>但问题就在于，想把分好的每句字幕再切小一点，则需要手动的在网页上点击分隔按钮一个个地调整，这个工作量就变得无法接受了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652437965030-0e0c5d1f23c071c4b8621142912eeb55bdbf32bec4663afaa6854b30f47fbf4c.png" alt="picture 10" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外只支持后期文本替换而不支持前期预设词库">网易见外只支持后期文本替换，而不支持前期预设词库<a class="hash-link" href="#网易见外只支持后期文本替换而不支持前期预设词库" title="标题的直接链接">​</a></h3><p>对于学过机器学习的程序员或者用过<code>jieba</code>分词之类开源代码库的人都知道，预设词库在文本分析相关领域是非常重要的，显著影响算法识别的准确度和使用体验。</p><p>然而网易见外是不支持转写之前预设词库，只可以转完之后在页面点击文本替换，由此可见网易转写的机器学习模型（如果有的话）比较低级，它只有通用的一个，不支持用户自己输入词库进行模型微调。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放">网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放<a class="hash-link" href="#网易见外不支持基于鼠标点击的文本位置智能跳转语音并播放" title="标题的直接链接">​</a></h3><p>这个是讯飞转写的一个很友好的功能，并且在技术是线上我认为也不是很难的一件事，但很可惜，网易见外也未能把这个用户体验做起来。</p><p>基于以上原因，我认为网易见外是远未达到我对一个智能转写软件平台的目标要求的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞转写">讯飞转写<a class="hash-link" href="#讯飞转写" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞服务价格">讯飞服务价格<a class="hash-link" href="#讯飞服务价格" title="标题的直接链接">​</a></h3><p>如果没有开通过讯飞的服务，可以申请免费使用。不过有一定要求，比如企业用户需要提交工商执照相关信息，而个人用户，看声明貌似要 19 年的新用户……反正我是不符合了（我以前应该用过）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431323538-20c35f16a1a4cedc75b65c5c69614ddc05521d1e6608e1bc485f523af6b8d8e9.png" alt="picture 6" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写控制台">讯飞语音转写控制台<a class="hash-link" href="#讯飞语音转写控制台" title="标题的直接链接">​</a></h3><p>在控制台，可以查看自己所购买的讯飞服务详情，最主要的就是确认自己购买的是“讯飞转写”的服务，然后至少要支持中英文转写，最后在个性化热词里可以加入自己的特殊词库（用于提高准确率，非常有用）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431465004-4f6c800430b3f09d8917e0e0009af5ba5668169312f800f2e236fcda51ac55a0.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写的使用">讯飞语音转写的使用<a class="hash-link" href="#讯飞语音转写的使用" title="标题的直接链接">​</a></h3><p>可以使用讯飞语音转写的 api，在该页可以下载各大语音（例如 python）的 demo：<a href="https://www.xfyun.cn/doc/asr/lfasr/API.html" target="_blank" rel="noopener noreferrer">语音转写 API 文档 | 讯飞开放平台文档中心</a></p><p>建议直接对着 demo 改，否则从 0 到 1 写会很麻烦，因为要很多加密相关参数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652431132707-614749d87f3bee0e5b8675061e1330fb9b700080406a936bc8c7f30a4cb929ce.png" alt="picture 5" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写使用分词">讯飞语音转写使用分词<a class="hash-link" href="#讯飞语音转写使用分词" title="标题的直接链接">​</a></h3><p>在 <code>/prepare</code> 接口的参数中如果加上 <code>has_participle = true</code>，则会返回带每个词语识别的结果。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652461333188-95a3f302b742e110b3cbdf3f0227cbc525d8869298487f4929c0fa8ad037a333.png" alt="picture 11" class="img_vXGZ"></p><p>不过深入去使用词级别的解析结果也是一件不太容易的事情，因为需要我们自己去处理断句的问题。比如说要通过<code>'wordsName': '，'</code>去判别是个断句。</p><p>基于这个角度来看，网易见外不支持按长度的智能分句，似乎也变得不是那么不能接受了。</p><p>但尽管如此，讯飞的结果依旧要比网易见外好很多。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="讯飞语音转写程序">讯飞语音转写程序<a class="hash-link" href="#讯飞语音转写程序" title="标题的直接链接">​</a></h3><p>已同步在个人仓库：<a href="https://github.com/MarkShawn2020/mark_keeps_learning/blob/master/mark_scripts/voice2srt/main.py" target="_blank" rel="noopener noreferrer">https://github.com/MarkShawn2020/mark_keeps_learning/blob/master/mark_scripts/voice2srt/main.py</a></p><p>具体脚本内容如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   author: yanmeng2, xunfei api relative</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   author: markshawn2020, xunfei result to srt-format file, 2022-05-13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   config: https://console.xfyun.cn/services/lfasr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#   doc: https://www.xfyun.cn/doc/asr/lfasr/API.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hashlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> hmac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lfasr_host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'http://raasr.xfyun.cn/api'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 请求的接口名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_prepare </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/prepare'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_upload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/upload'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_merge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/merge'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_get_progress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/getProgress'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api_get_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/getResult'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 文件分片大小10M</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_piece_sice </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10485760</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ——————————————————转写可配置参数————————————————</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数可在官网界面（https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html）查看，根据需求可自行在gene_params方法里添加修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 转写类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lfasr_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 是否开启分词</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">has_participle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'false'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">has_seperate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'true'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 多候选词个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_alternatives </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 子用户标识</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每隔N秒获取一次进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SliceIdGenerator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""slice id生成器"""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'aaaaaaaaa`'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getNextSliceId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cj </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'z'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">chr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">ord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'a'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># -------------------- 从讯飞结果到srt的转换函数 -----------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time2stamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    将整数时间（毫秒）转化为srt的时间戳，即 HH:MM:SS,mmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param s:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mmm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MM </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">//=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HH </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">HH</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">MM</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">SS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">02</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">mmm</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">03</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pickle_srt_item</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mm_start</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mm_end</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    构建srt字幕文件的基本单元</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param index: 字幕序号，从1开始，手动创建</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param mm_start: 该字幕单元起始毫秒数</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param mm_end: 该字幕单元结束毫秒数</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param content: 该字幕单元的文本内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">index</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">time2stamp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">mm_start</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> --&gt; </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">time2stamp</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation">mm_end</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xunfei_json2srt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    将讯飞转写的输出转成srt字幕文本内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :param items:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    :return:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"\n"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pickle_srt_item</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"bg"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"ed"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"onebest"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RequestApi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">object</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> appid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secret_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_appid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_secret_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> secret_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upload_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">splitext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">".srt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"--- initialized ---"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 根据不同的apiname生成不同的参数,本示例中未使用全部参数您可在官网(https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html)查看后选择适合业务场景的进行更换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> slice_id</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_secret_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        upload_file_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        m2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">md5</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        m2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        md5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> m2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        md5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">md5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 以secret_key为key, 上面的md5为msg， 使用hashlib.sha1加密结果为signa</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> hmac</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secret_key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> md5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sha1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">digest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b64encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signa</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signa</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'utf-8'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getsize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        param_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_prepare</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># slice_num是指分片数量，如果您使用的音频都是较短音频也可以不分片，直接将slice_num指定为1即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            slice_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> file_piece_sice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> file_piece_sice </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'app_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'signa'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'file_len'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'file_name'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'slice_num'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">slice_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_upload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'app_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'signa'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'task_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'slice_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> slice_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_merge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'app_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'signa'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'task_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'file_name'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_get_progress </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> apiname </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> api_get_result</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'app_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> appid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'signa'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            param_dict</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'task_id'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> taskid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> param_dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 请求和结果解析，结果中各个字段的含义可参考：https://doc.xfyun.cn/rest_api/%E8%AF%AD%E9%9F%B3%E8%BD%AC%E5%86%99.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lfasr_host </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> apiname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"ok"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{} success:"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"{} error:"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 预处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">prepare_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">apiname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">api_prepare</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_prepare</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 上传</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file_object </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">upload_file_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'rb'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SliceIdGenerator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_piece_sice</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> content </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                files </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"filename"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"slice_id"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">"content"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_upload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                   slice_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getNextSliceId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             files</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">files</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'ok'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic"># 上传分片失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'upload slice fail, response: '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'upload slice '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' success'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                index </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'file index:'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tell</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            file_object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 合并</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">merge_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_merge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_merge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_progress_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_progress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_progress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_result_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gene_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">api_get_result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">all_api_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 1. 预处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pre_result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prepare_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        taskid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pre_result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"data"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 2 . 分片上传</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> upload_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_upload_file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 3 . 文件合并</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 4 . 获取任务进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 每隔N秒获取一次任务进度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            progress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_progress_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            progress_dic </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> progress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'err_no'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'err_no'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">26605</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'task error: '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'failed'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> progress_dic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'data'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                task_status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> task_status</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'status'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'task '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> taskid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' finished'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'The task '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> taskid </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' is in processing, task status: '</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 每次获取进度间隔N S</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 5 . 获取结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        srt_json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_result_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">taskid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">taskid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"data"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        srt_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> xunfei_json2srt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">srt_json</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"w"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">srt_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"has written converted result into path: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">srt_fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'__main__'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RequestApi</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        appid</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"XUNFEI_APP_ID"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        secret_key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"XUNFEI_APP_SK"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        upload_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">all_api_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-automator-实现右键语音文件后台自动转写">基于 Automator 实现右键语音文件后台自动转写<a class="hash-link" href="#基于-automator-实现右键语音文件后台自动转写" title="标题的直接链接">​</a></h2><p>目前我们写的脚本，输入是一个文件路径，特别的，是指我们待转的音频文件，根据讯飞接口要求，对输入的文件有以下限制：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533014083-ec6a9f68a140717a16bb63397a987c5ce2e8abc80fe3f8a0959e1ca0ad3c0dbc.png" alt="picture 8" class="img_vXGZ"></p><p>从音频格式来看，除了<code>aac</code>格式不支持，其他常用的例如<code>mp3, wav, m4a</code>都支持了，所以还是挺广泛的。</p><p>但是每次手动调用程序去转写一个音频文件，未免还是感觉有点麻烦，尤其是对于程序员来说。</p><p>比如现在我们转写一个音频文件，需要在命令行执行如下命令：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">python3 </span><span class="token operator" style="color:#393A34">~</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mark_keeps_learning</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">mark_scripts</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">voice2srt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py 目标音频文件路径</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然我们也可以使用<code>alias</code>手段，把这一串命令缩短成一个词，以方便我们直接使用<code>voice2srt 目标音频文件路径</code> 的命令完成目标，但还是要基于命令行，多有不便。</p><p>主要是，我们也不需要修改其他参数（基本按照默认即可，热词已经在讯飞官网配好了）。</p><p>那么这种纯粹基于文件的操作，在 mac 平台上最好的办法是写一个<code>automator</code>脚本：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652532742053-608328c5fa3dc43bb127e4acf67d24ca3a9b96c3dc785f182745c4301b002348.png" alt="picture 7" class="img_vXGZ"></p><p>这样我们就可以直接在 finder 里面右键我们的音频文件，然后在快捷菜单中找到我们的 automator 脚本选项，鼠标一点就自动转成了，非常方便！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533417457-750a70456486d620a0f3e313e6e431fbe6530aa99aa51b04b6899cb39f4defa9.png" alt="picture 9" class="img_vXGZ"></p><p>十秒钟之后，就自动在当前文件夹内生成一个讯飞转写后的字幕文件了，非常方便：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533472130-84eedb0ba0b9f481f2ae1d09fffb8d14c58ff3543e83d8225237eed6627be5f3.png" alt="picture 10" class="img_vXGZ"></p><p>并且我将标准输出重定位到了根目录的 log 文件，这样就可以在程序出错时复查：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/auto-voice2srt-1652533562489-e40a4b0b90122321cf4ca18cc2a9ffdf12deaa944aa86ca2cc3fcc421d5809e7.png" alt="picture 11" class="img_vXGZ"></p><p>Automator 是一个很有用的工具，我也对它越来越感兴趣了，比如说还写了一个网易云音乐 ncm 转 mp3 的快捷操作，这样右键一个 ncm 文件，就能转成 mp3 了，非常方便。</p><p>但愿本文对你有帮助~</p>]]></content:encoded>
            <category>开发笔记</category>
            <category>字幕</category>
        </item>
        <item>
            <title><![CDATA[研究 | 基于 MBTI 的人生复盘与计划（上）]]></title>
            <link>https://markshawn2020.github.io/blog/2022/04/22/research-mbti/mark_mbti</link>
            <guid>/2022/04/22/research-mbti/mark_mbti</guid>
            <pubDate>Fri, 22 Apr 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[很久以前就知道这个测试，但一直都没重视。]]></description>
            <content:encoded><![CDATA[<p>很久以前就知道这个测试，但一直都没重视。</p><p>最近因缘际会之下，认真研究了一番，确有所获，故记之。</p><p>本文将分上、中、下，共记录自己对 MBTI 官网 60 道题的思考与复盘，以期明确自己的性格与未来规划。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="什么是-mbti">什么是 MBTI<a class="hash-link" href="#什么是-mbti" title="标题的直接链接">​</a></h2><p>在微信搜索 MBTI 可以发现有大量相关的文章：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650191510091-869f49efefa5c82cbd0498200c946d0c25184af482573e2138fc8d5135e1dfc0.png" alt="picture 2" class="img_vXGZ"></p><p>在 MBTI 官网可以找到这个理论的一些定义： <a href="https://www.16personalities.com/articles/our-theory" target="_blank" rel="noopener noreferrer">Our Framework | 16Personalities</a></p><p>想要获得大概认识的话，可以看 B 站这个，讲的生动有趣： <a href="https://www.bilibili.com/video/BV1a44y1L7Yw/?spm_id_from=333.788.recommend_more_video.-1" target="_blank" rel="noopener noreferrer">全网最详细 MBTI 解析！|满满干货！|迷茫必看！<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p><p>想知道影视人物表现出的十六种性格类型，可以看： <a href="https://www.bilibili.com/video/BV1Sp4y1e7rd/?spm_id_from=trigger_reload" target="_blank" rel="noopener noreferrer">通过影视人物表现的 16 种性格类型<!-- -->_<!-- -->哔哩哔哩<!-- -->_<!-- -->bilibili</a></p><p>简单来说：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650334147954-04a55bf30f67666f993ad5b229ae481425b91249ed1ce5958aca572e67b0d6a7.png" alt="picture 5" class="img_vXGZ"></p><p>为方便理解，我们姑且称这四类人格属性记为：<strong>能量（EI）、感知（SN）、决策（TF）、行动（JP）</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="能量ei">能量（E/I）<a class="hash-link" href="#能量ei" title="标题的直接链接">​</a></h3><p>很多人会把 MBTI 的 EI 题用来判断自己是否外向，再进一步退化，叫是否“social”，其实我觉得不是这样的。</p><p>我们看上面那个英文解释，叫“Direction of energy and attention focus”，这个解释听起来很高大上，甚至让我联想到了火影忍者里的查克拉：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650528165570-2e2c83e637efc29b22e77bd29ad1c493397a85d5106c8225afe475326fe4ca9c.png" alt="picture 4" class="img_vXGZ"></p><p>具体来讲，就是注意力集中在何处（内心还是世界），从哪里（内心还是世界）获得动力（能量的流向）。</p><p>在这个问题上，我觉得我是坚定的更关注内心的一派，我心即宇宙，我的社交也是为了更好地构筑我的内心，所以我现在其实是 I，以后也会是 I，当然这并不意味着我未来会减少社交（尽管有这个可能，也可能相反）。</p><p>阅读/学习 --&gt; 社交/交流 --&gt; 实践 --&gt; 阅读/学习，对我来说，这是一个闭环的过程。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="感知sn">感知（S/N）<a class="hash-link" href="#感知sn" title="标题的直接链接">​</a></h3><p>其实这个我不是特别懂~</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="决策tf">决策（T/F）<a class="hash-link" href="#决策tf" title="标题的直接链接">​</a></h3><p>基于逻辑（T）还是感觉（F）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="行动jp">行动（J/P）<a class="hash-link" href="#行动jp" title="标题的直接链接">​</a></h3><p>基于计划（J）还是冲动（P）。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="我的-mbti-分析">我的 MBTI 分析<a class="hash-link" href="#我的-mbti-分析" title="标题的直接链接">​</a></h2><p>根据 MBTI 官网的规则，每道题的选项空间有七个，我们标记如下：</p><ul><li>3：极其同意</li><li>2：比较同意</li><li>1：相对同意</li><li>0：中立</li><li>-1：相对不同意</li><li>-2：比较不同意</li><li>-3：极其不同意</li></ul><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650539429940-14379162bf5bf19ae2c692bd1eb5c110fcd3e0a44b4b3837408555c74d5fdcaa.png" alt="picture 9" class="img_vXGZ"></p><p>考虑到我个人的独特成长经历，以下每道题，我将给出我的分析过程，并且分别给出我现在（特指目前工作期间）、我期望（特指终极人生目标）等两种不同状态的答案。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-you-regularly-make-new-friends">1. You regularly make new friends<a class="hash-link" href="#1-you-regularly-make-new-friends" title="标题的直接链接">​</a></h3><p>我是否经常结交新朋友？</p><p>EI 题。是的。</p><p>通常情况下，人都喜欢交朋友，比如交越来越多的朋友与质量越来越高的朋友。不过这也并非人人如此。</p><p>最简单的，我注意到大学毕业时，不同学生的微信好友数目天差地别，有的只有两三百个，甚至更少；而有的则有两三千个，甚至更多。我应该属于中间水平。</p><p>从经验上看，大部分年轻人交友少的最大原因，可能是沉迷自己的兴趣或者缺乏自信，他们在认识新朋友时会更容易紧张与不安。也就是说，更多的是一种被动结果。</p><p>而一些有名望的人则是另一种局面，他们更多地可能会选择主动避免与回避某些社交，比如冯唐，因为他们认为这些潜在的朋友不能带给自己更多的价值。</p><p>我觉得我大学时期看起来还是比较 E（Extravert）的，因为那时候我在班级里公开募资炒股、参加了一个社团、创办了一个社团、经常要打需要上台展示的商赛、经常参加某些商业或学术会议等。</p><p>但怎么说呢，其实我知道我的骨子里是 I（Introvert）的，因为如果非无必要，我更倾向于独处，比如就像现在这般，好好地码会字，这让我感到很安详。</p><p>我在社交平台上的话绝对属于不算少的那类，但更多的情况下，（我觉得）那是因为我 FP 的性格底色让我想要发表更多，而非想要获得更多。</p><p>所以我之前应该是比较喜欢交朋友，现在也是比较喜欢，最后我希望自己是较为喜欢（从 2 降到 1）。</p><p>ANS: 2, 1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-you-spend-a-lot-of-your-free-time-exploring-various-random-topics-that-pique-your-interest">2. You spend a lot of your free time exploring various random topics that pique your interest<a class="hash-link" href="#2-you-spend-a-lot-of-your-free-time-exploring-various-random-topics-that-pique-your-interest" title="标题的直接链接">​</a></h3><p>我是否花很多时间在一些引起兴趣的随机话题上？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650536422237-de67e0eb440c23f578f517213c56442c737d0a21d15c7a930f139af17d30fb47.png" alt="picture 8" class="img_vXGZ"></p><p>感觉是 TF 题。是的，比如小花梅、上海疫情等。</p><p>很显然，目前应该是的，毕竟上海疫情一个月以来，由于其前所未有的三观崩裂，我几乎是上海瓜田里乱窜的猹钻来钻去，已经花费了很长的时间。</p><p>但怎么说呢，这个东西，既有优点又有缺点，其实本质问题就是是否有足够的好奇心，代价就是容易影响到自己既有的计划。</p><p>我应该一直都是比较容易花时间研究感兴趣的事情的人（并不惜改变牺牲一些既定需要完成的任务，以至于……我最后毕业后竟然跨行工作了……）。</p><p>未来我可能还会继续关注投资、潮流等领域，因此对于这道题，应该来说，不可能完全选不同意，比较合理的答案是曾经比较同意，未来相对不同意（毕竟那时候三观较为稳定了，不太需要一直关注外界的新东西）。</p><p>ANS: 2, -1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-seeing-other-people-cry-can-easily-make-you-feel-like-you-want-to-cry-too">3. Seeing other people cry can easily make you feel like you want to cry too<a class="hash-link" href="#3-seeing-other-people-cry-can-easily-make-you-feel-like-you-want-to-cry-too" title="标题的直接链接">​</a></h3><p>我是否看见别人哭时也容易哭？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650531710336-50117e102315a84601fd2742f15a8316b657e1ed35d0dd4ce096661ef638017d.png" alt="https://www.pinterest.com/pin/10344274142071053/" class="img_vXGZ"></p><p>TF 题。是的。</p><p>我真心觉得我泪点还是比较低的，比如看红楼梦、人世间等， 真能把我哭个半死，抑郁好长时间。</p><p>以前是见不得女孩哭，后来慢慢地，基于众所周知的原因，更见不得男人哭。</p><p>不过我不觉得这是个什么丢人的事，同理心，人皆有之，而且我的职业也不需要我过多的压抑自己的情绪。</p><p>我并不想变得过于冷血，但我也希望未来自己情绪能更稳定一些、更客观一些（-1 到 1 之间），但具体想偏向哪边说实话我还真不能确定。</p><p>我未来到底还希不希望自己看到别人哭时自己也愿意稍微哭一点呢？</p><p>或许可以从佛学中得到点启示，平和心吧，所以未来希望是 0，不悲也不喜。</p><p>但考虑到尽量不要选中性答案，既然生而为人，还是选相对同意吧。</p><p>ANS: 2, 1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="4-you-often-make-a-backup-plan-for-a-backup-plan">4. You often make a backup plan for a backup plan<a class="hash-link" href="#4-you-often-make-a-backup-plan-for-a-backup-plan" title="标题的直接链接">​</a></h3><p>我经常为 B 计划准备 C 计划吗？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650531918847-2d9b44b3cf77e6820e9f289cee4c5c1edd97adaa1a9e460678296f478b8d98b8.png" alt="picture 6" class="img_vXGZ"></p><p>JP 题。否。</p><p>hmm，这道题，我应该是坚定地选否了，我甚至一般都没有 B 计划，只有 A 计划。</p><p>我向来不是很喜欢做策划、执行类工作，而且未来大概率也不会。</p><p>也向来是一个敢爱敢恨、敢拼敢做的人，经常在自己只有 59 分的时候去挑战 99 分的任务，最终可能只有 79 分。</p><p>有些时候赢了，有些时候输了。</p><p>坦白说，很多时候真没想过输了后会怎么做。</p><p>只有一条：无论输赢，我们的人生都将继续下去。</p><p>每每想到这，我也就没有什么好怕的，只要想，便往前冲就是。</p><p>所以，目前是-3，未来有孩子之类的话，大概率是-1。</p><p>ANS: -3, -1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="5-you-usually-stay-calm-even-under-a-lot-of-pressure">5. You usually stay calm, even under a lot of pressure<a class="hash-link" href="#5-you-usually-stay-calm-even-under-a-lot-of-pressure" title="标题的直接链接">​</a></h3><p>我经常在高压状态之下也能保持冷静？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650532878798-6bc68acc10908ff74441338a18fe6d16500b0b74634dcd1617551dee5a81a368.png" alt="picture 7" class="img_vXGZ"></p><p>TF 题。是的。</p><p>接上题，我觉得很多情况下，之所以有勇气去承接一些新的项目、面对一些新的风暴、挑战一些新的极限，其很重要的一个原因，是我确实经常能够保持冷静，我也有段时间刻意去控制、训练自己的这种特质。</p><p>在高压状态下，比如临考前、项目攻关之时，我会刻意地去冲澡、冥想、听舒缓或激动的音乐，压力极大的情况下也可能考虑抽两根烟，保持头脑的镇定，审视自己能调用的所有资源，仔细去思考问题的可行方案。</p><p>这些一次又一次的艰难考验，磨练了我的意志力，并不断内化为心中的平稳与自信，最终外化为情绪的稳定与镇静，进一步增大我做成一件事的概率。</p><p>正如马斯克所言，比起悲观，他更倾向于乐观。</p><p>我也如此，在此基础之上，比起慌乱，我更倾向于冷静。</p><p>不过其实，我也曾经有过巨大的怀疑过，大学里有一次因为一件很小的社团矛盾，顿感过人生的不值得，当时我在宿舍楼的楼顶，说实话真有一股向下的冲动，还好当时有着封锁起来的玻璃门，现在想来也是十分地幼稚的。尽管这么说并不够负责，我们不能把现在的心态去作用在当时上面。</p><p>人的内心是逐渐成长的，但未来的问题也会越来越大，它就像一追一赶的关系，你真地不知道什么时候你会有完全撑不住的时候，maybe 买房还贷资金锻炼的时候？or maybe 亲人……</p><p>May peace with us all.</p><p>ANS: 3, 3</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="6-at-social-events-you-rarely-try-to-introduce-yourself-to-new-people-and-mostly-talk-to-the-ones-you-already-know">6. At social events, you rarely try to introduce yourself to new people and mostly talk to the ones you already know<a class="hash-link" href="#6-at-social-events-you-rarely-try-to-introduce-yourself-to-new-people-and-mostly-talk-to-the-ones-you-already-know" title="标题的直接链接">​</a></h3><p>在社交场合，我是否经常与熟人交谈，而非向陌生人介绍自己？</p><p>EI 题。是的。</p><p>如非职业需要，我想大多数人应该都倾向于与熟人交流，而非与陌生人吧~</p><p>但这不代表这问题就不重要，毕竟 MBTI 可辅助作为职业性格测试。</p><p>也许真地有天生就喜欢认识新人的人存在？</p><p>遗憾的是，我不属于这类；幸运的是，我的职业同样不需要我主动地去认识更多的人。</p><p>所以在这点上我不拧巴，也不需要拧巴。</p><p>但其实在这点上我做的应该还好，我也曾试过在社交场合主动地去认识我感兴趣的人，最后的效果其实还不错。大部分当时就得到了回应，后续还成为了不错的朋友。</p><p>在社交场合，适当地主动认识自己感兴趣的人，应该是我的主基调，因此我选较为认同。</p><p>ANS: 1, 1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="7-you-prefer-to-completely-finish-one-project-before-starting-another">7. You prefer to completely finish one project before starting another<a class="hash-link" href="#7-you-prefer-to-completely-finish-one-project-before-starting-another" title="标题的直接链接">​</a></h3><p>我更倾向于在完成一个项目之后再开启另一个？</p><p>JP 题。是的。</p><p>我记得我在大学的某个大课堂上，对着学弟学妹们公开说我是一个比较喜欢多线程的人，比如同时聊天同时忙着学习等。</p><p>但事实上，我后来意识到，其实不是这样的。</p><p>我反思我若能同时进行某些东西，它们一般是比较平凡的、不需要太多脑力的。</p><p>但这其实已经与我这几年的真实工作场景有所区别，目前我的很多项目压力还是较大的、有不可预期的失败风险，因此需要我全身心的投入，比如考研和一些商业开发项目。</p><p>而经过这些项目的历练，我意识到，我其实并不擅长同时进行多个项目。具体地说，我其实并不适合项目管理那种职业角色，我现在很喜欢目前的开发工作，那种全程从 0 到 1、完全掌握自己的进度，最终把东西完美结项的感觉是我非常享受的。</p><p>因此，这道题，我目前是很同意的，因为比起多条线同时操作导致的意外风险，我更希望能一个个来，这样会更有信心一些，all-in 的感觉说实话真地很不错。</p><p>之前看马斯克说他在最艰难的时候面临两家公司的取舍问题，最终他坚持了两个一起搞并且都成功了。</p><p>我不确定我是否也会面临那样的抉择，但大概率是会的；我也不确定最终是否也能那么顺利，也许也是会的。</p><p>但我内心还是希望，能一个个来的。</p><p>ANS: 2, 2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="8-you-are-very-sentimental">8. You are very sentimental<a class="hash-link" href="#8-you-are-very-sentimental" title="标题的直接链接">​</a></h3><p>我是否多愁善感？</p><p>TF 题。是的。</p><p>我是一个典型的巨蟹座，多愁善感。（当然这也与我很多比较坎坷的人生经历有关）</p><p>我自己虽然不信星座，但是巨蟹的多愁善感倒是逐渐刻进了我的基因，并且接受了这种设定。</p><p>根据<a href="https://www.zhihu.com/question/19621312" target="_blank" rel="noopener noreferrer">星座合理性在哪里？ - 知乎</a>，整理星座有效性的背后理论如下：</p><ol><li>巴纳姆效应：人倾向于相信一个笼统的、抽象的人格描述，并认为适合自己</li><li>证实性偏见：人倾向于寻找支持预设观点的证据，并忽略相反证据</li><li>罗森塔尔效应：心理暗示让人按照暗示的方向去实现自己</li></ol><p>我的理解是星座就是个潘多拉魔盒，在你不了解之前，你觉得自己是多面性的、有无限发展潜能的。而当你接触之后，你首先会接受该星座的某些预设成见，并逐步相信，按照这个去发展自己，而同时，身边也有越来越多的人加入这个队伍，并进一步巩固这个理论的科学性。</p><p>于是，这个理论，便持久地在这个世界上运转了，除非有猛烈的文章去抨击它，致使所有人都觉得这个理论的荒谬。然而，大家普遍又没有去推翻这个机制的动机，因为星座本身，是中性的、无害的，与其所有人都完全清醒地活着，不如多一个可以找乐子、并且确实有很多被证实的先例的理论，用以发展社交。</p><p>同时根据 MBTI，相信星座的可能更多的是 N 型人格，情侣或者朋友之间如果恰好都相信星座，可以多一条维系情感的纽带，属于同一磁场的人；当然基于星座再衍生出来的配对理论，情侣之间如果恰好处于不那么准的一对的话，据我的直觉与经验，他们也会选择无视。</p><p>从这个角度上来说，相信星座的人把星座当做自己工具箱中的一个有利工具，他们会在这个工具合适的时候拿出来用，不合适的时候就放在那。</p><p>基于以上，我也不打算对我多愁善感的性格多有什么其他的想法，顺其自然即可。</p><p>ANS: 3, 2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="9-you-like-to-use-organizing-tools-like-schedules-and-lists">9. You like to use organizing tools like schedules and lists<a class="hash-link" href="#9-you-like-to-use-organizing-tools-like-schedules-and-lists" title="标题的直接链接">​</a></h3><p>我喜欢使用计划表、列表等组织工具？</p><p>JP 题。是的。</p><p>很显然，是否有使用计划工具的偏好与习惯，是能体现一个人的自律性。而近几年烂大街推崇的自律，又是每个人都无法绕开的一个命题。</p><p>但很可惜的是，我们喜欢与拥有计划工具，却并不意味着我们就能贯彻执行。</p><p>从我自己出发，我在大学里的时候说实话，计划性不强，因为其实每天都有很多事要做，立即要做，而非有一个长远的目标。</p><p>关于这点，有一位学长对我的分析特别到位，他说我更喜欢做那些紧急但不重要的事（例如比赛），而非那些不紧急但重要的事（例如考研）。</p><p>确实如此，我绝大多数比赛的结果都较为乐观，但在考研上确实付出了较为沉重的代价。这是值得反思的。</p><p>不过考研也确实锻炼了我的计划能力，我曾经给自己定制了极其充实的日程表，也确实严格执行了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650561197857-3298ddc49b513140b522a5321953f7d8b34c63cde6e72a8ee204d47e6f931c57.png" alt="picture 10" class="img_vXGZ"></p><p>在那之后，又经过了某些高强度项目的淬炼，对计划（尤其是 TODO）之类的管理更加重视，但随着数目的增长也确实越来越难以管理。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_mbti-1650561373371-a78bfa618506879b11a26d0582069974dfad3db3d9994e0f93bd16138298813f.png" alt="picture 11" class="img_vXGZ"></p><p>但不管怎样，承认自己的脑子不如一些计划工具好用，我将尽量使用与坚持使用计划工具管理自己。</p><p>ANS: 3, 3</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="10-even-a-small-mistake-can-cause-you-to-doubt-your-overall-abilities-and-knowledge">10. Even a small mistake can cause you to doubt your overall abilities and knowledge<a class="hash-link" href="#10-even-a-small-mistake-can-cause-you-to-doubt-your-overall-abilities-and-knowledge" title="标题的直接链接">​</a></h3><p>我会因为一个小错误而自我怀疑自己的整体能力吗？</p><p>可能是 TP 题。不会。</p><p>错误是在所难免的，关键是错在哪一层，以及错到哪一层。</p><p>这让我不禁想起机器学习的原理，即不断地从误差中完善自身，以减少最终的误差。</p><p>我们接受了十多年的教育，对我们所学习的理论、人文知识有着充足的信心，不大可能轻易地动摇对我们自身能力系统的信任基础。</p><p>但容易崩溃的场景确实存在，并且很难避免。</p><p>我的看法是，保持开诚互、敏捷反应、终身学习！</p><p>ANS: -3, -3</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="11-you-feel-comfortable-just-walking-up-to-someone-you-find-interesting-and-striking-up-a-conversation">11. You feel comfortable just walking up to someone you find interesting and striking up a conversation<a class="hash-link" href="#11-you-feel-comfortable-just-walking-up-to-someone-you-find-interesting-and-striking-up-a-conversation" title="标题的直接链接">​</a></h3><p>我是自来熟吗？</p><p>EI 题。是的。</p><p>尽管大多数时候我其实并不够自信，同时也因为没有正式学习过一些社交礼仪、技巧相关的经历，所以其实类似自来熟的能力，我是不怎么具备的。</p><p>但我联想到我的过往，我确实会愿意去主动与我感兴趣的人交流，比如讲座过后去追问老师一些问题甚至所要联系方式，以及曾经当着女朋友面去问别的女孩微信以体现自己的社牛（这是后来反思做过的最傻逼的事情之一）。</p><p>因此，这道题还是偏同意为主。未来并不打算变得更加主动，也不打算变得相反，维持目前这个级别的社交意愿与能力即可。</p><p>ANS: 1, 1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="12-you-are-not-too-interested-in-discussing-various-interpretations-and-analyses-of-creative-works">12. You are not too interested in discussing various interpretations and analyses of creative works<a class="hash-link" href="#12-you-are-not-too-interested-in-discussing-various-interpretations-and-analyses-of-creative-works" title="标题的直接链接">​</a></h3><p>我是否对开发性的、分析性的创意工作的交流不太感兴趣？</p><p>TF 题。否。</p><p>我还是比较喜欢开放性的话题的。</p><p>而且众所周知，一部电影（例如误杀）/一本书（例如红楼梦），留给大家的是一个开放性的结尾，会让人觉得很意味深长。</p><p>也许会有人更加喜欢确定的、被安排好的结局（大概真地存在吧！），但我一定是投开放票的（如果有的话）。</p><p>而在实际工作中，我们往往需要具备全局统筹的能力，照顾安排各方的想法意见等，例如对于上海疫情到底是封城好还是放开好等，我是相对比较喜欢去研究这些问题。（参见： <a href="https://www.youtube.com/watch?v=Y4HqXP47lPQ" target="_blank" rel="noopener noreferrer">《正義：一場思辨之旅》之電車問題 (雙語字幕) - YouTube</a>）</p><p>但这也有一定的缺点，那就是讨论的越激烈越容易迷失，花费很多时间但其实大多数情况下不能得出一个实际可操作的解，例如我曾经和基友通宵讨论“灵魂伴侣是否存在”……</p><p>ANS: -2, -2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="13-you-are-more-inclined-to-follow-your-head-than-your-heart">13. You are more inclined to follow your head than your heart<a class="hash-link" href="#13-you-are-more-inclined-to-follow-your-head-than-your-heart" title="标题的直接链接">​</a></h3><p>我更愿意听从我的理智而非内心？</p><p>TF 题。否。</p><p>这道题，其实……怎么说呢，应该说是一个经典的问题了，听从理智，亦或顺从内心。</p><p>在回答这个问题之前，我觉得我们得首先做个较为明确的定义，即什么是理智什么是内心。</p><p>我个人认为理智就是更关注外界的条件如何，而内心则更关注自己能做到什么地步。</p><p>而当我们讨论到底是顺从理智还是顺从内心时，可能更多的是在考虑：面临客观的条件，我们在多大程度上愿意发挥主观能动性？</p><p>很多电影都喜欢植入这样的理念：主人公在关键的时候，听从了自己的内心，经历了非凡的考验，最终得到一个圆满的结果的。比如《毕业生》里男主的理智告诉自己和罗宾逊夫人是不可能的，但还是听从了内心，大胆地去尝试。</p><p>很有意思的是，当我们产生某些情愫时，好像心脏部分确实有更大的反应，我不是很懂心理学与生理学，但似乎这些反应确实导致了我们将“心”和“脑”分成两部分去独立看待，一部分叫感性，一部分叫理性。然而近几年“上头”或者“下头”的网络词又不胫而走，似乎开始模糊理智和内心之间的界线。</p><p>我的观点，我觉得强制把心和脑分开去讨论，可能是有点偷懒的。无论做什么决定，其实都是经过我们思考的。就拿表白来说，我不认为鼓起勇气表白属于顺心，反之顺脑；我可能更倾向于认为前者只是更有勇气、风险偏好较高，后者相反而已。</p><p>理智与内心可能并非对立的，更多的时候，它们两，我觉得，是综合的，即最终合起来进入大脑的决策，而非要么进入理智的门、要么进入内心的门，好像我们的身体中有两个决策机构一样。</p><p>比如 21 年我决定去骑行川藏线，那几乎就是一晚上做完的决定，其实从理智层面我知道会有很大的风险，我在尚未认识到足够多的风险之前，就直接光速上阵了，后续路上我重摔过两次，还在在羊湖的山顶差点冻死，因此比起理智与审慎，我确实更倾向于坚持内心想做的事，未来大概率也不会变。</p><p>我宁可后悔而不想留有遗憾。</p><p>未来我其实希望自己更理智一些，不过估计做不到，那就略微从-3 提到-2 吧。</p><p>ANS: -3, -2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="14-you-usually-prefer-just-doing-what-you-feel-like-at-any-given-moment-instead-of-planning-a-particular-daily-routine">14. You usually prefer just doing what you feel like at any given moment instead of planning a particular daily routine<a class="hash-link" href="#14-you-usually-prefer-just-doing-what-you-feel-like-at-any-given-moment-instead-of-planning-a-particular-daily-routine" title="标题的直接链接">​</a></h3><p>比起循规蹈矩，我更喜欢基于当时的感觉做自己想做的事？</p><p>JP 题。是的。</p><p>循规蹈矩、按流程办事，很适合执行人员风格。</p><p>但我逐渐地意识到，按照既定计划做事而无视其他临时的冲动，当且仅当这个既定的计划是有效的、是我愿意去执行的，才行。</p><p>但很多时候，我们发现我们不得不去做一些我们当时不愿意去乖乖执行的事。</p><p>这些事中，有些我们后悔了，比如学生时代的眼保健操、正楷书法等，不重视、不愿意去好好地练，未来都吃到了不同程度的苦头。</p><p>无可否认的是，即使站在当下这个时间点，再去审视从前，以及现在，会发现很多情况下，我们还是公然地在自己的既定计划上“为非作歹”：不够自律，思想飘忽，并且绝大多数这些本可以用于工作的时间和精力投入到其他地方后，并没有给自己带来多少的增益。</p><p>很难说这些思想的自由流动，是否真正构建了灵魂的自由，我多多少少难以说服自己说：不要再乱想了，先把手头任务完成再说吧！</p><p>不过，我还是希望尽量吧。</p><p>ANS: 3, 2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="15-you-rarely-worry-about-whether-you-make-a-good-impression-on-people-you-meet">15. You rarely worry about whether you make a good impression on people you meet<a class="hash-link" href="#15-you-rarely-worry-about-whether-you-make-a-good-impression-on-people-you-meet" title="标题的直接链接">​</a></h3><p>我很少担心自己给别人留下的印象好不好？</p><p>EI 题。是的。</p><p>其实一般来说，我们但不担心给别人留下坏印象，主要取决于对方在自己心中重不重要（包括情感方面或者利益方面）。</p><p>不过抛开上者不谈，我也确实曾经因为某些事，了解到某些人对我的负面评价，自那之后，我深刻地明白这个世界想让所有人都满意是不可能的。</p><p>哪怕是雷锋，好人至此，都被一群小人所记恨呢。</p><p>现在我就倾向于做好自己，走自己的路，让别人去说；当然，适当了解一下别人的看法，有助于自己的进一步提高。</p><p>ANS: 2, 2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="16-you-enjoy-participating-in-group-activities">16. You enjoy participating in group activities<a class="hash-link" href="#16-you-enjoy-participating-in-group-activities" title="标题的直接链接">​</a></h3><p>我喜欢参与集体活动？</p><p>EI 题。否。</p><p>不是很喜欢，更加喜欢独立做些东西，发挥自己的主导作用而非螺丝钉作用。</p><p>不过如果有很好的朋友在里面，倒是很乐意一起。</p><p>ANS: -2, -2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="17-you-like-books-and-movies-that-make-you-come-up-with-your-own-interpretation-of-the-ending">17. You like books and movies that make you come up with your own interpretation of the ending<a class="hash-link" href="#17-you-like-books-and-movies-that-make-you-come-up-with-your-own-interpretation-of-the-ending" title="标题的直接链接">​</a></h3><p>我喜欢开放性结尾的书籍和电影？</p><p>TF 题。是。</p><p>接近第 12 题。</p><p>ANS: 2, 2</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="18-your-happiness-comes-more-from-helping-others-accomplish-things-than-your-own-accomplishments">18. Your happiness comes more from helping others accomplish things than your own accomplishments<a class="hash-link" href="#18-your-happiness-comes-more-from-helping-others-accomplish-things-than-your-own-accomplishments" title="标题的直接链接">​</a></h3><p>我的快乐更多地来自于帮助别人，而非来自于自己？</p><p>EI 题。否。</p><p>我其实一直都是一个挺乐意帮助别人的人。</p><p>在大学期间，真地抱着去改变一些东西的想法，去办社团、开展编程教学等。</p><p>当然，这中间，有没有掺杂一些表现欲，肯定还是有的。</p><p>但是后来，我发现，从客观角度来说，这样的时间、精力成本太高了，简而言之就是：一个人可以走的很快，一群人走的很远。</p><p>但问题是，话虽这么说，这个“一群人”却往往不是那么牢固的，今天是这群人，明天就是那群人，这是很多问题的一些根源。</p><p>这个想法，非我一人。</p><p>我有一位学长，在我们社团也是出了名的乐于助人。很遗憾的是，后来他读研后告诉我，他已经不那么热衷于改变身边的人了（主要是硕士阶段的同学思维已经快成型，不热衷于听别人的想法与建议了）。</p><p>我从他语气中读出的那种失望，至今仍印象深刻。</p><p>我希望能更多地去帮助确实需要帮助、并且对彼此成长都有益的人（比如今年创了个行业交流群，独乐乐不如众乐乐），而非盲目地、非选择性地来者不拒。</p><p>但总体来说，我还是倾向于自己完成一些东西，这样更有成就感，这么想的原因也可能是因为认识到了自己羽翼确实不够丰满。</p><p>也许有朝一日，可以完全不需要在乎自己的目前水平，而致力于投身于从别人的成功那里获取快乐，尽管不知道这种转变有没有足够的必要。</p><p>ANS: -1, -1</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="19-you-are-interested-in-so-many-things-that-you-find-it-difficult-to-choose-what-to-try-next">19. You are interested in so many things that you find it difficult to choose what to try next<a class="hash-link" href="#19-you-are-interested-in-so-many-things-that-you-find-it-difficult-to-choose-what-to-try-next" title="标题的直接链接">​</a></h3><p>我的兴趣实在过于广泛以至于经常在选择上犯难？</p><p>TF 题。绝对是的！</p><p>这题我有绝对的发言权，毕竟我是那么深入地同时研究金融与计算机过，从我大二开始，我就在要不要投入到计算机行业这个问题上十分纠结。</p><p>大三在投行实习时，我老板跟我聊我的未来规划的问题，她直截了当地说总有一天我是要必须做出选择的：金融亦或计算机，而非两个同时学。</p><p>也许是命中注定，后来，可能是因为我过于明确地表达我有考研的意愿，我最终在华兴投行的 hr 面试中被拒绝。</p><p>再之后，我领导开发了很多初中期公司的商业项目，深知自己非全身心投入到某个具体领域中去炮炼成长不可，因此便再也不考虑金融行业的择业方向了。</p><p>我相信，金融与计算机的择业问题，仅仅还是我人生生涯中的第一个较大的选择问题。以我的性格，未来还将继续饱受折磨。</p><p>ANS: 3, 3</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="20-you-are-prone-to-worrying-that-things-will-take-a-turn-for-the-worse">20. You are prone to worrying that things will take a turn for the worse<a class="hash-link" href="#20-you-are-prone-to-worrying-that-things-will-take-a-turn-for-the-worse" title="标题的直接链接">​</a></h3><p>你很容易担心事情会往坏的方向去发展？</p><p>SN 题。否。</p><p>没啥可担心的，兵来将挡水来土掩，能乐观绝不悲观（但会做好最悲观的打算）。</p><p>ANS: -3, -3</p><hr><p>【待续！】</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="21-you-avoid-leadership-roles-in-group-settings">21. You avoid leadership roles in group settings<a class="hash-link" href="#21-you-avoid-leadership-roles-in-group-settings" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="22-you-are-definitely-not-an-artistic-type-of-person">22. You are definitely not an artistic type of person<a class="hash-link" href="#22-you-are-definitely-not-an-artistic-type-of-person" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="23-you-think-the-world-would-be-a-better-place-if-people-relied-more-on-rationality-and-less-on-their-feelings">23. You think the world would be a better place if people relied more on rationality and less on their feelings<a class="hash-link" href="#23-you-think-the-world-would-be-a-better-place-if-people-relied-more-on-rationality-and-less-on-their-feelings" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="24-you-prefer-to-do-your-chores-before-allowing-yourself-to-relax">24. You prefer to do your chores before allowing yourself to relax<a class="hash-link" href="#24-you-prefer-to-do-your-chores-before-allowing-yourself-to-relax" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="25-you-enjoy-watching-people-argue">25. You enjoy watching people argue<a class="hash-link" href="#25-you-enjoy-watching-people-argue" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="26-you-tend-to-avoid-drawing-attention-to-yourself">26. You tend to avoid drawing attention to yourself<a class="hash-link" href="#26-you-tend-to-avoid-drawing-attention-to-yourself" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="27-your-mood-can-change-very-quickly">27. Your mood can change very quickly<a class="hash-link" href="#27-your-mood-can-change-very-quickly" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="28-you-lose-patience-with-people-who-are-not-as-efficient-as-you">28. You lose patience with people who are not as efficient as you<a class="hash-link" href="#28-you-lose-patience-with-people-who-are-not-as-efficient-as-you" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="29-you-often-end-up-doing-things-at-the-last-possible-moment">29. You often end up doing things at the last possible moment<a class="hash-link" href="#29-you-often-end-up-doing-things-at-the-last-possible-moment" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="30-you-have-always-been-fascinated-by-the-question-of-what-if-anything-happens-after-death">30. You have always been fascinated by the question of what, if anything, happens after death<a class="hash-link" href="#30-you-have-always-been-fascinated-by-the-question-of-what-if-anything-happens-after-death" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="31-you-usually-prefer-to-be-around-others-rather-than-on-your-own">31. You usually prefer to be around others rather than on your own<a class="hash-link" href="#31-you-usually-prefer-to-be-around-others-rather-than-on-your-own" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="32-you-become-bored-or-lose-interest-when-the-discussion-gets-highly-theoretical">32. You become bored or lose interest when the discussion gets highly theoretical<a class="hash-link" href="#32-you-become-bored-or-lose-interest-when-the-discussion-gets-highly-theoretical" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="33-you-find-it-easy-to-empathize-with-a-person-whose-experiences-are-very-different-from-yours">33. You find it easy to empathize with a person whose experiences are very different from yours<a class="hash-link" href="#33-you-find-it-easy-to-empathize-with-a-person-whose-experiences-are-very-different-from-yours" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="34-you-usually-postpone-finalizing-decisions-for-as-long-as-possible">34. You usually postpone finalizing decisions for as long as possible<a class="hash-link" href="#34-you-usually-postpone-finalizing-decisions-for-as-long-as-possible" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="35-you-rarely-second-guess-the-choices-that-you-have-made">35. You rarely second-guess the choices that you have made<a class="hash-link" href="#35-you-rarely-second-guess-the-choices-that-you-have-made" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="36-after-a-long-and-exhausting-week-a-lively-social-event-is-just-what-you-need">36. After a long and exhausting week, a lively social event is just what you need<a class="hash-link" href="#36-after-a-long-and-exhausting-week-a-lively-social-event-is-just-what-you-need" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="37-you-enjoy-going-to-art-museums">37. You enjoy going to art museums<a class="hash-link" href="#37-you-enjoy-going-to-art-museums" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="38-you-often-have-a-hard-time-understanding-other-peoples-feelings">38. You often have a hard time understanding other people’s feelings<a class="hash-link" href="#38-you-often-have-a-hard-time-understanding-other-peoples-feelings" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="39-you-like-to-have-a-to-do-list-for-each-day">39. You like to have a to-do list for each day<a class="hash-link" href="#39-you-like-to-have-a-to-do-list-for-each-day" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="40-you-rarely-feel-insecure">40. You rarely feel insecure<a class="hash-link" href="#40-you-rarely-feel-insecure" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="41-you-avoid-making-phone-calls">41. You avoid making phone calls<a class="hash-link" href="#41-you-avoid-making-phone-calls" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="42-you-often-spend-a-lot-of-time-trying-to-understand-views-that-are-very-different-from-your-own">42. You often spend a lot of time trying to understand views that are very different from your own<a class="hash-link" href="#42-you-often-spend-a-lot-of-time-trying-to-understand-views-that-are-very-different-from-your-own" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="43-in-your-social-circle-you-are-often-the-one-who-contacts-your-friends-and-initiates-activities">43. In your social circle, you are often the one who contacts your friends and initiates activities<a class="hash-link" href="#43-in-your-social-circle-you-are-often-the-one-who-contacts-your-friends-and-initiates-activities" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="44-if-your-plans-are-interrupted-your-top-priority-is-to-get-back-on-track-as-soon-as-possible">44. If your plans are interrupted, your top priority is to get back on track as soon as possible<a class="hash-link" href="#44-if-your-plans-are-interrupted-your-top-priority-is-to-get-back-on-track-as-soon-as-possible" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="45-you-are-still-bothered-by-mistakes-that-you-made-a-long-time-ago">45. You are still bothered by mistakes that you made a long time ago<a class="hash-link" href="#45-you-are-still-bothered-by-mistakes-that-you-made-a-long-time-ago" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="46-you-rarely-contemplate-the-reasons-for-human-existence-or-the-meaning-of-life">46. You rarely contemplate the reasons for human existence or the meaning of life<a class="hash-link" href="#46-you-rarely-contemplate-the-reasons-for-human-existence-or-the-meaning-of-life" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="47-your-emotions-control-you-more-than-you-control-them">47. Your emotions control you more than you control them<a class="hash-link" href="#47-your-emotions-control-you-more-than-you-control-them" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="48-you-take-great-care-not-to-make-people-look-bad-even-when-it-is-completely-their-fault">48. You take great care not to make people look bad, even when it is completely their fault<a class="hash-link" href="#48-you-take-great-care-not-to-make-people-look-bad-even-when-it-is-completely-their-fault" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="49-your-personal-work-style-is-closer-to-spontaneous-bursts-of-energy-than-organized-and-consistent-efforts">49. Your personal work style is closer to spontaneous bursts of energy than organized and consistent efforts<a class="hash-link" href="#49-your-personal-work-style-is-closer-to-spontaneous-bursts-of-energy-than-organized-and-consistent-efforts" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="50-when-someone-thinks-highly-of-you-you-wonder-how-long-it-will-take-them-to-feel-disappointed-in-you">50. When someone thinks highly of you, you wonder how long it will take them to feel disappointed in you<a class="hash-link" href="#50-when-someone-thinks-highly-of-you-you-wonder-how-long-it-will-take-them-to-feel-disappointed-in-you" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="51-you-would-love-a-job-that-requires-you-to-work-alone-most-of-the-time">51. You would love a job that requires you to work alone most of the time<a class="hash-link" href="#51-you-would-love-a-job-that-requires-you-to-work-alone-most-of-the-time" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="52-you-believe-that-pondering-abstract-philosophical-questions-is-a-waste-of-time">52. You believe that pondering abstract philosophical questions is a waste of time<a class="hash-link" href="#52-you-believe-that-pondering-abstract-philosophical-questions-is-a-waste-of-time" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="53-you-feel-more-drawn-to-places-with-busy-bustling-atmospheres-than-quiet-intimate-places">53. You feel more drawn to places with busy, bustling atmospheres than quiet, intimate places<a class="hash-link" href="#53-you-feel-more-drawn-to-places-with-busy-bustling-atmospheres-than-quiet-intimate-places" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="54-you-know-at-first-glance-how-someone-is-feeling">54. You know at first glance how someone is feeling<a class="hash-link" href="#54-you-know-at-first-glance-how-someone-is-feeling" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="55-you-often-feel-overwhelmed">55. You often feel overwhelmed<a class="hash-link" href="#55-you-often-feel-overwhelmed" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="56-you-complete-things-methodically-without-skipping-over-any-steps">56. You complete things methodically without skipping over any steps<a class="hash-link" href="#56-you-complete-things-methodically-without-skipping-over-any-steps" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="57-you-are-very-intrigued-by-things-labeled-as-controversial">57. You are very intrigued by things labeled as controversial<a class="hash-link" href="#57-you-are-very-intrigued-by-things-labeled-as-controversial" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="58-you-would-pass-along-a-good-opportunity-if-you-thought-someone-else-needed-it-more">58. You would pass along a good opportunity if you thought someone else needed it more<a class="hash-link" href="#58-you-would-pass-along-a-good-opportunity-if-you-thought-someone-else-needed-it-more" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="59-you-struggle-with-deadlines">59. You struggle with deadlines<a class="hash-link" href="#59-you-struggle-with-deadlines" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="60-you-feel-confident-that-things-will-work-out-for-you">60. You feel confident that things will work out for you<a class="hash-link" href="#60-you-feel-confident-that-things-will-work-out-for-you" title="标题的直接链接">​</a></h3>]]></content:encoded>
            <category>札记</category>
            <category>人生</category>
            <category>性格</category>
            <category>MBTI</category>
        </item>
        <item>
            <title><![CDATA[札记 | 愿逝者安息生者坚强，你我迎风奔跑向阳而生]]></title>
            <link>https://markshawn2020.github.io/blog/2022/03/27/prose-321-air-crash</link>
            <guid>/2022/03/27/prose-321-air-crash</guid>
            <pubDate>Sun, 27 Mar 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[三月二十一日，于某些人，某些家庭，是一个无法面对的日子。]]></description>
            <content:encoded><![CDATA[<p>三月二十一日，于某些人，某些家庭，是一个无法面对的日子。</p><p>这一天，于我，同样难以承受。</p><p>那天前夜，我困倦地倒趴床上不慎入眠，凌晨三点醒来后才拾掇进入被窝，之后五点、七点又醒，像往日一样洗漱后坐在椅子上吃着面包，稍坐直时突发左背剧疼，不能动弹，紧接着脖子就几乎不能转到。势头十分猛烈，前所未有。</p><p>我料想可能是休息不足，或者欠佳，于是回到床上艰难地躺下，企图希望能有好转。</p><p>然而，命运总是这样的无情：当你发现某些疾病有显著的爆发症状时，往往为时已晚。</p><p>这次临时休息历经半小时后，并无任何好转，而我近乎无法起床了，仿佛左肩胛骨处有一根骨头已被抽走，无法肌肉用力。</p><p>我连忙查询相关原因，左背疼痛大致有两种，肌肉痛与心肌痛。由于我按压左背并无明显的压痛感差异，所以不属于肌肉痛，那就属于后者心肌痛，即由心机梗塞突发导致的连带的左背疼痛。</p><p>了解至此，我不禁胆战心惊，立即准备前往附近的医院，最近的是 3 公里外的一家中医院。</p><p>医生首先想的是确定是否心脏问题，于是开单做心电图检测与心肌酶谱七项血检。</p><p>一小时后拿到报告，心电图似乎显示一切正常。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20220327142103975.png" alt="image-20220327142103975" class="img_vXGZ"></p><p>中午挣扎着吃外卖（半跪着在医院的椅子上吃完的，因为脖子没法动）时拿到了血检报告，似乎也是一切正常……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20220327142206665.png" alt="image-20220327142206665" class="img_vXGZ"></p><p>于是等到下午一点半医生上班后看完报告，认定是软组织挫伤问题，在征求我中西药意见时见我对是否能开中药拿不定主意后开了西药，氟比洛芬凝胶贴膏用于外敷，塞来昔布胶囊用于内服。</p><p>我其实是比较抗拒这个诊断结果的，毕竟从一个医学门外汉的角度看，也许确是软组织的问题，但挫伤，尤其这个“挫”字可能禁不起推敲。</p><p>但总之，既然医生都这么诊了，我也没有什么理由再去辩驳，按医生的建议好好调休一周就是，于是打道回府了。</p><p>回到家后先服了药，打算再躺床上休息会。</p><p>然而真正的噩梦才刚刚开始：下午四五点的时候醒来，发现完全起不来了！</p><p>上半身几乎瘫痪，手一抬起来背就巨疼，一小时内先后数次尝试翻身跪起，结果都以惨叫告终。</p><p>后来打开手机一看，飞机失事了。</p><p>我才真正意识到，原来我们离死亡、瘫痪、意外是如此的近。</p><p>时间一点点消逝，我望着天花板十分绝望，手机电量也开始告急，充电线就在旁边的床前柜上，但因为脖子无法动弹手也无法任意操纵，充电也成了不可能任务。</p><p>那一刻，人生中第一次想喊救护车。</p><p>但为了避免引起小区骚动，我还是打消了这个念头。</p><p>大概两小时后，天色渐渐暗了下来，我尝试着通过胸肌腹肌和大腿直直地坐起来，就仿佛模拟我当时如何躺下去的那样。</p><p>幸运的是，大概一分钟后，我成功了！我坐起来了！这样我就可以给手机充电、点外卖、取快递，我至少可以像个机器人一样慢慢地移动了！</p><p>我们还是要抱着对生的希望的吧，不是吗？比起东航的他们，我已经好太多，我至少还有选择。</p><p>而有些人，别无选择。</p><p>晚上，我听从了好朋友的现身建议，去做了一场按摩，就在楼下的中医按摩店，按摩小哥第一反应就是我受凉了，中途也很仔细地给我按摩左背，全部按完后还让我试试脖子能不能转，并针对性地固定住我胳膊然后砖头又鼓捣了几下，我说实话，还是有效果的，明显比做按摩前舒服多了，起床几乎无压力，就是脖子不能往右转超过 15 度。</p><p>三天过去后，身体又好了些！觉得确实是积劳成疾+受凉导致的，因此从那天开始计划积极锻炼！</p><p>可以看到，确实跑的很慢，尽管去年骑行过西藏，减重 20 斤，然而半年过去，现在的身体实际素质还是进一步堪忧了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20220327151039794.png" alt="image-20220327151039794" class="img_vXGZ"></p><p>六天过去后，脖子已经基本能正常转动，直到最大角度时才会感觉到左背肌肉拉扯疼痛，而左背正常情况下也只是隐隐作痛而已了。</p><p>随着东航事件最终的收官定论，我觉得也是时候到了一个可以总结的时间点，我们要真地开始认真对待自己的身体、生活与工作了。</p><p>毕竟，你真地不知道明天与意外谁先到。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/13.44.46.png" alt="Screen Shot 2022-03-18 at 13.44.46" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/13.44.50.png" alt="Screen Shot 2022-03-18 at 13.44.50" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/AlwaysLikeThis.jpeg" alt="AlwaysLikeThis" class="img_vXGZ"></p><p>愿逝者安息，愿生者坚强。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20220327151705196.png" alt="image-20220327151705196" class="img_vXGZ"></p><p>愿你我始终能迎风奔跑，向阳而生。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.13.png" alt="Screen Shot 2022-03-17 at 16.52.13" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.17.png" alt="Screen Shot 2022-03-17 at 16.52.17" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.19.png" alt="Screen Shot 2022-03-17 at 16.52.19" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.22.png" alt="Screen Shot 2022-03-17 at 16.52.22" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.25.png" alt="Screen Shot 2022-03-17 at 16.52.25" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.29.png" alt="Screen Shot 2022-03-17 at 16.52.29" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.31.png" alt="Screen Shot 2022-03-17 at 16.52.31" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.33.png" alt="Screen Shot 2022-03-17 at 16.52.33" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.36.png" alt="Screen Shot 2022-03-17 at 16.52.36" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/16.52.39.png" alt="Screen Shot 2022-03-17 at 16.52.39" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/14.21.19.png" alt="Screen Shot 2022-03-18 at 14.21.19" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_our-lives-1648367989625-73b343bb9fcc4dfa3af82f109848af3d16e37733e4c73427d232a34fc899f550.png" alt="picture 57" class="img_vXGZ"></p>]]></content:encoded>
            <category>札记</category>
            <category>养身</category>
        </item>
        <item>
            <title><![CDATA[编程 | 北京租房系统设计、研究与经验 0.1.0]]></title>
            <link>https://markshawn2020.github.io/blog/2022/03/09/dev-douban-renting</link>
            <guid>/2022/03/09/dev-douban-renting</guid>
            <pubDate>Wed, 09 Mar 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[通过一天使用程序化手段获取两万多套房源转租信息，继而再通过程序化粗筛成两百多套，紧接着人工细筛出十几套，最后两天内实地考察九套。]]></description>
            <content:encoded><![CDATA[<blockquote><p>通过一天使用程序化手段获取两万多套房源转租信息，继而再通过程序化粗筛成两百多套，紧接着人工细筛出十几套，最后两天内实地考察九套。</p><p>在北京快速的、低成本的找房，我是如何做到的，我又有什么经验心得与启示，这是本文所要阐述的。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="个人背景概要">个人背景概要<a class="hash-link" href="#个人背景概要" title="标题的直接链接">​</a></h2><p>大学实习基本都是在上海，租过远到嘉定每天来回四小时的自如、租过虹口差点要不回钱的蛋壳，租过和别人同睡一张床第二天赶紧溜走连押金都不想要的复旦老破小，租过闵大荒开始闹到威胁后续被窗外幼儿园治愈的公寓式开间，也为把项目做好租过浦东近万的酒店。</p><p>所以租房，尤其是在一线租房，确实是个头疼的问题。</p><p>现在，作为一名北漂狗，是时候认真研究一下了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="租房方案设计">租房方案设计<a class="hash-link" href="#租房方案设计" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="个人需求分析">个人需求分析<a class="hash-link" href="#个人需求分析" title="标题的直接链接">​</a></h3><p>在每个人讨论租房这个问题之前，第一个就是个人需求的剖析。</p><p>就我接触下来，99%的人对价格还是相对敏感的，在此基础之上， 有些人更重视通勤时间（比如我），有些人更重视独卫的便利性（比如某互联网男生），有些人更重视卫生条件（某金融业女生）。</p><p>而预算方面也会因为因人而异，有预算 2000 的，3000 的，4000 的，甚至 6000 的，等等。</p><p>因此从需求、预算角度，每个人所适合的策略就不太一样。</p><p><strong>本文主要介绍的是汇总租房帖然后逐步筛选的方案，理论上适合一切找房群体，同时更适合希望较低成本找房的朋友</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="公寓-vs-民宅">公寓 vs 民宅<a class="hash-link" href="#公寓-vs-民宅" title="标题的直接链接">​</a></h3><p>我过往的经历，应该来说，住公寓与酒店比较多，现在的年轻人应该大多都是这样。</p><p>公寓也并非不好，尤其是身边同学或者朋友一起住青年公寓那种，就特有氛围。</p><p>但如果是长租，以下问题就不能忽视：</p><ol><li>首先是价格方面，同面积情况下，公寓普遍租金更高，另外商水商电大概是民水民电费用的三倍左右，比如夏天可能开着空调，民水民电的民宅花 150，但公寓就可能是 450，当然这个估算可能不准确，也因人而异</li><li>公寓由于自建等原因，隔音效果普遍不是很好，如果喜欢安静的一定要注意这一点</li><li>公寓往往缺少家的感觉</li></ol><p>如果你能容忍或者确认以上几点，那就很适合选住公寓，因为公寓的配套设施一般更完善，比如自习室、健身房、大厅，甚至食堂等等。</p><p>总之，考虑到我的个人经历与接下来的规划，我就没有考虑公寓了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上-vs-线下">线上 vs 线下<a class="hash-link" href="#线上-vs-线下" title="标题的直接链接">​</a></h3><p>租房大致分纯线上、线上转线下与纯线下三种方式。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="纯线下方案">纯线下方案<a class="hash-link" href="#纯线下方案" title="标题的直接链接">​</a></h4><p>首先讲一下纯线下，如果你是经济非常紧张、对居住环境不是很重视，同时社交能力较强（或长的比较友好），希望以最低成本租房的，根据一些文章指出，你可以线下走街串巷，多和低收入人群（保安、清洁工等等）聊一聊，他们通常能给你非常具有性价比的推荐。</p><p>我虽然没有通过这种方式找房，但我确实曾经在拉萨坐人力拉车时和车夫聊过，他就住在大昭寺附近，一个月印象中好像是 300（也有可能是 600）的房子，总之，是很低了，即使我们住青旅，也要三四十一天，一个月下来也是近千的。</p><p>其实吧，我觉得纯线下的最主要条件，还是你要能来事，理论上不单单是光和低收入人群聊，你有能耐的话，也可以和包租婆聊，说不定更能找到非常具有吸引力的房源，对不~</p><p>但对于北漂狗来说，纯线下方案并不是那么容易操作。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="纯线上方案">纯线上方案<a class="hash-link" href="#纯线上方案" title="标题的直接链接">​</a></h4><p>接着是纯线上方案，这个方案，应该是很多学生党比较喜欢的方式，照片视频一看，或者根据平台品牌，一下就入了。</p><p>我便是这么走过来的。我甚至是线上看好后，直接拖着箱子再去看房的，这绝对是大忌！</p><p>当然这也不是不行，比如嫌麻烦与不缺钱，就可以无脑 all in 自如（公寓相关的分析接下来章节会说），至少能保证下限。</p><p>但如果你想选民宅的话，纯线上的最大挑战，是要有足够的鉴别能力。比如某中介在朋友圈发了某套房的房源信息，一般是位置加文字加图片，你需要第一时间能够识别出信息的真实度如何，另外，同步查询这个小区的相关信息：小区建成于什么年代、附近的设施情况如何等等。</p><p>而在你未曾亲自线下跑楼之前，你其实对这些都没什么太大概念，比如什么是筒子楼、什么叫隔断、什么是团结户等等。</p><p>不过一旦你对这些概念逐步熟悉之后，看房，尤其是看中介与平台的线上房源，心中就会相对有数了，也就是说，至少不太容易出现预期差太多的情况了。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="线上转线下方案">线上转线下方案<a class="hash-link" href="#线上转线下方案" title="标题的直接链接">​</a></h4><p>相对来说，先在线上看够足够多的房源，再精挑几个去线下调研，应该是最好的。</p><p>这里，有两点，第一点就是尽量以正常通勤工具去看房，你不能因为远或者啥的去打车看房，毕竟你是来租房通勤用的，你必须还原你的真实使用场景去体会这是不是你想要的，所以从我的感受来看，离地铁超过 1 公里的房我就不会要了，走路实在需要太久。</p><p>第二点，就是怎么说呢，并不需要刻意排斥中介。</p><p>是，中介这个职业，总让人爱恨交加，尤其是碰到就为了多坑点你钱的，我也碰到过，并且不少。但别人也确实给你提供了一定帮助，或者说，insight。</p><p>你得明白整个租房市场是怎么回事，在一线城市，绝大多数租房都是相对饱和的，好的、性价比高的房子确实很抢手，比如在国贸上班的金融白领们租房一般就是围绕这一块，相应的就会有中介专门负责这几块小区的生意，一旦有一个房间空出来就会立马挂出来，然后数个中介就能找到数个客户对该房源感兴趣。</p><p>如果你排斥中介，拒绝接受中介，你怎么能获得这些房源信息？并不是所有人都会在豆瓣、咸鱼发帖转租什么的，所以中介仍旧是找房的一个重要途径，关键是看你怎么用。</p><p>我的看法是，不要只 follow 一个中介，你可以多加几个中介，综合他们的 insight，最终逐渐形成你的租房目标。但所谓的多加，也不是随便加，一定是你目标区域内的中介才是有效的，因此如何加到你目标区域内尽可能多的中介，依旧需要我们后续所用到的技术。</p><p>再总结一下，不需要排斥中介，但也不要随意加中介，如果碰到目标区域内的中介，不妨加了多和他们聊聊，可以更快地帮你熟悉目标区域。最重要的是，不要拖着箱子，然后坦诚地、大方地线下去走走，实地看看。说不定想去看的某套是不符合期望的，但其他套却很吸引你，这也是可能的。</p><p>当然，中介有风险，后面也会讲一些中介的平常套路。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上平台选择">线上平台选择<a class="hash-link" href="#线上平台选择" title="标题的直接链接">​</a></h3><p>现在其实有很多租房的平台，比如微信、豆瓣小组、咸鱼、小红书、贝壳找房、链家、58、安居客、自如、泊寓等等。</p><p>其中，个人房源主要集中在微信、豆瓣小组、咸鱼、58 等平台上，贝壳找房我试了试房源基本对接的自如的。这其中，58 和安居客据说假房源特别多，所以也未在我选择之列。咸鱼和小红书是我后来才知道的，但不在本次找房所使用工具之类。</p><p>本次找房主要使用的是微信和豆瓣小组，其实主要是豆瓣小组，微信的租房群也是通过豆瓣才找到的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总体设计">总体设计<a class="hash-link" href="#总体设计" title="标题的直接链接">​</a></h3><div class="language-mermaid codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-mermaid codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">flowchart TB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subgraph day1[Day 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">direction TB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subgraph platforms[租房平台]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        douban[豆瓣小组-北京租房]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --&gt; wechat[微信群聊-北京租房]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    douban</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 爬虫 --&gt; input[2w+近期租房条目数据]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wechat -- 表格 --&gt; input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input -- 清洗 --&gt; washed[100+符合基本条件的租房条目数据]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 一一标记确认 --&gt; marked[10+候选租房目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subgraph day2[Day 2-3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    marked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 微信逐个联系 --&gt; connected[&lt;10个线下考察目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 线下考察 --&gt; favorite[1-3个最终候选]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 抉择 --&gt; final[1个最终目标]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="租房前期准备">租房前期准备<a class="hash-link" href="#租房前期准备" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解行政区域规划">了解行政区域规划<a class="hash-link" href="#了解行政区域规划" title="标题的直接链接">​</a></h3><p>访问 <a href="https://www.zhihu.com/question/26731387" target="_blank" rel="noopener noreferrer">有没有一种电子地图，可显示详细的行政区域边界 ？ - 知乎</a> 可以很方便地查看行政区域规划地图，例如北京的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646042680293-b001d7afd4943a6e57041a22a615e5db3bba163a70866a5c2b8e22154ce68c91.png" alt="picture 1" class="img_vXGZ"></p><p>我也是第一次看行政区域地图，一一审查他们的区号发现还挺有规律，核心第一圈东西城区 01 和 02，接着第二圈从朝阳开始顺时针——朝阳（05）、丰台（06）、石景山（07）、海淀（08），接着第三圈从房山开始逆时针——房山（11）、通州（12）、顺义（13）、昌平（14），最后第四圈有点杂乱但整体依旧是逆时针：大兴（15）、怀柔（16）、平谷（17）、密云（18）、延庆（19）。</p><p>了解行政区划的目的，主要是分清自己大概会租什么位置的房子，因为现在大多数租房软件都会提供基于行政区划与地铁等多种筛选方式，也许地铁比行政区域更重要一些，但提前了解一下行政区域也会有一个比较重要的区位概念。</p><p>至少，我了解下来，断定，我大概会在朝阳与丰台这两个区之间做选择，这是比较重要的信息。也就是说，后续看到转租帖，不是这两个区的基本都可以 pass 了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解地铁线路规划">了解地铁线路规划<a class="hash-link" href="#了解地铁线路规划" title="标题的直接链接">​</a></h3><p>从我的角度，行政区域对自己的实际参考意义并不大，作为北漂狗，最重要的依据还是地铁，谁能把握住地铁的脉络，谁就能把握住性价比的尾巴。</p><p>所以首先找一张地铁线路图，这个随便一搜就能找到，比如这是百度地图里的北京地铁图：<a href="https://map.baidu.com/@12964228,4821466,13z" target="_blank" rel="noopener noreferrer">北京市地铁图 - 百度地图</a></p><p>由于公司在四惠南边，所以我从四惠站出发，沿各个方向延伸七站左右，其中遇到换乘加算一站。（七站大概是半小时）</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646439758370-c9709e7459acccd134efbdcd75ae097f557ce607223c072ea906e13f7d56c31c.png" alt="picture 1" class="img_vXGZ"></p><p>如此来看，其实我的可选范围还是挺多的，整个北京东南方向的一大块都包括了。</p><p>但为了控制成本，我特意标记了地铁外环的几个拐角，直觉上这里价格会略低些：</p><ol><li>百子湾，位于 7 号线拐角，同时也是离公司最近的侯选处，可以步行上班</li><li>北工大西门，位于 14 号线拐角，这里的最大优势是可以直达望京</li><li>分钟寺与成寿寺，位于 10 号线上，这两个地方是某北漂朋友推荐的地儿，确实便宜</li><li>青年路，6 号线，正好在环外，旁边就是朝阳公园</li><li>通州北苑，低处通州区，价格更低，旁边还有万达广场</li></ol><p>这几个锚定的区域都需要重点观察。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="了解周遭小区分布">了解周遭小区分布<a class="hash-link" href="#了解周遭小区分布" title="标题的直接链接">​</a></h3><p>我们可以在 <a href="https://map.lianjia.com/map/110000/ESF" target="_blank" rel="noopener noreferrer">北京地图找房<em>北京小区地图</em>北京房产地图(北京链家)</a> 简单看到大部分小区的分布情况，例如定位到我司附近的百子湾小区：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646616950694-d0638ca5546f123f967191de4f05b4dc2150e859c4a739c13f751e8bc4c05ec5.png" alt="picture 2" class="img_vXGZ"></p><p>再点击一次可以看到具体到每个小区的情况，下面部分有一大块的空白看样子是商区（不确定）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646616997536-91182e25417bd9bb8aedf65b1a78970868219ee4c5d7b84c93ed4469bbbaabb6.png" alt="picture 3" class="img_vXGZ"></p><p>由于我司位于源创空间大厦，离周围的地铁都比较远，步行距离接近 2 公里（通勤时间可以以步行的 10 分钟/公里计算），因此光是从最近的地铁站步行到公司都要花 20 分钟，所以在租房时要考虑这个问题。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646620679319-1651e3b2677652a26cd35557358018cb66cf2487a19d110410f4f89fb0ba5b3c.png" alt="picture 5" class="img_vXGZ"></p><p>具体地说，如果我的通勤时间要控制在半小时以内，那么大概率远距离的长地铁方案就要 GG 了。（长地铁方案：选择离公司较远、离地铁较近、具有较高性价比租房的方案）比如以我司以及周围的三/四个地铁站为中心，附近有数个小区（高德地图，链家看起来太费劲了，且不全）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646623707128-38cbad4291bfbf319eb81efa360e5cfb2d716cb4d1fd4bd8187a44dab56d3a12.png" alt="picture 6" class="img_vXGZ"></p><p>这些小区中，最优先考虑的应该是在四惠东、四惠、大郊亭、百子湾（逆时针）这几个地铁站之间的小区：金海国际、金都杭城、沿海赛洛城和百子湾家园。其中金海国际可能地铁位置最优（仅次于九龙山附近的珠江帝景）但最贵（二手房价格 6w+），沿海赛洛城性价比最高（离地铁次近，二手房价格 4w+），金都杭城与百子湾家园离地铁更远。</p><p>其次就是四惠河北部的惠民园、东恒时代、十里堡等。</p><p>最后是其他地区，例如大郊亭左边的后现代城、百子湾下面的光华新城、百子湾右边的燕宝保湾家园、四惠东右下角的西店村等。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="小区的选择依据">小区的选择依据<a class="hash-link" href="#小区的选择依据" title="标题的直接链接">​</a></h3><p>个人认为，无论预算是否充沛，最终是否直接选择离公司最近的小区，适当地过一遍周遭小区还是比较重要的，因为你选择这里的概率会比较大。</p><p>但并非必须选项，因为我们往往会考虑地铁沿线更远的区域，尤其是在我们把通勤时间放宽到一小时、公司本身离地铁也很近、最后一公里选择骑车而非步行等前提下。</p><p>但这样，我们就需要看<a href="#%E4%BA%86%E8%A7%A3%E5%9C%B0%E9%93%81%E7%BA%BF%E8%B7%AF%E8%A7%84%E5%88%92">了解地铁线路规划</a>中所圈点的更多地铁站旁边的更多小区，工作量指数级上升。</p><p>因此，关于其他小区的通勤距离这部分，我倾向于通过程序计算，找到后再单独看~</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房条目的数据获取">豆瓣小组租房条目的数据获取<a class="hash-link" href="#豆瓣小组租房条目的数据获取" title="标题的直接链接">​</a></h2><p>基于我们在<a href="#%E5%B9%B3%E5%8F%B0%E9%80%89%E6%8B%A9">平台选择</a>中的分析，豆瓣小组是本文的重点考察对象（后续可能会考虑再加入闲鱼，据说个人房源信息也不错）。</p><p>另外，至少有两种获取豆瓣小组租房信息的方式，一种是基于网络流传的 API，一种是基于我们自己的爬虫。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房信息获取的目标设计">豆瓣小组租房信息获取的目标设计<a class="hash-link" href="#豆瓣小组租房信息获取的目标设计" title="标题的直接链接">​</a></h3><ol><li>支持搜索小组名以获得所有相关的小组<ol><li>例如：“北京租房”</li><li>豆瓣支持小组名字相同，所以其实会有很多个同名小组</li><li>为了信息的完整性，我们最好捕捉所有符合要求的小组，然后一一进行处理</li></ol></li><li>支持基于小组名（实际是 id）获得该小组下的所有话题</li><li>基于话题的标题，进行地名提取与位置确认，进行转租筛选</li><li>支持基于话题再获得话题下的图片与文字<ol><li>如果有了图片，是很方便可以做一些可视化网站的，势必会比较方便</li><li>另外也可以做筛选，你说对方要把房子租出去，结果图都不晒一张，这合适吗，这不合适，这能要吗，这肯定不能要</li><li>尽管势必会有大量照骗党，杀猪磨盘，但是也不能因为这个而畏惧呢</li></ol></li><li>其他</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组-api-方案之分析与准备">豆瓣小组 API 方案之分析与准备<a class="hash-link" href="#豆瓣小组-api-方案之分析与准备" title="标题的直接链接">​</a></h3><p>之前就听说国内电影体系都是靠豆瓣的 api，因此首先就是先谷歌一下“豆瓣 api”，结果发现果然有 <a href="https://www.doubanapi.com/" target="_blank" rel="noopener noreferrer">豆瓣 Api V2（测试版） | doubanapi</a>，注意这两个 api_key，我一开始表示怀疑，后来发现竟然真能用……</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">0df993c66c0c636e29ecbb5344252a4a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0b2bdeda43b5688921839c8ecb20399b</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069015501-f3babe3e1f58f4114ac50bf658a3da52d79e200b28b72ced5c3076d1fe45edd5.png" alt="picture 6" class="img_vXGZ"></p><p>但这个网页其实没有提供豆瓣小组的 api，于是我们继续搜索豆瓣小组是否有 api 的信息 <a href="https://www.zhihu.com/question/19889922" target="_blank" rel="noopener noreferrer">豆瓣小组是否提供 API？ - 知乎</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069095482-cd7bde3bddd77cf5f4c62e6e81840d8fb51af0ffafb4d482264517946f766c0d.png" alt="picture 8" class="img_vXGZ"></p><p>有几个有趣的回答，第一个给出了 api 地址与形式，并且附送了一个链接：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069147214-a4f1aa82861ed7aaecfc5ab9288b7fecb49b93b375fc6f684769dd5983c4b856.png" alt="picture 9" class="img_vXGZ"></p><p>不过这个所谓的”出处“链接到很有意思，是 2012 年的，最关键的是，打开后一闪而过，倒也没那么快，大概一秒钟之后跳转到了新的页面，看最后一个网址就知道，是被重定位了。</p><p>刚刚是手快，截了一下，但是光截图看不到后面的内容，而想中途拉动又不可能。</p><p>这个时候，抓包神器的作用就体现了，所有网页加载都有记录，直接把 html 文件导出，再在本地打开，就发现全出来了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069414627-ac205b0b2a3e63c2d70881af9db7713beaf7a6acbc183a13ff3bfc6e73b575d3.png" alt="picture 13" class="img_vXGZ"></p><p>最有意思的是，这个帖子似乎是有两个“小黑客”在尝试破译豆瓣的接口，好吧，也就是我正在做的事了。</p><p>读下来饶有味道：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069515981-f924e7f446421c41878794949b567c207dab0d410a2e8f57dc20317bc26ca0e0.png" alt="picture 14" class="img_vXGZ"></p><p>不过他们所描述的获取 access_token 的形式，我也不清楚豆瓣是怎么想的，可能他们同时有两套接口吧，一套 oauth2，一套 api_key。总之，我们目前应该是不需要 access_token 的，直接用 api_key 就可以，并且是固定的。</p><p>比如按照上面的截图，获取豆瓣小组里话题列表的 api 是<code>https://api.douban.com/v2/group/${GROUP_NAME}/topics</code>，例如：<code>https://api.douban.com/v2/group/husttgeek/topics</code>，这个时候如果我们在浏览器中直接打开这个网址，会遇到缺少 api_key 的警告：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069782706-7895041f12fbe4b18f9ee659be5f9a4fe6ae923807f0c070d73c32550a3abf33.png" alt="picture 15" class="img_vXGZ"></p><p>这不，我们一开始搜的豆瓣 api 就有用了吗，把那个 api，比如<code>0df993c66c0c636e29ecbb5344252a4a</code>复制过来，拼接到网址上去，重新访问，结果就有了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646069859534-e798528b3ca706fde7d6b4c1e0736d259c35d77969cd40a7810b6bdee936a845.png" alt="picture 16" class="img_vXGZ"></p><p>得来全不费工夫！</p><p>至此，其实我们的思路已经大致确定了，不过那个知乎帖子下面还有两个 git 项目，其中一个是监控小组的，倒是确有一点意义，可供闲暇参考，分别罗列如下：</p><ul><li><a href="https://github.com/yaodi833/rental_house_douban" target="_blank" rel="noopener noreferrer">yaodi833/rental_house_douban: 本项目基于（非公开）豆瓣 api，实时监控多个豆瓣租房小组发布租房信息，并支持小组订制，关键词订制，邮件推送等功能</a></li><li><a href="https://gist.github.com/iamsk/1bc0760dfeeeb950f18e" target="_blank" rel="noopener noreferrer">doubangroupapi</a></li></ul><p>基于以上分析，可见，豆瓣的 api 还是比较稳定可用的，否则该失效早失效了。</p><p>不过有些东西还差一点。其中，我们目前只知道第二点（罗列话题）与第四点（获取话题内容）应该是有了现成的 api，而第一点（搜索小组）则没有，需要我们自己破解。另外第三点是我们后续的算法部分，与豆瓣 api 无关，故暂且可以先不谈。</p><blockquote><p>豆瓣小组 API 方案之如何获取搜索小组的 API</p></blockquote><p>按照直觉，我们可以通过对比正常访问的网页地址与已经明确了的 api 之间的关系，得到 $f(x) = y$，然后再把这个 $f$ 作用到正常搜索网页的网址上去。</p><p>我们先试试。</p><p>但是很快我发现搜索接口是比较独立的，是一个集中式的接口，和那些分别对应的不太一样。</p><p>紧接着我又意识到，其实这么多小组，取前几个就已经比较够了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646074421380-f0780837200fe37fca1e9afb372a7bca1320e805c7dd6730ccd6eed4add691a0.png" alt="picture 17" class="img_vXGZ"></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">function getGroups() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    curl https://www.douban.com/search\?q\=$1 2&gt; /dev/null \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | grep -E "小组.*&lt;a href" \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | gsed -E "s/.*group%2F(.*?)%2F.*/\1/"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样我们就得到了豆瓣小组的前几个小组的 id，例如：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646074500899-e2a15145ced09f9749a69989d26e2156bf8958d2d5f78adbdd550f752fd5cc08.png" alt="picture 18" class="img_vXGZ"></p><p>这样，我们的第一步就也痛了，于是乎，第一步获取小组 id 列表，第二步获取小组内的主题，第四步获取小组主题内容，这几步都没有技术上的问题了，接下来就是写程序，以及加上第三步算法部分。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组-api-方案之设计与实现">豆瓣小组 API 方案之设计与实现<a class="hash-link" href="#豆瓣小组-api-方案之设计与实现" title="标题的直接链接">​</a></h3><p>可以直接访问 <code>https://api.douban.com/v2/group/beijingzufang/topics?apikey=0df993c66c0c636e29ecbb5344252a4a</code> 获取 demo 结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646644258095-3634cb35cb1b70e95cb77450a2e48ea9636d06dbcf5789fdb02cdbe5c19567fc.png" alt="picture 2" class="img_vXGZ"></p><p>基于这个返回结果，可设计数据结构如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Author</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_suicide</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    avatar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># UserType</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    large_avatar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Dimension</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Photo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dimension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topic_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seq_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_private</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    locked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    liked</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    like_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    comment_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    share_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    screenshot_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    photos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Photo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopicResultSuccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    请求成功时的结构体</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 0 - 100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># default: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    topics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DoubanApiTopicResultFailure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    当请求失败时，就会返回这个结构体</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># "access_error"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 403</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    localized_message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有了 apikey 可以直接调用 api，获取 json 结果，然后解析，因此本过程省略，以下主要记录一下核心续爬代码：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_get_topics_of_group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> limit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"code"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">403</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finished_reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"此请求已触及该apikey&lt;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">_apikey</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&gt;限制"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> item </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"topics"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> DoubanApiTopic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> limit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"start"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"count"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"total"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finished_reason </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"不容易，所有数据已全部提取完毕"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"finished, reason: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> finished_reason</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组爬虫方案之设计与实现">豆瓣小组爬虫方案之设计与实现<a class="hash-link" href="#豆瓣小组爬虫方案之设计与实现" title="标题的直接链接">​</a></h3><p>豆瓣的前端页面并不复杂，就是一个传统的 table 结构，按序解析即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646637351707-b2675d6892f4102387b6588f435516597ca8711072a5e22543218683452c6c05.png" alt="picture 1" class="img_vXGZ"></p><p>豆瓣小组的特定小组内条目的字段主要有：<code>讨论 | 作者 | 回应 | 最后回应</code>四个基本字段，相应的在程序设计中我编码成了六个字段：<code>post_title | post_url | author_name | author_url | response_count | response_latest_time</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646635247259-62e1f827aaf997bd418f03538e9fe955b1fd5f371ab15ccbe1e47eeb05999b8e.png" alt="picture 7" class="img_vXGZ"></p><p>有一个问题，是关于多个小组的，由于豆瓣小组针对某一话题会有多个不同的小组，甚至名字相同（但 id 唯一），这就导致需要我们对每个小组分别进行数据提取。有一种办法可以避免这样，那就是集中采集 <a href="https://www.douban.com/group/" target="_blank" rel="noopener noreferrer">我的小组讨论</a>页面。</p><p>比如，我所有的小组都是关于租房的，一共有三个小组：<code>北京租房 | 北京无中介租房 | 北京租房房东联盟（中介勿扰）</code>，因此这个页面就是这些小组里所有最新的帖子情况。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646635533016-b6ae0771f901dd12faed61e6d68875d1deb95c60645d5ccc84f7dda033394837.png" alt="picture 8" class="img_vXGZ"></p><p>但这种办法的缺点有二，一个是你要主动过滤非租房相关的小组，另一个就是不支持提供发帖者相关的信息，这在筛选上，缺失了一个比较有用的维度（不过其实我并没有使用这个维度）。</p><p>于是，基于特定小组的话题列表的字段设计如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Topic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_latest_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TopicColumns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"response_latest_time"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"post_title"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"post_url"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"author_name"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"author_url"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"response_count"</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接使用 python 的爬虫基操（<code>requests + beautifulsoup4</code>）即可，核心解析代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">rows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> soup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"#content .article tr"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> row </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(1) a"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"title"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(1) a"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"href"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(2) a"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"href"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    author_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(2) a"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(3)"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">select_one</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"td:nth-of-type(4)"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"20"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> datetime_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># test if it's year of 20XX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        datetime_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">now</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">year</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">-</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_str</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response_latest_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strptime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">datetime_str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%Y-%m-%d %H:%M"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">yield</span><span class="token plain"> Topic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">post_title</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> post_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">post_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author_url</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">author_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                author_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">author_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response_count</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">response_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response_latest_time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">response_latest_time</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="豆瓣小组租房条目的数据分析">豆瓣小组租房条目的数据分析<a class="hash-link" href="#豆瓣小组租房条目的数据分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="筛选条件分析">筛选条件分析<a class="hash-link" href="#筛选条件分析" title="标题的直接链接">​</a></h3><p>在获取到豆瓣租房的目标条目之后，第一步要做的就是程序化筛选。</p><p>目前使用的可供筛选的组合条件如下：</p><ul><li>（推荐）发布日期在近十日之内（好房子一般都会较快被租出，因此过长还未租出的房子不值得一看，N 目前可设置为 7 或者 10，是一个比较合理的值）</li><li>（推荐）如果是男生求租，标题中带“女生”、“限女”等字样的一般不予考虑，并且此类房间不在少数</li><li>（参考）基于一些简单规则提取标题中的价格信息，例如“3000”或者“3 千”等，如果匹配上，便使用预设的价格区间进行筛选</li><li>（参考）对评论数进行筛选，评论数一定程度上代表着房源的质量，或发帖者的积极性（有些发帖者会自己给自己顶帖，说明不是中介），因此筛选评论数大于 0 是非常有意义的，但需要谨慎，因为有很多帖子评论数为 0 但房源确实是有效的</li><li>（参考）继续下爬发帖者的个人信息，鉴定其豆瓣的活跃度，以筛选出非中介的发帖者，但这个就涉及到二级页面的爬取，是一个比较大的开销，需要平衡是否有必要</li><li>（参考）由于帖子的标题比较个性化，小区名、地铁线路信息、行政区域信息等的曝光度均不同，因此基于正向筛选有可能会误杀一些帖子（例如以标题中存在朝阳二字筛选帖子，就有可能把只写了朝阳内部小区名字的帖子给误过滤掉），与此相比反向筛选比较有效（例如如果标题中出现了大兴二字，一般就肯定不是朝阳区域的房源）</li><li>（推荐）本项目最有意思的一点是做了智能测距筛选，具体做法就是将豆瓣标题信息喂给高德的区位编码 api 得到经纬度，再结合目标公司经纬度使用高德的线路规划 api 算出通勤时间，然后再进行筛选，该解决方案应该是目前网络上独一份，实际使用下来，也许有误杀，但很有效。</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-之申请-key-配置">高德 API 之申请 Key 配置<a class="hash-link" href="#高德-api-之申请-key-配置" title="标题的直接链接">​</a></h3><p>访问 <code>https://console.amap.com/dev/user/permission/authenticate/person</code> 基于支付宝实名认证申请 key：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230621370-8e2266b9ff7e8ae36a3ea31057a1e1ced330b6dec2dd177fc03103ef979b4c41.png" alt="picture 1" class="img_vXGZ"></p><p>很快，认证成功：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230728166-e6eac393225fbb258d38f3bd15ec765cdc5c21d207d055e3e4b4be8af345347e.png" alt="picture 2" class="img_vXGZ"></p><p>创建一个 key:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646236116312-8c6441396a6cf4bbbb00be0cb9a0bc1b1a6404dd3bea04ea196ccef0ded3888f.png" alt="picture 4" class="img_vXGZ"></p><p>获得 key：<code>33e2719dbfXXXXXXXX1b2e6786052</code></p><p>最后再看一下服务配额：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_douban-group-api-1646230812661-489a0477c092e063fb341624a4dcdd16a23746e3b9d336e1bc81564ae095e8db.png" alt="picture 3" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-调用之地理编码与逆地理编码">高德 API 调用之地理编码与逆地理编码<a class="hash-link" href="#高德-api-调用之地理编码与逆地理编码" title="标题的直接链接">​</a></h3><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/georegeo#geo" target="_blank" rel="noopener noreferrer">地理/逆地理编码-API 文档-开发指南-Web 服务 API | 高德地图 API</a> 可以知道，高德地理编码就是将地址文本转成经纬度。而后续的比如说查询两个点之间的通勤距离都是基于经纬度的，因此地理编码 api 非常重要。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646663384858-3009c4fcd2cc161deb9d658141155664cf851d0516e307136276acf599deb7b0.png" alt="picture 3" class="img_vXGZ"></p><p>重点参数是 <code>address</code>，即输入的地址。尽管 api 介绍说是一个结构化地址信息，但实际经过我的测试，一个非结构化的但包含地址的句子也是可以的，高德比较智能，会提取出它认为最有可能的地址，这个非常有用！因为允许我们将豆瓣帖子标题直接喂进地理编码而不需要预先提取出地理信息，这让我原先设想的基于 jieba 分词并多次调用高德 api 进行测试的复杂、低效、高耗方案变得不再需要！</p><p>第二个重要参数是<code>city</code>，我们只需要指定为<code>北京</code>，这样便免去了全国搜索，速度更快准确度更高。</p><p>第三个重要参数是<code>batch</code>，这个允许我们在一次 api 调用里同时返回多个关键字的搜索结果，这或许可以大幅降低我们的 api 开销，因为高德 api 有额度限制（但我不确定最终计算时，是以单词算，还是 N 次算，我暂时没用）</p><hr><p>同样，参考 <a href="https://lbs.amap.com/api/webservice/guide/api/georegeo#regeo" target="_blank" rel="noopener noreferrer">地理/逆地理编码-API 文档-开发指南-Web 服务 API | 高德地图 API</a> 我们可以知道逆地理编码就是从经纬度得到结构化地址。</p><p>但值得注意的是，地理编码与逆地理编码之间的输入输出并不完全互逆，因为输入的地理信息也许是非标准化的地址，但输出的逆地理编码信息一定是高德内部标准化的。</p><p>这个 api，可以用，也可以不用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-调用之公线路规划与步行规划">高德 API 调用之公线路规划与步行规划<a class="hash-link" href="#高德-api-调用之公线路规划与步行规划" title="标题的直接链接">​</a></h3><p>在同城通勤线路规划中，我们主要用公交地铁线路规划（长距离），或者步行规划（短距离）。</p><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/direction#bus" target="_blank" rel="noopener noreferrer">路径规划-API 文档-开发指南-Web 服务 API|高德地图 API</a> 可以知道公交路径规划的实际含义是<code>transit/integrated</code>，也就是综合了各类公共（火车、公交、地铁）交通方式的通勤方案。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646664403794-18935acd99bfc9137a34d5e208c8f25f12d681b528371e7a58e4b01164ca63f0.png" alt="picture 4" class="img_vXGZ"></p><p>因此，这个 api 就是我们在手机高德地图里最常用的导航方案之一，基于公交、地铁、步行的灵活规划。其中<code>origin</code>和<code>destination</code>是出发地和目的地的经纬度，这个可以通过我们之前说的地理编码 api 获得，city 依旧和之前的 city 保持一致即可（比如：北京）。值得注意的是<code>strategy</code>参数，我个人倾向于使用<code>3：最少步行模式</code>，也许也会有人倾向于使用<code>1：最经济模式</code> 或者 <code>0：最快捷模式</code>，这个因人而异。</p><p>而我们最关心的输出则是里面的<code>duration</code>字段，它是我们通勤方案所需要的秒数，我们将基于这个进行地点筛选。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666336508-39ff1c9464c7afd16b7973b6c4cbc8ae6f2e6fc9a1d63ffa62a2eb2e37a23b2a.png" alt="picture 5" class="img_vXGZ"></p><hr><p>但仅通过公交线路规划是不够的，因为如果出发地和目的地距离很近（例如不超过一站），则会没有结果，此时就需要使用步行规划接口。</p><p>参考 <a href="https://lbs.amap.com/api/webservice/guide/api/direction#walk" target="_blank" rel="noopener noreferrer">路径规划-API 文档-开发指南-Web 服务 API|高德地图 API</a> ，我们只需要输入起始地和目的地的经纬度即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666508845-8a7fae2f2f3c84f2da90243b3897cc1a7a43042a02a7176ad315776659a725c0.png" alt="picture 6" class="img_vXGZ"></p><p>结果里依旧只需要提取<code>duration</code>字段，单位还是秒。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646666555658-15a4764c18044c987c8b7e3b1fcefef6caee19597b5cf68516de5a8034b36a8f.png" alt="picture 7" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高德-api-封装设计与实现">高德 API 封装设计与实现<a class="hash-link" href="#高德-api-封装设计与实现" title="标题的直接链接">​</a></h3><p>理清我们需要的输入与输出。</p><p>我们通过豆瓣的 API 或者爬虫可以获得 N 条租房帖条目，其中包括标题，但是不包括具体地址，我们需要通过标题知道这个帖子是否符合自己的通勤目标。</p><ol><li>将标题直接喂入高德地理编码 api，得到经纬度 A1</li><li>将经纬度 A1 与提前算好的目的地（公司）的经纬度 A2 同时喂进公交路径规划<ol><li>如果公交路径规划有结果，则选取第一条；否则再将 A1、A2 喂进步行路径规划</li><li>如果步行路径规划有结果，则选第一条；否则报错、丢弃（推荐）或者人工审查</li></ol></li><li>基于算好的通勤时间进行筛选，例如控制在 30 分钟以内或者 60 分钟以内，因人而异</li></ol><p>由于每个高德 api 都需要 key，因此可以使用<code>requests.Session</code>直接预先设置好固定的 key 参数。</p><p>设计如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"XXXXXXXXXXX"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CITY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"北京"</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 地理编码更快</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STRATEGY </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 步行距离最短方案</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置全局字典，减少高德调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADDR_NAME2LOC_DICT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 地理编码全局字典</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DURATION_DICT </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 计算两个经纬度之间的距离，统一用"-"拼接成字符串，方便序列化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"key"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用地理编码api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    使用全局字典减少高德api调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> addr_name </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://restapi.amap.com/v3/geocode/geo'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"city"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CITY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"address"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'count'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> count</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 不报错，但是赋值为空</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"geocodes"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"location"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ADDR_NAME2LOC_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">addr_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用步行路径规划api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_get_walking_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://restapi.amap.com/v3/direction/walking'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token string" style="color:#e3116c">"origin"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token string" style="color:#e3116c">"destination"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"count"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 用一个不可能的值表示没有找到任何规划</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"route"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"paths"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"duration"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 调用公交路径规划api</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_get_transit_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'https://restapi.amap.com/v3/direction/walking'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        params</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"origin"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"destination"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"strategy"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 0：最快捷模式, 1：最经济模式, 2：最少换乘模式, 3：最少步行模式, 5：不乘地铁模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">"city"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CITY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"count"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 如果没有公交路径，就使用步行路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> _get_walking_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"route"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"transits"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"duration"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    使用全局字典减少高德api调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f"</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">from_loc</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">-</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">to_loc</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> DURATION_DICT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DURATION_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _get_transit_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> DURATION_DICT</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"__main__"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">"""</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    测试demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"天坛公园"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_addr   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"天安门广场"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from_loc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to_loc   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_addr_loc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_duration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"from_addr"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"from_loc"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> from_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"to_addr"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"to_loc"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> to_loc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">"duration"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> duration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基于-pandas-进行筛选">基于 pandas 进行筛选<a class="hash-link" href="#基于-pandas-进行筛选" title="标题的直接链接">​</a></h3><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> gaode </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> get_transit_duration_between_coords</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    get_addr_name_from_coords</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TARGET_ADDRESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token builtin">globals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dump_dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DATA_FROM_DOUBAN_DIR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"data_from_douban"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FILENAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'2022-03-02-zhufang.csv'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filepath </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DATA_FROM_DOUBAN_DIR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FILENAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"reading file from: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># convert response_latest_time format into datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">response_latest_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">response_latest_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter datetime</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"'2022-02-25' &lt; response_latest_time"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter personal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"女生"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"个人"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"直租"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"转租"</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"shape: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get coords from title</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"getting coords from title"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'addr_coords'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post_title</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get addr from coords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"getting addr name from coords"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"addr_name"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"addr_coords"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_addr_name_from_coords</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># get duration between coords</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"getting distance from coords"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"transit_minutes"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"addr_coords"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> get_transit_duration_between_coords</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> get_coords_from_addr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TARGET_ADDRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">finally</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># filter duration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"filter duration"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"transit_minutes &lt; 60"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sort</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'sort'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"transit_minutes"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dump</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dump"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filepath</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">".csv"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"_filter.csv"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> encoding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"utf-8"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>结果如下，注意右边的三列<code>addr_coords | addr_name | transit_minutes</code>，就是我们基于程序计算出来的通勤相关数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646678956572-83aed2a3ecc8f6bb14055492003109ec2080830b354fabf54d76a91ba877bd00.png" alt="picture 8" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="人工筛选环节">人工筛选环节<a class="hash-link" href="#人工筛选环节" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="表格迭代标注法">表格迭代标注法<a class="hash-link" href="#表格迭代标注法" title="标题的直接链接">​</a></h3><p>我个人初步的预算其实是 2000-3000、通勤在一小时内、最好能有个独卫，后续证明这在大北京确实是一个相当困难的目标。</p><p>所以后续为了能有合适的标的，把预算上升到了 4000。</p><p>在经过我的程序化简单筛选后（基于明显不符合自己要求的标题、日期，以及基于标题与高德求解的路径耗时），两张 1w+的表格均被晒成了不足 100 个。</p><p>紧接着，我将逐一打开这些链接，进一步确定是否尝试联系或者直接 pass，并进行标记：<code>-</code>表示 pass，<code>+</code>表示有意愿。</p><p>例如，这是“北京租房”小组的表格经过手动标注后按照 choice 列降序的结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646726767185-88d0b9e7e4790687cbbf2f2a6a9368728ca195d7369b6c77b449d73a57f6ff64.png" alt="picture 9" class="img_vXGZ"></p><p>在处理“北京无中介租房”小组时，觉得单纯的加与减的级别控制还不太够，所以又使用了<code>+ | ++ | +++</code>三种级别，加号越多表示越想要，从而排序。而这些加号前面的<code>-</code>号，则表示后续在线联系或者线下考察后决定拒绝或者放弃。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646726999168-01d44eca006d3e7ca282d70a8cb76a7d681b77b1a9b2a45b4fb97f8e5ca77276.png" alt="picture 10" class="img_vXGZ"></p><p>因此标注、再标注，这是一个循环迭代的过程，最终我们将只会有很少甚至没有符合目标期望的房源。亦或者，我们将选用最后一个被排除的房源。</p><p>这有点像相亲，硬性条件不达标我们一定会 pass，可容忍的缺点我们尝试去磨合，宁缺毋滥。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="线上联系也有一些困难">线上联系也有一些困难<a class="hash-link" href="#线上联系也有一些困难" title="标题的直接链接">​</a></h3><p>因为豆瓣其实不是一个主打即时社交的平台，很多朋友只是在这里发个帖子，然后就可能……人都找不到了， 或者好几天才回。</p><p>在我的目标候选房源中，有一个超小的单身独卫房，非常廉价，但却始终联系不上： <a href="https://www.douban.com/group/topic/261047442/?_i=62974230uaXoRO" target="_blank" rel="noopener noreferrer">6 号线青年路 次卧转租—无隔断 独立卫生间 独立阳台 6 号线青年路 次卧转租—无隔断 独立卫生间 独立阳台</a></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646727973605-f7e07f6c93ee80ae944c877722d1ce688d18242edf52e4a8597e5311c32f61d9.png" alt="picture 11" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646727993779-1a8c7a3e89a723fe1e013399fe0c42bbbd4053acefa71e1ea17238d236383448.png" alt="picture 12" class="img_vXGZ"></p><p>但也许是很快就租出去了吧？反正，豆瓣私信一直联系不上。</p><p>所以，错过了见识一下目前认知里最小的独卫房的机会。</p><p>其他的基本联系上了，但有些确实比较慢。</p><p>通过线上联系直接被 pass 的主要分三种吧，发现是中介、限女生、价格过高等。</p><p>也有一些非常热情的朋友（小姐姐居多），聊天、谈房的感觉还是很愉悦的，所以转租确实比冷冰冰的中介体验感要好很多，你更大概率能感觉到真实、安心。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="线下跑房环节">线下跑房环节<a class="hash-link" href="#线下跑房环节" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="时间与路线规划">时间与路线规划<a class="hash-link" href="#时间与路线规划" title="标题的直接链接">​</a></h3><p>再经过一两个小时的手动筛选与一一联系之后，就基本决定了线下跑房的计划。</p><p>基于豆瓣租房的筛选，我两天内一共跑了九套房，其中第一天晚上原定五套实看四套，第二天下午原定四套实看五套。</p><p>当时还挺天真，每两套之间计划只用半小时，结果发现严重不够，最后还鸽了几个……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733639926-a1dc3ab4dacead50365079b9c1be3c22ea480862b978ff0d3bee9762b41ee8cb.png" alt="picture 13" class="img_vXGZ"></p><p>第二天吸取教训，把每套房控制在了一小时的间隔：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733824670-2066610fc106663cd5f2fb5821b0a98df72743c52a53180a1451908df1b9f6c5.png" alt="picture 14" class="img_vXGZ"></p><p>以及路线方面：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646733878429-bb6209a0e6373d216a3fe35736356a6bcbcdb3254c2655273a474e34cff91ac2.png" alt="picture 15" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房110-望京附近3000">跑房（1/10）: 望京附近，3000<a class="hash-link" href="#跑房110-望京附近3000" title="标题的直接链接">​</a></h3><p>第一个房是在望京附近，因为我们甲方爸爸在那，我可能较长一段时间都在那。</p><p>当时也是第一次使用豆瓣租房找房，于是找了一所，是个小姐姐，某天晚上过去看了一下。</p><p>后续觉得还是得以公司为中心比较好，所以之后开始使用程序手段进行豆瓣小组租房信息爬取与筛选。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房2103-31陆翔佳园_3200">跑房（2/10）：3-3<em>1</em>陆翔佳园<!-- -->_<!-- -->3200<a class="hash-link" href="#跑房2103-31陆翔佳园_3200" title="标题的直接链接">​</a></h3><p>三月三号晚上整体的跑房策略，就是一路向东，第一个房是在百子湾附近，是一个中介，谈的是金海国际，初步价格是在 3200-3500。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646735935957-362e48d3bd873cdcc856122bbcbc548d0af445ff1da3523964a440eaef02ea83.png" alt="picture 16" class="img_vXGZ"></p><p>我看着房子还算不错，另外也 check 了地图，是离大郊亭地铁站（这个地铁站位置还行，比百子湾更近中心一点，左边一站就是 14 号线上的九龙山）最近的一个小区。</p><p>然而，当我到了之后，有两个中介，好像一位是另一位的上级，我跟着另一位坐上了小电驴……路上问我的价位预期和要求……</p><p>我千辛万苦筛选的豆瓣租房，还是从中介的一辆小电驴，开始出发了……</p><p>然而，我们最后还是没有去金海国际，因为如果想要金海国际的独卫，预算至少估计要 4000 起，我说我最多只愿意开到 3500，于是我们到了一个小区：陆翔佳园。</p><p>【视频：3-3<em>1</em>陆翔佳园<!-- -->_<!-- -->3200.mp4】</p><p>这个小区的开价是 3500，有独卫，空间也不小，朝南，有飘窗，听说是部委房。我特意还去看了一下其他次卧的公共洗手间，非常狭窄，说实话觉得“他们”真地很不容易。</p><p>中介一直劝说我不用看客厅走廊别人的卫生间什么的，因为我住在主卧，但走廊什么的都很挤很暗，因此觉得还是难以让我满意。</p><p>另外，还有一个把我怵到了的地方，就是独卫里竟然还有个大石墩子。中介说可能是用于坐的，房东的，搬也搬不走。我当时竟然还脑补了 maybe 是一个小浴桶……但后续却始终想不明白……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646737156337-a1e512119b3d4cbdcb0abce22e4499e2bba278bb577d3b0e426ff036ec46d50d.png" alt="picture 17" class="img_vXGZ"></p><p>和这个令人想不明白的石墩墩同处一室的还有一个高级马桶，是所有房中最高级的，有点像外滩外企的马桶，emm，也忘记看是啥牌子了……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房3103-32珠江绿洲_3800">跑房（3/10）：3-3<em>2</em>珠江绿洲<!-- -->_<!-- -->3800<a class="hash-link" href="#跑房3103-32珠江绿洲_3800" title="标题的直接链接">​</a></h3><p>看完第一个陆翔佳园的房子其实已经 7 点 40 多了印象中， 于是原定于 7 点半的慈云寺的房子就肯定早已经被鸽了，事实上，最后即使租完房也没去成，彻彻底底地鸽了……</p><p>因此直接奔赴预定 8 点钟传媒大学附近珠江绿洲的房源，不过看起来是一路向东， 其实并没有那么简单……饶了一个大圈呢：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646755819160-19479abe2a639272ae78addccc932d891f19bce62b217873cf1dcae7f78c0d60.png" alt="picture 18" class="img_vXGZ"></p><p>珠江绿洲这个房源让我很放心，因为是个人，并且是刚毕业的两个小姐姐，非常热情，早早地在小区门口等待我。交流下来，非常地纯粹、坦诚，而且有趣地是她们竟然也是（准）程序员，一个做前端，一个做数据分析。</p><p>珠江绿洲给我的感觉怎么说呢，房间很大，是主卧，并且有独卫，据小姐姐反馈，原先她们是住三个人的……现在是住两个，并且有两张床……显然，对于我来说，一方面有点多余，另一方面则有点奢侈了。</p><p>【视频：3-3<em>2</em>珠江绿洲<!-- -->_<!-- -->3800.mp4】</p><p>我也开始动摇对独卫的执着，房源未必没有，但独卫的主要适用对象真不是我这种单身狗……而且价格实在太贵了，有 3800……是所有我看的房源中最贵的，并且离公司更远，也离市中心更远。</p><p>不过这个小区倒是很繁华，一楼的各种店铺一应俱全，游乐场、小公园的什么的都有，说实话，很宜居。</p><p>由于两位小姐姐其实已经找到了新的合租房，并且不在这里，所以我看完后就一起下楼了，一直亲送我到天桥附近，这份真诚让我很是感动，我也是真地很想接手她们的房源以免刚毕业的她们承受不菲的违约费用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房4103-33周井大院_2900">跑房（4/10）：3-3<em>3</em>周井大院<!-- -->_<!-- -->2900<a class="hash-link" href="#跑房4103-33周井大院_2900" title="标题的直接链接">​</a></h3><p>从珠江路景出来后，继续往东，奔赴周井大院，下了地铁后还要走大概 1.5 公里……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646756354749-459044fa0477642f9d914944bad4ee836f95a78c9819e8aa9a423d0bb9177a56.png" alt="picture 19" class="img_vXGZ"></p><p>这个房是两室一厅一卫，内部空间还是挺大的，小屋也被布置的比较温馨，地面还铺了条毯子。租客是一位在北京工作八年多的小姐姐，做餐饮行业，不知道是原来在大兴现在要去望京还是原来在望京现在要去大兴于是想转租出去。</p><p>【视频：3-3<em>3</em>周井大院<!-- -->_<!-- -->2900.mp4】</p><p>我仔细问了小姐姐平常她的交通工具是什么，毕竟离地铁比较远，她说自己是骑小电驴到地铁的，我便恍然大悟了。</p><p>不过有一说一，对于长租的人来说，离地铁远一点，配个小电驴，确实能显著提升生活体验，拥有近乎最高的性价比。</p><p>不过这个房除了区位较偏、地铁较远、小区较老（没有电梯）外还有个问题，原先帖子里说的是隔壁是有个很 nice 的小哥哥，现在被告知是一对情侣。除此之外，我觉得还行。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房5103-34珠江帝景_3500">跑房（5/10）：3-3<em>4</em>珠江帝景<!-- -->_<!-- -->3500<a class="hash-link" href="#跑房5103-34珠江帝景_3500" title="标题的直接链接">​</a></h3><p>接下来就是当晚最后一间房了，位于九龙山附近的珠江帝景。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646756511567-fa68bd26a7de703442cb9107f378812e2decbc602e8c25d61ff357e92537cf87.png" alt="picture 20" class="img_vXGZ"></p><p>理论上来说，这个房的地理位置应该是最好的，因为九龙山这里连通 14、7 号线，到达望京只需 50 分钟，到达四惠的公司只要 3.5 公里，比较适合骑车，地铁路线里只有大郊亭到百子湾段是重合的。</p><p>珠江帝景也是中介推荐房，两个人把我领了上去。</p><p>【视频：3-3<em>4</em>珠江帝景<!-- -->_<!-- -->3500.mp4】</p><p>看了一圈下来，空间肯定没有珠江绿洲的大，但其实有的一拼，不过珠江帝景对于我来说，这个阳台的造型与风景更加的有范，比较中我意，但没有独卫则是它的硬伤，否则 3500 的价格在这个地段、这个小区，那是相当值得。</p><p>但让我感到不是很舒服的两点之一，珠江帝景这个房是转租，在豆瓣帖上写的很清楚不要中介费和服务费，但是在问中介费用时却仍在算，说给个 500 什么的，我说帖子上不是这么写的，中介立即反应说是嘛，这块晚点确认一下，然后又聊了几句之后我再次确认费用核算时，中介已经没有提中介费相关问题，你细评。</p><p>第二点是关于服务费的，因为正常转租，人比较好的或者急于转的一般都会在帖子里说服务费就让给你了不用你交了，等到期再自己和房东与中介谈，这种就是比较友好的，比如珠江绿洲的两个小姐姐就是这样做的。但这里情况就不一样，是要我继续交接下来几个月服务费的，关键是，租客非常同意这一点，说不要在意那么点钱，他自己交了一年都不讲究。租客是一个 tony，也许工资确实比我高？但我觉得我就是很在意这个问题，中介凭什么能收两次服务费，除非，是转给“你”的吧。</p><p>不过说来也巧，过了几天后我刷到了一个动画视频，里面的房型竟然几乎和珠江帝景一样！让我哭笑不得。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646757175331-7eddac638f1b4110912d1a32f334b43e4112505667211f27767cec1670beda00.png" alt="picture 21" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房6103-41劲松七区_3000">跑房（6/10）：3-4<em>1</em>劲松七区<!-- -->_<!-- -->3000<a class="hash-link" href="#跑房6103-41劲松七区_3000" title="标题的直接链接">​</a></h3><p>第二天，吸取昨天的教训，放弃独卫的要求，从而尝试更多高性价比与高质量的房源。</p><p>从中午一点起，第一个房源是位于二环的劲松七区，价格 3000。</p><p>当天风超级大，出门时打电话都听不大清的那种。而在劲松七区内还看到一条被拴住的小狗，非常可怜。</p><p>【视频：大风中的小狗】</p><p>这个小区没有电梯，款式较老，有一个小学，感觉像学区房。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646759356077-ee8948e1bb0b902624d92c0d035e876b3ab249324021e64c6019284cc48b8089.png" alt="picture 22" class="img_vXGZ"></p><p>“受命”转租的是一位非常 nice 的小姐姐，待转租的是她的一位已经结婚准备回去生孩子的室友。另一位室友也是女生，做行政工作。</p><p>房间在六楼，从地铁走过来一点几公里还要再爬六楼着实还是有一点辛苦。</p><p>好在小姐姐很热情，消除了我很多的顾虑，我想的是如果租这个房至少能有一个非常好的室友关系，因为这位室友是做财务的，和我本科专业很有联系。</p><p>【视频：3-4<em>1</em>劲松七区<!-- -->_<!-- -->3000.mp4】</p><p>但最大的问题是，这个房子需要三月底才能搬，这对于我来说，并不太可行，因为这几天为了租房一直在住酒店，我需要尽快搞定租房问题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房7103-42惠生园_3300">跑房（7/10）：3-4<em>2</em>惠生园<!-- -->_<!-- -->3300<a class="hash-link" href="#跑房7103-42惠生园_3300" title="标题的直接链接">​</a></h3><p>紧接着就是惠生园，我预留了两小时，正好能赶上。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646760068701-a4e3d80f9d7d21ca18d4d1620e0b2a285aa9918a657be930231932b012b94f16.png" alt="picture 23" class="img_vXGZ"></p><p>其实从地图上看，惠生园已经离地铁很近了，但我依旧走了较长时间，所以，一点几公里的步行，可能才是人生常态……</p><p>带我看房的是租户的室友，一位刚辞职可能准备创业的很斯文的男生，房间里还有一台大打印机。租户是位女生，房间很明亮。</p><p>【视频：3-4<em>2</em>惠生园<!-- -->_<!-- -->3300.mp4】</p><p>我能够接受房子价格高于 3000，但我不能接受高于 3000 还没有独卫……另一方面，它似乎离地铁与公司有点远。</p><p>但事实上，这也有可能是出于路线偏差。在来看这个房前因为已经走了很长的路（包括去劲松七区、走错地铁、走到惠生园等），看这个房之后又走了很长的路（2-4 公里）到公司附近得了另一套房，所以强化了惠生园走路很远的印象，然而事实上可能并不是，不过惠生园到公司确实不近，并且没法做地铁。</p><p>又查了下地图，好像只要两公里，可能当时走绕了……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646804776040-338f544c70d3599e48ad4bfd90021c2641f9dde09acca9cad3aa95363b276bce.png" alt="picture 24" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房8103-43沿海赛洛城_2200">跑房（8/10）：3-4<em>3</em>沿海赛洛城<!-- -->_<!-- -->2200<a class="hash-link" href="#跑房8103-43沿海赛洛城_2200" title="标题的直接链接">​</a></h3><p>下一站是沿海赛洛城，就在公司南边 1.2 公里，是一个中介介绍，只要 2200 很便宜的房子。</p><p>实际上惠生园到公司与沿海赛洛城到公司距离差不多，两者到地铁距离也差不多，惠生园接近 1 号线，沿海赛洛城接近 7 号线（也可以往上去 1 号线），所以惠生园应该来说地理位置更好一些，但沿海赛洛城去公司不需要经过快速路，相对比较安全。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646804990842-99ab1be20299a833b54627c41b174f1ce625702af781d63bc91fe0b2be2b4f71.png" alt="picture 25" class="img_vXGZ"></p><p>房客是一个看起来很精致、大方的女孩，经问住了两年了，这次是到期搬走而不像其他的转租一样是中途搬走（因此需要重新交中介费与服务费等）。</p><p>【视频：3-4<em>3</em>沿海赛洛城<!-- -->_<!-- -->2200.mp4】</p><p>也许是受这女孩感染，查看了她的房后，觉得这个房间虽小，却也能够容纳很多人的生活与梦想，有种很温馨的感觉。</p><p>但让我觉得比较遗憾的是，这个窗户太小，并且是朝东的……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房9103-44百子湾家园_2500">跑房（9/10）：3-4<em>4</em>百子湾家园<!-- -->_<!-- -->2500<a class="hash-link" href="#跑房9103-44百子湾家园_2500" title="标题的直接链接">​</a></h3><p>看完上个房后，中介说还有一个房，更大一些，要 2500，我看现在离下一个房还有点时间，所以也答应去看了。</p><p>【视频：3-4<em>4</em>百子湾家园<!-- -->_<!-- -->2500.mp4】</p><p>这个房确实就比 2200 的更明亮许多了，窗户很大，但是厨房比较脏，洗手间的水龙头竟然还打不开，这让我很不能接受。也许是正在维修什么的，但毕竟我今天是来“查房”，第一印象不好那后续就更麻烦了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跑房10103-45垂杨柳百里_3500">跑房（10/10）：3-4<em>5</em>垂杨柳百里<!-- -->_<!-- -->3500<a class="hash-link" href="#跑房10103-45垂杨柳百里_3500" title="标题的直接链接">​</a></h3><p>看的最后一套房是一个很奇葩的户型：团结户，我也过来见见世面。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_hire-house-research-1646806309702-f56180da34c2a4773bcddb09896f13e275eabd23d460a8fd4e15fede6b331cce.png" alt="picture 26" class="img_vXGZ"></p><p>接待我的是一个中介，屋子还坐着一个，好像也是中介，地道的北京人。</p><p>【视频：3-4<em>5</em>垂杨柳百里<!-- -->_<!-- -->3500.mp4】</p><p>这个房是个老房子了，据说墙体十分结实，后来过来一个 89 岁高龄的老爷爷，跟我们说住这已经五十多年了，唐山大地震那会对面 70 年代的“新”楼都裂缝了，这个房一点事都没有，还是十二人十二天盖一层楼搞定的……听的我直愣。</p><p>【照片：老爷爷】</p><p>老爷爷问了这个房的价格，中介来之前说是 3500，然后今早房东说要加价 100，所以是 3600，老爷爷听完说那还好，一楼的那个房厨房面积比这小一半前两年还要 3800……</p><p>由于这是我看的最后一套房了，所以聊了很久，中介也很会看人，见我已经从原来的室内站到门口了，说让我进来再坐会再聊聊，聊我的工作和家乡地，还讲了点南京的段子，还是挺有意思的。北京人就是实诚，有话就说，也能说会道，这个我还挺欣赏的。</p><p>以上就是全部跑房相关内容的记录了，更多问题可以私聊我。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="投票环节">投票环节<a class="hash-link" href="#投票环节" title="标题的直接链接">​</a></h2><p>如果是您，您会选择哪一所房源：</p><p>【投票：房源】</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="info">info<a class="hash-link" href="#info" title="标题的直接链接">​</a></h2><ul><li>author: 南川</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-010">version: 0.1.0<a class="hash-link" href="#version-010" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-09</li><li>content:<ol><li>完成全部代码封测，并开源，项目地址： <a href="https://github.com/mark-applications/data-science_douban-houses" target="_blank" rel="noopener noreferrer">mark-applications/data-science_douban-houses</a></li><li>使用该项目为身边某位正为租房而发愁的朋友无偿提供帮助</li></ol></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-004">version: 0.0.4<a class="hash-link" href="#version-004" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-08</li><li>content: 增加人工筛选与线下跑房环节</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-003">version: 0.0.3<a class="hash-link" href="#version-003" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-07</li><li>content: 完成高德 API 部分</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-002">version: 0.0.2<a class="hash-link" href="#version-002" title="标题的直接链接">​</a></h3><ul><li>date: 2022-03-05</li><li>content: 完成豆瓣小组 api 部分</li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="version-001">version: 0.0.1<a class="hash-link" href="#version-001" title="标题的直接链接">​</a></h3><ul><li>date: 2022-02-28</li><li>content: 完成租房方案设计部分</li></ul>]]></content:encoded>
            <category>开发笔记</category>
            <category>租房</category>
            <category>豆瓣</category>
        </item>
        <item>
            <title><![CDATA[推广 | 贝壳新业务 VR 全职开发招募]]></title>
            <link>https://markshawn2020.github.io/blog/2022/02/21/ad-beike-hiring</link>
            <guid>/2022/02/21/ad-beike-hiring</guid>
            <pubDate>Mon, 21 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[工作职责]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="工作职责">工作职责<a class="hash-link" href="#工作职责" title="标题的直接链接">​</a></h2><ol><li>负责贝壳 VR 实景项目海外业务的设计与开发工作</li><li>参与贝壳 VR 实景项目海外业务的架构设计与性能优化</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="工作地点base-北京">工作地点：base 北京<a class="hash-link" href="#工作地点base-北京" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="工作福利">工作福利<a class="hash-link" href="#工作福利" title="标题的直接链接">​</a></h2><p>包三餐，16 薪</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="任职要求">任职要求<a class="hash-link" href="#任职要求" title="标题的直接链接">​</a></h2><ol><li>统招本科及以上学历</li><li>熟练掌握以下一种或几种技术：<ul><li>一到三年 web 系统设计开发经验，熟悉常用设计模式</li><li>优秀的数据库设计优化能力，熟悉一种数据库应用，精通 mysql 者优先</li><li>熟悉 linux，能熟练使用一门或几门以下语言：C/C++/shell/python/java/javascript 等</li></ul></li><li>扎实的计算机基础，熟悉数据结构，有较强的算法设计能力</li><li>学习能力强，有较好的沟通能力，能迅速融入团队</li><li>较强的逻辑思维能力，具有较强产品意识</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="联系方式">联系方式<a class="hash-link" href="#联系方式" title="标题的直接链接">​</a></h2><ul><li>联系电话：18995654993</li><li>邮箱：<a href="mailto:xiangchaoran001@ke.com" target="_blank" rel="noopener noreferrer">xiangchaoran001@ke.com</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="公司简介">公司简介<a class="hash-link" href="#公司简介" title="标题的直接链接">​</a></h2><blockquote><p>贝壳起于链家，但不同于链家网的垂直自营模式，其使命是缔造平台。</p><p>2020 年 8 月，贝壳以 1000 亿元人民币市值位列《苏州高新区·2020 胡润全球独角兽榜》第 14。</p><p>2020 年 8 月 13 日，贝壳找房在纽交所正式挂牌上市，IPO 发行定价为 20 美元/ADS，股票代码“BEKE”，成为中国居住服务平台第一股。上市当天，贝壳股价上涨 87.2%，收于 37.44 美元，公司市值达到了 421.95 亿美元。9 月 25 日—10 月 30 日，贝壳找房携全国众多房企倾力打造的“全民新房节”将登陆全国 60 多个城市。</p><p>2020 年 12 月 12 日，由人民日报社指导、人民网主办的“2020 人民企业社会责任高峰论坛暨第十五届人民企业社会责任奖颁奖典礼”在北京举行。贝壳找房“线上贷签”获“年度案例奖”。</p><p>2021 年 4 月 9 日，贝壳找房推出签约服务中心，通过专属签约服务场景、培养专业签约经理，并深度联动整合资金存管、线上贷签等多项服务，为用户和行业带来安全、高效、优质体验的新一代签约服务。全国铺设超 300 家 已营业超 100 家。</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_beike-hr-1645444261146-f9b6279e34887f5354ed2c1ed052596605f73d23a99c8bf6accbd5cb1d8314aa.png" alt="每个月的生日会" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_beike-hr-1645444282112-51b06f859a8b9ba416238eba8ffe68ba12feec6f8e709969369b9424ec6edcb1.png" alt="技术分享研讨会" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_beike-hr-1645444299855-fff9d2e2e18d38a61d82613ad54632c74dc1c23c55226c8cf2359a4af8f239d9.png" alt="办公区域" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_beike-hr-1645444181393-d555e335181ba87a0993166ca18c597e061b8fed6d8d96816d4c59cd99722784.png" alt="办公大厦" class="img_vXGZ"></p>]]></content:encoded>
            <category>推广</category>
            <category>VR</category>
        </item>
        <item>
            <title><![CDATA[编程设计艺术思考（持续更新）]]></title>
            <link>https://markshawn2020.github.io/blog/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts</link>
            <guid>/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts</guid>
            <pubDate>Sat, 12 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[- 快捷键设计]]></description>
            <content:encoded><![CDATA[<ul><li><a href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%BE%E8%AE%A1">快捷键设计</a><ul><li><a href="#%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9B%B8%E5%85%B3%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%BE%E8%AE%A1">与代码块相关的快捷键设计</a><ul><li><a href="#%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90%E4%B8%8E%E6%80%BB%E7%BB%93">对比分析与总结</a></li><li><a href="#%E8%B7%B3%E8%BD%AC%E4%B8%8E%E9%80%89%E4%B8%AD%E4%BB%A3%E7%A0%81%E5%9D%97">跳转与选中代码块</a></li><li><a href="#%E6%8A%98%E5%8F%A0%E4%B8%8E%E5%B1%95%E5%BC%80%E4%BB%A3%E7%A0%81%E5%9D%97">折叠与展开代码块</a></li><li><a href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%BF%AE%E6%94%B9%E5%89%8D%E5%90%8E%E5%AF%B9%E6%AF%94">快捷键修改前后对比</a></li></ul></li><li><a href="#bugfix-why-cmd--alt---converted-to-be-cmd--c">bugfix: why <code>cmd + alt + \</code> converted to be <code>cmd + c</code></a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="快捷键设计">快捷键设计<a class="hash-link" href="#快捷键设计" title="标题的直接链接">​</a></h2><p>在程序开发中，为了提高工作效率，我们一般都会使用快捷键。即使是非程序员，<code>ctrl + C/X/V/Z</code> 的组合也是烂熟于心（尽管他们对于系统内部发生了什么可能一无所知，尽管，也确实没必要知道。）</p><p>显然，程序员面临着更大的挑战，因为他们可能会接手不同的操作系统（windows, mac, linux 等)，面临不同的场景（vim, IDE, office 等），也往往会使用多个平台的软件（vscode, jetbrains 等），更不用说其他第三方软件/插件了。种种以上，对于对效率有着执着追求的程序员，如何管理与记忆这些互相掣肘的快捷键，将是一个头疼的问题。</p><p>甚至于我，从一开始只用鼠标点点点，到现在尝试统一各大平台的快捷键，我也已经走过了五年以上的时间（码龄）。我决心再往前一步，仔细分析一下快捷键的设计问题。</p><p>!!!tip vscode 的默认快捷键配置文件在：<code>/keybindings.json</code>，可以通过快捷菜单，输入<code>Open Default Keyboard Shortcuts(JSON)</code>打开。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">jetbrains打开快捷键的菜单：Preference(`cmd + ,`) --&gt; Keymap</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们先考虑第一种问题（关于操作系统），因为我们可以暂定 mac 的<code>command</code>键=windows 的<code>windows</code>键，mac 的<code>option</code>键=windows 的<code>alt</code>键，由此<code>shift</code>, <code>ctrl</code>, <code>alt</code>键成为各大平台的通用键。原先我希望 mac 的<code>command</code>键能够提供额外的控制，但在我后来使用虚拟机经历了长达一个月的按键切换折磨后，我终于想到了一个如此简单粗暴却十分有效的办法：将<code>command</code>键映射成<code>ctrl</code>键，于是乎一切是如此和谐。因此，基于这些考虑，在我接下来的文章与设计中，将只会使用三个组合键：<code>ctrl | shift | alt</code>，多余的将不用，这是为通用性考虑，也为减少不必要的麻烦。</p><p>接下来第二个问题，vim, IDE or office? 在我学编程之前与初期，office 仍旧是我的主力输出工具，无论是文章创作与 ppt 展示，但后来便基本不用了。2021 年中旬开始，我频繁地开始使用 vim 直到 2022 年才逐渐领悟 vim 的各种神奇与方便。尽管如此，vim 与传统 IDE 的快捷键习惯仍是有泾渭分明的差异，因为在 vim 中，没有所谓真正意义上的快捷键（组合键 + 普通键），而都是基于命令式的、或是单键、双键式的，一方面很难统一，另一方面甚至没有统一的必要。</p><p>比如在 vim 的 normal 模式，按<code>ma</code>就生成了一个命名为 a 的标签，后续可以通过按<code>backquote + a</code>迅速定位到该标签，这比所谓的快捷键要快很多。试想一下，如果是快捷键，你将如何设计呢？假如你把<code>ctrl + alt</code>当做标签的触发键，然后以任意字母表示标签名，接下来还要设置一个键回到该标签，比如说<code>ctrl + alt + shift</code>，但是考虑到字母键太多了，将导致你几乎没有快捷键使用了。</p><p>如果硬要设计，也不无解药，现在的 IDE（vscode, jetbrains），都提供了二键组合，因此您可以设置<code>ctrl + m</code>触发标记标签（然后紧接着按一个键标记标签名），<code>ctrl + alt + m</code>触发定位标签（然后紧接着按一个键定位到该标签名所在位置）。可想而知，比 vim 慢了很多。</p><p>但毕竟 vim 的快捷键不是交互系统的通用设计范式，我们主要思考的是组合键，vim 作为独立的生态，我们自然也就无法兼容了，因此也不在本文的考虑范围内。也许可以考虑 office，这个留给有需求的读者自行考虑。</p><p>因此本文主要探讨不同 ide 之间的快捷键设计与我们的选择与设计问题，因此，更适合程序员阅读。</p><p>以下将从一些场景出发进行思考。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="与代码块相关的快捷键设计">与代码块相关的快捷键设计<a class="hash-link" href="#与代码块相关的快捷键设计" title="标题的直接链接">​</a></h3><p>由于当代程序语言普遍是基于结构体语法设计的，例如 C/C + + /Java/JS 等主流语言(python 的缩进可以单向定位)都是基于括号来标识一个结构体的开始与结束，因此它们具有良好的定位功能。即：</p><ol><li>对于任意一个标准的程序片断，可以基于括号的一端，唯一标示其另一端</li><li>基于上述便利，再基于标点或换行，可以在任意位置唯一标示其当前所在的结构体</li></ol><p>于是，对于结构体来说，我们至少有以下功能可以设计：跳转定位、批量选择、折叠与展开。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="对比分析与总结">对比分析与总结<a class="hash-link" href="#对比分析与总结" title="标题的直接链接">​</a></h4><p>我们尝试对几个平台进行快捷键对比，分析学习各大厂商是怎么设计的，并给出我们自己的一份快捷键定制菜单。</p><p>!!!tip vscode 与 jetbrains 关于代码块的快捷键设计对比总结</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">1. jetbrains对于`alt | shift`的使用比较符合用户习惯，而vscode则有些不统一；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 但vscode对`[ | ]`的使用是优于jetbrains的`+ | -`的；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. vscode尽管没有实现部分指令，但是经过仔细考虑，也确实可以接受；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. 两者五五开，都需要经过用户自己的定制，才能较好地在两个平台之间获得近似的体验。</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>item</th><th>vscode on macOS</th><th>jetbrains(pycharm) on macOS</th><th>custom design</th></tr></thead><tbody><tr><td>jump to matched bracket</td><td>editor.action.jumpToBracket:<br><code>shift + cmd + \</code></td><td>Move Caret to Matching Brace:<br><code>ctrl + m</code></td><td><code>cmd + \</code></td></tr><tr><td>select matched brackets</td><td>editor.action.selectToBracket: none</td><td>none</td><td><code>shift + cmd + \</code></td></tr><tr><td>jump to left bracket</td><td>none</td><td>Move Caret to Code Block Start:<br><code>alt + cmd + [</code></td><td>none</td></tr><tr><td>jump to right bracket</td><td>none</td><td>Move Caret to Code Block End:<br><code>alt + cmd + ]</code></td><td>none</td></tr><tr><td>select to left bracket</td><td>none</td><td>Move Caret to Code Block Start with Selection:<br><code>shift + alt + cmd + [</code></td><td>none</td></tr><tr><td>select to right bracket</td><td>none</td><td>Move Caret to Code Block End with Selection:<br><code>shift + alt + cmd + ]</code></td><td>none</td></tr><tr><td>extend selection</td><td>none</td><td>Extend Selection:<br><code>alt + up</code></td><td><code>alt + up</code></td></tr><tr><td>shrink selection</td><td>none</td><td>Shrink Selection:<br><code>alt + down</code></td><td><code>alt + down</code></td></tr></tbody></table><table><thead><tr><th>item</th><th>vscode on macOS</th><th>jetbrains(pycharm) on macOS</th><th>custom design</th></tr></thead><tbody><tr><td>collapse this level</td><td>editor.fold:<br><code>alt + cmd + [</code></td><td>Collapse:<br><code>cmd + -</code></td><td><code>cmd + [</code></td></tr><tr><td>expand this level</td><td>editor.unfold:<br><code>alt + cmd + ]</code></td><td>Expand:<br><code>cmd + +</code>/<code>cmd + =</code></td><td><code>cmd + ]</code></td></tr><tr><td>collapse this level recursively</td><td>editor.foldRecursively:<br><code>cmd + k, cmd + [</code></td><td>Collapse Recursively:<br><code>alt + cmd + -</code></td><td><code>alt + cmd + [</code></td></tr><tr><td>expand this level recursively</td><td>editor.unfoldRecursively:<br><code>cmd + k, cmd + ]</code></td><td>Expand Recursively:<br><code>alt + cmd + + </code>/<code>alt + cmd + =</code></td><td><code>alt + cmd + ]</code></td></tr><tr><td>collapse this document</td><td>editor.foldAll:<br><code>cmd + k, cmd + 0</code></td><td>Collapse All:<br><code>shift + cmd + -</code></td><td><code>shift + cmd + [</code></td></tr><tr><td>expand this document</td><td>editor.unfoldAll:<br><code>cmd + k, cmd + j</code></td><td>Expand ALL:<br><code>shift + cmd + +</code>/<code>shift + cmd + =</code></td><td><code>shift + cmd + ]</code></td></tr><tr><td>collapse/expand to level <!-- -->[K]</td><td>none</td><td>Expand to Level <!-- -->[K]<!-- -->:<br><code>cmd + *, [K]</code></td><td><code>alt + cmd + \,[K]</code></td></tr><tr><td>collapse/expand this document to level <!-- -->[K]</td><td>editor.foldLevel<!-- -->[K]<!-- -->:<br><code>cmd + k, cmd + [K]</code></td><td>Expand All to Level <!-- -->[K]<!-- -->:<br><code>alt + cmd + *, [K]</code></td><td><code>shift + alt + cmd + \,[K]</code></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_rB0w" id="跳转与选中代码块">跳转与选中代码块<a class="hash-link" href="#跳转与选中代码块" title="标题的直接链接">​</a></h4><p>vscode 对括号跳转只提供了非常简单的一个快捷键<code>shift + cmd + \</code>，它的作用就是从当前光标开始向前定位到第一个英文圆括号或者花括号之左；如果是左括号，则再按一次将向前定位到右括号之左；否则，向后定位到左括号之左；如果没有对应的括号，则原地不动。</p><p>同时，vscode 也提供了<code>editor.action.selectToBracket</code>的指令，但是没有提供默认快捷键。作用是选中下一个代码块（英文圆括号或花括号之间的内容， 包括括号），光标会定位在右括号之右。</p><p>如果单从这两个命令来看，我觉得把<code>jumpToBracket</code>记为<code>cmd + \</code>，把<code>selectToBracket</code>记为<code>shift + cmd + \</code>是比较合理的（毕竟大多数情况下，<code>shift</code>都用于选中）。</p><p>vscode 没有提供任何方向性地跳转与选中代码块的指令，这个似乎也可以理解，因为一般选中代码，很少有需求是从某个光标开始到某个代码块的开始或结束，要选一般都是选整个代码块，也就是<code>editor.action.selectToBracket</code>，从这个角度去思考，vscode 阉割这部分功能也可以被认为是合理的。</p><p>jetbrains 相比较 vscode 来说，命令就更加丰富一些，除了直接选中代码块没有之外，其他的都有。不过值得注意的是，尽管 jetbrains 没有直接提供选中代码块的指令，但是提供了<code>extend/shrink selection</code>的指令，你可以通过多次按<code>alt + up</code>去依次选中单词、行、字符串、代码块等，所以也可以说是一个相当不错的功能。</p><p>遗憾的是，在 vscode 中暂时没有发现同等指令，只找到一个<code>Expand Line Selection: cmd + l</code>(<code>l</code>是<code>line</code>的意思)用于直接选中一行，个人觉得不够精细，而且也可以部分被<code>ctrl + c</code>替代，因为在未选中状态，<code>ctrl + c</code>默认选中一行并复制。</p><p>另外值得注意的是，jetbrains 中的<code>Move Caret to Code Block Start/End</code>支持单向括号定位跳转，这在 python 这种基于缩进的语言上将会有一些意想不到的效果，那就是如果往右定位跳转，将会直接跳转到最内部的代码块结尾（想象一下数据结构中的“右斜树”）；而如果往左定位跳转，将可以一层层往上。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="折叠与展开代码块">折叠与展开代码块<a class="hash-link" href="#折叠与展开代码块" title="标题的直接链接">​</a></h4><p>vscode 的折叠/展开主要以“fold”为主，关键字是<code>[</code>和<code>]</code>。</p><p>vscode 基于<code>cmd + k cmd + [K]</code>将全文档折叠和特定级别折叠统一了起来（0 代表 0 级别，也代表全文档），但引发的问题就是展开全文档没有对应的数字，结果选了个<code>j</code>(不明觉厉)。</p><p>此外，可能是考虑到了单级别的展开与折叠比较常用，所以绑定了单组合键<code>alt + cmd + [</code>/<code>alt + cmd + \</code>与其他操作需要的双组合键未能统一。从设计来看，并不是十分令我满意。个人觉得 vscode 不妨考虑冗余设计，集体允许<code>cmd + k ANY_SECOND_KEYS</code>的模式，并为单级别折叠与展开额外再提供一个单组合键。</p><p>jetbrains 的折叠展开主要以“expand”为主（正好和 vscode 相反），关键字是<code>+</code>和<code>-</code>。</p><p>其实我个人比较喜欢 vscode 的关键字设计，因为在大部分软件中<code>cmd + +</code>/<code>cmd + -</code>都是用于放大或者缩小字体的，而用<code>cmd + [</code>/<code>cmd + ]</code>去操纵结构体则同时显得更为合理（因为这几个关键字本身就是括号的意思）。</p><p>其次，jetbrains 使用<code>alt</code>表示循环，用<code>shift</code>表示全局，个人认为也很简单暴力。而单独用小键盘去表示指定级别的展开/折叠，虽然也可以理解，但还是给 mac 造成了一定困难，毕竟 Macbook Pro 也没有小键盘。我们需要重新 map。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="快捷键修改前后对比">快捷键修改前后对比<a class="hash-link" href="#快捷键修改前后对比" title="标题的直接链接">​</a></h4><p>macOS - vscode - keymap - changed:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666595428-1d774a2af7dd3ea18ced0923cbb0bec75323a37d257aec1065dbea8c2253dc1d.png" alt="picture 12" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666542947-8842e877c62701d1793078ef1057aebd88e05ebab75f170d0cda756bce4f4db8.png" alt="picture 10" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666569417-ca616bc0ada9c550799841ec7fe1b0d247a47df739d6e52a8d76b3614fe072d1.png" alt="picture 11" class="img_vXGZ"></p><p>macOS - pycharm - keymap - changed:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666436302-5080248703c57e4f10f4c80f638860d3605179fb09701b448606dd75cd616966.png" alt="picture 9" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666160469-dbf2ab993fa301cfca8499e457bc1732a674eb0dd661d638e4a054a763c3d0e5.png" alt="picture 6" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666244565-81fd291b3518de92b198de24fc72e48fe7514b6e39ba839c7a4336376486e82e.png" alt="picture 8" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="bugfix-why-cmd--alt---converted-to-be-cmd--c">bugfix: why <code>cmd + alt + \</code> converted to be <code>cmd + c</code><a class="hash-link" href="#bugfix-why-cmd--alt---converted-to-be-cmd--c" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/coding-design-1644666049559-11595bbdf9defe2b771e206dbd5fe29a724222470addc13d32531010f3eed795.png" alt="picture 5" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[札记 | 2022，活着]]></title>
            <link>https://markshawn2020.github.io/blog/2022/02/03/prose-living</link>
            <guid>/2022/02/03/prose-living</guid>
            <pubDate>Thu, 03 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[1. 行动的力量：不要让遗憾永远都只是遗憾]]></description>
            <content:encoded><![CDATA[<ol><li><a href="#%E8%A1%8C%E5%8A%A8%E7%9A%84%E5%8A%9B%E9%87%8F%E4%B8%8D%E8%A6%81%E8%AE%A9%E9%81%97%E6%86%BE%E6%B0%B8%E8%BF%9C%E9%83%BD%E5%8F%AA%E6%98%AF%E9%81%97%E6%86%BE">行动的力量：不要让遗憾永远都只是遗憾</a></li><li><a href="#%E5%B9%B3%E5%87%A1%E7%9A%84%E7%AD%94%E6%A1%88%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%B4%BB%E7%9D%80">平凡的答案：我们为什么要活着</a></li><li><a href="#%E6%8E%A7%E7%86%B5%E7%9A%84%E8%89%BA%E6%9C%AF%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E6%9B%B4%E5%A5%BD%E5%9C%B0%E6%B4%BB%E7%9D%80">控熵的艺术：我们如何更好地活着</a></li><li><a href="#%E5%BD%93%E4%B8%8B%E7%9A%84%E4%BB%B7%E5%80%BC%E6%97%A2%E7%84%B6%E6%88%91%E4%BB%AC%E5%8F%AF%E8%83%BD%E6%B0%B8%E8%BF%9C%E4%B9%9F%E5%87%86%E5%A4%87%E4%B8%8D%E5%A5%BD">当下的价值：既然我们可能永远也准备不好</a></li><li><a href="#%E6%84%9F%E8%B0%A2%E7%9A%84%E6%84%8F%E4%B9%89%E5%A4%A7%E5%A3%B0%E5%91%8A%E8%AF%89%E4%BD%A0%E4%BB%AC%E5%85%B6%E5%AE%9E%E6%88%91%E5%BE%88%E5%9C%A8%E4%B9%8E">感谢的意义：大声告诉你们其实我很在乎</a></li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="行动的力量不要让遗憾永远都只是遗憾">行动的力量：不要让遗憾永远都只是遗憾<a class="hash-link" href="#行动的力量不要让遗憾永远都只是遗憾" title="标题的直接链接">​</a></h2><p>离新年过去已经有几天了。</p><p>我总想说点什么，为自己，也为我的朋友们。</p><p>好吧，诚实点，主要是为自己。</p><p>因为总觉得，如果不说点什么，那么很快地，我在这个时间点上所经历的这几年的思考都将淹没于无尽的黑暗之中。</p><p>我本来是很想写一点宏大的东西的，但是后来发现，难度过大，遂放弃。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-live-1643890813684-ce983f95f534572c4415ad7e19a8eb15675cc754b3dcbb98e4b41561ed32d599.png" alt="picture 12" class="img_vXGZ"></p><p>所以，选些容易的罢。</p><p>还记得我最遗憾的是，在我所负责的某个社团交接之际，与所负责的某个商业项目收尾之际，未能及时地给他们一份总结，我原以为自己会记得，我相信我总有一刻会有时间、心情恰好地去做，却毫无疑问地离那份履约越来越远，成为最终的“坏账”。</p><p>这是我所背负的一些愧疚，一些可能影响不是那么大，但一生都会觉得有些愧疚的东西，因为关于有始有终，我们本可以做到，但我们没有。</p><p>我不想这样。</p><p>至少，我不想以后都这样。</p><p>既然意识到了有始有终的价值，我决定，我一定要写点东西出来。</p><p>这关乎我内心的一份尊严。</p><p>所以，我正在尝试。</p><p>非如此不可。</p><p>非如此不可。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="平凡的答案我们为什么要活着">平凡的答案：我们为什么要活着<a class="hash-link" href="#平凡的答案我们为什么要活着" title="标题的直接链接">​</a></h2><p>一个人并非时时刻刻都喜欢与擅长思考。</p><p>于我，旅行时、沐浴时、深夜望着街道或是星空时、绝望时，会。</p><p>所以从微观上，因了今天的小雨，我独自骑车去核酸路上，经过一处菜市场，大爷大妈一个个笔直地林立在场棚下，靠近马路处是一个烟火桶，噼里啪啦静静燃放着。</p><p>那一刻，很美。</p><p>是平凡生活的美。</p><p>我很想举起相机记录下这一时刻，但那样旋即就破坏了整个街道的氛围，多有不识趣之味，便立即作罢了，只同样静静地记录在心中。</p><p>继而流淌到“纸”上。</p><p>幸而，我是确有一些照片的，关于这类。</p><p>二零二一年八月三日，晌午，我和驴友从雅安进发新沟，80 公里，海拔 540 到 1200，烈日炎炎。</p><p>我一路惊叹，雅安竟然有这么多“背篓客”，年轻的、年迈的、男的、女的，他们就那样背着箩筐，然后走去似乎很远的地方。</p><p>而路上，最让我们印象深刻的就是这位老婆婆。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643880199274-0b6e6793b343c6ff66e8c963fcd3de2bf45a99904df2d2ef4344c3595a97b7a6.png" alt="picture 1" class="img_vXGZ"></p><p>那时我们正好是下坡，迎面一步一步不紧不慢的老婆婆一下吸引了我们注意力，在热情地打了招呼后，体力勉强能够支撑的老婆婆向我们友好地伸了伸手，没有其他言语。</p><p>其实不仅仅是她。</p><p>八月十日硬闯尼玛贡神山，山脚遭遇暴雨，我和驴友不得不被迫就近找了一户人家恳请落脚。舍主是一位虔诚的老婆婆，手里的念珠不停地转着，看得出来年龄已经相当大了，卧着不能动弹。</p><p>你知道我最心酸的是什么吗？</p><p>是床的另一边的柜台上放着的苹果，已经都腐烂了。</p><p>可即便如此，她仍旧是那样努力地生活着。</p><p>她床边便是一张窗子，能看到外面的马路，此时此刻，我只想着，也许她的可能比我还大的孩子们，该归来团聚了吧。</p><p>时间催人紧，我们不方便久留。于是很快又上路了。</p><p>又历经约莫一个小时的攀爬，我们于黄昏之际抵达了尼玛贡神山观景台，风雨已摧残地我们狼狈不堪，驴友妥协地住下了。</p><p>可倔强的我没有。</p><p>我不知道再给我一次机会，我会不会还那样选择：即便夜幕降临，大雨滂沱，也要翻越卡子拉山 4700 米黑夜的恐惧，只为完成既定的计划。</p><p>夜晚八点半，终于在渺无人烟、云雾缭绕的地方见到了一户人家，我走近询问离山顶还有多久，接见我的是一位十几岁利落的小姑娘，她那不容置疑的语气让我相信，这里便已经是山顶。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643880846639-dff8003e02e4bb44a13d0ef052c2852a034eea6bc82dbc94317ccd7a9387044a.png" alt="picture 2" class="img_vXGZ"></p><p>那一刻，我暗暗感动到什么是天道酬勤，只要方向正确，一定会有抵达终点的那一刻。我们也许往往迟到，但我们绝不会不到。</p><p>时至今日，我偶尔也会想起她，在这四千七百米的最高峰上，每天都会想些什么。</p><p>你若问我平凡的意义，我想，大概就是，不卑不亢，内心坚定地活着，哪怕背负沉疴，哪怕无人问津，哪怕与世间最稀薄的空气为伴。</p><p>比起他们，我们是不是已经幸福很多。</p><p>也许不。</p><p>但有一点我是如此肯定，我们都要努力地活着。</p><p>这是我最想说的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643882392412-86f45454e5e2a744efd7ab9d5b12dffdec0aae56b4c252ffe2fe1b54338dd7c0.png" alt="picture 3" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="控熵的艺术我们如何更好地活着">控熵的艺术：我们如何更好地活着<a class="hash-link" href="#控熵的艺术我们如何更好地活着" title="标题的直接链接">​</a></h2><p>在活着成为共识之后，我们方能进一步讨论一下，如何活着，如何更好地活着。</p><p>显然，如何活着，这个问题是没有意义的，作为碳基生物，能呼吸，有心率，便是活着，而这一切，都是后台程序，是自动运行，不受主观控制的。</p><p>我们需要思考的是，如何 XXX 地活着，之所以不直接得出“如何更好地活着”，是因为，我们有必要思考一下“如何更坏地活着”。</p><p>因为有一种方法论叫反向操作法，比如说如果某个女明星基金经理每年都亏，那我们反向跟她操作即可。</p><p>确实，是有人提出如何更坏地活着的，然后我们会发现，每个反向操作都不容易，例如经常晚睡（我们正是这么做的）、奢侈消费（正合我们意）、沉迷游戏（老带劲了）……</p><p>你发现了吗，每个人都几乎知道如何活的更好与更坏，结果，很少有人能真正活好。</p><p>反向操作并不是万能的解药，因为我们无法喊醒一个装睡的人。</p><p>我也无法给出一个人如何更好地活着的终极解决方案，毕竟变好的标准几乎是相同的，但变坏几乎每个人都有自己的不同。</p><p>我想从我的专业领域给出一点自己的体会，那就是：控熵。</p><p>为啥程序的世界，总能精准地运行，抛开外部与底层复杂的设计不谈，有一点尤其值得我注意：“栈”。</p><p>一个正常与复杂的程序，时时刻刻都会处理海量的输入与输出，在其初始化的时候可能仅仅是几个函数与几个线程，随之却会爆炸式增长，但最终会平息下来，这是一个好的程序。</p><p>所以评价程序的核心在于首先理解程序是如何管理“爆炸式增长”的复杂性的，答案就在“栈”，以及一切与“栈”相关的概念、内容、范式。</p><p>我们的人生其实就是一个庞大的程序，这里不展开讨论是否有上帝的存在，因为即便你知道自己的人生是被上帝设计且运行的， 难道你就要毁弃重开吗。</p><p>即便你想，终究是没有重开选项的。</p><p>我们每天遇到的新的人，听到的新的故事，面对的新的难题，处理的新的琐事，一笔一墨，都是自己的人生，凡所经历，都成了我们的过往。</p><p>但这个过程，不无超脱的解药。</p><p>很长一段时间，我都企图从 AI 理论那里学来什么预测人生的诡计，现在我已经决然放弃了。</p><p>我们要花多久才能意识到，很多预测都是徒劳的，很多预期是不可预期的，但如何应对是永恒的，我们需要建立一套能处理任何困难的程序：控熵。</p><p>你知道一个人在什么时候会崩溃，然后“重开”了吗。</p><p>是因为整个系统的熵急剧增高，无法破局了。</p><p>比如一位博士生选择自杀，在论文中了顶会之后。</p><p>比如一位程序员选择自杀，在被对象逼迫威胁后。</p><p>很多时候一个人是这么走向灭亡的：</p><blockquote><p>有一个看起来很甜的罐子，他打开，尝了两口。</p><p>接着再打开，又尝了两口。</p><p>最后喝到了一口毒药。</p><p>他懊悔不已，可是那几口甜药已经下肚，无法赎回了。</p></blockquote><p>如果他会控熵的艺术，他至少可以采取两种策略。</p><p>第一种，先喝了两口甜药，然后结清所需的代价，他将不欠瓶子什么。于是再喝两口，再结清。最后喝到一口毒药，他便有了讨价还价的筹码。</p><p>第二种，在打开罐子之前他已经备份好了整个系统，喝了五口药后，立即回滚。熵便清零了。</p><p>程序的核心是每个函数只负责自己的那部分是正确的，错误将提交到上级，整个程序的错误将有一个专门的异常处理程序处理。</p><p>例如在安卓系统中，每个程序一旦产生了异常，将会被 runtime 主程序直接杀死然后重启，而不会选择费力地去修复。</p><p>在我学习程序的这几年，这些理念是如此根深蒂固地影响了我，让我时刻保持关注自己的“熵值”：我的“程序栈”里目前正在处理哪些东西，处理的优先顺序是什么，现在是否合适再加入什么。</p><p>所以从我自己来说，很感谢这几年的风雨豪迈，无数的挑战与压力教会了我宠辱不惊的扫除力、修复力和定力，让我能够清晰地意识到我的大脑是一片足够强大的 CPU，让我在遭遇战时能够第一时间问到：</p><ol><li>这个问题需要什么背景。</li><li>这个问题需要什么路线。</li><li>这个问题需要什么支持。</li></ol><p>而非：我能不能解决这个问题？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643890352374-e4dfdd72fe3424d9711ed865a61471d1015994c99152cb0fec0cc7701b21ff7b.png" alt="picture 10" class="img_vXGZ"></p><p>虽然从悲观角度，人永远不可能像程序一样精准地活着；从感性角度，人有时候就需要一些“信仰之跃”。就像战争年代，有信仰的人不少，但活下来的不多。</p><p>所以，我也仅仅只能从我的一些感受中，给出一点点参考建议：时刻关注自己的状态与过程，控制自己的熵值，这样即便泰山崩于前亦能面不改色。</p><p>毕竟人这一辈子，生死而已，浮寄于天地之间，能醒着活，便不醉着过。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="当下的价值既然我们可能永远也准备不好">当下的价值：既然我们可能永远也准备不好<a class="hash-link" href="#当下的价值既然我们可能永远也准备不好" title="标题的直接链接">​</a></h2><p>很多时候，无非只是想做成一件事。</p><p>可我们始终会碰到做不好的时候。</p><p>一年，甚至又一年，都原地踏步的感受，我想，有人会明白。</p><p>我们总希求上天能多给我们一些时间。</p><p>等项目结束了，等考研结束了，等这个月过去了，我们把主动权交给等。</p><p>我们很多时候，似乎能做的只有等。</p><p>但这并不是全部。</p><p>尽管我现在已经不喝鸡汤了，但我强烈建议没有喝过的可以喝一喝， <a href="https://www.youtube.com/user/TheMiro0r" target="_blank" rel="noopener noreferrer">Mateusz M - YouTube</a> 曾经给我过许多力量。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643885837007-29710d96335fe725ad03b83e6e0f78f142576ebe389afac97481b3df489226f6.png" alt="picture 4" class="img_vXGZ"></p><p>印象最深刻地一句话便是：“<strong>你永远也不会准备好</strong>”。</p><p>难道不是吗？</p><p>PPT 永远是最后一刻还在奋力修改着。</p><p>程序在最后交付的时候还会有 bug。</p><p>约会过去了三天还会思考那天的帽子是否不合适。</p><p>……</p><p>生活，有时是会这样的。</p><p>但即便真地遇到了“可预期的失败”，那又如何呢。无非大哭一场，无非在深夜里买醉，无非连续三个月躲在虚拟世界。</p><p>之前一位“八年抗战”的研友问我，如果我站在他角度，我会选择怎么做，随便找个人结婚？或是继续透支考研？</p><p>我说，不，我给不了你答案。你只告诉了我你的现状，这是一个点的信息，我无法根据这个点给你建议。</p><p>我们需要花多长时间才能明白，过去墨迹已干，能把握的只有现在与将来。</p><p>为什么有些人明明七十岁了，眼里还能有如孩子般的光；而有些人才二三十岁，却觉得人生一片黑暗。</p><p>我知道一定会有人跳出来说，那是因为前者没有经历过后者所经历过的事，你没有资格去指责后者。</p><p>是。</p><p>所以我确实没有资格说任何别人的事，包括这位研友。</p><p>所以我只能对自己说：</p><p>天不救兮，唯有自救。</p><p>每一朵花开，都会划过时间的寂寞，静待花开。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643890404455-08a2ccdbdc96ee2261b9af68a83f44bf1ccbcd680ec40a9fdc69b0e25803498d.png" alt="picture 11" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="感谢的意义大声告诉你们其实我很在乎">感谢的意义：大声告诉你们其实我很在乎<a class="hash-link" href="#感谢的意义大声告诉你们其实我很在乎" title="标题的直接链接">​</a></h2><p>不知不觉，又胡诌了一顿文字，我向来不是很擅长表达，很多时候，也没有多少表达的意义，但我依旧还是努力去表达些什么，与我而言，这也是我生活的一部分。</p><p>所以，是时候到了表达我最不擅长的一部分了，关于感谢。</p><p>我理解中的感谢，也许未必是不落俗套的，但一定是发自内心的，我也确实很想感谢一些人。</p><p>我知道，感谢是不能乱感谢的，否则会让被感谢之人面里无光，所以我忖量很久，考虑到我其实是一个毛病如此多的烂人，也许仅在某一些领域小有一些收获，所以我希望能将我自己抽离分解，针对这些分别感谢。</p><p>第一，考虑到这几年来，我一直坚持原创公众号，个人认为还是比较值得肯定的，所以首先感谢所有关注我公众号的朋友们，尤其是考研自习室那段时间，让我又结交了几个一起奋斗的好朋友，他们鲜净可爱，带给我很多力量。</p><p>第二，我也没指望通过公众号去赚钱，我知道某些公众号随便一发文章，打赏都能上万了， 贫富差距很大，但我确实不在乎这个，做技术的人一般都比较务实，但还是很感谢一些朋友经常能够慨然相助，混点馒头钱，是对我莫大的鼓励。</p><p>第三，尽管我菜到一篇论文也没发过，并且已经离校很久了，但还是特别感谢金融学院郑登元老师曾经给过我学术上的指导和为人上的表率。郑老师是我们台湾的好朋友，孤身一人在南京，办公室经常秉烛工作到深夜一两点，每个学生临走时郑老师都会亲送到走廊，在“学风日下”的当代，让我感受到建国年代学者为学的风范，让我觉得学术不再是那么高不可攀的一件事，随手建模严谨分析成为基操，一步步影响我成长为一个理性人，感谢！</p><p>第四，很感谢一路走过来一直支持我的一些朋友，尽管生活所迫，山海所隔，我们都不能有一丝机会可以畅快饮酒。人生往往是这样的，正因如此，我们每个人才会眼里有光，内心有火，我们每个人看似如此孤独，但我们永不寂寞。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643889012854-fb7e134015e0fb01160fbb5bf20371f54d5f76651f8d951be705e28db665724c.png" alt="picture 5" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643889502670-2b1b673307cb825b0906c95c5a9207c0e81beb157cd872b28b3c1f45b020c48b.png" alt="picture 6" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643889738162-ae69059cbbe34f016550856bac5199afb4206ce3373299c77d4207e99423163c.png" alt="picture 7" class="img_vXGZ"></p><p>感谢是感谢不完的，即便是和你正争锋相对的“敌人”，也有很多值得感谢的地方，因为他们让你成长更快，同时他们也一定有你可以学习的地方。</p><p>唯有以永远热忱的赤子之心，面对这个世界，才不枉走此一生。能微笑，绝不愤怒；能愤怒，绝不妥协；能妥协，绝不后退；能后退，绝不止步不前！</p><p><strong>2022，活着！</strong></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643890122980-a4b87be76eee2e543aa193eb29bc70312b47788f3bce5554ed60964776382e89.png" alt="picture 8" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_2022-what-we-have-done-right-1643890133230-c1aed5ae60f421539ee304ecca3609a49edd3d61ffca44f703bff3abbfc6b407.png" alt="picture 9" class="img_vXGZ"></p><p>谨以来自五千二百米对八千八百米的仰望，祝我所有的朋友们，新年快乐，勇往直前！And the most most most important: MAY PEACE WITH YOU.</p>]]></content:encoded>
            <category>札记</category>
        </item>
        <item>
            <title><![CDATA[编程 | Linux 笔记]]></title>
            <link>https://markshawn2020.github.io/blog/2022/02/02/dev-linux</link>
            <guid>/2022/02/02/dev-linux</guid>
            <pubDate>Wed, 02 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[很久以前，自打我刚开始学计算机，就有一个认知：精通 linux 的人都是大神。]]></description>
            <content:encoded><![CDATA[<blockquote><p>很久以前，自打我刚开始学计算机，就有一个认知：精通 linux 的人都是大神。</p><p>但，我是不需要学的。</p><p>很长一段时间，我都是这么认为的。</p><p>直到这两年，我选择了 Mac 作为自己的主力开发工具，两年的摸爬滚打，尤其是始于对<code>iTerm + zsh + oh-my-zsh</code>颜值的惊艳，到现在能够在 mac、ubuntu、centos、windows 等各大操作系统之间自如切换，并逐渐意识到命令行系统对于现代操作系统的重要性，命令行熟练度对于提升工作效率的重要性，我知道，我已经走向了一条与计算机越来越近的不归路。</p><p>而这一切中间的桥梁，正是 linux，于我而言，不认识不掌握 linux，不可谓入了程序的真正世界。</p><p>因此，本系列第一篇，献给 linux，一方面是致敬我心中曾经那触不可及的信仰，另一方面也是为了能重新认识它，对它说一句它可能真正想听的："hello linux, I'm mark"。</p><p>因为每一个 linux 的学习者最后都会发现，linux 并不神秘，而 linux 真正启迪人的，是它的设计哲学，与对你工作流的重塑。</p><p>在此，我斗胆把 python 之禅搬于此，因为在我心中，它于 linux，是心有灵犀，同样适用：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643723806431-00b5b858aa9372ebc4b9dfc37178554d0d0d4eb62c854edb6cd2385e15333e07.png" alt="picture 16" class="img_vXGZ"></p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="首先linux-是什么">首先，linux 是什么<a class="hash-link" href="#首先linux-是什么" title="标题的直接链接">​</a></h2><p>作为南川的核心开发笔记（从实际工作经验中提炼出来的笔记），我无意过多展开一些基本的背景介绍，因此也不会花时间去讲述 linux 和 unix 和 mac 之间的关系，这些读者们都可以很方便地在互联网找到答案。</p><p>我只简单地如下描述，目前用于个人使用的电脑系统，主要分为 windows 和 mac。</p><p>windows 的最大优点，是价格相对平民，生态丰富，交互习惯最符合人类直觉。</p><p>mac 的最大优点，是审美一流，做工一流，触控板和屏幕天花板的存在，然后于我而言最大的优点，是其 unix 系统，可以允许我像 linux 一样方便地使用命令行。</p><p>所以，我在使用了五年的 windows 后，毅然投入了 mac 的怀抱，而其中的目的之一，就是为了更好地掌握 linux。</p><p>（当然，纯粹使用 linux 我是不会接受的，我还是觉得追求审美也是生活中很重要的一部分，于是乎，<del>我现在已经极其极其不想看到任何 windows 的界面</del>）</p><p>说了这么多，还是没说 linux 是什么。</p><p>没错，就应该这样，这篇是核心开发笔记，非核心的，可以出门右转某乎，比如：</p><ul><li><a href="https://www.zhihu.com/question/434914458/answer/1664277013" target="_blank" rel="noopener noreferrer">(19 封私信 / 67 条消息) 作为开发者，你更喜欢用 macOS、Linux 还是 Windows 操作系统？为什么？ - 知乎</a></li><li><a href="https://www.zhihu.com/question/24261540/answer/80418621" target="_blank" rel="noopener noreferrer">(19 封私信 / 67 条消息) Linux 各大发行版有什么特色？ - 知乎</a></li></ul><p>PS: 以上链接，我都没有看过，只是随手一搜。😄</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其次如何拥有一台-linux">其次，如何拥有一台 linux<a class="hash-link" href="#其次如何拥有一台-linux" title="标题的直接链接">​</a></h2><p>有很多种方法。</p><p>如果你是 windows 10+用户，最方便的方法，是基于内置的<code>wsl</code>系统，不知道是什么？出门右转。</p><p>至于内置的<code>wsl</code>会不会有什么限制和性能损耗？这个我也不知道，我不用，如果你知道，欢迎留言，我还挺想知道的，只要你愿意留我就愿意听，并且可能会影响我接下来的认知。</p><p>但我不会因为这个出门右转，我已经为了给大家示范如何出门右转，已经出门一次了，寒冬腊月，怪冷的。</p><p>这是其一。</p><p>其二，装一个双系统。</p><p>我一直想装个双系统，并且尝试到了最后一步，因为工作需要。当时我给我的 mac 装 ubuntu 的双系统，结果到了安装界面，鼠标和键盘没有响应，查了查好像我的版本 mac 2020 pro 的鼠标和键盘不走 usb，而是总线？</p><p>不清楚，后续我可能会继续尝试装个双系统，目前我用的是虚拟机。</p><p>PS：友情提示，小白不要轻易尝试双系统，容易留下不学无术后悔的泪。</p><p>其三，装一个虚拟机，比如<code>vmware</code>或者<code>virtual box</code>。两个都尝试下来，个人比较喜欢<code>vmware</code>。</p><p>至于怎么装，怎么配置，出门右转，或者等我后续系列，会有虚拟机/双系统专刊的，应该（如果不懒的话）。</p><p>我目前的虚拟机（内部运行的 ubuntu，可以同时运行多个操作系统）界面如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643725375163-c76c9d50a6632d532665d3bbbffb45379f7a72060170528ffbba377ad4a0d461.png" alt="picture 17" class="img_vXGZ"></p><p>其四，阿里云/腾讯云/华为云/亚马逊云……租一个 linux 服务器或者操作系统等。这是业界搭建后端必备。我之前一直用的阿里云/腾讯云，因为以前做全栈多一些。</p><p>目前市面上，服务端应该用 centos 比较多，客户端应该用 ubuntu 比较多，主要原因可能是 centos 默认没有界面，程序较为稳定；ubuntu 的界面很好看，比较适合个人鼓捣。</p><p>我目前使用的 ubuntu 界面如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_core-notes-of-linux-1643725414611-b8cc4126f345748e9f692843738ed6d80aa61c82103b1321308468c70443c356.png" alt="picture 18" class="img_vXGZ"></p><p>这里值得注意的是，有一些企业可能购置了类似于 windows server 之类的服务端，这种本质上还是 windows 系统，不是 linux 系统，只不过一直跑在公司网络上。</p><p>所以当我们谈到服务器的时候，可能并不一定是 linux 系统，这是值得注意的。</p><p>我为啥知道这玩意呢，因为之前碰到一个项目是这样的，我本来写好的 linux 的后端，想着直接移到目标公司网上，结果一看，windows server，把我给整不会了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="接着如何登录-linux">接着，如何登录 linux<a class="hash-link" href="#接着如何登录-linux" title="标题的直接链接">​</a></h2><p>理论上，登录这个动作，不应该是个问题，但那仅限于是登录自己的本地的每天都用的电脑。</p><p>linux 一般都是在服务端的，一般涉及到远程访问，所以通用做法是用<code>ssh</code>。</p><p>基本的 ssh 用法出门右转即可，本文只记录如何免密登录 ssh。</p><p>因为 ssh 默认每次都会输入密码，很不畅快。更严重的是，如果涉及到写批运行脚本，则密码输入会成为脚本杀手，至少会让脚本更难理解，出错概率更高。</p><p>很简单，第一步，先<code>ssh USERNAME@SERVER</code>，其中<code>USERNAME</code>和<code>SERVER</code>是目标服务器的用户名和 IP 地址（或者域名，如果有的话）。</p><p>一般，默认的<code>USERNAME</code>是<code>root</code>，密码也是<code>root</code>，虽然这很不推荐，不安全，但对于新手却是很友好。</p><p>尽管我的密码更简单，简单到你会拍案惊奇。</p><p>当你第一次<code>ssh</code>之后，会在本机的当前用户文件夹下（mac 和 linux 都是<code>~</code>文件夹，windows 是<code>C:\\Users\\XXX</code>）生成一个<code>.ssh/id_rsa.pub</code>，这是公钥。</p><p>这个文件的内容，涉及到了 rsa 算法等密码学相关内容，不展开。而你要做的，就是把里面的文本复制，粘贴到目标服务器的<code>~/.ssh/authorization_keys</code>文件内（如果文件不存在，则新建；如果文件已有内容，则另起一行，补在后面即可）。</p><p>以下给出一键脚本：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">USERNAME="xxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVER="xxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file="id_rsa.pub"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp ~/.ssh/$file $USERNAME@$SERVER:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh $USERNAME@$SERVER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file &gt;&gt; .ssh/authorized_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm $file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个脚本里的<code>scp</code>是在本地与服务器之间交换文件的意思，最后一个冒号表示当前文件夹，而<code>$USERNAME@SERVER</code>即目标服务器的用户文件夹，这就对上了。</p><p><code>cat</code>是读取所有文本内容到输出流，<code>&gt;&gt;</code>是把输出流内容添加到目标文件的末尾。</p><p><code>rm</code>是删除，这里代表传送的<code>file</code>是一个中转文件的意思，为啥要中转，你猜。</p><p>最后，为了防止<code>ssh</code>超时断开，可以在本地（客户端）的<code>ssh</code>配置文件中补一下以下配置，这样每分钟发送一次消息给服务端，服务端就不会主动清理客户端了。相信我，如果不解决这个问题，后续你会很头疼的。</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># /etc/ssh/ssh_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServerAliveInterval 60</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后如何掌控-linux以下给出一部分经验笔记">最后，如何掌控 Linux，以下给出一部分经验笔记<a class="hash-link" href="#最后如何掌控-linux以下给出一部分经验笔记" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="-------------------------------------">-------------------------------------<a class="hash-link" href="#-------------------------------------" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-ubuntu-initialization">BEST-PRACTICE: ubuntu initialization<a class="hash-link" href="#best-practice-ubuntu-initialization" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-0-install">step 0. install<a class="hash-link" href="#step-0-install" title="标题的直接链接">​</a></h3><ul><li><a href="https://releases.ubuntu.com/18.04/" target="_blank" rel="noopener noreferrer">Ubuntu 18.04.6 LTS (Bionic Beaver)</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-1-config-apt-source">step 1. config apt source<a class="hash-link" href="#step-1-config-apt-source" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="1-change-apt-source">1. change apt source<a class="hash-link" href="#1-change-apt-source" title="标题的直接链接">​</a></h4><p>ref:</p><ul><li><a href="https://zhuanlan.zhihu.com/p/61228593" target="_blank" rel="noopener noreferrer">【Ubuntu】Ubuntu 18.04 LTS 更换国内源——解决终端下载速度慢的问题 - 知乎</a></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="fastestscript-way-直接修改etcaptsourceslist">fastest/script way: 直接修改<code>/etc/apt/sources.list</code><a class="hash-link" href="#fastestscript-way-直接修改etcaptsourceslist" title="标题的直接链接">​</a></h5><p><del>其中，第一种方案虽然可行，但是有两个缺点，一个是侵入性高，所以一般都会先备份一下原文件，然后使用替换命令。</del></p><p>Update 2022-01-24：实际上所有方式底层都是通过修改 apt sources.list 文件配置的，所以没有什么侵入性一说，都会先做备份。</p><p>GUI 版（也就是<code>softwares &amp; update</code> app 里会提供测试，自动修改，改完之后触发更新操作，而这些其实可以自己用脚本完成，响应也更快！</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># backup source file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCES_LIST_FILE=/etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp $APT_SOURCES_LIST_FILE $APT_SOURCES_LIST_FILE.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCE="http://mirrors.yun-idc.com/ubuntu/"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i  "s|deb \S+|deb $APT_SOURCE|g" $APT_SOURCES_LIST_FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># update source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另一个就是，只能填入自己想填的源，但很可能不是最好的源。比如我一直以为阿里云的源很好，结果这次发现，极其地慢，我确认在<code>update</code>时走的是<code>cn.xxx</code>，但依旧只有十几 k。</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="robustestrecommend-for-newbie-way-在softwares--update里修改-server">robustest/recommend-for-newbie way: 在<code>softwares &amp; update</code>里修改 server<a class="hash-link" href="#robustestrecommend-for-newbie-way-在softwares--update里修改-server" title="标题的直接链接">​</a></h5><p>第二种办法就是在<code>softwares &amp; update</code>里自动测试最好的服务器，然后选择它。我测出来是<code>yun-idc</code>最好，但是因为我没用过，所以当时没考虑它，后来被阿里云折磨的不行了，就试了它，结果飞快，十兆每秒！</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="use-others-way-使用别人写好的-git-仓库进行配置">use others way: 使用别人写好的 git 仓库进行配置<a class="hash-link" href="#use-others-way-使用别人写好的-git-仓库进行配置" title="标题的直接链接">​</a></h5><p>第三种办法，由于我还没配好源，所以也没 git，而此时下载 git 又会极其地慢，所以也不考虑。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="2-update-apt">2. update apt<a class="hash-link" href="#2-update-apt" title="标题的直接链接">​</a></h4><p>!!!tip If the following commands warn that files are locked, then wait for some minutes, or use <code>lsof FILE</code> to have a check, more refer to: - <a href="https://zhuanlan.zhihu.com/p/126538251" target="_blank" rel="noopener noreferrer">解决 apt-get /var/lib/dpkg/lock-frontend 问题 - 知乎</a></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get upgrade</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-2-config-git">step 2. config git<a class="hash-link" href="#step-2-config-git" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt get git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git config --global user.name YOUR_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git config --global user.email YOUR_EMAIL</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-3-config-terminal">step 3. config terminal<a class="hash-link" href="#step-3-config-terminal" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="step-4-config-language">step 4. config language<a class="hash-link" href="#step-4-config-language" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-config-chinese-input-source-via-ibus">resolution 1: config chinese input source via ibus<a class="hash-link" href="#resolution-1-config-chinese-input-source-via-ibus" title="标题的直接链接">​</a></h4><p>ibus 输入方式和搜狗输入法之间不是很兼容，如果出现两者都无法输入中文的情况，建议根据<a href="https://www.jianshu.com/p/c04a4b03d30f" target="_blank" rel="noopener noreferrer">Ubuntu 18.04LTS 安装中文输入法以及快捷键设置 - 简书</a>先卸载搜狗输入法，确认 ibus 是可以用的，具体就是：<code>sudo apt-get remove fcitx*</code></p><p>确认以下配置：</p><ol><li>设置 - 地区与语言 - 输入法，中要添加包含智能拼音：</li></ol><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642268594063-def6bf87b276425161475a3ce55fbb05d8bb305b913ae5b39cc6e9708a6e32ae.png" class="img_vXGZ"><ol start="2"><li><p>语言支持中，要启用 ibus 方案</p><img loading="lazy" alt="picture 7" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642268691854-043dc8408c8326d13213bc92302c26f2d85b2be6a2892dbc58cf3d3349c9c8bc.png" class="img_vXGZ"><p>注销账号重新登录即可。</p></li><li><p>如果注销账号还不行， 就要尝试<code>sudo reboot</code>一下。</p></li></ol><h4 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-resolution-2-config-chinese-input-source-via-sougou">FIXME: resolution 2: config chinese input source via sougou<a class="hash-link" href="#fixme-resolution-2-config-chinese-input-source-via-sougou" title="标题的直接链接">​</a></h4><p>虽然按照官网走了好几遍，但始终还是没有配成这套方案，我也不知道什么原因。</p><p>而且 ibus 方案也必须在 fcitx 卸载之后才能正常使用。</p><p>参考官网：</p><ul><li><a href="https://pinyin.sogou.com/linux/" target="_blank" rel="noopener noreferrer">搜狗输入法 for linux</a></li></ul><p>更新：确保：</p><ol><li>输入源中只有一个英文（不要有 ibus 的中文，否则会干扰）</li></ol><img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642273187873-a0b1b31105b8e9fdea3ea0c576bc3e81e15cd6dec9c1dfb55a43d3a64ece559d.png" class="img_vXGZ"><ol start="2"><li>输入系统用<code>fcitx</code></li></ol><img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/notes-1642273215269-68b870e74dbe7fecdac78268144d73dc987602eddc24098c4e10763b540eb6bb.png" class="img_vXGZ"><p>再更新：算了吧，我个人觉得搜过 ubuntu 的 bug 是真地多，一会能用一会不能用，尤其是我在调成中文版能用后又调成英文版，然后用不了了，接着再怎么调中文版都用不了了，非常蛋疼。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-switch-language-input-source">how to switch language input source<a class="hash-link" href="#how-to-switch-language-input-source" title="标题的直接链接">​</a></h4><p>The best way is to directly install the Chinese version of ubuntu, since the Chinese feature is built-in.</p><p>However, what we download directly from the official ubuntu website, may not support chinese choice natively. So it highly depends on what distribution version of ubuntu we download.</p><p>ref:</p><ul><li><a href="https://blog.csdn.net/qq_31290747/article/details/94555163" target="_blank" rel="noopener noreferrer">(20 条消息) ubuntu 切换中文输入法<!-- -->_<em>g_y</em>的博客-CSDN 博客<!-- -->_<!-- -->ubuntu 切换中文输入法</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-language-to-english">how to change language to english<a class="hash-link" href="#how-to-change-language-to-english" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo export LANGUAGE=en_US.UTF-8 |  sudo tee -a ~/.bashrc</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/133318/how-do-i-change-the-language-via-a-terminal" target="_blank" rel="noopener noreferrer">command line - How do I change the language via a terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="improve-a-script-to-init-ubuntu-may-not-work">IMPROVE: a script to init ubuntu (may not work)<a class="hash-link" href="#improve-a-script-to-init-ubuntu-may-not-work" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version: 0.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">features:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1. disable sudo password so running commands faster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2. disable apt password so installing packages faster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3. enable arrow up/down to backward/forward search prefix command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4. auto change deb(apt) source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5. auto install zsh, config oh-my-zsh, set as the default shell, you may need to switch to bash when build android in case of errors, it's easy just to input `bash` in terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6. re-login to make these changes work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># !IMPORTANT: config global variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PASSWORD=" "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># write password variable into bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "export PASSWORD=$PASSWORD" &gt;&gt; ~/.bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># disable sudo password, ref: https://askubuntu.com/a/878705</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "$USER ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee -a /etc/sudoers.d/$USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1.5 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable backward/forward prefix commands search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo '"\e[A": history-search-backward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"\e[B": history-search-forward' &gt;&gt; ~/.inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bind -f ~/.inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 1.7 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change timezone, so that time display ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "export TZ='Asia/Shanghai'" &gt;&gt; ~/.profile # need relogin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 2 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># update apt and install packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change apt source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCE="http://mirrors.yun-idc.com/ubuntu/"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_SOURCES_LIST_FILE=/etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i.bak -r  "s|deb \S+|deb $APT_SOURCE|g" $APT_SOURCES_LIST_FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Y" | sudo apt update # need confirm but skipped since configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "Y" | sudo apt upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTALLED_PACKAGES="vim git htop zsh terminator"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $INSTALLED_PACKAGES | xargs sudo apt install -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 3 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># modify timezone (need relogin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export "TZ=Asia/Shanghai'\n" &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 4 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># configure zsh (installed in \$INSTALLED_PACKAGES) / oh-my-zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install oh-my-zsh (built-in backward search)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ref: https://ohmyz.sh/#install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 5 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># diy zsh based on 'oh-my-zsh'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add dynamical time display</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo 'PROMPT="%{$fg[yellow]%}%D{%Y/%m/%d} %D{%H:%M:%S} %{$fg[default]%}"$PROMPT' &gt;&gt; ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set zsh as the default terminal (need relogin!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chsh -s $(which zsh) # after configed sudo, no need to input password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable zsh changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># --- step 6 ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># re-login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-connection-ssh">BEST-PRACTICE: linux connection (<code>ssh</code>)<a class="hash-link" href="#best-practice-linux-connection-ssh" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-generate-public-keys">ssh generate public keys<a class="hash-link" href="#ssh-generate-public-keys" title="标题的直接链接">​</a></h3><p>ref: <a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key" target="_blank" rel="noopener noreferrer">https://git-scm.com/book/en/v2/Git-on-the-Server-Generating-Your-SSH-Public-Key</a></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -o</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-no-secretpassword">ssh no secret/password<a class="hash-link" href="#ssh-no-secretpassword" title="标题的直接链接">​</a></h3><div class="theme-admonition theme-admonition-tip alert alert--success admonition_O4V7"><div class="admonitionHeading_mM4K"><span class="admonitionIcon_Wsqb"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_wp6k"><p>最近遇到了发现即使加了 authorization_keys 还是不行，搜了很多帖子，大致理出了解决办法</p><p>首先可以在服务器上使用 <code>/usr/sbin/sshd -d -p 2222</code> 开启sshd调试，然后在client上使用 <code>ssh -vv xxx@xxx</code> 进行调试，主要看服务端报什么错，例如：<code>esca</code>算法不支持啥的，然后就意识到了是 ssh 版本太低，要升级。</p><p>不过由于 ssh-client 依赖于 ssh-server，所以也可能还比较难升，具体的办法可以用：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt purge openssh-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install openssh-client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install openssh-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart sshd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart ssh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>It's easy that if only you generate a <code>id_rsa.pub</code> and <code>scp</code> to your <code>~/.ssh/authorization_keys</code> then things all done.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="solution-1">Solution 1<a class="hash-link" href="#solution-1" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">username="xxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server="xxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file="~/.ssh/id_rsa.pub"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file | ssh $username@$server "cat - &gt;&gt; ~/.ssh/authorized_keys"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file | ssh aosp@192.168.1.242 "cat - &gt;&gt; ~/.ssh/authorized_keys"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="solution-2">Solution 2<a class="hash-link" href="#solution-2" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">username="xxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server="xxxxx"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file="~/.ssh/id_rsa.pub"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp $file $username@$server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh $username@$server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat $file &gt;&gt; .ssh/authorized_keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm $file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://alvinalexander.com/linux-unix/how-use-scp-without-password-backups-copy/" target="_blank" rel="noopener noreferrer">How to use the Linux ‘scp’ command without a password to make remote backups | alvinalexander.com</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ssh-keep-connection-alive">ssh keep connection alive<a class="hash-link" href="#ssh-keep-connection-alive" title="标题的直接链接">​</a></h3><p>the simplest way is to force the client to keep sending <!-- -->[a null]<!-- --> message(packet) to the server, in case that the server closed the connection beyond the time limitation, and what you need to do is just to modify 2 lines in your <code>/etc/ssh/ssh_config</code> file.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim /etc/ssh/ssh_config</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>change into these:</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServerAliveInterval 60</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>finally, maybe you should restart your client. If you use the mac, you can:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># restart-ssh, reference: https://gist.github.com/influx6/46c39709a67f09908cc7542ca444fca2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo launchctl stop com.openssh.sshd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo launchctl start com.openssh.sshd</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-env-management">BEST-PRACTICE: linux env management<a class="hash-link" href="#best-practice-linux-env-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-apt-source">how to change apt source<a class="hash-link" href="#how-to-change-apt-source" title="标题的直接链接">​</a></h3><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/104695/how-do-i-change-mirrors-in-ubuntu-server-from-regional-to-main" target="_blank" rel="noopener noreferrer">command line - How do I change mirrors in Ubuntu Server from regional to main? - Ask Ubuntu</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-manual-change-from-the-app-of-softwares--updates">resolution 1: manual change from the App of <code>Softwares &amp; Updates</code><a class="hash-link" href="#resolution-1-manual-change-from-the-app-of-softwares--updates" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-modify-the-configuration-manually-from-the-terminal">resolution 2: modify the configuration manually from the terminal<a class="hash-link" href="#resolution-2-modify-the-configuration-manually-from-the-terminal" title="标题的直接链接">​</a></h4><blockquote><p>CONCLUSION</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">MIRROR_FROM="us.archive.ubuntu.com"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIRROR_TO="mirrors.tuna.tsinghua.edu.cn"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APT_FILE="/etc/apt/sources.list"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i "s|${MIRROR_FROM}|${MIRROR_TO}|g" ${APT_FILE}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>DETAIL</p></blockquote><p>There are a few mirror servers can be used in China:</p><ul><li>mirrors.tuna.tsinghua.edu.cn</li><li>ftp.sjtu.edu.cn</li><li>mirrors.aliyun.com</li><li>mirrors.huaweicloud.com</li><li>mirrors.yun-idc.com</li><li>...</li></ul><p>The format of these mirrors may be as <code>http://${MIRROR_URL}/ubuntu/</code></p><p>And the default configuration of ubuntu servers are at <code>/etc/apt/sources.list</code>, with a copy of backup at <code>/etc/apt/sources.list.save</code>.</p><p>Here is what the <code>save</code> contents are:</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">// /etc/apt/sources.list.save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#deb cdrom:[Ubuntu 18.04.6 LTS _Bionic Beaver_ - Release amd64 (20210915)]/ bionic main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># See http://help.ubuntu.com/community/UpgradeNotes for how to upgrade to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># newer versions of the distribution.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Major bug fix updates produced after the final release of the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## distribution.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## team. Also, please note that software in universe WILL NOT receive any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## review or updates from the Ubuntu security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository is ENTIRELY UNSUPPORTED by the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## team, and may not be under a free licence. Please satisfy yourself as to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## your rights to use the software. Also, please note that software in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## multiverse WILL NOT receive any review or updates from the Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">updates multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-updates multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## N.B. software from this repository may not have been tested as</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## extensively as that contained in the main release, although it includes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## newer versions of some series which may provide useful features.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Also, please note that software in backports WILL NOT receive any review</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## or updates from the Ubuntu security team.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//us.archive.ubuntu.com/ubuntu/ bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backports main restricted universe multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://us.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## Uncomment the following two lines to add software from Canonical's</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 'partner' repository.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## This software is not part of Ubuntu, but is offered by Canonical and the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## respective vendors as a service to Ubuntu users.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb http://archive.canonical.com/ubuntu bionic partner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://archive.canonical.com/ubuntu bionic partner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security main restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security main restricted</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security universe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security universe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//security.ubuntu.com/ubuntu bionic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">security multiverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deb-src http://security.ubuntu.com/ubuntu bionic-security multiverse</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-whats-the-os-platform">how to know what's the os platform<a class="hash-link" href="#how-to-know-whats-the-os-platform" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># mac: Darwin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if platform is mac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [[ $(uname) == Darwin ]];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">then XXX;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else YYY;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/3466166/how-to-check-if-running-in-cygwin-mac-or-linux" target="_blank" rel="noopener noreferrer">bash - How to check if running in Cygwin, Mac or Linux? - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-configure-python-environment">how to configure python environment<a class="hash-link" href="#how-to-configure-python-environment" title="标题的直接链接">​</a></h3><ol><li>install the python on the server, the version of which would better correspond with the one of the local in case of unexpected error caused by version difference</li><li>use <code>virtualenv</code> to create an env based on this python version named <code>venv_py</code> under this working directory</li><li>activate this env</li><li>use <code>pip</code> to install the <code>requirements.txt</code></li><li>run!</li></ol><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PY_VERSION=python3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install the target python version based on its version number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if you don't use these two lines, then you would suffer from `wget blablabla...` when you checked what the hell the python repo url is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install software-properties-common -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo add-apt-repository ppa:deadsnakes/ppa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install ${PY_VERSION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># use `virtualenv` to create and activate a new python env fast~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install virtualenv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virtualenv -p ${PY_VERSION} venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source venv_py/bin/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># install all the requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if you need to dump all the requirements of a python project used, you can use `pip freeze &gt; requirements.txt` so that a file named of `requirements.txt` would be generated under the current directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run our backend of `fastapi`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python main.py</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-cannot-use-sudo-apt-get-install-xxx-to-install-packages">✅ cannot use <code>sudo apt-get install xxx</code> to install packages<a class="hash-link" href="#-cannot-use-sudo-apt-get-install-xxx-to-install-packages" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cd /var/lib/dpkg/updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf ./*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get disk-upgrade # it may cost a little of time</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><p>I changed the suggestion in this article from <code>rm -r</code> to <code>rm -rf</code>, otherwise not successful.</p><ul><li><a href="https://www.codeprj.com/blog/a352621.html" target="_blank" rel="noopener noreferrer">E:dpkg was interrupted, you must manually run'dpkg 配置'to correct the problem. - 码上快乐</a></li></ul><p>This discussion seems wonderful but didn't get my problem solved.</p><ul><li><a href="https://askubuntu.com/questions/410045/the-package-lists-or-status-file-could-not-be-parsed-or-opened" target="_blank" rel="noopener noreferrer">apt - "The package lists or status file could not be parsed or opened" - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-file-system-management">BEST-PRACTICE: linux file system management<a class="hash-link" href="#best-practice-linux-file-system-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="mkdir-if-not-exist">mkdir if not exist<a class="hash-link" href="#mkdir-if-not-exist" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://pubs.opengroup.org/onlinepubs/009695399/utilities/mkdir.html" target="_blank" rel="noopener noreferrer">mkdir</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ls-and-delete-files">ls and delete files<a class="hash-link" href="#ls-and-delete-files" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ls | grep STR | xargs rm -f</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>WARNING! Since the operation pipeline is silent, <a href="https://stackoverflow.com/questions/20858524/delete-a-list-of-files-with-find-and-grep#:~:text=you%20are%20likely%20to%20remove%20files%20that%20you%20did%20not%20intend%20to%20remove" target="_blank" rel="noopener noreferrer">you are likely to remove files that you did not intend to remove</a>.</p><p>Hence, you'd better use <code>ls | grep STR</code> first to check whether all the files to remove meet your expectation.</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fastest-delete-file">fastest delete file<a class="hash-link" href="#fastest-delete-file" title="标题的直接链接">​</a></h3><p>Don't bother checking if the file exists, just try to remove it.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">rm -f PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install dialog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm PATH 2&gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -name 'test'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ "$BLEG" != xxx ]; then command; fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"hello"</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Test</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/31318068/shell-script-to-remove-a-file-if-it-already-exist/31318262" target="_blank" rel="noopener noreferrer">shell script to remove a file if it already exist - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-show-absolute-path-of-file-from-relative">how to show absolute path of file from relative<a class="hash-link" href="#how-to-show-absolute-path-of-file-from-relative" title="标题的直接链接">​</a></h3><p>I cannot use <code>brew install realpath</code> like their <code>apt install realpath</code>, but I can use <code>realpath</code>, which may be pre-built-in.</p><p>Plus, later I saw that maybe realpath is a submodule of mac package, which is named as <code>findutils</code>.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">realpath FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/4175264/how-to-retrieve-absolute-path-given-relative" target="_blank" rel="noopener noreferrer">bash - How to retrieve absolute path given relative - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-copy-file-into-clipboard">how to copy file into clipboard<a class="hash-link" href="#how-to-copy-file-into-clipboard" title="标题的直接链接">​</a></h3><p>core ref: <a href="https://apple.stackexchange.com/a/15327" target="_blank" rel="noopener noreferrer">https://apple.stackexchange.com/a/15327</a></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="its-easy-to-copy-a-text-file">it's easy to copy a text file<a class="hash-link" href="#its-easy-to-copy-a-text-file" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbcopy &lt; FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># paste to command line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbpaste</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># paste to a new file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pbpaste &gt; FILE2</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But attention, the <code>pbpaste</code> would cause corruption when deals with binary file.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="but-it-cannot-be-done-for-a-binary-file">but it cannot be done for a binary file<a class="hash-link" href="#but-it-cannot-be-done-for-a-binary-file" title="标题的直接链接">​</a></h4><p>Since the traditional <code>command + c | command + v</code> is just copy the reference of file into clipboard, instead of the content itself, we had no way to use <code>pbcopy</code> to copy a file, and then use <code>command + v</code> to paste at another place.</p><p>A solution is to use osascript.</p><div class="language-osascript codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-osascript codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/osascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on run args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set abs_path to do shell script "/usr/local/bin/greadlink -f -- " &amp; (first item of args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set the clipboard to POSIX file abs_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://apple.stackexchange.com/questions/15318/how-to-use-terminal-to-copy-a-file-to-the-clipboard" target="_blank" rel="noopener noreferrer">mac - How to use terminal to copy a file to the clipboard? - Ask Different</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-show-file-size">how to show file size<a class="hash-link" href="#how-to-show-file-size" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># -l show detail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -h show 'human readable size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -lh FILE/DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.tutorialrepublic.com/faq/how-to-make-ls-command-to-show-file-sizes-in-megabytes-in-ubuntu.php" target="_blank" rel="noopener noreferrer">How to Make ls Command to Show File Sizes in Megabytes in Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-compare-between-files-diff--vimdiff">how to compare between files (<code>diff</code> &amp; <code>vimdiff</code>)<a class="hash-link" href="#how-to-compare-between-files-diff--vimdiff" title="标题的直接链接">​</a></h3><ul><li>see: <a href="https://stackoverflow.com/questions/17195308/unix-diff-side-to-side-results" target="_blank" rel="noopener noreferrer">bash - unix diff side-to-side results? - Stack Overflow</a></li></ul><p>There is a few of <code>diff</code> commands for us to choose.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-diff-f1-f2">resolution 1: <code>diff F1 F2</code><a class="hash-link" href="#resolution-1-diff-f1-f2" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517649112-cb2bf00d7a0d7d954fdc039c3862869a96a67c75fc4190101616cd5b3ad0495a.png" alt="picture 9" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-diff--y-f1-f2-or-sdiff-f1-f2">resolution 2: <code>diff -y F1 F2</code> or <code>sdiff F1 F2</code><a class="hash-link" href="#resolution-2-diff--y-f1-f2-or-sdiff-f1-f2" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517708938-fd8d1056dcc311fca0ff60316445a2fea77f670b4d7353cea9d6034775beb75a.png" alt="picture 10" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-3-vimdiff-f1-f2">resolution 3: <code>vimdiff F1 F2</code><a class="hash-link" href="#resolution-3-vimdiff-f1-f2" title="标题的直接链接">​</a></h4><p>It's awesome! Isn't it?</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642517738027-4beec462aa9bda3ff2127c563de64a20d8703edc7774603372fce03807992a96.png" alt="picture 12" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="todo-resolution-4-git-diff">TODO: resolution 4: git diff<a class="hash-link" href="#todo-resolution-4-git-diff" title="标题的直接链接">​</a></h4><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-how-to-copymove-directory-files-correctly-to-soft-links-under-target-directory-without-affecting-git">FIXME: how to copy/move directory files correctly to soft links under target directory without affecting git?<a class="hash-link" href="#fixme-how-to-copymove-directory-files-correctly-to-soft-links-under-target-directory-without-affecting-git" title="标题的直接链接">​</a></h3><p>example:</p><p>When I zipped one modified <code>frameworks/native</code> directory to be e.g. <code>RAW</code>, and then reset the <code>frameworks/native</code> to be the init.</p><p>Then I move all the files under <code>RAW</code> to <code>frameworks/native</code> with the command:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp -r RAW/* TARGET/frameworks/native/</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error arose up since there are soft links under <code>frameworks/native</code>, such as <code>libs/ui</code> which is indeed <code>libs/ui -&gt; XXX/ui</code>.</p><p>However, in my zipped file of <code>RAW</code>, the links seemingly have turned to be the real files/dirs, which introduced the problem <code>directory --&gt; non-directory</code>.</p><p>The wanted effect is copying/moving all the files under conflicted directory to where they should be.</p><p>However, the git marked those files as <code>TypeChange</code>...</p><p>ref:</p><ul><li><p><a href="https://superuser.com/questions/1395407/cp-cannot-overwrite-directory-with-non-directory/1395410" target="_blank" rel="noopener noreferrer">linux - cp: cannot overwrite directory with non-directory - Super User</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/555985/cp-recursively-into-a-directory-that-symlinks-to-dirs-of-same-name-as-in-source" target="_blank" rel="noopener noreferrer">cp recursively into a directory that symlinks to dirs of same name as in source - Unix &amp; Linux Stack Exchange</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-disk-management">BEST-PRACTICE: linux disk management<a class="hash-link" href="#best-practice-linux-disk-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ncdu-disk-space-tui"><code>ncdu</code>, disk space tui<a class="hash-link" href="#ncdu-disk-space-tui" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="baobab-disk-space-gui"><code>baobab</code>, disk space gui<a class="hash-link" href="#baobab-disk-space-gui" title="标题的直接链接">​</a></h3><p>ref:</p><ul><li><p><a href="https://askubuntu.com/questions/73160/how-do-i-find-the-amount-of-free-space-on-my-hard-drive" target="_blank" rel="noopener noreferrer">disk usage - How do I find the amount of free space on my hard drive? - Ask Ubuntu</a></p></li><li><p><a href="https://formulae.brew.sh/formula/baobab" target="_blank" rel="noopener noreferrer">baobab — Homebrew Formulae</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="install-problem">install problem<a class="hash-link" href="#install-problem" title="标题的直接链接">​</a></h4><p>When installing <code>ncdu</code>, error ocurred: <a href="https://stackoverflow.com/questions/44678437/no-such-file-or-directory-rb-sysopen-ruby" target="_blank" rel="noopener noreferrer">No such file or directory @ rb_sysopen ruby - Stack Overflow</a></p><p>The reason is that some dependency is missing, we can first install it and then install the target.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install librsvg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install baobab</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="effects">effects<a class="hash-link" href="#effects" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642600987157-8df330aac5a1fedd7d6c5f6d46f98256fedfcfa18b3f4f3ba05914fc06e19ac4.png" alt="picture 7" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-shells-management">BEST-PRACTICE: linux shells management<a class="hash-link" href="#best-practice-linux-shells-management" title="标题的直接链接">​</a></h2><p>ref:</p><p>this article is enough and recommended:</p><ul><li><p><a href="https://www.cyberciti.biz/faq/how-to-change-shell-to-bash/" target="_blank" rel="noopener noreferrer">How To Change Shell To Bash in Linux / Unix - nixCraft</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/140286/how-to-find-list-of-available-shells-by-command-line" target="_blank" rel="noopener noreferrer">How to find list of available shells by command-line? - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://www.cyberciti.biz/tips/how-do-i-find-out-what-shell-im-using.html" target="_blank" rel="noopener noreferrer">How do I find out what shell I am using on Linux/Unix? - nixCraft</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="list-all-the-shells">list all the shells<a class="hash-link" href="#list-all-the-shells" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /etc/shells # list valid login shells</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/rbash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/dash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="background-sh-is-different-with-bash">background: <code>sh</code> is different with <code>bash</code><a class="hash-link" href="#background-sh-is-different-with-bash" title="标题的直接链接">​</a></h3><p>When I write <code>source</code> in shell script, and run by <code>sh xx.sh</code>, then it failed with <code>no permission</code>.</p><p>However, when I use <code>bash xx.sh</code>, then everything runs well.</p><p>Thus, the <code>sh</code> definitely doesn't equal as <code>bash</code>, and it seems that function of <code>sh</code> is the subset of <code>bash</code>.</p><p>If so, why I still need to use <code>sh</code>? Just for short?</p><img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640152196813-linux-howto-84174e9e7dbb6fcc489b015f68e1c88b23fc19874bfcba40c3171f17cc8051a1.png" width="480" class="img_vXGZ"><p>ref: <a href="https://stackoverflow.com/a/48785960/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/48785960/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="see-whats-the-current-shell">see what's the current Shell<a class="hash-link" href="#see-whats-the-current-shell" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">[1:42:41]:~$ echo $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1:43:25]:~$ echo $0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1:43:29]:~$ ps -p $$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PID TTY          TIME CMD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 29657 pts/2    00:00:00 zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="switch-shell">switch shell<a class="hash-link" href="#switch-shell" title="标题的直接链接">​</a></h3><p>You can change your default shell using the chsh (“change shell” ) command as follows.</p><p>The syntax is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s {shell-name-here}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s {shell-name-here} {user-name-here}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s /bin/bash $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="set-zsh-as-the-default-terminal-need-re-login">set zsh as the default terminal (need re-login)<a class="hash-link" href="#set-zsh-as-the-default-terminal-need-re-login" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s $(which zsh)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://askubuntu.com/questions/131823/how-to-make-zsh-the-default-shell" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/131823/how-to-make-zsh-the-default-shell</a></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-terminal-management">BEST-PRACTICE: linux terminal management<a class="hash-link" href="#best-practice-linux-terminal-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-the-terminal-cannot-up-down-after-editing">✅ the terminal cannot up down after editing<a class="hash-link" href="#-the-terminal-cannot-up-down-after-editing" title="标题的直接链接">​</a></h3><p>This is a problem confused me for a long time.</p><p>Today, I finally knows what's the hell at: <a href="https://stackoverflow.com/questions/18489216/how-to-scroll-up-and-down-in-sliced-screen-terminal" target="_blank" rel="noopener noreferrer">linux - How to scroll up and down in sliced "screen" terminal - Stack Overflow</a></p><p>Anyway, terminal is hard to learn, I just know <code>control + a</code> can help me exit the so-called copy mode.</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="todo-bind-option--arrow-to-jump-word-in-zsh-on-ubuntu-vmware-on-macos">TODO: bind <code>option + arrow</code> to jump word in zsh on ubuntu vmware on MacOS<a class="hash-link" href="#todo-bind-option--arrow-to-jump-word-in-zsh-on-ubuntu-vmware-on-macos" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li>✨ <a href="https://help.ubuntu.com/stable/ubuntu-help/shell-keyboard-shortcuts.html.en" target="_blank" rel="noopener noreferrer">Useful keyboard shortcuts</a></li><li><a href="https://www.google.com/search?newwindow=1&amp;sxsrf=AOaemvJocqqP64PM0tOaO5QuVGhGgwR1kw%3A1643272448532&amp;lei=AFnyYY_8H8G4mAWLj7C4Cg&amp;q=zsh%20jump%20word&amp;ved=2ahUKEwiP_MD0wtH1AhVBHKYKHYsHDKcQsKwBKAN6BAg-EAQ&amp;biw=1629&amp;bih=945&amp;dpr=2.2" target="_blank" rel="noopener noreferrer">zsh jump word - Google Search</a></li><li><a href="https://superuser.com/questions/427163/altarrow-moving-between-words-in-zsh-and-iterm2" target="_blank" rel="noopener noreferrer">keyboard shortcuts - ALT+arrow moving between words in zsh and iTerm2 - Super User</a></li><li><a href="https://support.apple.com/en-hk/guide/terminal/trmlshtcts/mac" target="_blank" rel="noopener noreferrer">Keyboard shortcuts in Terminal on Mac - Apple Support (HK)</a></li><li><a href="https://superuser.com/questions/349439/how-to-bind-command-key-in-zsh" target="_blank" rel="noopener noreferrer">key binding - How to bind command key in zsh? - Super User</a></li><li><a href="https://gist.github.com/YumaInaura/27bb1f79881a63bed2fb9635cbaed73b" target="_blank" rel="noopener noreferrer">Zsh — Mac OS option key for bindkey</a></li><li><a href="https://www.google.com/search?q=what+key+i%27m+pressing&amp;oq=what+key+i+am&amp;aqs=chrome.1.69i57j0i10j0i22i30l8.6503j0j4&amp;sourceid=chrome&amp;ie=UTF-8" target="_blank" rel="noopener noreferrer">what key i'm pressing - Google Search</a></li><li><a href="https://en.key-test.ru/" target="_blank" rel="noopener noreferrer">"Key-Test" - keyboard test online</a></li><li><a href="https://unix.stackexchange.com/questions/58870/ctrl-left-right-arrow-keys-issue" target="_blank" rel="noopener noreferrer">zsh - Ctrl + left/right arrow keys issue - Unix &amp; Linux Stack Exchange</a></li><li><a href="https://stackoverflow.com/questions/12382499/looking-for-altleftarrowkey-solution-in-zsh" target="_blank" rel="noopener noreferrer">shell - Looking for ALT+LeftArrowKey solution in zsh - Stack Overflow</a></li><li><a href="https://unix.stackexchange.com/questions/94331/how-can-i-delete-a-word-backward-at-the-command-line-bash-and-zsh" target="_blank" rel="noopener noreferrer">keyboard shortcuts - How can I delete a word backward at the command line (bash and zsh)? - Unix &amp; Linux Stack Exchange</a></li><li><a href="https://askubuntu.com/questions/1017287/how-to-delete-words-in-the-terminal-with-ctrl-backspace-like-in-the-rest-of-ubun" target="_blank" rel="noopener noreferrer">command line - How to delete words in the terminal with Ctrl-Backspace like in the rest of Ubuntu? - Ask Ubuntu</a></li><li><a href="https://askubuntu.com/questions/162247/why-does-ctrl-left-arrow-not-skip-words" target="_blank" rel="noopener noreferrer">12.04 - Why does ctrl + left arrow not skip words? - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-commands-management">BEST-PRACTICE: linux commands management<a class="hash-link" href="#best-practice-linux-commands-management" title="标题的直接链接">​</a></h2><blockquote><p>⚠️</p><ol><li>be careful to use `<!-- -->`<!-- -->` in terminal / shell since it's would be treated as executable commands: <img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1641501462043-6790c46051fa5db1246b560e795c5b1737d5e508faf7a9247b1c52e1ce4abdbc.png" class="img_vXGZ"><br>see: <a href="https://blog.csdn.net/Luckiers/article/details/103501168" target="_blank" rel="noopener noreferrer">(20 条消息) shell 基础知识-echo 及单引号、反引号和双引号详解<!-- -->_<!-- -->Luckiers 的博客-CSDN 博客<!-- -->_<!-- -->echo 单引号和双引号</a></li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-auto-input-in-command">how to auto input in command<a class="hash-link" href="#how-to-auto-input-in-command" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-input-password-for-sudo-commands">auto input password for sudo commands<a class="hash-link" href="#auto-input-password-for-sudo-commands" title="标题的直接链接">​</a></h4><blockquote><p>sparkles: Use <code>sudo -S</code> to read input from stdin.</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "$USER ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee -a /etc/sudoers.d/$USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://superuser.com/questions/67765/sudo-with-password-in-one-command-line" target="_blank" rel="noopener noreferrer">shell - sudo with password in one command line? - Super User</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-yes-for-some-command-yes--">auto yes for some command (<code>yes | </code>)<a class="hash-link" href="#auto-yes-for-some-command-yes--" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yes | COMMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yes | sh ./install.sh # install oh-my-zsh</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/7642674/how-do-i-script-a-yes-response-for-installing-programs/34176780" target="_blank" rel="noopener noreferrer">linux - How do I script a "yes" response for installing programs? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="auto-yes-for-apt-installing-packages--y">auto yes for <code>apt</code> installing packages (<code>-y</code>)<a class="hash-link" href="#auto-yes-for-apt-installing-packages--y" title="标题的直接链接">​</a></h4><p>Just add a <code>-y</code> in the command.</p><p>Example:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y htop</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/448358/apt-get-install-with-assume-yes-is-still-prompting-me-to-install-dependencies" target="_blank" rel="noopener noreferrer">apt-get install with --assume-yes is still prompting me to install dependencies - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-search-commands-by-prefix-history-search-backwardforward">how to search commands by prefix (<code>history-search-backward/forward</code>)<a class="hash-link" href="#how-to-search-commands-by-prefix-history-search-backwardforward" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ~/.inputrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Respect default shortcuts.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$include /etc/inputrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># choice 1: recommended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">"\e[A"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backward     </span><span class="token comment" style="color:#999988;font-style:italic"># arrow up      --&gt; backward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">"\e[B"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forward      </span><span class="token comment" style="color:#999988;font-style:italic"># arrow down    --&gt; forward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># choice 2: if prefer to the page up/down</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">"\e[5~"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">backward    </span><span class="token comment" style="color:#999988;font-style:italic"># page up       --&gt; backward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">"\e[6~"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> history</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">forward     </span><span class="token comment" style="color:#999988;font-style:italic"># page down     --&gt; forward</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>;warning: you should <strong>Close and re-open all terminals for the new behavior to become effective.</strong></p></blockquote><p>ref:</p><ul><li><p><a href="https://askubuntu.com/a/59855" target="_blank" rel="noopener noreferrer">https://askubuntu.com/a/59855</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/231605/search-for-a-previous-command-with-the-prefix-i-just-typed" target="_blank" rel="noopener noreferrer">bash - Search for a previous command with the prefix I just typed - Unix &amp; Linux Stack Exchange</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-repeat-command">how to repeat command<a class="hash-link" href="#how-to-repeat-command" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">#  only show the last result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch -n X command # X: X seconds; command may need quotes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># show all the result history</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while true; do command; sleep X; done; # command may need quotes</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/430382/repeat-a-command-every-x-interval-of-time-in-terminal" target="_blank" rel="noopener noreferrer">bash - Repeat a command every x interval of time in terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-use-variable-as-multi-args">how to use variable as multi args<a class="hash-link" href="#how-to-use-variable-as-multi-args" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># when there's only one arg as a variable, it's ok to directly use it, and the following two methods are equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGE_TO_INSTALL="vim"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGE_TO_INSTALL=vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y $PACKAGE_TO_INSTALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># However, if there are multi args as a variable, we need to use [`echo`](https://stackoverflow.com/a/30061925/9422455) to escape the 'hidden quotes' if I didn't understand wrongly. And also, the quotes can't be omitted, or use slashes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL="vim git htop zsh terminator"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL=vim\ git\ htop\ zsh\ terminator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install -y $(echo $INSTALLED_PACKAGES)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Since the `echo` is not safe, another way is to use [`xargs`](https://stackoverflow.com/a/51242645/9422455), which seems more professional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PACKAGES_TO_INSTALL="vim git htop zsh terminator"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $PACKAGE_TO_INSTALL | xargs sudo apt install -y</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><p><a href="https://stackoverflow.com/questions/9733338/shell-script-remove-first-and-last-quote-from-a-variable" target="_blank" rel="noopener noreferrer">string - Shell script - remove first and last quote (") from a variable - Stack Overflow</a></p></li><li><p><a href="https://stackoverflow.com/questions/30061682/bash-send-string-argument-as-multiple-arguments" target="_blank" rel="noopener noreferrer">bash send string argument as multiple arguments - Stack Overflow</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/637496/escaping-quotes-inside-a-quoted-string" target="_blank" rel="noopener noreferrer">shell - Escaping quotes inside a quoted string - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="http://mywiki.wooledge.org/BashFAQ/050" target="_blank" rel="noopener noreferrer">BashFAQ/050 - Greg's Wiki</a></p></li><li><p><a href="https://stackoverflow.com/questions/5819423/bash-variables-with-spaces" target="_blank" rel="noopener noreferrer">Bash variables with spaces - Stack Overflow</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/327784/how-to-assign-a-string-with-multiple-spaces-to-a-variable-in-bash" target="_blank" rel="noopener noreferrer">shell script - How to assign a string with multiple spaces to a variable in bash? - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://stackoverflow.com/questions/7454526/variable-containing-multiple-args-with-quotes-in-bash" target="_blank" rel="noopener noreferrer">Variable containing multiple args with quotes in Bash - Stack Overflow</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-set-an-alias">how to set an alias<a class="hash-link" href="#how-to-set-an-alias" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-in-terminal">resolution 1: in terminal<a class="hash-link" href="#resolution-1-in-terminal" title="标题的直接链接">​</a></h4><blockquote><p>⚠️ this solution only works upon the next command, which can work immediately when executed in shell script file</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># don't add any other characters after alias in order to catch bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias sed=gsed</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-write-into-bash_aliases">resolution 2: write into <code>~/.bash_aliases</code><a class="hash-link" href="#resolution-2-write-into-bash_aliases" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># ~/.bash_aliases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alias update='sudo yum update'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>⚠️ this solution needs to ensure the <code>.bash_aliases</code> enabled in <code>.bashrc</code></p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-howto-1643117544205-afe713493b26becfe498fda953bdc5c1d098accaf07b4e4b6b5e117b4d3671a1.png" alt="picture 47" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-resolution-3-use-bash_aliases-with-zsh">✨ resolution 3: use <code>.bash_aliases</code> with <code>zsh</code><a class="hash-link" href="#-resolution-3-use-bash_aliases-with-zsh" title="标题的直接链接">​</a></h4><p>Just add one line in <code>~/.zshrc</code>:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/.bash_aliases</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.cyberciti.biz/faq/create-permanent-bash-alias-linux-unix/" target="_blank" rel="noopener noreferrer">How to create a permanent Bash alias on Linux/Unix - nixCraft</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="unalias">unalias<a class="hash-link" href="#unalias" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unalias logout</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://www.tecmint.com/create-alias-in-linux/" target="_blank" rel="noopener noreferrer">How to Create and Use Alias Command in Linux</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-compare-between-outputs-from-two-commands">how to compare between outputs from two commands<a class="hash-link" href="#how-to-compare-between-outputs-from-two-commands" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">diff &lt;(ls old) &lt;(ls new)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/229447/how-do-i-diff-the-output-of-two-commands" target="_blank" rel="noopener noreferrer">How do I diff the output of two commands? - Ask Ubuntu</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-accounts-management">BEST-PRACTICE: linux accounts management<a class="hash-link" href="#best-practice-linux-accounts-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="init-user-with-root-config">init user with root config<a class="hash-link" href="#init-user-with-root-config" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">脚本：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER_=chuanmx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOME_=/home/$USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add user with password and home directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "$USER_\n$USER_" | sudo -S -k passwd $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -a -G dev $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mkdir $HOME_/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp -rf ~/.oh-my-zsh $HOME_/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp  ~/.zshrc $HOME_/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chsh --shell /bin/zsh $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable user grant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R $USER_:$USER_ $HOME_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># avoid typing password when using sudo command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "$USER_  ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/$USER_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-create-user">how to create user<a class="hash-link" href="#how-to-create-user" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># create user with a home directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls -la /home/$USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create user [under root]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd $USER_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create passwd [under root]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd $USER_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-log-out">how to log out<a class="hash-link" href="#how-to-log-out" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-1110-and-above">resolution 1 (11.10 and above)<a class="hash-link" href="#resolution-1-1110-and-above" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">gnome-session-quit</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2">resolution 2<a class="hash-link" href="#resolution-2" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/15795/how-can-you-log-out-via-the-terminal" target="_blank" rel="noopener noreferrer">command line - How can you log out via the terminal? - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="set-a-shorter-password-for-ubuntu">set a shorter password for ubuntu<a class="hash-link" href="#set-a-shorter-password-for-ubuntu" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd &lt;USER&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-hwoto-1642479990429-35424184b62d147dc0744f2bcb9bca97f27b9efc9df47373a458c76442b30003.png" alt="picture 7" class="img_vXGZ"></p><ul><li><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/180402/how-to-set-a-short-password-on-ubuntu" target="_blank" rel="noopener noreferrer">https://askubuntu.com/questions/180402/how-to-set-a-short-password-on-ubuntu</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-net-management">BEST-PRACTICE: linux net management<a class="hash-link" href="#best-practice-linux-net-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-my-public-ip-address">how to know my public ip address<a class="hash-link" href="#how-to-know-my-public-ip-address" title="标题的直接链接">​</a></h3><ul><li>resolution 1:</li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># https://apple.stackexchange.com/questions/20547/how-do-i-find-my-ip-address-from-the-command-line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl ifconfig.me</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>resolution 2:</li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># https://www.digitalocean.com/community/tutorials/how-to-configure-remote-access-for-mongodb-on-ubuntu-20-04#:~:text=curl%20%2D4%20icanhazip.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -4 icanhazip.com</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-monitor-network-traffic">how to monitor network traffic<a class="hash-link" href="#how-to-monitor-network-traffic" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install nethogs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nethogs</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/368002/network-usage-top-htop-on-linux" target="_blank" rel="noopener noreferrer">networking - Network usage top/htop on Linux - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fixme-check-proxy">FIXME: check proxy<a class="hash-link" href="#fixme-check-proxy" title="标题的直接链接">​</a></h3><p>In <a href="https://releases.ubuntu.com/18.04/" target="_blank" rel="noopener noreferrer">Ubuntu 18.04.6 LTS (Bionic Beaver)</a>, it introduced two methods to see what/which proxies are we using:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">## approach 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $http_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## approach 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env | grep -i proxy</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, when I configured the proxies in <code>Manual Proxy</code>, I am surprised to find nothing using either commands in the above, while the ping to <code>google.com</code> does work so that I use it as the measure then.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ping google.com</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And another wield thing is before the system was restarted, the <code>env | grep -i proxy</code> even shows duplicated results and the change in <code>Manual Proxy</code> doesn't work, which is quite confusing.</p><p>Maybe we can do more tests later.</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-datetime-management">BEST-PRACTICE: linux date/time management<a class="hash-link" href="#best-practice-linux-datetime-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-format-date-in-terminal">how to format date in terminal<a class="hash-link" href="#how-to-format-date-in-terminal" title="标题的直接链接">​</a></h3><blockquote><p>⚠️</p><ol><li>the space in formatter should be using <code>\ </code> or anything other ways</li><li><code>date</code>是一个函数，不是变量，变量采用<code>$XX</code>或者<code>${XX}</code>的形式，但是函数要用<code>$(XX)</code>，并且不能在字符串中</li></ol></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># directly output date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date +%Y-%m-%d\ %H:%M:%S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output date into variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T='the date is '$(date +%Y-%m-%d\ %H:%M:%S)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/549415/how-to-concatenate-a-date-variable-and-string-variable-in-unix" target="_blank" rel="noopener noreferrer">shell script - How to concatenate a date variable and string variable in unix? - Unix &amp; Linux Stack Exchange</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-change-timezone-and-time">how to change timezone (and time)<a class="hash-link" href="#how-to-change-timezone-and-time" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-conclusion-directly-export">resolution 1 (conclusion): directly export<a class="hash-link" href="#resolution-1-conclusion-directly-export" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo "export TZ='Asia/Shanghai'\n" &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo pkill -u $USER --force</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-detail-choose-following-directions">resolution 2 (detail): choose following directions<a class="hash-link" href="#resolution-2-detail-choose-following-directions" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># check current time, as well as timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">date -R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># if the ending is `+0800`, then it's ok, otherwise you need to change (e.g. `-0800`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># change timezone (just choose as directed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tzselect</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And finally you will get a command suggestion to write into profile file, that is <a href="#solution-1-directly-export">#solution-1-directly-export</a></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-system-management">BEST-PRACTICE: linux system management<a class="hash-link" href="#best-practice-linux-system-management" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-a-stop-job-is-running-for-session-c2-of-user--1min-30s">✅ <code>A stop job is running for Session c2 of user ... (1min 30s)</code><a class="hash-link" href="#-a-stop-job-is-running-for-session-c2-of-user--1min-30s" title="标题的直接链接">​</a></h3><blockquote><p>resolution</p></blockquote><ol><li>restart system</li><li><code>journalctl -p5</code></li><li>search <code>timed out. Killing</code></li><li>analyze the target process of <code>Killing process 1234 (jack_thru) with signal SIGKILL.</code></li></ol><blockquote><p>⚠️ 注意，也有其他几种解决方案，比如装<code>watchdog</code>和缩短<code>timeout</code>时间的，这些都侵入性太高了，并且不是治本之策，所以还是得从 log 来分析原因找对应政策。尤其是装<code>watchdog</code>的方案，我简单看了一下，大致是每分钟检查一下系统的情况，但问题是，为什么很久以前系统就没有这种问题呢？那个时候也没装 <code>watchdog</code> 啊，所以对于这个问题，我们不能偷懒!</p></blockquote><p>.</p><blockquote><p>result</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-bugfix-1643550947015-7ed703f287400ec8593914f35740044149d43c47e7b97df89135a6ffff3681a5.png" alt="picture 9" class="img_vXGZ"></p><p>It tells me the last one is because of <code>adb</code>, since I do open the <code>adb</code> and not responding then.</p><p>And I also checked the last few times when <code>timed out</code>, but to find they are different.</p><p>So I confirmed the timeout error is temporary, since now I am not going to run any <code>adb</code>.</p><p>I tried to restart again, and the system does well which identified what I think.</p><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://unix.stackexchange.com/questions/273876/a-stop-job-is-running-for-session-c2-of-user/297318" target="_blank" rel="noopener noreferrer">systemd - A stop job is running for Session c2 of user - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://qastack.cn/unix/273876/a-stop-job-is-running-for-session-c2-of-user" target="_blank" rel="noopener noreferrer">用户的会话 c2 正在运行停止作业</a></p></li><li><p><a href="https://bbs.archlinux.org/viewtopic.php?id=264233" target="_blank" rel="noopener noreferrer">systemd stop job for Session 2 on shutdown / Newbie Corner / Arch Linux Forums</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="-----------------------------------">-----------------------------------<a class="hash-link" href="#-----------------------------------" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-linux-common-commands">BEST-PRACTICE: linux common commands<a class="hash-link" href="#best-practice-linux-common-commands" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtar">command:tar<a class="hash-link" href="#commandtar" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># x: extract, f: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xf FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># v: verbose, logging output, careful when extracting big files, e.g. AOSP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -vxf FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://linuxize.com/post/how-to-extract-unzip-tar-gz-file/" target="_blank" rel="noopener noreferrer">How to Extract (Unzip) Tar Gz File | Linuxize</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandperl">command:perl<a class="hash-link" href="#commandperl" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-use-perl-to-replace-multi-lines">how to use perl to replace multi-lines<a class="hash-link" href="#how-to-use-perl-to-replace-multi-lines" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">perl -0pe 's/search/replace/gms' file</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li><code>-0</code>: without the <code>-0</code> argument, Perl processes data line-by-line, which causes multiline searches to fail.</li><li><code>-p</code>: loop over all the lines of a file</li><li><code>-e</code>: execute the following arg as a perl script</li><li><code>/s</code>: changes the behavior of the dot metacharacter <code>.</code> so that it matches any character at all. Normally it matches anything except a newline "\n", and so treats the string as a single line even if it contains newlines.</li><li><code>/m</code>: modifies the caret <code>^</code> and dollar <code>$</code> metacharacters so that they match at newlines within the string, treating it as a multi-line string. Normally they will match only at the beginning and end of the string.</li><li><code>/g</code>: global replace(not sure)</li></ol><p>ref:</p><ul><li><p>explaining <code>-0</code>: <a href="https://stackoverflow.com/questions/1030787/multiline-search-replace-with-perl" target="_blank" rel="noopener noreferrer">Multiline search replace with Perl - Stack Overflow</a></p></li><li><p>explaining <code>/m | /s</code>: <a href="https://stackoverflow.com/questions/22962588/understanding-perl-regular-expression-modifers-m-and-s" target="_blank" rel="noopener noreferrer">regex - Understanding Perl regular expression modifers /m and /s - Stack Overflow</a></p></li></ul><p>special thanks to: <a href="https://unix.stackexchange.com/a/378991" target="_blank" rel="noopener noreferrer">Not sure if you know, but sed has a great feature where you do not need to use a / as the separator.</a></p><ul><li><p><a href="https://www.mankier.com/1/perl#Description" target="_blank" rel="noopener noreferrer">perl man page - perl-interpreter - General Commands</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/555948/replace-multi-line-string-with-multi-line-string-without-escaping-by-hand" target="_blank" rel="noopener noreferrer">perl - Replace multi line string with multi line string without escaping by hand - Unix &amp; Linux Stack Exchange</a></p></li><li><p><a href="https://www.runoob.com/perl/perl-regular-expressions.html" target="_blank" rel="noopener noreferrer">Perl 正则表达式 | 菜鸟教程</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/378990/find-and-replace-with-sed-with-slash-in-find-and-replace-string" target="_blank" rel="noopener noreferrer">quoting - find and replace with sed with slash in find and replace string - Unix &amp; Linux Stack Exchange</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandfind">command:find<a class="hash-link" href="#commandfind" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-ignore-case">how to ignore case<a class="hash-link" href="#how-to-ignore-case" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">find -iname</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/32155/find-command-how-to-ignore-case" target="_blank" rel="noopener noreferrer">Find command: how to ignore case? - Unix &amp; Linux Stack Exchange</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-specify-search-type">how to specify search type<a class="hash-link" href="#how-to-specify-search-type" title="标题的直接链接">​</a></h4><p>Use <code>-type</code> to specify the search type (default is <code>c</code> for <code>file</code>), here I used <code>d</code> for <code>directory</code>, ref: <a href="https://man7.org/linux/man-pages/man1/find.1.html#:~:text=true%20%20Always%20true.-,%2Dtype%20c,-File%20is%20of" target="_blank" rel="noopener noreferrer">find type</a></p><p>And then, when I search directory, it would search all the sub-folders with '/' concatenated, so I need to specify <code>-d 1</code> in order to only search the top current directory.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support find . -name '*electron*' -type d -d 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./electron-react-boilerplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./electron-react-typescript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support rm -rf electron-react-boilerplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  Application Support rm -rf electron-react-typescript</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir">how to exclude dir<a class="hash-link" href="#how-to-exclude-dir" title="标题的直接链接">​</a></h4><p>TODO: in fact, I really can't catch why <code>-prune</code> is combined with <code>-o</code> (or)</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. use `-not -path`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find -name "*.js` -not -path "./directory/*"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. use `-path xx -prune`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path ./misc -prune -o -name '*.txt' -print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. use multiple prune (need to add escaped bracket)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -type d \( -path ./dir1 -o -path ./dir2 -o -path ./dir3 \) -prune -o -name '*.txt' -print</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. use regex prune (-name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -type d -name node_modules -prune -o -name '*.json' -print</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/4210042/how-to-exclude-a-directory-in-find-command" target="_blank" rel="noopener noreferrer">linux - How to exclude a directory in find . command - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="todo-how-to-find-file-with-time-used">TODO: how to find file with time used<a class="hash-link" href="#todo-how-to-find-file-with-time-used" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-find-efficiency-comparison">tip: find efficiency comparison<a class="hash-link" href="#tip-find-efficiency-comparison" title="标题的直接链接">​</a></h4><p>Use a specified directory is the best and fastest;</p><p>If not, limit the <code>maxdepth</code> to a number small enough is also ok;</p><p>And then consider the directory prune.</p><p>Finally bared run is the worst.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find .imgs  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find .imgs -name   0.00s user 0.00s system 52% cpu 0.005 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 3  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 3 -name   0.01s user 0.05s system 70% cpu 0.079 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 4  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 4 -name   0.06s user 0.69s system 87% cpu 0.854 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 5  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 5 -name   0.14s user 1.86s system 93% cpu 2.137 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -maxdepth 6  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -maxdepth 6 -name   0.26s user 3.21s system 94% cpu 3.683 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find .  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -name   0.44s user 5.85s system 51% cpu 12.172 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -path './.imgs/*'  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path './.imgs/*' -name   0.46s user 5.93s system 51% cpu 12.299 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  hjxh_express_match git:(main) time find . -path './.imgs/*'  ! -path "**/node_modules/*"  -name readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./.imgs/readme-1641287704584-613d44afa250b17be45e5b366487d1dbd42939da44543700b5e7fbd7f6a8ca9e.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find . -path './.imgs/*' ! -path "**/node_modules/*" -name   0.46s user 5.91s system 51% cpu 12.268 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandgrep">command:grep<a class="hash-link" href="#commandgrep" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir---exclude-dirdir">how to exclude dir (<code>--exclude-dir=dir</code>)<a class="hash-link" href="#how-to-exclude-dir---exclude-dirdir" title="标题的直接链接">​</a></h4><p>Recent versions of GNU Grep (&gt;= 2.5.2) provide:</p><p><code>--exclude-dir=dir</code></p><p>which excludes directories matching the pattern dir from recursive directory searches.</p><p>So you can do:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">grep -R --exclude-dir=node_modules 'some pattern' /path/to/search</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/6565471/how-can-i-exclude-directories-from-grep-r" target="_blank" rel="noopener noreferrer">linux - How can I exclude directories from grep -R? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-limit-depth--maxdepth">how to limit depth (<code>-maxdepth</code>)<a class="hash-link" href="#how-to-limit-depth--maxdepth" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> find . -maxdepth 4 -type f -exec grep "11.0.0_r1" {}  \;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/111722/how-to-do-max-depth-search-in-ack-and-grep" target="_blank" rel="noopener noreferrer">How to do max-depth search in ack and grep? - Unix &amp; Linux Stack Exchange</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-grep-by-lines-context-is-much-faster-than-grep-by-words-context-and-even-better-for-output">tip: grep by lines context is MUCH FASTER than grep by words context, and even better for output<a class="hash-link" href="#tip-grep-by-lines-context-is-much-faster-than-grep-by-words-context-and-even-better-for-output" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb git:(main) ✗ time (cat release/build/mac/皇家小虎快递分析系统.app/Contents/Resources/app/dist/main/main.js | tr ";" "\n" | grep --context=3 'fake-database')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># var n=this&amp;&amp;this.__importDefault||function(e){return e&amp;&amp;e.__esModule?e:{default:e}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Object.defineProperty(t,"__esModule",{value:!0}),t.isDbFinished=t.initDbUpdateResult=t.initDbInsertResult=t.DB_UPDATE_DECLINED=t.DB_UPDATED=t.DB_INSERT_DUPLICATED=t.DB_INSERT_SUCCESS=t.DB_UNKNOWN=t.DB_TIMEOUT=t.DB_TABLE_NOT_EXISTED=t.prisma=void 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># const i=r(72298),a=`file:${n(r(71017)).default.join(i.app.getPath("userData"),"express_match.sqlite.db")}?connection_limit=1`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># process.env.DATABASE_URL=a,console.log({__dirname,rawDBPath:"file:dev.db?connection_limit=1",newDBPath:a}),t.prisma={erp:{create:()=&gt;{console.log("fake-database: creating one")},findMany:()=&gt;{console.log("fake-database: finding many")},upsert:()=&gt;{console.log("fake-database: upserting one")}}},t.DB_TABLE_NOT_EXISTED="DB_TABLE_NOT_EXISTED",t.DB_TIMEOUT="DB_TIMEOUT",t.DB_UNKNOWN="DB_UNKNOWN",t.DB_INSERT_SUCCESS="DB_INSERT_SUCCESS",t.DB_INSERT_DUPLICATED="DB_INSERT_DUPLICATED",t.DB_UPDATED="DB_UPDATED",t.DB_UPDATE_DECLINED="DB_UPDATE_DECLINED"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.initDbInsertResult=()=&gt;({nTotal:0,nInserted:0,nDuplicated:0,nTimeout:0,nUnknown:0,nTableNotExist:0})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.initDbUpdateResult=()=&gt;({nTotal:0,nUpdated:0,nDropped:0,nTimeout:0,nUnknown:0,nTableNotExist:0})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># t.isDbFinished=e=&gt;{let t=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">( cat  | tr ";" "\n" | grep --color=auto  --context=3 'fake-database'; )  0.20s user 0.01s system 121% cpu 0.169 total</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb git:(main) ✗ time ( grep -iEo '.{255}fake-database.{255}' release/build/mac/皇家小虎快递分析系统.app/Contents/Resources/app/dist/main/main.js | tr ';' '\n' )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># =`file:${n(r(71017)).default.join(i.app.getPath("userData"),"express_match.sqlite.db")}?connection_limit=1`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># process.env.DATABASE_URL=a,console.log({__dirname,rawDBPath:"file:dev.db?connection_limit=1",newDBPath:a}),t.prisma={erp:{create:()=&gt;{console.log("fake-database: creating one")},findMany:()=&gt;{console.log("fake-database: finding many")},upsert:()=&gt;{console.log("fake-database: upserting one")}}},t.DB_TABLE_NOT_EXISTED="DB_TABLE_NOT_EXISTED",t.DB_TIMEOUT="DB_TIMEOUT",t.DB_UNKNOWN="DB_UNKNOWN",t.DB_INSERT_SUCCESS="D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">( grep --color=auto --exclude-dir={.bzr,CVS,.git,.hg,.svn,.idea,.tox} -iEo  t)  3.27s user 0.01s system 99% cpu 3.279 total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="tip-grep-by-negative-captured-group-needs-to-use-ggrep">tip: grep by negative captured group needs to use <code>ggrep</code><a class="hash-link" href="#tip-grep-by-negative-captured-group-needs-to-use-ggrep" title="标题的直接链接">​</a></h4><p>Examples Given the string foobarbarfoo:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">bar(?=bar)     # finds the 1st bar ("bar" which has "bar" after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bar(?!bar)     # finds the 2nd bar ("bar" which does not have "bar" after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;=foo)bar    # finds the 1st bar ("bar" which has "foo" before it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;!foo)bar    # finds the 2nd bar ("bar" which does not have "foo" before it)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can also combine them:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># finds the 1st bar ("bar" with "foo" before it and "bar" after it)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(?&lt;=foo)bar(?=bar)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/2973436/regex-lookahead-lookbehind-and-atomic-groups" target="_blank" rel="noopener noreferrer">lookaround - Regex lookahead, lookbehind and atomic groups - Stack Overflow</a></li></ul><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">grep -Pio '(?&lt;=heads\/)(.*?)(?=\n)' text.txt # P option instead of E</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref: <a href="https://stackoverflow.com/a/45534127/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/45534127/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtree">command:tree<a class="hash-link" href="#commandtree" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-display-chinese--n">how to display chinese (<code>-N</code>)<a class="hash-link" href="#how-to-display-chinese--n" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">tree -N</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://blog.csdn.net/cxrsdn/article/details/100006348" target="_blank" rel="noopener noreferrer">(23 条消息) linux 下 tree 命令中文字符乱码解决方案<!-- -->_<!-- -->cxrsdn 的博客-CSDN 博客<!-- -->_<!-- -->linux tree 中文</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-dir-i">how to exclude dir(<code>-I</code>)<a class="hash-link" href="#how-to-exclude-dir-i" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># use `|` to split choices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># exclude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tree -I "XXX|YYY"   # maybe it means 'ignore'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://unix.stackexchange.com/questions/61074/tree-command-for-multiple-includes-and-excludes" target="_blank" rel="noopener noreferrer">tree command for multiple includes and excludes - Unix &amp; Linux Stack Exchange</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandhead">command:head<a class="hash-link" href="#commandhead" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="head-basic-usage">head basic usage<a class="hash-link" href="#head-basic-usage" title="标题的直接链接">​</a></h4><p>head 这个命令行其实没有什么要讲的，用法非常简单。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># output the first 5 lines (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head FILE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output the first N lines (replace "N")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">head -n "N" FILES</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-exclude-the-last-k-rows">how to exclude the last k rows<a class="hash-link" href="#how-to-exclude-the-last-k-rows" title="标题的直接链接">​</a></h4><p>但是今天 2022-01-26 碰到了一个问题，就是要获取前 n-1 行，然后试了 stackoverflow 上的方案好像都不对。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">head -n -1 FILE</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>后来才知道，是因为 mac 的原因，要用<code>ghead</code>才行……</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install coreutils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ghead -n -4 main.m</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而 <code>ghead</code> 是在 <code>coreutils</code> 里面，这个名字一看我就有，所以也不用装了。</p><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/16206507/head-command-to-skip-last-few-lines-of-file-on-mac-osx" target="_blank" rel="noopener noreferrer">shell - head command to skip last few lines of file on MAC OSX - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="discuss-use-head-or-sed">discuss: use <code>head</code> or <code>sed</code><a class="hash-link" href="#discuss-use-head-or-sed" title="标题的直接链接">​</a></h4><p>今天之所以用到 head 其实是因为我想对一个流做 sed 处理，但略去最后一行。</p><p>我一开始想用 sed 里的范围标识（地址），但一直没试出来。</p><p>后来我把地址标识换成最简单的<code>1,4s/find/replace/</code>之后才意识到，我的思路是不对的。</p><p><code>1,4</code>是一个确实被处理的范围选择，但结果就是，N 行中，前四行都被 sed 替换了，但是后面的行尽管没替换依旧会打印出来，而这正是 sed 的默认行为，它是一个流转换器。</p><p>那如果纯粹基于 sed，进行转换，并且去掉最后一行，就要用到<code>-o</code>结合好像是<code>/p</code>的 identifier，具体我也记不大清了。意思就是输出所有被匹配的行，但如果这样的话被匹配的行就会输出两遍了（两遍不必相同（NOT-SURE），一个是转换前，一个是转换后），所以另一个标识符就是阻止原内容的输出，这样就只输出匹配的行的处理结果。</p><p>所以，这个思路其实有问题，它可以对，也可以不对，它如果保证匹配 n-1 行，则对；否则就不满足需求了，我们的需求是处理前 n-1 行，并且不管匹配不匹配，都要输出，尽管实际上是都匹配的。</p><p>总之，理解到这层后，既可以用纯 sed 的方案，也可以用 head+sed 的方案，一个负责改，一个负责删即可，至于先后，结果都一样，也许 head 在前效率会更高一些。</p><p>所以，还是挺有意思的，这个。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtop">command:top<a class="hash-link" href="#commandtop" title="标题的直接链接">​</a></h3><p>Today(2022-01-27) I finally understood how to use the command of <code>top</code> (though <code>htop</code> is better for display but possibly more costly).</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-commands-1643248016619-b1ac7d3bcd2a9eb546a53a0e5da199d11d573f85a61a9317d679d002d98012fa.png" alt="picture 88" class="img_vXGZ"></p><p>I can switch the display format of memory usage when <code>top</code> has gone to the interactive interface.</p><p>The first option I can use is <code>E</code>, which allows to switch memory unit between <code>KiB | MiB | GiB | TiB</code>.</p><p>And the second option I can use is <code>m</code>, which switches the memory display type between pure text, columns graph and block graph.</p><blockquote><p>⚠️</p><ol><li>不可以在命令行中直接用 <code>top -M</code> （显示以<code>MB</code>为单位的内存使用量），因为<code>top -h</code>的帮助中写的很清楚，只支持部分选项。在 stackoverflow 上有 <code>top -M</code> 的建议(see: <a href="https://unix.stackexchange.com/questions/105908/how-to-display-meminfo-in-megabytes-in-top" target="_blank" rel="noopener noreferrer">linux - How to display meminfo in megabytes in top? - Unix &amp; Linux Stack Exchange</a>)，但可能我的版本（Ubuntu 18）不支持。正确的做法，是先进入<code>top</code>交互界面，然后按<code>E</code>，这样就会切换单位，比如按两次切换到<code>GB</code>单位。另外，独立的，还可以按<code>m</code>去切换内存的显示样式，比如像<code>htop</code>那种竖条状！</li><li>以上只在 ubuntu 上测试通过，在 mac 上我刚试了，不行！所以到底怎么用命令，还得根据平台自身！</li><li>具体的，可以通过 <code>COMMAND -h</code>去看简洁版的帮助页面，或者<code>man COMMAND</code> (e.g. <a href="https://manpages.ubuntu.com/manpages/bionic/en/man1/top.1.html" target="_blank" rel="noopener noreferrer">Ubuntu Manpage: top - display Linux processes</a>) 去看完整版的帮助页面！</li></ol></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandcat">command:cat<a class="hash-link" href="#commandcat" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-write-raw-string-into-file-using-cat">how to write raw string into file using <code>cat</code><a class="hash-link" href="#how-to-write-raw-string-into-file-using-cat" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GOPATH=$HOME/my-go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; ~/.profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export GOPATH=$GOPATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/2500436/how-does-cat-eof-work-in-bash" target="_blank" rel="noopener noreferrer">linux - How does "cat \&lt;\&lt; EOF" work in bash? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="usage-how-to-know-whats-the-bash-string">usage: how to know what's the bash string<a class="hash-link" href="#usage-how-to-know-whats-the-bash-string" title="标题的直接链接">​</a></h4><p>When using <code>bash</code> or <code>zsh</code>, we are supposed to use the function of <code>bindKey</code>.</p><p>However, the key we typed are always hard to remember, e.g. what's the <code>ctrl</code> key?</p><p>Luckily, there's a super easy (and also interactive) way for us to know it via <code>cat</code>, just to type <code>cat</code> followed by <code>enter</code> in terminal, and then the terminal would display what the character would be when we typing them.</p><p>E.g. here is what's the result when we combine <code>control | option | command</code> with arrow left and arrow right would be:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-commands-1643287045491-0d652ec4cf50fd00bdfe265d1bcbc4df4482ffc562e30624d26218fd2d841adf.png" alt="picture 114" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandunzip">command:Unzip<a class="hash-link" href="#commandunzip" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-unzip-to-specific-directory">how to unzip to specific directory<a class="hash-link" href="#how-to-unzip-to-specific-directory" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">unzip file.zip -d TARGET_DIR</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://askubuntu.com/questions/994611/how-to-unzip-into-a-given-directory" target="_blank" rel="noopener noreferrer">bash - How to unzip into a given directory - Ask Ubuntu</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandkill">command:kill<a class="hash-link" href="#commandkill" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> ps aux  |  grep -i  electron |  awk '{print $2}'  |  xargs sudo kill -9</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><p><a href="https://stackoverflow.com/a/30486159/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/30486159/9422455</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandscp">command:scp<a class="hash-link" href="#commandscp" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown -R USER_NAME REMOTE_FOLDER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod 777 REMOTE_FOLDER</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the <code>-R</code> means "recursively" since there may be file deeply in the target folder that won't allow you to write.</p><p>Hence, you can know, you can specifically claim your authority on the file or directory, since it would not automatically transfer.</p><p>Thus, a flexible approach is that just add a <code>-R</code> flag.</p><p>reference: <a href="https://unix.stackexchange.com/a/347412" target="_blank" rel="noopener noreferrer">https://unix.stackexchange.com/a/347412</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandlsof">command:lsof<a class="hash-link" href="#commandlsof" title="标题的直接链接">​</a></h3><p>check status of port occupation</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">lsof -i:8888</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandufw">command:ufw<a class="hash-link" href="#commandufw" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># check status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># white list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw allow 9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ufw reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://blog.csdn.net/jiaochiwuzui/article/details/80907521" target="_blank" rel="noopener noreferrer">(20 条消息) Ubuntu 防火墙的开启，关闭，端口的打开，查看<!-- -->_<!-- -->jiaochiwuzui 的博客-CSDN 博客<!-- -->_<!-- -->ubuntu 查看防火墙开启的端口</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtime">command:time<a class="hash-link" href="#commandtime" title="标题的直接链接">​</a></h3><p>I can directly using <code>time ( COMMAND_1 | COMMAND_2 )</code>, so that it can calculate the final time of this pipe.</p><p>However, time calculation is a little more sophisticated than what would I have thought, refer more to: <a href="https://unix.stackexchange.com/questions/364156/how-can-i-time-a-pipe/364157" target="_blank" rel="noopener noreferrer">bash - How can I time a pipe? - Unix &amp; Linux Stack Exchange</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandtr">command:tr<a class="hash-link" href="#commandtr" title="标题的直接链接">​</a></h3><p>It's useful to split line to lines.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo "111;222;333" | tr ';' '\n'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">111</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">222</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">333</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># use `nl` to add the line number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat main.js | tr ';' '\n' | nl -ba | head -6</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandcd">command:cd<a class="hash-link" href="#commandcd" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="usage-a-superb-scene-using-cd-">usage: a superb scene using <code>cd .</code><a class="hash-link" href="#usage-a-superb-scene-using-cd-" title="标题的直接链接">​</a></h4><img loading="lazy" alt="picture 10" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/linux-howto-1641284537356-d66d64fc07918dc1e98e62dd2dd70454a9ff16b2b2cc6da39fe18cbc6a5b07a1.png" width="480" class="img_vXGZ"><p>ref:</p><ul><li><a href="https://superuser.com/questions/702402/how-do-i-refresh-directory-in-bash" target="_blank" rel="noopener noreferrer">linux - How do I refresh directory in BASH? - Super User</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="commandsed">command:sed<a class="hash-link" href="#commandsed" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="noopener noreferrer">✨✨✨ sed, a stream editor✨✨✨</a></p></li><li><p><a href="https://www.grymoire.com/Unix/Sed.html" target="_blank" rel="noopener noreferrer">Sed - An Introduction and Tutorial</a></p></li><li><p><a href="https://www.mankier.com/1/sed" target="_blank" rel="noopener noreferrer">sed man page - General Commands | ManKier</a></p></li></ul><p>a good start:</p><ul><li><a href="https://www.geeksforgeeks.org/sed-command-in-linux-unix-with-examples/" target="_blank" rel="noopener noreferrer">Sed Command in Linux/Unix with examples - GeeksforGeeks</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-print-only-matched-lines">how to print only matched lines<a class="hash-link" href="#how-to-print-only-matched-lines" title="标题的直接链接">​</a></h4><ol><li><code>-n</code> means "No automatically print the each line"</li><li><code>/p</code> means "Print the processed line"</li></ol><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># print only the matched lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -n "s|find|replace|p"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># don't print any line (so useless)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -n "s|find|replace|"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># print all the line each, with matched line again(twice, and it's the same)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed "s|find|replace|p"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TODO: print the processed, and apply function on it.</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ref:</p><ul><li><a href="https://stackoverflow.com/questions/17511639/sed-print-only-matching-group" target="_blank" rel="noopener noreferrer">regex - sed: print only matching group - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-how-to-increment-version-number">✨ how to increment version number<a class="hash-link" href="#-how-to-increment-version-number" title="标题的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-use-echo-based-on-e">resolution 1: use <code>echo</code> based on <code>//e</code><a class="hash-link" href="#resolution-1-use-echo-based-on-e" title="标题的直接链接">​</a></h5><p>special thanks to: <a href="https://stackoverflow.com/a/14348899/9422455" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/14348899/9422455</a></p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-answer">resolution 2: answer<a class="hash-link" href="#resolution-2-answer" title="标题的直接链接">​</a></h5><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">gsed -i -E 's|(.*)"version": "([0-9]+)\.([0-9]+)\.([0-9]+)"|echo "\1\\"version\\": \\"\2.\3.$((\4+1))\\""|e' package.json</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>test what happened using <code>//pe</code></p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb_sqlite git:(main) head -3 release/app/package.json                                                                                                                                           [7-01-22 | 4:18:17]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name": "mark.hjxh.express_match",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "version": "0.2.2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">➜  erb_sqlite git:(main) gsed -E 's|(.*)"version": "([0-9]+)\.([0-9]+)\.([0-9]+)"|echo "\1\\"version\\": \\"\2.\3.$((\4+1))\\""|pe' release/app/package.json                                        [7-01-22 | 4:08:57]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "name": "mark.hjxh.express_match",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo "  \"version\": \"0.2.$((2+1))\"",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  "version": "0.2.3",</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>explanation</p></blockquote><p>In fact, the <code> "version": "0.2.2",</code> is changed into <code>echo " \"version\": \"0.2.$((2+1))\"",</code>.</p><p>And then the <code>e</code> syntax indicates run this sequency string as a command, so that it finally turns into <code> "version": "0.2.3",</code></p><blockquote><p>attention</p></blockquote><ol><li>the <code>"</code> needs to be escaped, and to escape <code>"</code>, we need to use a <code>\</code>, and to let the <code>\</code> work in the <code>echo</code> function, we need to escape it again, that is to be <code>\\"</code></li><li><code>sed</code> will match all line (including the leading space), and the <code>e</code> would execute all line. So if I just replace the version number part into <code>echo "\\"0.2.3\\""</code>, then all the line would turns into <code> "version": echo "\\"0.2.3\\""</code>, which is certainly unwanted and deserves reflection.</li></ol><blockquote><p>core ref</p></blockquote><p><a href="https://stackoverflow.com/questions/14348432/how-to-find-replace-and-increment-a-matched-number-with-sed-awk" target="_blank" rel="noopener noreferrer">bash - How to find/replace and increment a matched number with sed/awk? - Stack Overflow</a></p><p><code>perl | awk</code> alternative</p><ul><li><a href="https://stackoverflow.com/questions/8653126/how-to-increment-version-number-in-a-shell-script" target="_blank" rel="noopener noreferrer">bash - How to increment version number in a shell script? - Stack Overflow</a></li></ul><blockquote><p>official hack way (but I failed)</p></blockquote><p>sh #!/usr/bin/sed -f</p><p>/<sup id="fnref-0-9-ccff32"><a href="#fn-0-9-ccff32" class="footnote-ref">0-9</a></sup>/ d</p><h1>replace all trailing 9s by <!-- -->_<!-- --> (any other character except digits, could</h1><h1>be used)</h1><p>:d s/9<!-- -->(<em>*<!-- -->)<!-- -->$/</em>\1/ td</p><h1>incr last digit only. The first line adds a most-significant</h1><h1>digit of 1 if we have to add a digit.</h1><p>s/^<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/1\1/; tn s/8<!-- -->(<strong>)<!-- -->$/9\1/; tn s/7<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/8\1/; tn s/6<!-- -->(</strong>)<!-- -->$/7\1/; tn s/5<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/6\1/; tn s/4<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/5\1/; tn s/3<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/4\1/; tn s/2<!-- -->(<!-- -->_<!-- -->_<!-- -->)<!-- -->$/3\1/; tn s/1<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/2\1/; tn s/0<!-- -->(<!-- -->_<!-- -->*<!-- -->)<!-- -->$/1\1/; tn</p><p>:n y/<!-- -->_<!-- -->/0/</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [sed, a stream editor](https://www.gnu.org/software/sed/manual/sed.html#Increment-a-number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### how to match digits (`[0-9]` or `:digit:`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ref:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thanks for the direction to sed official documentation in this post.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [regex - Why doesn't `\d` work in regular expressions in sed? - Stack Overflow](https://stackoverflow.com/questions/14671293/why-doesnt-d-work-in-regular-expressions-in-sed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#### how to insert text before first line of file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suppose the text is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind base;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind utilities;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and the file is <code>public/style.css</code></p><p>first, export this variable for better understanding of commands:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">T='@tailwind base;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@tailwind utilities;'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F='public/style.css'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and copy file as a backup:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp $F ${F}_</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then the reset command is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">cp ${F}_ $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-1-use-cat-and-">resolution 1: use <code>cat</code> and <code>;</code><a class="hash-link" href="#resolution-1-use-cat-and-" title="标题的直接链接">​</a></h5><p>The <code>cat</code> approach meets our intuition, but needs a temp file.</p><p>First, we dump the <code>T</code> into <code>temp</code> file, then append <code>F</code> into temp, finally replace <code>F</code> with temp, that is:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T &gt; temp; cat $F &gt;&gt; temp; mv temp $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be careful about the second operator of <code>&gt;&gt;</code> since it means <code>append</code> otherwise the <code>$T</code> would be flushed, then <code>$F</code> keeps unchanged.</p><p>refer:</p><ul><li><a href="https://unix.stackexchange.com/questions/159513/what-are-the-shells-control-and-redirection-operators" target="_blank" rel="noopener noreferrer">What are the shell's control and redirection operators? - Unix &amp; Linux Stack Exchange</a></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-2-use-cat-and-">resolution 2: use <code>cat</code> and <code>|</code><a class="hash-link" href="#resolution-2-use-cat-and-" title="标题的直接链接">​</a></h5><p>In last solution, we used 2 ';', and there is an easy way to change it to just 1 ';'.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | cat - $F &gt; temp; mv temp $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this solution, the <code>$T</code> echoed into second pipe, and <code>cat</code> used <code>-</code> to capture it then joined with <code>$F</code> and dumped into temp, which surely is faster.</p><p>refer:</p><ul><li><p><a href="https://superuser.com/questions/1388584/what-does-the-last-hyphen-mean-in-options-of-bash" target="_blank" rel="noopener noreferrer">linux - What does the last "-" (hyphen) mean in options of <code>bash</code>? - Super User</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/16357/usage-of-dash-in-place-of-a-filename" target="_blank" rel="noopener noreferrer">shell - Usage of dash (-) in place of a filename - Unix &amp; Linux Stack Exchange</a></p></li></ul><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-3-use-sed-s-command">resolution 3: use sed s-command<a class="hash-link" href="#resolution-3-use-sed-s-command" title="标题的直接链接">​</a></h5><p>In the above 2 solutions, we both need an IO, i.e. first saving into a 'temp' file and move to override the raw file, which could be low-efficiently and not elegant.</p><p>There's a way allowing us to finish the 'join' action just in the pipe and finally leads to inplace-modify target file. That is "sed's s-command".</p><img loading="lazy" alt="picture 24" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379168300-linux-howto-90b435ef191284a35f21cb8cac698769b8548bfe2b3f90db2be5ea988a56c636.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 25" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379622241-linux-howto-e51b228ec26d453924d9731bc86f94185eccbc8ea4d43954698c4217845ca262.png" width="480" class="img_vXGZ"><p>When using <code>s-command</code>, we can easily apply regex grammar to achieve what we want.</p><img loading="lazy" alt="picture 26" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640379819166-linux-howto-c717ac5a605fb416fa2f472e202a74949ed8b34c3556d06ca6b70c8202d70901.png" width="480" class="img_vXGZ"><p>Like this, we can easily insert text in front of a sequency of text based on regex of '^', which means the beginning of text.</p><p>And then, since the basic grammar of how to insert text before specific line of an input file in <code>sed</code> is <code>sed -i 'Ni TEXT' $F</code> , the problem then converts to how to join '1i' with $T. That is what we just learned can be put into practice:</p><img loading="lazy" alt="picture 27" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640380337394-linux-howto-d8bfb544ab1b2db098a1fd9138401997b9b11814af6cbf639243453526a91c02.png" width="480" class="img_vXGZ"><p>You see, now all the commands have nothing to do with the io, and the principle behind this command chain is straightforward: join into <code>1i $T</code> then use it as <code>sed -i</code>’s parameter (via <code>-f-</code> which is the former pipe).</p><h5 class="anchor anchorWithStickyNavbar_rB0w" id="resolution-4-use-sed-e-command">resolution 4: use sed e-command<a class="hash-link" href="#resolution-4-use-sed-e-command" title="标题的直接链接">​</a></h5><img loading="lazy" alt="picture 16" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375147417-linux-howto-e0475887ff34e4a4a0be217c3596e054d2bdfa01f28f360f2459123e0b2175f7.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 17" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375169955-linux-howto-57609e425971259dd89c05c571047e701cb2c44dcc4deac43b0724a7295d8f44.png" width="480" class="img_vXGZ"><p>I'd think the e-command is quite confusing, but does good job.</p><p>I made some tests on the e-command to help myself understand.</p><p>In the above introduction, it indicates that if 'without parameters, the e command executes the command that is found in space and replace the pattern space with the output'.</p><p>suppose we have <code>a='aaa\necho "bbb" \nccc'</code>, then if we runs <code>echo $a | gsed '2e'</code>, that's to say run the second line as a command and let others stay as what they are: <img loading="lazy" alt="picture 18" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640375663511-linux-howto-18fd2906bf27a739476740fbe2c713a3c42b40de5865cebd14c08e696ed0b39a.png" width="480" class="img_vXGZ"></p><p>However, 'if a parameter is specified, instead, the e command interprets it as a command and sends its output to the output stream.'</p><p>I made an example which may help us to understand what's the mechanism of <code>gsed 'ne xxx</code>, in which <code>xxx</code> is the so-called 'parameter'.</p><img loading="lazy" alt="picture 19" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640376208972-linux-howto-5309698b6833082cf93b3b0f69cda3616678ad00d3e5141895bcec14b8684f57.png" width="480" class="img_vXGZ"><p>You can see, as the following shows, since a is a three-line text and sent into the pipe as stream, so first line shows 'aaa', and second line shows 'echo "bbb"', as what we preset.</p><p>The most notable point is that since <code>gsed</code> sets a <code>3e</code> command which means 'it will execute following commands at 3rd row of stream'. Thus, the following commands <code>xxx\n echo "yyy"...</code> are executed as separate commands split by lines.</p><p>Obviously, neither <code>xxx</code> nor <code>zzz</code> is a valid command and turned into an error. Plus, since the level of error usually is a bit higher than normal output, the error of <code>zzz</code> came before <code>yyy</code> and then is <code>AAA</code>.</p><p>Finally, when all the commands were executed, the next stream in pipe came, i.e. <code>ccc</code>, and all the sequences came into end.</p><p>ref:</p><p><a href="https://www.gnu.org/software/sed/manual/sed.html#:~:text=by%20standard%20seds.-,e%20%5Bcommand%5D,-This%20command%20allows" target="_blank" rel="noopener noreferrer">sed e-command</a></p><p>Still, we had other topics to talk about.</p><img loading="lazy" alt="picture 20" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377292421-linux-howto-27ab701a1d1cca335a1476e71b742a60b9f6817b5d08521c70c766bfae21290d.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 22" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377315692-linux-howto-ea510349e79dd47d4ca01d17200defcf7e8b8b8ebda0b0785c1833ba932c625d.png" width="480" class="img_vXGZ"><p>We can know the classic usage of <code>sed</code> is <code>sed SCRIPT INPUTFILE</code>, and if <code>-e</code> option is used to specify a script, with all non-option parameters taken as input files.</p><p>So what would happen when we combine the <code>-e</code> and an input file.</p><p>Back to what we covered the above, we can move a step further now.</p><img loading="lazy" alt="picture 23" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640377647537-linux-howto-8099c8c4212b90dd4f7fa22449dc22ef8135c485c97674a561b87769121c750b.png" width="480" class="img_vXGZ"><p>In this example, we can see that <code>gsed</code> first read one line from <code>../temp</code> file which is <code>AAA</code>, and then paused since the <code>2e</code> flag to execute <code>cat -</code> command which shows all the input stream from <code>echo $a</code>, and finally continued to read the remaining rows of <code>BBB</code> and <code>CCC</code>.</p><p>So what about if we specify a <code>-i</code> option, which means <code>change in position</code>?</p><p>It's easy to understand, that is all the output would be sent into <code>../temp</code>, so that <code>../temp</code> changes to the output just like the result in this example shows.</p><p>Hence, we can derive from our conclusion: if we use the following command:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i '1e cat -'  $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then the goal of inserting text before first line can be achieved just on the fly~</p><p>How amazing and beautiful it is!</p><p>ref:</p><ul><li><a href="https://www.gnu.org/software/sed/manual/sed.html#:~:text=sed%20%C2%A0%20%5BContents%5D%5BIndex%5D-,2.1%20overview,-Normally%20sed%20is" target="_blank" rel="noopener noreferrer">gsed overview</a></li></ul><blockquote><p>conclusion</p></blockquote><p>G1. To insert lines at the beginning of one file:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. dump, dump, and move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T &gt; temp; cat $F &gt;&gt; temp; mv temp $F;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. join, dump, and move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | cat - $F &gt; temp; mv temp $F;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. [sed s-command] concat-string, inplace-insert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed '1s/^/1i /' | gsed -i -f- $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. [sed e-command] ... hard to conclude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i '1e cat -' $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G2. To insert lines at specific line:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. if text is single line, refer: https://stackoverflow.com/a/6537587/9422455</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsed -i 'Ni $T' $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. if text is multi lines, refer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i 'Ne cat -' $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>FIXME: (failed) G3. To insert content after matched position:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. [sed r-command]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed -i '$P/r -' $F #  the '-' is same for '/dev/stdin'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G4. To insert multi lines manually:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1, when lines are already multiplied, just add `\` after each line, refer: https://askubuntu.com/a/702693</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2, when lines are in one, using `\n`, refer: https://askubuntu.com/a/702690</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>G5. To insert lines after matched line with the same leading space format:</p><blockquote><p>⚠️ 嵌套 sed 正则注意事项</p><ol><li>输入的文本不能与分隔符相同，否则需要转义。比如本次为了在代码中加入注释<code>//</code>，就不方便用<code>/</code>当分隔符</li><li>嵌套正则的时候，为了能分清一级与二级，可以应用不同的分隔符，比如本次更新用了<code>|</code>作为一级，<code>_</code>作为二级</li></ol></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. [sed s-command] leading space align with $P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># failed at 2022-01-25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo $T | gsed 's/^.*$/s\/(^.*?)($P.*$)\/\\1\\2\\n\0\//' | gsed -E -f- $F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># updated at 2022-01-25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo $T | gsed 's|^.*$|s_^(.*?)('$P'.*)$_\\1\\2\\n\\1\0_|' | gsed -E -f- $F | grep --context=3 $T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># FIXME: (failed) 2. [sed s-command with named-pipe] [more straightforward]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;(echo -n "s/(^.*?)($P.*?$)/\1\2\\\\n\1" &amp; echo -n $T &amp; echo -n "/") | gsed -E -f- $F</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><img loading="lazy" alt="picture 29" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640385997938-linux-howto-41e634caf1122f991d08d485202adfb56ab71cdfdb7d5ad76ad4f57ca751cbaa.png" width="480" class="img_vXGZ"><p>ref:</p><ul><li><a href="https://serverfault.com/questions/171095/how-do-i-join-two-named-pipes-into-single-input-stream-in-linux" target="_blank" rel="noopener noreferrer">shell - How do I join two named pipes into single input stream in linux - Server Fault</a></li></ul>]]></content:encoded>
            <category>开发笔记</category>
            <category>Linux</category>
        </item>
        <item>
            <title><![CDATA[札记 | 关于近几年的一些感悟]]></title>
            <link>https://markshawn2020.github.io/blog/2022/02/01/prose-2022-begining</link>
            <guid>/2022/02/01/prose-2022-begining</guid>
            <pubDate>Tue, 01 Feb 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[我本来想写挺长的文章。]]></description>
            <content:encoded><![CDATA[<blockquote><p>我本来想写挺长的文章。</p><p>后来我打开音乐一放：李汉颖老师的《在最美时分别》。</p><p>我就什么都不想写了。</p><p>只想说一句：“新年快乐”。</p><p>毕竟，人是无论如何都会生活的。</p><p>而人生，向来如此。</p><p>所以不要忘了：新年了，请快乐！</p></blockquote><ol><li><a href="#%E5%86%99%E6%96%87%E7%AB%A0%E6%80%BB%E9%9C%80%E8%A6%81%E4%B8%80%E7%82%B9%E7%90%86%E7%94%B1%E5%AE%9E%E5%9C%A8%E6%B2%A1%E6%9C%89%E5%B0%B1%E5%8F%AA%E5%A5%BD%E7%BC%96%E9%80%A0%E4%B8%80%E4%B8%AA%E5%A6%82%E4%B8%8B">写文章总需要一点理由，实在没有就只好编造一个如下</a></li><li><a href="#%E6%98%AF%E7%9A%84%E7%8E%B0%E5%9C%A8%E6%98%AF%E7%99%BE%E5%B9%B4%E6%9C%AA%E6%9C%89%E4%B9%8B%E5%A4%A7%E5%8F%98%E5%B1%80%E6%89%80%E4%BB%A5%E7%84%B6%E5%90%8E%E5%91%A2">是的，现在是百年未有之大变局，所以，然后呢？</a></li><li><a href="#%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%8A%B1%E5%A4%9A%E4%B9%85%E6%89%8D%E8%83%BD%E6%98%8E%E7%99%BD%E7%94%9F%E6%B4%BB%E5%B9%B3%E6%B7%A1%E5%A6%82%E6%B0%B4%E6%89%8D%E6%98%AF%E4%BA%BA%E7%94%9F%E7%9A%84%E7%BB%88%E6%9E%81%E5%91%BD%E9%A2%98">我们需要花多久才能明白，生活平淡如水，才是人生的终极命题</a></li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="写文章总需要一点理由实在没有就只好编造一个如下">写文章总需要一点理由，实在没有就只好编造一个如下<a class="hash-link" href="#写文章总需要一点理由实在没有就只好编造一个如下" title="标题的直接链接">​</a></h2><p>不得不说，我们还是年轻的，是实打实的“当打之年”。</p><p>我知道，这么说肯定会有人反驳，他可以举出无数个比我们自己更年轻的却更成功的人的例子。</p><p>但我终于可以对这些具有一定启发意义的，但本质上无意义的攀比、定性，无动于衷了。</p><p>我已经到了，能够清晰地认识，什么是一个人固有的，什么是一个人应有的，以及什么是一个人将有的年龄。</p><p>考虑到年龄这个词太过于敏感，并略显消极，请允许我将它偷换成心境，尽管听起来有点不耻贴金的味道。</p><p>毕竟，一个二十几岁的年轻人，何以有胆妄谈心境呢。</p><p>但也许，能谈，一点点。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="是的现在是百年未有之大变局所以然后呢">是的，现在是百年未有之大变局，所以，然后呢？<a class="hash-link" href="#是的现在是百年未有之大变局所以然后呢" title="标题的直接链接">​</a></h2><p>这个年代，在大家很小的时候，好像都有个科学家、数学家的梦想。</p><p>我自然也不例外。</p><p>尽管我对于这个念想的生长，不能寻得一点点的蛛丝马迹。</p><p>毕竟，众所周知，咱目前这个社会，科学家、数学家的待遇，也是令人唏嘘；而当时，兴许也是。</p><p>也许最近略好一些了罢。</p><p>如果硬是强塞一个逻辑，那大概是小时候见到某个朋友家里有一套《十万个为什么》，而另一个朋友家里有一套《上下五千年》。</p><p>但讽刺的是，有《十万个为什么》的朋友，数年后推销起了房地产。</p><p>而我，也万万没有想到的，成为了一名工程师。</p><p>至于《上下五千年》那位，我们暂时还是先不谈了。</p><p>回到我刚刚提到的“也许最近略好一些了罢”。</p><p>缘何能起这样的怀疑。</p><p>大概是因为华为终于被卡脖子了，国家终于到了一个可以重视基础研究，可以有一定的底气高谈阔论内循环的时候了。</p><p>但你知道我怕什么吗。</p><p>十几年的教育培养我的第一大人生哲学便是：<strong>这一次没有什么不同</strong>。</p><p>我这么说一定有足够的底气，想来华夏已经这么几千年了，老祖先什么政策、什么逻辑没有试过呢。</p><p>再怎么都不会能有超越轴心时代的高光时刻吧，从历史结点的意义上来说。</p><p>生活在当代的人，我知道，肯定会大谈资本主义/社会主义制度的优越性，相对于封建制度/奴隶制度来说。</p><p>但一切都没有意义。</p><p><strong>人是无论如何，都会生活的。</strong></p><p>而生活的本质，是当下如何做，是落实到接下来的一秒钟你是该眨左眼还是右眼的问题。</p><p>并且你会突然意识到，这个问题是如此荒谬，因为正常情况下，我们都是同时眨左右眼的。</p><p><strong>而更荒谬的是，人生本便是如此。</strong></p><p>我们活在百年未有之大变局里，是的。</p><p>历史不会抹去这些时刻，八年抗战、三年饥荒、十年文革的惨痛仍旧触目惊心，孙先生的遗志仍旧历久弥新着。</p><p>历史也会记住这些时刻，一带一路、脱贫攻坚、伟大复兴的号召始终不绝于耳，周总理的希冀始终不负盛开着。</p><p>但这不能回答，为什么一间房子竟能抵得上一个人的十辈子乃至更多。</p><p>也不能回答，为什么也有一个人仅仅一天，就能赚上上百间房子。</p><p>我是多么好奇那个年代，“我们都有光明的未来”。</p><p>所以，请告诉我，时代于个人，于每一个活生生的人，一个有着自己物质追求、精神向往、灵魂自由的人，它究竟该摆在哪个位置。</p><p>思考这些很难是吧，所以下一秒，我们又忙着聊下一个天了，或是看下一篇文章了，或是忙下一个项目了， 或是忙下一场恋爱了。</p><p>你知道我是这么想这些的吗？</p><p>我望着窗外飞驰的丘陵、田野，我其实没有答案。</p><p>我偶尔会试图想知道菩提顿悟顿的是什么悟，我奋斗奋的是什么斗，我思索思的是什么索，而我归家归的又是什么家。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="我们需要花多久才能明白生活平淡如水才是人生的终极命题">我们需要花多久才能明白，生活平淡如水，才是人生的终极命题<a class="hash-link" href="#我们需要花多久才能明白生活平淡如水才是人生的终极命题" title="标题的直接链接">​</a></h2><p>有一个心理学逻辑叫自证预言，一个人生长的整体轨迹，会沿着它内心的一条暗线进行。</p><p>但很遗憾的是，在我仅有的这二十几年生长长河里，我似乎并不能窥见这一定律。</p><p>我不知道有多少人也是像我一样的，我猜想，可能不多。</p><p>我的意思，我是相信自证预言的，但我突破了前二十年我原有的自证预言，后二十年的我，将是一个新的自证预言。</p><p>我大概知道原因，无非就是我从小留守独立，恰好读书略有天赋，又喜欢冒险，以至于活成了我现在的自己，大致如此。</p><p>若是缺了留守独立这一条，那一定深受家庭影响，可能有继往开来的突破，但不大可能有出乎意料的选择。</p><p>若是缺了读书天赋这一条，这个社会顶层设计的复杂性，将使他难得开昧，活得拧巴，亦或痞气。</p><p>而若是缺了冒险这一条，也许可以过的顺遂，却难以活得明白，终有一天可能生出被社会骗了的错觉。</p><p>但我这样，也不无代价。</p><p>有人是会羡慕我的潇洒，我的自由，我却也并不比大多数人幸福，这也是人生规律之一，围城始终存在。</p><p>很多时候，我是多么羡慕那些，摆正定位、脚踏实地的人。</p><p>但我也是，允许我说，深刻地知道，他们放弃了什么，他们会遇到什么。</p><p>以至于有一天，我对自己会心一笑，我似乎可以自由地穿越于社会的阶级之间了。</p><p>我似乎，真地活成了一个人。</p><p>而非其他什么的。</p><p>但可笑的是，我的骨子里又是那么无趣的一个人。</p><p>曾经我也许热衷于把这个人标记为 A，把那个时刻标记为 B，后来也索性都任由它们在大脑皮层的喜好了。</p><p>我们需要花多久才能明白，<strong>刚刚过去的一秒钟，曾是属于我们自己的一秒钟；而即将到来的这一刻，也是属于我们的这一刻</strong>。</p><p>但当我们想握起什么，它便从指缝溜走什么；当我们想忆起什么，它便从现在偷走什么。</p>]]></content:encoded>
            <category>札记</category>
        </item>
        <item>
            <title><![CDATA[札记 | 一位工程师的自我修养（序）]]></title>
            <link>https://markshawn2020.github.io/blog/2022/01/23/prose-engineer-cultivation</link>
            <guid>/2022/01/23/prose-engineer-cultivation</guid>
            <pubDate>Sun, 23 Jan 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[中午冒险尝试了重庆辣的重庆小面，那个滋味，真地是……]]></description>
            <content:encoded><![CDATA[<p>中午冒险尝试了重庆辣的重庆小面，那个滋味，真地是……</p><p>回来就拉肚子了。</p><p>我显然已经过了能吃辣的那个年纪。</p><p>这同时也意味着，我到了需要思考自我修养的年龄了。</p><p>文雅起见，就记为《一位工程师的自我修养》吧。</p><p>于是，漫步夜晚望京的街头，一位男子迎面缓缓跑过，这不巧了吗？正是我的房租爸爸（尽管看起来可能比我还年轻，都有儿子了）。</p><p>第一个念头就是，作为工程师，我该不该跟他打招呼。</p><p>细想想，昨天上电梯时，中途进来一个人，顿觉有点面熟，可正是他。</p><p>似乎同性相斥，我们两次最终都没有什么言语。</p><p>难道他也是一名工程师？我如此想到。</p><p>他走后，我企图拍下他的背影，毕竟深夜单独跑步的人，一定还是值得肯定的。</p><p>既然我没有跑步，而他跑了。</p><p>而我是工程师，说明他肯定不是。</p><p>所以，这才彼此没有话说吧，不然一定可以聊一聊跑步的最优路径规划问题。</p><p>但，这不扯远了吗？作为工程师，我该不该和他打招呼呢？</p><p>想着想着，许是太冷，就偶然走进了一家星爸爸，想来一杯热咖啡。</p><p>工程师是一定要喝咖啡的，尽管已经是夜晚。</p><p>但考虑自己年纪确实不小了，明日还要以一个高昂的斗志约见一位新同事，心想还是稳妥点好，于是点了杯红茶。</p><p>但我很显然，立马就觉得不对了。</p><p>因为星爸爸的柜台小姐姐转而向我推销后面的杯子了。</p><p>原本我是没有兴趣的，工程师是一定要省钱的，而星爸爸的杯子素来都不便宜。</p><p>可是她又立即补充道了一句：或者送人什么的。</p><p>这可把我一下愣住了，是啊，我可以送人。</p><p>我还有一个妹妹，我是可以送人。</p><p>很久以前，就有女生送我星爸爸的杯子，我一向觉得杯子有什么好送的。</p><p>后来，很久很久后，那个杯子终于碎了。</p><p>但在我转身之际，却发现，有看起来不会碎的杯子。</p><p>我是可以考虑送一个杯子给我妹妹的啊。</p><p>尽管不知道杯子到底有什么意义，但是，是可以送一个杯子的啊。</p><p>毕竟七五折。</p><p>我便去看杯子。</p><p>我想，什么杯子才能体现一个工程师的审美与素养呢。</p><p>它一定不能是花里胡哨的，它一定是鲁棒的，它一定是持久化的，它一定是交互友好的。</p><p>我很中意一个杯子，它不高，精致，这样能体现一个妹妹的意义。</p><p>可是，它相比另一个杯子，只有一个爪子的图案，这样不能显示出是猫爪子还是虎爪子。</p><p>这不行，程序要语义化、准确化。</p><p>所以，我选了另一个稍显修长的。</p><p>它很高，有很显著的虎头形象。</p><p>转念一想，这也是极其适合的。</p><p>妹妹大了，是时候撑起身边的一片天了。</p><p>我要让她知道，属于她的，不再是精致的自我世界，还有顶立的家庭与广阔的社会。</p><p>杯子是修长的，希望她能明白成长的过程。</p><p>杯子是金红的，希望她能明白稳重的意义。</p><p>杯子是保温的，希望她能明白温度的价值。</p><p>小姐姐对我说，这个杯子是最贵的。</p><p>我很吃惊，因为我其实并没有注意到这个事情。</p><p>我只是从工程师的角度，选了一个杯子。</p><p>这么看来，在我以工程师的眼光去选择一个杯子之前，便已经有工程师以工程师的素养造了一个杯子。</p><p>我感受到了与工程师的共鸣。</p><p>我感受到了与工程师素养的共鸣。</p><p>小姐姐试图和我聊更多。</p><p>询问我的行业，我的出身地。</p><p>她的言辞是那么轻微、平和、恳切。</p><p>说工程师都是很聪明的人，赚自己好多倍的钱。</p><p>不知是幽默还是啥的，问我南京是不是江苏的省会。</p><p>我看着眼前这个北京不大不小的星爸爸店里，这位说话满是令人心疼的，一位女孩。</p><p>更加坚定了我买这个杯子的决心。</p><p>她们最后给我定了七折，不走积分。</p><p>确实，积分又有什么意义呢。</p><p>我安静地坐下，以一位工程师的素养，不紧不慢地喝完那杯红茶。</p><p>不能太快，否则容易有 bug。</p><p>不能太慢，否则显得不是那么聪明。</p><p>她时不时将目光飘过来，似乎想和我聊更多。</p><p>但是她以服务员的素养，克制住了。</p><p>而我只想着这个杯子，什么时候以什么方式预期会有什么结果的寄给我妹妹。</p><p>这是工程师首要考虑的。</p><p>我细细地品完最后一口红茶，在五秒内郑重地打开两道门，向不眠的街道走去。</p><p>快递大叔还在富有激情的忙着，迎面一位浑身大袄的男人牵着两条狗在冰雪上悠闲地溜达着。</p><p>我突然想起进门小姐姐的第一句话：你穿这么少不冷吗。</p><p>我记得很清楚，我当时确实没感觉冷。</p><p>因为工程师一定会计算好温度选择最合适的的衣服出行。</p><p>行走会让我的机体产生热量，与脑部的温度对冲。</p><p>而脑部适当的低温，是对身体有益的，尤其是在夜晚睡觉时。</p><p>但很显然，这杯红茶，让我明白。</p><p>也不全是这样。</p>]]></content:encoded>
            <category>札记</category>
            <category>工作</category>
        </item>
        <item>
            <title><![CDATA[札记 | 是的，我入职了]]></title>
            <link>https://markshawn2020.github.io/blog/2022/01/20/prose-first-job</link>
            <guid>/2022/01/20/prose-first-job</guid>
            <pubDate>Thu, 20 Jan 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[是的，我入职了.]]></description>
            <content:encoded><![CDATA[<p>是的，我入职了.</p><p>那个曾经改名不拿国一不理发的幼稚男孩，那个曾经背着行囊走南闯北无问东西的青涩少年，那个曾经在朋友圈征伐不公、在家摔过饭碗、在公司写信质问领导的意气青年，他入职了。</p><p>曾经，这是一个很难抉择的选项，想上最牛逼的学校，去最牛逼的公司，做最牛逼的工作，有着澎湃的欲望，一路匆忙。</p><p>谈不上失败。</p><p>断不会停止。</p><p>但是时候先做一个总结了。</p><blockquote><p>我的母亲说我不小了</p><p>为什么还是话不多</p><p>是不是过的不快乐</p><p>我背起行囊又走了</p><p>我去过很多个地方</p><p>那些故事很快就遗忘</p><p>我不想看见谁悲伤</p><p>就只是一个人游荡</p><p>——三旬老汉《世子》</p></blockquote><p>很多年前，我第一次踏入大学的校门时，我在想什么。</p><p>已经不得而知。</p><p>多年以后，当我再一次踏入大学校门时，我会想什么。</p><p>我想，应该是我现在想的那样。</p><p>成长，总是这样的。</p><p>很多事情，也许你曾经不明白，但总有一天，你会醒悟。</p><p>因为某些人，或是，因为某些事，或是，单单因为突然下了一场雪，一场久违的雪。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642682889597-5ac8d8bffba84de558c9a85b4363d727e94cd3b6263bb3c6256af3121f593901.png" alt="picture 5" class="img_vXGZ"></p><p>我还记得，十年前，周末教学楼走廊上的阳光是那么的迷人，金色，温暖，一个个眼睛里还透露着稚气与朝气。</p><p>我还记得，五年前，社团同学产生严重分歧，一个二十年历史五星级的社团摇摇欲坠，大家一起在黑夜的操场上围成圈，努力地摆正方向。</p><p>我还记得，三年前，南下深圳，东临浦江，北往天坛，正式开始背起行囊，学界、业界纷纷撞入我的眼帘，播下我对学习真正的渴望。</p><p>三年内，一直一个人，因孤独而开始丰富，因坚定而开始执着，终于有一刻，我学会对自己说：“If this is not our time, when will be?”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642681271954-c4b359b2d77796962afd79cdc26063ada9459caa35350935e17561926842b5ea.png" alt="picture 1" class="img_vXGZ"></p><p>我时常望着远处发呆，远处的高楼，或者远处的原野，或者远处的孤冢，或者远处的夕阳。</p><p>我望着，不是因为渴望什么，我望着，只是因为它们都与我如此相关，只是因为那无穷的远方，无数的人们也与我有关。</p><p>我好像早已过了，渴望从什么地方获得什么的年龄。</p><p>我开始希望，自己向外释放什么。</p><p>我希望我能带来希望。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642683155554-a0656b88380f91fd4a4ea35a926112d7090c1f1f2df610ad8dcdd1c1dc265f09.png" alt="picture 7" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642683264721-b4c5303fb44b733d66d7ad76a725668edc8548e1f9cbe43a5c7b66fdb5626e77.png" alt="picture 8" class="img_vXGZ"></p><p>我不信命运由父母决定，由学校决定，由新冠决定。</p><p>我们悠久的历史里，无数文人志士、武将侯门、乞丐与帝后，他们也曾像我们一般彷徨，他们也曾像我们一样有力。</p><p>而我们，也将像他们一样，如此。</p><p>所以，最重要的是当下。</p><p>最好的时刻是此刻。</p><p>一切都不为晚。</p><p>选择有力的朋友，坚定有力的方向，其余的交给青春、热血希望，交给我们，自己。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642682440489-d6e963dc60cad99d6d6941816e8645d9893922c8219b9acd97aadfa3e976ece9.png" alt="picture 4" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642683334060-163231098a4f8e9ae2c39ce44c7a1f1125ef7fed41b1fc4e198fb381235b0cdc.png" alt="picture 9" class="img_vXGZ"></p><p>北京的冬天，迷蒙而又寒冷。</p><p>Go on.</p><p>We must go on.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mark_im-working-now-1642684242518-6a146c63f28bfb34254496a7b6a624a2827ba0e10260410ea9e9a798c86854ea.jpg" alt="picture 10" class="img_vXGZ"></p>]]></content:encoded>
            <category>札记</category>
            <category>工作</category>
        </item>
        <item>
            <title><![CDATA[札记 | 我的 2021：混沌与洞见]]></title>
            <link>https://markshawn2020.github.io/blog/2022/01/01/prose-my-2021</link>
            <guid>/2022/01/01/prose-my-2021</guid>
            <pubDate>Sat, 01 Jan 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[在《马男波杰克（Bojack Horseman）》第六季中戴安想写一部有深度的、关于“创伤”的书，书名较长：《One Last Thing and Then I Swear to God I'll Shut Up About This Forever Arguments, Opinions, Reflections, Recollections》，某字幕组将其翻译为：《再说最后一件事，然后我保证再也不提这事：关于我们做出的选择、伤害的人、去过的地方的最后反思》但是她失败了。我显然也不行。但是……]]></description>
            <content:encoded><![CDATA[<blockquote><p>在《马男波杰克（Bojack Horseman）》第六季中戴安想写一部有深度的、关于“创伤”的书，书名较长：《One Last Thing and Then I Swear to God I'll Shut Up About This Forever: Dispatches from the Frontlines of the War on Women: Arguments, Opinions, Reflections, Recollections》，某字幕组将其翻译为：《再说最后一件事，然后我保证再也不提这事：关于我们做出的选择、伤害的人、去过的地方的最后反思》但是她失败了。我显然也不行。但是……</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="启">启<a class="hash-link" href="#启" title="标题的直接链接">​</a></h2><p>这个题目，我想了很久，应该说，从年中就开始想了，一直想到前天，也就是 12 月 29 日才敲定，就叫：“混沌与洞见”。</p><p>但遗憾地是，混沌居多，洞见居少，哪怕仅有的一点，怕也是夏虫语冰，让大家见笑了。</p><p>但每每因我的弱薄，而不敢动笔之际，总有先人叮咛道：忘却的救世主就快到了啊。</p><p>可不，这会都已经是 2021 年最后一天的最后一个时辰了。</p><p>所以，总得说点什么吧。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="顾">顾<a class="hash-link" href="#顾" title="标题的直接链接">​</a></h2><p>网易有人云：“讲过去像是在卖惨，讲未来又像是白日做梦，讲现在又像是旁观者迷，迟迟无语，字字心酸”。</p><p>但我偏不信这样的鬼话。</p><p>毕竟，惨、梦、迷，乃是人生常态，不惨之人无有后发，不梦之人无有浪漫，不迷之人无有破局。</p><p>回顾这一年，满是奔赴满是期盼，既有满满的震撼与感动，也有条条的伤痕与不甘。</p><p>今年是项目实践年，应身边的前辈、老师、朋友、同学的邀请，我参与了大大小小多个项目的主开发：基于 React 的算法可视化平台，基于 OCR 与 NLP 的企业智能记账软件、基于爬虫与逆向的企业数据 BI、基于安卓系统的 VR 定制、基于 Electron 的大数据比对系统等等，涉及到了算法、前端、后端、数据、系统等程序开发的方方面面，同时也点亮了自己 Python, JavaScript, C++, Java 等主流语言的技术树。</p><p>在这些项目中，有许多遗憾，许多不尽人意的地方，一些放弃了，一些只做了个半成品。</p><p>如果说收获，应该是深度接触了不同的企业，对现在一些初期与中期的公司的发展路径、模式，有了较深的体会，这是以学生身份去实习很难体会到的，也是若直接奔赴大公司就便错过了的。</p><p>但最宝贵的是，在这些形形色色的项目上摸爬滚打后，我终于摸索出了一条可行之路：“整理之道”。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="整理之道">整理之道<a class="hash-link" href="#整理之道" title="标题的直接链接">​</a></h3><p>得益于当代计算机学科与软件技术的发展，一些公司开发出了非常优秀的程序化编辑软件，例如<code>sublime</code>, <code>atom</code>, <code>vscode</code> 等等，而我最终选用了<code>vscode</code>并初步成功打造了自己的知识库。</p><p>这里的关键词是 <strong>自己的知识库</strong>。</p><p>它是来自于书本、来自于生活、来自于工作、来自于互联网，经过自己的涓涓意念，最终汇成的属于自己全部工业知识的一个具体集合：</p><img loading="lazy" alt="picture 3" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-ca0545fd5db8cf93fc2c7195a3c5d368df9b0732ba071346d7eaaba791f4b6d1.png" width="480" class="img_vXGZ"><p>在形式上，我把所有正在学习的、以及将要学习的，都分类整理。</p><p>在路径上，我则是持续地将新的经验、想法、规划记录在整个文档库中。</p><p>而从这个文档库到现在，才短短一个月，就已经有整整十五万字。</p><img loading="lazy" alt="picture 4" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-72167e172bb0e2af5c8399dc730076f8e7ba6761cb5c865192b643af5383c42a.png" width="480" class="img_vXGZ"><h3 class="anchor anchorWithStickyNavbar_rB0w" id="如何定义">如何定义<a class="hash-link" href="#如何定义" title="标题的直接链接">​</a></h3><p>我有一段时间，应该说很长一段时间，都有在想一件事：在二十一世纪的当代，我们在这个世界上的存在，究竟该如何定义。</p><p>在我备考的这几年里，每年都会时不时听到各个地方学生跳楼的不幸事件，他们年轻的生命就以这样的形式退场了，只留下了如泣如诉的遗言。</p><p>我们，不该被这些定义。</p><p>我们，也不能被这些定义。</p><p>即使已经经历了三次考研失败的我，依旧觉得生命值得来过；而身边甚至还有正在经历第六次（也许是第七次）考研的朋友，仍在努力地为理想而奋斗着。</p><p>这既是一种执念，我不否认。</p><p>这也是一种人性的光辉，也许你不认同。</p><p>在有大风吹落黄花、夕阳洒满原野、繁星钻进窗台的日子里，我时不时，会走出屋子，有时会望向北方，那是天之骄子霍去病日进千里的傲然身姿；有时会望向西方，那是雪域高原的人们在时代的潮流里或彷徨或奋进的模样。</p><p>是的，比起考研、比起项目，今年我最感谢的是，西藏之旅。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="西行之旅">西行之旅<a class="hash-link" href="#西行之旅" title="标题的直接链接">​</a></h3><p>在某一篇马男的观后感里，有人用心理学知识阐述了马男背后的“自我实现的预言”理念：</p><img loading="lazy" alt="picture 6" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-40d15e665c1ee372d8bbab11eb83b13c7da8059e512c5a617df0bf2b62b9c167.png" width="480" class="img_vXGZ"><p>很有意思的是，我有一天偶然翻阅朋友圈，然后看到 2020 年末我写道：“我想去中西部走一步“。</p><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-cdd1af68402ddb8543f1541499e1d76e5e4742e8abc8023f819723169c26b457.png" width="480" class="img_vXGZ"><p>但在 2021 年整一年中，几乎都忘了这个小愿望。</p><p>直到 7 月份做完项目，我突然做了个决定，我要去骑行西藏，做出这个决定，我只花了一晚上的时间，然后就花了一周购买了各种装备，然后一个月半就都在路上了。</p><p>很难说，这不是“自我实现的预言”在背后捣鬼。</p><img loading="lazy" alt="picture 7" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-aca611ae41607af9e54975dc5a5b36a7e7267e1c988eb1710ecd765664b141e3.png" width="480" class="img_vXGZ"><img loading="lazy" alt="picture 8" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/MY2021-%7Btimestamp%7D-a2ed06ab08e8cfdd2ace8e62e27eb5038e73b1ee1c746859b52ae28d60a9a742.png" width="480" class="img_vXGZ"><p>但很遗憾的是，今天，我好像没有什么特别想做的。</p><p>如果有的话，那就是把我上文提到的个人文档库，即“整理之道”，继续坚持下去，坚持一年看看会有什么成效。</p><p>除此之外，我似乎进入了我个人的低欲望时代。</p><p>也许，这才是我的“本”。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="本">本<a class="hash-link" href="#本" title="标题的直接链接">​</a></h2><p>何为本。</p><p>民为邦本，本固邦宁。这是国之本。</p><p>那人之本呢？</p><p>人之本，应是人之立身之本。</p><p>这么些年来，我结交各种朋友、打各种比赛、研习各种知识，是的，那样纯粹的时光，是令人感动，让我感到充实的。</p><p>但那不是我的本。</p><p>马克思说，人是社会关系的总和。</p><blockquote><p>任何人都不可能脱离他所处身的社会、家庭，不可能脱离自己在不自觉状态下形成的性格、习惯、能力、价值观以及身体状况的控制来进行人生的全部选择，这些被控制的选择影响到周边的人与物，这些人与物又会对作出动作的物体进行反作用。社会关系同时也包含了这些个人与其他个人之间的全部互动。</p></blockquote><p>我向来，以为自己是自由的。</p><p>我自由地追逐着我所认为要追逐的，我自由地选择着我所认为要选择的。</p><p>但事实上，也许我在很多时候可以选择，但也有更多时候，我却无法拒绝。</p><p>逐渐地，我才真正意识到，也就是那两个大家经常会提起的词：责任，和义务。</p><p>若我不能选择完全自由，那我就要选择必须承担，这个选择，我已经无法拒绝。</p><p>考研的我，像一头蛮牛，连续三年在某个时间点疯狂发力。</p><p>第一年，在学校连续三个月，每天十八小时。</p><p>第二年，在朋友家两个月，进一步在身体与精神上约束自己。</p><p>第三年，在自己家两个月，我与母亲作着良久的斗争，我想，我已经找到我的答案了。</p><p>无源之水无本之木，无以有有。</p><p>有源之水有本之木，有以有无。</p><p>新的一年了，让岁月的属于岁月，让我们的属于自己，不求能与岁月争辉，但求无愧于本身。</p>]]></content:encoded>
            <category>札记</category>
            <category>年终总结</category>
        </item>
        <item>
            <title><![CDATA[编程 | 记与 Webpack 十二小时的奋战]]></title>
            <link>https://markshawn2020.github.io/blog/2021/12/24/dev-webpack</link>
            <guid>/2021/12/24/dev-webpack</guid>
            <pubDate>Fri, 24 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[2021 年 12 月 24 日]]></description>
            <content:encoded><![CDATA[<p>2021 年 12 月 24 日</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="content">Content<a class="hash-link" href="#content" title="标题的直接链接">​</a></h2><p>这篇必须用中文记录，而且直到目前还没有完全解决，只实现了一个还可以接受的替代方案，背后还有一些东西没弄明白。</p><p>先直接说结论：</p><ol><li>如果所有的依赖包都是<code>commonjs</code>形式（使用<code>require</code>和<code>module.export</code>），子包的<code>package.json</code>中没有定义<code>type: "module"</code>，则 webpack 无论怎么写，基本都不会出错，直接运行<code>webpack --config xxx.webpack.config.js</code>即可</li><li>如果<code>xxx.config.js</code>文件中使用了<code>import xxx from xx</code>或者子包都是用的<code>type: "module"</code>，则在项目的<code>package.json</code>中定义一些<code>type: "module"</code>，也可以解决问题</li><li>如果出现了<code>commonjs</code>和<code>esm</code>混用的情况，则会报错，要么导致<code>Cannot use import statement outside a module</code>，要么导致<code>mjs</code>等等无法导入因为有<code>type: module</code>之类的问题，下面着重说一下在该种情况下的解决方案</li></ol><p>我碰到的问题就是，我直接 clone 的 github 上的两个 boilerplate，一个是<code>electron-react-typescript-webpack-boilerplate</code>，还有一个是<a href="https://github.com/diego3g/electron-typescript-react#:~:text=electron-typescript-react" target="_blank" rel="noopener noreferrer">electron-typescript-react</a>，这两个 boilerplate 虽然配置有些差异，而且一个用到了<code>babel</code>一个没用，但是共同点就是<code>webpack.config.js</code>中都没有使用<code>import</code>语法，<code>webpack</code>的所有依赖也都是<code>commonjs</code>。</p><p>而我为了将<code>markdown</code>文件在前端渲染出来，虽然我可以直接使用<code>marked</code>或者<code>react-markdown</code>这类 package，但是基于以前<code>nextjs | gatsby</code>等框架的经验，直接基于<code>webpack</code>进行<code>markdown</code>解析体验会比较好（毕竟两个项目都用上<code>webpack</code>了）。</p><p>但是问题来了，我在<code>webpack</code>官网中找到加载<code>markdown</code>相关的<code>loaders</code>的 <a href="https://webpack.js.org/loaders/remark-loader/#inspiration" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a> 章节时，实际使用发现<code>remark-html</code>是<code>esm</code>，没法直接用，我的<code>webpack</code>会报错。</p><p>接着我就经历了 12 个小时的奋斗，尝试了几乎所有能找到的方案，从最基础的改<code>type: "module"</code>，到用上<code>babel-register</code>，甚至详细去读了<code>webpack</code>、<code>babel</code>的相关内容，最后不得不都以失败告终。其中应该说最有影响力、提供解决方案最多（然而最终都失败）的帖子应该是下面这个：</p><ul><li><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></li></ul><p>问题说的很清楚，就是要在<code>webpack.config.js</code>中使用<code>ES6</code>。</p><p>但答案都不 OK，最终，我在万念俱灰无数次之后，偶然在 <a href="https://github.com/vercel/next.js/discussions/27758" target="_blank" rel="noopener noreferrer">Bug at render-markdown stage of tutorial: Must use import to load ES Module · Discussion #27758 · vercel/next.js</a> 这个帖子里找到了一句话：<code>npm install remark@13 remark-html@13</code>，凭着经验，我一下就知道是怎么回事了，因为前两天我刚刚与万恶的<code>webstorm</code>不支持<code>tailwindcss</code>最新版最终不得不安装<code>tailwindcss@2.0.1-compat</code>做了同样艰苦的斗争！</p><img loading="lazy" alt="picture 5" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640346360145-webpack-bugfix-349711dd9f694e145b5dc4a1ddae42e2955043d9a23747857b50d1423368dd9f.png" width="480" class="img_vXGZ"><p>果然，安装指定的版本后，项目终于成功运行：</p><img loading="lazy" alt="picture 6" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640346477725-webpack-bugfix-7d4cd572dc5ec9fe5ad511c4156c56e047cbe30184b88b8c95601c1d21b1b02e.png" width="480" class="img_vXGZ"><p>至此，所有与<code>webpack</code>的斗争，应该说告一段落了，不然，我下一个更艰苦卓绝的打算，可能就是去看<code>nextjs</code>之类重型框架的源码，剖析它们是怎么高大上地使用<code>webpack</code>了。。</p><p>所以，目前，我可以确定的就是，只要保证所有<code>webpack</code>依赖的库都是<code>commonjs</code>，就可以不借助<code>babel</code>使项目运行，毕竟当一个前端项目需要用上<code>babel</code>的时候，它肯定就已经是另一个项目了，于是，一键 DELETE 恢复世界清净。</p><img loading="lazy" alt="picture 9" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347058731-webpack-bugfix-901426db9195c9d0a7ec92ef0370f3a94d57f35b9b78808b330f4929e3341574.png" width="480" class="img_vXGZ"><p>不过事实上，就像我开头说的，我 clone 了两个项目，其中一个用了 babel，用于转换<code>jsx</code>之类的文件的，它是基于<code>electron-forge</code>的，为了弄清楚当时的报错我还特意去看了这个库，说实话也没怎么弄明白。它的这个<code>boilerplate</code>对我最大的启发，应该是写了一个标准的<code>main</code>和<code>renderer</code>之间通信的接口，即：</p><ol><li>main 中暴露 api 给 renderer 使用的接口定义</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/@types/bridge.d.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'electron/bridge'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> global </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// eslint-disable-next-line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Window</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Main</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>main 中对 api 使用的收发封装</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// electron/bridge.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">contextBridge</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ipcRenderer</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'electron'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * Here you can expose functions to the renderer process</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * so they can interact with the main (electron) side</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * without security problems.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   *</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * The function below can accessed using `window.Main.sendMessage`</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">sendMessage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipcRenderer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">send</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'message'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   * Provide an easier way to listen to events</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">   */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function-variable function" style="color:#d73a49">on</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callback</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Function</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ipcRenderer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">channel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contextBridge</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exposeInMainWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Main'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这两个文件，包括 main 和 render 程序中如何使用这两个文件的写法对我还是有很好的指导作用的，至少 electron 官网上对 typescript 的范式介绍比较少，这就需要从这些 boilerplate 中寻找指点。</p><p>但除此之外，这个 boilerplate 对我的意义就不大了，而且，我也不怎么看得懂它给定的几个<code>scripts</code>，其实无法就是开发版、生产版、运行、打包与测试的不同命令，但是被他搞的有点负责，相比较之下，另一个 boilerplate 就很好，清晰明白，也有可能上半年我在学习 electron 的时候正好用的就是第二个 boilerplate，但无论怎样，确实第二个更好。</p><img loading="lazy" alt="picture 10" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347712904-webpack-bugfix-5b369e0dff7ff239ccac2debcdc0a1dbf626a177b96e8f07b9fb9cf1e9ef977c.png" width="480" class="img_vXGZ"><hr><img loading="lazy" alt="picture 11" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640347790778-webpack-bugfix-dec8b0f034c1fea196744e1f5f4d8772efad854d0a2d28d7858995617024a57e.png" width="480" class="img_vXGZ"><p>但为了确信这一点（2 比 1 好），我又重新去确认了一下 github 的 star 数，结果，并不是这样的，第一个 boilerplate 的 star 有 1.2k，而第二个只有 176，好家伙……我的直觉真不靠谱。</p><p>不过这也解释地通，因为第一个是叫<code>electron-typescript-react</code>，第二个叫<code>electron-react-typescript-webpack-boilerplate</code>，表面上后者是前者的具化，因为名词更多。</p><p>但事实上，恰恰相反，在<code>electron-typescript-react</code>中反而既有<code>webpack</code>也有<code>babel</code>，其实比另一个涉及的东西还有多……从这个角度想，第一个 boilerplate 星多，应该至少归结于三个点：</p><ol><li>名字短</li><li>加了<code>babel</code>，让使用者有了更多发挥的空间</li><li><code>bridge</code>的接口写的棒，对使用者有更大的价值</li><li>...</li></ol><p>Anyway，这大概就是关于目前这个问题的所有思考，和两个 boilerplate 带给我的启发。</p><p>接下来，才是工作的重头戏，那就是手上工具顺了，就要立即投身到业务实现上了。</p><p>但仍然，我开头说的还有一些问题是没有解决的，罗列如下：</p><ol><li>为什么<code>webpack</code>官网的所有<code>loader</code>的配置都是<code>import</code>导入的，难道他们所有的 dependencies 都是 esm 吗？</li><li>有可能不是，因为我还看到他们的有些 loader 可以使用<code>type: "auto"</code>这种配置，应该就是自动对多种 type 的 js 采取不同的策略智能打包的意思，但这个可以作用于<code>config.js</code>的抬头吗？好像不可以吧，因为我看他们是用在<code>rules</code>里的。</li><li>肯定存在很多<code>commonjs</code>和<code>esm</code>混用的项目的，如果不引入<code>babel</code>，<code>webpack</code>是否可以有策略正常运行呢？目前，他们都是基于<code>babel</code>的吗？</li><li>如果是基于<code>babel</code>，我认为我之前尝试装那么多<code>babel</code>依赖，应该也可以正常运行啊，为什么就不能奏效呢？</li></ol><p>关于第三点，我突然想到我上半年也写过脚本，翻出来看了一下： <img loading="lazy" alt="picture 12" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640348790672-webpack-bugfix-66129064c7e8a8c55c2161aad0bcce67f18e484b1cf913921f14bd01688a3542.png" width="480" class="img_vXGZ"></p><p>可以看到，确实是要用<code>babel_register</code>进行子程序注册的，并且我也确实是用<code>import</code>进行导包的： <img loading="lazy" alt="picture 13" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640348883256-webpack-bugfix-a0039a63671200450ee7bc85582444eecf757b3c9393f8bd3443e2b72b79dedd.png" width="480" class="img_vXGZ"></p><p>人老了啊，记性不行了，当时应该研究这些东西也花了一星期的，结果都一点印象没了，幸好好记性不如烂笔头，整理了当时的代码库。再回想开头看的那个关于<code>babel_register</code>的解决方案，内心突然就有些豁然开朗了： <img loading="lazy" alt="picture 14" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640349025625-webpack-bugfix-045d3c71ca84950c4a03136ad85db57f3652e3aa1f0600b59ebcdfd8eaf8c66f.png" width="480" class="img_vXGZ"></p><p>不过呢，至少这个项目，我应该暂时不需要了 hhh，如果需要，到时候<code>yarn add</code>一顿乱装，加个<code>babel-register</code>脚本，改一下启动命令行，应该就行了，hhh，肯定不会像今天这样头疼了。</p><p>那就暂时先这样，对该问题的记录到此为止。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="former-record">Former Record<a class="hash-link" href="#former-record" title="标题的直接链接">​</a></h2><blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="problem-syntaxerror-cannot-use-import-statement-outside-a-module">[Problem]<!-- --> SyntaxError: Cannot use import statement outside a module<a class="hash-link" href="#problem-syntaxerror-cannot-use-import-statement-outside-a-module" title="标题的直接链接">​</a></h3><p>This discussion is very close to what I happened to, however they gave no solution, except pointed out that there may be some package using <code>es</code> which seems <strong>not proper for webpack</strong>, and inspired me to have a check at <a href="#the-target-package-of-remark-html-i-wanted-to-import">the target package</a> I wanted to import as official webpack suggested me to.</p><ul><li><a href="https://stackoverflow.com/questions/70114861/why-does-error-syntaxerror-cannot-use-import-statement-outside-a-module-when" target="_blank" rel="noopener noreferrer">javascript - Why does Error 'SyntaxError: Cannot use import statement outside a module ' when I try to use ES Modules? - Stack Overflow</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="the-target-package-of-remark-html-i-wanted-to-import">The target package of <code>remark-html</code> I wanted to import<a class="hash-link" href="#the-target-package-of-remark-html-i-wanted-to-import" title="标题的直接链接">​</a></h3><ul><li><a href="https://webpack.js.org/loaders/remark-loader/#root" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="failed-solution-of-babel-node">[Failed]<!-- --> Solution of <code>babel-node</code><a class="hash-link" href="#failed-solution-of-babel-node" title="标题的直接链接">​</a></h3><p>It seems that <code>babel-node</code> is a possible solution to this problem, since it when I installed it, it automatically detected what's going wrong of all my webpack loaders.</p><img loading="lazy" alt="picture 1" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640327908025-webpack-bugfix-51cf4a831368a2ef7d3cf8957e88c6c5f9528ec63aa21ab93ff4602781cdc6cd.png" width="480" class="img_vXGZ"><h3 class="anchor anchorWithStickyNavbar_rB0w" id="failed-solution-of-babelregister">[Failed]<!-- --> Solution of <code>@babel/register</code><a class="hash-link" href="#failed-solution-of-babelregister" title="标题的直接链接">​</a></h3><ul><li><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></li></ul></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="真正唯一的收获">真正唯一的收获<a class="hash-link" href="#真正唯一的收获" title="标题的直接链接">​</a></h2><p>前段时间有个字节的小姐姐，和我表述想转码的意愿，聊下来觉得前端对她可以一试，毕竟目前各种开发岗位里前端是相对来说最容易上手的了……</p><p>但是！</p><p>这说的只是十二十年前纯粹用<code>html + css + jquery</code> 或者 <code>php</code>的时代！</p><p>现在，前端技术突飞猛进，各种范式层出不穷，变得越来越复杂了，三大框架<code>AngularJS | React | Vue</code>就不说了，<code>webpack</code>和<code>babel</code>绝对能让大厂的前端开发掉一层皮……</p><p>但 anyway，如果不论这些，平时写写前端真地能让人心情大好，获得感十足，用一位朋友对开发的态度来说：“平时自己写些玩玩挺好的，当做工作就太无聊了”，确实如是~</p><p>保持学习，保持热爱！ <img loading="lazy" alt="picture 15" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/1640349694440-webpack-bugfix-7adf1882ddf381568cee583516f84f77d56237f255c73a5bcceb153755794696.png" width="480" class="img_vXGZ"></p><p>reference:</p><ul><li><p><a href="https://blog.logrocket.com/transpile-es-modules-with-webpack-node-js/" target="_blank" rel="noopener noreferrer">How to transpile ES modules with webpack and Node.js - LogRocket Blog</a></p></li><li><p><a href="https://stackoverflow.com/questions/31903692/how-can-i-use-es6-in-webpack-config-js" target="_blank" rel="noopener noreferrer">How can I use ES6 in webpack.config.js? - Stack Overflow</a></p></li><li><p><a href="https://github.com/diego3g/electron-typescript-react" target="_blank" rel="noopener noreferrer">diego3g/electron-typescript-react: An Electron boilerplate including TypeScript, React, Jest and ESLint.</a></p></li><li><p><a href="https://github.com/Devtography/electron-react-typescript-webpack-boilerplate" target="_blank" rel="noopener noreferrer">Devtography/electron-react-typescript-webpack-boilerplate: Pre-configured boilerplate for Electron + React + TypeScript + Webpack</a></p></li><li><p><a href="https://webpack.js.org/loaders/remark-loader/#inspiration" target="_blank" rel="noopener noreferrer">remark-loader | webpack</a></p></li><li><p><a href="https://github.com/vercel/next.js/discussions/27758" target="_blank" rel="noopener noreferrer">Bug at render-markdown stage of tutorial: Must use import to load ES Module · Discussion #27758 · vercel/next.js</a></p></li><li><p><a href="https://www.electronforge.io/templates/typescript-+-webpack-template" target="_blank" rel="noopener noreferrer">TypeScript + Webpack - Electron Forge</a></p></li><li><p><a href="https://www.electronjs.org/zh/docs/latest/api/ipc-main" target="_blank" rel="noopener noreferrer">ipcMain | Electron</a></p></li></ul>]]></content:encoded>
            <category>开发笔记</category>
            <category>Webpack</category>
            <category>前端</category>
        </item>
        <item>
            <title><![CDATA[一道“全军覆灭”的数学题]]></title>
            <link>https://markshawn2020.github.io/blog/2021/12/04/一道“全军覆灭”的数学题</link>
            <guid>/2021/12/04/一道“全军覆灭”的数学题</guid>
            <pubDate>Sat, 04 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[image-20211204223602555]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204223602555.png" alt="image-20211204223602555" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204223612892.png" alt="image-20211204223612892" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="一道全军覆灭的数学题">一道“全军覆灭”的数学题<a class="hash-link" href="#一道全军覆灭的数学题" title="标题的直接链接">​</a></h2><p>请问如下解法是否正确？</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204223636611.png" alt="image-20211204223636611" class="img_vXGZ"></p><p>今天研友“北化”在群里转了一道题，给了一个解法，询问对否。</p><p>我认为是对的，但 chen 姐认为不对，后来经 chen 姐提点，我也意识到了确实不对。</p><p>然后我转给朋友们，结果他们都认为对。</p><p>我继续向他们解释，他们依旧认为自己是对的……</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="该解法的错误原因">该解法的错误原因<a class="hash-link" href="#该解法的错误原因" title="标题的直接链接">​</a></h2><p>在众多参考书上，积分中值定理的结论，都是“存在一点，使之成立”，但是并未明确指出该点到底是哪一点。</p><p>这就带来了一定的困扰，例如本题，解法中存在一点，处于 0 到 1 之间，它的 n 次方（$n\to +\infty$时）确实是 0，所以一顿解下来，好像无比顺畅。</p><p>然而，问题就出在这个点上！</p><p>如果这个点是$(0, 1)$上的一个<strong>常数</strong>，那必有</p><p>$$
\lim_{n\to\infty}{a}^n = 0, a\in(0,1)
$$</p><p>但如果这个点不是常数，而是一个函数，尤其是，是一个关于 n 的函数，就不一定了。比如：</p><p>$$
\lim_{n\to\infty}{(1-\frac{1}{n})}^n = \frac{1}{e}\ne0
$$</p><p>所以，根据 chen 姐的指点，使用积分中值定理时，一定要尤其注意，点是常数还是函数！这点，在绝大多数题目中都不曾涉及，但 chen 姐毕竟是 T 大数学科班，基础功着实扎实，令人羡慕。</p><p>你学废了嘛~</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="该题的正确解法">该题的正确解法<a class="hash-link" href="#该题的正确解法" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204224852473.png" alt="image-20211204224852473" class="img_vXGZ"></p><p>说实话……还是挺难的。</p><p>不过核心不是拉格朗日，而是放缩。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="再举一例考研教材需要背锅的题">再举一例考研教材需要背锅的题<a class="hash-link" href="#再举一例考研教材需要背锅的题" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204225044431.png" alt="image-20211204225044431" class="img_vXGZ"></p><p>这一题，最有意思的地方，是它的考察对象是不可逆矩阵的伴随矩阵，而绝大多数教材都只探讨了可逆矩阵的伴随矩阵的兴致，比如：</p><p>$$
\begin{align<em>}
&amp;若A可逆，其特征值为\lambda_1, \lambda_2, \lambda_3，则有：<!-- -->\<!-- -->
&amp;A^</em>的特征值为\frac{|A|}{\lambda_1},\frac{|A|}{\lambda_2},\frac{|A|}{\lambda_3}
\end{align*}
$$</p><p>我翻了李正元的全书，在矩阵和向量组两章内的探讨基本都止步于此，没有什么证明，也绝没有探讨到不可逆矩阵的伴随矩阵的特征值分析。</p><p>接下来给出本题的特征值求法：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211204225424037.png" alt="image-20211204225424037" class="img_vXGZ"></p><p>可以看到，是用相似定义化对角矩阵去求的，不过这种求法，不是通法，毕竟该题规定了 A 是实对称矩阵。</p><p>但是很容易可以看到，在解最后一个对角矩阵时，每一个特征值都是由另外两个特征值乘积得到的。</p><p>于是乎，我们不妨假想：</p><p>$$
\begin{align<em>}
&amp;对于可逆或不可逆矩阵A，其特征值分别为\lambda_1, \lambda_2, \lambda_3，<!-- -->\<!-- -->
&amp;则有，A^</em>的特征值为\lambda<em>2 <em> \lambda_3, \lambda_3</em>\lambda_1, \lambda_1 <em> \lambda_2，<!-- -->\<!-- -->
&amp;而当A可逆时，则正好有\frac{|A|}{\lambda_1},\frac{|A|}{\lambda_2},\frac{|A|}{\lambda_3}，因为|A| = \lambda_1 \times \lambda_2 \times \lambda_3<!-- -->\<!-- -->
&amp;而当A不可逆时，由于|A|=0，无法基于|A|除以各\lambda_i得到A</em>的特征值，<!-- -->\<!-- -->
&amp; 但\prod</em>{j\ne i}^{n}{\lambda_j}依旧可用
\end{align*}
$$</p><p>是否对每个矩阵，甚至对于 N 阶矩阵都有这样的性质呢？我不知道，不敢断言，我只知道，考研教材很多时候都只是把精华喂给你，至于怎么来的，就需要自己琢磨了，因此基本功非常重要。对于所有考研数学的人来说，至少预留给数学 3 个月以上的时间，绝对是不夸张的，如果你想考高分的话。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[考研数学试题编辑]]></title>
            <link>https://markshawn2020.github.io/blog/2021/12/04/考研数学试题编辑</link>
            <guid>/2021/12/04/考研数学试题编辑</guid>
            <pubDate>Sat, 04 Dec 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[---]]></description>
            <content:encoded><![CDATA[<hr><p>$$
设X_1, X_2,\dots X_n 是来自标准正态总体N(0, 1)的简单随机样本，<!-- -->\<!-- -->
其均值和方差分别为\bar{X}和S^2,记T=\bar{X}+S^2，试求：E(T^2) <!-- -->\<!-- -->
source: 全书P562
$$</p><hr><p>问：</p><p>$$
当X_1, X_2, \dots, X_n \sim N(\mu_1, \sigma_1^2), \ Y_1, Y_2, \dots, Y_m \sim N(\mu_2, \sigma_2^2)时，<!-- -->\<!-- -->
为啥有F=\dfrac{S_X^2/\sigma_1^2}{S_Y^2/\sigma_2^2}\sim F(\sigma_1, \sigma_2)?<!-- -->\<!-- -->
不应该是\dfrac{(n-1)S_X^2/\sigma_1^2}{(m-1)S_Y^2/\sigma_2^2}\sim F(\sigma_1, \sigma_2)吗？
$$</p><p>答：$F$函数的上下要分别再除以$n-1、m-1$!</p><hr><p>$$
设总体X服从参数为p的0-1分布，<!-- -->\<!-- -->
则来自总体X的简单随机样本X_1, X_2,\dots,X_n的概率分布为<!-- -->_<!-- -->_<!-- -->_<!-- -->_<!-- -->_<!-- -->_<!-- -->？<!-- -->\</p><p>答案是：<!-- -->\<!-- -->
p(x_1, x_2,\dots, x_n) =
\begin{cases}
p^{n\bar{x}}(1-p)^{n(1-\bar{x})}, &amp;x_i = 0或1  <!-- -->\<!-- -->
0, &amp;o.w</p><p>\end{cases}
$$</p><hr>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[关于正态分布表的一个有趣发现]]></title>
            <link>https://markshawn2020.github.io/blog/2021/11/28/今天南川学习十小时了吗？是的。</link>
            <guid>/2021/11/28/今天南川学习十小时了吗？是的。</guid>
            <pubDate>Sun, 28 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[image-20211128211649811]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211128211649811.png" alt="image-20211128211649811" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211128211735351.png" alt="image-20211128211735351" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于正态分布表的一个有趣发现">关于正态分布表的一个有趣发现<a class="hash-link" href="#关于正态分布表的一个有趣发现" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/70.png" alt="正态分布表" class="img_vXGZ"></p><p>今天做到一道题，要用到 $\Phi (1)=0.84$和$\Phi(0.25)=0.6$，当然，这种数如果是考试肯定会直接给出相应的数值，具体等于多少不需要记。</p><p>但就在我去研究一下正态分布表后发现，几个特殊的值非常好记，也就是从$\Phi(0)=0.5$开始，你会发现，$x$每增加 0.25，$\Phi(x)$就增加 0.1，0.09，0.08，0.07（这个时候已经到$\Phi(1)$了），接着就跳过 0.06，增速变成 0.05,0.04,0.03,0.02,0.01,0。这也太有意思也太好记了！</p><p>很容易知道，比如说九坤这家公司的口号是招聘市场上两个$\sigma$之外的人才，我都不用记$\Phi(2)$是多少，</p><p>直接心酸算</p><p>$$
n = 2 \times 4 = 8<!-- -->\<!-- -->
d<em>i = 0.1, 0.09, ..., <!-- -->\<!-- -->
\sum</em>{i=1}^{n} {d<em>i}=\dfrac{(0.10+0.02)*9}{2} - 0.06 = 0.48<!-- -->\<!-- -->
\therefore \Phi(2) =\Phi(0)+\sum</em>{i=1}^{n}{d_i}= 0.5 + 0.48 = 0.98
$$</p><p>也就是 Top 2%。</p><table><thead><tr><th>x</th><th>$\Phi(x,2)$</th><th>$\Delta \Phi(x, 2)$</th></tr></thead><tbody><tr><td>0</td><td>0.5</td><td></td></tr><tr><td>0.25</td><td>0.6</td><td>+0.1</td></tr><tr><td>0.5</td><td>0.69</td><td>+0.09</td></tr><tr><td>0.75</td><td>0.77</td><td>+0.08</td></tr><tr><td>1</td><td>0.84</td><td>+0.07</td></tr><tr><td>1.25</td><td>0.89</td><td>+0.05</td></tr><tr><td>1.5</td><td>0.93</td><td>+0.04</td></tr><tr><td>1.75</td><td>0.96</td><td>+0.03</td></tr><tr><td>2</td><td>0.98</td><td>+0.02</td></tr><tr><td>2.25</td><td>0.99</td><td>+0.01</td></tr><tr><td>2.5</td><td>0.99</td><td>+0</td></tr><tr><td>2.75</td><td>1</td><td></td></tr><tr><td>3</td><td>1</td><td></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于昨天那道题">关于昨天那道题<a class="hash-link" href="#关于昨天那道题" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="题目">题目<a class="hash-link" href="#题目" title="标题的直接链接">​</a></h3><p>甲乙二人轮流投篮，甲先开始，甲每轮投一次，乙每轮投两次，甲乙每次投篮命中率分别为 p 和 0.5，求当 p 等于多少时，甲乙胜负概率相等</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解答">解答<a class="hash-link" href="#解答" title="标题的直接链接">​</a></h3><p>$$
\begin{align}</p><p>\because \left<!-- -->{<!-- -->
\begin{array}{l}
P(甲胜) &amp;  = p + (1-p)\times \frac{1}{4}\times P(甲胜)  &amp; = \dfrac{4p}{3+p} <!-- -->\</p><p>P(乙胜) &amp;  = (1-p)\times \frac{3}{4} + (1-p)\times \frac{1}{4}\times P(乙胜)  &amp; = \dfrac{3(1-p)}{3+p} <!-- -->\<!-- -->
\end{array}
\right .
\newline</p><p>\begin{array}{l}
\therefore  P(甲胜) = P(乙胜) &amp; = &gt; 4p  = 3(1-p) &amp; = &gt; p  = \frac{3}{7} &amp;&amp;&amp;&amp;&amp;&amp;
\end{array}</p><p>\end{align}
$$</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="评注">评注<a class="hash-link" href="#评注" title="标题的直接链接">​</a></h3><p>这题来自全书，答案是用模拟每次投篮做的，写的很繁，但是用我们昨天讨论的不变式去做就非常简单与快速。</p><p>不过要小心，这种解法只适合“无记忆性”的题目，即新的每一轮几乎与过去没啥关系，假如我们加个约束条件，比如假定 10 轮内甲乙胜负概率相等，那就只能用模拟法了，因为已经发生的 k 轮对接下来的 10-k 轮的讨论可能有影响。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于无记忆性的指数分布">关于无记忆性的指数分布<a class="hash-link" href="#关于无记忆性的指数分布" title="标题的直接链接">​</a></h2><p>指数分布是无记忆性的，即当$x&gt;0$时，$P(X&gt;s+t | X&gt;s)=P(X&gt;t)$，它常用来描述一些电子元器件的使用寿命。</p><p>这不禁让我豁然开朗，怪不得众多手机都不给出电池的预期使用寿命，毕竟服从指数分布，意味着假如期望寿命是一年的话，一年后电池如果没话，说明还能继续再用一年……以此类推……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211128221637865.png" alt="image-20211128221637865" class="img_vXGZ"></p><p>基于这个结论，我突然想起一部剧：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211128221930466.png" alt="image-20211128221930466" class="img_vXGZ"></p><blockquote><p>国立：</p><p>哥啊，这人生的路怎么那么难走啊！</p><p>葛优：</p><p>可不是！</p><p>打在胎里就随时有可能流产当妈的一口烟就可能长成畸形长慢了心脏缺陷 长快了就六指好容易扛过十个月生出来了一不留神 还得让产夹钳把脑袋夹扁了都多过去了 小儿麻痹 百日咳猩红热 大脑炎 还在前边等着呢哭起来呛奶 走起来摔跤摸水水烫 碰火火燎是个东西撞上 咱就是个半死钙多了不长个 钙少了吧罗圈腿总算混到会吃饭能出门了天上下雹子 地下跑骑车大街小巷是个暗处就躲着坏人你说赶上谁都是个九死一生不送命也得落个残疾</p><p>国立：</p><p>这都是明枪 还有暗箭呢 势利眼 冷脸子 闲言碎语 指桑骂槐好了遭人嫉妒 差了让人瞧不起忠厚人家说你傻 精明了人家说你奸冷淡了大伙说你傲 热情了群众说你浪走到前边挨闷棍 走到后边全没份</p></blockquote><p>听起来很有道理，但我们似乎过于感性了，再仔细想想，会发现人的寿命或者生存能力啊，就有点像这指数分布，你一定熬过去了，在新的起点，能再活多少年的期望，和新人是一样（而非衰减）的！</p><p>所以人生路虽难，人却并不脆弱，反而更有可能越挫越勇，最终泰山崩于前而色不变，无惧生命中任何波澜。</p><p>网友注脚：“但是生而为人，我很精彩！就凭这九死一生我也得打起精神去走一走那非线性人生！”大抵也是这个意思吧~</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后如果有一天你坚持不下去了">最后，如果有一天你坚持不下去了……<a class="hash-link" href="#最后如果有一天你坚持不下去了" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.22.19.png" alt="截屏2021-11-28 下午1.22.19" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.22.28.png" alt="截屏2021-11-28 下午1.22.28" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.25.40.png" alt="截屏2021-11-28 下午1.25.40" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.25.43.png" alt="截屏2021-11-28 下午1.25.43" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.25.47.png" alt="截屏2021-11-28 下午1.25.47" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.41.39.png" alt="截屏2021-11-28 下午1.41.39" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.41.50.png" alt="截屏2021-11-28 下午1.41.50" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.41.52.png" alt="截屏2021-11-28 下午1.41.52" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%881.48.11.png" alt="截屏2021-11-28 下午1.48.11" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.06.07.png" alt="截屏2021-11-28 下午2.06.07" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.13.50.png" alt="截屏2021-11-28 下午2.13.50" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.21.45.png" alt="截屏2021-11-28 下午2.21.45" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.22.06.png" alt="截屏2021-11-28 下午2.22.06" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.23.14.png" alt="截屏2021-11-28 下午2.23.14" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.55.39.png" alt="截屏2021-11-28 下午10.55.39" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.05.png" alt="截屏2021-11-28 下午10.43.05" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.08.png" alt="截屏2021-11-28 下午10.43.08" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.14.png" alt="截屏2021-11-28 下午10.43.14" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.16.png" alt="截屏2021-11-28 下午10.43.16" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.22.png" alt="截屏2021-11-28 下午10.43.22" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.29.png" alt="截屏2021-11-28 下午10.43.29" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.31.png" alt="截屏2021-11-28 下午10.43.31" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.32.png" alt="截屏2021-11-28 下午10.43.32" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.35.png" alt="截屏2021-11-28 下午10.43.35" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.41.png" alt="截屏2021-11-28 下午10.43.41" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.44.png" alt="截屏2021-11-28 下午10.43.44" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.46.png" alt="截屏2021-11-28 下午10.43.46" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.48.png" alt="截屏2021-11-28 下午10.43.48" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.51.png" alt="截屏2021-11-28 下午10.43.51" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.54.png" alt="截屏2021-11-28 下午10.43.54" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.57.png" alt="截屏2021-11-28 下午10.43.57" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.43.58.png" alt="截屏2021-11-28 下午10.43.58" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.00.png" alt="截屏2021-11-28 下午10.44.00" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.02.png" alt="截屏2021-11-28 下午10.44.02" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.05.png" alt="截屏2021-11-28 下午10.44.05" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.20.png" alt="截屏2021-11-28 下午10.44.20" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.26.png" alt="截屏2021-11-28 下午10.44.26" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.44.29.png" alt="截屏2021-11-28 下午10.44.29" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.45.15.png" alt="截屏2021-11-28 下午10.45.15" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.45.16.png" alt="截屏2021-11-28 下午10.45.16" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.45.31.png" alt="截屏2021-11-28 下午10.45.31" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.45.59.png" alt="截屏2021-11-28 下午10.45.59" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.46.03.png" alt="截屏2021-11-28 下午10.46.03" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%8810.46.07.png" alt="截屏2021-11-28 下午10.46.07" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.26.37.png" alt="截屏2021-11-28 下午2.26.37" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.26.47.png" alt="截屏2021-11-28 下午2.26.47" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.38.48.png" alt="截屏2021-11-28 下午2.38.48" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.42.13.png" alt="截屏2021-11-28 下午2.42.13" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.43.00.png" alt="截屏2021-11-28 下午2.43.00" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.47.52.png" alt="截屏2021-11-28 下午2.47.52" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.48.11.png" alt="截屏2021-11-28 下午2.48.11" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.50.12.png" alt="截屏2021-11-28 下午2.50.12" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.50.15.png" alt="截屏2021-11-28 下午2.50.15" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.50.17.png" alt="截屏2021-11-28 下午2.50.17" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.50.24.png" alt="截屏2021-11-28 下午2.50.24" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%882.59.06.png" alt="截屏2021-11-28 下午2.59.06" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.10.40.png" alt="截屏2021-11-28 下午3.10.40" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.14.29.png" alt="截屏2021-11-28 下午3.14.29" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.15.05.png" alt="截屏2021-11-28 下午3.15.05" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.15.15.png" alt="截屏2021-11-28 下午3.15.15" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.15.35.png" alt="截屏2021-11-28 下午3.15.35" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.15.41.png" alt="截屏2021-11-28 下午3.15.41" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.17.37.png" alt="截屏2021-11-28 下午3.17.37" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-11-28%20%E4%B8%8B%E5%8D%883.19.28.png" alt="截屏2021-11-28 下午3.19.28" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[浅谈我自学编程的经历与经验]]></title>
            <link>https://markshawn2020.github.io/blog/2021/11/09/浅谈我自学编程的经历与经验</link>
            <guid>/2021/11/09/浅谈我自学编程的经历与经验</guid>
            <pubDate>Tue, 09 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[近日在“百忙”之中终于下定决心刷完了美剧《硅谷》，内心激撞起来的波澜久久地不能平静。]]></description>
            <content:encoded><![CDATA[<p>近日在“百忙”之中终于下定决心刷完了美剧《硅谷》，内心激撞起来的波澜久久地不能平静。</p><p>尤其是剧中谈到 Gilfoyle 的自学时，更是让我不能自己，有那么一刻，我觉得他就是我，我就是他（显然，不够资格）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/iShot2021-11-06%2013.55.09.png" alt="Gilfoyle 10 years after" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/iShot2021-11-05%2001.23.56.png" alt="Gilfoyle 10 years before" class="img_vXGZ"></p><p>事实上，自学编程是一件听起来很酷，然而各中心酸只能自己体会的一件事。学，永远无止境，学到什么时候才是一个头呢？</p><p>寒冬乍临，阳光可爱，且将自己的思绪细细梳理一番，如若能给远方的朋友带去一点启示，便是本文最大的福报了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="溯">溯<a class="hash-link" href="#溯" title="标题的直接链接">​</a></h2><p>我是什么时候开始接触编程的呢？</p><p>最早，是在 2013 年，浅浅地在课上接触了 C 语言，考试低分飘过，旋即束之高阁。</p><p>2015 年牛市到来，我开始沉迷股市指标设计，在两个月内独立设计了数十个原创指标，推向市场，赚到第一桶金。时至今日，还有很多人在使用我的指标以辅助自己的投机决策。那个时候，我才开始意识到编程的价值，但还只是把它当做金钱利益的驱使下的一种工具。</p><p>两年后，在一场同花顺量化程序设计比赛中我只是简单地实现了一个小碎步多阳的策略，便斩获了省一等奖。我那时候才知道两年前用的指标开发语言叫做“lua”，一种很适合当做脚本的轻量编程语言。另外也意识到了，人与人之间的差异大到难以想象，冰冻三尺非一日之寒，我们能有几个平地起高楼的契机呢。不过当时，我已对股市指标没有太大兴趣。</p><p>2018 年寒假的时候，随着大数据、人工智能实在太火热，我在家学习了一门新的编程语言：python。我当时最感兴趣的是爬虫，只要学会了 python，我就可以很轻松地批量获取网上的数据，为自己加工分析使用。后来证明，这是我一生中最重要的选择之一，它改变了接下来几年我的生长轨迹。</p><p>当然，提到爬虫，就不得不提一个很“肤浅”的人：小甲鱼。他很厉害，做了一个论坛，里面有很多编程语言的教学，我的 python 就是从他那里入门的。至今留给我印象最深刻的话就是：<strong>等哪一天我不在了，我的爬虫会依旧在网络上，替我看着这个世界。</strong>这是我接触编程以来，听过的最浪漫的一句话，而且还不是对某个碳基生物说的。</p><p>但之后我便再没看过小甲鱼的任何视频了，因为很快我会发现，严肃的学习更有价值。我开始转向了学院派的教程，比如北理工的嵩天老师，以及北航的崔庆才同学在大学时完成的一部著作《python3 网络爬虫实战》。</p><p>经过这些系统学习，我很快将自己的爬虫提升到了一个从业人员的水平，并撬开了一些优秀公司的实习大门。</p><p>当然，也就是在那一年，我开始被身边的朋友邀请参加一些编程比赛。第一场比赛就是华为的软件精英挑战大赛，一场我们学校除了我之外不会有人参加的比赛。那个时候，我才开始了解到时空复杂度、二分算法、最优化等计算机基础概念。</p><p>也不知参赛选手水平太一般还是咋的，我非常朴素的算法与设计，竟然成功晋级，并且一度登顶榜首。后来参加区域赛，由于 python 程序实在太慢和不会高级算法等问题，只拿到第六，遗憾淘汰。但也因此和一批科班同学开始结缘，我的编程之路便开始越走越远了。</p><p>当年华为软挑的决赛主体是 AI，也为我的学习指明了一个方向。我从纯粹的数据获取（爬虫）转向了数据分析（AI），于是开始系统学习 pandas、pytorch 等主流数据分析工具，继续参加了 KPMG、九坤等企业的数据分析相关比赛，小有所获。</p><p>紧接着又报名了 2019 年的华为软挑，主题是纯 AI。但令我震惊的是，评分规则竟然考虑了程序运行速度，并且限制了 pytorch 等机器学习工具的使用，所有机器学习框架几乎需要自己手动搭建。这既给了我压力也给了我挑战，在连续摸索一周后，我成功自主实现了一个纯 numpy 的机器学习小框架，并且在使用 python 的程序中跑出了最好的成绩。</p><p>但很遗憾，速度上， 要比 C++、Java 选手要慢上一到两个数量级，前排成绩已经几乎被 C++占满了，我自知没有希望晋级了，只能再次遗憾退场。C++成为了我的一个心结。但我并没有很快开始学习 C++，因为我一直很惧怕它，在我的认知里，C++是世上最难学的编程语言。</p><p>在那些日子里，我一方面创办了学校的金融科技协会，企图带领一批同学掌握编程技术，从而提高自己的竞争力，尤其是在金融行业。另一方面，我的目光投向了另一门编程语言：JavaScript。这是由于我同时给很多院校老师与校外企业人员提供爬虫服务，而这些大量的数据，就很适合基于网站呈现出来，而为了搭建网站，我先后学习了 python 体系里的 django 框架，但并不满意。考虑到目前的主流前端语言都是 JavaScript，所以我就选择了它。</p><p>JavaScript 是我的第二门编程语言，如果不考虑 C、lua、vba、matlab、R 等的话。</p><p>基于 JavaScript，一个全新的、多彩的程序员世界就为我打开了。各种前端框架 Vue、React，各种 UI 库 AntD、ElementUI、MaterialUI，各种跨端开发工具 UniApp、Taro、Electron，各种博客开发框架 Gatsby、Nest、Next、Nuxt，以及现在火到一塌糊涂的 NodeJS、TypeScript、ReactNative 等，几乎让人眼花缭乱，而这些都是基于 JavaScript 的。只要你使用浏览器，都会不可避免地和它们打交道。</p><p>所以，如果现在有人问我只学一门编程语言，我会推荐学什么，我想，那一定是 JavaScript，真地非常有用武之地。（如果不考虑工作要求，比如四大要会 VBA，投行要会 Python，互联网要会 Java 的话。）</p><p>基于 Python 和 JavaScript，我已经积累了数十个前后端项目开发的经验，这个时候新的瓶颈就出现了，一个是性能，一个是稳健性。关于前者，它的补救方案是 C++；关于后者，它的补救方案则是 Java。（此处不考虑 Go 和 Rust，这两门语言一般是公司需求，到时候需要啥就学啥即可，不需要自己自学掌握）</p><p>Java 在当代企业中，仍然扮演着非常重要的角色， 中大型软件几乎都是由 Java 开发的，但我显然，作为个人，还没有那么强烈的需求，因此 Java 的学习优先级不高。但为了准备计算机考研面试，我学习了 C++，也就是 2020 年初，我又花了一个月将一本《C++ Prime Plus》从头到尾读完，并使用了 C++完成了力扣上两百多道算法题。</p><p>至此，C++正式成为我的第三门编程语言，尤其是经历了与 gcc 和 clang 编译的魔鬼较量后。</p><p>同时，我也转入对 JavaScript+Java 的升级版语言 TypeScript 的学习，因为它提供了更加丰富的类型校验，允许我用类 JavaScript 语法写出 Java 级别的稳健程序，尤其是接口（Interface）的概念，深深地影响了我。也就是在这个时候，我意识到了，我的编程学习之路，是一条逆向生长的曲线，我的语言学习难度越来越高了，我对程序的要求也越来越高了。</p><p>在使用 TypeScript+Python 完成一个中等项目的开发后，我殷切盼望着第四门编程语言的学习契机，也就是这个风靡全球的 Java。</p><p>Java 可以说是年少的白月光了，早在诺基亚手机时代，每个程序打开时出现的一杯咖啡的 Java 动画，便是我一生的仰望。很可惜，那样崇拜一门编程语言的心理，一去不复返了。现如今，Java 的地位持续遭受着 JavaScript、Rust、Go 等语言的冲击，如今物联网与 AI 的火热，也逐步侵蚀与渗透着 Java 的生态环境。</p><p>它很好，一直很好，但它不再是 first choice。</p><p>于是，机缘巧合之下，今年 6 月份，我冒险地承接了一个安卓系统开发的项目，深度研究了 Java、Android 等领域，做出了一些有趣的程序。</p><p>这标志着，第四门编程语言：Java，也正式进入我的技术栈了。</p><p>从每个科班都会必学的 C，到自学的 Python、JavaScript/TypeScript、C++和 Java，这一路走来，恍然发现已经过了 3 到 8 年的时光，也是我目前生命中最重要的 3 到 8 年的时光，我们称之为，青春的时光。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211109160215551.png" alt="一些项目存档" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="观">观<a class="hash-link" href="#观" title="标题的直接链接">​</a></h2><p>与前几年刚刚接触编程语言并尝到甜头于是转而卖命宣传编程学习的重要性的心态不同，现在，是时候站在一个新的高度、新的立场去重新审视学习编程这一门“生意”。</p><p>我已经不太喜欢去讨论，学习编程难不难的问题了，毕竟，离那个我可能觉得编程难的记忆，已经很遥远很遥远了。</p><p>我更加喜欢讨论：</p><ul><li>你适合学习编程吗？</li><li>你愿意付出到什么地步。</li></ul><p>我想，这些是相对来说，比较重要的问题。</p><p>坦白说，我现在也已经不向对没有接触编程或者不感兴趣的同学去推荐学习编程了。这里面最重要的原因，是我意识到，编程说小了是一门技术，说大了则关乎个人性格。</p><p>由于我同时具有互联网、金融以及互联网金融（区块链）行业的实习或工作经历，我很长一段时间都在思考，每种工作需要的不同技术栈，以及对于一个人人格、气质方面的塑造。</p><p>毫无疑问，直到现在，计算机和金融，依旧是收入最高的两个行业，然在就业选择上，即使是一个“堡垒”（样样都会）级别的高学历同学，我也不推荐 TA 直接从事计算机行业，如果 TA 恰好是个女生，我甚至更倾向于推荐她去卷金融。</p><p>因为，计算机面对的是计算机，是二极管；而金融面对的是人，是社会。这二者差异太大了。</p><p>我会更加倾向于思考，一个人，TA 是更内向还是更外向，TA 是更喜欢独立思考还是更喜欢协同交流，TA 对电子产品有没有与生俱来的兴趣，TA 对人类历史上最天才的几个头脑献祭出来的算法有没有深入灵魂的震撼感，或是仅仅是更在意自己的穿着打扮（尽管确实也可能可以把所有事情都平衡好）。</p><p>而这些，相比较 TA 所学的专业，会更影响我对 TA 能力与潜力方面的判断，专业学习只是短短 4 到 10 年的时光，但接下来的从业将长达 10 到 40 年。在当下互联网行业薪资倒挂严重、AI 未来走势不明朗、国家监管越发严苛的大环境下，我们有理由更慎重地对待自己的选择。</p><p>但依旧会时不时有人过来咨询，比如：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211109151730706.png" alt="某学妹的AI方向咨询" class="img_vXGZ"></p><p>像这位同学履历的，其实还有很多，绝大多数时候，我们都是被时代裹挟的沙子，风在哪里，就把我们吹向哪里。</p><p>在校期间，曾经较深地接触贾老师的思想与教育观，他锐意革新，希望同学们紧跟时代的步伐，在学习本专业（审计）的同时还安插了数学与编程，使该专业从原先学习压力最大之一抖升成毫无疑问最大没有之一。这样的良苦用心造成了同学们对待学习的两极分化，并再度降低了对编程不感兴趣的同学对编程的好感度。</p><p>社会上对编程的偏见已经由来已久了，并且随着一个个互联网造富神话，正有愈演愈烈的趋势。</p><p>很久以前我们对计算机行业从业人员的理解，就是 IT（Infomation Technology），尤其是修电脑的、装宽带的，等等，大家对这些从业人员大有嗤之以鼻之架势。那个时候我还买了一本 CCNA、一套单片机开发，大有与硬件和网络大干一架的豪迈气势。</p><p>但时代不同了，计算机行业以摩尔定律飞速发展着，在房地产、土木等行业衰败的同时，阿里、腾讯、华为、小米、等一批借助互联网的公司随风而起，迅速重塑了市场格局，并且在人工智能的浪潮中再度发力，成为行业之冠：All can be reconstructed by AI.</p><p>这个时候，传统的 IT 概念，至少在我看来，已经退成了 IT Support；而产品研发、产品经理、算法工程师等岗位概念逐渐清晰起来，并且随着行业模式的发展，前端、后端、移动端等细分领域也进一步细化，以至于在华为 20 万，字节 10 万人马的当下，每个人都成了一个岗位的螺丝钉，只负责一个项目的一部分工作。</p><p>在向来并不缺人的国内市场，全能便意味着全不能，全栈便意味着全不会，这是一条几乎越走越窄的路，这也是我自己比较大的困境：我对每个领域都很感兴趣，但我并不愿意在 hang on 在某个领域；我想成为一名 Code Engineer，而不是一位 Code Farmer，尽管他们的缩写都是 Coder。</p><p>这三年来，数十个项目已经让我习惯了与计算机交流，而逐渐地与人越来越远，尽管，我也曾经那么自信、那么从容、那么热忱地站在各种商赛的舞台上对着面前的老师、同学以及对手振臂高呼与侃侃而谈。但只有真正投入了，才会逐渐意识到内心的选择，它在诞生的那一刻，就已经有了自己认定的答案，我们需要去耐心倾听它，在每个夜深人静的窗前和月下。</p><p>所以，如果你也愿意去尝试，你做好准备了吗？你需要明白，当你开始与计算机握手时，你在做什么。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="创">创<a class="hash-link" href="#创" title="标题的直接链接">​</a></h2><p>最后，我想谈的，是创造，是幼儿时看的《艺术创想》，是少儿时看的诺基亚 Java，是现在的苹果 M1、大疆 2S。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/iShot2021-11-05%2017.05.24.png" alt="美国眼中的中国之路" class="img_vXGZ"></p><p>我们谈了很多计算机行业相对于其他行业的劣势，例如枯燥、孤僻，但有一点却是其他行业难以带来的，真正体现自己价值的地方：创造力。</p><p>前两天，我无意间翻到了一篇知乎回答，让我久久感动，并破天荒地竟然在知乎打赏了一块钱，这是多么郑重的一块钱啊，仿佛一块石子轻快地扑腾在水面，也仿佛一颗流星灿烂地划过夜空，那流星滑落之处既是万古长寂，也是灯火流明。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211109154959779.png" alt="平凡工程师的超能力" class="img_vXGZ"></p><p>我有时，会想起计算机考研群里某个人的话：<strong>我是真地相信计算机能改变世界的。</strong></p><p>我遗憾没有在他下面加上一个注脚：<strong>是的，就像将来，一定是赤旗的世界。</strong></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/iShot2021-11-05%2022.41.53.png" alt="See you 10 years after" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[关于有人想仲裁我]]></title>
            <link>https://markshawn2020.github.io/blog/2021/10/28/关于有人想仲裁我</link>
            <guid>/2021/10/28/关于有人想仲裁我</guid>
            <pubDate>Thu, 28 Oct 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[这几天 G 君找到我，说 M 君想找我仲裁，我本不以为意。]]></description>
            <content:encoded><![CDATA[<p>这几天 G 君找到我，说 M 君想找我仲裁，我本不以为意。</p><p>毕竟这几年的沉浮，我坚信问心无愧才是首要的。</p><p>但为了避免更多人不明真相，因此做一解释。</p><p>如果这还不够，那便罢了。</p><p>最后，本文保证所有叙事经过的真实性（细节可能有误记）。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>事情说来简单，但也复杂，关键是从谁那边看。事情是这样开始的。</p><p>2021 年 6 月，与我有过两次项目合作经历的 Q 姐问我能不能接（在 Y 公司里工作的闺蜜）L 姐的项目，主要是与安卓系统 ROM 定制相关的，很急，开发周期限一个月。</p><p>我那个时候并无任何安卓开发经验，甚至 JAVA 也是不会的，我擅长的只是 Python、C++和 JavaScript，但考虑到这是 Q 姐闺蜜的项目，断不至于会坑我；其次若能解决也算解了她们的燃眉之急，是件好事；再看具体内容，虽然我都没做过，但凭着多年的开发经验，可能可以实现，至少都不是所谓“造个光刻机”级别的难题；最后谈报酬，从六万（如果我记得没错的话）谈到了十三万。</p><p>我盘算着，找到三个人，四个人一起做，一个月搞定，也人均三万，作为一个救火项目，我觉得还是可以接受的。于是我就去找人了。</p><p>我第一步找人，是去 T 大计算机考研群里，因为这里确实有很多有才华的同学，并且存在一批正在待业的。</p><p>考虑到十三万有很多操作的空间，于是我在群里找人的标准与条件大致如下：</p><ul><li>有过安卓开发经验，最好能有 framework 层开发经验</li><li>能 onsite（线下一起去甲方工作），有一个月时间</li><li>包食宿</li></ul><p>你站在我的角度，很自然而然能得到这样的一个招人要求。</p><p>于是，南师大的 M 君在群里回复，大学时写过安卓应用，我觉得可行，于是我把拉入队伍。</p><p>同时，还有浙大的 X 君也有意愿，同样加入了队伍。</p><p>另外还有对攻防很有研究的 W 君，表示线下去不了，但可以提供线上 support，也加入了队伍。</p><p>很快，我和 M 君、X 君约定在上海碰头，然后去和甲方见面。</p><p>不过 X 君在出发前一天表示家里人不同意，但我建议 X 君先来，谈完合同后再回去参与线上合作，X 君同意了。</p><p>但那天又出现意外，X 君手机没电了，在公司附近没等到我和 M 君，所以提前乘火车回去了。</p><p>最后，只有我和 M 君正式参与线下工作。</p><p>合同是我单方面与公司签，如果完成不了，我将承担四万元左右的违约风险。</p><p>但 M 君无需考虑这一点，因为自始至终，我对我找来的人，是不要求他们承担风险部分的，他们尽力做就可以。做好了，按项目贡献拿钱；做不好，也没事，我来承担。</p><p>结果头一周，M 君就表示做不下去，我一直鼓励他说再坚持坚持，但最后还是不辞而别了，只留下了几个安卓应用代码，而这部分代码并没有投入到最终项目中去。</p><p>这期间，M 君和我一起住的酒店，我承担了所有酒店费用。</p><p>接下来，我一个人又做了一周。再接下来，我在朋友的推荐下，找来了一位有三年美团工作经验的安卓开发工程师 H 君，我们一起又做了整整一个半月（没错，比预期已经整整 delay 了一个月）。</p><p>这期间，与 M 君一样，H 君和我一起住的酒店，我承担了绝大部分酒店费用（第二个月接近五五开）。</p><p>最终结项，在总报酬里除去酒店开支等，我和 H 君五五分成。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="m-君诉求">M 君诉求<a class="hash-link" href="#m-君诉求" title="标题的直接链接">​</a></h2><p>从我的角度，M 君开头就逃跑，仅有的工作部分对项目最终没有实际帮助（这点他不知情），我本以为他和项目就应该是没有任何关系了。但谁料，他后续又多次和我谈及报酬问题。</p><p>首先，我必须道歉，这里存在我的问题，因为我在项目工作周期里一直扑在项目上，对 M 君那里缺少了必要的同理心，导致 M 君一直以为自己做的工作是有价值的，并且我会给他报酬。</p><p>M 君的诉求非常闭环：</p><ol><li>在 M 君参与这个项目之前，我就跟参与的人说了，每个人都可以分到一两万（毕竟总报酬有十三万）</li><li>在 M 君参与这个项目之中，我和 M 君说你这部分工作就会价值有三万</li></ol><p>关于第一点，对于参与这个项目的人，大家从头一起走到尾，按照百分比去计算，每个人至少可以得到一两万，非常合情合理。</p><p>但事实是，无论是线下的 M 君，还是线上的 X 君、W 君，都远远没有达到那个参与度的期望。</p><p>较真的人会计较，那多少的参与度没有一个客观标准啊，我参与一天也是参与，参与一个月也是参与。没错，确实很难判定，但是对于最终项目的贡献度，这个是可以较为清晰判定的。</p><p>所以对于线上远程帮助的两位同学，我最终是按照“按劳分配”的，如果他们给予帮助，比如分享了一些有价值的文章等，我当即就发了他们一点红包，我印象中我有发一个 100 元的红包在协助群里。</p><p>关于第二点，M 君和我存在重大分歧，我今天也是想重点把这点说清楚的。</p><p>这个必须要谈到项目内容，简单来说，可以分成四部分：</p><ul><li>模拟开发一个触控板软件，支持在手机中驱动 VR 设备里的鼠标</li><li>实现按电源键息屏但不影响后台运行，不影响 VR 设备里的视频播放</li><li>开发 3dof 解析协议，实现 VR 设备能读取手机的传感器并同步</li><li>（还有一部分我忘了，我当时把整个项目切割成了四部分）</li></ul><p>而在第一周，我决定分配的，是 M 君研究第一个问题，开发触控板软件并驱动 VR。</p><p>M 君在这一周，非常难熬，每天都会看书看到凌晨两三点，并且在公司里持续问公司的技术骨干 C 君与项目 leader L 君。这点我看在眼里，很同情也很无奈，这也是我一直在鼓励他的原因，因为在初期 L 姐和我们都觉得 M 君非常勤奋，因为他一直在想怎么实现。</p><p>但很可惜的是，他最终也没想出来怎么实现，也把 C 君和 L 君问烦了，C 君在微信上私信我这个人是不是什么都不会以及我们到底行不行。</p><p>最后 M 君和我在项目的实现路径上产生分歧，M 君认为这个项目必须要改 framework 层他办不了让我另寻他就，而我认为我们可以先写一个应用层面的简易实现，再慢慢渗透到 framework 层，等我学完安卓，再配合他一起在 framework 层改。</p><p>为此，我们两在公司 C 君、L 君面前大吵一架，最后我让他先把应用层代码写完，一步步来。他同意了，但在花了一下午写完交给我后，第二天直接不辞而别，回家了。</p><p>直到第二天我才明白，为什么昨天晚上他要拍公司外面的月亮，以及还给了我一个苹果。</p><p>然而，这算什么事呢？</p><p>逃兵？撂架子？</p><p>但我还是把他当朋友的，走就走吧，我一个人干就是了，所以项目的后续就和他没有任何联系了，当然他的代码我也都没有用。</p><p>因为我和 M 君性格不一样，做事方法也不一样，M 君是一头扎入问题里去，然后焦急焦虑；而我是先给自己一到两周时间学习安卓系统理论知识，再去深入问题的工程实践，所以我虽然也愁，但我不是很焦虑，我心中的有自己的一步步规划。</p><p>现在回到第二点上，我跟 M 君说他这部分工作价值三万，我有说错吗？（13//4=3）</p><p>显然没有。</p><p>但是 M 君的工作值三万吗？他只是写了一个在手机上显示一个鼠标的程序……</p><p>显然没有。</p><p>但 M 君坚持认为这三万，就是他的，他要求至少三万。</p><p>？</p><p>所以你们懂我的意思了吗？</p><p><strong>他要负责的那部分工作值三万，但他实际做的工作不值三万，甚至说三百块都算抬举了。项目结项后他还开口要三万。</strong></p><p>但凡任何一个人是我，在后续他出走后又一个人扛起整个项目，总共花了两个月，每天 007，从安卓零基础一直到把整个安卓系统 framework 层吃透然后完成整个项目，面对项目结束后他的这个诉求你会答应吗？</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="m-君到底该拿多少钱">M 君到底该拿多少钱<a class="hash-link" href="#m-君到底该拿多少钱" title="标题的直接链接">​</a></h2><p>凡事都要讲究情理。</p><p>而不是自己阅读理解有问题，指着我的鼻子开价三万，说是我承诺给他的，如果是这样，我真地为中国的九年制义务教育和你读的南京 XX 大学感到悲哀。</p><p>有几种方法相对客观一些，跳出我自己的立场，我不妨也说说，以下以扣除所有其他费用后的十万元为总报酬基数进行计算。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="按照时间">按照时间<a class="hash-link" href="#按照时间" title="标题的直接链接">​</a></h3><p>如果 M 君觉得自己的时间是值钱的，我们就按照时间来算算。</p><p>M 君参与了一周，我参与了八周，H 君参与了六周，那么 M 君的报酬就是十五分之一，结果是六千七。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="按照贡献">按照贡献<a class="hash-link" href="#按照贡献" title="标题的直接链接">​</a></h3><p>如果 M 君真地认同自己的工作价值，我欢迎他自己对自己的工作做一个客观的评价，并基于这个评价向我合理合法地拿回属于自己的权益。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="我是否欺骗任何人">我是否欺骗任何人<a class="hash-link" href="#我是否欺骗任何人" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="包食宿到底是怎么回事">包食宿到底是怎么回事<a class="hash-link" href="#包食宿到底是怎么回事" title="标题的直接链接">​</a></h3><p>这个是我一开始也不知情，因为公司方要求驻场，我也以为公司会提供我们食宿之类的。</p><p>但事实是，等我们谈完报酬后，L 姐说不包食宿，费用都含在总包里了。</p><p>这个是公司与我之间的协定，所有费用，包括一开始可能有的食宿费用都包含在总包里。</p><p>那么跟我一起参与的 M 君，所受到的待遇是什么呢？</p><p>整整一周，一直和我一起住酒店，所有费用是我 cover 的，实际成本是接近 2k，这里我只想表达一我没有违背我对他们福利方面的承诺，二是我对他们足够的好。</p><p>至于这个“食”，如果 M 君觉得每天和我一起吃的家常菜馆的费用，也需要 cover 的话，那请便。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3000-元是怎么回事">3000 元是怎么回事<a class="hash-link" href="#3000-元是怎么回事" title="标题的直接链接">​</a></h3><p>在项目周期一个月、一个半月和两个月等时间点，M 君多次问我项目进度问题，但很显然，都是 delay 的回答。</p><p>在其中有一次，我们谈到了合同存在违约一项的问题，高利润对应高风险，这是显然的，所以如果项目达不成我就面临罚款，我和 M 君同在一条船上。</p><p>M 君确实也理解我，给我转了 3000，算是酒店的费用，也算是我对他临时逃跑的罚款，因为他确实对项目产生了负面影响。</p><p>在最后，项目还是顺利结项了，3000 元如数奉还。</p><p>由于我后续聊天记录都清光了，这里到底发生了什么争执，我也不太清楚了，但总之，我没有拿 M 君一分钱。</p><p>当然，由于最后 M 君和我谈报酬谈崩，所以他也没拿我一分钱，除了酒店费用外。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="反思">反思<a class="hash-link" href="#反思" title="标题的直接链接">​</a></h2><ol><li>雇人做事情确实存在风险，谈钱是真地容易伤感情，原本是一桩和和睦睦一起赚钱的事，却闹的如此不堪，也着实令我深思。</li><li>如果存在金钱约定的，尽早划清，别拖着别人，让别人觉得自己还欠别人的，而自己又觉得什么都不欠。</li><li>能力，真地很重要。但德行，更重要。如果又无能，还又无德……希望某些人能有自知之明。</li><li>我只能说，我能理解他，他今年又继续参加考研了，祝愿他能考个好成绩，毕竟考研人都不容易。</li></ol><p>以上就是全部事情的来龙去脉，对项目内容细节有兴趣的可以移步：</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[十月：无题]]></title>
            <link>https://markshawn2020.github.io/blog/2021/10/27/十月：无题</link>
            <guid>/2021/10/27/十月：无题</guid>
            <pubDate>Wed, 27 Oct 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[一、雨后]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="一雨后">一、雨后<a class="hash-link" href="#一雨后" title="标题的直接链接">​</a></h2><p>入十月</p><p>有雨</p><p>但并不长久</p><p>尽管确有连绵的几日</p><p>放晴之后倒甚是奇怪</p><p>屋外很热</p><p>屋内很冷</p><p>屋子作怪</p><p>我该信谁</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="二车门">二、车门<a class="hash-link" href="#二车门" title="标题的直接链接">​</a></h2><p>车门已焊死</p><p>我无法下车</p><p>是通往天堂</p><p>亦或是地狱</p><p>且试看分晓</p><p>倒无需用眼</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="三风里有什么">三、风里有什么<a class="hash-link" href="#三风里有什么" title="标题的直接链接">​</a></h2><p>风里有什么</p><p>我记得的，寒冷</p><p>风里还有什么</p><p>我闻着的，呼吸</p><p>风里，还有什么</p><p>我忘了的，思念</p><p>风里，还有什么</p><p>忏悔</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="四十四岁少女">四、十四岁少女<a class="hash-link" href="#四十四岁少女" title="标题的直接链接">​</a></h2><p>你是〇〇后？</p><p>怎么知道的</p><p>直觉</p><p>牛逼</p><p>你不是吗</p><p>我是 95 后</p><p>哥哥呀。呵呵，孩子几岁了</p><p>。</p><p>是喀什的？</p><p>是喀什的</p><p>我差点就去了</p><p>哦</p><p>不怕我是坏人呀</p><p>现在基本没有坏人了，善良的很多</p><p>多呢</p><p>我信你</p><p>。</p><p>你玩和平精英吗？</p><p>一点点。你玩王者荣耀吗？</p><p>绝对不。</p><p>那你带带我？</p><p>当然</p><p>长大了来沿海不</p><p>看海，吗</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="五阳的信摘">五、阳的信（摘）<a class="hash-link" href="#五阳的信摘" title="标题的直接链接">​</a></h2><blockquote><p>虹 上海沦陷了</p><p>我们撤到南京 保卫首都</p><p>虹 我是爱你的</p><p>但国家兴亡匹夫有责 千万将士视死如归</p><p>我们一定会胜利的</p><p>虹 南京失守了</p><p>日本鬼子实施了惨无人道的大屠杀</p><p>男女老幼无人能免</p><p>南京已成了一座空城</p><p>我们撤到了九江 部队伤亡惨重</p><p>好在无数像我一样的热血青年踊跃参军</p><p>士气依然高昂</p><p>虹 中国不会亡 我爱你</p><p>虹 我们已撤到武汉</p><p>全国大部分军队都集中到武汉来了</p><p>要在这里和日本鬼子决一死战</p><p>我已当上了上尉连长</p><p>在上海一起参军的同学们就只剩下我一个还活着</p><p>他们誓死不做亡国奴 他们是国家的英雄</p><p>我也做好了牺牲的打算</p><p>虹 你不要难过</p><p>人生苦短 能为国捐躯是我的光荣</p><p>我会至死爱你</p><p>虹 武汉失守了 我们撤到长沙</p><p>离你那里只有六百里了</p><p>我已给长官写了血书 誓与长沙共存亡</p><p>虹 我要用生命保卫你的家乡 保卫你</p><p>我已把你的地址给了卫兵</p><p>如果我牺牲了 他会把我的琴给你寄来</p><p>虹 我爱你 真想再见你一面 真的</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="六幼稚">六、幼稚<a class="hash-link" href="#六幼稚" title="标题的直接链接">​</a></h2><p>瞒着母亲去了西藏</p><p>知道时人已在成都</p><p>听说母亲因此病倒</p><p>我幼稚母亲也幼稚</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="七红烧肉">七、红烧肉<a class="hash-link" href="#七红烧肉" title="标题的直接链接">​</a></h2><p>五花肉、鹌鹑蛋与香料</p><p>准备开天辟地大干一场</p><p>惨遭母亲先手一秀厨艺</p><p>红烧肉流产我含泪吃下</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="八醒与睡">八、醒与睡<a class="hash-link" href="#八醒与睡" title="标题的直接链接">​</a></h2><p>有时是醒着</p><p>但多半是睡着</p><p>人竟可以如此酣睡</p><p>从夜魅到天明到晌午到落日</p><p>有些人它醒着</p><p>其实它已经睡了</p><p>有些人它睡着</p><p>它亦是醒着</p><p>或许醒的人还有</p><p>救救睡的人</p><p>但人绝不会睡醒</p><p>人只有醒着睡</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="九三百年">九、三百年<a class="hash-link" href="#九三百年" title="标题的直接链接">​</a></h2><p>非是以光而明，实是以有暗而有明</p><p>非是以慧而成，实是以有勤而有成</p><p>暗虽不通，勤虽不迅，金石终为开</p><p>三年须臾，三十年彷徨，三百年不朽</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[王者荣耀打野上分经验总结]]></title>
            <link>https://markshawn2020.github.io/blog/2021/10/18/王者荣耀打野上分经验总结（全干货）</link>
            <guid>/2021/10/18/王者荣耀打野上分经验总结（全干货）</guid>
            <pubDate>Mon, 18 Oct 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[[TOC]]]></description>
            <content:encoded><![CDATA[<p>[TOC]</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="为什么选择打野">为什么选择打野<a class="hash-link" href="#为什么选择打野" title="标题的直接链接">​</a></h2><p>毫无疑问，打野是最能 carry 的一个位置，尤其在 S25 这个赛季，随着王者对游戏节奏的加快，以及打野四分钟之前可以蹭线的设计等等，打野的意识与成败成为影响赛局最关键的变量之一。</p><p>更重要的，如果想一个人单排上分，打野是最佳选择，其次是对抗路，最后是中路。</p><p>然而，对于我来说，却还有一个重要原因，因为我喜欢玩诸葛亮，而这个赛季对打野蓝刀进行改动后，使一些法刺例如诸葛亮、司马懿等在野区有了另一种选择，并且实践证明打野诸葛比中单诸葛成长更快，gank 威胁更大。</p><p>最后，练习打野也是理解王者的最重要一步，它可以帮助你更快、更深地养成全局意识、关注小地图意识等，一个野核他玩其他路一般也不会有太大压力，但反之则不然。</p><p>所以，本篇着重讲打野如何上分，以及重点讲讲我比较关注的几个打野英雄的操作，算是我小几千场王者的一个经验总结。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="打野核心思路">打野核心思路<a class="hash-link" href="#打野核心思路" title="标题的直接链接">​</a></h2><p>打野的核心是把握节奏，这是最最主要的。有了节奏之后，所谓人头、所谓经济什么的，才是水到渠成的结果。</p><p>而节奏又由几部分组成，主要包括清野、反野、抓人、蹲人、蹲野、开龙、反龙、团战等。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="熟悉游戏规则提高清野效率">熟悉游戏规则，提高清野效率<a class="hash-link" href="#熟悉游戏规则提高清野效率" title="标题的直接链接">​</a></h3><p>那要把握节奏，首先就是要熟悉游戏规则，比如开局 30 秒的时候会刷新野怪，这有什么用呢？有用，比如猴子（被动是释放技能 7 秒内的普攻将被强化，2 技能初始冷却时间为 8 秒）就可以在 24 秒的时候开 2 技能存一棍，从而分别在 30、32 秒时敲出第一、第二棒强化普攻，刷野速度要比傻傻等到野怪出来后再放技能更快。</p><p>另外就是惩戒要不要一上来就交，我的看法永远是确定不会被抢野的情况下尽早交，因为尽早交完惩戒后就可以尽早刷新 CD，等刷完半片野区后还可以去中路抢河蟹。但如果对面有入侵性强的英雄比如老虎、东皇、鱼等没有漏视野或者漏了但离自己很近，反正你觉得这个 buff 怪可能被抢，就要留着惩戒。另外如果对面有钟馗没有漏视野或着就在自己的 buff 附近转，你必须立即喊队友帮忙，或者先打小怪，或者自己站位在野怪和钟馗连线上，防止血量较高的野怪被拉出导致无效打野，如果血量较少被拉出很可能会被对方打野收掉，总之这里面还挺细节以及有趣的，我倾向于尽可能让钟馗把自己拉出去然后配合队友反打一波收掉钟馗，打不死就再翻墙回来收掉 buff 怪。这些都是血泪总结啊。</p><p>在熟悉游戏规则的情况下，把每个细节都最好了，使自己的刷野效率、安全性等达到最高，就能够保证自己的经济和等级健康，从而保障之后抓人的成功率，既而保证赛局的成功。每一个步骤都是环环相扣，牵一发而动全身的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="保持专注状态开局要点打野刀">保持专注状态，开局要点打野刀<a class="hash-link" href="#保持专注状态开局要点打野刀" title="标题的直接链接">​</a></h3><p>就比如，我自己有大概十分之一的概率出门会不小心点成鞋子出门（开局会同时提示点打野刀或是草鞋），等打 buff 一套技能打完时才意识到没买打野刀，自己的血也被打掉了一小半，导致整个野区刷完至少比对方慢半分钟，而且血量要少三分之一，而一旦遭遇，我就被送去一血，从而对方顺势还能把龙拿了，然后直接一局就被压着打，输赢已定……</p><p>这充分说明，我当时的状态不佳，比如可能去泡了个茶，或是解了个手，或是已经昏昏沉沉，总之，保持一个专注的状态，是非常必要的。如果你也想快速上分，而非只是和朋友娱乐娱乐，那就务必先洗漱一下，保持一个专注的竞技状态，同时，每隔几把就要放松一下。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="时刻关注小地图把握抓人时机">时刻关注小地图，把握抓人时机<a class="hash-link" href="#时刻关注小地图把握抓人时机" title="标题的直接链接">​</a></h3><p>时刻关注小地图是形成全局意识最重要也是最基础的一个必修课。然而惭愧如我，尽管已经是轻松上王者的水平，依旧无法做到整场游戏都关注小地图，尤其是团战、抓人以及遭遇战等激烈环节，常常打到一半突然被冒出来的敌方英雄带走，就是因为在这波团战前没有时刻关注小地图，导致不能有效预测敌方踪迹从而引致失败的。</p><p>当然，要想完全预测敌方踪迹是不现实的，关注小地图只是尽量提高我们的敏感度，因为大多数情况下我们没法同时关注自己视野范围内的操作又关注其他地方的战况，例如诸葛亮刷野时，要频繁使用指向性 2 技能以及走位拉野怪以减少耗血，不像赵云可以放完一个 2 技能后，慢慢普攻，此时我直接将视野拉到我想看的地方，两三秒后再拉回来再放一个 2 技能。然而尽管赵云可以轻松刷野，也需要同时结合刷野、拉视野和观察小地图三者，才能对全局有更好的把握。</p><p>而判断要不要去抓人，第一是看这个人重不重要、难不难抓，第二就是看线带的深不深。</p><p>如果对方是吕布、芈月等英雄，四级后就比较难抓，而像狂铁、曹操等英雄甚至还可能被反送双杀，这些都是要谨慎对待的。那比如对方是无位移英雄比如鲁班、后羿，那就可以多抓；而如果是香香、阿狸、百里等，就麻烦一些。</p><p>那比如说硬要抓吕布，并且一套打不死他怎么办，比如我诸葛亮去抓吕布，吕布残血时我开大他也开大，被他躲掉了。这种情况下我一般都会预留一个二技能，等吕布跳完之后再追上去，21 带走。或者干脆抓两次，等再刷个野怪后大招又好了再去抓一波，因为诸葛亮的大招 CD（35/30/25）是比吕布的大招 CD（50）短的。</p><p>线如果被压，抓起来就稍微容易一些，毕竟对方回退的路更长，但要注意两点，第一就是线如果被压并且对方兵线未进塔而己方兵线已经被清，这时候去抓就存在被兵围攻的风险；第二就是如果此时对方也有人在蹲的可能性会更大，毕竟他们有线权。</p><p>如果是我们压对面的线，则最好配合中单一起准备越塔强杀了，越塔强杀时最核心的三点，一是要有人负责干扰或者扛塔，二是要集中火力，三是要预判闪现。在低端局容易出现三点都稀烂，导致越塔强杀失败然后己方团灭被翻盘的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="时刻关注双方经济装备与属性厘清对抗目标">时刻关注双方经济、装备与属性，厘清对抗目标<a class="hash-link" href="#时刻关注双方经济装备与属性厘清对抗目标" title="标题的直接链接">​</a></h3><p>在对局中，我们一般关注经济最高的那个，重点关注对方的打野、射手，哪个是经济最高的，这些都是重点集火对象。当然也有一些收割型英雄和站撸性选手，就算他们经济差也要秒掉，典型的比如阿珂和诸葛亮，这些人团战必须死。</p><p>除了看经济，那就是看装备了，如果我玩的是 AP 打野，比如诸葛亮就会重点关注对方哪些人出了魔女或是永夜；如果我玩的是 AD 打野比如赵云，就会重点关注对方哪些人出了反甲、不祥或者冰心。尤其是猴子，有时候需要使用空棍技术防止被这些装备的被动影响。</p><p>一般来说，作为打野，要秒的就是对面的核心 C 位，一般是射手，或者法师，但也会遇到对面打野要秒你的情形。比如我玩诸葛亮对面玩猴子，猴子就会经常要来切我，平等情况下诸葛亮是肯定打不过猴子的，如果对面猴子发育很好，可以出一个布甲鞋加反甲防止被秒，在能不被秒的基础上，诸葛亮 2 技能先挡住猴子的第一波突脸，再一个 2 技能挡住猴子的第二波突脸，这样猴子就被减速了，此时可以再接 1 或者 2，然后大招打出去，再接 2 跟上，完成反杀。</p><p>当然了，会玩的猴子肯定也是这么想的，所以它一定会想方设法打出 4 棍，2 技能存棍过来敲诸葛，大招跟上，再敲一棍，再加 1 技能，再敲一棍，此时诸葛才能放出第一个 2 技能，猴子再一个 2 技能跟过来，再敲一棍……这样四棍下来，诸葛就算布甲加反甲，也不一定能苟活……但倘若能苟活，则猴子也不一定被减速，因为第一个 2 技能被猴子的 1 技能躲了，当然猴子也追不过来了，因为 1、2 技能都放了，3 个技能都还在 cd 中，遇到这种会玩的猴子，诸葛也只能溜，硬刚是刚不过的……</p><p>没办法，这就是高端局的困境，每个玩家都在算计，看谁的失误少，以及看谁算的多。比如猴子如果一波切不死对面，还可以假装回退，拉出视野，然后出其不意再通过小兵跳棍回来，再敲，这种猴就非常难缠……</p><p>除了看装备，还可以看属性，直接看对方的物理防御与法术防御值，然后专门挑软的柿子砍，比如韩信这类英雄，一般防御会很低，后期也就 200 多，敢突诸葛亮就是 12 一套再挂一个 3，韩信想跑都跑不掉。但我一般去抓对抗路英雄时会看他的属性，看看他的防御值高不高，如果高的话，一般一套是秒不掉的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="视野假动作蹲人蹲野反蹲反龙">视野、假动作、蹲人、蹲野、反蹲、反龙<a class="hash-link" href="#视野假动作蹲人蹲野反蹲反龙" title="标题的直接链接">​</a></h3><p>关于蹲人我最想提及的是之前看赵云的教学，有个 up 主在训练营测试赵云在中草不同位置能够抓人的最远距离，这个给了我很大启发：当赵云在中草中间位置时，一技能出去接大招能击飞在中线与草边的交点处；而如果在中草边缘位置，可以到达中线与防御塔视野交点处。把握好这个距离，可以提高中路抓人成功率；而把握好各种距离，则能有效提高全局的胜率。</p><p>比如，赵云可以蹲红 buff 的背草，这个位置，对方不容易发现，而赵云可以直接从这个位置跳进红 buff，给对方致命一击，非常恐怖，如果玩的是诸葛亮，则没有此种“天降神兵”的操作。诸葛亮只可以蹲红 buff 的边草，更容易被发现，也更容易被包围。所以啊，尽管我很喜欢诸葛亮这个英雄，也喜欢用他来打野，但不得不说，他的缺点还是很多的，他也绝不会是 t0 或者 t1 队列。而赵云作为天美的亲儿子，那是真地香，巅峰榜前十（最顶级玩家）也是有经常用赵云这个朴素的英雄 carry 的。真地是“上得了巅峰，下得了青铜”，水桶英雄的存在。</p><p>当然，在 buff 周围蹲野是最典型的蹲野手段，其次是在一塔草丛，然后是二塔草丛。关于二塔草丛蹲人，最想讲的是视野与假动作，具体可以看一下这些：</p><p><a href="https://m.hupu.com/bbs/36363439.html" target="_blank" rel="noopener noreferrer">进阶版，视野机制详解，掌握视野才能掌握战场<!-- -->_<!-- -->虎扑</a></p><p><a href="https://new.qq.com/omn/20200908/20200908A0I3XY00.html" target="_blank" rel="noopener noreferrer">王者荣耀：隐藏的视野机制，躲在草丛的你为什么被发现了<!-- -->_<!-- -->腾讯新闻</a></p><p>最典型的就是中路清完兵线后准备去下路支援，低段位的一般就直接下去了，然而如果对面意识较好以及沟通较好的话就会知道你要下来，因为兵线清完会有视野残留，对手可以看到你那几秒往下走的动作，所以高端局就会使用一些假动作手段，比如先往回头或者先反向走达到误导对手的目的。</p><p>这里值得我一提的是，防御塔的视野要比它的攻击范围更大一些，所以中路一塔不破，蓝区基本是比较安全的，除开那个蓝区背草；而中路二塔不破，二塔的那个草也是安全的，除非英雄通过位移技能进入。</p><p>在反龙时，我个人偏好是在龙剩下惩戒血量的 1.5 到 3 倍间进入，比如赵云可以通过在龙背草里直接开大跳入，然后 2 技能加惩戒，很容易抢到龙；而诸葛的话，则是在 2 到 3 倍间进入，站在草外一技能加三技能，然后二技能跳入接惩戒，伤害打满，要么被惩戒收走要么被延后的三技能收走，接着再用一个二技能逃出龙区或者追击。当然这些是理想情况，如果路上来不及，就只能放个大招碰碰运气了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="操作进阶建议">操作进阶建议<a class="hash-link" href="#操作进阶建议" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="三指操作-vs-视角偏移-vs-盲操">三指操作 vs 视角偏移 vs 盲操<a class="hash-link" href="#三指操作-vs-视角偏移-vs-盲操" title="标题的直接链接">​</a></h3><p>所谓三指操作，有两种办法，主流办法就是在左手移动时，右手食指的侧关节拉动屏幕，同时右手大拇指使用技能，对右手操作的要求较高。</p><p>一般来说，如果玩露娜、赵云等切入型刺客类英雄，都最好会三指操作，否则很容易大空。这主要是王者不像 lol，屏幕有限，视野一般比较高，而组合技能的目标位置在屏幕外，所以需要拉动屏幕来确保技能释放的准确性。</p><p>还有另一种替代方案，就是打开设置里的“视角偏移”，开启后会在视角拖动区域多一个摄像机按钮，玩家可以通过拖动这个摄像机按钮达到固定偏移视野的目的，诚实的说这个功能还是不错的，但也有两个缺点。第一个缺点是容易引起误触，如果你想快速拉一下视野，而非固定偏移视野，就需要小心手指触发的位置，这导致在团战激烈时可能引起误触。第二个缺点是，真的需要用户习惯这种角色不在屏幕正中间的感觉，我用下来感觉真地还是挺难受的，感觉路走慢了一样。</p><p>但总之，这两个缺点还是相对于三指操作来说，不是那么的不可接受，虽然没有三指操作那么灵活，但也不至于用手指侧关节那样蛋疼，并且那样弄久了，容易起茧子，不要问我是怎么知道的。</p><p>那，进阶一定要学三指操作或者视角偏移吗？我的答案还是肯定的，尽管我有时还是觉得可以盲操，比如诸葛亮的 2 接 1，以及赵云的 1 接 3，有时候就通过小地图的大概位置、画面的大致方向直接盲操了，但肯定不够完美，这也或许解释我赵云的胜率较低了，毕竟真地很多时候，距离就是很远，导致盲操大空……</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="光速换装一闪-vs-软件辅助-vs-可编程硬件辅助">光速换装、一闪 vs 软件辅助 vs 可编程硬件辅助<a class="hash-link" href="#光速换装一闪-vs-软件辅助-vs-可编程硬件辅助" title="标题的直接链接">​</a></h3><p>所谓光速换装，就是快速卖掉旧装备并买入新装备，最典型的场景是复活甲换名刀，可以保自己 2.75 秒的无敌。</p><p>原理其实是很简单的，首先在商店内预购某个装备（双击即可），然后再下面点击某个已经购买的装备，之后就可以通过固定的四次点击达到快速换装：</p><ol><li>点击屏幕中左处的商店</li><li>点即屏幕右下处的售卖</li><li>点击屏幕右上处的关闭</li><li>点击屏幕中左处的预购（前提是钱够）</li></ol><p>位置都是固定的，我也在自定义中练过一会，然而在实战中会发现仍然会反应不过来，我看一些主播直播换装的速度相当快，甚至能切三四个，我对他们有这个换装速度的能力是相信的，然而只觉得心疼，“但手熟尔”，诶。</p><p>对于我来说，我真地不愿意为了提高这么个换装的速度，而去大量练习枯燥的点击动作以至于形成肌肉记忆，毕竟我还有一个办法，那就是借助于软件辅助。</p><p>我尝试过“按键精灵”这款 app，然后编写了换装的小脚本，测试了一下，可以正常运行，然而旋即这个软件就被告知要向我收费，但考虑到这款软件还是有各种闪退的 bug 存在，以及价格过高等等，我就索然无味了。毕竟，开发按键精灵，我自己也可以啊，因为今年恰好就做过安卓系统定制开发的工作，所以我打算年后有时间开发一个，这东西还是很有用的，光速换装在激烈的对抗局中经常有着决定性的作用，毕竟我玩的都是野核。到时候做出来给大家都偷偷用用，这玩意对游戏的生态是没有影响的，只是能够快速的执行四个位置的点击而已，不属于透视那种外挂。</p><p>不过呢，其实还有一种解决方案，那就是使用可编程硬件辅助，比如</p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211018171000264.png" alt="image-20211018171000264" class="img_vXGZ"><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211018170800682.png" alt="image-20211018170800682" class="img_vXGZ"><p>原先对于一些高秀操作，自己觉得可以实现，而对所谓的手柄什么的嗤之以鼻，直到后来我自己一路充分，时间越长以及赛局越来越激烈后，我渐渐意识到一款好的手柄还是对游戏体验以及赛局胜率有帮助的。</p><p>最典型的，就是由于一些长时间握持，导致手上烫出了茧子，据说这些手柄还可以加速散热这是其帮助之一。然后，我还仔细思考了一些英雄的一闪操作（二闪、三闪同理），会发现我目前做的一闪，都是用同一根手指先按一，再按闪，速度很快，但这意味着容错率较低，很容易要么闪现按晚了，要么没按成。但如果接入手柄，将顶部 RB 键设置成闪现，这样我右手手指照常释放技能的瞬间，左手中指按 RB 键闪现，对一闪成功率的提升是显著的。不过也有一点弊端，那就是这个闪现不能临时改变方向，不过对于大多数一闪来说，已经够了，比如诸葛的一闪基本用于延长距离而不用改方向，但姜子牙的一般用于改方向，对于这类玩家，这个闪现就还是得通过屏幕触摸滑动去实现了。</p><p>所以手柄对于游戏体验的提升还是有限的，不过这个有限对于我这类手残党来说，其实已经有了很大的想象空间，尤其是像光速换装和简单连招在手柄里还是很方便定制的。</p><p>我没有使用过任何手柄产品，只是在打了许些局后，觉得手柄确实是提升个人操作的一个捷道，各位看官还请自行裁夺。以上大抵是我本次的全部个人经验总结了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="为什么选择王者">为什么选择王者<a class="hash-link" href="#为什么选择王者" title="标题的直接链接">​</a></h2><p>在七年前，我随舍友们一起去网吧“写某门课的大作业”，结果搞完就陪他们一起玩了一款游戏：英雄联盟，简称 LOL。</p><p>LOL，我自然是知道的，早在我高中时每节“多媒体课”男生们都会带上自己的 U 盘暗敲敲地插入数十个“无辜的”电脑，然后开启一整堂“魔兽”，自那时候我就开始明白人与人的悲欢果然是不相通的。但那时我还无此方面兴趣。</p><p>我倒也不是全然对游戏不敢兴趣，要知道我可是从红白机、街机一直玩到 3A 以及网游乃至手游的，只是高中那会我可能真地比较喜欢学习，而大学那会更喜欢滑板吧，我是一个更喜欢在一个阶段沉浸并突破在一个领域的人，这也暗示着写此篇文章的我已经沉浸了好一会儿王者荣耀，以及“略有所得”。</p><p>话说回来，那第一场 LOL，就在几个舍友的陪同下开始了，至今我还印象深刻的是某一把我玩的是暮光之眼：慎。芋头同学是一名顶射，他看我随机选了这个英雄后，立马露出了微妙的笑容：“这个英雄挺难玩的”，言外之意，我要玩出一鼻子灰了。</p><p>果然，尽管舍友们考虑我没玩过于是开的人机，想来好笑，我却看到人机就怕，都要躲得远远的，毕竟一打架我就要死。以至于到现在我都不太能理解，那种看到人机就要躲的心态到底是怎么回事，这辈子怕是再也不能回答了。</p><p>在那之后，我又玩了几局，渐渐地对游戏有了一定的理解，于是沉浸下去，玩了三天三夜，出网吧那一刻，我兴奋地告诉舍友我终于把这游戏好像给玩明白了，但同时我也被告知我貌似错过了一场期末考试……excuse me？</p><p>好吧，我还是劝各位同学、朋友，游戏还是尽量少玩的，尤其是带天梯的 MOBA 类游戏，成瘾性极强……</p><p>在那之后，我又玩了很多场 LOL，常用的位置排序是打野、中单、上单和辅助。没错，没有射手，尽管射手我也都玩过，但我总能找到比我牛逼的射手，我情愿给他打辅助，毕竟我的莫甘娜、蕾欧娜、锤石（好吧，我不会锤石）都贼六。在射手里，我最心向往之的射手是德莱文，这个英雄的走位要求实在是太高了，需要练成耍杂技的水平才行，我没有那个时间以及天赋，只能看看。其次是薇恩，高端局常客，玩它需要对团战的意识较好，也是我不敢小觑的英雄之一。不过令我震惊的是，同学里竟然有一位女生，秀出了自己薇恩秀翻全场的战绩，令我不能理解……所以，原是我真地太菜了。</p><p>再后来，由于各种原因，我又放弃了 LOL，这游戏实在太难玩以及耗时间了，一场就要四十分钟，而且需要在电脑前“正襟危坐”，以及，必须是 Windows 系统。由于工作方向原因，我换了 Mac，哈哈，并不具备玩 LOL 的硬件条件，于是乎“躲过一劫”。</p><p>但大劫易躲，小劫却难逃，这不，还有王者荣耀嘛？以及，LOL 手游版竟然都已经上线了……我毫不犹豫地选择不去尝试……</p><p>综上，为什么选择王者荣耀？因为我是 LOL 原住民，里面凝结着我与大学同学难忘的回忆，以及我对盲僧、德莱文、瑞文等高操作英雄的满心倾慕，而王者荣耀是 LOL 手游端的第一替代品，里面又有一大批大学朋友……</p><p>旧的故事总在不断收尾，新的故事总在不断展开，但不管怎样，我们的生活将继续着。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="作者简介">作者简介<a class="hash-link" href="#作者简介" title="标题的直接链接">​</a></h2><p>从小玩游戏长大，后来玩 LOL（钻石）与王者荣耀（王者）较多，较为关注王者荣耀和原神两款游戏的商业走势。</p><p>不推荐年轻人玩游戏，自己目前没在玩任何游戏，不排斥自己未来去游戏行业。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211018173406206.png" alt="image-20211018173406206" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/image-20211018173419939.png" alt="image-20211018173419939" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川二一零六：毕业一年，我的失与得]]></title>
            <link>https://markshawn2020.github.io/blog/2021/06/27/毕业一年：我的得与失</link>
            <guid>/2021/06/27/毕业一年：我的得与失</guid>
            <pubDate>Sun, 27 Jun 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[【音乐：友谊太阳】]]></description>
            <content:encoded><![CDATA[<p>【音乐：友谊太阳】</p><p>又是一个毕业季，令人好不羡慕，令人好不怀念。</p><p>羡慕身边的学弟学妹也终于迎来了自己的人生关键时刻，再一次奔赴远方，有着我眼里也曾经有的对未来的渴望。</p><p>怀念自己的去年、前年、大前年、还有那对大学什么都不懂的第一年，那些年在象牙塔里的一切美好、汗水以及泪水。</p><p>是现在都不曾再能拥有的奢侈想念，但那些被金色细沙淘过的岁月，不会磨灭。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="两次考研只为遇见更好的自己">两次考研，只为遇见更好的自己<a class="hash-link" href="#两次考研只为遇见更好的自己" title="标题的直接链接">​</a></h2><p>【音乐：裸体舞曲】</p><p>关于考研的过程与结果其实两个月前就已经打算执笔，那个时候也是我印象最清晰、领悟最深刻的时候，但我最终没有。</p><p>一方面是因为怕最终失败的结果会引起身边好友的同情与担忧，这不是我想看到的。</p><p>另一方面，也许是觉得失败的经验对身边的学弟学妹也没有太多参考意义，输出的欲望便不是那么强烈了。</p><p>虽然最不好交代的是自己，也有过一丝对大学碌碌无为的忏悔，但后悔却是始终没有的，我坚信在我生命的任一时刻，我所做出的决定都是命运必然的结果，我不违心地去执行就好了。如果上天把两次考研失败作为对我命运的一部分惩罚，那我也接受。毕竟，离清华老师的期望似乎确实有一些出入，尽管他们可能不能理解我可能已经付出了我所力所能及的，或者他们理解但他们确实有更好的候选。</p><p>比如说，当他们问我为什么连夜翻译学校老师的论文时（尽管我只是想暗示自己有较好的读写能力），我着实感到吃惊与诧异，但很快我就释然了。也许他们并不能理解，在我们这样的学校，能出一篇 AEP 的论文是多么地难得，在开始着手翻译时的那样一种期盼，在被他们可能理解成作秀等姿态后，说实话，这是让我面试感到最难受的一点，我很难去解释，也并不想解释，就像某一场我不愿回忆的财经比赛一样。</p><p>再比如说，当他们问我论文中那一系列深度学习的问题时，他们可能不能想到（也许他们有料到）我也已经是全班唯一一个选择深度学习作为自己论题，并且独立展开研究并写了四十多页的人。在我们这样以审会金主打的学校，我也很难去解释这样的一件事：我做着与大多数人不一样的事情，并追逐着与大多数人不一样的目标：绩点之外。但这些解释也是没有意义且懦弱的，我唯一能做与想做的，就是有一天，我告诉他们，我就是你们想要找的人，而非其他。</p><p>如果说大学里有什么遗憾，那大概是遗憾自己没把自己绩点稍微做的好一点，说这个不是因为怪自己绩点不好没申到好的学校和好的公司，不是这样的，说这个仅仅是单纯因为没必要把自己弄得这么难看。毕竟，自己也曾经是全校第一的数学，自己曾经也是 985 的分数，作为一个完美主义者有些东西发现没有做到最好，还是不禁有一些唏嘘。</p><p>但 anyway，这就是自己，这是我大学的失，与其害怕失去一点点，不如索性失去，以博取更大的可能，于是我得到了比绝大多数人更多的社团、竞赛、创业和人生其他比较重要的体验，这些都对我的成长大有裨益。</p><p>比如说，我可能是全校参加华为大赛最多次数的人，连续两年参加了两场华为财经大赛和华为软件大赛，并皆有所猎。这四场比赛，也见证着我对人生规划的一次转向：从金融到软件。或者，更准确地说：从金融回归软件。毕竟第一次上大学时选择的就是软件，后来才转的金融，再后来，也就是现在，再次拥抱的软件。</p><p>我知道，很多人会问为什么，因为所有面过我的面试官几乎都会问，这里统一一下我的回答，这个回答不但但是对原先那些面试官回答的一次修正，更是，我发自内心，以及综合我的人生体会后的结果：</p><p><strong>第一次选择软件，只是单纯觉得乔布斯、比尔盖茨这些人很酷，对软件行业有着盲目的向往。</strong></p><p><strong>第二次选择金融，是因为金融对我有着不逊于软件的吸引力，并且自己在金融行业赚了第一桶金。</strong></p><p><strong>第三次再次选择软件，是因为清晰地认识到我的性格更适合软件，其次我所最憧憬的金融细分领域需要我更强的软件能力才能支撑。</strong></p><p><strong>所以无论是从短期选择，还是长期选择去看，当下，我都必须全身心投入软件领域，尽管我的本科学位是经济学（金融方向）学士。</strong></p><p>但，so？</p><p>既然自己已经失去了左眼，献上右眼又如何，不妨放下所有，离世俗远一点，追逐自己的内心，只为遇见更好的自己。</p><p>音乐尚未停止，我们的故事待续。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="独立外包无数次挑战自己极限">独立外包，无数次挑战自己极限<a class="hash-link" href="#独立外包无数次挑战自己极限" title="标题的直接链接">​</a></h2><p>【音乐：虫语】</p><p>自从大一寒假自学了 python 之后，我对软件的痴迷一发不可收拾，我发现计算机世界里有外人难以理解的神奇魔力，允许我以新的视角去看待每个问题，并找到很多问题的有效答案。</p><p>如果硬要说金融与软件的差异，我觉得在软件领域，我的所有行为都可以很快的得到验证，于是快速迭代直到完美，你能清楚地知道自己现在所处的位置，这是金融领域很难带给自己的体验。</p><p>所以在我现在还孑然一身的时候，以软件为依托的计算机技术，是自己面对世界非常好的武装，它真实存在，且看得见摸得着，让自己心安。</p><p>我用很快的时间入门了 python，并重点掌握了一系列爬虫与反爬虫的技术，既而转向 pandas 的数据分析与 django 的网页技术，并开始迎来自己的一些项目交易，有学校老师的，也有一些企业的。但随着我对这一套数据分析技术的深入，我很快觉察到了它的瓶颈，这也是我后期对我自己所办的金融科技协会比较失望的一个重要原因：我们所要追逐的技术是有用的，但远远不够！我们需要走的更快，但我们无法走地更远了，抱歉。</p><p>于是乎，随着接下来 JavaScript、TypeScript、C++等语言的学习与深入，一条独立外包的路被我杀出，从爬虫到数据中台，从小程序到 PC 端程序到安卓系统研发，从几百一单、几千一单到几万一单再到几十万等等，我发现现在终于迎来了一个有趣的人生阶段：</p><p><strong>只要我想，我可以快速学习任何一门语言，深入任何一个领域，做出令人满意的项目成果。</strong></p><p><strong>所以，不要问我会什么，只需问我能不能做，以及：价钱是否合适。</strong></p><p><strong>而这一切的得来，无不与我的两个经历密切相关：大学四年宽广的知识面涉猎、两次考研极高强度的身心修炼。</strong></p><p>在我二十几岁的生涯里，如果硬要给自己的一切来一个总结与归因，我觉得是”莽“：生于野草，无所羁绊，无所畏惧，是之为莽。</p><p>因为莽，我可以昨日还顶着别人觉得仰不可及的知名企业 title，明日又淡然地钻入尘埃里做一个透明人。生命中的很多节点，开始变得没有那么重要起来，比如说毕业，心智上的毕业开始比仪式上的毕业重要的多得多；比如说工作，能做成一项令别人满意也令自己的满意比一份稳定或者高薪的工作重要的多的多；比如说对象，开始学会如何爱自己如何让自己过得舒服也同时让别人舒服比找一个对象要重要的多的多。</p><p>因为莽，我开始不给自己设限，比如说四月份为一个智能财务方案速成 typescript 和 electron，独立写了十一个从 0 到 1 的脚本，可以信心地对很多人说这个技术我可能比你熟；比如说五月份在长沙从没接触过 js 逆向的我挣扎日夜破解了拼多多上万行混淆代码，一一剥离还原十九个加密函数；比如说六月份在上海从没写过安卓的我整理了数万开发笔记，实现了跨过安卓应用层直接深入 framework 底层再往上基本完成目标的奇迹，在这个月的前期我听到的最多的是：能不能成，以及：为什么明知道自己干不了还要接。</p><p>这些 007 的日夜，这些连自己都不知道自己能不能成的日夜，其实都不算什么，真正让人害怕让人胆怯的是所谓的身份认同感。因为身份的认同缺失，很多人只愿意去做一些体面然而自己并不情愿的工作，虽然也许过得还不错。但我比较喜欢一位朋友对我的评价：我是励志性人格。我是真地那种哪里有压力哪里就有动力的人，这个毛病，可能近几年都改不了了，否则浑身难受。</p><p>所以你才会看到，我的一条独特成长曲线，就在上半年我还在朋友圈说“什么时候开始正式进军 java（以完成我对主流语言的全覆盖）”时，新的机会马上就来临了，并且一次性让自己爽个够，直接就是安卓系统研发，可以耳濡目染世界上最优秀的谷歌工程师写的 java 代码，完成一次淬炼。</p><p>尽管现在，我们可以云淡风轻地说这些了，但是我们依旧不能忽视过程的痛苦，必要的通宵、瓶颈的绝望都是少不了的，团队人员的放弃、资金链的短缺等等问题都可能影响到你的情绪，而我对其他人说的永远就是一点：不管发生什么，我都会坚持到底。</p><p>这就是我的信条了，这也是我对所有人，尤其是我自己承诺。</p><p>我想，这也是毕业真正带给我的意义：</p><p>从毕业起，我们就应该摒弃学生思维，从责任与担当的角度入手，做自己有把握的事，或者做自己坚持到底的事，并贯彻如一。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="赚钱之外我们究竟与什么赛跑">赚钱之外，我们究竟与什么赛跑<a class="hash-link" href="#赚钱之外我们究竟与什么赛跑" title="标题的直接链接">​</a></h2><p>【音乐：comforting sounds】</p><p>其实想说的还有很多，但我知道，许多话，是道不尽的，许多故事，也是述不完的。从曾经自诩为赶路人、摆渡人，到现在摇身一变成为赏金猎手、流浪者，真真是应了那句话：唯一不变的是变化。</p><p>现在摆在每个毕业后的选手面前，要解决的都是如何赚钱的问题，尽管赚钱很重要，这点无法辩驳，但是除了赚钱，我们似乎还是要时不时思考自己究竟与什么赛跑的问题。</p><p>这些问题，在我们顺遂时可能容易忽略，但在我们失意时却往往浮现，并难以逃避。</p><p>最近，我又完整温故了《三国演义》《红楼梦》《汉武大帝》等等经典剧集，在感慨无数中国古代文人志士可歌可泣的故事的同时，也不禁思考自己何去何归的问题。</p><p>也许这个问题很难有一个明确的答案，但以下几点对于目前的我来说则是清晰地：</p><p><strong>我们生于一个历史悠久的国度，它经久不息的文化传承，值得且完全有理由让每一个国人感到自豪与自信。</strong></p><p><strong>我们生于一个文明冲和的时代，它暗潮涌动的格局演绎，值得且完全有理由让每一个国人感到敬畏与警惕。</strong></p><p><strong>我们的每一个决定都很重要，但从另一个角度来说，我们的每一个人决定又都不重要。Always Think.</strong></p><p>对于我来说，除了多想，可能已经没有什么能让我更加痴迷的了。因为在如此高的房价面前，如果只是为赚钱而赚钱，这也着实需要极大的勇气，这么一想，我还算是个懦夫。</p><p>也许骨子里是一个悲观主义者，因为我时常想起小时候看的钓鱼的故事：</p><blockquote><p>你为什么不工作，而在钓鱼？</p><p>工作为了什么？</p><p>工作为了赚大钱，然后有更大的房子。</p><p>然后呢？</p><p>然后就可以钓鱼了啊？</p><p>可我不正在钓鱼吗？</p></blockquote><p>所以我们正在工作，还是正在钓鱼？</p><p>也许两者都是，也许两者都不是。</p><p>就莽吧~</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川逆向笔记 | 攻破 PDD 风控系统（一）]]></title>
            <link>https://markshawn2020.github.io/blog/2021/05/12/记逆向攻破拼多多加密系统</link>
            <guid>/2021/05/12/记逆向攻破拼多多加密系统</guid>
            <pubDate>Wed, 12 May 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[昨夜酉时，一顿困意席卷而来，简单冲洗后便沉沉睡去，深夜恍惚间风雨大作，爽风阵阵，一洗晚春高温，待至凌晨四五点，急雨退去，夜色渐明，雅雀欢喜，想来近日为推进项目，鲜有片刻缓息，此时却是难得的机会，遂有此篇，以备将来不时之需。]]></description>
            <content:encoded><![CDATA[<blockquote><p>昨夜酉时，一顿困意席卷而来，简单冲洗后便沉沉睡去，深夜恍惚间风雨大作，爽风阵阵，一洗晚春高温，待至凌晨四五点，急雨退去，夜色渐明，雅雀欢喜，想来近日为推进项目，鲜有片刻缓息，此时却是难得的机会，遂有此篇，以备将来不时之需。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pdd-风控系统的关键">PDD 风控系统的关键<a class="hash-link" href="#pdd-风控系统的关键" title="标题的直接链接">​</a></h2><p>毫无疑问：<code>Anti-Content</code>。</p><p>打开任意一个<code>XHR</code>请求信息，都会有<code>anti-content</code>请求参数，实践证明，每个请求只要带有合法（且匹配）的<code>anti-content</code>、<code>cookie</code>、<code>user-agent</code>，即可通过网关。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_051355_510571-image-20210511051354770.png" alt="image-20210511051354770" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="pdd-风控系统的调试">PDD 风控系统的调试<a class="hash-link" href="#pdd-风控系统的调试" title="标题的直接链接">​</a></h2><p>打开开发者控制台，选择<code>Network</code>面板，勾选<code>Preserve log</code>和<code>Disable cache</code>，随便选择一个含有<code>Anti-Content</code>参数的请求，复制目标网址。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_052010_435549-image-20210511052009797.png" alt="image-20210511052009797" class="img_vXGZ"></p><p>打开<code>Source</code>面板，添加<code>XHR</code>端点，输入目标网址：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_052243_626430-image-20210511052242962.png" alt="image-20210511052242962" class="img_vXGZ"></p><p>刷新页面，触发断点：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_052529_885098-image-20210511052529476.png" alt="image-20210511052529476" class="img_vXGZ"></p><p>右击左边<code>source tree</code>根节点<code>top</code>选择<code>search all files</code>，或者直接快捷键<code>⌥ ⌘ F</code>，输入目标关键字<code>anti-content</code>，可以发现出现了几个目标结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_053236_772245-image-20210511053236123.png" alt="image-20210511053236123" class="img_vXGZ"></p><p>接下来比较细节，详细步骤如下，首先随意点选一个目标，将定位到目标文件，但是是<code>webpack</code>压缩后的，所以要用<code>{}</code>进行格式美化（这个功能属实是反反爬的最强对手，因为任何代码在格式上无论怎么压缩基本都可以一键还原，因为压缩后的代码必须也要符合语法规范也要能够运行），格式化之后再点击刷新，会多出来一个目标选项，叫<code>app.js.formatted</code>，点击展开，然后再选择其中任意一项：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_053556_779513-image-20210511053556134.png" alt="image-20210511053556134" class="img_vXGZ"></p><p>接下来，可以发现，其实这个<code>Anti-Content</code>是一个中间站，会多次调用，有一个声明、生成、使用的流程。理论上来说，<code>swicth case</code>语句是用来描述多个同类但无联系的选项关系的，但是呢，一方面这是打包后的代码，另一方面开发者不会在某些业务逻辑上难为自己，这将导致自己的代码可维护性很差，所以我们可以直接认为，这里的逻辑就是声明、生成然后使用：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_054225_454199-image-20210511054225067.png" alt="image-20210511054225067" class="img_vXGZ"></p><p>那么我们就只要知道，如何生成就可以了。在<code>e = n.sent()</code>处加断点，然后取消原来的<code>url</code>断点（它的使命已经完成了，我们可以更进一步了），此时右边的<code>Breakpoints</code>会自动多一个断点，这是代码行级别而非文件级别的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_054649_339711-image-20210511054648709.png" alt="image-20210511054648709" class="img_vXGZ"></p><p>再次刷新，发现崩溃了，这是很正常的，由于长时间断点，导致不符合实际的请求逻辑：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_054815_177585-image-20210511054814527.png" alt="image-20210511054814527" class="img_vXGZ"></p><p>我们再再次刷新即可，但是发现数据直接就加载出来了，没有停在断点处，这也是很正常的，因为这个断点是文件格式化后的断点，正常运行时是压缩的文件，它无法直接识别出行级别的断点：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_055044_781445-image-20210511055044163.png" alt="image-20210511055044163" class="img_vXGZ"></p><p>所以原来的<code>XHR</code>断点的使命还没有完成，我们还得把它抓回来，给勾上，重新刷新。熟悉的味道扑面而来，数据加载的小圈不断旋转，仿佛被开了无限月读。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_055246_348713-image-20210511055245725.png" alt="image-20210511055245725" class="img_vXGZ"></p><p>这个时候，就要开始跳跃调试了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_055626_544165-image-20210511055625869.png" alt="image-20210511055625869" class="img_vXGZ"></p><p>我们直接按<code>F8</code>即可。</p><p>好吧，又直接越过了……看样子我们之前的断点打的还是太任性了。再来，重新捕获到文件级别，搜索<code>anti-content</code>，选择另一个文件，再次格式化，再次捕获到一个生成<code>anti-content</code>的语句，加上断点：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_060052_735072-image-20210511060052105.png" alt="image-20210511060052105" class="img_vXGZ"></p><p>然后<code>F8</code>，结果又直接返回了……但别急，如果再次刷新，会发现已经直接定位在了目标位置：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_060320_932072-image-20210511060320301.png" alt="image-20210511060320301" class="img_vXGZ"></p><p>此时，按<code>ESC</code>打开分离式控制台，主动运行语句试试，会发现就是目标结果，而且还是<strong>同步的</strong>，这很关键，因为如果是异步的，我们就很难直接确定是不是我们的目标函数了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_060450_316257-image-20210511060449773.png" alt="image-20210511060449773" class="img_vXGZ"></p><p>接下来更细节，<code>F11</code>跟进函数内部后，我们要分析一下语句，在反调试过程中，任何分支语句都是很关键的，它们对应着业务逻辑，这里的意思就是变量<code>o</code>是一个二维数组，其中第一维是一个布尔整数，第二维是个字符串，如果第一维为 0，就返回第二维（目标字符串），否则就报错，报错信息为第二维（根据经验，是一个更短一些的字符串，最后的展示形式为<code>Ajax</code>返回中的<code>VerifyAuthToken</code>字段。这里值得小心的是<code>o</code>数组直接打印时看似很短，实际是浏览器把中间段给压缩了，取了前 50、后 49 加中间的英文省略号（占一位）（输入：<code>⌥ ;</code>，别问我是怎么知道的，问就是：<a href="https://sspai.com/post/45516" target="_blank" rel="noopener noreferrer">https://sspai.com/post/45516</a> ，顺便夸一句：少数派这个平台的文章质量是真地高）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_061305_287273-image-20210511061304660.png" alt="image-20210511061304660" class="img_vXGZ"></p><p>但如果我们再注意看，会发现，这个<code>send</code>函数的外面正是定义了<code>o</code>的地方，所以这个<code>w = function(e, t) {...}</code>函数就是核心风控函数了，它在这个函数内部进行初始化、赋值、输出等操作，所以我们可以直接在这个函数加断点，然后<code>o.send()</code>那个函的断点可以去掉了，它的使命是真正完成了。接下来，我们再次刷新，成功截在了初始化位置：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_063001_940080-image-20210511063001317.png" alt="image-20210511063001317" class="img_vXGZ"></p><p>这个时候，我们需要知道这个函数，大概是什么规模，点击设置，勾选<code>Bracket matching</code>和<code>Code folding</code>，其中，<code>Bracket matching</code>允许你在括号的左右端按<code>⌃ M</code>定位到另一端，而<code>Code folding</code>允许你将函数折叠，从而直接确定函数的边界。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_063347_487301-image-20210511063346844.png" alt="image-20210511063346844" class="img_vXGZ"></p><p>折叠后，光标选中整个函数，发现一共有<code>3972</code>个字符，在这个选中的函数里，搜索<code>o =</code>赋值，有<code>83</code>个 匹配，这好吗？这不好，那么对于<code>3972</code>个字符的加密函数，我们又该怎么分析，以及对于接近三千行的加密文件，我们该怎么分析，且听下回分解，天大亮了，该干活了（^<!-- -->_<!-- -->^）</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_063647_407857-image-20210511063646786.png" alt="image-20210511063646786" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210511_063855_759678-image-20210511063855344.png" alt="image-20210511063855344" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后声明">最后声明<a class="hash-link" href="#最后声明" title="标题的直接链接">​</a></h2><ol><li>技术是纯粹的，出于对人类向大自然求索而习得的点滴智慧的敬畏，为精进自己的技术以求向真理比别人更进一步，付出自己的时间、精力、智力、金钱等一切投入，都是值得且应当被鼓励的。</li><li>在此过程之中，无意中可能涉及到某些企业的商业利益，对某些企业的系统安全产生威胁，对此我们深感抱歉，同样也深怀感激，我们承诺一切技术不会用于非正当用途。</li><li>本文读者应同样承诺，不将本文技术用于任何非正当用途，任何通过习用本文技术，所构成的潜在的不可预估的风险，应与本文无关。</li></ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Electron 开发笔记 - 从 0 到 1 搭建一个 Electron 应用]]></title>
            <link>https://markshawn2020.github.io/blog/2021/04/14/从0到1搭建一个Electron应用</link>
            <guid>/2021/04/14/从0到1搭建一个Electron应用</guid>
            <pubDate>Wed, 14 Apr 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[0. 技术选型与项目约定]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="0-技术选型与项目约定">0. 技术选型与项目约定<a class="hash-link" href="#0-技术选型与项目约定" title="标题的直接链接">​</a></h2><p>我们将从一个 html 文件起，逐步添加 react、typescript、webpack、electron、redux、react-redux 等内容。</p><p>本项目的前端框架是基于 react 的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="1-配置-html-文件">1. 配置 html 文件<a class="hash-link" href="#1-配置-html-文件" title="标题的直接链接">​</a></h2><p>对任何一个前端应用，html 文件都是必要的，有些框架需要自己定义且允许覆盖（比如 next），有些框架则是内置（creacte-react-app）。</p><p>我们先配置一个基本的 html 文件，如下：</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> MyElectron001 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> MyElectron001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> index.html</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 html 文件中书写的重点是要定以一个 id 元素（本项目中我们约定为<code>app</code>），用于前端（本项目中即<code>react</code>）生成的<code>html</code>内容的替换。</p><p>其他基本信息也可以在<code>head</code>中填写，后续也可以自动替换，我们暂时先硬写<code>title</code>等信息。</p><div class="language-html codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-html codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- index.html --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">MyElectron001</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">title</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个文件理应可以直接打开并在浏览器中展现，只不过还没有什么内容，但是可以看到窗口的标题是我们制定的标题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="2-使用-react-和-react-dom-编写网页内容">2. 使用 react 和 react-dom 编写网页内容<a class="hash-link" href="#2-使用-react-和-react-dom-编写网页内容" title="标题的直接链接">​</a></h2><p>我们使用<code>react</code>可以组件化的创建网页，所以安装<code>react</code>，以及附带的<code>react-dom</code>。</p><p>其中<code>react</code>只包含一个<code>react</code>应用的核心部分，包括组件实现、更新调度等。而<code>react-dom</code>则是一种针对 DOM 的平台实现，主要用于在<code>web</code>端渲染。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add react react-dom typescript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir src &amp;&amp; cd src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim index.js</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// src/index.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"react-dom"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./app"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">App</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"app"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后再创建<code>app.js</code>文件，因为它们引入了。</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> app.js</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="3-使用-webpack-进行打包">3. 使用 webpack 进行打包<a class="hash-link" href="#3-使用-webpack-进行打包" title="标题的直接链接">​</a></h2><p><code>react</code>本身只提供了一种代码书写的范式，它本身并不直接生成相应的前端文件，我们需要用到<code>webpack</code>进行打包。</p><p>返回根目录后，安装<code>webpack</code>相关依赖库，并初始化<code>webpack</code>配置文件。</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -D webpack webpack-cli @webpack-cli/generators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx webpack-cli init    </span><span class="token comment" style="color:#999988;font-style:italic"># 初始化webpack配置文件</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="使用-typescript">使用 typescript<a class="hash-link" href="#使用-typescript" title="标题的直接链接">​</a></h2><p>初始化<code>tsconfiig.json</code>配置文件。</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 自动生成 tsconfig.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># npm install -g typescript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tsc -v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tsc --init</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[记与上海无良房东斡旋经验与教训]]></title>
            <link>https://markshawn2020.github.io/blog/2021/03/12/shamghai-rent-lesson</link>
            <guid>/2021/03/12/shamghai-rent-lesson</guid>
            <pubDate>Fri, 12 Mar 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[我原以为偌大的上海，应该是先进的、包容的，至少是有知识分子情怀的地方。]]></description>
            <content:encoded><![CDATA[<blockquote><p>我原以为偌大的上海，应该是先进的、包容的，至少是有知识分子情怀的地方。</p><p>直到我经历这次租房，天下没有新鲜事，愿生活永远不会欺骗你。</p></blockquote><p>2020 年 3 月 11 日我来到上海闵行，来看预先约好的租房。</p><p>以下是关于此次租房所有违背人情、充斥恶俗的金钱利益导向的沟通记录与体会，本人（南川）保证所有内容如实记录。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="2021-年-03-月-12-日-182427-关于宽带网费">2021 年 03 月 12 日 18:24:27 关于宽带网费<a class="hash-link" href="#2021-年-03-月-12-日-182427-关于宽带网费" title="标题的直接链接">​</a></h2><p>中介和我谈的时候说网费是独立的，如果选用的话，只需要自己配置一个路由器就可以，一个月 50 元，我其实觉得买路由非常不方便，内心是拒绝的，他们说话不嫌蛋疼，说附近买一下几十块钱就可以搞定。在各种忽悠下，我还是签约了。</p><p>由于购买路由器的复杂（涉及到思考路由器的选择等），我想取消合同中的网费，我和房东语音，房东给我的回复是：租房费用 2200，网费 50，这个是必须勾选的，就算我不买路由器不用网，因为他已经提供了网，所以这个 50 依旧要收，这两个是捆绑在一起的。但注意：这与中介谈时的说法并不一致，因为中介当时并非说网费是强制的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/20210312_184237_638197-image-20210312184237263.png" alt="image-20210312184237263" class="img_vXGZ"></p><p>此外，我好言想说，这 50 块钱也不是什么大钱，就不能退还给我吗。他竟然还能厚脸皮地说这点小钱我还要斤斤计较，呵呵。</p><p>反驳：</p><ol><li><p>你提供了网是你的事，我用不用是我的事，我不用你凭什么强扣我的费用。</p></li><li><p>每户每个月网费 50，这么多户，比如 20 户，光是网费就要交你 1000，你可真会赚钱呢。</p></li></ol><p>教训：</p><ol><li>确实存在一些房东是提供网但不提供路由的，他们会通过各种方法诱使你勾选网费一项，请拒绝，网上有各种帖子教你如何自建网络或者通过手机热点等方式联网，绝对比这项网费便宜。</li><li>一旦自己勾选了网费一项，之后就再无回旋之地，他们可以有任何理由堵塞你，使你无法取消这一项。</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="2021-年-03-月-12-日-194105-关于热水问题">2021 年 03 月 12 日 19:41:05 关于热水问题<a class="hash-link" href="#2021-年-03-月-12-日-194105-关于热水问题" title="标题的直接链接">​</a></h2><p>热水，是本次租房中体验最糟糕的一个环节。</p><p>在热水使用过程中，房东频繁以锅炉热水出水慢推卸责任，拒不来房检查与维修，态度傲慢。</p><p>在 3 月 11 日我第一次来到公寓让中介检查淋浴的热水，发现没有热水，我本来以为热水应该不是什么大问题，可能需要刷卡或者打开某个开关。也多次向中介提出让房东及时修理热水的问题，中介也答应了。</p><p>但在与房东的沟通过程当中，房东一直强调由于这栋房是大锅炉</p><hr><p>【未完，不更了，太久远了】</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川 Effie 使用初体验]]></title>
            <link>https://markshawn2020.github.io/blog/2021/01/09/评测-南川Effie使用初体验</link>
            <guid>/2021/01/09/评测-南川Effie使用初体验</guid>
            <pubDate>Sat, 09 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[- Effie 的官网：https://www.effie.co/]]></description>
            <content:encoded><![CDATA[<ul><li>Effie 的官网：<a href="https://www.effie.co/" target="_blank" rel="noopener noreferrer">https://www.effie.co/</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于一位大四学子兼李自然颜粉使用两小时-effie-后的修改建议">关于【一位大四学子兼李自然颜粉使用两小时 Effie 后的修改建议】<a class="hash-link" href="#关于一位大四学子兼李自然颜粉使用两小时-effie-后的修改建议" title="标题的直接链接">​</a></h2><ul><li>原文地址：<a href="https://www.octopath.cn/373e15d8" target="_blank" rel="noopener noreferrer">https://www.octopath.cn/373e15d8</a></li></ul><ul><li>关于【加入微信分享】，agree<ul><li>这里涉及到微信的分享机制，需要设计一定的分享格式，技术上倒不是很难的问题，我相信 Effie 之后应该会完善的。</li><li>而且 Effie 和微信也没有直接竞争关系，所以不会像拼多多微信那样被微信封杀。</li></ul></li></ul><ul><li>关于【加入低频字符窗口】，dismiss<ul><li>这个功能需求，事实上不属于编辑器的目标需求，而是输入法的……建议可以多多研究自己的输入法，我用的搜狗输入法是有打开特殊符号面板的快捷键的（尽管我平时并不会用到……）。</li></ul></li><li>关于【加入列表同级交互】，doubt<ul><li>我个人觉得支持思维导图层面操作结点的关系已经够了，原因有二：<ul><li><ol><li>思维导图层面操作结点关系更加直观，相较于在文字编辑模式内更方便。</li></ol></li><li><ol start="2"><li>某些软件的设计，就完全是编辑模式与阅览模式分离的，比如为知笔记和知名的 Vim 软件，它们注重内容的安全问题，有效防止误操作。在 Effie 的编辑模式不考虑列表顺序的调整，一方面可以减少对鼠标的依赖，另一方面也容易保护这种安全，此外，也可以减少使用者的关注点分离。总之：编辑模式就是输入文字与展示。（可以看到，Effie 的父级列表支持展开与收起，它不影响列表的内容）</li></ol></li></ul></li></ul></li><li>关于【深色模式字体颜色】，doubt<ul><li>我觉得还好，一般到了晚上，应该是沉浸式写作的大好时机，所以基本上都会关闭侧边栏，因此就不用考虑和侧边栏色调的同一问题。此外，这个灰度还是能够有效减少对眼睛的伤害的。</li><li>当然了，你说的灰色和白色的中间色，我觉得应该也可以。</li></ul></li><li>关于【Ctrl+1 的快捷键】，doubt<ul><li>在流行的 Markdown 编辑软件 Typora 中，它的 Ctrl+1~6 六个快捷键能够将一段文本变成 1~6 级标题，我认为这个快捷键设置是比较合理的。</li><li>在 Mac 上，目前 Effie 只配置了 Command+1，用于开启或关闭侧边栏，个人觉得相对于 Typora 来说，这个快捷键有点点奢侈……可以考虑考虑采纳 Typora 的快捷键，因为就我自己的使用体验来说，Command+1~6 快速设置段落的标题级别还是很常用的，体验很好。</li><li>至于顺不顺手……这……使用习惯问题趴。</li></ul></li><li>关于【编程软件的思路】<ul><li>其实不叫编程软件，而是 Markdown 规范。在 Markdown 书写语系里，N 个#号接空格后的段落就是 N 级标题，-号接空格后的段落就是无序列表，数字加点接空格后的段落就是有序列表。</li><li>目前能够流畅输出 Markdown 的编辑软件很多，比较典型的是 Typora，也兼顾了审美和功能，Effie 可以说是同类产品中审美方面确实是做的最极致的，但同时，功能上也确实略有不足。</li><li>期待看到“思考家”的标签能走多远，是想想而已，还是真地沉思，有待未来 Effie 的自我迭代。</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="我的使用收获与建议">我的使用收获与建议<a class="hash-link" href="#我的使用收获与建议" title="标题的直接链接">​</a></h2><ul><li><p>思维导图</p><ul><li>这个必须点赞！其实吧，思维导图用过的人都知道，这玩意更适合分享而非存储，所以在 Effie 里，以文字为载体，思维导图作为附加的展示形式附庸在文字的主体上，这是一个很有趣也高明的设计。</li><li>对于这款软件内为什么要支持思维导图，设计的考虑等，李自然大哥已经在宣传视频里讲的很清楚了，观点我也基本认同。</li></ul></li><li><p>段落号</p><ul><li><strong>简洁的真谛不是删去什么而是留下什么</strong>，于是，不是行号，而是段落号，这就像一个个里程碑，稀疏地散落在自己的足迹上，兼顾了审美需求与功能需求，是非常值得肯定的。</li><li>不过呢，我个人觉得，也不能如此死板，我推荐的设计是输入模式与向下滚动时是沉浸式写作，但向上滚动时，应该能够显示文章名、字符总数等基本信息，在开发层面这就是一个 Sticky Header，倒也不难实现。</li><li>但个人建议空段落不计数。</li></ul></li><li><p>图片</p><ul><li>尽快加入对图片的支持，还是有必要的，Markdown 刚推出来的时候也是不支持图片，目前呢？几乎没有一个主流 Markdown 编辑器、解析器、IDE 是不支持图片的。</li></ul></li><li><p>留白</p><ul><li>在文章篇幅较长，超过半屏甚至一屏后，文字的输入已经到达了屏幕底部，但留给用户下方的留白并不够，我尝试了一下向上滑动，发现也滑不了。</li><li>个人建议应支持滑动展示更多留白，否则只能通过多敲几个空白段落以使留白能够撑起至少三分之一的下方屏幕，但在 Effie 里这是灾难性的，因为空白段落依旧会有右边的段落号……</li></ul><ul><li>个人建议考虑一下 Typora 支持的“打字机模式”，即始终使输入焦点保持在屏幕中间那一行，还是很有意思的。</li></ul></li><li><p>总结</p><ul><li>除了不支持图片插入导致文章的整体呈现还缺少一定的表现力度之外，与留白不够导致必须插入几个空段落使目光聚焦点能够上移之外，无其他任何觉得不适之处。</li><li>惊喜远大于不足，这是一款审美在线、理性与感性兼具的产品，我愿意将它作为自己持续生产的主要战场。</li><li><strong>Yes，Effie！</strong></li></ul></li><li><p>最后</p><ul><li>感谢杜海川同学的推荐！</li><li>感谢李自然大哥的创意与设计！</li><li>（时机成熟，我打算自己用 React Native 模仿开发一下 Effie，嘿嘿）</li></ul></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[拜登获胜演讲稿]]></title>
            <link>https://markshawn2020.github.io/blog/2020/11/20/拜登获胜演讲稿</link>
            <guid>/2020/11/20/拜登获胜演讲稿</guid>
            <pubDate>Fri, 20 Nov 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[1. ## 演讲稿原文]]></description>
            <content:encoded><![CDATA[<ol><li><h2 class="anchor anchorWithStickyNavbar_rB0w" id="演讲稿原文">演讲稿原文<a class="hash-link" href="#演讲稿原文" title="标题的直接链接">​</a></h2><p>Hello.</p><p>My fellow Americans, and the people who brought me to dance: Delawareans.</p><p>I see my buddy Tom, Senator Tom Carper, down there. And I think, I think Senator Coons is there. And I think the governor’s around and…Is that Ruth Ann? And that’s former Governor Ruth Ann Minner. Most importantly, my sisters-in-law, my sister, Valerie. Anyway.</p><p>Folks, the people of this nation have spoken.</p><p>They’ve delivered us a clear victory.</p><p>A convincing victory.</p><p>A victory for “We the People.”</p><p>We’ve won with the most votes ever cast for a presidential ticket in the history of this nation – 74 million.</p><p>Well, I must admit it surprised me tonight. We’re seeing, all over this nation, all cities and all parts of the country, indeed across the world, an outpouring of joy, of hope, renewed faith in tomorrow <!-- -->[to]<!-- --> bring a better day.</p><p>And I’m humbled by the trust and confidence you’ve placed in me.</p><p>I pledge to be a President who seeks not to divide, but unify.</p><p>Who…who doesn’t see Red states and Blue states, only sees the United States.</p><p>And who’ll work with all my heart, with the confidence of the whole people, to win the confidence of all of you.</p><p>And for that is what America, I believe, is about. It’s about people.</p><p>And that’s what our administration will be all about.</p><p>I sought this office to restore the soul of America.</p><p>To rebuild the backbone of this nation – the middle class.</p><p>And to make America respected around the world again and to unite us here at home.</p><p>It’s the honor of my lifetime that so many millions of Americans have voted for that vision.</p><p>And now the work of making that vision is real. It’s a task, the task of our time.</p><p>Folks, as I said many times before, I’m Jill’s husband.</p><p>And I would not be here without her love and tireless support of Jill, and my son Hunter, and Ashley, my daughter, and all our grandchildren and their spouses, and all our family.</p><p>They’re my heart.</p><p>Jill is a mom – a military mom – an educator.</p><p>She’s dedicated her life to education, but teaching isn’t just what she does – it’s who she is.</p><p>For American educators, this is a great day for you all: You’re going to have one of your own in the White House, and Jill is going to make a great First Lady. I’m so proud of her.</p><p>I’ll have the honor of serving with a fantastic vice president who you just heard from, Kamala Harris – who makes history as first woman, first Black woman, the first woman from South Asian descent, the first daughter of immigrants ever elected in this country. Don’t tell me it’s not possible in the United States.</p><p>It’s long overdue, and we’re reminded tonight of those who fought so hard for so many years to make this happen. But once again, America’s bent the arc of the moral universe more towards justice.</p><p>Kamala, Doug – like it or not – you’re family. You’ve become an honorary Biden, and there’s no way out.</p><p>To all those of you who volunteered, and worked the polls in the middle of this pandemic, local elected officials – you deserve a special thanks from the entire nation.</p><p>And to my campaign team, and all the volunteers, and all who gave so much of themselves to make this moment possible, I owe you, I owe you. I owe you everything.</p><p>And to all those who supported us: I’m proud of the campaign we built and ran. I’m proud of the coalition we put together, the broadest and most diverse coalition in history.</p><ul><li>Democrats, Republicans, Independents.</li><li>Progressives, moderates, conservatives.</li><li>Young and old.</li><li>Urban, suburban, rural.</li><li>Gay, straight, transgender.</li><li>White. Latino. Asian. Native American.</li></ul><p>I mean it. Especially for those moments…and especially for those moments when this campaign was at its lowest ebb – the African American community stood up again for me. You’ve always had my back, and I’ll have yours.</p><p>I said at the outset I wanted to represent this campaign to represent and look like America, we’ve done that. Now that’s what I want the administration to look like and act like.</p><p>For all those of you who voted for President Trump, I understand the disappointment tonight.</p><p>I’ve lost a couple of times myself.</p><p>But now, let’s give each other a chance.</p><p>It’s time to put away the harsh rhetoric, lower the temperature, see each other again, listen to each other again.</p><p>And to make progress, we have to stop treating our opponents as our enemies.</p><p>They are not our enemies. They are Americans. They’re Americans.</p><p>The <em>Bible</em> tells us to everything there is a season – a time to build, a time to reap, and a time to sow. And a time to heal.</p><p>This is the time to heal in America.</p><p>Now this campaign is over – what is the will of the people? What is our mandate?</p><p>I believe it’s this: America has called upon us to marshal the forces of decency, the forces of fairness. To marshal the forces of science and the forces of hope in the great battles of our time.</p><ul><li>The battle to control the virus.</li><li>The battle to build prosperity.</li><li>The battle to secure your family’s health care.</li><li>The battle to achieve racial justice and root out systemic racism in this country.</li><li>And the battle to save our planet by getting climate under control.</li><li>The battle to restore decency, defend democracy, and give everybody in this country a fair shot.</li></ul><p>That’s all <!-- -->[that]<!-- --> they’re asking for: <strong>a fair shot</strong>.</p><p>Folks, our work begins with getting COVID under control.</p><p>We cannot repair the economy, restore our vitality, or relish life’s most precious moments – hugging our grandchildren, our children, our birthdays, weddings, graduations, all the moments that matter most to us – until we get it under control.</p><p>On Monday, I will name a group of leading scientists and experts as Transition Advisors to help take the Biden-Harris COVID plan and convert it into an action blueprint that will start on January the 20th, 2021.</p><p>That plan will be built on bedrock science. It will be constructed out of compassion, empathy and concern.</p><p>I’ll spare no effort, none – or any commitment – to turn around this pandemic.</p><p>Folks, I’m a proud Democrat. But I will govern as an American president. I’ll work as hard for those who didn’t vote for me – as those who did.</p><p>Let this grim era of demonization in America begin to end – here and now.</p><p>Refusal of Democrats and Republicans to cooperate with one another – it’s not some mysterious force beyond our control.</p><p>It’s a decision, a choice we make.</p><p>And <strong>if we can decide not to cooperate, then we can decide to cooperate</strong>. And I believe that this is part of the mandate given to us from the American people. They want us to cooperate in their interest.</p><p>And that’s the choice I’ll make. And I’ll call on Congress – Democrats and Republicans alike – to make that choice with me.</p><p>The American story is about slow, yet steadily widening the opportunities in America.</p><p>And make no mistake: Too many dreams have been deferred for too long.</p><p>We must make the promises of the country real for everybody – no matter their race, their ethnicity, their faith, their identity, or their disability.</p><p>Folks, America has always been shaped by inflection points – by moments in time where we’ve made hard decisions about who we are and what we want to be.</p><ul><li>Lincoln in 1860 – coming to save the Union.</li><li>FDR in 1932 – promising a beleaguered country a New Deal.</li><li>JFK in 1960 – pledging a New Frontier.</li><li>And twelve years ago – when Barack Obama made history – and told us, “Yes, we can.”</li></ul><p>Well, folks, we stand at <strong>an inflection point</strong>.</p><p>We have an opportunity to defeat despair, to build a nation of prosperity and purpose.</p><p>We can do it. I know we can.</p><p>I’ve long talked about the battle for the soul of America.</p><p>We must restore the soul of America.</p><p>Our nation is shaped by <strong>the constant battle between our better angels and our darkest impulses</strong>. And what presidents say in this battle matters.</p><p>It’s time for our better angels to prevail.</p><p>Tonight, the whole world is watching America. And I believe at our best, America is a <strong>beacon</strong> for the globe.</p><p><strong>We will lead not only by the example of our power, but by the power of our example. </strong></p><p>I’ve always believed – many of you heard me say it – I’ve always believed we can define America in one word: <strong>Possibilities</strong>.</p><p>That in America, everyone should be given an opportunity to go as far as their dreams and God-given ability will take them.</p><p>You see, I believe in the possibilities of this country.</p><p>We’re always looking ahead:</p><ul><li>Ahead to an America that is freer and more just.</li><li>Ahead to an America that creates jobs with dignity and respect.</li><li>Ahead to an America that cures diseases – like cancers and Alzheimer’s.</li><li>Ahead to an America that never leaves anyone behind.</li><li>Ahead to an America that never gives up, never gives in.</li></ul><p>This is a great nation. It’s always been a bad bet to bet against America.</p><p>We’re good people.</p><p>This is <strong>the United States of America</strong>.</p><p>And there’s never been anything…never been anything we’ve been not able to do when we’ve done it together.</p><p>Folks, in the last days of the campaign, I’ve begun thinking about a hymn that means a lot to me and my family, particularly my deceased son Beau. It captures the faith that sustains me and which I believe sustains America.</p><p>And I hope – and I hope it can provide some comfort and solace to the 230,000 Americans who’ve lost a loved one to this terrible virus this year. My heart goes out to each and every one of you. Hopefully, this hymn gives you solace as well. And it goes like this:</p><blockquote><p>And He will raise you up on eagle’s wings,</p><p>Bear you on the breath of dawn,</p><p>And make you just shine like the sun,</p><p>And hold you in the palm of His Hand.”</p></blockquote><p>And now, together – on eagle’s wings – we embark on the work that God and history have called upon us to do.</p><p>With full hearts and steady hands, with faith in America and in each other, with a love of country, a thirst for justice, let us be the nation that we know we can be.</p><ul><li>A nation united.</li><li>A nation strengthened.</li><li>A nation healed.</li></ul><p><strong>The United States of America.</strong></p><p>Ladies and gentlemen, there’s never, never been anything we’ve tried we’ve not been able to do.</p><p>So remember: as my grandpa…our grandpappy said when I walked out of his home, when I was a kid up in Scranton, <!-- -->[he]<!-- --> said: “Joey, keep the faith.”</p><p>And our grandmother, when she was alive, she yelled: “No, Joey, spread it.”</p><p><strong>Spread the faith.</strong></p><p>God love you all. May God bless America, and may God protect our troops.</p><p>Thank you. Thank you. Thank you.</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="词汇理解">词汇理解<a class="hash-link" href="#词汇理解" title="标题的直接链接">​</a></h2><table><thead><tr><th>单词/词组</th><th>释义</th></tr></thead><tbody><tr><td>fellow</td><td>n. 人;家伙;同伴;同志；a. 同伴的;同阶级的</td></tr><tr><td>folks</td><td>n. 人们, 父母, 亲人, 家属</td></tr><tr><td>deliver</td><td>vt. 交付,递送;表达,发表;使分娩;投;击打;解放</td></tr><tr><td>outpouring</td><td>n. 注出;流出(物);流露,倾诉(of)</td></tr><tr><td>humble</td><td>a. 卑微的；vt. 使变卑微</td></tr><tr><td>restore</td><td>vt. 归还;重建;使痊愈;复职</td></tr><tr><td>backbone</td><td>n. 脊椎;分水岭;中枢;主力;志气,骨气,毅力;(山)主脉,主脊</td></tr><tr><td>spouse</td><td>n. 夫;妻;配偶</td></tr><tr><td>decent</td><td>a. 不差的;正当的;宽大的；<!-- -->[俗]<!-- --> (服装)合身份的</td></tr><tr><td>honorary</td><td>a. 道义上的；名誉的；有荣誉的；光荣的</td></tr><tr><td>coalition</td><td>n. 结合；(政治)联盟</td></tr><tr><td>diverse</td><td>a. 不同的；种种的；互异的；多种的,多样的</td></tr><tr><td>democrat</td><td>n. 民主主义者，民主党人</td></tr><tr><td>urban</td><td>adj. 城市的,都城的，城镇的</td></tr><tr><td>suburban</td><td>a. 郊区的,市郊的；郊外的；市郊特有的</td></tr><tr><td>rural</td><td>adj. 农村的</td></tr><tr><td>ebb</td><td>n. 退潮,落潮；v. 退，落，衰退，减退</td></tr><tr><td>rhetoric</td><td>n. 修辞学(书籍)；修辞法；华丽的文体；花言巧语；夸张</td></tr><tr><td>opponent</td><td>n. 竞争者，对手，反对者</td></tr><tr><td>reap</td><td>v. 取得成果，收获，收割（庄稼）</td></tr><tr><td>mandate</td><td>n. （政府或组织等经选举而获得的）授权；v. 授权</td></tr><tr><td>decency</td><td>n. 端庄；礼貌；正派；正当行为；能被社会认同的必要条件</td></tr><tr><td>prosperity</td><td>n. 兴旺，繁荣，成功，昌盛</td></tr><tr><td>racial</td><td>adj. 种族的，种族间的，人种的</td></tr><tr><td>vitality</td><td>n. 活力;持久性;生动;耐力</td></tr><tr><td>grim</td><td>a. 严厉的;狰狞的</td></tr><tr><td>defer</td><td>v. 延期;顺从;展期;服从;拖延,迁延,迟缓</td></tr><tr><td>ethnicity</td><td>n. 种族地位，种族渊源，种族划分</td></tr><tr><td>impulse</td><td>n. 冲动(可数加 s); 突如其来的念头; 推动; 冲量</td></tr><tr><td>prevail</td><td>vi. 流行;说服;盛行;成功;获胜</td></tr><tr><td>dignity</td><td>n. 高尚;尊严;威严;高尚的品德</td></tr><tr><td>heal</td><td>vt. 恢复健康;治疗;使和解；vi. 愈合;恢复健康</td></tr><tr><td>systemic racism</td><td>系统性种族主义</td></tr><tr><td>put away</td><td>把…收起，收好，把…关进监狱，把…送进精神病医院</td></tr><tr><td>place in</td><td>放入</td></tr><tr><td>pledge to</td><td>保证</td></tr><tr><td>root out</td><td>根除</td></tr><tr><td>bring to</td><td>使（某人）苏醒;使达到</td></tr><tr><td>call upon us</td><td>召唤</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_rB0w" id="作文素材">作文素材<a class="hash-link" href="#作文素材" title="标题的直接链接">​</a></h2><p><strong>1. We're seeing, all over this nation, all cities and all parts of the country, indeed across the world, an outpouring of joy, of hope, renewed faith in tomorrow <!-- -->[to]<!-- --> bring a better day.</strong></p><p>我们看到，在全国各地、所有城市、全国各地，甚至在全世界，人们都迸发出欢乐、希望和对明天带来更美好日子的新信心。</p><blockquote><p>独立主格结构，让结构短促有力，增强的可读性，让读者或听着，更加容易接受笔者的观点</p></blockquote><p><strong>2. She was dedicated her life to education.</strong></p><p>她一生致力于教育事业</p><blockquote><p>be dedicated … to (doing)…致力于，加分词，可多加积累，如：be committed … to (doing)…,bend/devote/apply oneself to , hammer at</p></blockquote><p><strong>3. It captures the faith that sustains me and which I believe sustains America.</strong></p><p>它抓住了支撑着我的信念，我相信正是这种信念支撑着美国。</p><blockquote><p>that 和 which 分别作为关系代词指代 me 的宾语和 American 的宾语，但是因为语意分别用 that 和 which</p></blockquote><p><strong>4. Its long overdue, and were reminded tonight of those who fought so hard for so many years to make this happen.</strong></p><p>这是姗姗来迟的，今晚让我们想起那些为实现这一目标而努力多年的人们。</p><blockquote><p>who 作后置定语，修饰 those，这样的定语可以用于作文中，为文章添彩，但也不宜重复用，可以尝试用 who/whose/which 等一系列的定语润色文章</p></blockquote><p><strong>5. With full hearts and steady hands, with faith in America and in each other, with a love of country, a thirst for justice, let us be the nation that we know we can be. A nation united. A nation strengthened. A nation healed.</strong></p><p>全心全意，用坚定的双手，对美国和对彼此的信念，对国家的爱，对正义的渴望，让我们成为一个我们知道我们可以成为的国家。一个统一的国家、一个更强的国家、一个治愈的国家。</p><blockquote><p>with 的状语，后面句式整齐，增强了文章的气势和情感，可用于结尾，附带总结性的句式增强文章的冲击力。</p><p>justice、possibility、fair 文中提到的三个中心词，尤为突出了美国民主的三个要素，公正，可能性，平等，详见后文的文化背景补充。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="党政文化">党政文化<a class="hash-link" href="#党政文化" title="标题的直接链接">​</a></h2><p>了解美国大选背后的文化背景，有助于理解阅读文章。</p><p>所以我们梳理了一些考研相关的资料，希望有用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="一美国政治制度">一、美国政治制度<a class="hash-link" href="#一美国政治制度" title="标题的直接链接">​</a></h3><p>美国实行分权与制衡的原则，立法、行政、司法三种权力分别由国会、总统、法院掌管，三个部门行使权力时，彼此互相牵制，以达到权力平衡。</p><ol><li><p>行政---Administration/the White House（美国总统）</p></li><li><p>立法---Congress（人民）</p></li><li><p>司法---Supreme Court（9 个大法官 justice，包括 1 个首席大法官和 8 个大法官、大法官终身制）、联邦最高法院有权裁定联邦和各州的任何法律违宪而不被采用。</p></li></ol><h4 class="anchor anchorWithStickyNavbar_rB0w" id="权力制衡">权力制衡<a class="hash-link" href="#权力制衡" title="标题的直接链接">​</a></h4><p>三权分立并不是绝对的；其以权力制衡的原则来实行。行政官员与法官的薪金由国会所决定，但国会不能增加或减少总统的薪金，或减少法官在其任期内的薪金。</p><p>议院拥有弹劾行政官员与法官的权力；参议院则负责覆核所有的弹劾提议。值得注意的是参议员与众议员并不当为文官：其并不可作为弹劾的对象（若参众两院的议员有三分二或以上要求某议员退任，则没问题）在众议院只要有过半数支持便可通过弹劾议案，但此议案要经由参议院再作议决，并要获得三分二支持方可生效。若官员被定罪，则会自动离任。在弹劾过程里除移除其职位或阻止其转职外，并没有其他惩罚，但其所犯罪行则会在弹劾后作出审讯并处罚。</p><p>国会与总统亦可影响司法部门的组成。国会可以成立次级法院并拥有独立司法权。此外，国会负责限制法院组成人员的数量。法官则由总统在聆听国会建议并获得其认同后指派。参众两院或任何一院皆有可能会被总统命令召开紧急会议。而副总统是参议院的主席。总统可以在听取参议院的建议与取得其认同后任命法官。其亦可颁布特赦或缓刑令。其特赦令不用经过国会审核，亦不用得到被授予者同意。</p><p>美国总统亦是美国陆，海，空三军的总司令。法院：法院通由司法审查权来控制行政部门与立法部门。这个慨念并没有写进宪法里，但却是众多宪法草拟者的设想（如联邦主义议文集也曾提及）。美国最高法院院长在总统被弹劾期间会在参议院里任议会主席。然而参议院的规则并没有给予议会主席很多权力，所以最高法院院长在这里的角色只是较为无足轻重的。总统：美国总统可以通由行使议案否决权来控制国会，但参众两院若各有三分二的票数反对该否决，则这议案否决权便没效。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="2013-4-考研英语阅读题目">2013-4 考研英语阅读题目<a class="hash-link" href="#2013-4-考研英语阅读题目" title="标题的直接链接">​</a></h4><p>\37. On which of the following did the Justices agree, according to Paragraph4?</p><p>[A]<!-- --> Federal officers’ duty to withhold immigrants’ information.</p><p>[B]<!-- --> States’ independence from federal immigration law.</p><p>[C]<!-- --> States’ legitimate role in immigration enforcement.</p><p>[D]<!-- --> Congress’s intervention in immigration enforcement.</p><p>需要了解题目里涉及到的 Federal，State，Congress 等名词。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二美国司法陪审制度">二、美国司法陪审制度<a class="hash-link" href="#二美国司法陪审制度" title="标题的直接链接">​</a></h3><p>美国的法律制度和我国不同，我国遵从大陆法，是有明确的法律条文的。判案是需要依据已有的法律法规的。这就要求法律条文详细，周全。英美法，是惯例法，主要依靠前人积累的经验，对今天的案件做出判决。它很鲜明的特点在于，<strong>没有明确法律条文，它靠的是人的判断</strong>。而法律共同体拥有对法律的解释权。</p><p>考研英语一阅读 2012 年第二篇文章和考研英语二 2010 年第四篇文章都涉及美国的这种司法制度。以 2012 年英语一为例，这篇文章涉及州和联邦法律的权限问题。</p><p>\29. In the author’s view, the Vermont case will test</p><p>[A]<!-- --> Entergy’s capacity to fulfill all its promises.</p><p>[B]<!-- --> the mature of states’ patchwork regulations.</p><p>[C]<!-- --> the federal authority over nuclear issues .</p><p>[D]<!-- --> the limits of states’ power over nuclear issues</p><p>如果了解这一文化常识，就能掌握整片文章的主旨大意。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="三美国党派">三、美国党派<a class="hash-link" href="#三美国党派" title="标题的直接链接">​</a></h3><p>传统来说，<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%B7%A6%E6%B4%BE/1276733" target="_blank" rel="noopener noreferrer">左派</a>通常主张积极改革，主张把旧的意识形态和制度革除，从而建立新的意识形态和制度，<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%8F%8D%E5%AF%B9%E6%B4%BE/4522609" target="_blank" rel="noopener noreferrer">反对派</a>一般自认为<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%B7%A6%E6%B4%BE/1276733" target="_blank" rel="noopener noreferrer">左派</a>；<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%8F%B3%E6%B4%BE/93512" target="_blank" rel="noopener noreferrer">右派</a>一般较为保守，主张稳妥、秩序、渐进、缓慢的改革方式，强调维护旧有传统，<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E4%BF%9D%E7%9A%87%E5%85%9A/9247272" target="_blank" rel="noopener noreferrer">保皇党</a>一般自认为<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E5%8F%B3%E6%B4%BE/93512" target="_blank" rel="noopener noreferrer">右派</a>。</p><p>左派与右派都是相对而言，在不同背景下两者主张的具体内容不会相同，不能以静态的“主义”或“阶级”划分。两词是相当广泛的形容用词，用以作为一种广泛的<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E8%BE%A9%E8%AF%81%E6%B3%95/100991" target="_blank" rel="noopener noreferrer">辩证法</a>解释方式，可以用作形容或区分一种政治立场、一种<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E6%94%BF%E6%B2%BB%E6%84%8F%E8%AF%86%E5%BD%A2%E6%80%81/10349938" target="_blank" rel="noopener noreferrer">政治意识形态</a>、或是一个政治党派。除非是将其套用至多维的<a href="https://link.zhihu.com/?target=https%3A//baike.baidu.com/item/%E6%94%BF%E6%B2%BB%E5%85%89%E8%B0%B1/1363101" target="_blank" rel="noopener noreferrer">政治光谱</a>上，否则这两词通常是用以描述两种完全相对的立场。例如在堕胎（The abortion）这一事件上，民主党同意，共和党不同意。在控枪（Gun control）这一事件上，民主党支持控制枪支的使用，而共和党不支持。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="四美国的第一份政治性契约五月花号公约">四、美国的第一份政治性契约——五月花号公约<a class="hash-link" href="#四美国的第一份政治性契约五月花号公约" title="标题的直接链接">​</a></h3><p>五月花号公约（THE MAYFLOWER COMPACT）：1620 年 11 月 11 日，经过在海上六十六天的漂泊之后，一艘来自英国的名为“五月花”的英国 3 桅盖伦大帆船向美洲陆地靠近。船上有一百零二名乘客。他们的目的地本是哈德逊河口地区，但由于海上风浪险恶，他们错过了目标，于是就在现在的科德角外普罗温斯顿港抛锚。</p><p>为了建立一个大家都能受到约束的自治基础，他们在上岸之前签订了一份公约，这份公约被称为《“五月花号”公约》，签署人立誓创立一个自治团体，这个团体是基于被管理者的同意而成立的，而且将依法而治。 这是美国历史上第一份重要的政治文献。</p><p>此公约对美国的影响贯穿了从签订之始到如今，它是美国建国的奠基，也是现在美国信仰自由、法律等的根本原因。</p><p>《五月花号公约》是美国历史上第一份政治性契约。这份写在粗糙羊皮纸上的《五月花号公约》作为美国历史上的第一个政治契约性文件，内容虽然很简单，却在美国政治思想史上占有重要地位，因为他预示了民主政治的许多理念：人民可以通过自己的公意决定集体行动，以自治的方式，管理自己的生活；行使统治必须经过民众的同意；人民可以通过公议的契约建立秩序，而不是由人民之上的权威予以强加。它标志着“政府需经被统治者的同意方可实行统治”这一原则得到认同并得以实施。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="五美国联邦最高法院">五、美国联邦最高法院<a class="hash-link" href="#五美国联邦最高法院" title="标题的直接链接">​</a></h3><p>美国是联邦制国家，除了联邦政府拥有司法、立法、行政三权分立之机制外，州亦拥有独立于联邦而产生的司法、立法、行政机构。</p><p>宪法没有授权联邦政府亦没有禁止州和其人民行使的权利，由各州及其人民所保留。美国的州政府形象地说是一个“小国”。联邦法院与州法院同时存在且互不隶属。</p><p>州有对非联邦案件的终审权。但当涉及到《美利坚合众国宪法》的诉讼时，当事人有权将案件一直上诉至联邦最高法院。</p><p>美国联邦最高法院对各种提交的案件，一般由 9 位大法官以简单多数票的表决方法来决定。1882 年开始发行的官方汇编的《美国联邦最高法院判例汇编》，其中的判例对法庭有约束力，为审理同案件的依据。</p><p>美国宪法没有直接提到美国联邦最高法院是否有司法审查权。但是美国联邦最高法院曾经通过的马伯里诉麦迪逊案的判决指出，美国联邦最高法院有权宣布某个法律违宪而不被采用。</p><p>美国联邦最高法院并不是由人民选出的，而是由参议院同意后，总统方可任命，即：<strong>任命制</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="六一些术语双语">六、一些术语（双语）<a class="hash-link" href="#六一些术语双语" title="标题的直接链接">​</a></h3><p>联邦制（federal system）</p><p>联邦政府（federal government）</p><p>白宫（White House）</p><p>州政府（state government）</p><p>宪法（Constitution）</p><p>宪法修正案（Amendment）</p><p>①The First Amendment 言论自由修正案</p><p>②The Second Amendment 枪支控枪自由</p><p>③Forth Amendment 隐私保护法案</p><p>民主党 Democratic Party，又被称为左派政党 The left，或者自由党 The Liberal</p><p>共和党 Republican Party，又被称为右派政党 The Right，或者保守党 The Conservative。</p><p>联邦调查局（FBI）</p><p>联邦调查局 Federal Bureau of Investigation，司法部的调查机关。</p><p>中央情报局（CIA）</p><p>中央情报局 Central Intelligence Agency，美国最大的情报机构。</p><p>行政权 Executive power，分为两个层级：</p><p>联邦政府 The Federal government</p><p>州政府 The state government，归于两部分：</p><p>立法权 Legislative power</p><p>国会 The Congress</p><p>州议会 The state congress</p><p>国会包含众议院和参议院——</p><p>众议院：The House of Representatives，简称 The House</p><p>参议院：The Senate House，简称 The Senate</p><p>司法权 Judicial power</p><p>最高法院（The Federal Supreme Court）：</p><p>法官（justices）</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="参考资料">参考资料<a class="hash-link" href="#参考资料" title="标题的直接链接">​</a></h2><ol><li><a href="https://zhuanlan.zhihu.com/p/76683145" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/76683145</a></li><li><a href="https://zhuanlan.zhihu.com/p/77159242" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/77159242</a></li><li>团队整理：南川、华琼 、聂鹏、肖婷婷</li></ol></li></ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[五台山论道（节选自《遥远的救世主》）]]></title>
            <link>https://markshawn2020.github.io/blog/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）</link>
            <guid>/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）</guid>
            <pubDate>Wed, 28 Oct 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[image-20201028073315388]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073315388.png?x-oss-process=style/small" alt="image-20201028073315388" class="img_vXGZ"></p><p>守门僧人前面带路领着二人进入寺院，穿过大佛殿时，见到大殿中央台面上端坐一尊金身大佛，周围是一些佛教法器，佛前燃着香火。出了大佛殿拐了几道弯来到明心阁，屋内青砖铺地，陈设简单，木制桌椅呈现出古旧的色泽，临门站着一位 60 多岁身穿灰色僧袍的老者，他个子不高，身材消瘦，下颌的胡须已经花白了。</p><p>守门僧人恭敬地介绍道：“这位就是智玄大师。”接着对智玄大师双手合十躬身行礼低声道：“弟子告退。”又对客人合十行礼，这才退下。</p><p>智玄大师说：“两位施主，请坐下说话。”</p><p>明心阁的房子不是很大，四周墙壁上有一些佛教字画，屋内正中摆着一张老式方桌和 4 把木椅，3 人围桌而坐，桌上放着丁元英的一首词和压在纸上的信封。智玄大师把信纸和信封轻轻往前推了一下，说：“敢问施主什么是真经？修行不取真经又修的什么行呢？”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073445790.png?x-oss-process=style/small" alt="image-20201028073445790" class="img_vXGZ"></p><p>韩楚风不知道这首词的内容，就势拿过看了一遍，上面写道——</p><p><strong>悟</strong></p><p><strong>悟道休言天命，</strong></p><p><strong>修行勿取真经。</strong></p><p><strong>一悲一喜一枯荣，</strong></p><p><strong>哪个前生注定？</strong></p><p><strong>袈裟本无清净，</strong></p><p><strong>红尘不染性空。</strong></p><p><strong>幽幽古刹千年钟，</strong></p><p><strong>都是痴人说梦。</strong></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073559905.png?x-oss-process=style/small" alt="image-20201028073559905" class="img_vXGZ"></p><p>韩楚风马上明白了智玄大师为什么要提这样的问题，所不同的是，大师心里有解，而他心里无解，他在心里是真正的提问：什么是真经？修行不取真经还修什么？他觉得词中诸如“休言”、“勿取”、“痴人说梦”之类的用词过于激烈了，不太妥当。但此时他更关心的是丁元英如何回答这个问题，或者说他更想知道这个问题的答案。</p><p>丁元英回答道：“大师考问晚辈自在情理之中，晚辈就斗胆妄言了。<strong>所谓真经，就是能够达到寂空涅碦的究竟法门，可悟不可修。修为成佛，在求。悟为明性，在知。修行以行制性，悟道以性施行，觉者由心生律，修者以律制心。不落恶果者有信无证，住因住果、住念住心，如是生灭。不昧因果者无住而住，无欲无不欲，无戒无不戒，如是涅碦。</strong>”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073628371.png?x-oss-process=style/small" alt="image-20201028073628371" class="img_vXGZ"></p><p>智玄大师含笑而问：“不为成佛，那什么是佛教呢？”</p><p>丁元英说：“<strong>佛乃觉性，非人，人人都有觉性不等于觉性就是人。人相可坏，觉性无生无灭，即觉即显，即障即尘蔽，无障不显，了障涅碦。觉行圆满之佛乃佛教人相之佛，圆满即止，即非无量。若佛有量，即非阿弥陀佛。佛法无量即觉行无量，无圆无不圆，无满无不满，亦无是名究竟圆满。晚辈个人以为，佛教以次第而分，从精深处说是得道天成的道法，道法如来不可思议，即非文化。从浅义处说是导人向善的教义，善恶本有人相、我相、众生相，即是文化。从众生处说是以贪制贪、以幻制幻的善巧，虽不灭败坏下流，却无碍抚慰灵魂的慈悲。</strong>”</p><p>智玄大师说：“以施主之文笔言辞断不是佛门中人，施主参意不拘经文，自悟能达到这种境界已属难能可贵。以贫僧看来，施主已经踩到得道的门槛了，离得道只差一步，进则净土，退则凡尘，只是这一步难如登天。”</p><p>丁元英说：“承蒙大师开示，惭愧！惭愧！佛门讲一个‘缘’字，我与佛的缘站到门槛就算缘尽了，不进不出，亦邪亦正。与基督而言我进不得窄门，与佛而言我不可得道。我是几等的货色大师已从那首词里看得明白，装了斯文，露了痞性，满纸一个‘嗔’字。今天来到佛门净地拜见大师，只为讨得一个心安。”</p><p>这时，一个小僧人走进来恭敬地对智玄大师合十行礼，说：“师父，都准备好了。”说完转身退了出去。</p><p>智玄大师站起来说：“两位施主，请到茗香阁一叙。”</p><p>丁元英和韩楚风跟着智玄大师出了明心阁，向左转穿过一道长廊，来到一间题名为“茗香阁”的房舍。茗香阁比刚才的明心阁大得多，进门迎面就看见墙上挂着一副横幅，上面写着“清净自在”四个潇洒飘逸的大字。横幅下面整齐地摆放着笔墨纸砚和一个紫檀木制成的围棋棋盘，棋盘上是两盒棋子。房间北墙的位置是一块由天然怪石当成的茶几，石面上摆着盖碗茶具、茶叶罐，茶几四周是几个树根凳子，主座位旁边是一个木炭炉子和一个装水的木桶，炉子上架着铜壶，壶里的水已经快开了，听得见嗡嗡的响声。</p><p>智玄大师伸手示意说：“两位施主请坐。”待客人落座后智玄大师问道：“施主以钱敲门，若是贫僧收下了钱呢？”</p><p>韩楚风答道：“我们就走。如果是钱能买到的东西，就不必拜佛了。”</p><p>智玄大师豁然一笑，分别往盖碗里放入茶叶，提起冒着蒸气的铜壶逐一将开水冲进 3 只盖碗，盖上碗盖说：“这是寺里自制的茶，水是山上的泉水，请两位施主品尝。”</p><p>丁元英揭开碗盖，一股带着山野气息的清香扑鼻而来，只见碗中的茶汤呈淡绿色，碗底的茶叶根根形态秀美。他端起茶碗喝了一小口，禁不住地说了声：“好茶。”</p><p>韩楚风端起茶品了一口，顿知此茶品质绝非一般，此情此景令他心生感慨，不禁想起了那副“坐，请坐，请上座；茶，上茶，上好茶”的对联。</p><p>智玄大师放下茶碗，说：“施主上山并非为了佛理修证，有事不妨道来，贫僧虽老学无成，念句‘阿弥陀佛’却还使得。”</p><p>于是，丁元英把“神话”、“扶贫”的来龙去脉以及已经做的和将要做的向智玄大师简要讲了一遍，并且着重解释了主观上的“杀富济贫”和文化属性思考。这显然已经不是简单的市场竞争，也不是简单的扶贫，而是基于一种社会文化认识的自我作为。</p><p>智玄大师听完之后沉思了许久，说：“施主已胜算在手，想必也应该计算到得手之后的情形，势必会招致有识之士的一片声讨、责骂。<strong>得救之道，岂能是杀富济贫？</strong>”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028074103997.png?x-oss-process=style/small" alt="image-20201028074103997" class="img_vXGZ"></p><p>韩楚风随口一问：“那得救之道是什么？”</p><p>这一问使智玄大师突然怔住了，顿然明白了丁元英“杀富济贫”的用心和讨个心安的由来，说道：“<strong>投石击水，不起浪花也泛涟漪，妙在以扶贫而命题。当有识之士骂你比强盗还坏的时候，责骂者，责即为诊，诊而不医，无异于断为绝症，非仁人志士所为，也背不起这更大的骂名。故而，责必论道。</strong>”</p><p>丁元英说：“<strong>晚辈以为，传统观念的死结就在一个‘靠’字上，在家靠父母，出门靠朋友，靠上帝、靠菩萨、靠皇恩……总之靠什么都行，就是别靠自己。这是一个沉积了几千年的文化属性问题，非几次新文化运动就能开悟。晚辈无意评说道法，只在已经缘起的事情里顺水推舟，借英雄好汉的嗓子喊上两声，至少不违天道朝纲。</strong>”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028074152879.png?x-oss-process=style/small" alt="image-20201028074152879" class="img_vXGZ"></p><p>韩楚风来五台山之前只知道丁元英要拜见高僧大德，少不了谈经论道，却并不知道丁元英拜佛的具体目的，直到这时才完全明白。</p><p>智玄大师说：“以施主之参悟，心做心是，何来讨个心安呢？”</p><p>丁元英说：“无忏无愧的是佛，晚辈一介凡夫，不过是多识几个字的嘴上功夫，并无证量可言。<strong>我知道人会骂我，我以为佛不会骂我，是晚辈以为，并非真不会挨骂。大师缘何为大师？我以为是代佛说话的觉者。</strong>”</p><p>智玄大师略微思忖了一下，说：“贫僧乃学佛之人，断不可代佛说话，亦非大师。得救之道自古仁人志士各有其说，百家争鸣。贫僧受不起施主一个‘讨’字，仅以修证之理如实观照，故送施主四个字：<strong>大爱不爱</strong>。”</p><p>丁元英双手合十给智玄大师恭敬行了一个佛礼，说道：“谢大师！”</p><p>智玄大师说：“<strong>弱势得救之道，也有也没有。没有竞争的社会就没有活力，而竞争必然会产生贫富、等级，此乃天道，乃社会进步的必然代价。无弱，强焉在？一个‘强’字，弱已经在其中了。故而，佛度心苦，修的是一颗平常心。</strong>”</p><p>韩楚风因为先前不了解情况，所以一直没有参与谈话。此时听了智玄大师一番话心生感慨，说道：“佛教主张利和同均，大师坦言等级乃天道与代价，不拘门户之见，令晚辈十分敬佩。晚辈在想，如果强者在公开、合法的情况下都可以做到杀掠，那么在不公开、不合法的条件下，弱势还剩下多大空间？佛度心苦虽慈悲，但人毕竟还有物质的一面。”</p><p>智玄大师对韩楚风笑了笑，说：“施主不必拘礼，请讲。”</p><p>韩楚风说：“<strong>如果主流文化能在弱势群体期望破格获取与强势群体期望更高生命价值的社会需求之间建立一个链接的纽带，或许更有积极意义。强势群体仅仅适用一般的竞争规则是不够的，主流文化应该对强势道德提出更高的要求，构建强势文化体系，赋予强势群体更高的生命价值。当然，这首先是以不平等为先决条件。</strong>”</p><p>智玄大师说：“<strong>利和同均，不平等已在其中。</strong>”</p><p>韩楚风说：“<strong>主流文化，当是推动社会进步、改善社会关系的文化。如果人的行为首先是政治的或宗教的需要，那么这种价值无疑也首先是政治的或宗教的价值。当社会将道德价值全部锁定在政治文化和宗教文化的时候，个人道德就没有价值空间了，既不利于鼓励强势对弱势的关注，也不利于社会整体道德素质由量变到质变的转化。</strong>”</p><p>智玄大师说：“施主的观点与佛教的主张并不矛盾，不同的是施主认为主流文化应该给强者个人一定的道德价值空间。贫僧以为，无论功德记在哪一家的账上，风调雨顺、国泰民安都将是众生的福报。”</p><p>韩楚风说：“只是，等级一直是我们社会文化的禁区，大家所以小心翼翼绕开禁区，是唯恐平等、尊严之类的东西受到伤害。”</p><p>喝过一道茶，智玄大师给大家续上一轮开水，对丁元英宽怀一笑，说：“释、道、儒是中国传统文化的三大体系，施主这一刀下去，一个都没幸免哪，哈哈哈……”</p><p>丁元英说：“不敢，不敢。<strong>释、道、儒均是博大精深的学派，支撑中华民族走过了几千年的文明历程，是伟大的文明。但是，社会在发展，传统文化毕竟是以皇恩浩荡为先决条件的文化，讲的都是皆空、无为、中庸的理，以抑制个性而求生求解。当今社会已经发展到了市场经济的民主与法制，诸家学说也面临一个如实观照而俱进的课题，是传统？还是传承？统则僵死，承则光大。</strong>”</p><p>智玄大师说：“施主尚未畅所欲言，不好。海纳百川，施主纵是沧海一滴，我佛也愿汇而融之。今日有缘一叙，自当请施主开诚布公，以利佛理修证。”</p><p>丁元英说：“晚辈叹服佛法究竟真理真相的辩证思维，如是不可思议。但是，<strong>晚辈以为佛教包括了佛法，而佛法有别于佛教。佛教以佛法证一，进而证究竟，最终是为给心找个不苦的理由，成佛，无量寿，极乐。佛教以假度真的方便法门住福相、住寿相、住果相，是以无执无我为名相的太极我执，致使佛教具有了迷信、宿命、贪执的弱势文化特征，已然障蔽佛法。晚辈以为，如果佛教能依佛法破除自身迷障，不住不拘个人解脱，以佛法的如是不可思议究竟生产力与文明的真理真相，则佛法的佛教即出离宗教的佛教，成为觉悟众生的大乘法度，慧于纲纪泽于民生，是名普度众生。</strong>”</p><p>智玄大师沉默不语，静静地看着丁元英，过了许久黯然感叹道：“<strong>得智的得智，化缘的化缘，烧香的烧香，坐禅的坐禅。</strong>”</p><p>丁元英和了一句：“<strong>各尽所能，各取所需。</strong>”</p><p>智玄大师说：“两位施主请随我来。”</p><p>丁元英和韩楚风随智玄大师走到书案近前，只见智玄大师在书案上展开一张一尺见方的宣纸，把丁元英的那首词放在旁边，研墨蘸笔，写道——</p><p><strong>悟道方知天命</strong></p><p><strong>修行务取真经</strong></p><p><strong>一生一灭一枯荣</strong></p><p><strong>皆有因缘注定</strong></p><p>写完之后智玄大师放下笔，说：“<strong>此‘天’非彼‘天’，非众生无明之天，亦非众生无明之命，此乃道天，因果不虚，故而改字‘方知’。修行不落恶果虽有信无证，却已无证有觉，已然是进步。能让迷者进步的经即是真经，真经即须务取。悲喜如是本无分别，当来则来，当去则去，皆有因缘注定，随心、随力、随缘。</strong>”</p><p>智玄大师信手把原句的“休言”改成了“方知”，把原句的“勿”改成了“务”，把原句的“悲、喜”改成了“生、灭”，把原句的“哪个前生”改成了“皆有因缘”。九个字的改动，理虽同是，而意思、意境、意气却全然不同，即灭嗔怒、我慢，直指究竟。</p><p>韩楚风看后赞叹地点点头，说：“精妙！九字之境，无证而证。”</p><p>丁元英再度给智玄大师恭敬行了一个佛礼，说：“谢大师开示。”</p><p>智玄大师把修改过九字的上阕词送给丁元英，说道：“贫僧与施主的一阕之缘今日圆了上阕，贫僧九字不实之处还望施主修正。下阕贫僧不改了，留半阕缘待续，倘若施主在某年的某一日想改下阕了，如蒙不弃，可带着改过的下阕再来圆续半阕之缘。”</p><p>丁元英说：“承蒙大师不弃，一定。”</p><p>三人又回到各自的座位继续喝茶。</p><p>智玄大师端起茶碗呷了一口，放下，说：“施主身上乃三气居中啊。”</p><p>韩楚风不解其意，问：“哪三气？”</p><p>智玄大师答道：“<strong>三分静气，三分贵气，三分杀气。</strong>”</p><p>韩楚风闻声心里一颤，没有人能比他更了解丁元英了，这正是丁元英的真实品性。他惊叹大师的观察力，问道：“十分之气，还有一分呢？”</p><p>智玄大师说：“<strong>还有一气住于身中，游离心外——痞气。</strong>”</p><p>韩楚风脱口而出一个字：“绝！”</p><p>……</p><p>正说话间，一个中年僧人来到茗香阁，站在门口双手合十，对智玄大师说：“师父，大觉寺的慧明法师已经来了。”</p><p>智玄大师点了点头，对丁元英和韩楚风说：“施主稍候，贫僧去去就来。你们可先到后院走走，景致极好。今天就不要走了，晚上和慧明法师一起用斋，咱们随缘一叙。”</p><p>丁元英起身合十顶礼道：“谢大师！”</p><p>4</p><p>丁元英和韩楚风两人出了茗香阁，穿过一道拱形门来到一禅寺的后院，后院也是依山势而建，院中几棵环抱粗的古银杏树掩隐着几间禅房，飘了一地的落叶，远处传来隐隐约约的钟声，更加衬托出这千年古寺的清静幽谧。</p><p>两人踏着石阶路向上走，后院的尽头是一个大石台，周围立着一圈石柱做的栏杆，栏杆之间有铁链相连。站在平台上放眼望去，只见远处山峦叠嶂，西下的夕阳像一枚金红色的果子挂在山尖上，强劲的山风带着一股浓浓的寒意。</p><p>韩楚风掏出烟给丁元英一支，问：“佛门净地能抽烟吗？”</p><p>丁元英笑笑说：“栏内是净，栏外是土，靠着栏杆就能抽。”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073759293.png?x-oss-process=style/small" alt="image-20201028073759293" class="img_vXGZ"></p><p>韩楚风也笑了，两人点上烟，韩楚风说：“刚才有话没敢说，怕有吹捧之嫌，可又不吐不快，现在可以说了。<strong>扶贫的事若以次第而分，也有三个层面。一、天上掉馅饼的神话，实惠、破格，是为市井文化。二、最不道德的道德，明辨是非，是为哲人文化。三、不打碎点东西不足以缘起主题，大智大爱，是为英雄文化。</strong>”</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073825821.png?x-oss-process=style/small" alt="image-20201028073825821" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028073846883.png?x-oss-process=style/small" alt="image-20201028073846883" class="img_vXGZ"></p><p>丁元英说：“不敢当，不敢当。”话音刚落，突然意识到了什么，自嘲道：“咱们怎么转起文来了？可别恍恍惚惚以为自己也是大师了。”</p><p>韩楚风也意识到了，说：“惯性，惯性，一下子收不回来了。”</p><p>两人哈哈一笑。</p><p>韩楚风面向群山，手抚着石栏说：“这趟如果不来，真是人生一大憾事。只是你我都有谤佛之嫌，也不怕下了地狱？”</p><p>丁元英说：“没有地狱，天堂焉在？总得有人在地狱呆着，咱们就算上一个，不然天堂就没着落了。”</p><p>韩楚风笑了笑，说：“一招杀富济贫引出得救之道的讨论，骂的是你，疼的却是传统观念。一年多不见你怎么有了这么高的境界？”</p><p>丁元英摆摆手说：“哪里是境界，我还没冲动到为了让舆论溅几滴水花就去招惹那种骂名。当‘得救之道’的讨论浮出水面，那就是我要送给小丹的礼物。”</p><p>韩楚风顿然目瞪口呆，脱口一声：“啊？我的天！你知道这件事得折腾多少人？得惹多大动静？原来就是……就是给一个女人的礼物？”</p><p>丁元英说：“<strong>天下之道论到极致，百姓的柴米油盐。人生冷暖论到极致，男人女人的一个‘情’字。</strong>这两个极致我都没敢冒犯，不可以吗？”</p><p>韩楚风说：“可以，当然可以。只是你一向对女人敬而远之，这个弯子转得太大了。”</p><p>丁元英说：“<strong>佛说看山是山、看水是水，我只是依佛法如实观照，看摩登女郎是摩登女郎，看红颜知己是红颜知己。</strong>”</p><p>韩楚风望着远处连绵起伏的山峦，感叹道：“<strong>古有千金一笑之说，如今一看，那千金一笑又算得了什么？</strong>”</p><p>（节选自《遥远的救世主》第 20 章第 3-4 节）</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028072657071.png?x-oss-process=style/small" alt="image-20201028072657071" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028072726653.png?x-oss-process=style/small" alt="image-20201028072726653" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="南川注">南川注<a class="hash-link" href="#南川注" title="标题的直接链接">​</a></h2><p>以史观之，佛教亦曾正统，但南朝四百八十寺，多少楼台烟雨中，度众生之佛法无边，只因人的精神无边，人的自觉不灭，度众生之佛教有量，只因物的实质有量，人的慧根、时境各有不同。昔日周武灭佛，灭的正是以行制性、以律制心之辈，也灭那些个入世无望的逃离之徒。</p><p>入世，即是生产力，是经济，是发展，是稳定，是正统，也是儒教可以一脉相传至今的穴门。倘置入世不闻不顾，所谓君道孝道，所谓成功失败，均无从谈起，均无所牵挂，他不再是他，你不再是你，人虽仍是社会关系的总和，只当社会关系为零时，他便遁入了空。</p><p>但空又不等于得佛涅槃之道，既有得，便必不为空，所以空又不等于无，依此观照。学佛法理，大爱无爱，正如老子所言天地不仁以万物为刍狗，若是杀富济贫，杀的是天下损不足而奉有余的富，济的是损有余而补不足的贫，虽刀刀见血，剑剑封喉，佛以慈悲为怀，亦唯有滴泪观之。</p><p>天道与人道均生于道，无论是天道，还是人道，是黑道，亦或白道，人人修佛，人人求道，佛不可不度，道不可不求，方有得智的得智，化缘的化缘，烧香的烧香，坐禅的坐禅。能让迷者进步的经即是真经，真经即须务取。悲喜如是本无分别，当来则来，当去则去，皆有因缘注定，随心、随力、随缘。</p><p>此文妙哉，妙在尤以实观里，洞若观火，作者开光凿道，着实煞费苦心，小川不才，仅以全文恭奉，权当度几度人了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201028072507617.png?x-oss-process=style/small" alt="image-20201028072507617" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[大学沉思录：一路失败，我到底学到了什么]]></title>
            <link>https://markshawn2020.github.io/blog/2020/10/16/大学沉思录：一路失败，我到底学到了什么</link>
            <guid>/2020/10/16/大学沉思录：一路失败，我到底学到了什么</guid>
            <pubDate>Fri, 16 Oct 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[你一定是想听听我的大学故事，并看看是否对自己有所启发，我希望我不会让你失望。]]></description>
            <content:encoded><![CDATA[<p>你一定是想听听我的大学故事，并看看是否对自己有所启发，我希望我不会让你失望。</p><p>2020 年 6 月，我毕业于南京的一所双非院校，金融专业，三个月后，我通过了某头部互联网公司开发岗的社招面试。</p><p>多轮面试中，我总被问的一个问题是：“你学的是金融，然后申的是软件？”</p><p>或者，这么问：“你一开始学的是软件（2013 年我在某 985 读软件工程，次年退学），然后又学了金融，最后申的是软件？”</p><p>他们不解，我曾经，也不解。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="乏善可陈的履历">乏善可陈的履历<a class="hash-link" href="#乏善可陈的履历" title="标题的直接链接">​</a></h2><p>没有履历那就创造履历，我似乎总是不断闯入别人的视线，引起争议。</p><p>在高中时，我只是一名普通班学生，却总是能考到校数学第一或者第二名，并成为了省数学竞赛唯二两名一等奖之一。</p><p>在大学时，我只是一名金融专业学生，却带领两位同样非科班出生的学长打进了华为软件比赛的复赛，几乎所有人都不知道我们学校是啥学校。</p><p>我从未想标榜自己，可是命运总是跟我开着玩笑，你们说难道不是吗？如果没有希望，也许就没有失望。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="从高考到软件">从高考到软件<a class="hash-link" href="#从高考到软件" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="从软件到金融">从软件到金融<a class="hash-link" href="#从软件到金融" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="从金融到软件">从金融到软件<a class="hash-link" href="#从金融到软件" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="从技术到系统">从技术到系统<a class="hash-link" href="#从技术到系统" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="从失败中看自己">从失败中看自己<a class="hash-link" href="#从失败中看自己" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="成功与失败的评判">成功与失败的评判<a class="hash-link" href="#成功与失败的评判" title="标题的直接链接">​</a></h3><blockquote><p>【大连理工】</p><p><a href="https://weibo.com/u/3196558395?refer_flag=1001030106_" target="_blank" rel="noopener noreferrer">不吃海带的小盆友</a> ： 读到“不断的……不断的做着无用功”就不行了！上学都是在告诉我如何才能成功，却没有一个能告诉我怎么才能接受平庸！人生不如意十之八九，能与人说者却无二三！也没啥可说的……就这样吧就这样吧！</p><p><a href="https://weibo.com/1504145281?refer_flag=1001030103_" target="_blank" rel="noopener noreferrer">许川</a> ：“我<em>一</em>定要很好，当我不够好的时候，我就不配别人爱我。”</p><p><a href="https://weibo.com/u/2944572682?refer_flag=1001030106_" target="_blank" rel="noopener noreferrer">卡布奇诺多加糖啊</a> ： 一直觉得活着挺无聊的，但是死了妈妈会难受，于是我就正常的谈恋爱结婚，以后会生孩子，等妈妈死了后，孩子可能就是我的羁绊吧，又会因为舍不得孩子所以活着，人生就是要有羁绊</p></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大一失败的代客理财">大一失败的代客理财<a class="hash-link" href="#大一失败的代客理财" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大二失败的社团管理">大二失败的社团管理<a class="hash-link" href="#大二失败的社团管理" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大三失败的比赛策略">大三失败的比赛策略<a class="hash-link" href="#大三失败的比赛策略" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大四失败的考研经历">大四失败的考研经历<a class="hash-link" href="#大四失败的考研经历" title="标题的直接链接">​</a></h3><p>【王阳明】</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大学失败的感情经历">大学失败的感情经历<a class="hash-link" href="#大学失败的感情经历" title="标题的直接链接">​</a></h3><p>《亲密关系》</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大学失败的创业经历">大学失败的创业经历<a class="hash-link" href="#大学失败的创业经历" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大学失败的纸面成绩">大学失败的纸面成绩<a class="hash-link" href="#大学失败的纸面成绩" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="重新审视这一切">重新审视这一切<a class="hash-link" href="#重新审视这一切" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="从历史看当代">从历史看当代<a class="hash-link" href="#从历史看当代" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="当条件不足以支撑自己的野心">当条件不足以支撑自己的野心<a class="hash-link" href="#当条件不足以支撑自己的野心" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="人生如逆旅我亦是行人">人生如逆旅，我亦是行人<a class="hash-link" href="#人生如逆旅我亦是行人" title="标题的直接链接">​</a></h3><p>《活出生命的意义》</p><blockquote><p><strong>我记得香港有个作家陶杰曾经说过：“当你老了，回顾一生，就会发觉：什么时候出国读书、什么时候决定做第一份职业、何时选定了对象而恋爱、什么时候结婚，其实都是命运的巨变。只是当时站在三岔路口，眼见风云千樯，你作出抉择的那一日，在日记上，相当沉闷和平凡，当时还以为是生命中普通的一天。”</strong></p><p><strong>——《杀鹌鹑的少女》</strong></p></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="天地不仁以万物为刍狗">天地不仁，以万物为刍狗<a class="hash-link" href="#天地不仁以万物为刍狗" title="标题的直接链接">​</a></h3><p>《道德经》</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="自我革命的计划">自我革命的计划<a class="hash-link" href="#自我革命的计划" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原则生活中的指导">原则——生活中的指导<a class="hash-link" href="#原则生活中的指导" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="承认不足">承认不足<a class="hash-link" href="#承认不足" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="平静内心">平静内心<a class="hash-link" href="#平静内心" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="平衡节制">平衡节制<a class="hash-link" href="#平衡节制" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="节流社交">节流社交<a class="hash-link" href="#节流社交" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="保持阅读">保持阅读<a class="hash-link" href="#保持阅读" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="定期清扫">定期清扫<a class="hash-link" href="#定期清扫" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="有效自律">有效自律<a class="hash-link" href="#有效自律" title="标题的直接链接">​</a></h4><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原则决策时的依据">原则——决策时的依据<a class="hash-link" href="#原则决策时的依据" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="大局为重">大局为重<a class="hash-link" href="#大局为重" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="风险控制">风险控制<a class="hash-link" href="#风险控制" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="互惠非攻">互惠非攻<a class="hash-link" href="#互惠非攻" title="标题的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_rB0w" id="诚实正直">诚实正直<a class="hash-link" href="#诚实正直" title="标题的直接链接">​</a></h4><h3 class="anchor anchorWithStickyNavbar_rB0w" id="问道国有国法家有家规拿什么对抗我们的人性">问道——国有国法，家有家规，拿什么对抗我们的人性<a class="hash-link" href="#问道国有国法家有家规拿什么对抗我们的人性" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="参考">参考<a class="hash-link" href="#参考" title="标题的直接链接">​</a></h2><p><a href="https://www.zhihu.com/question/288017836/answer/458863937" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/288017836/answer/458863937</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[大学沉思录：意向调查]]></title>
            <link>https://markshawn2020.github.io/blog/2020/10/16/大学沉思录：意向调查</link>
            <guid>/2020/10/16/大学沉思录：意向调查</guid>
            <pubDate>Fri, 16 Oct 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[我们都喜欢听好听的故事，看好看的人，你喜欢，我也喜欢，大家都喜欢，这是人性，爱美之心人皆有之，美美与共天下大同。]]></description>
            <content:encoded><![CDATA[<p>我们都喜欢听好听的故事，看好看的人，你喜欢，我也喜欢，大家都喜欢，这是人性，爱美之心人皆有之，美美与共天下大同。</p><p>好听的故事里，我们可以看到希望。</p><p>不好听的故事里，我们总好像，可以看到自己。</p><p>譬如大连理工，譬如成都大学，最近发生的事情，如洪水猛兽，驱之不散。大连理工事件下一则热评如是说道：</p><blockquote><p><strong>不吃海带的小盆友</strong> ： 读到“不断的……不断的做着无用功”就不行了！上学都是在告诉我如何才能成功，却没有一个能告诉我怎么才能接受平庸！人生不如意十之八九，能与人说者却无二三！也没啥可说的……就这样吧就这样吧！</p></blockquote><p>“上学都是在告诉我如何才能成功，却没有一个能告诉我怎么才能接受平庸”，难道不是吗？</p><p>这一年来，我把一半的时间用在转行上（侥幸成功），四年的文凭仿佛一张废纸，诉说着命运的调侃。另一半的时间用在对历史的阅读、对社会的阅读上，试图弥补大学期间荒废的对人生观、对世界观的学习。</p><p>我逐渐认识到，千百年来，由于文明的尚未开化，世界的尚未连结，历次革命都奉行的是对别人的革命，都是向外的革命，无论是工业革命革除农业的命，亦或辛亥革命革除封建与帝国的命。</p><p>而当下，很少有人意识到，由于阶级的固化，思想的统一，每个人，尤其是那些想要向上的人，迫切地需要一场对自己的革命。</p><p>我知道，我知道我的观点，并不新鲜，但以我有限的智慧想出这样的一条道路，还是让我自己倍感欣喜，并毫不掩饰地奉若圭臬。</p><p>自我革命，是发自内心地对自己的省察，对自己的破除与对自己的超越。是独立于任何人的依赖与羁绊：他的身体、他的能力、他的家庭、他的阶级、他的一切处境与他的一切信奉。</p><p>自我革命，从一个更高的视角俯瞰自己，对自己的过往开诚布公地进行批判，对自己进行否定后再否定，以试图实现对自己认知、思维的刷新，与对自己性格、命格的重塑。</p><p>我知道、我相信有一部分人，我的朋友们，也殷切地想获取这样的一种“自我意识的觉醒”，但他们并不敢抱有太高的期望。就如曾经的我一样。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201016164421385.png" alt="image-20201016164421385" class="img_vXGZ"></p><p>现在，由于人生的刻意安排，我相信，我已经来到了可以好好地审视自己的时间点，去回应苏格拉底的训言：“未经审视的人生不值得过”。</p><p>我拟写了我反思自我的大纲，列如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20201016165233898.png" alt="image-20201016165233898" class="img_vXGZ"></p><p>我几经执笔，又几经放下，直面自己微不足道的成绩，对抗自己难以接受的平庸，说实话，我有想逃避。</p><p>我向几位朋友表达了我的这项意愿，有些人支持，有些人反对，这些都是宝贵的意见，我都有慎重地思考，我的每一项决定对于我的将来，会有怎样的影响，会引发怎样的波澜。</p><p>现在，作为我唯一的对外宣传窗口，我的公众号，我想听听关注我的你们是如何看待这样的一项计划的。我将发起一个投票，如果你们也希望听到站在当下我的心声，也鼓励我去解剖我的一切内心真实写照，你可以在接下来的投票中选择“just do it”；否则，请选择“please dont't”；或者选择“I don't care”。</p><p>如果选择 Yes 的票数超过三分之二，且超过 1000，我决定听从这项天命，完成对自己彻底的分析，完篇长度大概在 1-10 万字之间。</p><p>那末，就开始吧，请避免无意义的拉票，如果你真地很想拉票，请配上相对严肃的图文，谢谢理解。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JS、ES、TS、node、Vue、React 修炼]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/22/JS、ES、TS、node、Vue、React修炼</link>
            <guid>/2020/09/22/JS、ES、TS、node、Vue、React修炼</guid>
            <pubDate>Tue, 22 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[node 运行 js、es、ts 脚本]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="node-运行-jsests-脚本">node 运行 js、es、ts 脚本<a class="hash-link" href="#node-运行-jsests-脚本" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="0-运行前检查">0. 运行前检查<a class="hash-link" href="#0-运行前检查" title="标题的直接链接">​</a></h3><p>首先全局安装<code>es-checker</code>： <code>npm i -g es-checker</code>。</p><p>接着运行<code>es-checker</code>，可以检查项目内<code>node</code>对<code>es特性</code>的支持情况。</p><p>以我的项目（<code>mark-nuxt-koa-wechaty</code>）为例，运行<code>node -v</code>得知版本为<code>v12.18.3</code>，这已经是很新的<code>node</code>了。</p><p>但是，运行<code>es-checker</code>，会发现并不支持<code>import, export 和 tail-call</code>。</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">……（其他类型的支持情况已省略）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ Class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ super allowed in object methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ class ABC extends Array { .. }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  × Module export command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  × Module import command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Passes 39 feature Detections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your runtime supports 92% of ECMAScript 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因此，对于不同种类、使用了不同语法特性的 js 脚本，运行环境需要作相应地配置。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-对于纯-es5-编写的-js-脚本">1. 对于纯 ES5 编写的 js 脚本<a class="hash-link" href="#1-对于纯-es5-编写的-js-脚本" title="标题的直接链接">​</a></h3><p>即 js 脚本中只有<code>require</code>之类的常规操作，直接使用<code>node xx.js</code>即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-对于使用了import-export等-es6-特性的-js-脚本">2. 对于使用了<code>import, export</code>等 ES6 特性的 js 脚本<a class="hash-link" href="#2-对于使用了import-export等-es6-特性的-js-脚本" title="标题的直接链接">​</a></h3><p>解决方案一：使用<code>node -r esm xx.js</code>，需要提前<code>npm i esm</code>，顾名思义，<code>esm</code>就是<code>es module</code>的含义。</p><p>解决方案二：将<code>xx.js</code>改为<code>xx.mjs</code>，然后使用<code>node xx.mjs</code>。顾名思义，<code>mjs</code>就是<code>module js</code>的含义。</p><p>推荐使用第二种，这样不用修改文件类型。</p><p>*<!-- -->解决方案三：使用<code>babel-node</code>，这个以后再研究，参考：<a href="https://juejin.im/post/6844903561910812685" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6844903561910812685</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-对于引用了其他本地资源的-js-脚本">3. 对于引用了其他本地资源的 js 脚本<a class="hash-link" href="#3-对于引用了其他本地资源的-js-脚本" title="标题的直接链接">​</a></h3><p>例如，在我的项目中，使用了<code>dotenv</code>包以读取项目中<code>.env</code>文件内的环境变量，在我的 js 脚本中，我有如下的两句：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dotenv'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于，这个<code>.env</code>是在项目根目录下，因此，上述直接使用<code>node xx.js</code>的方式是不行了。</p><p>正确的运行方式，需要在项目根目录运行，即<code>node xx/xx.js</code>。</p><p>当然了，如果这个脚本本来就和项目根目录平行的话，那么<code>node xx.js</code>依旧是可行的。</p><p>但最重要的，由于一个标准项目，都需要各种资源的引用，因此单文件运行是不怎么可取的，所以都需要通过<code>package.json</code>进行统一配置。</p><p>因此，我们在<code>package.json</code>中加入<code>script</code>即可，例如。</p><div class="language-json codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-json codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"test_xx"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node xx/xx.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="4-运行-ts-脚本">4. 运行 ts 脚本<a class="hash-link" href="#4-运行-ts-脚本" title="标题的直接链接">​</a></h3><p>主要分为两类，一类是显式地转换成 js 文件再运行，一类是直接运行。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-方法一命令行手动-ts-转-js">*<!-- --> 方法一：命令行手动 ts 转 js<a class="hash-link" href="#-方法一命令行手动-ts-转-js" title="标题的直接链接">​</a></h4><p>首先安装<code>typescript</code>：<code>npm i typescript -D</code>，然后运行转换：<code>tsc xx.ts</code>即可。</p><p>但我在测试过程中失败了：<code>tsc koa/bot.ts</code></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="方法二ide-中-ts-自动转-js推荐">方法二：IDE 中 ts 自动转 js（推荐）<a class="hash-link" href="#方法二ide-中-ts-自动转-js推荐" title="标题的直接链接">​</a></h4><p>首先全局安装<code>typescript</code>：<code>npm i -g typescript</code>，然后在 IDE 中配置<code>typescript</code>的自动转换，以 WebStorm 为例。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200918022607550.png" alt="image-20200918022607550" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="方法三使用ts-node直接运行-ts推荐">方法三：使用<code>ts-node</code>直接运行 ts（推荐）<a class="hash-link" href="#方法三使用ts-node直接运行-ts推荐" title="标题的直接链接">​</a></h4><p>安装<code>ts-node</code>：<code>npm i ts-node -D</code>，然后运行<code>ts-node xx/xx.ts</code>即可。</p><p>值得注意的是，这种方法，可以兼容运行 js 脚本，即<code>ts-node xx/xx.js</code>也是可以没毛病的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="eslint-prettier-配置">eslint-prettier 配置<a class="hash-link" href="#eslint-prettier-配置" title="标题的直接链接">​</a></h2><p>首先参考：<a href="https://segmentfault.com/a/1190000014755172" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000014755172</a></p><p>全局安装</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> -g </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> eslint eslint-plugin-prettier eslint-config-prettier babel-eslint prettier eslint-plugin-html --save-dev</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="bugs">BUGS<a class="hash-link" href="#bugs" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="控制变量调试法xxx-is-not-a-constructor--without-new">【控制变量调试法】xxx is not a constructor + without new<a class="hash-link" href="#控制变量调试法xxx-is-not-a-constructor--without-new" title="标题的直接链接">​</a></h3><p>主要由以下几种矛盾。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="import-和-export">import 和 export<a class="hash-link" href="#import-和-export" title="标题的直接链接">​</a></h3><p>首先我有一个<code>bot.ts</code>脚本，它的导出方式为<code>export default Bot</code>。</p><p>我需要在<code>index.js</code>中导入<code>Bot</code>，采取<code>import Bot from './bot.ts'</code>的方式。</p><p>事后证明，这引来了很大的麻烦。</p><p>第一种变通方式，是改<code>import</code>为<code>require</code>，具体为<code>require('./bot.ts').default</code>。</p><p>这能够解决<code>import</code>和<code>export</code>之间的对应关系。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="es6-和-es5">es6 和 es5<a class="hash-link" href="#es6-和-es5" title="标题的直接链接">​</a></h3><p>但还有另外一个问题，因为该<code>bot.ts</code>脚本中使用了多个<code>class</code>与多个<code>new</code>，这导致编译产生问题。</p><p>对于这个的解决方式，是新建<code>tsconfig.json</code>配置文件，输入以下：</p><div class="language-json codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-json codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"compilerOptions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"target"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ES6"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在没有该配置文件的情况下，<code>ts</code>默认编译成了<code>es5</code>的代码，其中的<code>call</code>函数将产生错误。</p><p>而基于<code>es6</code>的转换，<code>class</code>的操作便正常无误。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ts-和-js">ts 和 js<a class="hash-link" href="#ts-和-js" title="标题的直接链接">​</a></h3><p>此外，再配置了 es6 的转换后，我转念一想，毕竟都要转换，因此就不显式地导入<code>ts</code>了，转而直接导入<code>js</code>，代码重新改为<code>import Bot from './bot'</code>。</p><p>完全可行。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ts2792could-find-module-xxx">TS2792：could find module xxx<a class="hash-link" href="#ts2792could-find-module-xxx" title="标题的直接链接">​</a></h3><p>基于以上三点改进后，脚本可以正常运行，但是 IDE 对于两个<code>import</code>语句有红色报警提示，说找不到。</p><p>我试过了，如果把编译目标改为<code>ES5</code>就没有问题，但是那样脚本就没法运行了。所以索性就不理了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结">总结<a class="hash-link" href="#总结" title="标题的直接链接">​</a></h3><p>这次的解决方案，总体来说比较满意，但仍不是完美。</p><p>我知道这就是 ts 到 js 和 es6 到 es5 的一些编译问题，但确实过于复杂与细节，我在有限的时间内暂时只能想出这样的方案。</p><p>具体如下：</p><ol><li>按照正常的 ts 书写方式书写 ts 文件</li><li>按照正常的导入导出方式书写导入导出（使用 import 和 export 而非 commonJS 的 require，没有必要）</li><li>配置<code>tsconfig.json</code>的编译目标为<code>ES6</code>（或以上）</li><li>记得开启 IDE 的自动编译 ts 文件的功能</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="微信与-wechaty-二维码研究">微信与 Wechaty 二维码研究<a class="hash-link" href="#微信与-wechaty-二维码研究" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-1wechaty-本地有用户信息且有效">状态 1：wechaty 本地有用户信息且有效<a class="hash-link" href="#状态-1wechaty-本地有用户信息且有效" title="标题的直接链接">​</a></h3><p>有效是指该用户的本地缓存信息依旧有效，并且未被其他平台挤下线。</p><p>此时，wechaty 启动后不会产生二维码，<code>scan</code>事件不会被调用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-2wechaty-本地无用户信息或无效">状态 2：wechaty 本地无用户信息或无效<a class="hash-link" href="#状态-2wechaty-本地无用户信息或无效" title="标题的直接链接">​</a></h3><p>此时，wechaty 启动后会产生<code>status=2</code>的二维码，<code>scan</code>事件持续监听。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-3二维码被扫之后的状态">状态 3：二维码被扫之后的状态<a class="hash-link" href="#状态-3二维码被扫之后的状态" title="标题的直接链接">​</a></h3><p>当一个二维码被扫（即使没有登录）或自然过期之后，其他人扫描该二维码均会显示该二维码无效。</p><p>这种情况下，首先考虑服务器用户是否已经在线，如若在线，则不用扫描。</p><p>如若不在线，且是本人，则确认服务器是否在运行，是否是最新的二维码，如果均是，则服务器有问题。</p><p>如果不是本人，则需要以<strong>以新的用户标识重启服务器</strong>，因为服务器只有一个 token，只可供一位用户使用，相应地，也只能真正产生唯一的一个有效的二维码。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="对-wechaty-服务器前后端搭建的要求">对 wechaty 服务器前后端搭建的要求<a class="hash-link" href="#对-wechaty-服务器前后端搭建的要求" title="标题的直接链接">​</a></h3><p>在仅有一个 token 的情况下，基于以上的分析，我们的服务器至少需要实现以下一些功能。</p><p>首先是单用户的基本功能：<code>onScan | onLogin | onLogout | onMessage</code>。</p><p>这些完整包括了一个用户的所有生命周期。</p><p>我们首先要保证服务器后端传送出来的二维码信息与用户状态均是最新的，如若不是，也应该至少提供手动刷新最新状态的方式，比如浏览器内的 api 刷新。</p><p>其次考虑多用户共用 1 个 token 的情况。在这种情况下，首先考虑最复杂的一种状态，即服务器正在以 A 用户身份标识在运行，B 用户扫了一个二维码。</p><p>显然，B 用户的二维码是无效的，B 需要寻求新的二维码。</p><p>因此，对于前端来说，必须保证无论任何人在任何时候访问，都能得知最新的用户状态，主要是有无用户正在使用。</p><p>显然，B 用户应当无权停止 A 用户的使用，要想 A 用户下线，必须 A 用户自己主动挤下自己的账号（比较简单）或者提供前端退出自己账号的功能，这样就要涉及到了 cookie 或者 token 等操作。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="wechaty-bug">wechaty bug<a class="hash-link" href="#wechaty-bug" title="标题的直接链接">​</a></h3><p>当 wechaty 拿到一个 qrcode 之后，如果 A 用户扫码，但点击了取消，此时 wechaty 虽然捕捉到了扫码、取消的操作，但是它会立即再拿取一个 qrcode，这个时候问题就来了。</p><p>A 用户重新再扫之前取消确认的二维码，微信系统显示成功在 iPad 登录，然而 wechaty 服务器内直接就 miss 了这样的一个状态。</p><p>作为对比，若 A 用户此时退出该 iPad 登录状态，转而继续扫新的二维码，会发现成功登录之后能够捕捉 wechaty 的消息。</p><p>这里的微信设计是<strong>对于一张二维码，即使取消也可以重新扫描，即使已经登录也可以扫描，多次有效</strong>。</p><p>基于此 bug，对于前端的设计要求便是，一旦二维码经过扫描，则不应再出现，如果用户点击了取消，则再扫一张即可，如果重新扫描旧的二维码，将导致 wechaty 无法监控到登录状态的 bug 发生。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="前后端接口设计">前后端接口设计<a class="hash-link" href="#前后端接口设计" title="标题的直接链接">​</a></h2><p>可以考虑把主要的接口放在前端，因为 react 内基于 webpack 的文件引用方式不能超出项目范围，但我们的后端基于 node 是可以的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200920000052509.png" alt="image-20200920000052509" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="react-开发建议">React 开发建议<a class="hash-link" href="#react-开发建议" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="尽量避免组件重复渲染">尽量避免组件重复渲染<a class="hash-link" href="#尽量避免组件重复渲染" title="标题的直接链接">​</a></h3><p>在绝大多数情况下，基于<code>react hook</code>的组件设计，稍有不慎，就能造成巨量甚至死循环的重复渲染。</p><p>一种比较好的开发习惯，就是对于每个组件的开头都写一个<code>render log</code>，这样可以理清组件与组件之间的渲染传导关系，例如如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200921163126793.png" alt="image-20200921163126793" class="img_vXGZ"></p><p>尽管这段日志暴露出了十分多的问题，但是渲染的顺序都是很清晰的，并且可以非常方便地知道问题在哪，从来一个个解决问题。</p><p>我建议在开发期间持续保留这些组件入口渲染的打印，其他函数之类的可以视情况抉择。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[“中一千万”与“挣一千万”到底哪个更容易]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/15/投资：凯利公式</link>
            <guid>/2020/09/15/投资：凯利公式</guid>
            <pubDate>Tue, 15 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[彩票-cover-压缩后]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/%E5%BD%A9%E7%A5%A8-cover-%E5%8E%8B%E7%BC%A9%E5%90%8E.png" alt="彩票-cover-压缩后" class="img_vXGZ"></p><p>挣 1000 万，真地比中 1000 万难太多了吗？</p><p>如果按照某团骑手的目标工资 1w/month 的水平来看的话，不考虑通胀、不考虑意外、不考虑衰老、不买房至多可以在 1000/12≈83 年内可以实现。</p><p>这已经大大超过为祖国健康奋斗五十年的期限，看样子是不太可能实现的目标。</p><p>那买彩票可以吗？比如中国体育彩票。我们今天就来我们算一算。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透模型搭建与分析">大乐透模型搭建与分析<a class="hash-link" href="#大乐透模型搭建与分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透的中奖概率分析">大乐透的中奖概率分析<a class="hash-link" href="#大乐透的中奖概率分析" title="标题的直接链接">​</a></h3><p>以中国足彩官网超级大乐透的第一大奖为例，可以看到，单注奖金高达一千万，根据规则一注 1 元。目前总销售额接近 3 亿元，滚动奖金总共 8 亿元。因此，我们可以简单假定中奖概率为一亿分之一，也就是<code>1e-8</code>，而赔率为一千万。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200909214931021.png" alt="image-20200909214931021" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透的投资模型搭建">大乐透的投资模型搭建<a class="hash-link" href="#大乐透的投资模型搭建" title="标题的直接链接">​</a></h3><p>我们首先搭建一个投资回报模型。</p><p>记每一笔赌注需要花费 1 元，一笔赌注的胜率为$p$，则失败的概率为$1-p$，赌赢的收益率为$q$，赌输的收益率为$r$。因此，对于大乐透头奖来说，有以下模型变量：$p=1e-8,\ q=1e7,\ r=-1$。</p><p>此外，我们记自己的本金为$a_0$，其中用于购买彩票的比率为$k, \ (a_0*k &lt; 1 / p)$。显然，在不考虑注上限、游戏是公平的情况下，我们每一次决策的结果有两种可能。</p><ol><li>若中奖，我们的本金变成 $a_0*(1-k)+q$。</li><li>若没有中奖，我们的本金变成 $a_0*(1-k)$。</li></ol><p>考虑到目前的人均收入水平，我们简单假设每个人的本金是 10w，则该模型可简化为：</p><ol><li>若中奖，我们的本金变成 $10*(1-k)+1000$。</li><li>若没有中奖，我们的本金变成 $10*(1-k)$。</li></ol><p>显然，在这个模型里，若 k 不等于 0，则最小为$1e-5$，也就是十万分之一。</p><p>我们每个人都要思考几个问题：</p><ol><li>你会购买至少一注大乐透吗？用大概率会浪费的 N 元，去博取 1000w？</li><li>你会长时间的购买 N 注大乐透吗？为什么？</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透的投资模型分析一按比率投资模型">大乐透的投资模型分析（一）：按比率投资模型<a class="hash-link" href="#大乐透的投资模型分析一按比率投资模型" title="标题的直接链接">​</a></h3><p>我们首先考虑按比率投资模型，也就是说，张三本金$a_0=10$万，工作收入与支出完全平衡，每天按照一定比率$k$购买大乐透彩票，持之以恒，夜以继日。求其能中一千万的概率。</p><p>那么，对于第一次能中的概率，即为$a_0<em>p</em>k$，其中$a_0$是本金，$p$是每一注中奖的概率，大乐透头奖概率为$1e-8$，$k$为支付比率，$10k$得到最终的以元为单位的价值，不考虑小数。我们可以很容易列出每一次投资时的状态。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200915213423408.png" alt="image-20200915213423408" class="img_vXGZ"></p><table><thead><tr><th>投资次数</th><th>投资前本金</th><th>累计获胜概率</th></tr></thead><tbody><tr><td>1</td><td>$a_0$</td><td>$a_0<em>k</em>p$</td></tr><tr><td>2</td><td>$a_0*(1-k)$</td><td>$a_0<em>k</em>p + a_0<em>(1-k)</em>k<em>p$ $=a_0</em>k<em>p</em>[1+(1-k)]<!-- -->$</td></tr><tr><td>3</td><td>$a_0*(1-k)^2$</td><td>$a_0<em>k</em>p*<!-- -->[1+(1-k)+(1-k)^2]<!-- -->$</td></tr><tr><td>i</td><td>$a_0*(1-k)^{i-1}$</td><td>$a_0<em>k</em>p*\frac{1-(1-k)^i}{k}$</td></tr></tbody></table><p>当然了，由于$\lim\limits_{i\to+\infty}{a_0<em>k</em>p<em>\frac{1-(1-k)^i}{k}}=a_o</em>p$，所以若无限投资下去，概率就等于本金乘以每一注中奖的概率，emmm，所以若想自己中奖的期望概率能够达到百分之百，得首先有……有一千万。</p><p>于是，<strong>能不能通过中奖得到一千万，从概率上几乎等价于能不能通过自己挣到一千万</strong>。。。。</p><p>惊不惊喜，意不意外？</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透的投资模型分析二按固定投资模型">大乐透的投资模型分析（二）：按固定投资模型<a class="hash-link" href="#大乐透的投资模型分析二按固定投资模型" title="标题的直接链接">​</a></h3><p>我们接着考虑按固定投资模型，也就是说，张三本金$a_0=10$万，工作收入与支出完全平衡，每天按照固定的金额购买大乐透彩票，持之以恒，夜以继日。求其能中一千万的概率。</p><p>考虑到，按照大多数人的风险偏好，一般只会顺手买一注，毕竟买一注和买两注本质上没啥差别，但今天一下亏两注绝对不如每天只亏一注心理负担来的小。但便于方程求解，我们还是设置一个固定常量，记为$c$，表示每天的购买支出，于是每天中奖的概率都是$c*p$，雷打不动。</p><p>显然，这就是一个典型的伯努利试验，我们知道它的期望成功概率就等于$n<em>c</em>p$，让其等于 1，则立即得到$n*c=\frac{1}{p}$，即所有付出的投资总和需要与最终奖金相同。。。</p><p>于是，<strong>能不能通过中奖得到一千万，从概率上几乎还是等价于能不能通过自己挣到一千万</strong>。。。。</p><p>惊不还惊喜，意不还意外？</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大乐透投资模型白努力模型总结">大乐透投资模型（白努力模型）总结<a class="hash-link" href="#大乐透投资模型白努力模型总结" title="标题的直接链接">​</a></h3><p>其实无论是采用按比率投资的方式，还是按固定投资的方式，之所以最后我们算出来期望中奖概率为 1 时所需要的资金正好等于奖金额度，其本质就在于因为它每一次都是一个平等的伯努利实验，只不过我们按天划分，做了一些伪装而已。</p><p><strong>如果你觉得我们的模型结论让你觉得意料之中又情理之中，那恭喜你，成功地被我们绕进去了。</strong></p><p>但为了更好地回答大乐透，以及由此衍生的一切赌注模型，我们先从另一个案例说起。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="另一种看起来简单点的赌注模型">另一种看起来简单点的赌注模型<a class="hash-link" href="#另一种看起来简单点的赌注模型" title="标题的直接链接">​</a></h2><p>假设你有 100 万，面临一个赌注，50%概率能赢，获得三倍，50%会输，你会如何抉择？</p><p>先给你十秒钟思考。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基于风险偏好的不确定性投资">基于风险偏好的不确定性投资<a class="hash-link" href="#基于风险偏好的不确定性投资" title="标题的直接链接">​</a></h3><p>我猜大多数人都会基于自己的风险偏好去决定这笔赌注。</p><p>具体来说，假如我们把一个人的资金分成几个部分：生活必需资金（10 万）、发展必需资金（80 万）、可投资资金（10 万）。</p><p>那么面临这样的一个赌注，如果这个人风险偏好非常高，他可能就会把全部 10 万都投进入；反之，则可能不会参与如此高风险的赌注。</p><p>每个人心里都有自己的一种考虑，因此这道题是无解的。</p><p>但学过概率论与一定经济学原理的我们，不妨换个角度想想，我们每次要做一个决定时，依据究竟是什么。</p><p>诚然，大多数生活中的决策，都是依据于目标收益和短期融资需求，在大多数情况下，一旦某个赌注目标收益很高，而自己的短期融资需求也同样很高，那么他选择铤而走险的概率就很大了。由于生活中不存在明确的投资产生回报的概率，这是最典型一种决策依据。</p><p>但如果我们知道概率呢？就如同之前的彩票问题一样。那么借助于概率统计的角度去思考，应该是第一思考方式了。</p><p>我们据此想想，这样的模型，基于概率统计，我们能够有哪些种决策依据，换句话说，我们的投资目标是什么。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基于目标收益的确定性投资">基于目标收益的确定性投资<a class="hash-link" href="#基于目标收益的确定性投资" title="标题的直接链接">​</a></h3><p>如果我们的投资目标就是为了获得收益，无视风险，那就把所有的钱都砸进去好了。反之，如果我们的目标就是为了规避风险，那么我们应该坚决不参与本次赌注。还有另外一种，比较现实的投资目标：跑赢通胀。简单来说，他的目标收益就是 10%，那么我们来算一下，如果是这样的一个目标，他应该投多少。</p><p>显然，如果一个人的投资目标是 10%，他应该想表达的是，他的期望收益是 10%，于是我们很容易得到以下的方程：</p><p>$0.5 <em> (100-x+3x) + 0.5</em>(100-x) = 100 * (1+0.1)$</p><p>答案很简单，$x=20$，即若该投资者从 100 万中取出 20 万参与该赌注，则能获得 10%（即 10 万）的目标收益。</p><p>在大多数情况下，基于一个固定的目标收益，去决定一项投资是否参与，属于比较靠谱的一种投资思维。</p><p>但也许并不够好。</p><p>假设该笔赌注是固定的，你可以参与无限多次，这个时候你再审视一下自己基于目标收益的投资理念是否靠谱？答：靠谱。因为每次就盯着 10%的目标收益不变，无论执行多少次，这个策略是完全 make sense 的。</p><p>基于此，我们使用程序的手段，看看，如果我们把该赌注重复执行 N 次看看最终我们能赚多少钱。</p><p>首先，显然，我们很容易得到，如果我们的目标收益固定，例如$E=10$，则必有每次投入的资金比率为$K=2*E=20\%$。</p><p>因此，我们可以使用程序模拟如下的场景：固定的本金（100 万），11 个人，每次投入的本金比率不同（从 0%到 100%，步长为 10%），每个人连续赌十次，看看最终大家的收益水平如何。（显然，0%的哥们最终依旧是 100 万不变）</p><p>我们编写程序模拟该过程。</p><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> seaborn </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'font.sans-serif'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'SimHei'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'STHeiti'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#显示中文标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'axes.unicode_minus'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 本金（单位：万）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 中奖概率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 中奖赔率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 参与者个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LU </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 10的指数上限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LD </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 10的指数下限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 赌注次数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">simulate_by_ratio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_asset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assets </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cur_asset</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> day </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cur_asset </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur_asset </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> pay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cur_asset </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> pay </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_asset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> assets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">simulate_by_ratio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linspace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'{: 3d}%'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> k </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linspace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f'本金:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">A</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, 中奖概率: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">P</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, 中奖赔率: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">R</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, 赌注次数: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">N</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, 参与者：</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">T</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kind</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'line'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dashes</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">_legend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'投资比率'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>得到结果如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200915190723807.png" alt="image-20200915190723807" class="img_vXGZ"></p><p>可以看到，整体来说，大多数人的收益波动都比较明显，整体还是呈现较好的预期，毕竟这个赌注的期望收益是正的。</p><p>但我们依旧难以确定一个最佳的投资目标。因此，新的维度需要引入。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基于长期最大期望收益的确定性投资">基于长期最大期望收益的确定性投资<a class="hash-link" href="#基于长期最大期望收益的确定性投资" title="标题的直接链接">​</a></h3><p>其实当我们设定了一个目标收益之后，我们不但可以使用程序随机模拟出重复执行该策略 N 次的结果，我们还可以算出他们的期望。如果我们基于目标收益的最大长期期望进行赌注，那从统计角度来说，我们的策略就更加地稳健。</p><p>易知，对于第$i$次以$k$比率的赌注，我们的预期收益将是$E = <!-- -->[0.5 <em> A(1-k+3k) + 0.5 </em> A(1-k)]<!-- --> / A = 1 + k /2$.</p><p>但如果以这样的方式顺推计算，我们将会得到长期预期收益将为$E^N=(1+k/2)^N$，这是这个指数函数，显然不具有实际意义。</p><p>重新考虑。对于每一次赌注，我们可能赢，也可能输，而在 N 次赌注后，我们最终的收益水平将是$\bar{E} = A<em>(1+2k)^S</em>(1-k)^F$，其中$S$表示成功的次数，$F$表示失败的次数。那么显然，这个函数就有点像经济学中类似道格拉斯函数的存在了。</p><p>我们稍微整理一下，略去常量$A$，替换$S=N<em>p, F=N</em>(1-p)$，则有$f(k)=(1+2k)^{N/2}<em>(1-k)^{N/2}$，接着对其对数求导，则有$ln(f(k))=N/2</em>ln(1+2k)(1-k)$，显然，当$(1+2k)(1-k)$最大时$f(k)$最大，立即得$k=<!-- -->[-1/2+1]<!-- -->/2=1/4$。</p><p>所以，按照长期最大期望收益的目标，我们每一次的投资比率是 25%。</p><p>为了验证这一投资比率的有效性，我们再次使用蒙特卡洛模拟，运行十次，查看其运行的整体情况。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200915201016265.png" alt="image-20200915201016265" class="img_vXGZ"></p><p>可以看到，整体效果还是很不错的，只有极个别案例出现了低于 100 的净值，大多数都有非常不错的表现，超过五倍收益的达到了 40%，这是相当耀眼的成绩。</p><p>一定程度上，这个长期最大收益的目标，的确很好地平衡了收益与风险，基于此，我们推广出其通用公式。</p><p>假设一项赌注，赢率为$p$，则输率为$1-p$。假设赢后收益率为$q$，输后收益率为$r$，本金为$A$，每一次固定下注比率$k$，重复$N$次，则有</p><p>对于第$i$次赌注，若赢，本金变为$ A_i(1-k)+A_ik(1+q)=A_i(1+kq)$；同样地，</p><p>对于第$i$次赌注，若输，本金变为$ A_i(1-k)+A_ik(1+r)=A_i(1+kr)$。</p><p>显然，对于累积 N 次赌注，必有$A_N = A_0 <em> (1+kq)^S </em> (1+kr)^F$，代入$S = N <em> p, F = N </em> (1-p)$，则有</p><p>$A_N = A_0 <em> (1+kq)^{N</em>p} <em> (1+kr)^{N</em>(1-p)}$，对数后得</p><p>$ln(A_N) = ln(A_0) +  N <em> (p</em>ln(1+kq)+(1-p)*ln(1+kr))$，即求</p><p>$max\ f(k) = p <em> ln(1+kq) + (1-p) </em> ln(1+kr)$，对其求导，则有</p><p>$max f'(k) = \frac{pq}{1+kq} + \frac{(1-p)r}{1+kr}$，显然直接令其等于 0 即可得到函数拐点，即</p><p>$（*）\frac{pq}{1+kq} + \frac{(1-p)r}{1+kr}=0$，则有</p><p>$（<strong>）k=\frac{pq+(1-p)r}{-qr}$，其中</strong>分子就等于胜率乘以胜赔率加上输率乘以输赔率，分母则为负的胜率乘以赔率**。</p><p>而当$r=-1$时，则有，</p><p>$（***）k=\frac{p(q+1)-1}{q}$</p><p>我们验证一下，上一题中$p=1/2,\ q=2,\ r=-1$，（赌一赢三，收益率$q$为 2；全光，收益率为-1）</p><p>则有$k=\frac{1/2<em>2+1/2</em>(-1)}{2}=\frac{1/2}{2}=\frac{1}{4}$，完全一致。</p><p>这，就是大名鼎鼎的凯利公式！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="使用凯利公式重买大乐透">使用凯利公式重买大乐透<a class="hash-link" href="#使用凯利公式重买大乐透" title="标题的直接链接">​</a></h2><p>在概率论中，<strong>凯利公式</strong>（Kelly formula），也称凯利方程式，是一个用以使特定赌局中，拥有<strong>正期望值之重复行为长期增长率最大化</strong>的公式。</p><p>它由<strong>约翰·拉里·凯利</strong>（John Larry Kelly, Jr.）于 1956 年在《贝尔系统技术期刊》中发表，可用以计算出<strong>每次游戏中应投注的资金比例</strong>。(约翰·拉里·凯利 1923 年出生于美国德克萨斯州科西卡纳，1965 年逝世于纽约市，是一位在贝尔实验室工作的美国科学家）</p><p>当我们使用凯利公式时，我们清楚地明白，我们要做的事就是根据凯利公式，实现长期某项重复确定性概率投资的最终收益率最大化。而彩票明显符合这种特性。</p><p>回顾大乐透的一些基本变量，胜率$p=1e-8$，赔率$q=1e7$，那么显然有$k=\frac{p*(q+1)-1}{q}=\frac{(1e-8)(1e7+1)}{1e7}=1e-8$。</p><p>这意味着，如果你的身家没有一亿，那么哪怕赔率是一千万的大乐透，也不值得你花一块钱去购买它。</p><p>由此来看，<strong>比起中一千万，还是挣一千万来的更容易</strong>。</p><p>大喊一声：<strong>为祖国健康奋斗五十年</strong>，上路吧，兄弟姐们！上路吧，我的小蓝车和你的小黄车！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/%E7%BE%8E%E5%9B%A2%E9%AA%91%E6%89%8B-%E5%9B%B0%E5%9C%A8%E7%B3%BB%E7%BB%9F%E9%87%8C-%E9%BB%91%E7%99%BD.png" alt="美团骑手-困在系统里-黑白" class="img_vXGZ"></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[BUG FIX]]></title>
            <link>https://markshawn2020.github.io/blog/bug_fix</link>
            <guid>bug_fix</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[【已解决】关于cookie-universal-nuxt无法移除cookie的问题]]></description>
            <content:encoded><![CDATA[<a id="【已解决】关于cookie-universal-nuxt无法移除cookie的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决关于cookie-universal-nuxt无法移除cookie的问题">【已解决】关于<code>cookie-universal-nuxt</code>无法移除<code>cookie</code>的问题<a class="hash-link" href="#已解决关于cookie-universal-nuxt无法移除cookie的问题" title="标题的直接链接">​</a></h2><p>2020-08-31 17:17:48 <a id="原因分析"></a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原因分析">原因分析<a class="hash-link" href="#原因分析" title="标题的直接链接">​</a></h3><p>大多数情况下，这是由于<code>path</code>不同导致的。</p><p>当调用<code>this.$cookies.set()</code>进行<code>cookie</code>设定，但未提供<code>path</code>参数时，将默认存储在当前所在路由下。</p><p>之后，若再次调用<code>remove()</code>函数，且未提供<code>path</code>参数，将默认移除首页<code>/</code>下的参数。</p><p>此时，问题就发生了。</p><a id="解决方案"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="标题的直接链接">​</a></h3><p>对于一些通用数据，比如<code>user</code>，建议存储时显式存储在<code>/</code>路径下，以免不必要的麻烦。</p><p>此外，<code>cookie-universal</code>里设定的<code>removeAll()</code>函数，默认只能清空<code>/</code>下的参数。</p><p>详情见<code>cookie-universal</code>的使用说明：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// note that removeAll does not currently allow you</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// to remove cookies that have a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// path different from '/'</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a id="【部分解决】关于markdown的heading导航异常的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="部分解决关于markdown的heading导航异常的问题">【部分解决】关于<code>markdown</code>的<code>heading</code>导航异常的问题<a class="hash-link" href="#部分解决关于markdown的heading导航异常的问题" title="标题的直接链接">​</a></h2><a id="原因分析-1"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原因分析-1">原因分析<a class="hash-link" href="#原因分析-1" title="标题的直接链接">​</a></h3><p>很有可能是因为在<code>content</code>中对<code>markdown</code>解析时，经过<code>remark-parse</code>后，<code>markdown</code>内的<code>heading</code>出现了<code>tabindex=-1</code>。</p><p>于是，我特地去看了一下<code>github</code>的<code>readme</code>内的<code>heading</code>导航。发现它是没有<code>tabindex=-1</code>且可以正常导航的。</p><p>我又测试了一下，在该<code>heading</code>上添加<code>tabindex=-1</code>，发现依旧可以正常导航。再联想之前在自己的网站上测试去除<code>tabindex=-1</code>依旧不能正常导航，基本确定不是<code>tabindex=-1</code>的问题。</p><a id="测试过程"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="测试过程">测试过程<a class="hash-link" href="#测试过程" title="标题的直接链接">​</a></h3><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>直接复制粘贴导航栏中有用的<code>a</code>代码</td><td>可以正常跳转</td><td></td></tr><tr><td>只保留<code>a</code>标签的<code>href</code>属性（且是转以后的）</td><td>可以正常跳转（谷歌浏览不可以）</td><td></td></tr><tr><td>只替换<code>a</code>标签的<code>href</code>属性（其他的<code>arai-hidden</code>等属性保持不变）</td><td>仅第一次点击可正常跳转，之后的点击异常；<br>经过<code>F12</code>重启，确认<code>href</code>属性依旧是转义后的</td><td></td></tr><tr><td>只去除<code>a</code>标签的<code>data-v</code>属性</td><td>无效</td><td></td></tr><tr><td>删除<code>a</code>标签的所有其他属性</td><td>无效</td><td></td></tr><tr><td>删除<code>a</code>标签内部的子节点</td><td>无效</td><td></td></tr><tr><td>只保留<code>a</code>标签的<code>href</code>属性（未转义）</td><td>无效</td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>测试结果：可能是<code>heading</code>的点击穿透问题。</p><a id="解决方案-1"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-1">解决方案<a class="hash-link" href="#解决方案-1" title="标题的直接链接">​</a></h3><p>考虑到只有页面的侧边栏（TOC）有导航意义，因此直接禁用<code>heading</code>链接的点击即可。</p><p>经过一番搜索，只需要加上<code>cursor-point: none</code>的样式即可，在<code>tailwindcss</code>中为<code>cursor-point-none</code>。</p><p>但这样，就无法直接在页面内导航了。</p><a id="总结展望"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结展望">总结展望<a class="hash-link" href="#总结展望" title="标题的直接链接">​</a></h3><p>也许有其他的解决方案，但我还没找到。</p><p>目前，是不支持页内<code>heading</code>导航了。</p><a id="【已解决】关于tailwindcss中ul没有样式的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决关于tailwindcss中ul没有样式的问题">【已解决】关于<code>tailwindcss</code>中<code>ul</code>没有样式的问题<a class="hash-link" href="#已解决关于tailwindcss中ul没有样式的问题" title="标题的直接链接">​</a></h2><a id="原因"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原因">原因<a class="hash-link" href="#原因" title="标题的直接链接">​</a></h3><p>是因为<code>tawiwindcss</code>定义了一个<code>base.css</code>，这里面对一些<code>html</code>的基本样式做了修改。</p><div class="language-css codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-css codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f">ol</span><span class="token selector punctuation" style="color:#393A34">,</span><span class="token selector" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f">ul</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">list-style</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> none</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">margin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在此基础上，我们可以覆写这些<code>css</code>样式，有基于<code>css</code>和基于<code>plugin</code>等多种方式，具体可以见：<a href="https://tailwindcss.com/docs/adding-base-styles" target="_blank" rel="noopener noreferrer">Adding Base Styles - Tailwind CSS</a>。</p><a id="【已解决】关于element-ui按需入的问题（重要）"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决关于element-ui按需入的问题重要">【已解决】关于<code>Element-UI</code>按需入的问题（重要）<a class="hash-link" href="#已解决关于element-ui按需入的问题重要" title="标题的直接链接">​</a></h2><a id="现场"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场">现场<a class="hash-link" href="#现场" title="标题的直接链接">​</a></h3><p>按照<code>element-ui</code>官方文档，我在<code>.babelrc</code>文件中配置了对<code>element-ui</code>的按需引入，如下。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"presets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"es2015"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">"modules"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"plugins"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">"component"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"libraryName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"element-ui"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">"styleLibraryName"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"theme-chalk"</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string-property property" style="color:#36acaa">"env"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">"presets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">"@babel/preset-env"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-property property" style="color:#36acaa">"targets"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string-property property" style="color:#36acaa">"node"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"current"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然而，根据<code>analyze</code>显示，<code>element-ui</code>所占的体积大的惊人。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200824201732382.png" alt="image-20200824201732382" class="img_vXGZ"></p><a id="解决方案-2"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-2">解决方案<a class="hash-link" href="#解决方案-2" title="标题的直接链接">​</a></h3><p>参考<a href="https://www.jb51.net/" target="_blank" rel="noopener noreferrer">脚本之家<!-- -->_<!-- -->www.jb51.net</a>这篇文章，给我的主要启发是：<strong>不能直接在<code>.babelrc</code>文件中配置，而是在<code>nuxt.config.js</code>的<code>build</code>选项中启用<code>babel</code>的配置</strong>。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">build</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">analyze</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">babel</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">'component'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">libraryName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-ui'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">styleLibraryName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'theme-chalk'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a id="结果"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="结果">结果<a class="hash-link" href="#结果" title="标题的直接链接">​</a></h3><p>目前的页面分析结果如下，可以看到，<code>element-ui</code>的体积大小，已经相较于之前好了很多，连同另外一个<code>css</code>框架一起只占一半的依赖包体积了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200824201157993.png" alt="image-20200824201157993" class="img_vXGZ"></p><a id="【已解决】关于移动端页面无法滚动的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决关于移动端页面无法滚动的问题">【已解决】关于移动端页面无法滚动的问题<a class="hash-link" href="#已解决关于移动端页面无法滚动的问题" title="标题的直接链接">​</a></h2><p>找了一遍，果然是<code>overflow</code>的问题，出在了这里：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822222041677.png" alt="image-20200822222041677" class="img_vXGZ"></p><p>这里原作其实是判断使用<code>single page</code>的，我把<code>single</code>部分删了，变成了这样。</p><p>我没有测试过原作的移动端显示，但现在的问题就是移动端无法滚动了。</p><p>因此删除<code>overflow-y-hidden</code>。</p><a id="【已解决】bug：element-ui中的loading不居中的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bugelement-ui-中的loading不居中的问题">【已解决】BUG：Element-UI 中的<code>loading</code>不居中的问题<a class="hash-link" href="#已解决bugelement-ui-中的loading不居中的问题" title="标题的直接链接">​</a></h2><p>参见：<a href="https://blog.csdn.net/wangguoyu1996/article/details/81394817?utm_medium=distribute.pc_feed_404.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&amp;depth_1-utm_source=distribute.pc_feed_404.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecas" target="_blank" rel="noopener noreferrer">element-ui 局部区域 loading 效果</a></p><p>换个图标就可以了。</p><a id="非正常显示效果（默认图标）"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="非正常显示效果默认图标">非正常显示效果（默认图标）<a class="hash-link" href="#非正常显示效果默认图标" title="标题的直接链接">​</a></h3><div class="language-vue codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-vue codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">v-loading="loginLoading"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- element-loading-spinner="el-icon-loading" --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">element-loading-text="正在努力奔跑……"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822022440891.png" alt="image-20200822022440891" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822022026311.png" alt="image-20200822022026311" class="img_vXGZ"></p><a id="正常显示效果（换了图标后）"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="正常显示效果换了图标后">正常显示效果（换了图标后）<a class="hash-link" href="#正常显示效果换了图标后" title="标题的直接链接">​</a></h3><div class="language-vue codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-vue codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">v-loading="loginLoading" element-loading-spinner="el-icon-loading"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">element-loading-text="正在努力奔跑……"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822022337209.png" alt="image-20200822022337209" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822021931120.png" alt="image-20200822021931120" class="img_vXGZ"></p><a id="原因-1"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="原因-1">原因<a class="hash-link" href="#原因-1" title="标题的直接链接">​</a></h3><p>默认使用<code>svg</code>图片占位，而父级元素<code>.el-loading-mark</code>只有一个<code>text-align: center</code>的居中设定（而非<code>display: flex; justify-content: center</code>）。</p><p>所以默认的那个圈圈不会居中，换成<code>&lt;i class="icon-xxx"&gt;&lt;/i&gt;</code>就可以解决了，因为它支持<code>text</code>级别的居中。</p><a id="关于asyncdata的用法"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于-asyncdata-的用法">关于 asyncData 的用法<a class="hash-link" href="#关于-asyncdata-的用法" title="标题的直接链接">​</a></h2><p>不可以在子组件中使用。</p><p>具体可以参见<a href="https://segmentfault.com/q/1010000012989100" target="_blank" rel="noopener noreferrer">vue.js - Nuxt 子组件内可以使用 asyncData 吗？ - SegmentFault 思否</a></p><p>害，费了老长时间测这个问题了。</p><a id="【已解决】bug：关于无法在ide中移动、删除或重命名文件（夹）的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug关于无法在-ide-中移动删除或重命名文件夹的问题">【已解决】BUG：关于无法在 IDE 中移动、删除或重命名文件（夹）的问题<a class="hash-link" href="#已解决bug关于无法在-ide-中移动删除或重命名文件夹的问题" title="标题的直接链接">​</a></h2><a id="现场-1"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-1">现场<a class="hash-link" href="#现场-1" title="标题的直接链接">​</a></h3><p>我想重命名<code>CS</code>文件夹为<code>coding</code>文件夹，然而出现了<code>IOException</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200821012423773.png" alt="image-20200821012423773" class="img_vXGZ"></p><p>很明显，这是因为文件夹被占用，但我并不清楚是谁在占用，我的 IDE 也不够强大到为我分析出是哪个程序或者子程序。</p><p>我尝试关闭了我正在运行的 IDE 内的程序，但并没有解决问题，说明是来自外部的。</p><p>我尝试又关闭了一些外部程序，比如<code>typora</code>，因为当它打开了这个文件夹下的某个文件后，IDE 将无法对该文件或该文件所在的文件夹进行一些敏感操作。</p><p>但这一切都未能奏效。</p><p>这是十分令人恼火而绝望的，因为你并不知道那个程序对该文件将持续占用控制到什么时候。</p><p>在我以前的经历中，我经常做的一件事就是重启 IDE，这是往往有效的，但，这实在代价太大了。</p><p>于是，这一次，我打算深入研究一下这个问题，我把目光投向了我的搜索引擎。</p><a id="行动"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="行动">行动<a class="hash-link" href="#行动" title="标题的直接链接">​</a></h3><p>我从“文件被占用”这一情景出发，进行搜索。</p><p>我之所以知道这样的一种术语，是因为我曾经使用过 360 安全卫士的“解除文件占用”功能，偶尔还是有效的。但更多的时候并不有效。</p><p>我很快找到了这篇文章<a href="http://www.xitongcheng.com/jiaocheng/win10_article_47290.html" target="_blank" rel="noopener noreferrer">win10 文件被占用无法删除如何解决－系统城</a>，跟着它的指导，我输入了文件夹名结果跳出一堆候选结果。凭借经验，我重新输入了文件夹的绝对路径，顺利地找到了始作俑者——“TgitCache.exe”。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200821013210368.png" alt="image-20200821013210368" class="img_vXGZ"></p><p>这个结果意料之外，但情理之中。因为在之前，我也遇到过因为 git 的占用，导致文件系统无法操作的情况，那个时候我直接杀死了任务管理器中的无数个 git 子进程，不想再次尝试。</p><p>但我实在不清楚 TgitCache 具体是个什么东西，我再次搜索，在这个帖子中发现有人有和我一样的问题：<a href="https://cloud.tencent.com/developer/ask/82180" target="_blank" rel="noopener noreferrer">如何停止并启动 TGitCache.exe？ - 问答 - 云+社区 - 腾讯云</a>。</p><p>一些大佬留言只要关闭<code>TortoiseGit</code>的<code>Status Cache</code>就可以了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200821013827496.png" alt="image-20200821013827496" class="img_vXGZ"></p><p>但我如此设置之后，返回 IDE，依旧未能解决问题。</p><p>我决定重启一下<code>TortoiseGit</code>。</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_O4V7"><div class="admonitionHeading_mM4K"><span class="admonitionIcon_Wsqb"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span><mdxadmonitiontitle>但我并不知道怎么重启这玩意，然后右键在文件夹内点击了<code>Bisect reset</code>，获得一个 error 之后，发现刚刚输入的文章内容全无了，我简直欲哭无泪。不过还好文章在 IDE 中同步打开了，调用<code>local history</code>成功找回了原来的内容，我真是太爱这个功能了！ :::</mdxadmonitiontitle></div><div class="admonitionContent_wp6k"><p>我通过任务管理器杀死<code>TortoiseGit</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200821014739527.png" alt="image-20200821014739527" class="img_vXGZ"></p><p>但我懵逼了，IDE 中依旧不能重命名。。。</p><a id="解决方案-3"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-3">解决方案<a class="hash-link" href="#解决方案-3" title="标题的直接链接">​</a></h3><p>一顿操作猛如虎后，我最后还是选择直接关闭 IDE，然后重启，这下终于成功了。</p><p>人生大抵如此，兜兜转转，还是要回到原点~</p><a id="【已解决】bug-在markdown文件中引用vue组件，props不能成功传入的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug-在-markdown-文件中引用-vue-组件props-不能成功传入的问题">【已解决】BUG: 在 markdown 文件中引用 vue 组件，props 不能成功传入的问题<a class="hash-link" href="#已解决bug-在-markdown-文件中引用-vue-组件props-不能成功传入的问题" title="标题的直接链接">​</a></h2><a id="现场-2"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-2">现场<a class="hash-link" href="#现场-2" title="标题的直接链接">​</a></h3><p>这是因为在读取 markdown 文件过程中，变量名自动取成了小写，导致原先定义的驼峰式 prop 变量无法正常赋值。</p><p>具体而言就是，在 markdown 中<code>:wordList</code>会变成<code>:wordlist</code>，而原先的 vue 组件中则会保持<code>wordList</code>的 prop 不变，这导致了 vue 组件多了一个<code>wordlist</code>属性，而<code>wordList</code>则为空。</p><a id="解决方案-4"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-4">解决方案<a class="hash-link" href="#解决方案-4" title="标题的直接链接">​</a></h3><a id="【部分解决】bug-content-theme-docs中关于indexmd的路由问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="部分解决bug-content-theme-docs-中关于-indexmd-的路由问题">【部分解决】BUG: content-theme-docs 中关于 index.md 的路由问题<a class="hash-link" href="#部分解决bug-content-theme-docs-中关于-indexmd-的路由问题" title="标题的直接链接">​</a></h2><a id="现场-3"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-3">现场<a class="hash-link" href="#现场-3" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818171926502.png" alt="image-20200818171926502" class="img_vXGZ"></p><a id="解决方案-5"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-5">解决方案<a class="hash-link" href="#解决方案-5" title="标题的直接链接">​</a></h3><p>使用<code>index.vue</code>等 page 页面去定义这些路由即可。</p><a id="【已解决】bug-关于frontmatter中未定义fullscreen字段，导致全屏切换组件无效的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug-关于-frontmatter-中未定义-fullscreen-字段导致全屏切换组件无效的问题">【已解决】BUG: 关于 frontmatter 中未定义 fullScreen 字段，导致全屏切换组件无效的问题<a class="hash-link" href="#已解决bug-关于-frontmatter-中未定义-fullscreen-字段导致全屏切换组件无效的问题" title="标题的直接链接">​</a></h2><a id="现场-4"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-4">现场<a class="hash-link" href="#现场-4" title="标题的直接链接">​</a></h3><p>我封装了一个点击切换全屏的组件，它依赖于父组件（即<code>nuxt-content</code>页面的<code>document.fullScreen</code>属性）。</p><p>我在测试的过程中发现了问题，原因是我的一些页面没有初始化<code>fullScreen</code>的<code>frontmatter </code>，而我的切换逻辑仅仅是简单的取反，即<code>document.fullScreen=!document.fullScreen</code>。</p><p>我修改这个逻辑，希望它变得更加稳健，即<code>document.fullScreen=!(document.fullScreen || false)</code>。</p><p>然而，并不奏效，我忽视了我靠切换<code>fullScreen</code>属性以改变网页展示的行为，依赖于 vue 对 data 元素的监听。</p><p>由于我们的 markdown 文件事先并没有写入<code>fullScreen</code>，因此导致 vue 并没有监听到该键，所以之后的操控行为并非响应式的。</p><a id="解决方案-6"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-6">解决方案<a class="hash-link" href="#解决方案-6" title="标题的直接链接">​</a></h3><p>第一种解决方案就是修改原来的 markdown 文件，使之包含一个默认的初始值，比如<code>fullScreen: false</code>。</p><p>第二种解决方案，则是修改一下生成<code>frontmatter</code>或者解析<code>frontmatter</code>步骤的代码，使<code>frontmatter</code>或者<code>document </code>有着合理的默认值。此外，对于不规范的 markdown 文档，还应在 console 中进行 warning 提示。</p><a id="【已解决】bug-content-theme-docs中关于index键重复的问题"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug-content-theme-docs-中关于-index-键重复的问题">【已解决】BUG: content-theme-docs 中关于 index 键重复的问题<a class="hash-link" href="#已解决bug-content-theme-docs-中关于-index-键重复的问题" title="标题的直接链接">​</a></h2><a id="bug初见面"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="bug-初见面">BUG 初见面<a class="hash-link" href="#bug-初见面" title="标题的直接链接">​</a></h3><p>我在使用<code>nuxt-content</code>官方的<code>content-theme-docs</code>主题时，遇到了浏览器警告，提示我<code>index</code>键重复。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818163726511.png" alt="image-20200818163726511" class="img_vXGZ"></p><p>这样的报错，我是大概知道什么原因的。</p><p>这是因为我刚刚从<code>vuepress</code>框架迁移到<code>nuxt</code>框架上来，<code>vuepress</code>需要每个文件夹下有一个<code>index.md</code>文件用以渲染该文件夹路径，而当访问这些没有<code>index.md</code>的文件夹路径时，将失败。由于这些文件夹路径大多又和导航栏、侧边栏相绑定，耦合很高，极易出现意想不到的 bug。</p><p><code>nuxt-content</code>虽然也是基于文件路径，但是给出了更加灵活的路由方案，因此不需要如此大费周章。</p><p>基于此，<strong>我直接删除或者重命名了博客文件夹下所有（除首页）的<code>index.md</code>文件</strong>。</p><p>于是，报错不再发生了。</p><a id="bug再见面"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="bug-再见面">BUG 再见面<a class="hash-link" href="#bug-再见面" title="标题的直接链接">​</a></h3><p>尽管如此，意外还是继续发生了。</p><p>同上，如果我直接访问一个没有<code>inedx.md</code>的文件夹路径，<code>nuxt-content</code>也会报出<code>page not found</code>的问题，只不过，由于<code>content-theme-docs</code>主题里的侧边栏设计的比较巧妙，即<strong>文件夹路径默认不可点击</strong>，因此发觉不了这样的问题。</p><p>但是，现在有一项新的需求：<strong>没有 index.md 文件将无法实现面包屑导航的功能</strong>。</p><p>即当从<code>AAA/xxx.md</code>文件导航回<code>AAA</code>文件夹时，由于该文件夹下没有<code>index.md</code>文件，将导致导航失败。</p><p>基于此认识，如果我们想让自己的文件导航系统更加稳健，我们还是应当采取<code>vuepress</code>的管理方案，<strong>每个文件夹下必须有一个<code>index.md</code>文件用于导航占位</strong>，或者，<strong>在程序中设置对应的路由选项</strong>，比如为其设定一个默认的页面展示。</p><p>我认为，两者可以结合使用，使程序具有更强的扩展性与兼容性。</p><p>于是，<strong>我再次新建了一些<code>index.md</code>文件</strong>，并<strong>再次触发了<code>index key 重复</code>的报错</strong>。</p><a id="摸索历程"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="摸索历程">摸索历程<a class="hash-link" href="#摸索历程" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="源代码检查">源代码检查<a class="hash-link" href="#源代码检查" title="标题的直接链接">​</a></h4><p>查看源代码，原来是<code>content-theme-docs</code>的作者，在遍历文章列表（以生成侧边栏）时，将文章的<code>slug</code>作为了键索引。</p><p><code>slug</code>是什么鬼呢？在<code>gatsby</code>框架里<code>slug</code>就是文件的路径，即域名后面的一串<code>path</code>。</p><p>但在<code>nuxt</code>中我检查出以下的结果。</p><p>首先是<code>marked</code>包中有<code>slug</code>的生成方式，如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818165256663.png" alt="image-20200818165256663" class="img_vXGZ"></p><p>有点复杂，主要是我并不知道这里面的<code>e</code>是什么，是文件名？还是文件路径？不得而知。</p><p>接着在<code>content-theme-docs</code>中有一个<code>slug</code>的赋值操作。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">userConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> defu</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">arrayFn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> defaultConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'content:file:beforeInsert'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> regexp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">RegExp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">^/(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">config</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">i18n</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">locales</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">map</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation parameter">locale</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation arrow operator" style="color:#393A34">=&gt;</span><span class="token template-string interpolation"> locale</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation property-access">code</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation method function property-access" style="color:#d73a49">join</span><span class="token template-string interpolation punctuation" style="color:#393A34">(</span><span class="token template-string interpolation string" style="color:#e3116c">'|'</span><span class="token template-string interpolation punctuation" style="color:#393A34">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">)</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'gi'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dir</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">regexp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> slug </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">slug</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">^index</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">to</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">dir</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">slug</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到，这里的<code>slug</code>主要是从文档的<code>slug</code>属性中，替换掉<code>index</code>，并生成文档的路由地址，但貌似也不是我们想要的答案。</p><p>再接着，我们查到了<code>content-theme-docs</code>中关于导航栏生成的代码。</p><div class="language-html codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-html codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">li</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">v-for</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">(docs, category, index) in categories</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">:key</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">category</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">mb-4</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">:class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">{ </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">lg:mb-0</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">: index === Object.keys(categories).length - 1 }</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">mb-2 text-gray-500 uppercase tracking-wider font-bold text-sm lg:text-xs</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ category }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h3</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">ul</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">li</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">v-for</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">doc of docs</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">:key</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">doc.slug</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">text-gray-700 dark:text-gray-300</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">li</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">ul</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">li</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这里，首先对所有的目录进行遍历，这些目录其实不是文件系统中的目录，而是定义在每篇文章里<code>frontmatter</code>中的字段<code>category</code>。</p><div class="language-vue codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-vue codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">categories() { return this.$store.state.categories[this.$i18n.locale] }</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>说到这儿，如果对<code>content-theme-docs</code>生成侧边栏的方式不满意，以及对于<code>frontmatter</code>中需要人为加入<code>directory</code>而非<code>tags</code>等设定不满意的话，可以重写一下<code>AppNav.vue</code>文件。（我自己目前还挺满意的，我并不想 hack 这个文件，以改变所有文章的筛选显示。我会采取<code>\$content()</code>的方法进行筛选。 :::</p><p>由于目录一般来说都是些不一样的文件名，而且<code>categories</code>已经是一个集合（应该是），不存在键重复的问题。</p><p>但最后一行，<code>doc.slug</code>就有问题了，因为这里的 slug，很有可能就是文档名，即对于任意文件夹下的<code>index.md</code>文件，其<code>slug</code>都等于<code>index</code>，由此引发了键冲突。</p><a id="解决方案-7"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-7">解决方案<a class="hash-link" href="#解决方案-7" title="标题的直接链接">​</a></h3><p>由于<code>vue</code>中的遍历，键只是一种索引，比较随意，因此简单修改以上源代码，将键设置为其他字段就好了，比如本地文件系统的路径地址，这个肯定唯一。</p><p>实践结果显示，浏览器确实不再报错了，解决方案有效！</p><a id="反思总结"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="反思总结">反思总结<a class="hash-link" href="#反思总结" title="标题的直接链接">​</a></h3><p>尽管问题解决了，但是还有一些困惑存在。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="1-content-theme-docs这个-slug-到底是怎么生成的为什么只生成了文件名而不是像其他框架一样生成了文件的相对路径">1. <code>content-theme-docs</code>这个 slug 到底是怎么生成的，为什么只生成了文件名（而不是像其他框架一样生成了文件的相对路径）？<a class="hash-link" href="#1-content-theme-docs这个-slug-到底是怎么生成的为什么只生成了文件名而不是像其他框架一样生成了文件的相对路径" title="标题的直接链接">​</a></h4><p>留待后续解决吧！</p><a id="【已解决】bug-element-ui默认drawer不能滚动"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug-element-ui-默认-drawer-不能滚动">【已解决】BUG: element-ui 默认 drawer 不能滚动<a class="hash-link" href="#已解决bug-element-ui-默认-drawer-不能滚动" title="标题的直接链接">​</a></h2><a id="需求"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="需求">需求<a class="hash-link" href="#需求" title="标题的直接链接">​</a></h3><p>我需要实现一个点击<code>菜单</code>�� 弹出一个<code>抽屉</code>，显示可供选择的菜单项。</p><a id="现场-5"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-5">现场<a class="hash-link" href="#现场-5" title="标题的直接链接">​</a></h3><p>我使用了<code>el-drawer</code>帮助我完成这样的需求。</p><p>在开发过程中，我尝试放入了一个较长的列表项，这直接导致抽屉中的内容高度超过 100%，并无法滚动。</p><p>问题是无法滚动，这不符合常识。</p><p>我搜索到这样的一篇帖子：<a href="https://github.com/ElemeFE/element/issues/17600" target="_blank" rel="noopener noreferrer">[Bug Report] el-Drawer Rolling Problem Repair · Issue #17600 · ElemeFE/element</a>，原来是<code>drawer</code>内部的 css 设定了<code>overflow:hidden</code>。</p><p>了解到这样的信息后，我立即验证了一下，果然是这个问题。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818160242494.png" alt="image-20200818160242494" class="img_vXGZ"></p><p>那么解决方案就很简单了，通过各种方式修改成<code>overflow:auto</code>即可。</p><a id="解决方案-8"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-8">解决方案<a class="hash-link" href="#解决方案-8" title="标题的直接链接">​</a></h3><p>帖子中给出的方法是修改<code>element-ui</code>的<code>index.css</code>文件，我尽量避免这样的措施。</p><p>我选择的方法是对该组件进行<code>css穿透</code>设置，详情如下。</p><div class="language-scss codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-scss codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f">/deep/ .el-drawer </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto </span><span class="token important">!important</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到，浏览器里已经成功覆写了内部<code>overflow:hidden</code>的设定，转而变成<code>overflow:auto</code>，满足了我们滚动的需求。</p><a id="反思总结-1"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="反思总结-1">反思总结<a class="hash-link" href="#反思总结-1" title="标题的直接链接">​</a></h3><p>有几点值得注意。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="1-为什么-element-ui-要屏蔽溢出">1. 为什么 element-ui 要屏蔽溢出<a class="hash-link" href="#1-为什么-element-ui-要屏蔽溢出" title="标题的直接链接">​</a></h4><p>不得而知。</p><p>也许是他们认为打开的抽屉，不应有超出的内容，毕竟真实世界中抽屉是不可以装超过自身体积的东西的。</p><p>所以，也许有其设定的合理性。</p><p>在此共识上，我自己也尽量遵循这样的一种设定，我目前是开发阶段，所以直接装入了一个很长的列表，后续会把它们组合，尽量使之不超过整个容器体积。</p><p>但尽管如此，我还是倾向于可以竖向滚动，因此我还是在组件中使用了穿透的方式，以防万一。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="2-两种穿透方式">2. 两种穿透方式<a class="hash-link" href="#2-两种穿透方式" title="标题的直接链接">​</a></h4><div class="language-less codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-less codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* 方式一，使用/deep/，通用 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector" style="color:#00009f">/deep/ .el-drawer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto </span><span class="token important">!important</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 方式二，使用 &gt;&gt;&gt;，sass不支持 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector" style="color:#00009f">&gt;&gt;&gt; .el-drawer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto </span><span class="token important">!important</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="3-穿透设置要点">3. 穿透设置要点<a class="hash-link" href="#3-穿透设置要点" title="标题的直接链接">​</a></h4><p>以下写法是不正确的，这意味着在<code>el-drawer</code>下的一些子级元素需要进行<code>overflow:auto</code>的设定。</p><div class="language-less codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-less codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f">.el-drawer /deep/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto </span><span class="token important">!important</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在这里的实际需求是<code>el-drawer</code>其本身需要进行<code>overflow:auto</code>的设定。</p><p>因此，顺序很重要。</p><a id="【已解决】bug-prettier对jsx格式style分行后浏览器解析无法识别"></a><h2 class="anchor anchorWithStickyNavbar_rB0w" id="已解决bug-prettier-对-jsx-格式-style-分行后浏览器解析无法识别">【已解决】BUG: prettier 对 jsx 格式 style 分行后浏览器解析无法识别<a class="hash-link" href="#已解决bug-prettier-对-jsx-格式-style-分行后浏览器解析无法识别" title="标题的直接链接">​</a></h2><a id="现场-6"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="现场-6">现场<a class="hash-link" href="#现场-6" title="标题的直接链接">​</a></h3><p>初始代码，一行 jsx，定义了多个 css 属性。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818132729397.png" alt="image-20200818132729397" class="img_vXGZ"></p><p>经过<code>prettier</code>美化后，变成了多行。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818133051185.png" alt="image-20200818133051185" class="img_vXGZ"></p><p>然而，在浏览器里渲染出来，却多了换行符导致<code>css</code>无效。</p><p>​ <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200818133210747.png" alt="image-20200818133210747" class="img_vXGZ"></p><a id="解决方案-9"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案-9">解决方案<a class="hash-link" href="#解决方案-9" title="标题的直接链接">​</a></h3><p>使用正则替换一下。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">styleReplace</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> s2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">\s*(\S*): (\S*);\s*</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"'$1': '$2',"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">style="(.*?)"</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">m</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">':style = "{$1}"'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> s2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a id="反思总结-2"></a><h3 class="anchor anchorWithStickyNavbar_rB0w" id="反思总结-2">反思总结<a class="hash-link" href="#反思总结-2" title="标题的直接链接">​</a></h3><p>待更。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[南川笔记中文首页]]></title>
            <link>https://markshawn2020.github.io/blog/home</link>
            <guid>/home</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[南川笔记中文首页]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="初见">初见<a class="hash-link" href="#初见" title="标题的直接链接">​</a></h2><p>你好，朋友。欢迎来到南川笔记博客站点！</p><p>我是南川，一名编程自学爱好者，热爱学习与掌握前沿的技术。</p><p>在这里，我将极力打造一个高质量的博客平台，主要为系统记录个人的知识体系，同时也提供一些公众服务。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="起点">起点<a class="hash-link" href="#起点" title="标题的直接链接">​</a></h2><p>我来自一所不那么出众的商科院校，如果你有兴趣，可以在 <a href="/blog/my_university">谨以此文纪念我在大学的这四年</a>那里寻觅到我的一些过往。</p><p>此外，如果你也是我的校友，那极力推荐你收藏我的网站，因为我做的事情或者我以后做的事情，很有可能会与你有关。</p><p>接着，如果你是一名程序员，或对编程感兴趣，也十分欢迎你关注我的网站，一起学习，共同成长。</p><p>如果你还是一名站长，可以向我申请友链。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方向">方向<a class="hash-link" href="#方向" title="标题的直接链接">​</a></h2><p>我信奉<strong>“人生不设限”</strong>，在我们尚年轻的时候，只要心存热诚，总有无限种可能。即便在别人眼中，也许只是平淡无奇的一簇烟火，那也足以明媚某些人的眼眸。</p><p>面对未来，我心怀敬畏，我并不知道我会去向哪，也许是互联网公司就职，也许是国内高校深造，也许在某个创业工坊，或者，hh，在某个工地搬砖。不过，我并不在乎我在做什么，我更在乎我想做什么，如果这件事情感兴趣，那我就会努力去做。</p><p>所以，我想去的一定是我想去的地方，我们彼此知道这一点，就够了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="服务">服务<a class="hash-link" href="#服务" title="标题的直接链接">​</a></h2><p>作为一个站点，服务是必不可少的，但不必强求，毕竟重视内心建设远比盲目对外输出更重要。</p><p>但如果你的确有一定需求，我也确实可能提供一定帮助。比如以下所列。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="爬虫服务">爬虫服务<a class="hash-link" href="#爬虫服务" title="标题的直接链接">​</a></h3><p>我真正对编程感兴趣，是始于爬虫，它是转变我人生轨迹的缘由与契机，因此，我首先推出这项服务。</p><p>我已经兑现的具有一定挑战的爬虫服务如下：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 某高校科研团队对于微博某自杀用户的评论信息爬取，条目数在千万级别（深度爬虫系列）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 某投行公司团队对于初创企业信息的定期爬取，条目数在百万级别（长期定向爬虫系列）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 某咨询公司团队对于各大新网网站正文内容信息爬取，网站数二十个左右（广度爬虫系列）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ……</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上爬虫涉及到网站、App、反爬等多种爬虫技术，很好地锻炼了我的爬虫能力，也为我的网站服务提供了自给自足的后端数据支持。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="编程教学">编程教学<a class="hash-link" href="#编程教学" title="标题的直接链接">​</a></h3><p>我自己是一个编程自学爱好者，常常苦于没有一份好的教学，我在校期间也常多次举办某些领域的经验分享会，积累了一定的教学经验。基于此，我很有可能会开展一定的编程教学服务。</p><p>当然了，服务的产品不一定是线下或者视频录制的形式，图文版（类似廖雪峰）之类的也有可能。目前来看，随着网站系统的完善，这项服务的质量将得到保障。</p><p>我比较感兴趣与有能力推广的教学应用如下：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 基于Python的入门、爬虫和数据分析相关内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 基于Fastapi的后台API搭建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 基于Vue的前端网站搭建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ……</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="跨平台文档管理与发布系统">跨平台文档管理与发布系统<a class="hash-link" href="#跨平台文档管理与发布系统" title="标题的直接链接">​</a></h3><p>现如今，人人都是自媒体，人人都需要学会销售自己。作为程序员，也希望自己的一份文档能够在各大平台得到同步的发布与传播。程序员的一大特质就是“怕重复劳动”，因此一款全平台的文档发布系统呼之欲出。</p><p>不过类似的产品也有很多，也有一些做的相当不错，但首先它们的功能还不够强大，其次我也有自己研究的兴趣，因此，我希望能够将它实现。</p><p>它将支持以下一些功能：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 集成各大互联网平台的API，公众号、知乎、掘金、CSDN、SegmentedFault等，实现同步发布</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 提供用户友好的文档管理系统，与之相伴地，还有对这些平台的数据监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ……</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="高校社团联盟平台">高校社团联盟平台<a class="hash-link" href="#高校社团联盟平台" title="标题的直接链接">​</a></h3><p>我在校期间，投入了较多的时间在社团上，深有感情。我和身边的一些朋友，对社团运营与发展也有着一些独特的见解。</p><p>基于此，我想尝试使用技术手段，辅助解决社团运营中的一些难点，将社团活动做活、做大，让高校学生更有参与感、认同感。</p><p>它将拥有以下一些特性：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">- 2B的社团运营系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 2C的社团社交体验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- ……</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后">最后<a class="hash-link" href="#最后" title="标题的直接链接">​</a></h2><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora
-user-images/image-20200818222333351.png" alt="无问西东" class="img_vXGZ"><br><br><blockquote><p><em>Valar Morghulis</em></p><p><em>Valar Dohaeris</em></p></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[待办事项]]></title>
            <link>https://markshawn2020.github.io/blog/todo-old</link>
            <guid>/todo-old</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[关于]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-31">TODO 2020-08-31<a class="hash-link" href="#todo-2020-08-31" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->修复启动时 logo 备选字显示问题（原来是<code>alt</code>参数在<code>Icon</code>类下显示的效果，使用<code>transparent</code>进行屏蔽输出了）</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->解决<code>eslint</code>的<code>prettier</code>问题</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用<code>koa</code>重写<code>ali-oss</code>模块</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->配置<code>cookie</code></li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->配置评论<code>token</code></li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->优化首页路径重定向问题</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-25">TODO 2020-08-25<a class="hash-link" href="#todo-2020-08-25" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->文章热启动问题</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->多主题配置</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-23">TODO 2020-08-23<a class="hash-link" href="#todo-2020-08-23" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->翻页</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->页内导航跳转问题</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-22">TODO 2020-08-22<a class="hash-link" href="#todo-2020-08-22" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->修改侧边栏数字的显示（考研、留学专辑字体失衡）（使用<code>Helvtica Neue</code>字体解决了）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->修复手机端的文章显示</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->修复代码块的复制按钮无效的问题（莫名其妙的发现。。。是好的。。）</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->修复代码高亮功能</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-21">TODO 2020-08-21<a class="hash-link" href="#todo-2020-08-21" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->配置 Algolia（去看了一下，只有 14 天免费。。）</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->弄清<code>$content(settings)</code>的机制</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->弄清<code>$vm1</code>的机制（貌似只是浏览器的一种机制）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->登录有些慢，应加入<code>loading</code>动画（并解决了一个居中 bug）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-19">TODO 2020-08-19<a class="hash-link" href="#todo-2020-08-19" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->优化菜单抽屉页</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->解决浏览器的一些客户端与服务端渲染不一致的问题（多装一些包，和重启几次，就莫名其妙解决了）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->解决 localstorage 在服务端不能使用的问题：<code>nuxtServerInit / cookie-universal-nuxt</code></li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->美化用户头像与网站 logo 的互动</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-18-周二">TODO 2020-08-18, 周二<a class="hash-link" href="#todo-2020-08-18-周二" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->markdown 新建时自动生成 frontmatter（在<code>content-theme-mark/index.tsx </code>中，作者写了一个<code>hook</code>函数，作用是在页面（<code>document</code>）生成前插入一些字段，即<code>frontmatter </code>。类似的，可以基于此实现对<code>markdown</code>文件中的<code>frontmatter</code>进行软修改，以适应前端初始化的需求（或者在前端 page 处理也可以，看自己的需求了，推荐在服务端，我采用了服务端）。</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->研究 index 路由机制，基于此才能构建更加自定义的导航栏（基于掘金那篇文章，大致了解了，就是.md 文档和.vue 组件两者之间，有个先后关系，不要在文档中写多个 index.md，而是在 pages 里多写一些页面。不过如何写这些 directory 页面，还是个问题）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-18-042859">TODO 2020-08-18 04:28:59<a class="hash-link" href="#todo-2020-08-18-042859" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->加入导航栏（使用了一个抽屉进行导航，效果还不错）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->解决英文首页导航问题</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->重新加入用户系统</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-14-160104">TODO 2020-08-14 16:01:04<a class="hash-link" href="#todo-2020-08-14-160104" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->增加留言功能</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->增加左右翻页</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->增加标签</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->修改 excerpt 的逻辑（对个人资料进行统一截取，关键字为目标院校）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->卡片底部增加渐变（由于截取后目标长度大幅降低，已经不需要卡片底部渐变以屏蔽溢出）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-14-074116">TODO 2020-08-14 07:41:16<a class="hash-link" href="#todo-2020-08-14-074116" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->增加阅读笔记功能（类似微信读书那样的）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-14-011907">TODO 2020-08-14 01:19:07<a class="hash-link" href="#todo-2020-08-14-011907" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->增加英文简介页</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-13-194701">TODO 2020-08-13 19:47:01<a class="hash-link" href="#todo-2020-08-13-194701" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->网站配置站长统计</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->网站配置 https</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用 cdn 加快速度</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->配置 seo</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-13-164212">TODO 2020-08-13 16:42:12<a class="hash-link" href="#todo-2020-08-13-164212" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->研究 vuepress 对于侧边栏标题的覆写原则 （数组和对象两种方式）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-13-032201">TODO 2020-08-13 03:22:01<a class="hash-link" href="#todo-2020-08-13-032201" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->实现像 Nuxt 一样，双击前端的文档，可以直接开启编辑并自动保存的功能（不用实现了，我已经直接使用 Nuxt 了，update：2020-08-17）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="todo-2020-08-12-172840">TODO 2020-08-12 17:28:40<a class="hash-link" href="#todo-2020-08-12-172840" title="标题的直接链接">​</a></h2><ul class="contains-task-list containsTaskList_k9gM"><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->封面图的生成（放弃了本地引用，基于图床）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->马若宇同学的图片完善（本地上传至阿里云）</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->用户系统的移植</li><li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Github 项目的移植</li><li class="task-list-item"><input type="checkbox" disabled="" checked=""> <!-- -->弄清 md 组件在哪渲染的原理（不弄了，已经迁移了）</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[更新日志]]></title>
            <link>https://markshawn2020.github.io/blog/release-notes</link>
            <guid>/release-notes</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[关于]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="v101-2020-09-03-083009">V1.0.1 2020-09-03 08:30:09<a class="hash-link" href="#v101-2020-09-03-083009" title="标题的直接链接">​</a></h2><ul><li>修复<code>menuDrawer</code>在手机端与电脑端的窗口显示问题</li><li>修复<code>fullScreen</code>在手机端依旧显示的问题（i 标签貌似无法使用 flex）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v100-2020-08-31">V1.0.0 2020-08-31<a class="hash-link" href="#v100-2020-08-31" title="标题的直接链接">​</a></h2><ul><li>项目正式对外发布</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v060-2020-08-30-094111">V0.6.0 2020-08-30 09:41:11<a class="hash-link" href="#v060-2020-08-30-094111" title="标题的直接链接">​</a></h2><ul><li>项目转移至 mac 开发</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v055-2020-08-25-051245">V0.5.5 2020-08-25 05:12:45<a class="hash-link" href="#v055-2020-08-25-051245" title="标题的直接链接">​</a></h2><ul><li>完成了菜单导航的 UI 设计</li><li>完成了列表页的 UI 设计</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v054-2020-08-24-195302">V0.5.4 2020-08-24 19:53:02<a class="hash-link" href="#v054-2020-08-24-195302" title="标题的直接链接">​</a></h2><ul><li>修改了登录组件，使之能与评论组件协同（本来想将登陆组件注册为全局组件，但由于该组件本身就依赖其他组件，因此未能成功）</li><li>基于<code>analyse</code>了解到<code>ali-oss-sdk</code>体积过于庞大，不适合作为前端依赖，意欲使用<code>python</code>完成<code>ali-oss </code>的后端工作，但在搭建<code>python</code>版本的<code>sdk</code>时，遇到了服务器上环境安装的问题，目前正在提交工单等待解决。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v053-2020-08-23-142725">V0.5.3 2020-08-23 14:27:25<a class="hash-link" href="#v053-2020-08-23-142725" title="标题的直接链接">​</a></h2><ul><li>自定义了<code>Icons | Containers</code>的<code>CSS</code>类，实现了完全的<code>flex</code>布局</li><li>解决了<code>color-mode</code>文件导航前缀添加不正常的问题，原因是需要使用<code>&amp;</code>符号表示串联</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v052-2020-08-22-013240">V0.5.2 2020-08-22 01:32:40<a class="hash-link" href="#v052-2020-08-22-013240" title="标题的直接链接">​</a></h2><ul><li>研究<code>@nuxt/i18n</code>后完善了本地路由（无硬编码）</li><li>实现了菜单-导航的专辑化</li><li>实现了面包屑，但暂时不打算用于导航，原因是 UI 上不好放</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v051-2020-08-21-131952">V0.5.1 2020-08-21 13:19:52<a class="hash-link" href="#v051-2020-08-21-131952" title="标题的直接链接">​</a></h2><ul><li>升级了主页<code>Valar Dohaeris</code>的交互形式</li><li>取消了 Footer 的固定高度，针对 mb 进行了 hidden 优化</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v050-2020-08-21-051147">V0.5.0 2020-08-21 05:11:47<a class="hash-link" href="#v050-2020-08-21-051147" title="标题的直接链接">​</a></h2><ul><li><strong>自主研究出一套多语言适配系统</strong>，使用体验良好</li><li>基于以上的多语言系统，完成了整站的多语言配置</li><li>将菜单抽屉的内容由卡片式改成了手风琴式（最后又改回了卡片）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v045-2020-08-20-232958">V0.4.5 2020-08-20 23:29:58<a class="hash-link" href="#v045-2020-08-20-232958" title="标题的直接链接">​</a></h2><ul><li>研究了<code>nuxt-content</code>作者使用的<code>tailwindcss</code>，十分的赞，<del>决定与<code>element-ui</code>一起作为接下来的主力 CSS 工具</del>（后续深入了解发现，大家对<code>tailwindcss</code>的评价不一，而在<code>nuxt</code>的插件里，排名最高的<code>css</code>插件是<code>VueBootstrap</code>，所以目前保持观望态度，暂时继续使用<code>element-ui</code> + <code>tailwindcss</code>）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v044-2020-08-19-231951">V0.4.4 2020-08-19 23:19:51<a class="hash-link" href="#v044-2020-08-19-231951" title="标题的直接链接">​</a></h2><ul><li>头像的登录功能测试完成</li><li>头像的美化完成</li><li>简化了语言切换的点击逻辑</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v043-2020-08-19-130706">V0.4.3 2020-08-19 13:07:06<a class="hash-link" href="#v043-2020-08-19-130706" title="标题的直接链接">​</a></h2><ul><li>使用 Eslint 规范了所有代码</li><li>抽离了原主题所有的<code>menu</code>相关的代码</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v042-2020-08-19">V0.4.2 2020-08-19<a class="hash-link" href="#v042-2020-08-19" title="标题的直接链接">​</a></h2><ul><li>修改了<code>content-theme-mark/components/global/base/Alert.vue</code>组件，默认为<code>success</code>，绿色挺好看的</li><li>修复了<code>content-theme-mark/components/global/base/CodeGroup.vue</code>组件，使之页面启动的时候能够自动显示默认的<code>code block</code></li><li>将<code>content-theme-docs</code>全部移出到根目录，运行没有大错（少量浏览器警告），这意味着我们完全内化了该主题，这是一个非常值得高兴的信号。</li><li><del>在引入<code>element-ui</code>的大部分组件后，由于<code>content-theme-docs</code>内设定的<code>alert</code>组件与<code>element-ui </code>的<code>alert</code>组件冲突，导致异常，现已全部重命名</del></li><li>后续发现，其实是因为导入组件时，错误地加上了<code>Vue.use(Message) | Vue.use(MessageBox)</code>导致的</li><li><del>此外，根据<code>element-ui</code>官网的指引，我们使用部分导入的方式，最终减少了生成体积 200M 左右</del>可能是错觉</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v041-2020-08-18">V0.4.1 2020-08-18<a class="hash-link" href="#v041-2020-08-18" title="标题的直接链接">​</a></h2><ul><li>解决了一些 bug，例如 element-ui 的 drawer 和 content-theme-docs 里的 slug key</li><li>加入了一个 fullScreen 切换小组件，对 z-index 和组件的布局有了更多的了解</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v040-2020-08-17-225732">V0.4.0 2020-08-17 22:57:32<a class="hash-link" href="#v040-2020-08-17-225732" title="标题的直接链接">​</a></h2><ul><li>在深入研究<code>vuepress</code>框架继而彻底失望之后，重新拾起<code>nuxt</code>框架，有了对<code>vuepress</code>源码研究的基础，很快上手了<code>nuxt </code>，并深刻感受到了它的强大，项目正式迁移</li><li>在研究<code>content-theme-docs</code>中发现他的<code>main.css</code>内用的其实是<code>less</code>语法，这直接导致我的<code>IDE</code>（WebStorm）一堆报错。。所以修改它的后缀为<code>less</code>后，安装了<code>less-loader</code>，项目可以继续成功运行</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v032-2020-08-16-211601">V0.3.2 2020-08-16 21:16:01<a class="hash-link" href="#v032-2020-08-16-211601" title="标题的直接链接">​</a></h2><ul><li>深入研究了<code>markdown-it</code>的<code>rules</code>，配置了可用于<code>todo-list</code>的规则，使<code>todo</code>页不再丑陋</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v031-2020-08-16-170615">v0.3.1 2020-08-16 17:06:15<a class="hash-link" href="#v031-2020-08-16-170615" title="标题的直接链接">​</a></h2><ul><li>花费巨大精力修改了框架的源代码，实现了满意的路由（但打包时也要记得同步），具体是替换<code>node_modules/@vuepress/core/lib /node/internal-plugins/routes.js</code>文件中的路由映射</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v030-2020-08-15-235721">V0.3.0 2020-08-15 23:57:21<a class="hash-link" href="#v030-2020-08-15-235721" title="标题的直接链接">​</a></h2><ul><li>移植了之前项目的登陆系统，集成到了目前的评论系统中</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v025-2020-08-15-194936">V0.2.5 2020-08-15 19:49:36<a class="hash-link" href="#v025-2020-08-15-194936" title="标题的直接链接">​</a></h2><ul><li>仿照 Gitalk 独立设计了一个评论组件</li><li>仿照 Gitee 重新设计了登录组件</li><li>对章节命名采取离散法（这样可避免反复修改其他章节以调整章节顺序）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v024-2020-08-15-012309">V0.2.4 2020-08-15 01:23:09<a class="hash-link" href="#v024-2020-08-15-012309" title="标题的直接链接">​</a></h2><ul><li>配置了百度站长统计（不过目前是修改了@vuepress 内的 html，需要研究如何在自定义主题内配置 html）</li><li>统一了个人信息，以确保卡片的内容足够显示</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v023-2020-08-14-155120">V0.2.3 2020-08-14 15:51:20<a class="hash-link" href="#v023-2020-08-14-155120" title="标题的直接链接">​</a></h2><ul><li>完成了考研专辑列表页的卡片设计，使用正则标准化了所有信息字段</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v022-2020-08-14-090649">V0.2.2 2020-08-14 09:06:49<a class="hash-link" href="#v022-2020-08-14-090649" title="标题的直接链接">​</a></h2><ul><li>完成了升学专辑文章的所有封面云端化</li><li>为所有专辑文章加入了 excerpt（说实话这玩意不太智能，还不如直接提取前 100 字呢，就像 gatsby 那样），具体可以见源代码：<code>node_modules/@vuepress/core/lib/node/Page.js${106}</code></li><li>将所有文章封面迁移到了阿里云，并配置了封面专用压缩格式，极其显著地提升了专辑文章列表页的加载速度（单张图片从最大可能十几兆到每张 50k 以内，上百倍提升）。</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v021-2020-08-13-234931">V0.2.1 2020-08-13 23:49:31<a class="hash-link" href="#v021-2020-08-13-234931" title="标题的直接链接">​</a></h2><ul><li>关闭了 Markdown 页面的代码行数显示</li><li>经过反复 debug，大致理解了<code>locales</code>和<code>themeConfig.locales</code>之间的覆盖机制，实现了双语言的配置</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v020-2020-08-13-194505">V0.2.0 2020-08-13 19:45:05<a class="hash-link" href="#v020-2020-08-13-194505" title="标题的直接链接">​</a></h2><ul><li>第一次进行打包直接失败，不知道改了源代码哪里导致出现问题</li><li>重建了一个 vuepress 项目，放弃了之前的主题覆写（直接使用默认），将所有文档图片网络化（方便迁移），再次打包成功~</li><li>后台使用的 nginx，网址是<code>blog.nanchuan.sie</code></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v012-2020-08-13-164031">V0.1.2 2020-08-13 16:40:31<a class="hash-link" href="#v012-2020-08-13-164031" title="标题的直接链接">​</a></h2><ul><li>研究了多语言的配置，目前只配置了首页（中+英），由于导航栏和侧边栏对路径的依赖较高，即 vuepress 是路径绑定的，所以暂时不打算继续尝试，某种意义上我不认可这样的国际化配置（怀念 Django，233）</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v011-2020-08-12-155359">V0.1.1 2020-08-12 15:53:59<a class="hash-link" href="#v011-2020-08-12-155359" title="标题的直接链接">​</a></h2><ul><li>初始化了 Gitee 仓库，位于：<a href="https://gitee.com/MarkShawn2020/mark-vuepress" target="_blank" rel="noopener noreferrer">Gitee 地址</a></li><li>基于于兄的建议，修改了首页的 title</li><li>对 nav item 加入<code>_isAlbum</code>标识，使用更加系统的方式管理专辑内容</li><li>为每个 nav item 都加入一个 index.md，使每一项都可以被点击</li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="v010-2020-08-12-065113">V0.1.0 2020-08-12 06:51:13<a class="hash-link" href="#v010-2020-08-12-065113" title="标题的直接链接">​</a></h2><ul><li>完成了基于 vuepress 博客的首页搭建</li><li>开发了一个基于 markdown-it 的图像编码还原插件</li><li>规范了考研/留学文章的图片格式</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[留言墙]]></title>
            <link>https://markshawn2020.github.io/blog/guestbook</link>
            <guid>guestbook</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[关于]]></description>
            <content:encoded><![CDATA[<blockquote><p>来者皆是客，请坐，红茶还是冰可乐？</p></blockquote>]]></content:encoded>
            <category>关于</category>
        </item>
        <item>
            <title><![CDATA[经验与发现]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/12/经验与发现</link>
            <guid>/2020/09/12/经验与发现</guid>
            <pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[关于 popup 浮动弹出组件的实现]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于-popup-浮动弹出组件的实现">关于 popup 浮动弹出组件的实现<a class="hash-link" href="#关于-popup-浮动弹出组件的实现" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="场景需求浮出覆盖vue-popper">场景需求（浮出覆盖：<code>vue-popper</code>）<a class="hash-link" href="#场景需求浮出覆盖vue-popper" title="标题的直接链接">​</a></h3><p>我们经常有实现一些浮动弹窗的需求，比如在一个图表里当鼠标悬浮在某个位置上时有自动浮窗提示。</p><p>在<code>Element-ui</code>里，也有多个组件属于浮动弹窗类型，比如<code>el-popover</code>、<code>el-tooltip</code>等。</p><p>查询源代码发现，背后是基于<code>vue-popper.js</code>这个库，而这个库是对<code>popper.js</code>库的一个 vue 封装。</p><p>基于此，如果我们只是想实现浮窗，只需要使用<code>vue-popper.js</code>即可，也十分方便。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="场景选择浮出不覆盖自定义的popup">场景选择（浮出不覆盖：自定义的<code>popup</code>）<a class="hash-link" href="#场景选择浮出不覆盖自定义的popup" title="标题的直接链接">​</a></h3><p>一般来说，浮窗组件是鼠标滑到哪，哪里就出现，出现的浮窗会覆盖目前的视窗。但有时，这会导致不是很美观。</p><p>在我的个人博客里，我在页面底部栏里加入了几个二维码，默认是不显示的。当鼠标划过其中某个触点（比如微信文字）时，该二维码（即微信二维码）浮出，由于布局原因，我发现这个二维码直接显示在布局内（而非浮动覆盖）会更好一些。</p><p>基于此，我简单封装了自己的<code>popup</code>组件，这个对相应要哦浮出的元素只是简单做了一个默认不显示、触发显示的处理。但很好地满足了自己的需求。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于跨平台文件流相关api问题">关于跨平台文件流相关<code>api</code>问题<a class="hash-link" href="#关于跨平台文件流相关api问题" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="具体情况">具体情况<a class="hash-link" href="#具体情况" title="标题的直接链接">​</a></h3><p>在我一开始的程序设计中，前端使用的是基于<code>js</code>的<code>nuxt</code>后端使用的是基于<code>python</code>的<code>fastapi</code>。</p><p>后来经过<code>analyze</code>发现，<code>element-ui</code>和<code>ali-oss</code>两个包占了很大的空间。</p><p>我通过<code>babel</code>的按需导入，成功压缩了<code>element-ui</code>的体积量。考虑到<code>ali-oss</code>非前端 UI 组件，也非<code>build</code>必需模块，而是一个<code>api</code>，因此想将<code>ali-oss</code>整体移植到后端中。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="python平台需要cmcmod的问题"><code>python</code>平台需要<code>cmcmod</code>的问题<a class="hash-link" href="#python平台需要cmcmod的问题" title="标题的直接链接">​</a></h3><p>根据<code>ali-oss</code>官方文档，是有<code>python</code>版本的。</p><p>但很快就遇到了两个问题，首先是版本，它只支持<code>2.7</code>及最高<code>3.6</code>。</p><p>后来检查发现，我本地安装的是<code>3.7</code>，服务端安装的是<code>3.6</code>，服务端那边版本倒不是问题，本地其实无所谓。</p><p>但是，更关键的一个问题出现了。</p><p><code>linux</code>环境下需要单独安装<code>python-dev</code>，以使<code>C++</code>加速的<code>cmcmod</code>更快，否则<code>ali-oss</code>将会使用纯<code>python</code>计算，速度会慢上数十倍。</p><p>我尝试了安装多遍，都未能解决问题，后来提交了工单，交涉了多日，依旧无果。</p><p>尽管如此，我想抱着暂时先用的想法，结果碰到了一个更棘手的技术相关的问题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="js的和python之间的数据交换没有想象中那么简单"><code>js</code>的和<code>python</code>之间的数据交换没有想象中那么简单<a class="hash-link" href="#js的和python之间的数据交换没有想象中那么简单" title="标题的直接链接">​</a></h3><p>我简单设计了一个较为稳健的图片上传的<code>api</code>，基于<code>fastapi</code>，它支持上传本地图片、网络图片和二进制图片内容。</p><p>在移除了<code>ali-oss</code>的<code>js</code>依赖后，我打算使用<code>axios</code>直接与其交互。</p><p>结果发现<code>element-ui</code>读取到的图片是<code>File</code>格式，而这个格式是<code>js</code>特有的，需要通过<code>FileReader</code>或其它方式进行转换才能与<code>python</code>进行交互。</p><p>具体，<code>binaryString</code>格式并非<code>python</code>的<code>bytes</code>，而<code>url</code>是<code>blob url</code>，并且是本地的<code>localhost</code>，在开发的时候并不能直接被<code>nanchuan.site</code>读取。</p><tip>这里也反映了一个关于开发环境和生产环境的域名配置问题，最好还是要保持统一（如果生产环境就是统一的话）。</tip><h3 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="标题的直接链接">​</a></h3><p>我相信，肯定有一些方法可以将<code>js</code>的<code>File</code>格式转换成<code>python</code>的<code>bytes</code>等形式，但我觉得，这中间的成本有一些些高了。在考虑到<code>python</code>版本的性能问题之后，我决定放弃<code>python</code>的<code>sdk</code>。</p><p>基于此，我打算暂时先使用<code>js</code>的<code>ali-oss-sdk</code>，等之后项目进度放缓时，再对应配置<code>koa</code>版本的后台。</p><p>对此，我唯一的顾虑就是，<code>fastapi</code>之后要不要作为本项目的后端，这将是一个需要思考的问题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于局部滚动与滚动条问题">关于局部滚动与滚动条问题<a class="hash-link" href="#关于局部滚动与滚动条问题" title="标题的直接链接">​</a></h2><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于百度统计在nuxt中的最佳植入形式">关于百度统计在<code>nuxt</code>中的最佳植入形式<a class="hash-link" href="#关于百度统计在nuxt中的最佳植入形式" title="标题的直接链接">​</a></h2><p>首先，如果按照百度统计官方的推荐做法，可以将代码插入到<code>html</code>模板的<code>head</code>标签前，即充当整个网站第一个运行的函数。</p><p>但<code>nuxt</code>是较高封装的框架，<code>html</code>层基本都是不用考虑的，但要实现这个需求，也不是不可以。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="方法一修改apphtml">方法一：修改<code>app.html</code><a class="hash-link" href="#方法一修改apphtml" title="标题的直接链接">​</a></h3><p><code>nuxt</code>默认以<code>nuxt</code>内部的<code>app.template.html</code>文件启动。</p><div class="language-html[node_modules/@nuxt/vue-app/template/views/app.template.html] codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-html[node_modules/@nuxt/vue-app/template/views/app.template.html] codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html {{ HTML_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;head {{ HEAD_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ HEAD }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;body {{ BODY_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ APP }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>路径很深，但我们并不需要直接修改这个文件（虽然我确实傻到修改过）。</p><p>我们可以在项目的根目录创建一个<code>app.html</code>文件，内容同上，等价于直接覆盖。</p><p>在此基础上插入百度的官方代码，如下。</p><div class="language-html{2-10} codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-html{2-10} codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var _hmt = _hmt || []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;(function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var hm = document.createElement('script')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hm.src = 'https://hm.baidu.com/hm.js?【这里是代码序列号】'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  var s = document.getElementsByTagName('script')[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  s.parentNode.insertBefore(hm, s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html {{ HTML_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;head {{ HEAD_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ HEAD }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;body {{ BODY_ATTRS }}&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ APP }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="方法二在nuxtconfigjs的head中植入代码">方法二：在<code>nuxt.config.js</code>的<code>head</code>中植入代码<a class="hash-link" href="#方法二在nuxtconfigjs的head中植入代码" title="标题的直接链接">​</a></h3><p><code>nuxt.config.js</code>的扩展能力还是很强的，其中有一个配置项是<code>head</code>，主要用来配置一些<code>settings</code>数据，详情可见 <a href="https://nuxtjs.org/guides/configuration-glossary/configuration-head" target="_blank" rel="noopener noreferrer">The head Property - NuxtJS</a>。</p><p>但官方只提供了配置<code>settings</code>的示例，其实还可以加入<code>script</code>，只不过要以<code>src</code>的形式。也就是说，上述方法中的一串代码并不能直接拷贝过来。</p><p>但在我仔细分析了百度官方的这串代码后，才意识到，它只是自动把百度的这段代码插入到<code>html</code>的第一个<code>script</code>位置而已。如果我们的脚本本来就是位于网页的第一个位置，那这个脚本就有点多余了。它的核心其实就一句话，就是<code>hm.src = 'https://hm.baidu.com/hm.js?【这里是代码序列号】'</code>。</p><p>基于此认知，我们只需要把这个网址复制出来，配置到<code>head.script</code>里去就可以了。具体如下。</p><div class="language-js{11-17} codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js{11-17} codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">  //    ** See https://nuxtjs.org/api/configuration-head</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  head: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title: '南川笔记' || process.env.npm_package_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description: '南川笔记——致力于知识服务',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    settings: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      { charset: 'utf-8' },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      { name: 'viewport', content: 'width=device-width, initial-scale=1' },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link: [{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    script: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 用于百度统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        src:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          process.env === 'production'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ? 'https://hm.baidu.com/hm.js?【这里是代码序列号】'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            : '',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里，值得注意的是，如果在开发模式（本地浏览器）运行<code>nuxt</code>程序，该脚本依旧会触发百度的统计机制，并且在浏览器的<code>storage/session</code>中注入<code>cookie</code>，引发浏览器的跨域警告。</p><p>在这里，我也意识到了，之前我的百度统计页面为啥会出现大量的<code>localhost</code>访问了，我还好奇为啥百度能检测到<code>localhost</code>的访问来着。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822214029461.png" alt="image-20200822214029461" class="img_vXGZ"></p><p>由于在开发模式下，本身就不需要进行访问统计，因此，我们可以加入一句<code> process.env === 'production'</code>进行判断，如果是开发模式就不植入脚本了。</p><p>最后，完美解决问题。如下，在开发模式下，脚本是不会运行的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200822213713894.png" alt="image-20200822213713894" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于nuxt-content的渲染">关于<code>nuxt-content</code>的渲染<a class="hash-link" href="#关于nuxt-content的渲染" title="标题的直接链接">​</a></h2><p>原来是通过读取<code>document.body</code>里的内容（由<code>md</code>渲染后的<code>markdown</code>）。</p><p>具体可以见：</p><div class="language-js{4}[.nuxt/content/nuxt-content.js] codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js{4}[.nuxt/content/nuxt-content.js] codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">  render (h, { data, props }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const { document } = props</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const { body } = document || {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!body || !body.children || !Array.isArray(body.children)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return h('div', data, body.children.map(child =&gt; processNode(child, h, document)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="js-总有奇怪的设计问题">JS 总有奇怪的设计问题<a class="hash-link" href="#js-总有奇怪的设计问题" title="标题的直接链接">​</a></h2><p>看一段代码。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> langs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'en'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zh'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">langs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">lang</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">lang</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> lang</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这段代码如果按照<code>python</code>之类语言的逻辑，毫无疑问会输出</p><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'en'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'en'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zh'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zh'</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然而在<code>javascript</code>里，得到的结果却是</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">'lang'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'en'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string-property property" style="color:#36acaa">'lang'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'zh'</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2></h2>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[JS、ES、TS、node、Vue、React 修炼]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/10/JS、ES、TS、node、Vue、React修炼</link>
            <guid>/2020/09/10/JS、ES、TS、node、Vue、React修炼</guid>
            <pubDate>Thu, 10 Sep 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[node 运行 js、es、ts 脚本]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="node-运行-jsests-脚本">node 运行 js、es、ts 脚本<a class="hash-link" href="#node-运行-jsests-脚本" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="0-运行前检查">0. 运行前检查<a class="hash-link" href="#0-运行前检查" title="标题的直接链接">​</a></h3><p>首先全局安装<code>es-checker</code>： <code>npm i -g es-checker</code>。</p><p>接着运行<code>es-checker</code>，可以检查项目内<code>node</code>对<code>es特性</code>的支持情况。</p><p>以我的项目（<code>mark-nuxt-koa-wechaty</code>）为例，运行<code>node -v</code>得知版本为<code>v12.18.3</code>，这已经是很新的<code>node</code>了。</p><p>但是，运行<code>es-checker</code>，会发现并不支持<code>import, export 和 tail-call</code>。</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">……（其他类型的支持情况已省略）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ Class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ super allowed in object methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  √ class ABC extends Array { .. }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  × Module export command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  × Module import command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Passes 39 feature Detections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your runtime supports 92% of ECMAScript 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因此，对于不同种类、使用了不同语法特性的 js 脚本，运行环境需要作相应地配置。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-对于纯-es5-编写的-js-脚本">1. 对于纯 ES5 编写的 js 脚本<a class="hash-link" href="#1-对于纯-es5-编写的-js-脚本" title="标题的直接链接">​</a></h3><p>即 js 脚本中只有<code>require</code>之类的常规操作，直接使用<code>node xx.js</code>即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-对于使用了import-export等-es6-特性的-js-脚本">2. 对于使用了<code>import, export</code>等 ES6 特性的 js 脚本<a class="hash-link" href="#2-对于使用了import-export等-es6-特性的-js-脚本" title="标题的直接链接">​</a></h3><p>解决方案一：使用<code>node -r esm xx.js</code>，需要提前<code>npm i esm</code>，顾名思义，<code>esm</code>就是<code>es module</code>的含义。</p><p>解决方案二：将<code>xx.js</code>改为<code>xx.mjs</code>，然后使用<code>node xx.mjs</code>。顾名思义，<code>mjs</code>就是<code>module js</code>的含义。</p><p>推荐使用第二种，这样不用修改文件类型。</p><p>*<!-- -->解决方案三：使用<code>babel-node</code>，这个以后再研究，参考：<a href="https://juejin.im/post/6844903561910812685" target="_blank" rel="noopener noreferrer">https://juejin.im/post/6844903561910812685</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-对于引用了其他本地资源的-js-脚本">3. 对于引用了其他本地资源的 js 脚本<a class="hash-link" href="#3-对于引用了其他本地资源的-js-脚本" title="标题的直接链接">​</a></h3><p>例如，在我的项目中，使用了<code>dotenv</code>包以读取项目中<code>.env</code>文件内的环境变量，在我的 js 脚本中，我有如下的两句：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'dotenv'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">TOKEN</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于，这个<code>.env</code>是在项目根目录下，因此，上述直接使用<code>node xx.js</code>的方式是不行了。</p><p>正确的运行方式，需要在项目根目录运行，即<code>node xx/xx.js</code>。</p><p>当然了，如果这个脚本本来就和项目根目录平行的话，那么<code>node xx.js</code>依旧是可行的。</p><p>但最重要的，由于一个标准项目，都需要各种资源的引用，因此单文件运行是不怎么可取的，所以都需要通过<code>package.json</code>进行统一配置。</p><p>因此，我们在<code>package.json</code>中加入<code>script</code>即可，例如。</p><div class="language-json codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-json codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"test_xx"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node xx/xx.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="4-运行-ts-脚本">4. 运行 ts 脚本<a class="hash-link" href="#4-运行-ts-脚本" title="标题的直接链接">​</a></h3><p>主要分为两类，一类是显式地转换成 js 文件再运行，一类是直接运行。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="-方法一命令行手动-ts-转-js">*<!-- --> 方法一：命令行手动 ts 转 js<a class="hash-link" href="#-方法一命令行手动-ts-转-js" title="标题的直接链接">​</a></h4><p>首先安装<code>typescript</code>：<code>npm i typescript -D</code>，然后运行转换：<code>tsc xx.ts</code>即可。</p><p>但我在测试过程中失败了：<code>tsc koa/bot.ts</code></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="方法二ide-中-ts-自动转-js推荐">方法二：IDE 中 ts 自动转 js（推荐）<a class="hash-link" href="#方法二ide-中-ts-自动转-js推荐" title="标题的直接链接">​</a></h4><p>首先全局安装<code>typescript</code>：<code>npm i -g typescript</code>，然后在 IDE 中配置<code>typescript</code>的自动转换，以 WebStorm 为例。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200918022607550.png" alt="image-20200918022607550" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="方法三使用ts-node直接运行-ts推荐">方法三：使用<code>ts-node</code>直接运行 ts（推荐）<a class="hash-link" href="#方法三使用ts-node直接运行-ts推荐" title="标题的直接链接">​</a></h4><p>安装<code>ts-node</code>：<code>npm i ts-node -D</code>，然后运行<code>ts-node xx/xx.ts</code>即可。</p><p>值得注意的是，这种方法，可以兼容运行 js 脚本，即<code>ts-node xx/xx.js</code>也是可以没毛病的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="eslint-prettier-配置">eslint-prettier 配置<a class="hash-link" href="#eslint-prettier-配置" title="标题的直接链接">​</a></h2><p>首先参考：<a href="https://segmentfault.com/a/1190000014755172" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000014755172</a></p><p>全局安装</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> -g </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> eslint eslint-plugin-prettier eslint-config-prettier babel-eslint prettier eslint-plugin-html --save-dev</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="bugs">BUGS<a class="hash-link" href="#bugs" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="控制变量调试法xxx-is-not-a-constructor--without-new">【控制变量调试法】xxx is not a constructor + without new<a class="hash-link" href="#控制变量调试法xxx-is-not-a-constructor--without-new" title="标题的直接链接">​</a></h3><p>主要由以下几种矛盾。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="import-和-export">import 和 export<a class="hash-link" href="#import-和-export" title="标题的直接链接">​</a></h3><p>首先我有一个<code>bot.ts</code>脚本，它的导出方式为<code>export default Bot</code>。</p><p>我需要在<code>index.js</code>中导入<code>Bot</code>，采取<code>import Bot from './bot.ts'</code>的方式。</p><p>事后证明，这引来了很大的麻烦。</p><p>第一种变通方式，是改<code>import</code>为<code>require</code>，具体为<code>require('./bot.ts').default</code>。</p><p>这能够解决<code>import</code>和<code>export</code>之间的对应关系。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="es6-和-es5">es6 和 es5<a class="hash-link" href="#es6-和-es5" title="标题的直接链接">​</a></h3><p>但还有另外一个问题，因为该<code>bot.ts</code>脚本中使用了多个<code>class</code>与多个<code>new</code>，这导致编译产生问题。</p><p>对于这个的解决方式，是新建<code>tsconfig.json</code>配置文件，输入以下：</p><div class="language-json codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-json codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"compilerOptions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"target"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"ES6"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在没有该配置文件的情况下，<code>ts</code>默认编译成了<code>es5</code>的代码，其中的<code>call</code>函数将产生错误。</p><p>而基于<code>es6</code>的转换，<code>class</code>的操作便正常无误。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ts-和-js">ts 和 js<a class="hash-link" href="#ts-和-js" title="标题的直接链接">​</a></h3><p>此外，再配置了 es6 的转换后，我转念一想，毕竟都要转换，因此就不显式地导入<code>ts</code>了，转而直接导入<code>js</code>，代码重新改为<code>import Bot from './bot'</code>。</p><p>完全可行。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ts2792could-find-module-xxx">TS2792：could find module xxx<a class="hash-link" href="#ts2792could-find-module-xxx" title="标题的直接链接">​</a></h3><p>基于以上三点改进后，脚本可以正常运行，但是 IDE 对于两个<code>import</code>语句有红色报警提示，说找不到。</p><p>我试过了，如果把编译目标改为<code>ES5</code>就没有问题，但是那样脚本就没法运行了。所以索性就不理了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结">总结<a class="hash-link" href="#总结" title="标题的直接链接">​</a></h3><p>这次的解决方案，总体来说比较满意，但仍不是完美。</p><p>我知道这就是 ts 到 js 和 es6 到 es5 的一些编译问题，但确实过于复杂与细节，我在有限的时间内暂时只能想出这样的方案。</p><p>具体如下：</p><ol><li>按照正常的 ts 书写方式书写 ts 文件</li><li>按照正常的导入导出方式书写导入导出（使用 import 和 export 而非 commonJS 的 require，没有必要）</li><li>配置<code>tsconfig.json</code>的编译目标为<code>ES6</code>（或以上）</li><li>记得开启 IDE 的自动编译 ts 文件的功能</li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="微信与-wechaty-二维码研究">微信与 Wechaty 二维码研究<a class="hash-link" href="#微信与-wechaty-二维码研究" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-1wechaty-本地有用户信息且有效">状态 1：wechaty 本地有用户信息且有效<a class="hash-link" href="#状态-1wechaty-本地有用户信息且有效" title="标题的直接链接">​</a></h3><p>有效是指该用户的本地缓存信息依旧有效，并且未被其他平台挤下线。</p><p>此时，wechaty 启动后不会产生二维码，<code>scan</code>事件不会被调用。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-2wechaty-本地无用户信息或无效">状态 2：wechaty 本地无用户信息或无效<a class="hash-link" href="#状态-2wechaty-本地无用户信息或无效" title="标题的直接链接">​</a></h3><p>此时，wechaty 启动后会产生<code>status=2</code>的二维码，<code>scan</code>事件持续监听。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="状态-3二维码被扫之后的状态">状态 3：二维码被扫之后的状态<a class="hash-link" href="#状态-3二维码被扫之后的状态" title="标题的直接链接">​</a></h3><p>当一个二维码被扫（即使没有登录）或自然过期之后，其他人扫描该二维码均会显示该二维码无效。</p><p>这种情况下，首先考虑服务器用户是否已经在线，如若在线，则不用扫描。</p><p>如若不在线，且是本人，则确认服务器是否在运行，是否是最新的二维码，如果均是，则服务器有问题。</p><p>如果不是本人，则需要以<strong>以新的用户标识重启服务器</strong>，因为服务器只有一个 token，只可供一位用户使用，相应地，也只能真正产生唯一的一个有效的二维码。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="对-wechaty-服务器前后端搭建的要求">对 wechaty 服务器前后端搭建的要求<a class="hash-link" href="#对-wechaty-服务器前后端搭建的要求" title="标题的直接链接">​</a></h3><p>在仅有一个 token 的情况下，基于以上的分析，我们的服务器至少需要实现以下一些功能。</p><p>首先是单用户的基本功能：<code>onScan | onLogin | onLogout | onMessage</code>。</p><p>这些完整包括了一个用户的所有生命周期。</p><p>我们首先要保证服务器后端传送出来的二维码信息与用户状态均是最新的，如若不是，也应该至少提供手动刷新最新状态的方式，比如浏览器内的 api 刷新。</p><p>其次考虑多用户共用 1 个 token 的情况。在这种情况下，首先考虑最复杂的一种状态，即服务器正在以 A 用户身份标识在运行，B 用户扫了一个二维码。</p><p>显然，B 用户的二维码是无效的，B 需要寻求新的二维码。</p><p>因此，对于前端来说，必须保证无论任何人在任何时候访问，都能得知最新的用户状态，主要是有无用户正在使用。</p><p>显然，B 用户应当无权停止 A 用户的使用，要想 A 用户下线，必须 A 用户自己主动挤下自己的账号（比较简单）或者提供前端退出自己账号的功能，这样就要涉及到了 cookie 或者 token 等操作。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="wechaty-bug">wechaty bug<a class="hash-link" href="#wechaty-bug" title="标题的直接链接">​</a></h3><p>当 wechaty 拿到一个 qrcode 之后，如果 A 用户扫码，但点击了取消，此时 wechaty 虽然捕捉到了扫码、取消的操作，但是它会立即再拿取一个 qrcode，这个时候问题就来了。</p><p>A 用户重新再扫之前取消确认的二维码，微信系统显示成功在 iPad 登录，然而 wechaty 服务器内直接就 miss 了这样的一个状态。</p><p>作为对比，若 A 用户此时退出该 iPad 登录状态，转而继续扫新的二维码，会发现成功登录之后能够捕捉 wechaty 的消息。</p><p>这里的微信设计是<strong>对于一张二维码，即使取消也可以重新扫描，即使已经登录也可以扫描，多次有效</strong>。</p><p>基于此 bug，对于前端的设计要求便是，一旦二维码经过扫描，则不应再出现，如果用户点击了取消，则再扫一张即可，如果重新扫描旧的二维码，将导致 wechaty 无法监控到登录状态的 bug 发生。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="前后端接口设计">前后端接口设计<a class="hash-link" href="#前后端接口设计" title="标题的直接链接">​</a></h2><p>可以考虑把主要的接口放在前端，因为 react 内基于 webpack 的文件引用方式不能超出项目范围，但我们的后端基于 node 是可以的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200920000052509.png" alt="image-20200920000052509" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="react-开发建议">React 开发建议<a class="hash-link" href="#react-开发建议" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="尽量避免组件重复渲染">尽量避免组件重复渲染<a class="hash-link" href="#尽量避免组件重复渲染" title="标题的直接链接">​</a></h3><p>在绝大多数情况下，基于<code>react hook</code>的组件设计，稍有不慎，就能造成巨量甚至死循环的重复渲染。</p><p>一种比较好的开发习惯，就是对于每个组件的开头都写一个<code>render log</code>，这样可以理清组件与组件之间的渲染传导关系，例如如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/picgo/image-20200921163126793.png" alt="image-20200921163126793" class="img_vXGZ"></p><p>尽管这段日志暴露出了十分多的问题，但是渲染的顺序都是很清晰的，并且可以非常方便地知道问题在哪，从来一个个解决问题。</p><p>我建议在开发期间持续保留这些组件入口渲染的打印，其他函数之类的可以视情况抉择。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[开发常用命令行]]></title>
            <link>https://markshawn2020.github.io/blog/文集/开发常用命令行</link>
            <guid>/文集/开发常用命令行</guid>
            <pubDate>Mon, 31 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[开发速查手册]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="github">Github<a class="hash-link" href="#github" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="仓库初始化根据码云修改">仓库初始化（根据码云修改）<a class="hash-link" href="#仓库初始化根据码云修改" title="标题的直接链接">​</a></h3><ol><li>Git global settings</li></ol><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config --global user.name </span><span class="token string" style="color:#e3116c">"&lt;用户名&gt;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config --global user.email </span><span class="token string" style="color:#e3116c">"&lt;邮箱&gt;"</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><code-group><code-block label="2. Create git repository?"><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> README.md // windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> README.md  // linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit -m </span><span class="token string" style="color:#e3116c">"&lt;提交的信息&gt;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> origin </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">仓库git地址</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -u origin master</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></code-block><code-block label="3. Existing repository?"><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> origin </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">仓库地址</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -u origin master</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></code-block><code-block label="4. remote origin already exists?"><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> remote set-url origin </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">new-repo-url</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push -u origin master</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></code-block></code-group><h3 class="anchor anchorWithStickyNavbar_rB0w" id="仓库提交与上传最常用">仓库提交与上传（最常用）<a class="hash-link" href="#仓库提交与上传最常用" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-m </span><span class="token string" style="color:#e3116c">"MESSAGE"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">-u origin master</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="配置-sublime-进行-commit-的方法">配置 sublime 进行 commit 的方法<a class="hash-link" href="#配置-sublime-进行-commit-的方法" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config --global core.editor “</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">tip</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> –wait –new-window”</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="仓库撤销提交">仓库撤销提交<a class="hash-link" href="#仓库撤销提交" title="标题的直接链接">​</a></h3><ol><li>从中转站撤销，常用于.gitignore 未配置好，直接 add -A 需要撤销的场景</li></ol><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> reset HEAD -- </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">FILE/FOLDER</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>从远程仓库撤销/删除，常用于已经提交到仓库需要删除的场景</li></ol><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf --cached </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FILE/FOLDER</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="linux">Linux<a class="hash-link" href="#linux" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="关于yum与python版本问题">关于<code>yum</code>与<code>python</code>版本问题<a class="hash-link" href="#关于yum与python版本问题" title="标题的直接链接">​</a></h3><p><code>yum</code>默认使用<code>python2</code>，在服务器上默认<code>/usr/bin/python</code>指向<code>python2</code>的某个包。</p><p>但我们可能会装<code>python3</code>，因此我们希望<code>yum</code>执行的时候依旧使用<code>python2</code>，但<code>python</code>默认指向<code>python3</code>。</p><p>首先，知道自己的系统里装了哪些<code>python</code>，以我为例，有<code>python2.7</code>和<code>python3.6</code>。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="更换python软链接">更换<code>python</code>软链接。<a class="hash-link" href="#更换python软链接" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f /usr/bin/python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -s /usr/bin/python3.6 /usr/bin/python</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="修改yum的默认python路径">修改<code>yum</code>的默认<code>python</code>路径<a class="hash-link" href="#修改yum的默认python路径" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /usr/bin/yum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修改第一行，改`python`为`python2`</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>还没完</strong>！！</p><p>还要修改一个包的默认<code>python</code>路径。</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">vi</span><span class="token plain"> /usr/libexec/urlgrabber-ext-down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修改第一行，改`python`为`python2`</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体可以参见：<a href="https://blog.51cto.com/welcomeweb/2132654" target="_blank" rel="noopener noreferrer">CentOS7 修复 python 拯救 yum-新人一个-51CTO 博客</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="address-already-in-use">address already in use<a class="hash-link" href="#address-already-in-use" title="标题的直接链接">​</a></h3><ul><li><a href="https://blog.csdn.net/classabcd/article/details/98625178" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/classabcd/article/details/98625178</a></li></ul><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -apn </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${端口号}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${端口号}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -9 </span><span class="token variable" style="color:#36acaa">${进程号}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="javascript">JavaScript<a class="hash-link" href="#javascript" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="npm">npm<a class="hash-link" href="#npm" title="标题的直接链接">​</a></h3><p>查看包并设置包：<a href="https://www.cnblogs.com/sghy/p/6840925.html" target="_blank" rel="noopener noreferrer">设置 npm 的 registry - 枫叶布 - 博客园</a></p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> get registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> config </span><span class="token builtin class-name">set</span><span class="token plain"> registry https://registry.npm.taobao.org</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下载阿里的 cnpm：<a href="https://developer.aliyun.com/mirror/npm" target="_blank" rel="noopener noreferrer">NPM 镜像-NPM 下载地址-NPM 安装教程-阿里巴巴开源镜像站</a></p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g cnpm --registry</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://registry.npm.taobao.org</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>计算机与软件</category>
        </item>
        <item>
            <title><![CDATA[谨以此文，纪念我在大学的这四年]]></title>
            <link>https://markshawn2020.github.io/blog/my_university</link>
            <guid>my_university</guid>
            <pubDate>Mon, 31 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[来的时候觉得她对不起自己]]></description>
            <content:encoded><![CDATA[<blockquote><p>来的时候觉得她对不起自己</p><p>走的时候觉得自己对不起她</p><p>以后可以骑车 甚至可以开车去想去的地方</p><p>未来会有无边无际的世界可以探索</p><p>但也吃不到桑果梅子 吹不到山里的风</p><p>一旦踏上了归途 就不能选择再出发</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="行文契机">行文契机<a class="hash-link" href="#行文契机" title="标题的直接链接">​</a></h2><p>今天逛了奥林匹克森林公园，公园很大，有绵长的塑胶跑道适合跑步，也有偌大的旷地、无限的风光适合亲子聚餐。</p><p>鉴于这太阳盛情难却，我们早早败下阵来，只逛了一半便逃之夭夭。</p><p>地铁上，我如往常一样听着网易云的日推，闭目凝神，只任思绪飞舞。</p><p>眼前有一位捧着不知名书目在读的男生，斜对面则有一位带着审视目光的老头，侧处还有一位发型十分 fashion 的潮 girl。</p><p>每个人都有每个人的精彩，每个人都有他/她自己的想法，而这世界，也许正是因着每个人的不同而美美与共。</p><p>我不是什么名人，也没有足够让别人称奇的故事，但这似乎不能成为我选择沉默的理由。</p><p>毕竟，这匆匆四年，学习、科研、社团、竞赛、恋爱、实习、考研，我好像都有过体验，虽然平淡倒不至于贫瘠，或可一谈。</p><p>至少，我也希望知道，我自己，是如何审视自己的人生的。认真的那种，否则没有任何意义。</p><p>所以，值此毕业之际，谨以此文，纪念我在大学的这四年。</p><p>更具体地，·它的名字，叫做：南京审计大学，一所双非院校。</p><p>而我的名字，南川。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于时间">关于时间<a class="hash-link" href="#关于时间" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630091052452.png" alt="image-20200630091052452" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630091102923.png" alt="image-20200630091102923" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="你的时间很值钱">你的时间很值钱<a class="hash-link" href="#你的时间很值钱" title="标题的直接链接">​</a></h3><p><strong>必须承认的是，时间过得非常快。</strong></p><p>即使刚入校门的自己，觉得四年还不知如何去奔赴的自己，觉得自己还年轻的自己，也不得不在毕业回首之际，感叹一句：<strong>我们终于走到了尽头，仿佛一场梦</strong>。</p><p>大部分人应该都是明白时间的宝贵的，但很少有人能够清晰地感受到时间的流逝，并有组织地规划自己的时间，尤其是对于新生而言。</p><p>如果你也有这方面的疑惑，可以去看看考研的学长学姐，看看他们是如何对待自己的时间的。</p><p>我印象中，可能是 13 或者 14 级的一位学长，他曾经拿过学校里每一届的长跑冠军，并顺利考研进入川大。</p><p>但比起这些，让我印象更深刻的是，他每天晚上在润操跑完步之后，是继续跑着回去的，这点与很多锻炼的朋友不一样。</p><p>当然了，也许是因为他的身体机能确实很好，所以在训练完之后依旧有力气跑回去。</p><p>但对于我而言，我的第一反应则是这能省下多少时间啊。</p><p>我的身体机能可没有学长这么好，但我也深切地感受到，校园这么大（因为山坡多，也不给骑车），走路实在是太奢侈了，所以大多数情况我也会选择跑步，或者竞走。</p><p>所以我想说的第一点就是：<strong>你的时间很值钱，如果有可能，请充分利用你的时间</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="减少娱乐生活">减少娱乐生活<a class="hash-link" href="#减少娱乐生活" title="标题的直接链接">​</a></h3><p>接下来，则是谈时间的利用，时间的密度，或者说时间的价值。</p><p>从时间的长度来看，这个世界人人平等。</p><p>但<strong>不同的职业，不同的身份，时间的密度是完全不一样的</strong>。</p><p>你的 24 小时，和运动员的 24 小时，和投行精英的 24 小时，真地完全不一样。</p><p>但时间毕竟是抽象的东西，所以我更喜欢用实际发生的事情去衡量。</p><p>如果你做不到上一条“尽量在校园里奔跑”，毕竟听起来有一些 Crazy。</p><p>那就<strong>尽量别玩游戏，尽量别追剧追星，尤其是一个人的时候</strong>。</p><p>你大可有一万个理由去 diss 这一条，说：那我的娱乐生活怎么办？</p><p>是的，很多人抱着上了大学就轻松了的想法来到大学，事实上他们很快就会碰壁，包括我。</p><p>我应该比很多人的想法更荒诞，以至于认为作业都是不用做的。</p><p>所以我从高中数学多次全校第一，沦落到大学数学多次不及格，这点还望能引起你的注意。</p><p>知乎上有一个关于王者荣耀的回答，说“别玩王者，否则半年的时间就没了”，这真地是真的。</p><p>按我的观点，我们之所以留恋娱乐生活，无非是自己的精神世界得不到其他的填补而已。</p><p>这是当下时代的通病，也许不怪你，不怪我们，但我们依旧有选择说“不”的空间。</p><p>但我并不想在这点上扯皮太多，毕竟，<strong>我们无法叫醒一个装睡的人</strong>。</p><p>因此，在这点上，我倒倾向于<strong>鼓励大家大胆尝试，自己用血和泪去体悟</strong>。</p><p><strong>虽然，真的大可不必</strong>。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于规划">关于规划<a class="hash-link" href="#关于规划" title="标题的直接链接">​</a></h2><p>大多数人奉行有规划的人生，虽然也有一些人例外，并同样取得了很好的成绩。</p><p>但规划着实还是重要的。</p><p>退一步说，<strong>你可以不遵循你的计划，但你不能真地没有计划</strong>，或者说完全迷失。</p><p>接上，在“我的时间很重要，我要减少娱乐生活”的前提下，首当其冲的问题便是，“我该怎么组织我的时间？”。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="可能唯一一次考虑科研的机会">可能唯一一次考虑科研的机会<a class="hash-link" href="#可能唯一一次考虑科研的机会" title="标题的直接链接">​</a></h3><p>大学的时间，无非就是四年，除去考研、留学、找工作，实际只有前三年（甚至是前两年半）。</p><p>因此，前两年才是至关重要的，这两年里，<strong>你的 GPA、你的经历，将大致决定你接下来的轮廓</strong>。</p><p>在我所呆的双非院校里，科研氛围是很弱的，甚至有“双非无科研”的说法。</p><p>尽管如此，科研二字，还是得好好考虑一下，因为，<strong>在大学里面接触科研，可能是大多数人一辈子唯一一次的机会</strong>。</p><p>错过这次，进入职场，便再没有回头路了。所以，<strong>不妨多给自己一次选择的机会</strong>。</p><p>有很多老师在和我较为深入了解之后，觉得我适合科研的道路；有很多同学看我长发飘逸或凌乱，也直接盖上科研的帽子。</p><p>这些或许都是事实，但我只能说，<strong>我在这条路上确实有过尝试，但并不理想</strong>。</p><p>我在某个五一，和我的老师说：这周我就睡您办公室了，不出一篇论文不离开。</p><p>可不凑巧的是，老师的待研究论文列表里，我最想做的一篇已经被发表了。于是，兴致大减。</p><p>即使是我自己也很感兴趣的毕业论文，由于各种实习、比赛的时间占用，也最后只花一周时间匆忙完成。</p><p>就这样，随着大学的落幕，科研的热情也随之落幕。</p><p>细想想，<strong>平台、心境，尤其是后者，对于科研来说实在太奢侈了</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="永远不要低估绩点的重要性">永远不要低估绩点的重要性<a class="hash-link" href="#永远不要低估绩点的重要性" title="标题的直接链接">​</a></h3><p>如果抛开科研这朵白月光不谈，那么自然而然时间的重担就交到了绩点上。</p><p>在这里，我邀请了一位年年拿国奖的朋友，汇总了一下他/她四年单纯从高绩点上获得的收获。</p><p>首先是奖学金（奖学金直接可以 cover 四年生活费）：审计长奖学金、校长奖学金、校综合一等奖学金、会计学院天健奖学金、大学生年度人物……</p><p>其次是一些交换、实习机会（某些必须要有高绩点才能申请）：江苏省政府奖学金赴英国伦敦政治经济学院与曼彻斯特大学交流访学、pwc 审计实习……</p><p>然后是一些团队比赛（因为优秀的队友也信任自己的能力）：中国 MPAcc 学生案例分析大赛、数学建模国际赛、全国大学生英语能力竞赛、江苏省高等数学竞赛……</p><p>我之前推过一位考研上岸的朋友，他就写了自己考虑到了大学里大多数人都不会认真学习，所以弯道超车的故事。</p><p>不过，不是所有的新生都能意识到，在大学里好好学习能给自己带来这么大的优势。</p><p>但在这里，我更想指向的是另一群人：<strong>他们都知道自己要好好学习，并希望拿到一个好名次</strong>。</p><p>这样的人，在顶尖院校更为常见，并<strong>往往引发内卷的竞争</strong>。</p><p>比如曾有复旦的朋友和我说自己一个学期都没出过一次学校。此外，当年清华大学学霸姐妹花马冬晗的作息表也一度引起热议。</p><p>如果你不幸也在这样的一个环境中，也许，你确实需要认真考虑一下自己是否值得参与如此激烈的竞争。</p><p><strong>但更多时候，我们，别无选择。</strong></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于-peer-pressure">关于 Peer Pressure<a class="hash-link" href="#关于-peer-pressure" title="标题的直接链接">​</a></h2><p>我们不得不承认，<strong>同业压力是我们压力的首要来源</strong>。</p><p>近些年来，高校的抑郁症故事频繁进入人们的眼帘，这不得不引起我们的重视。</p><p>拿我自己来说，我也是较为悲观主义的一个人，好在我有自己的一套世界观，能够给很多问题找到一个出口。</p><p>那就是，<strong>我经常不去想为什么会发生一些事，而把它们归结为命运的一部分</strong>。</p><p>我承认有点鸵鸟主义，但确实帮助我减少了很多困扰与不必要的麻烦。</p><p>但另外一些人就不这么幸运了，因为他们可能没有建立从内到外的自信心。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="你自信的来源是什么">你自信的来源是什么？<a class="hash-link" href="#你自信的来源是什么" title="标题的直接链接">​</a></h3><p>之前我在四大实习的时候，有一个同事，一个很要强的女孩子。我和她探讨到关于项目和自信的话题。</p><p>她说她在大学的时候，是<strong>通过完成一个个项目建立起自信心的，因此同样需要完成这个项目进一步巩固自己的自信心</strong>。</p><p>而我则一直强调，<strong>只有真正的自信，才能把这个项目做好</strong>。她的因果关系反了。</p><p>我们当时讨论的很激烈，具体也不记得讨论到什么地步了。</p><p>但现在想想，她好像也没有错，她更务实不是吗？</p><p>她没有妄谈自己的能力，而是<strong>陈述了完成一个项目则会增强自己自信心这样的一个事实</strong>。</p><p>而我却侧重于自信才能成功、相信才会看见，这样宏大的一种命题。<strong>忽视了自信也是由过去的经历构建的</strong>。</p><p>拿我自己来说，我的自信主要来源于以下几个方面：</p><ul><li><p>首先是小时候真地不用学数学就能取得非常好的成绩。比如五年级的时候替六年级的参加竞赛，高中的时候总能在课上提出两种解决方法，并经常以普通班的身份考到全校第一名。</p></li><li><p>其次是在大学的时候，并不羡慕别的 985 学子。因为自己曾经也在 985 里呆过，并且还经常能与一些 985 的同学 pk，在各类竞赛排名上偶尔能看到自己的名字。</p></li><li><p>最后是在解决一些问题的时候，我的思维速度能够很快。我的编程能力也是自学的，能够在很短的时间掌握一门新的编程语言，并且顺利做出一些小东西。</p></li></ul><p>在这里，我并不是强调自己有多么的牛逼，任何一项你都可以找到更优秀的人，比如拿到 IMO 金牌的人。</p><p>但你不得不承认，<strong>如果在与这些同辈相比的过程中，你获得了一定相对优势，并不断建立自己的自信心，最终你将成为一个具有较高竞争力的人</strong>，而不是一个积极废材，这点很重要。</p><p><strong>一个双非院校出身，但是自信且有能力的人也能申请到世界顶尖名校的研究生或者一流企业的高薪职位</strong>，虽然罕见，但足以证明我的观点。</p><p>所以，<strong>多想想自己自信的来源，努力变成一个自信的人，将帮助你较好地应对 Peer Pressure</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="压力转换为动力势力">压力转换为动力、势力<a class="hash-link" href="#压力转换为动力势力" title="标题的直接链接">​</a></h3><p>在逐渐构建自己自信心的征途上，还可以尝试将压力转换为动力，或者更牛逼的，转换为势力的方法。</p><p>所谓动力，既是以这些优秀的同辈为目标，奋起直追，努力超越他们。</p><p>就拿考研来说，有些人由于基础比较好，经常在朋友圈发自己每次模拟卷 130+的成绩。</p><p>那就以他们为目标，争取能达到他们的 90%，甚至 110%。</p><p>当然，前提是要自信，如果自己都不相信自己有那个实力，那这条就不适合自己了。</p><p>转换为势力其实就是援结的意思。和他们做朋友，争取优势资源共享，或者自建优势资源平台，吸引他们来分享。</p><p>前者做起来比较简单，蹭笔记就是。</p><p>后者属于商业战略的一种，像我就会建立一个 QQ 群，先自己放一些优质的资料，等学霸再放一些更优秀的资料，这样目标就达到了。</p><p>听起来有点不齿，实际上不是的，很多学霸也是想要分享自己的资源、智慧的，我们并没有做什么损人利己的事情，互帮互助有什么不好。</p><p>总之，办法总比困难多。只要多尝试，<strong>从内接受同业压力的存在并相信自己可以战胜它，从外付出实践努力向优秀的人靠齐</strong>，这些就都不是问题。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于原生家庭">关于原生家庭<a class="hash-link" href="#关于原生家庭" title="标题的直接链接">​</a></h2><p>这是一个沉重的话题，但我们不得不面对，毕竟，它还不是最沉重。</p><p>在上一节，我们刚刚谈了同业压力，并给出了几种解决方案：建立自信心、化压力为动力、善于援结力量。</p><p>其实个人觉得，很多人第一步可能难以完成，而在这一部分人里，又有绝大一部分人是出于原生家庭的原因。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="绕不开的阶层固化">绕不开的阶层固化<a class="hash-link" href="#绕不开的阶层固化" title="标题的直接链接">​</a></h3><p>这是一个十分悲伤的事实，对于大部分人来说，无论是家庭还是企业。</p><p>从贫富差距来看，这个结论是显而易见的。</p><p>从企业角度，看近几十年企业集中度的变化也会得到相似的结论。</p><p>如今的中小公司，纷纷站队 BAT，或者说 ATMD。给中小公司突围的机会非常少，因为资本市场从一片荒芜快速走向了成熟。</p><p>从项目的出身开始，就被早起的风险投资盯上，紧接着是 PE、FA、IPO 等团队。每一个环节都有可能被收编到更大的公司队伍下（否则被打压死掉），从而失去挑战现有格局的可能。</p><p>而对于培养孩子的竞争，则更加残酷。</p><p>2020 年 5 月量子基金联合创始人罗杰斯带着自己的女儿进驻 B 站，目前她们正在新加坡学习中文，而目的说的很直接，就是为了中国市场。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/parse_image-20200630132023353.jpg" class="img_vXGZ"></p><p>所以，很多人的起点，就已经是大多数人穷其一生，也不能抵达的终点。</p><p>但，尽管如此，这也不能成为我们放弃奋斗的理由。</p><p>如果你真这么想，那你应该是找错了靶子。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="与更大的圈子相比">与更大的圈子相比<a class="hash-link" href="#与更大的圈子相比" title="标题的直接链接">​</a></h3><p>我挺喜欢一句调侃的：“<strong>我是我们村最靓的仔！</strong>”</p><p>我认为，这句话的水平相当之高，因为它不但狠狠地夸了一下自己，还准确地表达了其范围：我们村。</p><p>虽然这个“村”是个借喻，但我们不妨真地从一个“村”出发，去思考一下如何将“与更大的圈子相比”用于对抗原生家庭、Peer Pressure 此类话题。</p><p>日漫里有太多这样的故事，我们随手 pick 几个：灌篮高手、火影忍者等等。</p><p>在灌篮高手里的主角樱木花道的成长，就是一个典型的不断“与更大的圈子相比”的故事。开始是练习赛，接着是县赛，再到全国联赛。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/9996945_161302097000_2.jpg" alt="查看源图像" class="img_vXGZ"></p><p>不过这样的圈子比较还不够有说服力，不太具有实际指导价值。</p><p>目前现实生活中，还有一类人，面对着更大的压力，那就是<strong>从农村慢慢考上名校的学生</strong>。</p><p>他们，是一个村的佼佼者，顶着无限可能的光环；但在名校里，却可能是一个默默无闻的学渣，或者被别人从出生已经一路建立的优势壁垒所击溃，或者为别人没有经受和自己同样痛苦的高中而感到落寞。</p><p>因而对于他们，选择与哪个圈子相比，就至关重要。</p><p>但就我而言，我认为问题的关键不在于选择哪个圈子，不是说<strong>选择哪个圈子心理就平衡了于是就选择那个圈子，这是不行的</strong>。</p><p>我认为我们应一步步不断选择那个更大的圈子，循序渐进，直到站上更大的舞台。</p><p>就像刘媛媛在超级演说家中所说：“<strong>命运给你一个比别人低的起点，是想告诉你，让你用你的一生，去奋斗出一个绝地反击的故事。</strong>“</p><p>这样一个奋斗的过程，无论结果，其本身就意义非凡。</p><p>但，我们也必须铭记，<strong>与别人相比，是没有尽头的，能赢自己的，应该只有自己</strong>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="能赢我的只有我自己">能赢我的只有我自己<a class="hash-link" href="#能赢我的只有我自己" title="标题的直接链接">​</a></h3><p>在热血动漫《黑子的篮球》里，王牌得分手青峰大辉有一句台词“<strong>能赢我的只有我自己</strong>”，听起来很霸气。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/OIP.kQM1w7Xvp-VLJeNWs78KbwHaEo" alt="查看源图像" class="img_vXGZ"></p><p>但转念一想，这句话难道只适用于天才吗？</p><p>“赢”的定义究竟是什么呢？</p><p>在篮球的世界里，每一场比赛都会有输赢，但是在人生的旅途上，并不存在如此非黑即白的定义。</p><p><strong>成长，是一个多目标优化的过程，它不存在一个唯一的目标</strong>，如果有，那我觉得一定是对幸福的衡量：<strong>每一个人都为自己过得更幸福而奋斗着</strong>。</p><p>我参加过各类比赛，商业分析的、模拟炒股的、数学建模的、创新创业的、学术研究的、英文展示的，等等等等。</p><p>于是，我经常会碰到一场比赛“输了”或者“赢了”的局面，但我很少会简单定义自己这场比赛“赢”了，或者“输“了。</p><p>真地，我只会去想：<strong>我这次比赛获得了怎样的成长，或者教训？</strong>Always。</p><p>了解我的人都知道，我还经历过一次非常不愉快的比赛，因为被一个不把自己当朋友的朋友中伤，背后捅了刀子。</p><p>为此，我还专门写了檄文。</p><p>但即便是当时（更不用说现在），我也得说，那场比赛让我成长了很多，至少让我们明白 <strong>我们真地要不惮以最坏的恶意去揣度他人</strong>。</p><p>这点在日益激烈的商业竞争、政治竞争中尤其重要。</p><p>就像复旦陈果教授说的，“<strong>在相信之前，要严格地怀疑</strong>”，“<strong>一旦你是我认定的朋友，我就毫无保留地相信你</strong>”。</p><p>所以，我释怀了。</p><p>无论是一次次比赛，还是更大的我们的人生旅程，<strong>与自己相比，问自己有没有收获、有没有进步，应该是第一要义</strong>。</p><p>从这个角度来说，这也是我不建议大家玩一些 Moba 类游戏的原因，每一场游戏打完，只是对地图、对操作更熟悉了一些而已，<strong>边际收益真地太低了</strong>。</p><p>我前前后后花了大概有三年的时间在两款 Moba 游戏上：英雄联盟和王者荣耀。诚实地说，<strong>我没觉得自己的幸福感提高了多少</strong>，尽管自己的段位不低，也因为这些游戏与一些朋友的关系还不错。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于实习">关于实习<a class="hash-link" href="#关于实习" title="标题的直接链接">​</a></h2><blockquote><p>『在中国大学的层级分布中，不同级别的大学，学生的去向对应着不同的城市。</p><p>顶级大学对应的是全球最好的城市，重点大学对应的是一线城市、省会城市，一般大学对应的是中小城市、乡镇甚至乡村。</p><p>一层层、一级级，像磁铁吸附着各自的隐秘方阵，干脆利落，并无多少意外发生。』</p><p>——《看不见的二本学生》，教师黄灯</p></blockquote><p>这是更为严肃的一个话题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="双非的就业形势">双非的就业形势<a class="hash-link" href="#双非的就业形势" title="标题的直接链接">​</a></h3><p>不容乐观。</p><p>虽然很多院校在招生季都会爆出非常好的成绩：<strong>高就业率、高升学率</strong>（当然，也包括我所在的这所）。</p><p>相较于 985 院校，双非院校面临的压力则会更大，水分也更大。</p><p>大家都想去最好的公司、最好的学校，但在就业、升学匹配上，<strong>头部效应非常明显</strong>，最好的那些地方几乎能有 80%的学生盯着。</p><p>以我之前所在的一家实习单位为例。</p><p>首先，作为一家头部 FA，吸引着来自清北复交等顶尖院校众多商科学生的目光，<strong>供是远大于求的</strong>，HR 光是从这些院校中筛选一些优质学生还来不及。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630163033090.png" alt="某HR系统实况截图" class="img_vXGZ"></p><p>此外，在考察项目时，大多数优质项目的创始人背景也都来自于清北复交等顶尖名校，这点也是很符合 common sense 的。而作为 FA 机构，经常就要去和这些项目的创始人聊，谈谈他们项目的情况。</p><p>这个时候，如果你的身份只是一个不知名院校，也没有极其说服力的履历，是很难不在谈项目时发怵的。甚至，根本就没有谈判的机会。简而言之：不够格。</p><p>再来一张图，当我的简历投向某券商研究所时：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630160429475.png" alt="某投行研究所双非简历遭拒" class="img_vXGZ"></p><p>其实，大家都知道，券商研究所的大部分工作内容，是通宵达旦的撰写研究报告。</p><p>我们不否认 985 学校的同学会比双非同学的专业水平更高一些，但论能力，还真不一定。</p><p>但我们也理解，企业所冒的风险、所投入的产出势必会更低，<strong>一些头部企业完全没有必要将就非头部院校的学生</strong>。</p><p>“<strong>如果你觉得自己真地有实力，那就考个研啊，考完研再来投我们公司</strong>。”你也无法反驳。</p><p>不过，至于李国庆曾在节目里爆出的“<strong>我们只看第一学历</strong>”的言论，我们只能回一句：“傻逼！”</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="如何杀入-big-name">如何杀入 Big Name<a class="hash-link" href="#如何杀入-big-name" title="标题的直接链接">​</a></h3><p>尽管双非的就业形势不容乐观，这个是从整体来看的，而且是指相较于全体大学生（准确地说，是相对于 985 学生）。</p><p>但万物皆有例外，只要自己足够强（或者如前文所说：自信），并且方向明确、履历丰富、能力可以，还是可以有一骑绝尘的机会。</p><p>之前，我和某头部量化公司的 HR 聊到相关的问题，在此简单记录一下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630165200898.png" alt="image-20200630165200898" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630165233862.png" alt="image-20200630165233862" class="img_vXGZ"></p><p>可以看到，学校门槛确实是大公司考虑人才的一个重要因素，尤其是其官方的申请系统。</p><p>但除了官申之外，大家还可以<strong>走内推（如果 social 能力较强）</strong>，或者通过<strong>混脸熟（如果脸皮够厚）</strong>。</p><p>我曾经就有结合后两种方式，得到了一个很想要的岗位的笔试机会，否则就是真地石沉大海了。</p><p>尽管如此，我个人不建议通过混脸熟方式，<strong>提升自己的水平才是硬道理</strong>。</p><p>除了以上的这两点小技巧之外，如身边很多进入四大的朋友一样，早早地做准备，<strong>参加一些中介的培训营（如果不缺钱，完全推荐）</strong>，以及<strong>打一些目标公司的商业比赛（如果实操能力强，这个最推荐）</strong>，还是能很大概率提高杀入 Big Name 的机会的。</p><p>最后，越是 Top 的企业，对于我们这种双非院校来说，履历就越重要，所以，<strong>专门准备一份对口的简历</strong>也是很重要的。</p><p>例如，以下是某位 17 级学弟的简历，仅供参考。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630171230016.png" alt="image-20200630171230016" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="认真定位自己">认真定位自己<a class="hash-link" href="#认真定位自己" title="标题的直接链接">​</a></h3><p>尽管我较为详细地讲解了一些如何杀入 Big Name 的经验与建议，我也<strong>并不推荐这作为所有大学生的目标</strong>，无论你是新生还是即将毕业。</p><p>这首先是因为当下的时代环境正在产生一些微妙的变化，就业已经不再是评判一个人最重要的参考指标。有很多人一辈子也没有打过一次工，并且活的还非常不错（例如：最强大脑王昱珩）。也有很多高校大学生毕业（甚至在校期间）创业，逐步实现自己的财富自由（我们学校也有一些）。</p><p>当然了，有能力拒绝打工并不至于坠入啃老族队伍的人毕竟还是凤毛麟角，通过创业实现选择说“不”的权利的人也屈指可数，因此大多数人可能需要考虑另外一个更现实的问题，尤其对于双非学子来说：<strong>你真地非“好”公司不可吗？</strong></p><p>这里我给“好”公司加了一个引号，因为对于大多数人来说，好应该是指薪资高，比如一些光鲜亮丽的头部企业的核心岗位。</p><p>我们不得不面对的现实是：<strong>大多数人不得不因为各种原因，降低姿态，去一些二三线城市，从事一些薪资不是那么高的工作</strong>。</p><p>这些人中，有一部分人还是值得肯定的，他们认清自己的能力，摆正自己的姿态，选择一些生活成本较低但工作薪资尚可的地方。</p><p>这些人中，有一部分人更是值得鼓励的，他们奔向了遥远的大西北、大东北等，真真正正有带着一腔热血准确做一番贡献。</p><p>当然了，还有一些，大家各自都有不同的想法，出于不同的考虑，我对他们唯一的担忧（也是对我自己最大的担忧），就是<strong>不要不甘</strong>。</p><p>在经济学里，如果每个就业岗位上的人的心理预期是满足的，那其实就已经达到了整个社会的一个最优资源配置。</p><p><strong>如果你不是一个非常有雄心的人，适当地妥协其实是有利的。</strong></p><p>总之，<strong>我们需要认真定位自己，想好自己真地想干什么、适合干什么</strong>，这两点非常重要。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于考研">关于考研<a class="hash-link" href="#关于考研" title="标题的直接链接">​</a></h2><p>虽然，我并不为自己考研失败的事情有多难过，但我还是比较在意向身边的人公布这条消息的时机。</p><p>直到今天，2020 年 6 月 30 日，六月的最后一天，我觉得是时候做个了断了。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="我考研失败了">我考研失败了<a class="hash-link" href="#我考研失败了" title="标题的直接链接">​</a></h3><p>我，一个双非院校的金融专业，在考研的最后三个月，105 天，每天学习 17 个小时，冲刺清华大学的计算机专业。</p><p>最后由于大学数学的基础不扎实，数学爆炸（选择题连错五题，史上模拟最低），总分相差几分，未能进入复试。</p><p>后续申请清华大学深圳研究院的调剂，全线挂掉。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630173856123.png" alt="image-20200630173856123" class="img_vXGZ"></p><p>一路走来，也许是因为考研的那段日子有舍友+研友的陪伴，也有大学三年的温情，所以并不觉得多么孤单。</p><p>而且事实上，我的总分（过了清华大学的校线）与专业分（跨考零基础，分数还行），已经超出了自己的预期，所以并不觉得这三个月的初试备考与后续五个月的等待是竹篮打水一场空。</p><p>相反，它为我的学习能力注入了一针强心剂，让我有着对新一年的期许，以及克服其他困难的勇气与信心。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="考研失败不等于人生失败">考研失败不等于人生失败<a class="hash-link" href="#考研失败不等于人生失败" title="标题的直接链接">​</a></h3><p>从五月份开始，我陆续收到了一些朋友考研通过的好消息，我打心眼里为他们感到开心。</p><p>其中，很多还是我一致看好的朋友，他们中的很多人和我共事过社团、打过比赛或是吃过午餐。</p><p>他们的成功也鼓励着我，<strong>不允许自己被自己打败</strong>。</p><p>于是，借此机会，我也开始不断地去了解各位上岸的朋友，将他们的故事、经验整理出来，以供别人和我自己去学习、去领悟。</p><p>但同时，我们也不得警惕地注意到，现在的本科生文凭已经很难支撑地其一位大学生的职业竞争力，高等教育领域的整体水平也逐渐从人均本科向人均研究生看齐。</p><p>未来几年之内，恐怕只会愈演愈烈。</p><p>此外，我们的目光，也不应仅停留在那些成功上岸的朋友身上。因为还有更多的朋友，像我一样，在这样残酷的竞争中滑到，但他们同样有着或许可爱、或许坚毅的信仰。</p><p>我的公众号后期也会推出一些相关朋友的经历，<strong>考研失败不等于人生失败</strong>。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于毕业">关于毕业<a class="hash-link" href="#关于毕业" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="错过的毕业合照">错过的毕业合照<a class="hash-link" href="#错过的毕业合照" title="标题的直接链接">​</a></h3><p>我曾想过我毕业时的情景。</p><p>那应该是一些个明媚或者燥热的下午，在路上不断遇到我们曾经熟识或者只有几面之缘的同学，道一声“你好啊，毕业快乐！”和三两朋友一起拍个合照，或是撸个串。再或者，疯狂点，如若可能，在最后的那一天，我们狂欢、我们喊楼、我们抱着电线杆痛哭流泪。</p><p>于我来说，遗憾地是，由于疫情，由于我在北京，一个中风险地区，不能返校。</p><p>（细想想，除了这次大学毕业合照，六年级的小学毕业合照，我因为数学竞赛培训也未能参与。再想想，在一次南京开往上海的列车上，我收到了次日华为南京的面试通知，仿佛晴天霹雳，却也无奈屈从了，头也未回。）</p><p>不过即便是那些返校的同学，由于批次的限制，也难以尽兴。</p><p>但我又想起了复旦陈果老师对于毕业的理解：“我们复旦的同学不应该如此。因为真正的告别，似乎应该有更多的纪念，似乎应该有更多的怀想，似乎应该有更多回味的空间。”</p><p>于是，这个毕业季，我待在北京的出租房内，静默地度过，联想到这些仿佛还带有一丝诗意，所以并不怎么难过。</p><p>我在朋友圈里为每一张用心的合照点赞，我也在我自己的脑海里，不断思考不断反刍，毕业于我的意义。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="毕业的意义">毕业的意义<a class="hash-link" href="#毕业的意义" title="标题的直接链接">​</a></h3><p>今年的毕业典礼改为线上直播，在某一日的早上九点半，而我却一觉睡到十二点。</p><p>（与之相近的，还有错过的开学的英语分级考试。如果不是因为这个，我或许便是一名 CFAer，而非 EFITer，尽管我并不清楚这两种选择对我的人生会有多大的影响，也不想思考因为没有意义。毕竟，墨迹已干。）</p><p>也许这就是我，对很多事情提不起兴趣，尤其是与这个世界的规则相关。</p><p>但这也是我，对很多事情报以极大的热情，在短时间内想把它们完美地实现。</p><p>所以与其思考毕业对于我来说，究竟意味着什么，好比因为发生了毕业这件事，所以我的人生要做一些反应。</p><p>倒不如换个角度，<strong>在我宏大的人生旅途中，为这个时间节点标记了一个标签：我毕业了</strong>！</p><p>仅此而已。</p><p><strong>毕竟，毕业是大家的；但人生，始终是自己的。</strong></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><p>写到这里，顿然发现接近万字。</p><p>事实上，作为一封毕业总结，我想 cover 的话题还有很多，比如竞赛，比如恋爱，比如社团，等等等等。</p><p>但这些，作为充实大学生活的一部分，每个人都有每个人的精彩，我实在不想先入为主，过多地代入我的色彩。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="一点为校争光的小时刻">一点为校争光的小时刻<a class="hash-link" href="#一点为校争光的小时刻" title="标题的直接链接">​</a></h3><p>如果硬要说点什么，那就记录一件当时十分开心的事吧：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200630181342118.png" alt="image-20200630181342118" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/image-20200629233506596.png" alt="image-20200629233506596" class="img_vXGZ"></p><p>在这个我曾经连名字都难以说出口的学校里，我见过了最多的星星和月亮，也许，也不枉此行了吧。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大学是人生的实验室">大学是人生的实验室<a class="hash-link" href="#大学是人生的实验室" title="标题的直接链接">​</a></h3><blockquote><p>生活在一个有小山小湖，晚上地上的灯就像发光的蘑菇一样的美丽的学校。</p><p>而且水平也不错，有很多朋友，做过很多尝试。</p></blockquote><p>这是一位好友对我的评价。</p><p>但同时，他也补充到：“但是说句不太中听的。<strong>如果你本科在清华，可能你的生活不会有这么多精彩的尝试</strong>。”</p><p>我发现他提到了两遍“尝试”。这区别于大多数人对一个大学生的评价：<strong>如何地成功或者平庸</strong>。</p><p>毕竟，成功与否，平庸与否，那关系到结果；但尝试，却侧重于过程。</p><p>所以，我欣赏这位好友对我的评价，要深挖为什么，也许得提到我在大学期间看的一本书：《完美大学必修课——两个北大学生的四年》。</p><p>里面有段话，我一直记在心里：</p><blockquote><p><strong>大学是什么？</strong></p><p>作者回答：<strong>大学是人生的实验室</strong>。</p><p>在大学里你可以尝试一切心的东西，在大学里你可以犯错误而不会承担无法挽回的结果，在大学里你可以做人生的实验，最终弄清楚<strong>你想要什么，需要什么，适合什么，擅长什么</strong>。</p></blockquote><p>我还是很喜欢，也很感谢我的大学实验室的。</p><p>也感谢这个实验室里遇到的所有人。</p><p>真地，<strong>All of you</strong>.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/blogs/my-graduation/641" alt="查看源图像" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="不忘初心不忘热血不忘前行">不忘初心，不忘热血，不忘前行<a class="hash-link" href="#不忘初心不忘热血不忘前行" title="标题的直接链接">​</a></h3><p>最后，不忘初心，不忘热血，不忘前行。</p><p>音乐：《世界が終るまでは》</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="关于作者">关于作者<a class="hash-link" href="#关于作者" title="标题的直接链接">​</a></h2><p>四年荏苒，最大的遗憾可能是没有好好学习，书面成绩十分一般。</p><p>体验过一次考研，两次恋爱，三年社团，四五段实习，各个领域的多次竞赛，但从无大奖。</p><p>这大概就是我，听来真地挺普通，也挺无趣。</p><p>但不后悔。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="参考资料">参考资料<a class="hash-link" href="#参考资料" title="标题的直接链接">​</a></h2><ul><li><a href="https://mp.weixin.qq.com/s?subscene=23&amp;__biz=MzIwNzM2MjA4OA==&amp;mid=2247520525&amp;idx=1&amp;sn=003809dc2208592a80d10e6da8688242&amp;chksm=9711504aa066d95c07db21d652cb1ff5093fb0169f7293633abdb650cdd45a31dafd315abd01&amp;scene=7&amp;key=b251233686787f708b77fa4c1c64fb9293439487c3288bdabf60b5161f915c8d52369e178200f038dfe37934301ab46e758ea4e038fa3335212da05c8233b689374393108b6925adbecb592d4cae79d9&amp;ascene=0&amp;uin=MTIyMzg1NDgyMQ%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=AxXyrccfY32seYF0V9Uv%2Frw%3D&amp;pass_ticket=PPQc2Mz8lJ%2F%2Fo6XNQUUcnrwYyAOp6HTKoMHwTpUWggHf9Ql2R3a5UCdV9hP7%2Bd3i" target="_blank" rel="noopener noreferrer">看不见的二本学校学生</a></li><li><a href="https://mp.weixin.qq.com/s?subscene=23&amp;__biz=MzAxMzUwNjMwOQ==&amp;mid=2649586901&amp;idx=1&amp;sn=437b58a11e313162cda370d740c366f2&amp;chksm=83b85ebfb4cfd7a92345c6591e0d4b420963b89c3195f6088d76bf5617ff169e187397ff942f&amp;scene=7&amp;key=7d7ed67221fd06ee0624763c454793d1236a8e2e14a4fa66cd53e0ad768ea0bda5f4e9a507b625d64bbe7bfe3205d3a9ffd0f62867c3227accdfe9c336129934abcdd3cf9a53d48a5efa4d580523c013&amp;ascene=0&amp;uin=MTIyMzg1NDgyMQ%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=A1ruOG05juwqp%2FXD84Zp7Qk%3D&amp;pass_ticket=PPQc2Mz8lJ%2F%2Fo6XNQUUcnrwYyAOp6HTKoMHwTpUWggHf9Ql2R3a5UCdV9hP7%2Bd3i" target="_blank" rel="noopener noreferrer">我上了 985，211，才发现自己一无所有 | 或者，也不能这么说</a></li><li><a href="https://www.bilibili.com/video/BV1tW411p7sM/?spm_id_from=333.788.videocard.4" target="_blank" rel="noopener noreferrer">读书有什么用？北大才女刘媛媛 4 分钟演讲，让整个世界都沉默！厉害<!-- -->_<!-- -->哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></li><li><a href="https://www.bilibili.com/video/BV1zx411C7i6?from=search&amp;seid=14509455615487477310" target="_blank" rel="noopener noreferrer">复旦大学女教授陈果讲课视频 孤独论 朋友论 学习论 生存论<!-- -->_<!-- -->哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></li><li><a href="https://www.bilibili.com/video/BV11t4y1y7hn/?spm_id_from=333.788.b_7265636f5f6c697374.1" target="_blank" rel="noopener noreferrer">股神罗杰斯一家来 B 站了！中文十级还说起了相声？<!-- -->_<!-- -->哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[VuePress你好，VuePres再见]]></title>
            <link>https://markshawn2020.github.io/blog/VuePress-Journal</link>
            <guid>VuePress-Journal</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[VuePress01 - 运行原理研究]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="vuepress01---运行原理研究">VuePress01 - 运行原理研究<a class="hash-link" href="#vuepress01---运行原理研究" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="服务端视角">服务端视角<a class="hash-link" href="#服务端视角" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="启动">启动<a class="hash-link" href="#启动" title="标题的直接链接">​</a></h4><p>启动时首先使用<code>npm run docs:dev</code>命令，即调用的<code>packages.json</code>文件中的<code>vuepress dev docs</code>命令。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812195621125.png" alt="image-20200812195621125" class="img_vXGZ"></p><p><code>vuepress</code>指向<code>@vuepress/core</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812200434428.png" alt="image-20200812200434428" class="img_vXGZ"></p><p>创建了一个<code>.node/App</code>程序（即服务端），并且启动了<code>createApp(options)</code>,<code>app.process</code>、<code>app.dev()</code>等几个命令。</p><p>由于我们直接使用<code>vuepress run dev</code>启动的，所以<code>options</code>为空。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812203534119.png" alt="image-20200812203534119" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="appjs">App.js<a class="hash-link" href="#appjs" title="标题的直接链接">​</a></h4><p><code>App.js</code>文件中就是一个 App 类，导入了很多依赖，比如生成<code>Markdown</code>的，生成<code>Page</code>组件的，以及与<code>dev</code>、<code>build</code>相关的进程函数。</p><p>仔细看之前的<code>CreateApp(options)</code>函数，其实就是<code>App(options)</code>函数，经过该函数进行初始化。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812204059251.png" alt="image-20200812204059251" class="img_vXGZ"></p><p><code>app.process()</code>函数中用了异步函数，主要用于解析页面之类。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812204540636.png" alt="image-20200812204540636" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="devprocess">DevProcess<a class="hash-link" href="#devprocess" title="标题的直接链接">​</a></h4><p><code>dev</code>函数中主要是使用<code>DevProcess</code>进行，并且会监听本地文件的变动，这里的本地文件是被程序特定的一些文件，主要是<code>markdown</code>、<code>vue</code>之类的。</p><p>与之对比，可以看一下生产环境的启动函数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812204720553.png" alt="image-20200812204720553" class="img_vXGZ"></p><p>可以看到，要简洁地多，主要是就是运行，然后渲染。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812205235678.png" alt="image-20200812204855624" class="img_vXGZ"></p><p>再看一下这个<code>DevProcess</code>函数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812205344580.png" alt="image-20200812205235678" class="img_vXGZ"></p><p>使用了<code>events</code>包进行事件驱动，而且所有的<code>webpack</code>打包都是在这里进行的，详见如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812204855624.png" alt="image-20200812205344580" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="文件监控">文件监控<a class="hash-link" href="#文件监控" title="标题的直接链接">​</a></h4><p>接下来看它的监控范围，首先是对<code>.js</code>、<code>.md</code>和<code>.vue</code>的监控。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812210030040.png" alt="image-20200812210030040" class="img_vXGZ"></p><p>可以看到<code>.md</code>是根目录下全局监控，而<code>.vue</code>只限于在<code>.vuepress/components</code>下定义的。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_O4V7"><div class="admonitionHeading_mM4K"><span class="admonitionIcon_Wsqb"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>暂时还不清楚各类监控的设定缘由与效果差异 :::</div><div class="admonitionContent_wp6k"><p>其次是对<code>.vuepress</code>文件夹下的<code>config</code>文件进行监控，支持<code>.js</code>、<code>.yml</code>和<code>.toml</code>三种格式，是写死的，所以<code>.yaml</code>、<code>.json</code>这两种格式是不被监控的，这里写的有点死了，用正则会更好一些，不过如果想监控自己的其他文件可以配置<code>siteConfig.extraWatchFiles</code>字段，参见：<a href="https://vuepress.vuejs.org/zh/config/#extrawatchfiles" target="_blank" rel="noopener noreferrer">配置 | VuePress（#extraWatchFiles）</a></p><ol><li><p>我的项目配置的就是<code>.yaml</code>格式，在了解到<code>.yaml</code>配置文件不在监控列表内后，我改成了<code>.yml</code>结尾，结果发现<code>js-yaml</code>不能完整解析<code>.yml</code>格式。</p></li><li><p>基于此，我去修改了<code>vuepress</code>的源码，以使它支持<code>config.yaml</code>的监控。</p></li><li><p>但最后我发现了<code>siteConfig.extraWatchFiles</code>这个配置，所以我最后采用了这个，基于此，我现在的<code>config.js</code>里就多了如下的监控文件：</p></li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200813031450552.png" alt="image-20200813031450552" class="img_vXGZ"></p><p>此外，还对 frontmatter 进行监控，如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812210245060.png" alt="image-20200812210245060" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="打包与服务器">打包与服务器<a class="hash-link" href="#打包与服务器" title="标题的直接链接">​</a></h4><p>接着就是使用<code>webpack</code>进行一些资源的打包与解析，比如<code>html</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812210428181.png" alt="image-20200812210428181" class="img_vXGZ"></p><p>接着是使用<code>express</code>创建服务器。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812210723659.png" alt="image-20200812210723659" class="img_vXGZ"></p><p>可以看到，公共资源都在<code>./public</code>下，而以<code>/</code>结尾的如果匹配不到文件，则会自动寻找<code>index.html</code>文件，我之前在配置<code>sidebarRecursive</code>的时候，就经常出现<code>index.html</code>匹配不上的报错，我后来的做法是给每个有路由的文件夹都配一个<code>index.md</code>文件占位，并且在解析<code>sidebarRecursive children</code>的时候排除这个<code>.md</code>文件（也可以不排除，就是像官方一样留空就可以，但这样会使该文件夹下的其他文件与它同层级，这不是我想要的）。</p><p>最后是一些<code>host</code>和 <code>port</code>等的配置。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200812211219741.png" alt="image-20200812211219741" class="img_vXGZ"></p><p>至此，服务器就创建成功了，打开浏览器地址可以看到所渲染出来的默认页面。</p><p>那从客户端视角来看，这一切又是如何呈现的呢？</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="客户端视角">客户端视角<a class="hash-link" href="#客户端视角" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="组件依赖图">组件依赖图<a class="hash-link" href="#组件依赖图" title="标题的直接链接">​</a></h4><p>首先，我们分析一下默认的主题，它位于<code>node_modules/@vuepress/theme-default</code>。</p><p>首先使用<code>webstorm</code>生成一下组件的依赖图。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200813023649261.png" alt="image-20200813023649261" class="img_vXGZ"></p><p>可以看到，所有的一级组件都经由<code>util/index.tsx</code>展开，二级组件再被一级组件所单独或共享使用。不过<code>util/index.tsx</code>中只是定义了各个解耦的被调用函数，直接看并没有什么欧诺个，所以我们还是先从<code>layouts/Layout.vue</code>看起。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="layout">Layout<a class="hash-link" href="#layout" title="标题的直接链接">​</a></h4><p>可以看到，组件如官网所述，主要分<code>components</code>、<code>global components</code>、<code>layouts</code>三大块，其中<code>layouts/Layout.vue</code>是默认入口。</p><p>这个组件在哪定义为入口的，我还没找到，所以先看组件吧。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200813021205905.png" alt="image-20200813021205905" class="img_vXGZ"></p><p>在这个<code>Layout.vue</code>中，主要由以下组件构成</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">.theme-container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - Navbar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - Sidebar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - .sidebarRecursive-mask</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - v-slot:sidebarRecursive-top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - v-slot:sidebarRecursive-bottom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">View</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Home</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - v-slot:page-top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - v-slot:page-bottom</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中最关键的就是<code>Home</code>与<code>Page</code>的分支判断，这其实就是对应两种<code>View</code>，而依据就是<code>frontmatter</code>中<code>home</code>字段是否为真。</p><p>了解到这点之后就很清楚了，如果我们想多设几种<code>View</code>，只要再这里修改<code>if...else...</code>的逻辑就可以了。</p></div></div><p>基于此，我尝试将<code>Home</code>和<code>Page</code>分离出来独立到<code>View</code>文件夹内，这样直接<code>dev</code>模式运行是没有问题的。但是！打包发布却出现了严重的问题！</p><p>所以，还是乖乖地放在<code>components</code>里面吧。。。</p><p>最后，关于父（<code>@parenttheme</code>）子（<code>@theme</code>）主题的引用，请参考：<a href="https://vuepress.vuejs.org/zh/theme/inheritance.html#%E7%BB%84%E4%BB%B6%E7%9A%84%E8%A6%86%E7%9B%96" target="_blank" rel="noopener noreferrer">主题的继承 | VuePress</a> :::</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="vuepress02---使用体验分析">VuePress02 - 使用体验分析<a class="hash-link" href="#vuepress02---使用体验分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="设计相关">设计相关<a class="hash-link" href="#设计相关" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="覆写设定不合理">覆写设定不合理<a class="hash-link" href="#覆写设定不合理" title="标题的直接链接">​</a></h4><p>以页面导航为例，在组件中判断一个页面的上一页或者下一页是什么，需要通过多个层级的多次判断，比如先判断主题有没有上下页，再判断页面是否有上下页，判断的位置隐含在<code>links</code>里或者<code>frontmatter</code>中。</p><p>作为<code>vuepress</code>的使用者，我经常需要在<code>console</code>中打印出当前页面的变量，以判断什么变量出于什么作用域范围内，我想说，这不是必要的。如果作者采用更加友好的设计方式，在后端与中端过程中将组件完全覆写，可以大大减少前端的逻辑判断。</p><p>也许这会束缚前端<code>vue</code>组件开发的灵活度，但框架毕竟是框架，使用<code>vuepress</code>的开发者应有能力在程序的配置阶段把一切设定好（如果框架机制允许的话）。也许我更崇尚配置式的框架吧，例如爬虫领域的<code>python</code>框架<code>scrapy</code>。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815012805.png" alt="image-20200815012805614" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="配置相关">配置相关<a class="hash-link" href="#配置相关" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="多语言配置这是真坑">多语言配置（这是真坑）<a class="hash-link" href="#多语言配置这是真坑" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/image-20200814002121393.png" alt="image-20200814002121393" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="使用自己的主题">使用自己的主题<a class="hash-link" href="#使用自己的主题" title="标题的直接链接">​</a></h4><p>在没有别人主题或者自己暂时没有经验的情况下，可以先把<code>vuepress</code>默认的主题拷贝出来，路径是在<code>node_modules/@vuepress/theme-default</code>，在配置的时候有几点一定要注意（至少是对于新手来说）。</p><ol><li>将主题文件夹放在<code>docs/.vuepress</code>下，一定一定！不然<code>dev</code>可以运行，<code>build</code>一定会出错！</li><li>修改<code>index.tsx</code>里的内容：</li></ol><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">extend</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@vuepress/theme-default'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>按照官网要求，重命名为<code>vuepress-theme-YOUR-THEME-NAME</code></li><li>修改<code>.vuepress/config.js</code>里的内容：</li></ol><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">theme</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">  require</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./vuepress-theme-YOUR-THEME-NAME'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="configyaml-或-configyml">config.yaml 或 config.yml<a class="hash-link" href="#configyaml-或-configyml" title="标题的直接链接">​</a></h4><p>经过测试，<code>js-yaml</code>对<code>.yml</code>解析的支持有限，因此推荐使用<code>.yaml</code>。</p><p>如需使用，请在<code>config.js</code>的<code>extraWatchedFiles</code>字段中加入相应的监控文件路径。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="运行相关">运行相关<a class="hash-link" href="#运行相关" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="navbar-的下划线">navbar 的下划线<a class="hash-link" href="#navbar-的下划线" title="标题的直接链接">​</a></h4><p>在<code>element-ui</code>中，只要成功点击了某导航项的切页，无论是单链接是子链接，下划线都会更新到那一项上。</p><p>但我发现<code>vuepress</code>里没有实现，需要解决一下。</p><p>例如当我点击了我的<code>博客</code>下拉菜单中某一项后，页面成功跳转，但下划线没了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815012640.png" alt="image-20200813032635390" class="img_vXGZ"></p><p>与之对比的是，如果是在首页，则会有。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815012641.png" alt="image-20200813032701945" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="sidebar-的热更新">sidebar 的热更新<a class="hash-link" href="#sidebar-的热更新" title="标题的直接链接">​</a></h4><p>在我更新我的本地文档时，已经启动的<code>vuepress</code>可以在两秒内监测到内容的变化，并相应地更新前端的呈现，但是对应的<code>siderbar</code>则不会自动更新。</p><p>按道理，<code>toc</code>是从文档内容中提取出的，<code>sidebarRecursive</code>基于<code>toc</code>呈现，理应做到同步更新，这是值得优化的一个点。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="frontmatter-格式问题">frontmatter 格式问题<a class="hash-link" href="#frontmatter-格式问题" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816121349543.png" alt="image-20200816121349543" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="插件相关">插件相关<a class="hash-link" href="#插件相关" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="vuepressplugin-nprogress"><a href="https://vuepress.vuejs.org/zh/plugin/official/plugin-nprogress.html" target="_blank" rel="noopener noreferrer">@vuepress/plugin-nprogress</a><a class="hash-link" href="#vuepressplugin-nprogress" title="标题的直接链接">​</a></h4><p>这个插件是用来显示页面跳转的时候顶部加载的进度条，如下所示。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200815193651544.png" alt="image-20200815193651544" class="img_vXGZ"></p><p>当网站刚启动的时候，或者网速很慢的时候，这个进度条就会比较明显。</p><p>不过，由于网站以静态内容为主，正常情况下，这个条只会一闪而过。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="永久链接">永久链接<a class="hash-link" href="#永久链接" title="标题的直接链接">​</a></h3><p>官网对于永久链接的设定不甚详细。</p><p>如下，我也搞不清这个文章发布是怎么算的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816093945554.png" alt="image-20200816093945554" class="img_vXGZ"></p><p>翻了一下源代码，在<code>node_modules/@vuepress/shared-utils/lib/getPermalink.js</code>里有如下，生成链接的函数接收五个参数，其中第三个参数就是时间，这些模板变量都是从这个时间中解析出来的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816094124718.png" alt="image-20200816094124718" class="img_vXGZ"></p><p>接着定位到了<code>node_modules/@vuepress/core/lib/node/Page.js</code></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816094645568.png" alt="image-20200816094645568" class="img_vXGZ"></p><p>而这个<code>this.date</code>呢，是根据这个函数生成的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816094813159.png" alt="image-20200816094813159" class="img_vXGZ"></p><p>最后到了<code>node_modules/@vuepress/core/lib/node/util/index.tsx</code></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816094959257.png" alt="image-20200816094959257" class="img_vXGZ"></p><p>注意这个<code>DATE_RE</code>，我拷贝出来一下：<code> /(\d{4}-\d{1,2}(-\d{1,2})?)-(.*)/</code>，所以这个程序的意思就是，依次从 frontmatter.date、文件名和文件夹名中提取<code>YYYY-M?M-D?D-FILENAME</code>的格式，一旦提取到，就会生成它的永久链接。</p><p>尴尬了，我原先素材的取名都是<code>YYMMDD</code>的，例如：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816095412067.png" alt="image-20200816095412067" class="img_vXGZ"></p><p>于是，写了个脚本，重命名了一下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816100625252.png" alt="image-20200816100625252" class="img_vXGZ"></p><p>接下来就是永久链接的路由配置，由于我们的 nav 和 sidebar 是自己自己写的，所以需要自己对应上。</p><p>按照规则，现在的文章路径，以<code>2020-05-26-杨季.md</code>为例，变成了<code>/2020/05/26/杨季</code>。</p><p>但专辑名也要相应地换一下，目前文件夹名是<code>A01-考研专辑</code>，对应的<code>index.md</code>，专辑名显然不能换，但我们也想用一个好记的路径，因此直接在<code>index.md</code>里设置 frontmatter，这里就不要用<code>date</code>变量了，而是直接<code>permalink</code>，如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816101325695.png" alt="image-20200816101325695" class="img_vXGZ"></p><p>但这样做有个弊端，我们在生成<code>menus</code>和<code>sidebar</code>时需要先解析文件内容，与我一开始简单地通过文件路径生成网络路由的初衷不符，虽然<code>vuepress</code>本身便是基于此的。</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_O4V7"><div class="admonitionHeading_mM4K"><span class="admonitionIcon_Wsqb"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span><mdxadmonitiontitle>如上标准化文件名后，还要在<code>config.js</code>中，配置永久路径的模板变量。</mdxadmonitiontitle></div><div class="admonitionContent_wp6k"><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816102550549.png" alt="image-20200816102550549" class="img_vXGZ"></p><p>这样才能被<code>vuepress</code>解析。 :::</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="路由的中文转义">路由的中文转义<a class="hash-link" href="#路由的中文转义" title="标题的直接链接">​</a></h3><p>程序内部对每个路由会有三种形式：<code>relativePath | regularPath | path</code>，其中<code>relativePath</code>是本地文件路径，<code>regularPath</code>是转义后的路径，而<code>path</code>顾名思义应该是最终的路径。</p><p>此外，还有一个<code>permanlink</code>，是用户指定的文件的最终访问路径。</p><p>在我们的程序中，直接按照文件路径配置 nav 和 sidebar 是比较符合 common sense 的，操作起来也是比较容易，只要用<code>fs</code>遍历或者递归即可。<strong>这样的操作，它本身不应该有问题，如果有问题，那一定是框架的问题</strong>。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="未配置-permalink-的结果">未配置 permalink 的结果<a class="hash-link" href="#未配置-permalink-的结果" title="标题的直接链接">​</a></h4><p>✅ vuepress 生成了<code>.html</code>结尾的目标节点，该路径的中文形式就是本地文件路径，具体网络路径为<code>/zh/S01-%E6%96%87%E9%9B%86/G01-%E7%A0%94%E7%A9%B6%E7%94%9F%E5%8D%87%E5%AD%A6%E6%A1%88%E4%BE%8B/A02-%E7%95%99%E5%AD%A6%E4%B8%93%E8%BE%91/2020-06-12-%E7%8E%8B%E9%80%B8%E6%88%90.html</code><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816150514054.png" alt="image-20200816150514054" class="img_vXGZ"></p><p>✅ 当直接访问上条<code>.html</code>结尾的路径时，会跳转到没有<code>index.html</code>结尾的路径，对应的就是本地文件路径。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816150727187.png" alt="image-20200816150727187" class="img_vXGZ"></p><p>✅ 最后，若直接访问中文路径，或者访问该转义路径，是等价的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816150829410.png" alt="image-20200816150829410" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="配置了-permalink-的结果">配置了 permalink 的结果<a class="hash-link" href="#配置了-permalink-的结果" title="标题的直接链接">​</a></h4><p>✅ 此时，如果直接访问<code>/考研专辑/</code>或者<code>/%E8%80%83%E7%A0%94%E4%B8%93%E8%BE%91/</code>是可以成功跳转的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816144956705.png" alt="image-20200816144956705" class="img_vXGZ"></p><p>❌ 然而虽然下面的路径<code>/%E8%80%83%E7%A0%94%E4%B8%93%E8%BE%91/index.html</code>，根据路由显示也是跳转上面的路径，但是事实上，当我们输入网址后，会被浏览器解析成<code>/考研专辑/index.html</code>，从而失配。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816145024359.png" alt="image-20200816145024359" class="img_vXGZ"></p><p>❌ 紧接着，即我们程序中设定的本地文件路径映射，虽然也显示跳转，但会直接转义，导致跳转失败。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816145042228.png" alt="image-20200816145042228" class="img_vXGZ"></p><p>值得注意的是，如果文件路径都是英文，配置了<code>permalink</code>之后，路径的跳转都没问题。</p><p>有问题的点在于，当使用转义后的本地文件路径去访问时，浏览器指向了转义前的路径（即中文），而该路径是没有跳转项的，导致跳转失败。</p><p>所以，问题的解决就在于，<strong>能否配置一个转义前（中文）的本地文件路径，使之跳转到最终的 permalink</strong>。</p><p>或者，<strong>不要转义本地文件路径</strong>。</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="修改源代码">修改源代码<a class="hash-link" href="#修改源代码" title="标题的直接链接">​</a></h4><p>如下，对<code>node_modules/@vuepress/core/lib/node/internal-plugins/routes.js</code>转义后的路径重新解码，保证原文件路径对最终路径的映射，即可成功解决中文路径跳转问题。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200816155711710.png" alt="image-20200816155711710" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结担忧与考虑">总结、担忧与考虑<a class="hash-link" href="#总结担忧与考虑" title="标题的直接链接">​</a></h3><p>其实标准化 url 也是很好的一种设计，能让程序更加地稳健，但却出现了我遇到的 permalink 强行跳转导致转义失配的结果。我解决的方法是对标准化之前的文件路径建立映射。</p><p>在我的项目中，目前还不存在由于 url 编码而产生歧义的可能，其他项目可能要自行把握。也希望看到更优秀的解决方案！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="vuepres03---我为什么放弃了-vuepress">VuePres03 - 我为什么放弃了 VuePress<a class="hash-link" href="#vuepres03---我为什么放弃了-vuepress" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="选择-vuepress-的理由">选择 vuepress 的理由<a class="hash-link" href="#选择-vuepress-的理由" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="放弃-vuepress-的理由">放弃 vuepress 的理由<a class="hash-link" href="#放弃-vuepress-的理由" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="展望">展望<a class="hash-link" href="#展望" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="回顾">回顾<a class="hash-link" href="#回顾" title="标题的直接链接">​</a></h3><p>弃更，落差太大了。</p></div></div>]]></content:encoded>
            <category>Vuepress</category>
        </item>
        <item>
            <title><![CDATA[vue开发笔记]]></title>
            <link>https://markshawn2020.github.io/blog/文集/vue开发笔记</link>
            <guid>/文集/vue开发笔记</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[开发速查手册]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="使用-vue-serve-运行单-vue-文件">使用 vue serve 运行单 vue 文件<a class="hash-link" href="#使用-vue-serve-运行单-vue-文件" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="安装自检方式">安装自检方式<a class="hash-link" href="#安装自检方式" title="标题的直接链接">​</a></h3><p>查看 vue 版本 x</p><p>先全局安装<code>cli-service-global</code>。</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -g @vue/cli-service-global</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后运行目标 vue 文件，例如</p><div class="language-bash codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-bash codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">vue serve test.vue</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><tip> 我之前使用`yarn`安装几乎没有成功的。但以前在使用`npm`安装`node-sass/sass-loader`的时候也几乎没有成功过，用`yarn`成功了（后来了解到应该是`sass-loader`的版本问题）。总之，对于新手来说，两种安装方式都试试。 </tip>]]></content:encoded>
            <category>计算机与软件</category>
        </item>
        <item>
            <title><![CDATA[博客开发之导航设计方案]]></title>
            <link>https://markshawn2020.github.io/blog/2020/08/29/博客开发之导航设计方案</link>
            <guid>/2020/08/29/博客开发之导航设计方案</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[背景]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="基础">基础<a class="hash-link" href="#基础" title="标题的直接链接">​</a></h3><p>我使用过多款博客开发框架，<code>Django | Vuepress | Nuxt | Gatsby</code>等等，在这里暂时不谈<code>Django</code>和<code>Gatsby</code>，就我目前深入使用的<code>Vuepress</code>和<code>Nuxt</code>（主要是<code>Nuxt-Content</code>中的<code>Content-Theme-Docs</code>主题）体验来说，导航的设计方案真地很有必要仔细考虑。</p><tip>此处的导航，默认包括导航栏+侧边栏，甚至路由</tip><p>类似的博客站点大多是默认基于文件路径生成路由，例如<code>/zh/home.md</code>文件一般会生成<code>/zh/home</code>的路由。此外，也会提供默认语言的设定，因此<code>/zh/home</code>最后会变成<code>/home</code>，两者等价。在此基础之上，有些框架还会再加入默认<code>index file</code>的设定，以<code>vuepress</code>为例，如果这个文件是<code>index.md</code>的话，则最后就等价于<code>/</code>，即主页。</p><p>以上是博客框架生成导航栏、侧边栏，显示文章标题等的一些支撑性概念，只有在理解这个的基础之上，才能设计出自己满意的路由与导航、侧边栏展示。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="多语言">多语言<a class="hash-link" href="#多语言" title="标题的直接链接">​</a></h3><p>尽管现在的浏览器，都能很智能地解析中文网址，但我们必须审慎对待这样的一种“特殊待遇”。就拿我曾经使用的<code>vuepress</code>框架来说，我曾经为了里面的中文路径而苦苦 debug 一整天，后来发现是框架的作者对于路由的处理不够稳健，从而有中文路径不匹配的 bug，这是十分令人恼火的。</p><p>此外，不同的浏览器，以及不同的版本，对于非英文网址的转义设定总会有一些区别，在这里，大家都是有能力去处理，但并没有统一的约定去强制开发者遵循，所以中文路径往往并不是第一选择。但对于国人来说，好的中文路径依旧有其诱人的吸引力。以我的实际项目为例，考虑两个路由：<code>/博客/考研专辑</code>与<code>/blog/postgraduation-exam-album</code>。也许有翻译不够优雅的问题，但从目标用户角度出发，这个中文路径就十分地友好。</p><p>基于此，我们试想一下，如果我们要设计一套多语言系统来适配我们的文章，该怎么做？按照惯例，我们首先有一批中文文档，并准备逐步更新成英文文档。</p><p>首先是中英文文件系统的一一映射必须要做，否则当我访问<code>/博客/文章A</code>时，切换成英文，如果对应的路由<code>/blog/arcticel_A</code>不存在，则不能满足我们的需求。但值得注意的是，这里的映射，已经不单单是文件系统的映射，还是路由的映射。</p><p>我们试想另一种解决方案——纯英文路径。当我访问<code>/blog/arcticel_A</code>时，切换成英文，对应路由变成<code>/en/blog/arcticel_A</code>，这种设计也是十分友好的。在这里，我必须指出，大多数人并不在乎网址是中文还是英文，他们更在乎页面的内容是中文还是英文。此外，中文的路径大多数人并不习惯，由此看起来甚至还有点点不专业。</p><p>对比下来，我个人觉得第二种解决方案操作起来比较友善，那就是一套文件地址，更换其根目录文件夹名，从而适配多语言系统，这听起来十分 make sense。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="标题的直接链接">​</a></h2><p>基于多语言角度的考虑，我最终决定：文件系统的文件夹命名全部英文，方便网址的国际化。（在这里，文件名可以是中文，因为我一般使用<code>typora</code>写作文档，并且无须提前命名文件，而是直接写完一级标题然后保存就可以自动命名了。这样的话，文件名就是文章的标题名，并且往往是中文优先的。）</p><p>这样，假设我们的默认工作目录是<code>/zh/articles/</code>，我们新建了一个文档为<code>home.md</code>，则中文路由为<code>/articles/home</code>。我们<strong>"同步复制"</strong>该文档到英文目下，得到英文路由为<code>/en/articles/home</code>。这里的“同步复制”打引号是因为，复制的操作实在还是太麻烦了，因此在设计解决方案的时候，应该要做一些程序化的处理。</p><p>路径的问题解决了，（即以英文优先，默认使用文件路径，不同语言子路径相同），接下来就是导航栏的多语言设计了。</p><p>由于我们的文件路径用于多语言的匹配，与路由的生成，因此我们需要使用其他的方式生成导航栏的多语言</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="终极解决方案">终极解决方案<a class="hash-link" href="#终极解决方案" title="标题的直接链接">​</a></h2><ul><li><p>设置文档根目录，根目录下存放多个语言目录，以及可以预设一个<code>settings.js|jaon|yaml</code>的配置文件。</p></li><li><p>指定默认语言，例如中文，即<code>zh</code>，该语言目录下的文档，最好是其他语言文档的超集。</p></li><li><p>遍历文档目录下的文件夹与<code>.md</code>文件，生成文档树，得到以下字段：<code>relativePath, dirName, fileName, mdTitle, mdID, mdDate, mdTags, mdDescription, mdAuthor </code>。其中：</p><ul><li><code>relativePath, dirName, fileName</code>均是文档系统默认的</li><li><code>mdTitle</code>首先从文档的一级标题中获取，如若获取不到，再从<code>frontmatter</code>中获取，最后等于<code>fileName</code></li><li><code>mdID</code>首先从文档的<code>frontmatter</code>中获取，获取不到则等于<code>relativePath</code>的<code>hash</code>值</li><li><code>mdDate</code>首先从文档的<code>frontmatter</code>中获取，获取不到再尝试从<code>fileName</code>中解析出日期，fallback 为空</li><li><code>mdTags</code>首先从文档的<code>frontmatter</code>中获取，获取不到则等于<code>relativePath</code>上的所有文件夹名集合</li><li><code>mdDescription</code>首先从文档的<code>frontmatter</code>中获取，获取不到则等于文档中开头的 N 个字，可设置是否包含一级标题</li><li><code>mdAuthor</code>首选从文档的<code>frontmatter</code>中获取，获取不到则等于默认的作者名，比如<code>南川</code>，作者名也要配置多语言，在<code>settings</code>中。</li></ul></li><li><p>以上，可以得出，文档的<code>frontmatter</code>中最好包含以下字段：</p><ul><li><code>id</code></li><li><code>title</code></li><li><code>date</code></li><li><code>tags</code></li><li><code>description</code></li><li><code>author</code></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="方案分析">方案分析<a class="hash-link" href="#方案分析" title="标题的直接链接">​</a></h3><p>对于 字典树的方案，并不太靠谱，我当时试想着</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="递归方案">递归方案<a class="hash-link" href="#递归方案" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="分析输入">分析输入<a class="hash-link" href="#分析输入" title="标题的直接链接">​</a></h4><p>输入是相对路径，通过默认的根路径与相对路径拼接得到绝对路径，通过读取绝对路径下的子文件夹得到进一步的信息</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="分析输出">分析输出<a class="hash-link" href="#分析输出" title="标题的直接链接">​</a></h4><p>输出有两种，字典或者列表。</p><p>因为我们对输入的操作，涉及到了子文件夹的遍历，因此容易得到一个列表，所以用列表输出是可行的一种方案。</p><p>即：</p><p>输入：相对路径，得到 path 字段</p><p>处理：基于 path 字段得到一些基本信息</p><p>遍历：</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="输出的衔接">输出的衔接<a class="hash-link" href="#输出的衔接" title="标题的直接链接">​</a></h4><p>如果输出是一个列表，</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">basic</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token literal-property property" style="color:#36acaa">children</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_children</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果希望输入是一个空字典，最终返回一个字典，则函数的输出需要是一个字典。</p><p>如果希望输入是一个空字典，最终返回一个列表，然后进行拼接构造</p><table><thead><tr><th></th><th>亮</th><th>暗</th></tr></thead><tbody><tr><td>登录</td><td>bg-white<br>text-teal-700</td><td>bg-gray-900<br>text-teal-300</td></tr><tr><td>未登录</td><td>bg-white<br>text-gray-500</td><td>bg-gray-900<br>text-gray-500</td></tr><tr><td></td><td></td><td></td></tr></tbody></table>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[如何向ElementUI一样封装Message全局组件]]></title>
            <link>https://markshawn2020.github.io/blog/2020/08/29/如何向ElementUI一样封装Message全局组件</link>
            <guid>/2020/08/29/如何向ElementUI一样封装Message全局组件</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[需求分析]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="需求分析">需求分析<a class="hash-link" href="#需求分析" title="标题的直接链接">​</a></h2><p>我首先使用<code>Element-UI</code>完成了一个头像和登录框的设计，当我点击头像的时候，就会跳出一个登录框，它通过读取<code>vuex</code>进行一些登录注册相关的操作。</p><p>但这仅仅是一个独立的组件，我可以把我的头像放在任意的页面中，当我点击头像，登录框就会弹出。</p><p>现在的需求是，我将在一个新的位置调取登录框，比如在用户未登录的情况下触发评论系统。这意味着，登录将会有新的逻辑，比如点击某个地方，然后跳出登录框。</p><p>虽然这依旧可以通过局部组件实现，就像头像与登录框的互动一样，但难免麻烦。因为我们已经注意到，这个登录框有复用的价值。</p><p>既然<code>Element-UI</code>的弹窗可以通过<code>.$elert | .$message</code>等方法便捷地实现，我们为什么不也试着实现一个类似的呢？</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="代码分析">代码分析<a class="hash-link" href="#代码分析" title="标题的直接链接">​</a></h2><p>在本地的工程项目中导航到安装的<code>element-ui</code>，如下所示。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/typora-user-images/image-20200824103134434.png" alt="image-20200824103134434" class="img_vXGZ"></p><tip>或者也可以通过直接下载`element-ui`源代码进行查看。</tip><p>经过分析，<code>element-ui</code>的<code>js</code>代码是在<code>packages</code>文件夹下，我们打开<code>node_modules/element-ui/packages/message/src/main.js</code>对<code>message</code>全局组件进行分析。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ui-组件分析">UI 组件分析<a class="hash-link" href="#ui-组件分析" title="标题的直接链接">​</a></h3><p>第二行导入<code>Main</code>UI 组件，即<code>Message</code>。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Vue</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Main</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./main.vue'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports maybe-class-name">PopupManager</span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-ui/src/utils/popup'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports">isVNode</span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-ui/src/utils/vdom'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们简单看一下<code>Message</code>的 UI 组件。</p><div class="language-html codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-html codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">template</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">transition</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">el-message-fade</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">@after-leave</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">handleAfterLeave</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">:class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">        </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">el-message</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">        type &amp;&amp; !iconClass ? `el-message--${ type }` : </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">        center ? </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">is-center</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c"> : </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">        showClose ? </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">is-closable</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c"> : </span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value punctuation" style="color:#393A34">'</span><span class="token tag attr-value" style="color:#e3116c">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">        customClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token tag attr-value" style="color:#e3116c">      ]</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">:style</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">positionStyle</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">v-show</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">visible</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">@mouseenter</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">clearTimer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">@mouseleave</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">startTimer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">      </span><span class="token tag attr-name" style="color:#00a4db">role</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">alert</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">i</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">:class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">iconClass</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">iconClass</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">i</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">i</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">:class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">typeClass</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-else</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">i</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">slot</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">!dangerouslyUseHTMLString</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">el-message__content</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {{ message }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-else</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">v-html</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">message</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">el-message__content</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">slot</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">i</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">v-if</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">showClose</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">el-message__closeBtn el-icon-close</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">        </span><span class="token tag attr-name" style="color:#00a4db">@click</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">close</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">i</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">transition</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">template</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>Message</code>的 UI 组件里，主要是在<code>transition</code>组件（可能是内部封装的一个全局组件）内对一些<code>data</code>进行条件渲染。</p><p>全部的<code>data</code>如下，没有<code>prop</code>。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">visible</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">duration</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'info'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">iconClass</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">customClass</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">onClose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">showClose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">closed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">verticalOffset</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">timer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">dangerouslyUseHTMLString</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">center</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意这里的触发显示的方式，是通过<code>visible</code>控制的，所以当注册该组件为全局组件时，我们关心是如何将<code>visible</code>变为<code>true</code>的。</p><p>这里暂时先不看<code>Message</code>UI 组件里的<code>js</code>逻辑，我们回到外部的<code>main.js</code>。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="组件注册分析">组件注册分析<a class="hash-link" href="#组件注册分析" title="标题的直接链接">​</a></h3><p>在下面的代码里，主要分<code>instance</code>和<code>instances</code>两块，因为<code>Message</code>可以多次调用，所以使用数组的形式。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token maybe-class-name">MessageConstructor</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Main</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> instances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> seed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">Message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$isServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'string'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">message</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> userOnClose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">onClose</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'message_'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> seed</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">onClose</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userOnClose</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MessageConstructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isVNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$slots</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> verticalOffset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verticalOffset </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">offsetHeight</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">verticalOffset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> verticalOffset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">visible</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">style</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">zIndex</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">PopupManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">nextZIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们主要看<code>instance</code>块，我们去除用户输入判断与关闭逻辑，剩下来的核心注册逻辑如下。</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token maybe-class-name">MessageConstructor</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">extend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Main</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">Message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MessageConstructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">$mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  instance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">visible</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token maybe-class-name">Message</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>首先使用<code>Vue.extend</code>扩展原来的<code>UI</code>组件</li><li>然后使用<code>new MessageConstructor</code>构造一个新的组件，<code>options</code>输入到<code>data</code>属性内</li><li>使用<code>\$mount()</code>挂载组件</li><li>将组件置入浏览器中<code>document.body.append...</code></li><li>将组件的<code>visible</code>状态打开</li><li>最后导入该组件</li></ol><p>基于以上的代码，我们可以很容易的全局引入一个组件，如官网所示，在<code>Vue</code>启动前，只需要引入这几句就可以：</p><div class="language-js codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-js codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Vue</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'vue'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Message</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'element-ui'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 不能使用Vue.use(Message)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Vue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$message</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Message</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[如何给右键添加任何启动程序]]></title>
            <link>https://markshawn2020.github.io/blog/文集/如何给右键添加任何启动程序</link>
            <guid>/文集/如何给右键添加任何启动程序</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[计算机应用研究]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_rB0w" id="小白方法">小白方法<a class="hash-link" href="#小白方法" title="标题的直接链接">​</a></h2><p>下载各种计算机管理软件或者右键管理软件，中途被恶意捆绑安装了一大堆，花里胡哨中迷失了方向，最后还不能达到预期效果。</p><p>别说小白，我就试过，用什么 360 右键管理等等，大多数情况下根本没个卵用。</p><p>本篇文章将教你如何在十分钟内管理好你的右键，并实现我今天要实现的目标，在右键中添加“<strong>在此处打开 Typora</strong>”选项。</p><p>目前右键效果截图：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815111116.png" alt="image-20200815111115810" class="img_vXGZ"></p><p>可以看到，是没有这一选项的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="标题的直接链接">​</a></h2><p>首先，我们看这个右键，比如<code>通过 Code 打开</code>（注意有空格），其实就是我们想要实现的目标，只不过我们想要打开自己想打开的某个软件，于是我们可以先看一下 VSCode 是怎么做到的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="打开注册表">打开注册表<a class="hash-link" href="#打开注册表" title="标题的直接链接">​</a></h3><p><code>Windows + R</code>，输入<code>regedit</code>，回车后弹窗点击<code>是</code>，顺利打开注册表，如图所示。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815111458.png" alt="image-20200815111458364" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="搜索同类目标">搜索同类目标<a class="hash-link" href="#搜索同类目标" title="标题的直接链接">​</a></h3><p>这一步是关键，很多教程只讲具体的方法，但不讲方法论，但不能怪他们，很多中国的程序员其实根本没有所谓的方法论，要么是搜索党，要么是伸手党，稍微有些技术的，我们就看不见了（被收官，或者属于沉默寡言的黑客之类）。</p><p>我们尝试，搜索<code>通过 Code 打开</code>这几个字。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815111806.png" alt="image-20200815111806503" class="img_vXGZ"></p><p>我们得到了如下结果，这个结果很有意思。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815111908.png" alt="image-20200815111908441" class="img_vXGZ"></p><p>解读如下：</p><ol><li>首先这是在<code>HKEY_CLASSES_ROOT</code>下搜索到的，<strong>ROOT</strong>这个名字对于程序员来说实在是再熟悉不过了，一看就很靠谱的样子。</li><li>接着是<code>*</code>，星号其实程序员也不陌生，就是<strong>通配符</strong>的意思，因此也就意味着这里的设置对应着通用的情况。</li><li>再接着就是<code>shell</code>，linux 玩家对此也是了然如胸，一般属于<strong>命令行</strong>之类的操作。</li><li>最关键的，是其他几个选项，我们看到了有各种<code>Open with</code>，还全是<code>JetBrains</code>家的，比如编写 C/C++语言的 Clion，编写 Java 语言的 IDEA，编写 python 语言的 PyCharm 和编写 JS 语言的 WebStorm，当然了这是因为我安装了这些软件，然后他们自动写入了注册表，毕竟大厂的软件啥都考虑到了。对于更加小众、独立的软件就暂时不支持这么牛哄哄的底层操作了（或者不敢，怕说流氓）。</li></ol><p>现在，<strong>我们主动赋予它们绑定我们系统的权利</strong>！</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="摸索总结设定的方式">摸索、总结设定的方式<a class="hash-link" href="#摸索总结设定的方式" title="标题的直接链接">​</a></h3><p>我们多点几下这些大厂的软件，看看它们在注册表中展现的形式是怎样的。</p><p>我随便点了两个不同厂商的，PyCharm 和 VsCode 的设定都出奇地类似：</p><ul><li>一个（默认）项，数据值是文件系统中显示的操作命令名</li><li>一个 Icon 项，数据值是程序的启动路径</li><li>一个 command 子文件夹</li></ul><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815112626.png" alt="image-20200815112626518" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815112642.png" alt="image-20200815112642876" class="img_vXGZ"></p><p>这里要注意的是，虽然类型有<code>REG_SZ</code>和<code>REG_EXPAND_SIZE</code>两种，但从字面意思上来看，其实应该都能达到同样的效果，我们就用默认的<code>REG_SZ</code>了。</p><p>再看它们 command 子文件夹的设定方式。</p><p>可以看到，数据值就是在程序启动路径后面跟上<code>%1</code>而已。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815112953.png" alt="image-20200815112953361" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113004.png" alt="image-20200815113004065" class="img_vXGZ"></p><p>备注，这里的数据值都上了引号，是因为当做命令行时，由于程序路径存在空格，所以需要用引号包围防止出错。而上面的那个 Icon 的数据值没有包是因为直接把路径当做了一个变量。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="开始实践">开始实践！<a class="hash-link" href="#开始实践" title="标题的直接链接">​</a></h3><p>一分钟内，我们仿佛就知道了如何办了，难道不是吗？</p><p>以<code>Typora</code>程序为例。</p><ol><li>新建一个文件夹叫<code>MyTypora</code>（取名明显是任意的），即点击<code>shell</code>，右键新建<code>项</code>（“项”等价于文件夹）。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113432.png" alt="image-20200815113432812" class="img_vXGZ"></li><li>在<code>MyTypora</code>下，新建一个字符串值，就是默认值。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113609.png" alt="image-20200815113609568" class="img_vXGZ"></li><li>在默认值上双击，输入想显示的名字（显然也是任意的）。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113718.png" alt="image-20200815113718651" class="img_vXGZ"></li><li>再新建一个字符串值，名字取名为<code>Icon</code>，这个名字还是不能改的，然后输入程序的启动路径。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113814.png" alt="image-20200815113814687" class="img_vXGZ"></li><li>要找到程序的启动路径，可以这样，在 win10 内搜索到应用程序，右键打开文件位置，它会打开快捷方式所在的位置，接着在快捷方式上右击再次选择文件位置，就能到达实际启动路径了。接着复制该程序的路径，用<code>\</code>符号切割，得到<code>C:\Program Files\Typora\Typora.exe</code> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815113906.png" alt="image-20200815113906341" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114037.png" alt="image-20200815114037415" class="img_vXGZ"> <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114143.png" alt="image-20200815114143173" class="img_vXGZ"></li><li>将路径填回注册表。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114239.png" alt="image-20200815114239484" class="img_vXGZ"></li><li>最后一步，在文件夹下新建一个<code>command</code>子文件夹（或者叫<code>项</code>），将路径复制加上引号后，紧跟一个<code>%1</code>。 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114420.png" alt="image-20200815114420415" class="img_vXGZ"></li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="开始验证">开始验证！<a class="hash-link" href="#开始验证" title="标题的直接链接">​</a></h3><ol><li><p>验证文件夹内右击是否成功</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114925.png" alt="image-20200815114615301" class="img_vXGZ">很遗憾，文件夹内并未出现<code>Typora</code>的字样。</p></li><li><p>验证文件夹上右击是否成功同上，未成功。</p></li><li><p>验证文件上右击是否成功 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815114730.png" alt="image-20200815114730400" class="img_vXGZ"> 可以看到，已经成功。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_rB0w" id="进一步解决方案">进一步解决方案<a class="hash-link" href="#进一步解决方案" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="对解决方案的总结分析">对解决方案的总结分析<a class="hash-link" href="#对解决方案的总结分析" title="标题的直接链接">​</a></h3><p>很明显，windows 对文件、文件夹、文件管理器背景（空白处）等（大胆猜测桌面上也是其中一项）做了多处不同的设定，所以我们需要一一设定。</p><p>我目前的需求主要有两个：</p><ol><li>右键文件管理器空白处能够显示<code>在此处打开Typora</code></li><li>右键文件夹能够显示<code>使用Typora打开此文件夹</code></li></ol><p>另一个需求<code>使用Typora打开此文件</code>我已经通过 windows 的<code>默认应用程序</code>实现。</p><p>因此，我们需要进一步实现这两个需求。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="实现文件夹背景右键添加">实现文件夹背景右键添加<a class="hash-link" href="#实现文件夹背景右键添加" title="标题的直接链接">​</a></h3><p>再次打开<code>Ctrl + F</code>搜索框，还是用哪个<code>VS Code</code>搜索，得到如下结果。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815115558.png" alt="image-20200815115558488" class="img_vXGZ"></p><p>很明显，在这里集中设定<code>文件夹背景</code>的右键项。</p><p>仿照之前的解决方案，我们实现<code>Typora</code>的右键添加。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815115750.png" alt="image-20200815115750325" class="img_vXGZ"></p><p>再仿照 VS Code 的 command 设定，实现 Typora 的 command。</p><tip>文件夹背景打开的命令符号是`%V`。</tip><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815115834.png" alt="image-20200815115834383" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815115909.png" alt="image-20200815115908966" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="实现文件夹右键添加">实现文件夹右键添加<a class="hash-link" href="#实现文件夹右键添加" title="标题的直接链接">​</a></h3><p>同上，再次搜索。</p><p>可以看到，在这个<code>Directory</code>文件夹下有个<code>shell</code>，确认过眼神，是我们的最后一步了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815120037.png" alt="image-20200815120037224" class="img_vXGZ"></p><p>配置同上，也是默认项+Icon 项+command 项（也是<code>%v</code>)。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="开始验证-1">开始验证！<a class="hash-link" href="#开始验证-1" title="标题的直接链接">​</a></h3><ol><li>验证文件夹背景右键 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815120507.png" alt="image-20200815120507359" class="img_vXGZ"> 成功！</li><li>验证文件夹右键 <img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815120537.png" alt="image-20200815120537109" class="img_vXGZ"> 成功！</li></ol><p>至此，全部的验证均已通过。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="引申与总结">引申与总结<a class="hash-link" href="#引申与总结" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="关于图标">关于图标<a class="hash-link" href="#关于图标" title="标题的直接链接">​</a></h3><p>这里注意的是，图标和我们平时所说的图片不一样，图标都是程序打包时程序内部预设的 icon，所以我们新建 icon 项后填的其实是一个<code>.exe</code>文件路径，而不是<code>.jpg</code>或其它。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="关于路径">关于路径<a class="hash-link" href="#关于路径" title="标题的直接链接">​</a></h3><p>我经常有复制一个文件绝对路径的需求，但是 windows 资源管理器默认只能复制文件名和导航地址栏（即文件夹地址），我们需要自己拼接，这点体验很不好。</p><p>所以我新建了一个右键复制绝对路径的项，如下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815121124.png" alt="image-20200815121124240" class="img_vXGZ"></p><p>它的 command 项略有点复杂，使用了 vb 的命令。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815121151.png" alt="image-20200815121151405" class="img_vXGZ"></p><p>我复制如下，供有需求的朋友自行配置。</p><div class="language-vbscript codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-vbscript codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">mshta vbscript:clipboarddata.setdata("text","%1")(close)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>同样地，再设置一下文件夹的拷贝项。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815121410.png" alt="image-20200815121410128" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/typora/20200815121423.png" alt="image-20200815121422962" class="img_vXGZ"></p><p>命令行和上面是一样的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="关于意义">关于意义<a class="hash-link" href="#关于意义" title="标题的直接链接">​</a></h3><p>其实看到最后会发现，<strong>这就是一个脚本完事的事</strong>。</p><p>没错，话是这么说，但谁都知道，这个年代，还有谁有时间或者有兴趣去学 windows 的脚本编程呢？</p><p>我从论坛学到一个流程的基本设定，怎么打开注册表，怎么修改表项，再根据自己的经验与理解，实现了更多自定义的设置，这就是意义。</p><p>我不用去专门再学一门编程语言，但我对它的理解却更甚了，日常工作的体验更棒了，并且有信心能够解决未来遇到的更多难题，这就是全部的意义。</p><p>Thanks for your attention.</p>]]></content:encoded>
            <category>计算机与软件</category>
        </item>
        <item>
            <title><![CDATA[我谈《三十而已》]]></title>
            <link>https://markshawn2020.github.io/blog/2020/08/29/我谈《三十而已》</link>
            <guid>/2020/08/29/我谈《三十而已》</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[近期有一部剧很火，它叫《三十而已》，取材地是在上海，故事时间是在 2019 年，三位主角的年龄都在 30 岁，这些都让这部剧有着无穷的想象力。]]></description>
            <content:encoded><![CDATA[<p>近期有一部剧很火，它叫《三十而已》，取材地是在上海，故事时间是在 2019 年，三位主角的年龄都在 30 岁，这些都让这部剧有着无穷的想象力。</p><p>但我很失望。</p><p>以下内容部分整理于知乎，兼加自己的体验与理解。</p><p>首先给出时间线。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="时间线">时间线<a class="hash-link" href="#时间线" title="标题的直接链接">​</a></h2><p>2002 年，顾佳 14 岁，第一次例假。</p><p>2003 年，顾佳 15 岁，寄宿学校，高中。</p><p>2006 年，顾佳 18 岁，钟晓芹 18 岁，二人成为同学。</p><p>2008 年，顾佳 20 岁，大二，奥运志愿者，许幻山是烟火编程师，二人结识。</p><p>2010 年，顾佳 22 岁，大学毕业，入职外企，钟晓芹 22 岁，入职剧中的某商场物业，同年，王曼妮 22 岁，来上海发展。</p><p>2012 年，顾佳 24 岁，外企工作两年，辞职跟许幻山一起创业。</p><p>2015 年，顾佳 27 岁，成为全职妈妈，同年许子言出生。钟晓芹、陈屿结婚。</p><p>2018 年，三十而已剧情展开。</p><p>链接：<a href="https://www.zhihu.com/question/407383191/answer/1362595045" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/407383191/answer/1362595045</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[极客运营手册]]></title>
            <link>https://markshawn2020.github.io/blog/文集/极客运营手册/</link>
            <guid>/文集/极客运营手册/</guid>
            <pubDate>Sat, 29 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[计算机应用研究]]></description>
            <content:encoded><![CDATA[<blockquote><p>这是一份程序员运营公众号的极速指南</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="all-in-markdown">All in Markdown<a class="hash-link" href="#all-in-markdown" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="markdown-是什么">Markdown 是什么<a class="hash-link" href="#markdown-是什么" title="标题的直接链接">​</a></h3><blockquote><p>Markdown 是一种轻量级的标记语言，可用于在纯文本文档中添加格式化元素。Markdown 由 <a href="https://daringfireball.net/projects/markdown/" target="_blank" rel="noopener noreferrer">John Gruber</a> 于 2004 年创建，如今已成为世界上最受欢迎的标记语言之一。</p><p>--copied from <a href="https://www.markdown.xyz/getting-started/" target="_blank" rel="noopener noreferrer">Markdown 入门 | Markdown 指南中文版</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="markdown-vs-word">Markdown VS Word<a class="hash-link" href="#markdown-vs-word" title="标题的直接链接">​</a></h3><p>不可否认，Word 是一款十分优秀的产品，将所见即所得发挥到了极致。</p><p>但从体验上来说，由于 Word 自身的机制，启动速度较慢，不利于快速记录一些想法。紧接着，最为致命的，<strong>Word 的布局会让你更多地关注在内容的样式上而非样式本身</strong>。关于这一点，可以更多地去问问 Latex 一族，听听他们是如何对比 Word 与 Latex 的。</p><p>无论如何，抛开个人习惯与技术水平，<strong>Markdown 都比 Word 更适合记录结构化的文本信息</strong>，正因为如此，作为知识产出而非印刷交付，Markdown 比 Word 更适合作为文字的载体。</p><p>最后一点，<strong>Markdown 脱胎于 Html，它与网络媒体走的更近</strong>，我们可以很快地使用 CSS 调整 Markdown 在网页中的展示形式，而无需考虑内容其本身。此外，由于 Github 对 Markdown 的推行，它已经成为了程序员写文章的标配。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="markdown-如何学习">Markdown 如何学习<a class="hash-link" href="#markdown-如何学习" title="标题的直接链接">​</a></h3><p>Markdown 作为一门标记语言，事实上<strong>十分钟就能入门</strong>，接下来就是用最合适的工具反复操练，直到能够熟练地写出各种常用的文本格式（实在不记得也没事，搜索走一走就可以）。</p><p>此外，如果你和程序打交道比较多，比如对使用 Markdown 生成的博客站点感兴趣，你可能就要多研究<code>Marked</code>、<code>Markdown-it</code>以及<code>markdown-loader</code>之类的插件。当然了，这对于大多数人来说，是不需要的（即便是用 markdown 写文章并发布的程序员，因为这些已经过于底层了）。</p><p>最后，一些有用的资源：</p><ul><li><a href="https://www.markdown.xyz/getting-started/" target="_blank" rel="noopener noreferrer">Markdown 入门 | Markdown 指南中文版</a>（新手推荐）</li><li><a href="https://markdown-zh.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Markdown 中文文档</a>（速查手册）</li><li><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer">Mastering Markdown · GitHub Guides</a>（程序员推荐）</li></ul><p>接下来，就是升级我们的作战武器了。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="软件清单">软件清单<a class="hash-link" href="#软件清单" title="标题的直接链接">​</a></h2><table><thead><tr><th>名称</th><th>费用</th><th>作用</th><th>运营环节</th></tr></thead><tbody><tr><td>Typora</td><td>免费/开源</td><td>优雅的 Markdown 书写体验</td><td>1. 用于直接书写文章<br>2. 用于誊抄来自 word 之类的文章</td></tr><tr><td>PicGo</td><td>免费/开源</td><td>方便的多平台图床配置软件</td><td>将本地图片自动上传并返回网络链接</td></tr><tr><td>MdNice</td><td>免费/开源</td><td>优秀的 Markdown 渲染平台</td><td>用于在公众号平台内直接将 markdown 内容<br>转换成预设格式的内容（即自动排版）</td></tr><tr><td>Sublime</td><td>免费+<br>付费提示</td><td>强大的全平台代码写作工具</td><td>也许你用不上它，但如果你想要一款轻便、快速、美观的编辑器<br>帮助你打开任何一种编程语言，进行查看、修改甚至运行的话，<br>Sublime 完美符合你的需求（包括 Markdown）</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_rB0w" id="typora">Typora<a class="hash-link" href="#typora" title="标题的直接链接">​</a></h3><p>官网地址：<a href="https://typora.io/" target="_blank" rel="noopener noreferrer">Typora — a markdown editor, markdown reader.</a></p><p>直接下载安装即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="picgo">PicGo<a class="hash-link" href="#picgo" title="标题的直接链接">​</a></h3><p>官网地址兼手册：<a href="https://picgo.github.io/PicGo-Doc/zh/guide/#%E5%BA%94%E7%94%A8%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">介绍 | PicGo</a></p><p>直接下载地址：<a href="https://github.com/Molunerfinn/PicGo/releases" target="_blank" rel="noopener noreferrer">Releases · Molunerfinn/PicGo</a>，（windows 选择<code>[PicGo-Setup-2.3.0-beta.3.exe]</code>）</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="mdnice">MdNice<a class="hash-link" href="#mdnice" title="标题的直接链接">​</a></h3><p>官网地址兼直接编写平台：<a href="https://www.mdnice.com/" target="_blank" rel="noopener noreferrer">让微信排版变 Nice</a></p><p>MdNice 官方谷歌插件（强烈推荐，但需要翻墙）：<a href="https://chrome.google.com/webstore/detail/markdown-nice/blndbjkicjhcbpldeamfbdoeekcbampi?utm_source=chrome-ntp-icon" target="_blank" rel="noopener noreferrer">Markdown Nice - Chrome 网上应用店</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="sublime">Sublime<a class="hash-link" href="#sublime" title="标题的直接链接">​</a></h3><p>官网地址：<a href="https://www.sublimetext.com/" target="_blank" rel="noopener noreferrer">Sublime Text - A sophisticated text editor for code, markup and prose</a></p><p>配置教程：<a href="https://www.cnblogs.com/zhaof/p/8126306.html" target="_blank" rel="noopener noreferrer">让你用 sublime 写出最完美的 python 代码--windows 环境 - syncd - 博客园</a></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="图床平台">图床平台<a class="hash-link" href="#图床平台" title="标题的直接链接">​</a></h2><table><thead><tr><th>平台名称</th><th>平台表现</th><th>综合评价</th></tr></thead><tbody><tr><td>阿里云</td><td>体验十分不错，按文件夹上传就像处理本地文件一样，最近还体验了它的图片处理功能，十分强大：不用自己写后端，在图片链接上后置一些参数就可以实现图片的特定样式生成，比如压缩、旋转、裁剪等</td><td>我目前使用的平台，强烈推荐</td></tr><tr><td>七牛云</td><td>体验不错，但相较阿里云来说，功能与文档都不够详尽</td><td>我之前使用的平台，推荐</td></tr><tr><td>腾讯云</td><td>暂未体验</td><td></td></tr><tr><td><del>SM.MS</del></td><td>最大优点：无需注册。但公众号平台不支持 SM.MS 的图片链接，因此不考虑。</td><td></td></tr></tbody></table><p>备注：之所以还推荐七牛云，是因为我不太清楚阿里云与七牛云等平台的收费标准，但在一定限度内这些平台都是免费的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="实战技巧">实战技巧<a class="hash-link" href="#实战技巧" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-picgo-的配置与使用">1. picgo 的配置与使用<a class="hash-link" href="#1-picgo-的配置与使用" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-typora-的图片上传配置">2. typora 的图片上传配置<a class="hash-link" href="#2-typora-的图片上传配置" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-markdown-的图片引用方案">3. Markdown 的图片引用方案<a class="hash-link" href="#3-markdown-的图片引用方案" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="4-markdown-中-frontmatter-的作用">4. Markdown 中 frontmatter 的作用<a class="hash-link" href="#4-markdown-中-frontmatter-的作用" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="5-选用与自定义-mdnice-的主题">5. 选用与自定义 mdnice 的主题<a class="hash-link" href="#5-选用与自定义-mdnice-的主题" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="6-公众号平台中直接使用-mdnice">6. 公众号平台中直接使用 mdnice<a class="hash-link" href="#6-公众号平台中直接使用-mdnice" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="实战案例">实战案例<a class="hash-link" href="#实战案例" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="1-从-markdown-文档编写到公众号平台发布">1. 从 Markdown 文档编写到公众号平台发布<a class="hash-link" href="#1-从-markdown-文档编写到公众号平台发布" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="2-从-word-文档到-markdown-到公众号平台发布">2. 从 Word 文档到 Markdown 到公众号平台发布<a class="hash-link" href="#2-从-word-文档到-markdown-到公众号平台发布" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="3-从-markdown-文档到各平台同步发布">3. 从 Markdown 文档到各平台同步发布<a class="hash-link" href="#3-从-markdown-文档到各平台同步发布" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="markdown-与-html-的关系与未来">Markdown 与 Html 的关系与未来<a class="hash-link" href="#markdown-与-html-的关系与未来" title="标题的直接链接">​</a></h3><h3 class="anchor anchorWithStickyNavbar_rB0w" id="正确处理-markdown-与-word-的关系">正确处理 Markdown 与 Word 的关系<a class="hash-link" href="#正确处理-markdown-与-word-的关系" title="标题的直接链接">​</a></h3>]]></content:encoded>
            <category>计算机与软件</category>
        </item>
        <item>
            <title><![CDATA[When to Use Static Generation v.s. Server-side Rendering]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/13/ssg-ssr</link>
            <guid>/2020/09/13/ssg-ssr</guid>
            <pubDate>Thu, 02 Jan 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[We recommend using Static Generation (with and without data) whenever possible because your page can be built once and served by CDN, which makes it much faster than having a server render the page on every request.]]></description>
            <content:encoded><![CDATA[<p>We recommend using <strong>Static Generation</strong> (with and without data) whenever possible because your page can be built once and served by CDN, which makes it much faster than having a server render the page on every request.</p><p>You can use Static Generation for many types of pages, including:</p><ul><li>Marketing pages</li><li>Blog posts</li><li>E-commerce product listings</li><li>Help and documentation</li></ul><p>You should ask yourself: "Can I pre-render this page <strong>ahead</strong> of a user's request?" If the answer is yes, then you should choose Static Generation.</p><p>On the other hand, Static Generation is <strong>not</strong> a good idea if you cannot pre-render a page ahead of a user's request. Maybe your page shows frequently updated data, and the page content changes on every request.</p><p>In that case, you can use <strong>Server-Side Rendering</strong>. It will be slower, but the pre-rendered page will always be up-to-date. Or you can skip pre-rendering and use client-side JavaScript to populate data.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Two Forms of Pre-rendering]]></title>
            <link>https://markshawn2020.github.io/blog/2020/09/13/pre-rendering</link>
            <guid>/2020/09/13/pre-rendering</guid>
            <pubDate>Wed, 01 Jan 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Next.js has two forms of pre-rendering: Static Generation and Server-side Rendering. The difference is in when it generates the HTML for a page.]]></description>
            <content:encoded><![CDATA[<p>Next.js has two forms of pre-rendering: <strong>Static Generation</strong> and <strong>Server-side Rendering</strong>. The difference is in <strong>when</strong> it generates the HTML for a page.</p><ul><li><strong>Static Generation</strong> is the pre-rendering method that generates the HTML at <strong>build time</strong>. The pre-rendered HTML is then <em>reused</em> on each request.</li><li><strong>Server-side Rendering</strong> is the pre-rendering method that generates the HTML on <strong>each request</strong>.</li></ul><p>Importantly, Next.js lets you <strong>choose</strong> which pre-rendering form to use for each page. You can create a "hybrid" Next.js app by using Static Generation for most pages and using Server-side Rendering for others.</p>]]></content:encoded>
        </item>
    </channel>
</rss>