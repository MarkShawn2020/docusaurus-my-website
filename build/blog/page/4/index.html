<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">Blog | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/blog/page/4"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="Blog | 南川笔记"><meta data-rh="true" name="description" content="A Docusaurus powered blog!"><meta data-rh="true" property="og:description" content="A Docusaurus powered blog!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/blog/page/4"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/page/4" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/page/4" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a class="navbar__item navbar__link" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_P3nc thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_VrjY margin-bottom--md">All Posts</div><ul class="sidebarItemList_OSkG clean-list"><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-INFP与ENTJ的日日夜夜">2024/2422-INFP与ENTJ的日日夜夜</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-从FP走向TJ">2024/2422-从FP走向TJ</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/06/21/Rabbit-R1分享会">Rabbit-R1分享会</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/05/01/2419-信仰一跃">2419-信仰一跃</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/04/30/飞脑">飞脑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/discarded/微信聊天记录备份指南">微信聊天记录备份指南</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/01/14/觉醒的硅基">觉醒的硅基</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/31/index">[03-27-digital-travel] 南川数字游民之旅01：</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/27/南川骑行川藏线（下）">南川骑行川藏线（下）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白">十年 —— 一位自学者、技术工作者、理想主义者的独白</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/18/南川骑行川藏线（中）">南川骑行川藏线（中）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/09/25/当我想做一款吹羽毛小游戏……">当我想做一款吹羽毛小游戏……</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦">Poketto.AI: 每一个人的哆啦A梦</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/12/31/this-year">this-year</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/29/coding-cries">代码有所能，有所不能</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/03/taiwan-data-research">关于台湾进出口临时政策与历史数据的研究</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/01/wechat-hack">微信数据库破解</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/11/prose-I-am-me">札记 | 我与我周旋久，我亦是我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/11/dev-gopro-1">编程 | GoPro 01: 全天候自动 4K 延时摄影</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/06/dev-ios-automation">编程 | iOS 自动化实现王者荣耀一键换装</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/23/dev-mp3-meta">编程 | 逼哥的音乐元数据修复</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/22/evaluation-breo-dream6">评测 | Breo Dream6 按摩仪</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/15/prose-is-not-easy">札记 | 须知，活好是很不容易的</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/14/dev-voice2srt">编程 | 视频剪辑自动转写字幕</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/04/22/research-mbti/mark_mbti">研究 | 基于 MBTI 的人生复盘与计划（上）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/27/prose-321-air-crash">札记 | 愿逝者安息生者坚强，你我迎风奔跑向阳而生</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/09/dev-douban-renting">编程 | 北京租房系统设计、研究与经验 0.1.0</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/21/ad-beike-hiring">推广 | 贝壳新业务 VR 全职开发招募</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts">编程设计艺术思考（持续更新）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/03/prose-living">札记 | 2022，活着</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/02/dev-linux">编程 | Linux 笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/01/prose-2022-begining">札记 | 关于近几年的一些感悟</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/23/prose-engineer-cultivation">札记 | 一位工程师的自我修养（序）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/20/prose-first-job">札记 | 是的，我入职了</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/01/prose-my-2021">札记 | 我的 2021：混沌与洞见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/24/dev-webpack">编程 | 记与 Webpack 十二小时的奋战</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/一道“全军覆灭”的数学题">一道“全军覆灭”的数学题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/考研数学试题编辑">考研数学试题编辑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/28/今天南川学习十小时了吗？是的。">关于正态分布表的一个有趣发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/09/浅谈我自学编程的经历与经验">浅谈我自学编程的经历与经验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/28/关于有人想仲裁我">关于有人想仲裁我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/27/十月：无题">十月：无题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/18/王者荣耀打野上分经验总结（全干货）">王者荣耀打野上分经验总结</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/06/27/毕业一年：我的得与失">南川二一零六：毕业一年，我的失与得</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/05/12/记逆向攻破拼多多加密系统">南川逆向笔记 | 攻破 PDD 风控系统（一）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/04/14/从0到1搭建一个Electron应用">Electron 开发笔记 - 从 0 到 1 搭建一个 Electron 应用</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/03/12/shamghai-rent-lesson">记与上海无良房东斡旋经验与教训</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/01/09/评测-南川Effie使用初体验">南川 Effie 使用初体验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/11/20/拜登获胜演讲稿">拜登获胜演讲稿</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）">五台山论道（节选自《遥远的救世主》）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：一路失败，我到底学到了什么">大学沉思录：一路失败，我到底学到了什么</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：意向调查">大学沉思录：意向调查</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/22/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/15/投资：凯利公式">“中一千万”与“挣一千万”到底哪个更容易</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/bug_fix">BUG FIX</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/home">南川笔记中文首页</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/todo-old">待办事项</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/release-notes">更新日志</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/guestbook">留言墙</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/12/经验与发现">经验与发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/10/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/开发常用命令行">开发常用命令行</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/my_university">谨以此文，纪念我在大学的这四年</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/VuePress-Journal">VuePress你好，VuePres再见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/vue开发笔记">vue开发笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/博客开发之导航设计方案">博客开发之导航设计方案</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/如何向ElementUI一样封装Message全局组件">如何向ElementUI一样封装Message全局组件</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/如何给右键添加任何启动程序">如何给右键添加任何启动程序</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/我谈《三十而已》">我谈《三十而已》</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/极客运营手册/">极客运营手册</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/ssg-ssr">When to Use Static Generation v.s. Server-side Rendering</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/pre-rendering">Two Forms of Pre-rendering</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/08/03/taiwan-data-research">关于台湾进出口临时政策与历史数据的研究</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-08-03T00:00:00.000Z" itemprop="datePublished">2022/08/03</time> · <!-- -->阅读需 10 分钟</div></header><div class="markdown" itemprop="articleBody"><p>TODO: change this to reference (now it can&#x27;t since the docusaurus can&#x27;t parse the router)</p><blockquote><p>see: <code>./src</code></p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="进出口数据核验">进出口数据核验<a class="hash-link" href="#进出口数据核验" title="标题的直接链接">​</a></h2><p>起因是这张图：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659534982100-b4c1430be93e6b3e925f10ffc2e9d67b9826e2bfa5ccb86322d712932113f3fd.png" alt="picture 2" class="img_vXGZ">  </p><p>由于该博指出了数据来源：<a href="http://43.248.49.97" target="_blank" rel="noopener noreferrer">海关总署</a>，所以出于对数据准确性的兴趣，我也小小核验了一下。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="天然砂出口数据">天然砂出口数据<a class="hash-link" href="#天然砂出口数据" title="标题的直接链接">​</a></h3><p>首先给出第一个结论，关于天然砂的判断完全错误，大陆并非没有向湾湾出口天然砂。</p><p>当然，你在海关总署找到这个品类确实不是一件容易得事情，这主要是因为这个网站做的相当糟糕，不支持模糊搜索，也不说明字段设计（尽管可能是国际通用）。</p><p>你首先得知道商品编码分四个类级，分别采用2、4、6、8位数字，意思就是每一级最多有100个子类（完全够用了），然后天然砂（如果我们搜索没错的话）是属于第二大类，编码为2505（此外，还有一个叫“其他天然砂”的第三大类，编码为250590）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535217160-31d418b3e39bdcae8fe576c635a7d8294052b817caafe5f81a4075845f7a7866.png" alt="picture 3" class="img_vXGZ">  </p><p>出口如下，平均每个月100w人民币左右：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536259057-758d8bf03833afaef9ae4436379b59fad70598197cfe5be22956263c8b057d83.png" alt="picture 11" class="img_vXGZ">  </p><p>而且还没有1-3月数据，所以再看一下去年的数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536322770-766d762a3c077d4749eeb632ebe199078b9b64d11bbb247ab2dfa5858276b611.png" alt="picture 12" class="img_vXGZ">  </p><p>基本是一年1kw左右。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="冰鲜带鱼进口数据">冰鲜带鱼进口数据<a class="hash-link" href="#冰鲜带鱼进口数据" title="标题的直接链接">​</a></h3><p>图中提到的冰鲜带鱼其实应该是其子类“冰鲜白带鱼”：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535969347-ca7831ba9e365085abf90bb8f8c75155035f289e04f03830067216fb4eab19dc.png" alt="picture 9" class="img_vXGZ">  </p><p>但不管了，我们允许向上估计，同样的流程，我们搜索出比较对标的编码是 03028910,03038910 ：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659535925343-f1ebe82024b795114f894e02e8fda8d41355803943090835a1ece13f3395c2cf.png" alt="picture 8" class="img_vXGZ">  </p><p>结果如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536436688-3b648ae19ff76a02337aead795c3706e0072d21019157c48152de23b051156bc.png" alt="picture 13" class="img_vXGZ">  </p><p>大概每个月1600w左右，1-6月总值确实与其计算的3937w接近。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536588466-d0a98d4da2f0b19f814184d6381a5f3a7a90b6143613c7ddd3d8087853dd3a24.png" alt="picture 14" class="img_vXGZ">  </p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="冻竹荚鱼进口数据">冻竹荚鱼进口数据<a class="hash-link" href="#冻竹荚鱼进口数据" title="标题的直接链接">​</a></h3><p>同上处理，得到的数据也接近。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="结论">结论<a class="hash-link" href="#结论" title="标题的直接链接">​</a></h3><p>尽管天然砂出口湾湾的量并不大，还不及这几条鱼，但显然，互联网的信息传播依然很经不起推敲。</p><p>但如我和大家讨论的，我更关心天然砂对湾湾的产能影响：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536773953-056e0ea0f63bcaee224a9fd21654d3c02f4db109d866f80e24575c355e01caec.png" alt="picture 15" class="img_vXGZ">  </p><p>因为我找到了某个媒体新闻，说湾湾依赖大陆的天然砂达90%（2021年）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536811898-85986f96978444e76dc27e4065a3c2caf0be0d56230d29e7fe10c0462d9b5aa6.png" alt="picture 16" class="img_vXGZ">  </p><p>并称之为“捏到了台湾半导体制造业的七寸”。</p><p>那是否果真如此呢？</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="台湾天然砂进口分析">台湾天然砂进口分析<a class="hash-link" href="#台湾天然砂进口分析" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="与大陆系统对比分析">与大陆系统对比分析<a class="hash-link" href="#与大陆系统对比分析" title="标题的直接链接">​</a></h3><p>这一次，我们需要用到<a href="https://portal.sw.nat.gov.tw/APGA/GA30" target="_blank" rel="noopener noreferrer">台湾的海关总署</a>数据了。</p><p>这个平台做的就远比国内的海关总署数据用心多了，体验好非常多，前面那个就属实摆烂（国内政企saas的通病，故意让你用的不爽）。</p><p>不过除此使用，则会有意外的感受，那就是年份是从92到111，我脑子迅速地过了一下，2022-111=1911，好家伙，原来是以民国元年为第一年计算的……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659536906451-2aef8a67513d03224a68f580fb660a85bdd2e1f38d0f907a239a120c73fbaea1.png" alt="picture 17" class="img_vXGZ">  </p><p>不管这个啦，继续我们的研究。</p><p>刚刚我们说了编码是通用的，天然砂的编码是2505，所以我们直接输就可以。</p><p>可以看到，湾湾的软件就可以对出口和进口同时分类显示，这才是正常的设计：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537151246-4a93a45a380cc4631067cb02b43ca5e1b946382c96a25080ac4c1724304a60c3.png" alt="picture 18" class="img_vXGZ">  </p><p>然后只有美元和新台币两种计价单位，为了核算，我们一律使用美元，然后再把之前的国内海关署的台湾出口天然砂数据拉一下对比看看：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537264182-3fc91e5967787bb2b10160215d50e2526eec65c167b5694e00db2fa321c982a5.png" alt="picture 19" class="img_vXGZ">  </p><p>可以看到，国内显示对湾出口天然砂4月有16.17万美元，5月有15.015万美元，而湾湾显示对大陆进口天然砂个月有34.3万美元，5月有30.7万美元。</p><p>对不上。</p><p>不过注意，湾湾表示，这些字段是包含复进口的，所以多一点也许也可以理解。</p><p>不过令我最不解的是，国内只有个别月有数据，这显然是不正常的。</p><p>所以，假如湾湾是客观正确的，那么国内数据系统没有错的话，那就是人为降低了数据量。</p><p>那国内为啥会少报出口量呢，好像也没有道理，所以权当是数据系统错误吧。</p><p>反正那个系统（除了验证码都是准确的之外），你也不能指望能准到哪里去。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="大陆占比分析">大陆占比分析<a class="hash-link" href="#大陆占比分析" title="标题的直接链接">​</a></h3><p>接下来研究湾湾进口天然砂的大陆占比，是否果真达到了90%。</p><p>数据上，由于湾湾的海关数据系统做的非常好，所以我们很方便地能拿到湾湾从民国92年（2003）到111年（2022）从世界各国进口天然砂的数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659537732876-7b9b5ae100b662512f9b3935ea6a54c062a9291d63b5695f45e1592f921a9d70.png" alt="picture 20" class="img_vXGZ">  </p><p>然后我们只需要按年分组，分别求得中国进口金额、全球总计进口金额与其两者的比值，最终得到结果如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538239892-88ae51c1bfbf5f1b66da0ba466e387e18a2a15ca81c7314c23c880a98ad8c41d.png" alt="picture 22" class="img_vXGZ">  </p><p>很遗憾的是，06年及以前，台湾对大陆的天然砂确实依赖程度高达90%，但是09年之后就断崖式下跌，19年之后已完全在5%以下……</p><p>无话可说。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="台湾历年进出口数据国别分析">台湾历年进出口数据国别分析<a class="hash-link" href="#台湾历年进出口数据国别分析" title="标题的直接链接">​</a></h2><p>最后，趁着这个机会，研究一下台湾对各国进出口的情况。</p><p>由于年份和国家众多，想展示趋势并不太容易，所以敲定的方案就是选择十个典型国家，其他的用“others”去合计。</p><p>而这十个典型的国家，基于2021年湾湾进口金额前十的国家，它们依次是：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659539868919-29f54cb79952d07687c5d37ce41dd98507e0e9a4aee44cdc78b505fefc46330f.png" alt="picture 28" class="img_vXGZ">  </p><p>值得注意的是，前十的总和也只有 75%，说明湾湾的多边合作做的还是不错的。</p><p>最后直接上图吧：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538585259-fd683105da7e1b920502335a5af11403208bad891ce3f633d16b65e084fa58ec.png" alt="picture 23" class="img_vXGZ">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538594329-f7fd29256e42afde0efbe7cbddc40c18fb14ab45d74a6e3ddb6e860e2a8ed223.png" alt="picture 24" class="img_vXGZ">  </p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/08-03-taiwan-data-research-1659538600601-4f3ed108d5cd356ecda9f22381873c8b4633f6ad06b6954ec328df6bc2c76a3d.png" alt="picture 25" class="img_vXGZ">  </p><p>以上！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="代码">代码<a class="hash-link" href="#代码" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="代码一台湾天然砂进口分析">代码一：台湾天然砂进口分析<a class="hash-link" href="#代码一台湾天然砂进口分析" title="标题的直接链接">​</a></h3><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mpl_toolkits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axes_grid1 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> host_subplot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ticker </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> ScalarFormatter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PercentFormatter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;figure.dpi&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">320</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rcParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;font.sans-serif&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;Heiti TC&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Songti SC&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 1. data fetch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 台湾海关数据查询网址: https://portal.sw.nat.gov.tw/APGA/GA30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数设置：货品（天然砂）：2505</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;~/Downloads/綜合查詢_20220803143014.xls&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 2. data wash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">china_with_world</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    china </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;國家&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;中國大陸&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;美元(千元)&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;美元(千元)&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> china </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> total </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Series</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;total&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;china&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> china</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;pct&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;日期&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">r&#x27;\d+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1912</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">china_with_world</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">### step 3. data visualization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># scientific formatter, ref: https://atmamani.github.io/cheatsheets/matplotlib/matplotlib_2/#Numbers-on-axes-in-scientific-notation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formatter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ScalarFormatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">useMathText</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formatter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_powerlimits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># https://matplotlib.org/3.4.3/api/ticker_api.html#matplotlib.ticker.ScalarFormatter.set_powerlimits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># two kinds draw from dataframe: https://www.statology.org/matplotlib-two-y-axes/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> host_subplot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">111</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaxis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_major_formatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">formatter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">twinx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yaxis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_major_formatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PercentFormatter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">total</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;全部&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">china</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;大陆&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;g-o&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> linewidth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;大陆占比&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">zip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ax2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">j</span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.0f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">xy</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;magenta&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.99</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;台湾天然砂进口数据&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;center&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> va</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;top&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.92</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;data source：https://portal.sw.nat.gov.tw/APGA/GA30&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;right&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;gray&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;italic&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.89</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;design: markshawn, Aug 2, 2022&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ha</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;right&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;gray&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;italic&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figtext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">.18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">.895</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;美元&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;italic&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xticks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rotation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">45</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Rotates X-Axis Ticks by 45-degrees</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="代码二台湾历年进出口分析">代码二：台湾历年进出口分析<a class="hash-link" href="#代码二台湾历年进出口分析" title="标题的直接链接">​</a></h3><div class="language-python codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-python codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 数据：https://portal.sw.nat.gov.tw/APGA/GA30_LIST</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">preprocess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_excel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;進出口別&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;日期&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;國家&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;country&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;貨品號列&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;good_kind_id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;中文貨名&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;good_kind_name_cn&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;英文貨名&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;good_kind_name_en&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;美元(千元)&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;\d+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1912</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addTotalRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    totalRow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numeric_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_frame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Total&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> totalRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calcDir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;顺差&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;出口總值(含復出口)&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;進口總值(含復進口)&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getTopCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> io</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;進口總值(含復進口)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> year</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2021</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> N</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;io==&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">io</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot; and year==</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">year</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dff</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;country&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    total </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;total: &#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> total</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;pct&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> dfs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">N</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">squashCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;country in </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">topCountries</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sumOthers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;country not in </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">topCountries</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newRows </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;country&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;others&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;amount_k&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sumOthers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cur</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newRows</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleYear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> squashCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;country&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">plotTrend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kind</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;bar&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stacked</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bbox_to_anchor </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> loc</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;center left&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">suptitle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleIO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleYear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plotTrend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">showTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> addTotalRow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">columns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;金额（亿美金）&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount_k </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;全球占比&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">x</span><span class="token string-interpolation interpolation operator" style="color:#393A34">*</span><span class="token string-interpolation interpolation number" style="color:#36acaa">100</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">%&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;amount_k&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pct&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> preprocess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/Users/mark/Downloads/綜合查詢_20220803190515.xls&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;country&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;year&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calcDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dfTopCountries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> getTopCountries</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dfTopCountries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topCountries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfTopCountries</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df2\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;io&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleIO</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/08/01/wechat-hack">微信数据库破解</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-08-01T00:00:00.000Z" itemprop="datePublished">2022/08/01</time> · <!-- -->阅读需 33 分钟</div></header><div class="markdown" itemprop="articleBody"><ul><li><a href="#%E9%A1%B9%E7%9B%AE%E5%B1%95%E7%A4%BA">项目展示</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%BE%AE%E4%BF%A1%E5%A5%BD%E5%8F%8B%E4%BF%A1%E6%81%AF">获取所有微信好友信息</a></li><li><a href="#%E5%AF%BC%E5%87%BA%E4%B8%8E%E5%BE%AE%E4%BF%A1%E5%A5%BD%E5%8F%8B%E7%9A%84%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95">导出与微信好友的聊天记录</a></li><li><a href="#%E7%9B%91%E6%8E%A7%E5%AE%9E%E6%97%B6%E8%81%8A%E5%A4%A9">监控实时聊天</a></li><li><a href="#%E5%85%B6%E4%BB%96">其他</a></li></ul></li><li><a href="#%E5%8A%A8%E6%9C%BA%E8%83%8C%E6%99%AF">动机背景</a></li><li><a href="#%E6%8A%80%E6%9C%AF%E6%A6%82%E8%A7%88">技术概览</a><ul><li><a href="#github-search-until-wechat-decipher-macos">github search until <code>wechat-decipher-macos</code></a></li><li><a href="#macoseavesdropperd"><code>macos/eavesdropper.d</code></a></li><li><a href="#macosdbcrackerd"><code>macos/dbcracker.d</code></a></li><li><a href="#pcbakchatgatherd"><code>pcbakchat/gather.d</code></a></li><li><a href="#develxloggerd"><code>devel/xlogger.d</code></a></li><li><a href="#%E6%80%BB%E7%BB%93">总结</a></li><li><a href="#update2022-02-08-%E5%85%B3%E4%BA%8E%E5%8A%A0%E5%AF%86%E5%AD%97%E6%AE%B5">update@2022-02-08: 关于加密字段</a></li></ul></li><li><a href="#reference">reference</a><ul><li><a href="#%E5%90%84%E5%A4%A7%E5%B9%B3%E5%8F%B0%E4%BB%93%E5%BA%93%E5%90%88%E9%9B%86">各大平台仓库合集</a></li><li><a href="#mac%E7%89%88">mac 版</a></li><li><a href="#windows%E7%89%88">windows 版</a></li><li><a href="#ios%E7%89%88">ios 版</a></li><li><a href="#sqlcipher-%E7%9B%B8%E5%85%B3"><code>sqlcipher</code> 相关</a></li><li><a href="#pragma-%E7%9B%B8%E5%85%B3"><code>pragma</code> 相关</a></li><li><a href="#frida-%E7%9B%B8%E5%85%B3"><code>frida</code> 相关</a></li></ul></li><li><a href="#hack-manual">hack manual</a><ul><li><a href="#download-sqlite">download sqlite</a></li><li><a href="#test-sqlite">test sqlite</a></li><li><a href="#install-openssl-to-replace-the-built-in-libressl-on-macos">install <code>openssl</code> to replace the built-in <code>libressl</code> on MacOS</a><ul><li><a href="#install-openssl-via-brew">install <code>openssl</code> via <code>brew</code></a></li><li><a href="#config-openssl-into-path">config <code>openssl</code> into path</a></li><li><a href="#confirm-openssl">confirm openssl</a></li></ul></li><li><a href="#compile-sqlcipher">compile <code>sqlcipher</code></a></li><li><a href="#update-%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91">UPDATE: 静态编译</a></li><li><a href="#test-sqlcipher-workflow">test <code>sqlcipher</code> workflow</a><ul><li><a href="#step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before">step 1. crypto a plain database (which is generated by our <code>sqlite</code> before)</a></li><li><a href="#step2-test-operate-on-an-encrypted-database-without-key-expect-failure">step2. test: operate on an encrypted database without key (expect: failure)</a></li><li><a href="#step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success">step3. test: dump the encrypted database into plain with key (expect: success)</a></li><li><a href="#step4-test-open-the-decrypted-database-without-key-expect-success">step4. test: open the decrypted database without key (expect: success)</a></li></ul></li><li><a href="#sparklessparkles-decrypt-database">✨✨ decrypt database</a><ul><li><a href="#depreciated-pragma-config-of-sqlcipher-3-defaults">DEPRECIATED: pragma config of sqlcipher 3 defaults</a></li><li><a href="#best-practice-pragma-config-of-sqlcipher-3-defaults">BEST-PRACTICE: pragma config of sqlcipher 3 defaults</a></li><li><a href="#check-salt-of-specific-database-file">check salt of specific database file</a></li><li><a href="#decrypt-and-dump-specific-database-file">decrypt and dump specific database file</a></li><li><a href="#test-dumped-database-file-via-sqlcipher-or-sqlite3">test dumped database file (via <code>sqlcipher</code> or <code>sqlite3</code>)</a></li></ul></li></ul></li><li><a href="#wechat-design">wechat design</a><ul><li><a href="#design-of-contact-fields">design of contact fields</a></li><li><a href="#design-of-user-id-to-contact-id-md5">design of user id to contact id: <code>md5</code></a></li><li><a href="#improve-get-self-id">IMPROVE: get self id</a></li><li><a href="#todo-get-image-from-xml">TODO: get image from xml</a></li></ul></li><li><a href="#py-sqlcipher-instruction">py-sqlcipher instruction</a><ul><li><a href="#compile">compile</a></li><li><a href="#connection">connection</a></li><li><a href="#table">table</a><ul><li><a href="#list-all-the-tables">list all the tables</a></li><li><a href="#list-the-columns-of-table-get-table-schema">list the columns of table (get table schema)</a></li><li><a href="#format-rows-display">format rows display</a></li><li><a href="#list-rows-in-one-table">list rows in one table</a></li></ul></li></ul></li><li><a href="#extended">extended</a><ul><li><a href="#how-to-know-my-openssl-versioninfo">how to know my openssl version/info</a></li><li><a href="#bugfix-error-c-compiler-cannot-create-executables">bugfix: <code>error: C compiler cannot create executables</code></a></li></ul></li><li><a href="#%E6%9C%AC%E9%A1%B9%E7%9B%AE%E5%90%88%E4%BD%9C%E4%BC%99%E4%BC%B4">本项目合作伙伴</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="项目展示">项目展示<a class="hash-link" href="#项目展示" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="获取所有微信好友信息">获取所有微信好友信息<a class="hash-link" href="#获取所有微信好友信息" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136070132-9386a758919031c4082e3fd702273d38499aa3157ce2906861583e87a0f7d41a.png" alt="picture 86" class="img_vXGZ"></p><p>derived from hacked db: <code>Contact/wccontact_new2.db</code></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="导出与微信好友的聊天记录">导出与微信好友的聊天记录<a class="hash-link" href="#导出与微信好友的聊天记录" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136499656-9a9e5597f347af566ceba6f711c905b58bf81370b11c9b551df3ceed6dbe3e10.png" alt="picture 87" class="img_vXGZ"></p><p>derived from hacked dbs: <code>Message/msg_*.db</code></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="监控实时聊天">监控实时聊天<a class="hash-link" href="#监控实时聊天" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644136566951-029db895a57dcce825b718f2c02eb4442595ca622b30dc304b0730ca43c83a45.png" alt="picture 88" class="img_vXGZ"></p><p>derived from real-time terminal</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_rB0w" id="动机背景">动机背景<a class="hash-link" href="#动机背景" title="标题的直接链接">​</a></h2><p>一切，都要从南川的计算机小群里 <code>Shining Lavender</code> 和 <code>Le Penseur</code> 同学聊到“爱”这个高深的话题，继而聊到了“soulmate”，而我最近恰好看了《Intouchables》：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644105366255-7f103adb1dbc36f747db75146f8585756fb59d54ea52e5bf60df4ee4f24ec24b.png" alt="picture 66" class="img_vXGZ"></p><p>所以和 <code>Le Penseur</code> 同学一下探讨到了凌晨……</p><p>上半场刚结束，基友群表示对这个话题也很感兴趣，遂我们又来回肝完了半个通宵。</p><p>下半场也结束后，我发现我很想把这些闪烁智慧与思考、彭拜着荷尔蒙与伤感的青春文字记录整理下来，但是无奈微信未能提供满足我这种需求的便利。</p><p>自然而然地，作为一名合格的程序员，兵来将挡水来土掩，我们又上场了……</p><p>历时一天，彻底拿下！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="技术概览">技术概览<a class="hash-link" href="#技术概览" title="标题的直接链接">​</a></h2><p>思路还是比较通用的。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="github-search-until-wechat-decipher-macos">github search until <code>wechat-decipher-macos</code><a class="hash-link" href="#github-search-until-wechat-decipher-macos" title="标题的直接链接">​</a></h3><p>首先，第一步，去 <code>github</code> 搜索是否已经有破解微信聊天记录相关的开源仓库，结果，应有尽有，一应尽全 - <a href="https://github.com/search?q=wechat+history" target="_blank" rel="noopener noreferrer">Search · wechat history</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644107134293-92350d3d13791ae819981fdc8c57d10005f87b3a67af3d83477ca6170566d38d.png" alt="picture 68" class="img_vXGZ"></p><p>可以看到，至少在这一页前几个仓库中，安卓、iOS、mac 都有，windows 倒不确定。</p><p>我目前手机用的是安卓，电脑是 mac，但我用电脑比较多，所以我倾向于选择 mac 的方案，于是第一选择这个仓库 - <a href="https://github.com/nalzok/wechat-decipher-macos" target="_blank" rel="noopener noreferrer">nalzok/wechat-decipher-macos: Scripts to extract chat history from WeChat on macOS</a></p><p>不过这个仓库，起手难度可不低，仓库介绍十分简练，但真的是字字珠玑！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644107483092-cfb440bb5ad7cb61932c7d7f68c796bc966e40a97e3afec36f715c951008a13e.png" alt="picture 70" class="img_vXGZ"></p><p>对于用户（我）来说，这个仓库的主要功能在前三者，一定要仔细理解，每个字都很宝贵：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="macoseavesdropperd"><code>macos/eavesdropper.d</code><a class="hash-link" href="#macoseavesdropperd" title="标题的直接链接">​</a></h3><p><code>macos/eavesdropper.d</code>是用于实时、高速打印微信与数据库之间的信息流的，具体什么样子呢？我运行一下给你们看一下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108103693-89dccd5c3c7ffd9fa7fcd17120f0a21253dff4a8a8fbe9a28003ae06e6acd5e2.png" alt="picture 72" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108029952-190572feae187736fdd39670cdd6c0530ca02d572880ef6567b45a92937710e2.png" alt="picture 71" class="img_vXGZ"></p><p>可以看到，我在微信中发送的聊天内容，会被明文显示到控制台中，并且在不同的时间点被打印了两遍。</p><p>当然，这不是微信自己打印的，是我们（他的）脚本打的，并且把结构体都打出来了，这个结构体和最终存到数据库里的数据结构基本是差不多的。</p><p>比如这是我们数据库中的样子：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644108568767-1a6f573f038fc329ebc643aa5d2cae05060209952f9da6572cb7f693e5d866e0.png" alt="picture 73" class="img_vXGZ"></p><p>但是，由于这是用于实时的，也就是过去的就没有了，所以不满足我的需求，因为我也没有深究这个脚本（比如为啥打印两次，强迫症的我接受不了，至少接受不了这么大面积的冗余）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="macosdbcrackerd"><code>macos/dbcracker.d</code><a class="hash-link" href="#macosdbcrackerd" title="标题的直接链接">​</a></h3><p>其实我一开始没有看懂<code>macos/dbcracker.d</code>这个脚本用来干啥的，并且以为第四个脚本<code>devel/xlogger.d</code>才是我的目标，但显然，这个想法错的离谱。</p><p><code>cracker</code>是“撕裂者”的意思，<code>dbcracker</code>就是“数据库撕裂者”，听起来还是很可怕吧！</p><p><strong>事实上，它真地很可怕 ！</strong></p><p><strong>而且，我后续所有的工作都是基于它完成的！</strong></p><p>但它的操作，就没有第一个脚本 <code>macos/eavesdropper.d</code>那么容易上手了。</p><p>首先，注意它的描述：<code>Since it can only capture secrets when WeChat.app opens these files, you need to perform a login while the script is running.</code>，也就是你需要先运行脚本，然后重启微信，才能看到效果。</p><p>不过经过我的测试，正确流程是这样的，先退出微信登录（或者直接杀掉，然后启动），保留微信在登录界面（但还没有登录），接着运行脚本（否则会报基于没有进程导致的后续错误），然后扫码登录成功，这个时候就能飞速地看到命令行有很多数据在跑了，其实就是微信所有（大部分）的数据库的文件位置、秘钥、参数等。</p><p>值得注意的是，秘钥是用来干啥的。</p><p>一般用惯了<code>mysql</code>或者<code>mongodb</code>之类数据库的人（别”人“了，就是我），其实根本不知道这个秘钥（既然不是用户密码）用来干嘛，这才是本项目的第一大难点。</p><p>这个时候，细心地读下一句：<code>Simply copy &amp; paste the script output to invoke SQLCipher and supply the respective PRAGMAs.</code>，翻译过来就是，把命令行的输简单地出复制粘贴，已启动<code>SQLCipher</code>并分别用于<code>PRAGMA</code>。</p><p>很绕，也一脸懵逼是不，是就对了！</p><p>答案在那个超链接 <a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a> 上，所以你为了使用 A 项目，不得不去先啃 B 项目了。</p><p>但实际上，<code>sqlcipher</code>更难看懂，尤其是一上来就教你怎么编译，非常硬核（然而还有坑）：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644109309058-9d622be690c067975eaea80a80f4a42c9499abc22492987a84ac599e8df57cc1.png" alt="picture 74" class="img_vXGZ"></p><p>编就编吧，还有依赖，看看：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">You must define SQLITE_HAS_CODEC and either SQLITE_TEMP_STORE=2 or SQLITE_TEMP_STORE=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You will need to link against a support cryptographic provider (OpenSSL, LibTomCrypt, CommonCrypto/Security.framework, or NSS)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>让我们定义变量（一开始以为是环境变量，后来发现是头文件内部变量），还要链接一个加密库……</p><p>一脸懵逼吧。</p><p>我一开始也看不懂，然后瞎编了一下。</p><p>结果果然报错了……</p><p>接着就一顿乱搜，然后找到了对本项目影响最大的一篇博客：- <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">(25 条消息) Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a>。</p><p>这个事实充分证明，只要你想干的事情足够大众，你就能找到非常不错的伙伴，或者说，前辈。</p><p>该文章基本包括了<code>sqlcipher</code>如何编译、安装的问题，以及（非常前瞻性地）解决了里面的一些坑，节省了我可期的很多时间。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644130239719-433993ab017e150fd403cf6f0fe102a3602183aa1ae9a2ecea6a158d8b1fda6e.png" alt="picture 75" class="img_vXGZ"></p><p>基于这篇文章，我熟悉了 <code>sqlcipher</code> 的使用，意识到 <code>sqlcipher</code> 是 <code>sqlite3</code> 的加密版，每个数据库可以独立地用一个<code>KEY</code>加密，然后还可以解密，并导出无加密版本的<code>sqlite3</code>。</p><p>所以在那之后，我才真正地意识到 <code>macos/dbcracker.d</code> 是用来干什么的：</p><ol><li>用该脚本，通过监听微信启动时打开数据库的动作，暴露微信所有数据库的文件位置与秘钥信息</li><li>接下来数据库秘钥都有了，做啥就取决于自己了，比如说把所有好友的信息都导出成一张 excel 表这种</li></ol><p>以下是该脚本监控到的数据库，与微信实际数据库对比。</p><p>Almost all (especially the core ones, such as Contacts/Messages relative) the tables are tracked.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082483000-9d84d84536dbcbdcee54074954060a9d798375d608d3b1f67c60b4afcf5fd206.png" alt="picture 54" class="img_vXGZ"></p><p>Hence, it&#x27;s pretty good for our further work.</p><p>Also, the <code>db-list.txt</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082665967-654ab2912014189f77101b76367871983ab657d7318233475a776c032ba756fe.png" alt="picture 55" class="img_vXGZ"></p><p>And the <code>db-list-tracked.txt</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082727437-9dff122b852aacc64580230804b033baf509e62fd1266f8b4d682369ff172228.png" alt="picture 56" class="img_vXGZ"></p><p>The <code>track.log</code> is derived from:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644082780616-f364e35190d91279aa6dd8346429605b7bbc93b8baae3c33a2b6487cd94dfd74.png" alt="picture 57" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="pcbakchatgatherd"><code>pcbakchat/gather.d</code><a class="hash-link" href="#pcbakchatgatherd" title="标题的直接链接">​</a></h3><p>这个脚本其实也挺有用的，它能捕获备份时的数据流。</p><p>在说这个之前，我们有必要明确一下微信中的备份是啥意思（尤指 mac 平台）。</p><p>其实是这样的， 由于登录设备差异，同一个微信账户在不同设备（win、mac、ios、android）上的聊天记录是不完全一致的，一般手机上的才是完整的，电脑上（如果你没有一直登）是不完整的。</p><p>所以 mac 平台上的备份就包括</p><ol><li>从手机备份到 mac</li><li>从 mac 备份到手机</li></ol><p>我一开始以为备份是指把 mac 上的数据备份到另一个文件夹内，这个理解是不对的，其实如果去看微信的数据库设计部分，每个数据库是有单独的<code>.db.bak</code>的，尽管不大（也许里面压根就没有备份的数据，或者是压缩后的），但微信确实都有数据库级别备份的意图。</p><p>那无论是从手机备份到 mac 还是从 mac 备份到手机，都涉及到两台机器之前通信的问题，再明确一点，他们要彼此在同一个局域网内，用 socket 进行文件传送的。</p><p>所以其实 <code>pcbakchat/gather.d</code>就是劫持这部分局域网通信，把所有要备份的聊天记录都曝光出来，达到了给我们自己处理的目的。</p><p>具体可以见本仓库对备份部分的详细说明 - <a href="https://github.com/nalzok/wechat-decipher-macos/tree/main/devel" target="_blank" rel="noopener noreferrer">wechat-decipher-macos/devel at main · nalzok/wechat-decipher-macos</a>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644130960943-7e25936bcc8028c4eb34ffc5a2c09900211965a997718ded3f559f7fc6a7ae21.png" alt="picture 76" class="img_vXGZ"></p><p>可以看到还是比较复杂的，我一开始本来是走的这个思路，但是当时我还没对微信的数据库有较高的认识，所以当时这个方案跑起来了但是我没用。</p><p>其实这个方案应该最适合我的需求，因为我想获得的好友/群组的信息是已知的、数量不多的，我可以分别对这几个好友/群组进行备份动作，这样可以很方便地直接得到与他们的聊天记录（还可以在备份时选择时间，并且是手机上的聊天记录，也就是更完整）。</p><p>但考虑到我后来一直在研究数据库加解密上，并且在获得数据库秘钥之后，通过操作数据库也能获得我所有想要的聊天记录（因为当时我聊天的部分恰好都在 mac 上），所以 <code>macos/dbcracker.d</code> 已经能够满足我的要求。</p><p>所以本篇也会重点基于 <code>macos/dbcracker.d</code> 进行介绍，尽管 <code>pcbakchat/gather.d</code> 更适合导出与指定好友的（更完整的）聊天记录，更具有“社会”价值，但前者更具有“娱乐”（bushi，研究）价值。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="develxloggerd"><code>devel/xlogger.d</code><a class="hash-link" href="#develxloggerd" title="标题的直接链接">​</a></h3><p>这个其实就是把 mac 微信上所有的消息流都劫持了，打印出非常多的东西，所以只适合“黑客”自己二度开发相要的功能。</p><p>我们的需求没必要用这个，并且它一打开，微信就卡死了……可能是影响了微信的运行速度，然后假死，这是异常行为，可能有封号风险，所以谨慎。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="总结">总结<a class="hash-link" href="#总结" title="标题的直接链接">​</a></h3><p>我们全部的工作，主要还是建立在 - <a href="https://github.com/nalzok/wechat-decipher-macos" target="_blank" rel="noopener noreferrer">nalzok/wechat-decipher-macos: Scripts to extract chat history from WeChat on macOS</a> 的基础上，<code>Qingyao Sun</code>做了出色的工作（尽管部分地方有一些瑕疵），没有他精致（还记得我怎么评价的吗？“字字珠玑”）的项目文档，与合理的项目结构设计，我是不太可能一到两天就“攻破”微信的数据库的，感谢！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644131537140-b4113df9c6055f65ec8d2cd43d0423a9246884e02b0d9379c85db0315f91c831.png" alt="picture 77" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="update2022-02-08-关于加密字段">update@2022-02-08: 关于加密字段<a class="hash-link" href="#update2022-02-08-关于加密字段" title="标题的直接链接">​</a></h3><p>备份数据库的<code>cipher_page_size</code>不是默认值（1024），而是 4096！</p><p>所以原作中打印出这些信息是很有必要的!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644311729706-1de6652c04e0493ac7ba53cfeb35af14784e1351923142709da40f726c039501.png" alt="picture 19" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="reference">reference<a class="hash-link" href="#reference" title="标题的直接链接">​</a></h2><blockquote><p>如果您想自己攻破微信的数据库系统，以下是一些我认为比较核心的参考资料，包括各大平台的。</p><p>万变不离其中的是，微信的数据库使用的是基于<code>sqlite3</code>加密的<code>sqlcipher</code>，并且是<code>sqlcipher 3 defaults</code>配置，所以理解与熟悉该数据库才是全部工作的最大攻坚战。当你攻破之后，怎么做，就是你的事情了。</p><p>⚠️ 友情提醒：不要乱动微信的数据库，否则引起的一切后果，与本文无关，本文不涉及任何修改微信数据库的实现</p></blockquote><h3 class="anchor anchorWithStickyNavbar_rB0w" id="各大平台仓库合集">各大平台仓库合集<a class="hash-link" href="#各大平台仓库合集" title="标题的直接链接">​</a></h3><ul><li><a href="https://github.com/search?q=wechat+history" target="_blank" rel="noopener noreferrer">Search · wechat history</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="mac-版">mac 版<a class="hash-link" href="#mac-版" title="标题的直接链接">​</a></h3><ul><li>mac 版详细教程：<a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="windows-版">windows 版<a class="hash-link" href="#windows-版" title="标题的直接链接">​</a></h3><ul><li>windows 版详细教程：<a href="https://bbs.pediy.com/thread-251303.htm" target="_blank" rel="noopener noreferrer">[原创]PC 版微信数据库解密详细教程-软件逆向-看雪论坛-安全社区|安全招聘|bbs.pediy.com</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="ios-版">ios 版<a class="hash-link" href="#ios-版" title="标题的直接链接">​</a></h3><ul><li><a href="https://daily.zhihu.com/story/8807166" target="_blank" rel="noopener noreferrer">知乎日报 - 知乎</a></li><li><a href="https://github.com/stomakun/WechatExport-iOS" target="_blank" rel="noopener noreferrer">stomakun/WechatExport-iOS: Save iOS WeChat history as HTML or TXT with neat layout and picture &amp; audio support.</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="sqlcipher-相关"><code>sqlcipher</code> 相关<a class="hash-link" href="#sqlcipher-相关" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644134209068-2d046f82a3ae99e9704b64974a0444567cc9955e47a1ef2cc419ce53671d9cd4.png" alt="picture 79" class="img_vXGZ"></p><ul><li><p><code>sqlcipher</code>官方版本（提供了启动指引）：<a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a></p></li><li><p>python 版本<code>sqlcipher</code>: <a href="https://github.com/rigglemania/pysqlcipher3" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a></p></li><li><p>✨可视化软件（前期验证登录帮了大忙）：<a href="https://sqlitebrowser.org/dl/" target="_blank" rel="noopener noreferrer">Downloads - DB Browser for SQLite</a></p></li><li><p><code>sqlcipher</code> （商业）官方网站：<a href="https://www.zetetic.net/sqlcipher/" target="_blank" rel="noopener noreferrer">SQLCipher - Zetetic</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="pragma-相关"><code>pragma</code> 相关<a class="hash-link" href="#pragma-相关" title="标题的直接链接">​</a></h3><blockquote><p><code>pragma</code> 是 <code>sqlite3</code> 中的一种关键字，具体我也不太懂，我们项目只需要会用很简单的几条语句即可，是操作 <code>sqlcipher</code> 必须的。</p></blockquote><ul><li>✨✨<code>pragma</code>核心语句（包括算法部分）：<a href="https://utelle.github.io/SQLite3MultipleCiphers/docs/configuration/config_sql_pragmas/#pragma-hmac_algorithm" target="_blank" rel="noopener noreferrer">SQL Pragmas | SQLite3 Multiple Ciphers</a></li><li>✨ <code>sqlcipher</code>相关接口实现：<a href="https://github.com/Tencent/sqlcipher/blob/4f37c817eb99e18e4fdc8ac63d67ac33610d66be/src/crypto_impl.c" target="_blank" rel="noopener noreferrer">sqlcipher/crypto_impl.c at 4f37c817eb99e18e4fdc8ac63d67ac33610d66be · Tencent/sqlcipher</a></li><li><code>pragma</code>部分语句（没有算法部分）：<a href="https://www.sqlite.org/pragma.html" target="_blank" rel="noopener noreferrer">Pragma statements supported by SQLite</a></li><li><code>pragma</code>部分语句（也没有算法部分）：<a href="https://www.runoob.com/sqlite/sqlite-pragma.html" target="_blank" rel="noopener noreferrer">SQLite PRAGMA | 菜鸟教程</a></li><li>其他<code>pragma</code>相关问题：<a href="https://juejin.cn/post/6844903983899738126" target="_blank" rel="noopener noreferrer">如何降级加密的 Sqlite 数据库文件 - 掘金</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="frida-相关"><code>frida</code> 相关<a class="hash-link" href="#frida-相关" title="标题的直接链接">​</a></h3><blockquote><p><code>frida</code> 是用于逆向的，原以为要用到，后来发现没有（至少我的应用级别没用到），也是捏了一把冷汗。以防需要，所以也补一份。项目底层监控微信部分，应该是用到了 <code>frida</code> 的。</p></blockquote><ul><li><a href="https://frida.re/" target="_blank" rel="noopener noreferrer">Frida • A world-class dynamic instrumentation framework | Inject JavaScript to explore native apps on Windows, macOS, GNU/Linux, iOS, Android, and QNX</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="hack-manual">hack manual<a class="hash-link" href="#hack-manual" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="download-sqlite">download sqlite<a class="hash-link" href="#download-sqlite" title="标题的直接链接">​</a></h3><p>download any sqlite versions from here <a href="https://www.sqlite.org/download.html" target="_blank" rel="noopener noreferrer">SQLite Download Page</a> or directly download mac (x86) version from <a href="https://www.sqlite.org/2022/sqlite-tools-osx-x86-3370200.zip" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/2022/sqlite-tools-osx-x86-3370200.zip</a></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="test-sqlite">test sqlite<a class="hash-link" href="#test-sqlite" title="标题的直接链接">​</a></h3><p>unzip the downloaded sqlite zip, and test the sqlite.</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">➜  sqlite-tools-osx-x86-3370200 tree .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sqldiff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sqlite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sqlite3_analyzer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 directories, 3 files</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644051236520-b24b75cf94124fd18e0e540dba9d639924e0b3886bac991f0d816a301f9195ce.png" alt="picture 14" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="install-openssl-to-replace-the-built-in-libressl-on-macos">install <code>openssl</code> to replace the built-in <code>libressl</code> on MacOS<a class="hash-link" href="#install-openssl-to-replace-the-built-in-libressl-on-macos" title="标题的直接链接">​</a></h3><p>!!!warning <code>brew</code> need to be pre-installed</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="install-openssl-via-brew">install <code>openssl</code> via <code>brew</code><a class="hash-link" href="#install-openssl-via-brew" title="标题的直接链接">​</a></h4><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">brew install openssl</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="config-openssl-into-path">config <code>openssl</code> into path<a class="hash-link" href="#config-openssl-into-path" title="标题的直接链接">​</a></h4><p>According to the brew instruction on openssl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644051857192-ba13ebef60caf744ce20b9a323a616f7f32555fd0b5b9005145cda243ecfc645.png" alt="picture 15" class="img_vXGZ"></p><p>We can directly write all the three commands into shell and make them work:</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"># if you use bash, change $SHELL to be `~/.bashrc`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SHELL=~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;&gt; $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export PATH=&quot;/usr/local/opt/openssl@3/bin:$PATH&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export LDFLAGS=&quot;-L/usr/local/opt/openssl@3/lib&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export CPPFLAGS=&quot;-I/usr/local/opt/openssl@3/include&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; export PKG_CONFIG_PATH=&quot;/usr/local/opt/openssl@3/lib/pkgconfig&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heredoc&gt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source $SHELL</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>result</p></blockquote><p>before changing openssl, the default openssl is libressl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052002163-d79b3d78530e7e5b36887fcdef9c06839cbec11de0eb37e30d6304d78168fd2f.png" alt="picture 16" class="img_vXGZ"></p><p>after that it becomes openssl:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052027060-7263c604b5c8466f67e9a83b5b8900712952f6f2092d8cbde50fc8856536cc5d.png" alt="picture 17" class="img_vXGZ"></p><p>!!!tip 因为将 openssl 的路径加入了 path（并且在默认搜索路径之前），所以现在输入<code>openssl</code>会优先检索到我们的 openssl，如果想换回默认的<code>libressl</code>，则一方面可以在<code>~/.zshrc</code>配置文件中把我们新加入的几句话注释掉，这样每次重启 SHELL 就不会有；同时，我们还要在 SHELL 中重置一下 path，如下：</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">![picture 19](https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644052792755-dfbab4a924d8531c5199ef3f75dc6c635ba7f965452f14a7e7f701cc735d93dd.png)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">参考:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [How to Reset the PATH Variable on Mac to Default macOS PATH](https://techpp.com/2021/09/13/reset-path-variable-on-mac-guide/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- [macos - How do I reset the $PATH variable on Mac OS X? - Super User](https://superuser.com/questions/121870/how-do-i-reset-the-path-variable-on-mac-os-x)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_rB0w" id="confirm-openssl">confirm openssl<a class="hash-link" href="#confirm-openssl" title="标题的直接链接">​</a></h4><p>According to the <code>brew install openssl</code> command result, our openssl source codes are under <code>/usr/local/Cellar/openssl@xxx</code>:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644053094808-83ad1e420d3f10f9f1993392ef81a7937f1cb2feb36d2c8d65ee15b761a803f1.png" alt="picture 20" class="img_vXGZ"></p><p>Have a check:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644053177928-4cadb79f22f3201c1298c4758b50ff84de6761bf3a4c7f399977cd261f04e950.png" alt="picture 21" class="img_vXGZ"></p><p>!!!tip 可以看到，我们其实默认是有一个<code>openssl@1.1</code>的，然后我们新装了一个<code>openssl@3</code>，所以实际上我 follow 的那个帖子并不完全正确。</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">至少在我们安装homebrew后，就已经有了`openssl`(不单单是mac的`libressl`)。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这意味着其实我们（可能）没有必要再安装一个`openssl`，直接把目前这个`openssl`相关的信息写入环境变量即可。（待验证这种方式是否有效）</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="compile-sqlcipher">compile <code>sqlcipher</code><a class="hash-link" href="#compile-sqlcipher" title="标题的直接链接">​</a></h3><p>官方 <a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener noreferrer">sqlcipher/sqlcipher: SQLCipher is a standalone fork of SQLite that adds 256 bit AES encryption of database files and other security features.</a>对编译是这么写的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055146714-d0372f937c55a48d57a16ad23499d9dcacedcffc95c73c8858b6fe4558bbe24f.png" alt="picture 23" class="img_vXGZ"></p><p>在我没有<code>define SQLITE_HAS_CODEC and either SQLITE_TEMP_STORE=2 or SQLITE_TEMP_STORE=3</code>之前（引申阅读： 1. <a href="https://www.leavesongs.com/C/EncryptSqlite.html" target="_blank" rel="noopener noreferrer">VC++下的 sqlite 数据库加密 | 离别歌</a>， 2. <a href="https://sqlite.org/forum/forumpost/775a68525e" target="_blank" rel="noopener noreferrer">SQLite Forum: SQLITE_HAS_CODE is gone?</a>），运行的命令行会报错：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">./configure --enable-tempstore=yes CFLAGS=&quot;-DSQLITE_HAS_CODEC&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LDFLAGS=&quot;/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055119287-849f7d0ef323bdf71b4812bc1983b56cbdd2b88d5e8ecac4c1537f737e49add9.png" alt="picture 22" class="img_vXGZ"></p><p>但你定义上述变量还比较麻烦，要去某个<code>.h</code>里，我都不知道它们在哪……其次，也不一定只是定义这个问题。</p><p>在我们的中文教程 <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">(25 条消息) Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a> 里他摸索出来的结果是这样的：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055284135-3cff04278bbf581910400b65b3fb0ec043943b1d4a860da1da07a7d11472dbb5.png" alt="picture 24" class="img_vXGZ"></p><p>所以我基于他给出的命令行改成了如下（1. 删除了<code>--prefix=yourlibdir</code>这个参数； 2. 修改了<code>LDFLAGS</code>参数为我们实际的<code>libcrypto.a</code>位置）：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">./configure  --disable-tcl --disable-shared --enable-static=yes --enable-tempstore=yes --with-crypto-lib=none CFLAGS=&quot;-DSQLITE_HAS_CODEC -DSQLCIPHER_CRYPTO_OPENSSL&quot; LDFLAGS=&quot;/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后一下就编译成功了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055366303-2d91dce8f1cfaff53f1b4959720cb43da46acaa813e69590a0ecd728aacc4b01.png" alt="picture 25" class="img_vXGZ"></p><p>接着就是<code>make</code>一下，最终会生成<code>sqlcipher</code>可执行文件：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055403556-233d2ce354ae18db283301899741d5f71fdf97cf2e450720d3cfdafe1d7d9dfe.png" alt="picture 26" class="img_vXGZ"></p><p><del>以上就代表我们的编译过程顺利完成。</del></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="update-静态编译">UPDATE: 静态编译<a class="hash-link" href="#update-静态编译" title="标题的直接链接">​</a></h3><p>刚刚那个编译好像属于动态编译，后续我在编译 python 版本的<code>pysqlcipher3</code>的时候又出现了<code>ld: library not found for -lsqlcipher</code>的问题：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072227306-9e8a15ed18d00cf7f3ecbfc851c171be72a16050db5299a7cd2782fc6486f870.png" alt="picture 43" class="img_vXGZ"></p><p>所以还是静态编译可能比较好。</p><p>重新回顾一下 <code>sqlcipher</code> 的编译教程，我们只需要知道 <code>libcrypto.a</code>的位置就可以了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072262710-734053d18c0c275c54731dc02801ef8d262fba116ac73c43b178013672cd1ba5.png" alt="picture 44" class="img_vXGZ"></p><p>（南川）注意看我是怎么找到 <code>libcrypto.a</code>的位置的，当我只知道他在<code>Cellar</code>下的时候。(其中的<code>realpath</code>命令需要<code>brew install coreutils</code>)</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072356870-5e184b304747b5c39a498bf21f082075707a60d05890f8ef7fb270cefadb0362.png" alt="picture 45" class="img_vXGZ"></p><p>接着拷贝该位置到安装参数内。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">(.pyenv) ➜  sqlcipher git:(master) ✗ ./configure --enable-tempstore=yes CFLAGS=&quot;-DSQLITE_HAS_CODEC&quot; LDFLAGS=&quot;/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是报错了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072484888-a542b44050c96501a77a271bc4b8b68fc56e34f76dd64ff798a7c9f3b7b09f24.png" alt="picture 46" class="img_vXGZ"></p><p>这个问题其实正好就是我们动态编译错过了的但是博主碰到了的问题:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072522514-62b7f0b1639d262ede4547456661b328e4a6b32fae6c5cace9256df1236fd2e3.png" alt="picture 47" class="img_vXGZ"></p><p>跟着他的经验，也别管他的命令行怎么写的，加上参数：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">(.pyenv) ➜  sqlcipher git:(master) ✗ ./configure --enable-tempstore=yes CFLAGS=&quot;-DSQLITE_HAS_CODEC&quot; LDFLAGS=&quot;/usr/local/Cellar/openssl@3/3.0.1/lib/libcrypto.a&quot; --with-crypto-lib=none</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>立即通过！然后再运行<code>make install</code>即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644072591630-f4c7e1aab4353c3361db72feda9d9bbe9ff572006e4e2424c3625a65c7cc6f62.png" alt="picture 48" class="img_vXGZ"></p><p>注意，<code>install</code>之后，可以看到，其实是把<code>libsqlcipher.a</code>等写入到了<code>/usr/local/lib</code>下面，这个路径要记得，以后其他库一般也会编到这里。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="test-sqlcipher-workflow">test <code>sqlcipher</code> workflow<a class="hash-link" href="#test-sqlcipher-workflow" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before">step 1. crypto a plain database (which is generated by our <code>sqlite</code> before)<a class="hash-link" href="#step-1-crypto-a-plain-database-which-is-generated-by-our-sqlite-before" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055516480-7d258b2f3f5c95b8ae22647f6b0221200e0458f1c70f73b597b2b2ee2491dcab.png" alt="picture 27" class="img_vXGZ"></p><p>Among the commands, the <code>attach database XXX as encrypted key YYY</code> would generate a database named XXX, which is encrypted by key YYY.</p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step2-test-operate-on-an-encrypted-database-without-key-expect-failure">step2. test: operate on an encrypted database without key (expect: failure)<a class="hash-link" href="#step2-test-operate-on-an-encrypted-database-without-key-expect-failure" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055718135-17c2ee6027d75abc6637815f057703e25bde0b4bac6d8c31a03694dd5d919c73.png" alt="picture 28" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success">step3. test: dump the encrypted database into plain with key (expect: success)<a class="hash-link" href="#step3-test-dump-the-encrypted-database-into-plain-with-key-expect-success" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055830760-6cd688ede765164c9a10e49ba478e98036e517d06d121f8b8f1a222f58d316b1.png" alt="picture 29" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="step4-test-open-the-decrypted-database-without-key-expect-success">step4. test: open the decrypted database without key (expect: success)<a class="hash-link" href="#step4-test-open-the-decrypted-database-without-key-expect-success" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644055943131-58c01e04c45846d54c782180d6489b888c3cf84e843252a71be57c6520f78a1c.png" alt="picture 30" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="-decrypt-database">✨✨ decrypt database<a class="hash-link" href="#-decrypt-database" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="depreciated-pragma-config-of-sqlcipher-3-defaults">DEPRECIATED: pragma config of sqlcipher 3 defaults<a class="hash-link" href="#depreciated-pragma-config-of-sqlcipher-3-defaults" title="标题的直接链接">​</a></h4><p>!!!warning 我的 <code>sqlcipher</code> 版本是 <code>3.36.0</code>，这个版本默认是 <code>sqlcipher 4</code>的配置了（盲猜），而腾讯的加密用的是 <code>sqlcipher 3</code>，所以在解密文件时，必须将配置都对上（可以按照 GUI 软件<code>DB Browser for SQLite</code>一一对上），否则会出现<code>file is not a database</code> 或 <code>out of memory</code>等错误</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644067587138-c2f6c561a856b4619f0fafb2c31d203c22ae2220fe6fe31f89d3b1c6dc18848f.png" alt="picture 31" class="img_vXGZ"></p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA cipher_compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA kdf_algorithm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA hmac_algorithm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA kdf_iter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA cipher_page_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><p>core ref of pragma statements, especially sqlcipher relative: <a href="https://utelle.github.io/SQLite3MultipleCiphers/docs/configuration/config_sql_pragmas/#pragma-hmac_algorithm" target="_blank" rel="noopener noreferrer">SQL Pragmas | SQLite3 Multiple Ciphers</a></p></li><li><p>tencent forked sqlcipher: <a href="https://github.com/Tencent/sqlcipher/tree/4f37c817eb99e18e4fdc8ac63d67ac33610d66be" target="_blank" rel="noopener noreferrer">Tencent/sqlcipher at 4f37c817eb99e18e4fdc8ac63d67ac33610d66be</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="best-practice-pragma-config-of-sqlcipher-3-defaults">BEST-PRACTICE: pragma config of sqlcipher 3 defaults<a class="hash-link" href="#best-practice-pragma-config-of-sqlcipher-3-defaults" title="标题的直接链接">​</a></h4><p>As mentioned at: - <a href="https://github.com/rigglemania/pysqlcipher3#sqlcipher-compatibility-issues" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a>, we only need to add one line of <code>PRAGMA cipher_compatibility = 3&quot;</code> after setting <code>&quot;PRAGMA key=&#x27;password&#x27;&quot;</code>.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069999876-2b5aae9410cd1110098e3247594c549654da13532919c803314c43565f10892e.png" alt="picture 40" class="img_vXGZ"></p><p>Here is the tested result:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644070069597-642a02966f92de01abff3777591606fdab3c9da26e799787a5d6d26fdf3d5d4b.png" alt="picture 41" class="img_vXGZ"></p><h4 class="anchor anchorWithStickyNavbar_rB0w" id="check-salt-of-specific-database-file">check salt of specific database file<a class="hash-link" href="#check-salt-of-specific-database-file" title="标题的直接链接">​</a></h4><blockquote><p>usage</p></blockquote><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">xxd -p -l 16 -g 0 &#x27;/path/to/foo.db&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>sample</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068254533-1ea78ae0e60ab131144b0ea1cb30d1e9d1e3c1cab3729dccc2ae528c540cf0c7.png" alt="picture 32" class="img_vXGZ"></p><blockquote><p>verification</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068327704-ea3ee6ac4f1ecbfceb32f370d0b07091175e6cf250a7c588391b197e4a0c613c.png" alt="picture 34" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068275641-5eb58026ca08887af94f8d62444540ba7a649c2ff06f7359b5280efeaf6b472e.png" alt="picture 33" class="img_vXGZ"></p><ul><li><a href="https://github.com/nalzok/wechat-decipher-macos/blob/main/macos/dbcracker.d" target="_blank" rel="noopener noreferrer">wechat-decipher-macos/dbcracker.d at main · nalzok/wechat-decipher-macos</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="decrypt-and-dump-specific-database-file">decrypt and dump specific database file<a class="hash-link" href="#decrypt-and-dump-specific-database-file" title="标题的直接链接">​</a></h4><ol><li>open our custom hook script and get the database secret info:</li></ol><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644068620611-aa198000c76e33c4b248a05589b2d22107ad3339584f55104ef9105be3efc2f7.png" alt="picture 35" class="img_vXGZ"></p><ol start="2"><li><p>copy the <code>PRAGMA XXX</code> statements for specific database file</p></li><li><p>dump specific database file after decrypting</p></li></ol><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">ATTACH </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;plaintext.db&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> plaintext </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> sqlcipher_export</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;plaintext&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DETACH </span><span class="token keyword" style="color:#00009f">DATABASE</span><span class="token plain"> plaintext</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069059270-6a17772f3571e1d5243cd8e94ec3a554277c5b01624e3c665f89072fffcee427.png" alt="picture 37" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li>How to decrypt the sqlcipher, when the version matches<a href="https://stackoverflow.com/questions/25132477/how-to-decrypt-an-encrypted-sqlcipher-database-file-on-command-line/53616126" target="_blank" rel="noopener noreferrer">encryption - How to decrypt an encrypted sqlcipher database file on command line? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="test-dumped-database-file-via-sqlcipher-or-sqlite3">test dumped database file (via <code>sqlcipher</code> or <code>sqlite3</code>)<a class="hash-link" href="#test-dumped-database-file-via-sqlcipher-or-sqlite3" title="标题的直接链接">​</a></h4><p>Since the database dumped has been decrypted, so using <code>sqlcipher</code> or <code>sqlite3</code> are both ok!</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069170316-b3039faeffce4fa085668bb405c45b50a50f5a8721536caa6ca9f800837f0834.png" alt="picture 38" class="img_vXGZ"></p><p>!!!tip As a contrary, if we using <code>sqlite3</code> to open an encrypted database file, then the <code>PRAGMA</code> commands are always invalid, and there would be no way to decrypt the database.</p><div class="codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">![picture 39](https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644069321523-f78eba6a3271f2e2e9cf3c2c04a83fda5e5d6e26f5289e3d3b82ad09af2bd042.png)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_rB0w" id="wechat-design">wechat design<a class="hash-link" href="#wechat-design" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="design-of-contact-fields">design of contact fields<a class="hash-link" href="#design-of-contact-fields" title="标题的直接链接">​</a></h3><p>以某好友资料为例：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644086442066-c16483c3e89a04c951579e2b136fb4aa69ec438102d180434d3508fb8f2c50b5.png" alt="picture 62" class="img_vXGZ"></p><p>对应的可以看到数据表信息为：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644086957667-465fd289b2ac61137c90a5b656c0f8275a4f9a6b5e808bbda57c041373dc2b07.png" alt="picture 64" class="img_vXGZ"></p><p>可以知道，最有用的字段主要如下：</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">gUsrName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wxid（自动、唯一标识号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsAliasName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友的注册id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nickname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友自己设置的对外显示的昵称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemark</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 你给好友设置的备注</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其他还有一些拼音相关的有时也比较适合模糊搜索，不过全拼和简拼比较适合中文，英文的话全拼不变，简拼没有（另外也可以看到腾讯的命名规则也不统一，并且还中英文混杂……）：</p><div class="language-yaml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-yaml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">m_nsFullPY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友昵称全拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsShortPY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友昵称简拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemarkPYFull</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友备注全拼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">m_nsRemarkPYShort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 好友备注简拼</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="design-of-user-id-to-contact-id-md5">design of user id to contact id: <code>md5</code><a class="hash-link" href="#design-of-user-id-to-contact-id-md5" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644079452379-26017062b0f1704882f915ce6b46afb628ae66436219c84107b993379d33363a.png" alt="picture 51" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644079510590-162cac11502d48cb7941365f272d807dbaeff5cf45edcad396ea28f9d3f3daf3.png" alt="picture 52" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://1024tools.com/hash" target="_blank" rel="noopener noreferrer">Hash 在线计算、md5 计算、sha1 计算、sha256 计算、sha512 计算 - 1024Tools</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="improve-get-self-id">IMPROVE: get self id<a class="hash-link" href="#improve-get-self-id" title="标题的直接链接">​</a></h3><p>搜索自己的昵称，但是发现没有找到，说明<code>contact</code>表里是没有自己的。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644087070913-43f45ddeca29b284c48142f4d56ed38cf00132bb42ae7429702b35306c5fcedd.png" alt="picture 65" class="img_vXGZ"></p><p>所以，我们需要知道自己的 id 信息在哪里获取。</p><p>UPDATE-2022-02-06：聊天文件是以聊天对象的 md5 值作为数据库名存储的，尽管在聊天记录中基于你和对象的微信 id 使用了一个字段表示聊天方向，但同时还有另外一个整型字段标志着是否是自己，所以尽管在联系人数据库中找不到自己的 id，但不影响对聊天记录中聊天方向的识别。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="todo-get-image-from-xml">TODO: get image from xml<a class="hash-link" href="#todo-get-image-from-xml" title="标题的直接链接">​</a></h3><p>要遍历本地找！</p><blockquote><p>sample</p></blockquote><div class="language-xml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-xml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- StrRes1 --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">msg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">aeskey</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">252260f7cd231a2ee75e997483fdbe26</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">encryver</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbaeskey</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">252260f7cd231a2ee75e997483fdbe26</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumburl</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3059020100045230500201000204d3e741cc02030f5bd102041be0cdcb020461fd7c48042b777875706c6f61645f777869645f636b3835787570386231626a32315f3335395f313634343030323337330204011d0a020201000400</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumblength</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">2906</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">120</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnthumbwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">55</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnhdheight</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnhdwidth</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">cdnmidimgurl</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3059020100045230500201000204d3e741cc02030f5bd102041be0cdcb020461fd7c48042b777875706c6f61645f777869645f636b3835787570386231626a32315f3335395f313634343030323337330204011d0a020201000400</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">length</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">md5</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ac0d0d7ae1c546233d2dd8bdfbaa9d37</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">hevc_mid_size</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">77982</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">msg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-xml codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-xml codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- messageType --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">msgsource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">bizflag</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">bizflag</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">sec_msg_node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">uuid</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">e78ea49721c227614ead30b94f1dea68_</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">uuid</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">sec_msg_node</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n\t</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">signature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">v1_IC/iNhD5</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">signature</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">msgsource</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">\n</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li>windows version: <a href="https://bbs.125.la/thread-14304868-1-1.html" target="_blank" rel="noopener noreferrer">微信 hook 收到的图片消息怎么转换成图片呢<!-- -->_<!-- -->精易论坛</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="py-sqlcipher-instruction">py-sqlcipher instruction<a class="hash-link" href="#py-sqlcipher-instruction" title="标题的直接链接">​</a></h2><blockquote><p>core ref</p></blockquote><ul><li><p><a href="https://github.com/rigglemania/pysqlcipher3" target="_blank" rel="noopener noreferrer">rigglemania/pysqlcipher3: Python 3 bindings for SQLCipher</a></p></li><li><p><a href="https://charlesleifer.com/blog/encrypted-sqlite-databases-with-python-and-sqlcipher/" target="_blank" rel="noopener noreferrer">charles leifer | Encrypted SQLite Databases with Python and SQLCipher</a></p></li><li><p><a href="https://www.runoob.com/sqlite/sqlite-python.html" target="_blank" rel="noopener noreferrer">SQLite – Python | 菜鸟教程</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="compile">compile<a class="hash-link" href="#compile" title="标题的直接链接">​</a></h3><p>编译步骤永远都是最烦的哎，不过还好都顺利通过了。</p><p>首先是下载源代码。</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/rigglemania/pysqlcipher3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pysqlcipher3</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135188856-49a3c5122a1ed7c310f07f68401278000dd70331083c333a7e55789ec6f0f97f.png" alt="picture 80" class="img_vXGZ"></p><p>其次是编译，有两种方案。</p><p><del>由于我现在系统中已经静态编译过 <code>sqlcipher</code> 已经有了 <code>libsqlcipher</code>，所以我直接<code>python setup.py install</code> 就能成功。</del></p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">find /usr/local/lib -name libsqlcipher.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># output: /usr/local/lib/libsqlcipher.a</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135240001-f7a7915f534bb6401b77ab8ddbb6b6d02d26e50868e209c415eb755377ab7a07.png" alt="picture 81" class="img_vXGZ"></p><p>否则的话，我需要把在 <code>sqlcipher</code> 动态编译产生的 <code>sqlite.[ch]</code> 文件都拷贝到当前目录下。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135275190-5f582dbc1de9d6719751b59ae25a5141f99dd7d5153c3a59cce7ac8636f89715.png" alt="picture 82" class="img_vXGZ"></p><p>再编译<code>python setup.py build_amalgamation</code>又会发现<code>src/python3/connection.h</code>报错找不到<code>sqlcipher.h</code>了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135531747-a3367cfc37c9ea6b6cd703b9c6ca2226d37e63863a7a87ce408584f09bb0fdd5.png" alt="picture 83" class="img_vXGZ"></p><p>所以我们再……把 <code>amalgamation</code> 文件夹拷贝到 <code>src/python3/</code>下，并重命名为<code>sqlcipher</code>……（真忙啊……）</p><p>然后编译：</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">python setup.py build_amalgamation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python setup.py install</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>成功通过！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135629542-210ab9f8ec0d0f66cc1175fac733cb59b5afd897a7485eef8b0a402f24b8bd27.png" alt="picture 84" class="img_vXGZ"></p><p>这样，你才能在 python 中使用 <code>from pysqlcipher3 import dbapi2 as sqlite</code>。</p><p>测试是否有 <code>pysqlcipher</code>：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644135674098-023717b49ca1c8d9104288088799b163690013c4c3004efffec37fa333576f1f.png" alt="picture 85" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="connection">connection<a class="hash-link" href="#connection" title="标题的直接链接">​</a></h3><p>如果是已解密/未加密的数据库，则使用 <code>sqlite3</code> 或者 <code>sqlcipher</code> 皆可。d</p><p>但如果是加密的数据库，则必须使用 <code>sqlcipher</code> 进入解密。</p><p>以下皆以 <code>sqlcipher</code> 演示。</p><p>命令行版：</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 一句话搞定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlcipher DB</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 验证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> PRAGMA </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;XXXX&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> PRAGMA cipher_compatibility </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sqlite</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>python 版：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Python 3.9.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pysqlcipher3 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dbapi2 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sqlite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> pysqlcipher3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dbapi2 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">auth_db</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ddb_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> db_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Connection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;dp_path&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> db_path</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sqlite</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;PRAGMA key = &quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">db_key</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;PRAGMA cipher_compatibility = 3;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">commit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;authenticated </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">db_file</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> conn</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="table">table<a class="hash-link" href="#table" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-all-the-tables">list all the tables<a class="hash-link" href="#list-all-the-tables" title="标题的直接链接">​</a></h4><p>If you are using pure <code>sqlite/sqlcipher</code>, then using <code>.tables</code> can list all the tables. However, it won&#x27;t in the py program.</p><p>In programme, I need to using the following:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> sqlite_master </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;table&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the python may be:</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">tables </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;SELECT name FROM sqlite_master WHERE type = &quot;table&quot;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the sample result of tx-contact table is:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644075446587-2f42b7d6a6f49cf9436ac7617a6dd20a65954db0da8d17f1967fb36032097367.png" alt="picture 49" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://stackoverflow.com/questions/82875/how-can-i-list-the-tables-in-a-sqlite-database-file-that-was-opened-with-attach" target="_blank" rel="noopener noreferrer">sql - How can I list the tables in a SQLite database file that was opened with ATTACH? - Stack Overflow</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-the-columns-of-table-get-table-schema">list the columns of table (get table schema)<a class="hash-link" href="#list-the-columns-of-table-get-table-schema" title="标题的直接链接">​</a></h4><p>In sql, we can use:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- to list all the tables in the database:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">tables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- to show the schema for a given tablename:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">schema</span><span class="token plain"> tablename</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Otherwise:</p><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">PRAGMA table_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And to get column names in py:</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">columns </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;PRAGMA table_info(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">table_name</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><a href="https://www.sqlitetutorial.net/sqlite-tutorial/sqlite-describe-table/" target="_blank" rel="noopener noreferrer">SQLite Describe Table</a></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="format-rows-display">format rows display<a class="hash-link" href="#format-rows-display" title="标题的直接链接">​</a></h4><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- to show current configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- to show rows of columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">headers </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">mode</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nullvalue </span><span class="token operator" style="color:#393A34">-</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>ref</p></blockquote><ul><li><p><a href="https://dba.stackexchange.com/questions/40656/how-to-properly-format-sqlite-shell-output" target="_blank" rel="noopener noreferrer">How to properly format sqlite shell output? - Database Administrators Stack Exchange</a></p></li><li><p><a href="https://dba.stackexchange.com/questions/40656/how-to-properly-format-sqlite-shell-output/219988" target="_blank" rel="noopener noreferrer">How to properly format sqlite shell output? - Database Administrators Stack Exchange</a></p></li><li><p><a href="http://www.infinitezest.com/articles/creating-user-friendly-output-from-sqlite.aspx" target="_blank" rel="noopener noreferrer">infiniteZest.com: Creating User Friendly Output from SQLite</a></p></li><li><p><a href="https://stackoverflow.com/questions/947215/how-to-get-a-list-of-column-names-on-sqlite3-database" target="_blank" rel="noopener noreferrer">sqlite - How to get a list of column names on Sqlite3 database? - Stack Overflow</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_rB0w" id="list-rows-in-one-table">list rows in one table<a class="hash-link" href="#list-rows-in-one-table" title="标题的直接链接">​</a></h4><div class="language-sql codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sql codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> XXXTABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- limit rows, skip/offset rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">LIMIT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OFFSET</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>sample</p></blockquote><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644075527796-64ff73b5b33e8d861f0fa9ccc81f5329e323e459977abe720cfed5e7e7ee8b91.png" alt="picture 50" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://stackoverflow.com/questions/10491492/sqlite-with-skip-offset-only-not-limit" target="_blank" rel="noopener noreferrer">SQLite with skip (offset) only (not limit) - Stack Overflow</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="extended">extended<a class="hash-link" href="#extended" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="how-to-know-my-openssl-versioninfo">how to know my openssl version/info<a class="hash-link" href="#how-to-know-my-openssl-versioninfo" title="标题的直接链接">​</a></h3><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LibreSSL 2.8.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">built on: date not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">platform: information not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler: information not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENSSLDIR: &quot;/private/etc/ssl&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the <code>OPENSSLDIR</code> is the config info for openssl other than the src files.</p><div class="language-sh codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-sh codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree /private/etc/ssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/private/etc/ssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── cert.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── openssl.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── x509v3.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 directory, 3 files</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And as mentioned from <a href="https://blog.csdn.net/u011195398/article/details/85266214" target="_blank" rel="noopener noreferrer">Mac 终端使用 Sqlcipher 加解密基础过程详解<!-- -->_<!-- -->Martin.Mu `s Special Column-CSDN 博客<!-- -->_<!-- -->mac sqlcipher</a>, the built-in <code>openssl</code> on MacOS may not be suitable for our project target.</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644050865960-53d51937372a7a78dc69ae4400596947dff31b8a528f5344aff55677334f6d3e.png" alt="picture 13" class="img_vXGZ"></p><blockquote><p>ref</p></blockquote><ul><li><a href="https://phoenixnap.com/kb/how-to-check-openssl-version" target="_blank" rel="noopener noreferrer">How to Check or Find the OpenSSL Version Easy Way</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="bugfix-error-c-compiler-cannot-create-executables">bugfix: <code>error: C compiler cannot create executables</code><a class="hash-link" href="#bugfix-error-c-compiler-cannot-create-executables" title="标题的直接链接">​</a></h3><blockquote><p>ref</p></blockquote><ul><li><p>一个 mac 用户碰到了这个问题，然后在 github 询问：<a href="https://github.com/sqlcipher/sqlcipher/issues/378" target="_blank" rel="noopener noreferrer">Installation on MacOS Catalina, C compiler cannot create executables · Issue #378 · sqlcipher/sqlcipher</a></p></li><li><p>上个用户被开发者劝退，说来这里问，但是这里没有得到回复😢：<a href="https://discuss.zetetic.net/t/sqlcipher-installation-on-macos-catalina-c-compiler-cannot-create-executables/4807" target="_blank" rel="noopener noreferrer">SQLCipher Installation on MacOS Catalina, C compiler cannot create executables - SQLCipher - Zetetic Community Discussion</a></p></li><li><p>这里看起来讨论的更热烈些，但和 <code>sqlcipher</code>无关： <a href="https://askubuntu.com/questions/647583/how-to-fix-configure-error-c-compiler-cannot-create-executables" target="_blank" rel="noopener noreferrer">command line - how to fix configure: error: C compiler cannot create executables - Ask Ubuntu</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="本项目合作伙伴">本项目合作伙伴<a class="hash-link" href="#本项目合作伙伴" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644139731203-958d64fdabac5af3a2cfdd96b1bf5d863b81d1363f8b116649256388ae8ae438.png" alt="某攻防工程师，w哥" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/mac-wechat-hack-1644139704659-4a00c03e7eed677c88c5d56b7e6853eef631a646b24f5e4dab2f9ad1d0884d25.png" alt="某支持工程师，z妹" class="img_vXGZ"></p></div><footer class="row docusaurus-mt-lg"></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/07/11/prose-I-am-me">札记 | 我与我周旋久，我亦是我</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-07-11T00:00:00.000Z" itemprop="datePublished">2022/07/11</time> · <!-- -->阅读需 4 分钟</div></header><div class="markdown" itemprop="articleBody"><p>前几日，绵延一周的雨终究是停了，这同时也意味着，两年前的夏日刚来京城的那种窒息般的炎热，将接踵而至，无法拒绝。</p><p>当然，更令人无法拒绝的是，河南成百上千的储户哭诉无门，甚至惨遭暴打。前日是丰县，昨日是唐山，今日是河南，明日是哪，明明日又是哪，届时又该以怎样的心情与态度去面对呢。</p><p>但，倘真只是我们这一团乱麻吗，倒也未必。说来也是，隔壁前首相前脚方才离开，忘却的救世主便要骤临了，更别提这里下台了一位，那里离奇去世一位了。</p><p>但，即便如此，似乎也未必能得出我们只得惶惶不可终日的结论来。尽管，在一款毫无技术含量、漏洞百出却具有最高权力的软件前，已经大有这样的趋势了。</p><p>但，鲜活的历史告诉我们，今人不见古时月，今月曾经照古人，一切的纷扰均是内心的纷扰，一切的不安都是内心的不安。</p><p>倘以一年去看今时今日之喜怒，倘以十年去看今月今年之困厄，倘以百年去看今生今世之无常，则怒也好、喜也罢、悲也好、思也罢，都如那镜中花水中月，一片虚无与缥缈。为人若直诚，则泾渭而已；行事若忠己，则死生而已。</p><p>如果说有什么是最值得烦恼的话，那大概是我已如此明白我既成不了普通人，也成不了伟人，连小人也是遥不可及，一者我天生便非循规蹈矩之辈，二者我资质实数平庸，三者我决然不够那样的脸面。</p><p>所以，我到底是谁，是怎样的一个灵魂寄生在我这样的肉躯之内，它的命运究竟通往何方，即便是和它朝夕相处二十余年的我，亦不能回答。</p><p>但有一点我倒是有相当的确信，那就是我并不能完全控制与驾驭它。譬如，根本无法躺平着安然入眠，这对于我来说简直不可思议。再譬如，梦中美好的或是朦胧的或是惊险的际遇，每次都深深地让自己迷恋许久，为此总要耗去成吨的时间。</p><p>末了，如果说有什么是最值得分享的话，那大抵是我与我周旋久，我亦是我。</p><p>把灯灭了，静看烟火。</p><p>把目闭了，独照此心。</p><p>愿，执我。</p><p>南川记于二〇二二年七月十一日丑时</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/札记">札记</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-07-02T00:00:00.000Z" itemprop="datePublished">2022/07/02</time> · <!-- -->阅读需 18 分钟</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>近日，我叔为我弟高考志愿填报的事情焦头烂额。（江苏高考志愿填报竟然能多达 40 个了，你敢信！）</p><p>我心想，也许可以为他们做点数据分析工作。于是……</p></blockquote><h2 class="anchor anchorWithStickyNavbar_rB0w" id="设计">设计<a class="hash-link" href="#设计" title="标题的直接链接">​</a></h2><p>高考志愿填报的核心难点，在于学校、专业众多，普通人很难抉择，尤其是中档学生，一本线以上、211 勉强，对于他们来说，可能选得好就是天堂选不好就是地狱（也只是可能，最终还得看自身）。</p><p>他正好位于这档。</p><p>（不过在日益强大的数据分析工具面前，这个问题变得不再有挑战性，回想起我曾经填志愿时还只能傻傻地拿着一本大书慢慢比对，不得不感叹当年的我还是年轻。）</p><p>在母校曹老师的援助下，我很快地拿到了权威的去年志愿数据（来源：<a href="https://www.jseea.cn/webfile/index/index_zkxx/2021-07-17/24917.html;jsessionid=8A742AC473A754778E35DFAC962B7F7A.s107_7" target="_blank" rel="noopener noreferrer">江苏省 2021 年普通类本科批次投档线（物理等科目类） - 招考信息</a>），里面有物理学科本科院校志愿最低分的数据情况，长如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766839465-3dd91a5a19354795df88ff375103b519196d6cf4c89ee94de197c944072e33f2.png" alt="picture 2" class="img_vXGZ"></p><p>这样，很快地，我们的思路就出来了，只要把我弟的数据录进去，再和这些学校比对，筛选出在他分数上下的院校即可，最好是 985、211、双一流。</p><p>因此我们的工作大致有以下几个：</p><ol><li>清洗这张表格</li><li>为这张表格加上学校标签标识</li><li>将分数录入，进行筛选</li></ol><p>以下详细展示整个流程。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="投档线数据清洗">投档线数据清洗<a class="hash-link" href="#投档线数据清洗" title="标题的直接链接">​</a></h2><p>首先查看表格，是传统的 excel，还有最让编程人员烦的跨行合并的多层标题栏，那么第一步就是重构标题栏。</p><p>根据经验，表格的跨行合并，实际上真实数据都在合并的第一行（其他为空），例如取消合并后如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656766993094-7635f2a2ce0217a1f39d40ad8bf81d013b2273c86fd5200338887f632cbffe5c.png" alt="picture 4" class="img_vXGZ"></p><p>由此可以敏锐地发现，我们只需要把标题栏向下填充，使之全部对齐到第五行，就是可以被程序读取的标题栏了。而这个操作，就是 pandas 内所谓的<code>frontfill</code>（向前填充）。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767020562-a50a20840b8b27bf3dea6a408e87562e13b4e05675565795bf4b63451ae212cc.png" alt="picture 5" class="img_vXGZ"></p><p>接着标题栏都是中文，并且命名过长，影响编程效率，所以有必要重命名。</p><p>此外，接着看内容，“院校、专业组（再选科目要求）”这一列信息量比较大，包含了学校名、专业组和专业限制。</p><p>其中专业组是指填报汇总后是根据大专业划分，几个比较近的属于某个专业组，例如计算机、软件、电子信息就很有可能属于同一个专业组，有点类似一级学科的意思，但也不太一样，主要是按招生对象不同，比如说中外合作的就可能在同一专业组，与其他的专业组可能专业内容上倒是相近的。这个就需要那本大书去查，网上还没有太好的信息。</p><p>专业限制是江苏专用的一套规则，按照“3+1+2”的要求，学生在语数外之外先要在“物理”和“历史”中首选一门，作为文理划分的依据；接着在剩余的 4 门（历史、政治、地理、生物）中任选两门，专业限制就是针对这两门，在曹老师的指导下我们了解到它分“不限”、“A”、“A 或 B”、“A 和 B”四种可能，分别属于不同的交并补关系（一开始我以为只有“不限”或者“A 或 B”两种可能，导致程序设计缺陷，这是我的疏忽，由于时间关系，没有做好前期统计的工作）。</p><p>因此，我们首先要做的就是把这列拆分，尤其对于专业组限制这块，一开始以为只有“或”的关系，我就把它拆成了一个数组，后来发现还有“和”的关系，这么做就不妥了，因此需要保留原字符串，后续以我弟的具体学科使用函数单独处理。</p><p>由此写出我们第一段程序，数据已经变成很干净的结构：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767765128-03a51d1d3951b6781fb07b9da0683d99840e35154dc957c85a591d82ae7fd024.png" alt="picture 7" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773876476-c52acb4fe7a714e492466d7118974935b74e9923d36e74371ce6e1d2b2ea2d56.png" alt="picture 32" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分数据结构设计">考分数据结构设计<a class="hash-link" href="#考分数据结构设计" title="标题的直接链接">​</a></h2><p>为了通用性，我们在设计考分数据结构时，设计的相对比较保守，因为里面存在一些勾稽关系，所以使用<code>@property</code>保证数据的一致性。此外，由于每年分数线差异，因此需要做换算，所以加入了<code>bias</code>乘数。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656767932103-7981dfd9a59b69827e93d1fc4b2589159fcf45e4dc8b3b2b64859421163813dd.png" alt="picture 8" class="img_vXGZ"></p><p>在<code>bias</code>上，默认是 1 这个很好理解；考虑到我们可能有多次对标不同年份的需求（江苏没有，因为江苏改革目前才是第二年），所以需要不断地调整 bias，因此最好的做法，是调整后再返回类本身，这样可以实现链式操作。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768075428-c7aca4cf071f20a24eb678803ce9dcec6861f3299539eee12aaeb86a969ca3a2.png" alt="picture 9" class="img_vXGZ"></p><p>链式操作示范：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768172602-572b8b5f9fd071eb6f8de7f75f3397f077051c88fb173ffc5c835fd103889bc0.png" alt="picture 10" class="img_vXGZ"></p><p>我们还在数据分的基础上，加入了排名，不过实际没有用上，因为我们没有投档线对应的排名数据。</p><p>以上就是整体的数据结构设计。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="考分录入年份修正风险偏好">考分录入、年份修正、风险偏好<a class="hash-link" href="#考分录入年份修正风险偏好" title="标题的直接链接">​</a></h2><p>在录入上，直接初始化即可。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768324016-07135822436a2483b55726287dc8bdb1d6bae7a5c98ce64a07c553b8e7e2a6cb.png" alt="picture 11" class="img_vXGZ"></p><p>在年份修正上，则有些讲究。它本质的问题是确定，今年的分数在往年值多少分的问题。</p><p>我原先想用一本分数线做测度，但是江苏已经取消一本线了，只有本科线（也就是二本线）。</p><p>我想了一下，反正这块肯定有误差，在非对标顶级 985 的情况下，直接用二本线比值作为乘数似乎也没什么不妥。</p><p>比如去年本科线是 417，今年是 429，比值是 0.97，也就是今年的 1 分等于去年的 0.97 分。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768462360-9e2dc54ba2633efd5d2238816426b980bdd189834884e9c7caa0332fa49faf1f.png" alt="picture 12" class="img_vXGZ"></p><p>在年份修正的前提下，我们还得考虑一下风险偏好，目前我们看到的都是最低志愿投档线，因此实际已经很有风险，也即是现在看到的贵校的 N 分，实际进入该专业的学生可能都是 N<!-- -->*<!-- -->k 分，k 显著大于 1。</p><p>所以正常情况下，我们得在折合分上再乘以一个系数，降低一下自身的体位，可能 0.98 比较合适，但是不排除有些人特别 risky，就想搏一搏，单车变摩托，所以我们在筛选的时候也可以适当调高点范围，这就是风险系数，我把它设置成了最高 1.02，这样能多看十分（基数是五百多）的学校。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656768677788-0b18d662fcbf5800ff9947403a3a1bff8335e4666f611fe12bf9bb429b60dfb5.png" alt="picture 13" class="img_vXGZ"></p><p>看的时候，以风险调整后的分为最高分，从上往下筛学校即可。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于学科进行筛选">基于学科进行筛选<a class="hash-link" href="#基于学科进行筛选" title="标题的直接链接">​</a></h2><p>在学科筛选上，可以写的很复杂，也可以写的很简单。</p><p>比较复杂的是一遍遍地 for 循环，然后用 if 去判断，到底符不符合。</p><p>我后来想了一种比较简单的，就是用集合的思想去设计。</p><p>如果目标专业组要求是“A 和 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该等于<code>{A, B}</code>。</p><p>如果目标专业组要求是“A 或 B”的关系，那么在集合上，我们考生的学科集合（也就是<code>{C, D}</code>）应该与<code>{A, B}</code>有交集，也就是 $<!-- -->{<!-- -->C, D<!-- -->}<!-- --> \cap <!-- -->{<!-- -->A, B<!-- -->}<!-- --> \ne \varnothing$。</p><p>如果目标专业只有一个，也就是必须要选修它，则是子集关系。</p><p>如果目标专业为“不限”，则是恒真关系。</p><p>于是，我们可以写成这样：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769521413-46849b76826934ca106c73b9a7701078e2a4f3a490671bcaa2c05380ea5a5537.png" alt="picture 15" class="img_vXGZ"></p><p>这样，我们就把 2200 多条筛成了 17000 多条了，减少了 20%，是很不错的。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于-985211-筛选">基于 985、211 筛选<a class="hash-link" href="#基于-985211-筛选" title="标题的直接链接">​</a></h2><p>我们首先关注的是 985、211 类大学，看看有没有什么机会。</p><p>我们要先拿到一个标签表。</p><p>简单搜索后，我们决定使用来自这份博客<a href="https://blog.csdn.net/weixin_40683253/article/details/88417600" target="_blank" rel="noopener noreferrer">对照表 - 用心整理了一份国内 985/211 大学名单及其一流学科<!-- -->_<!-- -->黄饱饱<!-- -->_<!-- -->bao 的博客-CSDN 博客</a>的数据。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769729876-6ec048f8a3514c61dab87039788e4dad276193d4e76ebc2fa4223f0977de1134.png" alt="picture 16" class="img_vXGZ"></p><p>这是一张排版很标准的表格，如果你用 F12 去检查的话确实是标准的<code>table</code>标签。</p><p>我们如何把这个数据提取下来呢？</p><p>这可是表格，而非文字，直接复制处理起来很麻烦（但有时也未必不可以）。</p><p>要用爬虫吗？又觉得杀鸡焉用牛刀。</p><p>这时候，我突然想起来很多软件都自带表格数据提取工具，比如 excel 就有网站源数据刷新功能。</p><p>重点是，pandas 也不例外！</p><p>一行代码，轻松搞定，只要喂一下网址即可！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656769873501-7d6c39430b4fb107df808e5a0e24bedc0f1b62eed6b2c395fb768b9f5e9b8c41.png" alt="picture 17" class="img_vXGZ"></p><p>看到这，你是否会很想知道它的内部实现？没错，我也想，有时间再研究研究，估计是<code>requests + beautifulsoup</code>工作流？</p><p>简单清洗后，再与原先的那张表做左联操作：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770240516-8ea1c31af98253cca91922a0aac56400e6f6e083820fbbedf6bd88ce0e5fb329.png" alt="picture 19" class="img_vXGZ"></p><p>左联操作，就是以左表（投档线表）为基础，加上额外的右表信息（不存在的就是标记缺失）。这个操作，也是数据分析中最常用的。</p><p>我们还额外地简单封装了这个染色操作，将不同风险偏好的分数段做染色处理，逻辑如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770341081-6998c83936ecc24ba531deac77fe3f58ca262143c1a8808c1e06864d19be1b0f.png" alt="picture 20" class="img_vXGZ"></p><p>这样风险偏好保守的就看绿色部分就可以，高的可以看看红色（或者作为参考）。</p><p>不过很遗憾的是，我弟这个分数 985、211 只能去到很偏远的地方，或者都是中外合作办学项目。</p><p>此路似乎不通。</p><p>也许我们可以试一试双一流。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于双一流筛选">基于双一流筛选<a class="hash-link" href="#基于双一流筛选" title="标题的直接链接">​</a></h2><p>我们同样需要双一流的标签数据，之前那个 985/211 的表里虽然也有双一流信息，但是不全，因为有些双非也是有双一流的。</p><p>我们在<a href="https://www.zhijiao.cn/syl.shtml" target="_blank" rel="noopener noreferrer">“第一轮双一流”建设高校及建设学科名单<!-- -->_<!-- -->中国教育在线</a>这里找到了我们要的数据。</p><p>于是，使用 pandas 梅开二度：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770576448-e9b1e2692c2db0c2ea3e3bea561b0ed055d42991035ceb241eb5e81c598e741b.png" alt="picture 21" class="img_vXGZ"></p><p>这样就有 140 所学校了，可选性大了些（比 92 多了 20 所左右）。</p><p>不过，既然是基于双一流专业，我们肯定更以专业为主（而非学校），所以我们需要额外加一点基于专业的筛选操作。</p><p>比如，我们预设几个计算机相关的专业，然后在双一流学科名单中筛选，看看有没有相关的关键字，再结合分数，结果……</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770672616-ff47941ea168d1fadd08988e0456ccbb00b7034eb220ea73bca466601aba6e74.png" alt="picture 22" class="img_vXGZ"></p><p>Emmm.....</p><p>我陷入了良久的沉思……</p><p>既然专业好也可以，那我们为何不试试专业排名（而非紧盯双一流呢？）</p><p>这么一想，思路就开阔了，那就是软科排名！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="基于软科排名筛选">基于软科排名筛选<a class="hash-link" href="#基于软科排名筛选" title="标题的直接链接">​</a></h2><p>软科的排名可以在官网找到：<a href="https://www.shanghairanking.cn/rankings/bcmr/2022" target="_blank" rel="noopener noreferrer">权威发布|2022 软科中国大学专业排名|中国大学本科最好专业|就业率最高的专业</a></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770818534-227fe64e604260d36186637bab6b7cd316ffa28898512b5c944a054639535779.png" alt="picture 23" class="img_vXGZ"></p><p>我们可以在这里搜索不同的学科排名。</p><p>我们通过 F12 分析后端接口，发现有结构良好的 json 数据：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770883806-8dadd0900400c59c6a851d2077d3b2d6d8b23f5a7339968a677687287b7644ce.png" alt="picture 24" class="img_vXGZ"></p><p>因此，可以考虑直接用爬虫的手段，毕竟每个搜索结果都要翻页十二十次，这显然是必须走自动化了。</p><p>经过测试，如果不加 cookie，则获取时只会返回前 20 条，加了 cookie 就可以返回完整结果。</p><p>cookie 也就是这个：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656770970159-0ae108ab6bd0574e833f4bd2a18024a6c47d10756f69d4ecb2cab4364f3b39c2.png" alt="picture 25" class="img_vXGZ"></p><p>我们把它复制出来，封装一下，就可以设计出得到任意学科的排名数据的接口了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771058309-c544701861ec45612783fb4431526257be2ddda268f7c61409431d984ab5b7d0.png" alt="picture 26" class="img_vXGZ"></p><p>此外，我们注意到这个接口需要传入学科的编码，因此我们还要设计一个接口获得完整的编码列表。</p><p>经过分析，发现任何一个排名接口里已经包含了这份数据（的拷贝），因此我们可以首先调用任意一个专业的排名接口，然后解析出编码列表，代码如下：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771264185-63f98497dd56ca34dac37663c757faefde4e26b0d6fd0cf561fcaa46a22ea22b.png" alt="picture 28" class="img_vXGZ"></p><p>但这只是我们编码好的字典，还不具备输入一个学科名就返回一个学科编号的功能，因此还要封装一个检索函数：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656771335922-69e0acfca3bdbe912eda019c67b32ee84ef240c4a990adb99939982c3407b63a.png" alt="picture 29" class="img_vXGZ"></p><p>手动修正所有目标专业的准确名称后，我们就可以正式进行分析工作了。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773095464-9a349621f747035122e030e8cfd4cc51b7c7e659c8448cbfcf229141a32abb55.png" alt="picture 30" class="img_vXGZ"></p><p>此处唯一多需要注意的是，软科 api 里的<code>ranking</code>是字符串格式的整数，然后到我们 pandas 中也默认是字符串。</p><p>如果我们需要对<code>ranking</code>进行排序，就要先转换成整数；但如果我们在联表的的时候没有把非排名院校给筛掉（每份排名名单只有小几百所学校），就会导致数据缺失（变成<code>pd.NaN</code>），从而无法转换成整数，这是需要注意的。</p><p>解决办法就是要么直接把那些学校筛掉（比如本例）；要么就是使用<code>pd.numeric</code>函数，里面有两个参数<code>errors</code>和<code>downcast</code>可以控制异常如何处理。</p><p>技术部分就是这样！</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="复盘">复盘<a class="hash-link" href="#复盘" title="标题的直接链接">​</a></h2><p>其实本期最大的收获就是：</p><ul><li><p>对于有 211 分的，直接对照 985、211、双一流名单去选就好了；</p></li><li><p>对于有一本分的，建议对照软科排名去选</p></li><li><p>对于其他的……</p></li></ul><p>我今天终于了解到了二本怎么选的了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/DataAnalysis-Gaokao-1656773375309-4cb693ae7f66b693d8fe2ab68b0c049f09d7e728c376b15ffd822cf0537d3d68.png" alt="picture 31" class="img_vXGZ"></p><p>哈哈哈，不得不说这是一个很好的思路！</p><p>以上！</p><p>（全部<code>ipynb</code>程序文件可以后台回复“<strong>使用 pandas 研究高考志愿填报</strong>”。）</p><p>最后感谢我叔提供的素材，以及再次感谢曹老师的热心援助，希望我弟和天下学子最终都能选到心仪的学校，学有所成，不枉此生！</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/数据分析">数据分析</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_UBNu" itemprop="headline"><a itemprop="url" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></h2><div class="container_x5Un margin-vert--md"><time datetime="2022-06-16T00:00:00.000Z" itemprop="datePublished">2022/06/16</time> · <!-- -->阅读需 22 分钟</div></header><div class="markdown" itemprop="articleBody"><ol><li>方案 1：物理手段解决</li><li>方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算</li><li>方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<ol><li>浮层大小</li><li>浮层内容</li><li>浮层位置</li><li>二维码生成</li><li>二维码使用</li><li>缺陷</li><li>其他用处</li></ol></li><li>*<!-- -->方案 3 个人笔记<ol><li>LAB01: how to install the labs firmware</li><li>LAB02: QR Controls For Settings</li><li>LAB03: add an overlay to viedeo</li></ol></li><li>最后一点感受</li></ol><p>在上一期【文章：gopro】中，我们提供了一种借助 gopro 基于延时摄影从而底层本高质量地全程记录个人生活的解决方案，实测中这个方案仍然有一些不足之处，本期就重点探讨时间戳相关的问题。</p><p>这个问题其实很关键，因为我们正在做的事情是长时间无感拍摄，目的是为了后期复盘，但在复盘过程中，由于延时时间跨度过长，我们希望知道视频里的每一帧所拍摄的实际时间，比如是某月某日的下午两点还是夜间十点，这是一个很自然的需求。</p><p>但很可惜，这个问题并不容易解决。</p><p>以下便基于这个问题，提供实际可行的三种方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-1物理手段解决">方案 1：物理手段解决<a class="hash-link" href="#方案-1物理手段解决" title="标题的直接链接">​</a></h2><p>如果你是一个比较传统的、具有较强时间观的人，也许这种方案特别适合你，那就是直接选购一款挂钟（这也是我在上篇文章中所采用的方法）。</p><p>例如，我们这里有一段使用挂钟时期的成品视频：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655354709985-843159c3c155958989a9d5791053dbaecaca765cf48c91ebed9afd66f5c1d33a.png" alt="picture 3" class="img_vXGZ"></p><p>将我们的挂钟摆在所拍摄视频中的合理位置，既增强了画面构图感，也能实时知道每一帧所对应的真实时间，这确实有一石二鸟之效。</p><p>但很可惜，这种方案，并未能坚持多久，原因是，廉价的挂钟机芯转动声音影响到了自己的睡眠。</p><p>按照我对睡眠无声的要求，在依次关闭空调、窗户、电脑散热器、硬盘柜之后，室内的声音强度耳测应该已经低于 30 分贝，此时挂钟的声音就显得尤为明显了。</p><p>尽管它不大，但确实也没那么动听，至少甚至不如星际穿越的曲子《Tick-Tock》的前奏。</p><p>除非我愿意花更多的时间与金钱去筛选到另一款真正无声的挂钟，但作为一名程序猿，也许有更廉价与炫酷的方案。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-2借助opencv基于文件创建时间进行推算">方案 2：借助<strong>OpenCV</strong>基于文件创建时间进行推算<a class="hash-link" href="#方案-2借助opencv基于文件创建时间进行推算" title="标题的直接链接">​</a></h2><blockquote><p>本节参考：- <a href="https://www.theeminentcodfish.com/gopro-timestamp/" target="_blank" rel="noopener noreferrer">GoPro TimeStamp - The Eminent Codfish</a></p></blockquote><p>事实上，由于我们的延时摄影采用了固定时间间隔的方案（有关“自动时间间隔”与“固定时间间隔”方案的差异与优劣，也在上篇文章中有阐述），因此只要我们知道视频的任何一帧所对应的真实物理时间，我们就可以基于等差数列算法进行推算。</p><p>而这，恰恰可行，因为 gopro 的视频输出格式为 mp4，里面保存了文件的创建时间。</p><p>不过，这个文件创建时间，可不是我们在电脑上看到的那个文件创建时间，这不是同一个概念。</p><p>例如，我们这里有一段视频的开头显示是 6 月 15 日 10 点 05 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355366257-b01f6386d8aaa7fc57ca802956a6fd73fc4f6628385437e0055b8bd94622b6f9.png" alt="picture 4" class="img_vXGZ"></p><p>但在我们的文件管理器上查看该文件的创建时间却是 6 月 16 日 10 点 57 分：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655355421774-dc43ac335c5f11ebcbda9c81edde670f3e7f285321771c5f1a0ad443f8f22e2a.png" alt="picture 5" class="img_vXGZ"></p><p>这显然不是时区的问题，而是操作系统问题，即在操作系统里定义的文件创建时间是该文件在本地磁盘上首次产生的时间，而非文件本身的首次创建时间（对于该视频来说，尤指该视频开始拍摄的时间）。</p><p>但我们并非没有手段获取实际视频创建时间，答案就是基于软件解析的手段：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655356074973-cf5d985ee99cf99c2e87527c0ea19e095d2c433ceb7bed96d27be097804bb0ba.png" alt="picture 6" class="img_vXGZ"></p><p>上述代码使用了<code>ffprobe</code>这个指令解析了我们的 mp4 文件，从结果中的<code>creation_time</code>标签得到了我们想要的视频创建的真实时间，于是乎，最难的问题解决了。</p><p>接下来，我们就基于视频领域的一些基本概念为我们的视频加上时间戳信息。</p><p>第一步是关于帧的。</p><p>在之前文章中我们说我们的视频是每 5 秒延时拍摄一帧，也就是每过一帧实际时间就要<strong>大致</strong>加五秒，这是一个很重要的信息。</p><p>而整个流程就是使用 opencv 读取我们视频的每一帧，然后算出该帧的时间，然后将格式化的时间戳放到那一帧上面去，最后再输出成一个新的视频，这个过程就叫“烧录”。</p><p>核心代码如下：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ref: - [GoPro TimeStamp - The Eminent Codfish](https://www.theeminentcodfish.com/gopro-timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> datetime </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timedelta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> subprocess </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> sp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tqdm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tqdm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> get_file_creation_time </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FONT_COLOR </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># blue, green, red</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;_with-timestamp&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Opens the video import and sets parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VideoCapture</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isOpened</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;failed to open video of </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">file_path</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FPS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_WIDTH</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_HEIGHT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frames_cnt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CAP_PROP_FRAME_COUNT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># float -&gt; int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    duration </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> frames_cnt </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Initializes time origin of the video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creation_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_creation_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_frame_time</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> datetime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> creation_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;frames_cnt: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, FPS: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">FPS</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, initial_timestamp: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cur_frame_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, dimension: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> x </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">, duration: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Command to send via the command prompt which specifies the pipe parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ffmpeg&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-y&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># (optional) overwrite output file if it exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-f&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Input is raw video</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rawvideo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-pix_fmt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;bgr24&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Raw video format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-s&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># size of one frame</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-r&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># frames per second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-i&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The input comes from a pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-an&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Tells FFMPEG not to expect any audio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-vcodec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mpeg4&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token string" style="color:#e3116c">&#x27;-b:v&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;10M&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sets a maximum bit rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               get_output_file_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># output file path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Open the pipe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">command</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stdin</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stderr</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PIPE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== OpenCV is processing =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_time_start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Reads through each frame, calculates the cur_frame_time, places it on the frame and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># exports the frame to the output video.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tqdm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frames_cnt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;ERROR: failed to read frame of [</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">i </span><span class="token string-interpolation interpolation operator" style="color:#393A34">+</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:#36acaa">1</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">frames_cnt</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur_frame_time </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Date: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">putText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Time: &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cur_frame_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">height </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FONT_HERSHEY_COMPLEX_SMALL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    FONT_COLOR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> image </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tobytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;====== finished =======&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process_used_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> process_time_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;used time: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, video period: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> seconds, multiplier: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">process_used_time </span><span class="token string-interpolation interpolation operator" style="color:#393A34">/</span><span class="token string-interpolation interpolation"> duration</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    video</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stdin</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stderr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add_timestamp_for_video</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/Volumes/Disk1/videos/gopro日常/gopro延时生活/2022-06-14/GH011701.MP4&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>输出结果：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358120832-aa46758f93ddc61e960a10c274e8fb7ea49276b152f7d3fa6e343d02c1e2bc9a.png" alt="picture 7" class="img_vXGZ"></p><p>可以看到，基本一比一的处理速度，也就是说原视频时间有多长，程序运行时间就有多长，对于延时摄影来说，一天的录制输出大概就是十分钟的视频，因此脚本每天的运行时长也就是在十分钟左右，这是可以接受的。</p><p>不过这个脚本也有一点点小问题。</p><p>第一个问题是每次读取到第二十帧的时候就会报错，之后就没问题，不明白什么原因，也似乎不影响程序的表现，这个属于 opencv 范畴的问题了，留到以后再考虑了。</p><p>第二个问题就是输出的视频文件比原文件要小很多，直接差了十倍……：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358301337-0a3bc21ac1b530ed8f43053e33a9dc99fc89d90bd464a0e3335c942c9c01ab41.png" alt="picture 8" class="img_vXGZ"></p><p>我们放在一起比对了一下，发现分辨率是没区别的，区别可能是在编码上：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358410672-57cab49192da7b59eed7ba618c39d6d255cee16c69296294643a68eff01f401d.png" alt="picture 9" class="img_vXGZ"></p><p>实际看了一下，发现确实画质上有较大区别，比如原视频的白墙很光滑：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358467434-475e70206879f5478766392201a3660654973eec188934dfe157dbd2a24e0bb0.png" alt="picture 10" class="img_vXGZ"></p><p>但编码后的白墙就明显有那种类似波纹的效果了：</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655358486566-93f149d18618d08ed0741e37dce78415d64e105c79d847a015f57ce19da5d9f1.png" alt="picture 11" class="img_vXGZ"></p><p>从这个角度上说，如果不考虑修改脚本，使之输出原质量的视频，那么我们的脚本输出的视频就只能当做备份与参照视频了，毕竟十倍的比率确实也有一些用武之地。</p><p>然而，这个脚本实际上还有另一个问题，那就是时间不一定能对齐。</p><p>比如刚刚文件对比图上，一个是 20 秒，一个是 19 秒，当然这个其实没有太大所谓了（虽然很非遗所以，也许就是和上面那个有两帧无法处理的问题有关），我更关心的是另一个对齐问题，曝光与时间间隔。</p><p>就是，怎么说呢，我现在并不确定 gopro 的曝光与拍摄间隔之间的关系，比如说，假设我们设置拍摄间隔为 2 秒，曝光时长为 1 秒，那么它是每 3 秒拍一次照片还是每 2 秒拍一张呢？</p><p>如果是每 3 秒拍一次照片，那么我们的算法每一帧加 5 秒就有问题，因为没有算上曝光时间，这样就会导致累积时间变少。</p><p>但如果是每 2 秒拍一张照片，那么更极端的一个情况，例如拍摄间隔为 1 秒，曝光时长为 2 秒，则似乎就无法拍摄了……</p><p>所以，这里有研究一下的必要。</p><p>总之，这种借助 opencv 进行后期处理的手段还是有一定实用价值，适用于很多其他的领域，是一种通用技术手段，我们有必要掌握，并且我对熟练掌握 opencv 之后输出我们想要的视频结果的可能性抱有很高的期望，除了曝光与拍摄间隔对齐的问题之外。</p><p>但输出的画面质量不佳（若提高质量（假设可行），势必速度会下降）与额外脚本运行的不便等因素，使我最后选择了第三种更干净的方案：<code>GoPro Labs</code>。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3借助gopro-labs添加时间戳浮层">方案 3：借助<strong>GoPro Labs</strong>添加时间戳浮层<a class="hash-link" href="#方案-3借助gopro-labs添加时间戳浮层" title="标题的直接链接">​</a></h2><p>如果说第二种方案属于后期，那么本方案则属于前期了。</p><p>众所周知，防患于未然，能从前期着手的方案，基本都是最优的。</p><p>而 GoPro Labs 就能帮助我们实现这点。</p><p>我们要做的事情就是：</p><ol><li>下载 GoPro Labs 的固件版本，完成固件升级（我的 GoPro 是 9，是支持的）</li><li>制作我们的时间戳浮层二维码，扫描后使用</li></ol><p>主要通过这个网站： <a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a> 生成我们所需的二维码，这里的每个参数都比较重要，我们一一解释：</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层大小">浮层大小<a class="hash-link" href="#浮层大小" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359589767-225e990742d950f8587e2c402e3368a9e244f5412a936ac5d47065be0bfe3eea.png" alt="picture 12" class="img_vXGZ"></p><p><code>vertical size</code>是浮层的整体高度，而非单个文字的高度，由于浮层支持多行文本，因此为了目标字体大小，多行文本时对应的竖直高度也要变高，我们设置为 60，对应三行文本，（也就是每行 20，单位大概是像素），效果不错</p><p><code>horizontal size</code>是浮层的整体宽度，因为这个底层是按行排版文本，因此我们直接设置成 0，让它自动调整浮层的宽度即可，即所有行中最长的行的宽度</p><p><code>offset from the edge</code>是与画面边缘（应该是 Y 轴，因为 X 轴距离可以通过下文的换行符控制）的距离， 目前使用的是 10，效果还不错</p><p><code>Limit dispaly time</code>设置成 unlimited 即可。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层内容">浮层内容<a class="hash-link" href="#浮层内容" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655359884415-4a3b036583d6c3be88ca734bf9e9e51f76a3f6600c7ca7d3a5fd2751f4609384.png" alt="picture 13" class="img_vXGZ"></p><p>这个就是配置我们的自定义文本与时间、日期的地方，它是一行行下来的，可以自己用<code>\n</code>分隔符换行（但不可以换顺序，所以时间始终在日期之前）。</p><p>为了从简，我没有加任何个人自定义短语（一开始加了自己的昵称，后来觉得太冗余了，所以还是留空了），但我在尾部加了两个空行，这是为了主动地增加相机与底部（X 轴）的边距，这样输出的视频里的时间戳在我 mac 电脑上预览时不会被进度条挡住。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="浮层位置">浮层位置<a class="hash-link" href="#浮层位置" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360216872-e9f80b49b95e94ae25f967b4693cdd17aef45684d829b5e2986a0b246b40e314.png" alt="picture 16" class="img_vXGZ"></p><p>我将时间戳放在了左下角，因为我平常会在右下角办公，而画面中上部则是主体区域。</p><p>我们的场景中不需要使用 GPS。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码生成">二维码生成<a class="hash-link" href="#二维码生成" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360265681-720de6db987621a49e2a200321fcffca430ef8a599e20145dd6d7804e5b3aba5.png" alt="picture 17" class="img_vXGZ"></p><p>在生成二维码附近还有是否选择<code>active</code>的选项，我之前一开始捣鼓 lab 时弄出了 bug，在 模式设置：<a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a> 中设置出了一个没有的模式，导致系统死掉，最后刷回 GoPro9 1.5 的稳定固件版本，然后重新升级到 lib 版本才恢复，这其中既有可能是模式问题，也有可能是这个浮层当时选了<code>permanent</code>选项，因此我现在已经完全不敢点这个选项了。但并不影响我目标功能的实现。</p><p>基于这些，最终的二维码就生成了，它对应的 QR Command 是：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)[BLHH:MM:SSaa mm-dd-yyyy]\n&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以后我直接基于这个 Command 字符串进行修改即可，还是很方便的，比如加上自定义前缀与后缀的结果如下：</p><div class="language-text codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-text codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">g0oMBRNO=10oMBURN=&quot;(0,60)哈哈哈[BLHH:MM:SSaa mm-dd-yyyy]略略略\n&quot;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们用函数去表达这个字符串输出就是：</p><div class="language-py codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-py codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gen_gopro_overlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_edge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    overlay_height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_leading</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content_ending</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datetime_format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;g0oMBRNO=</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_edge</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">oMBURN=&quot;(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_width</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">,</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">overlay_height</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_leading</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">[BL</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">datetime_fornat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">content_ending</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意到，我们的时间格式也是可以自定义的，并且如果我们基于从字符串（而非网页交互）出发去生成二维码，那么我们就可以定义日期在前时间在后的格式了，比如<code>yyyyy-mm-dd HH:MM:SSaa</code>。虽然这一点未经过测试，但想必是可行的（写文章时才意识到的，hh~）</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="二维码使用">二维码使用<a class="hash-link" href="#二维码使用" title="标题的直接链接">​</a></h3><p>只需要将升级成 lab 固件版本的 gopro 打开后对准我们的二维码，就会自动识别并应用了，然后“BOOM”，一个可爱的浮层就出现了！</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655360991571-d8d1b7e0310840ea24d4942d811b06c8afce5eb567d92a10db6ca0642adcd2f5.png" alt="picture 18" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="缺陷">缺陷<a class="hash-link" href="#缺陷" title="标题的直接链接">​</a></h3><ol><li>除了上文提到的容易导致系统挂掉之外，正常操作不会有问题</li><li>经测试，我们的时间戳浮层对照片和夜间延时没有效果，对普通视频与正常延时有效果。经过思考，我这个项目一开始采用夜间延时的方案现在觉得不太适用，因为实测下来在夜间我屋子几乎全黑的环境下即使开了夜间延时也几乎无法拍出能看清的画面，而白天看投影时又会导致曝光过高，因此直接放弃夜间的效果即可。当初拍夜间是为了监测睡眠，那段时间也会在睡觉时留一盏小灯（戴眼罩）以获得最好的拍摄效果，现在睡眠项目已经结项了，因此不需要了。我也更喜欢无声+全黑的睡眠环境。</li><li>关于上一点，也好像不是没有解决方案，正如我笔记中记载的 <a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a> 这篇帖子里的小哥貌似碰到的就是和我差不多的问题并有一个解决方案，但我暂时已经不需要了，以后有机会再研究吧！</li></ol><h3 class="anchor anchorWithStickyNavbar_rB0w" id="其他用处">其他用处<a class="hash-link" href="#其他用处" title="标题的直接链接">​</a></h3><p>GoPro Labs 的功能不仅限于添加浮层这一项，恰恰相反，这是里面最小的一个应用之一。</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-timestamp-1655361326041-ae5359c76c082cda93c03f928c7e5ad513c1636b7dd46f1865dbf5e6b75e3da9.png" alt="picture 19" class="img_vXGZ"></p><p>它还有很多其他有趣的场景应用，必须运动检测、自动切换模式等，详情可参考：</p><ul><li><p><a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p><a href="https://www.youtube.com/watch?v=YaXcu0E10WM" target="_blank" rel="noopener noreferrer">(151) GoPro Labs: How to Use QR Codes to Instantly Switch Your Settings - YouTube</a></p></li><li><p><a href="https://www.youtube.com/watch?v=0LCGiO7jMEw" target="_blank" rel="noopener noreferrer">(151) GoPro Labs 2021 New Features for Hero 9, Max, Hero 8, Hero 7: Hands-on Details &amp; Explainer - YouTube</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="方案-3-个人笔记">*<!-- -->方案 3 个人笔记<a class="hash-link" href="#方案-3-个人笔记" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab01-how-to-install-the-labs-firmware">LAB01: how to install the labs firmware<a class="hash-link" href="#lab01-how-to-install-the-labs-firmware" title="标题的直接链接">​</a></h3><p>see <a href="https://gopro.com/en/us/support/hero9-black-product-update" target="_blank" rel="noopener noreferrer">Hero9 Black Product Update | GoPro</a>, but I failed to generate the target firmware in this site.</p><p>So I downloaded it in other place, e.g. - <a href="https://www.goproforums.com/threads/need-hero9-black-firmware-update-v1-5.87636/" target="_blank" rel="noopener noreferrer">Need HERO9 Black firmware update v1.5 | GoPro Forums</a>, which directed me to the dropbox download page: - <a href="https://www.dropbox.com/s/edh41nffo6d6gns/GoPro%20Hero%209%20firmwares%20fishycomics.zip?dl=0" target="_blank" rel="noopener noreferrer">GoPro Hero 9 firmwares fishycomics.zip</a></p><p>And finally, I saved two different firmwares in local disk, one for stable version, one for the lib one:</p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655351979322-5f9d394f99b48f506a3fb28de9adadfd94be9ebc9f57562d3925e88635f16863.png" alt="picture 2" class="img_vXGZ"></p><p><img loading="lazy" src="https://mark-vue-oss.oss-cn-hangzhou.aliyuncs.com/gopro-1655340186034-7e904daaa952ca0a5c3457c103fcddaa9eaee79362a7051a179ef1ca14576416.png" alt="picture 1" class="img_vXGZ"></p><p>ref:</p><ul><li><a href="https://community.gopro.com/s/article/GoPro-Labs?language=en_US" target="_blank" rel="noopener noreferrer">GoPro Labs Information</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab02-qr-controls-for-settings">LAB02: QR Controls For Settings<a class="hash-link" href="#lab02-qr-controls-for-settings" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><p>documentation: <a href="https://community.gopro.com/s/article/GoPro-Labs-QR-Control?language=en_US#secondupdate" target="_blank" rel="noopener noreferrer">GoPro Labs: QR Controls For Settings</a></p></li><li><p>custom qr control: <a href="https://gopro.github.io/labs/control/custom/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/custom/</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="lab03-add-an-overlay-to-viedeo">LAB03: add an overlay to viedeo<a class="hash-link" href="#lab03-add-an-overlay-to-viedeo" title="标题的直接链接">​</a></h3><p>see:</p><ul><li><a href="https://gopro.github.io/labs/control/overlays/" target="_blank" rel="noopener noreferrer">https://gopro.github.io/labs/control/overlays/</a></li></ul><p>ref:</p><ul><li><p><a href="https://community.gopro.com/s/question/0D53b00008HOPq7CAH/how-do-i-add-timestamp-to-hero-10-videos?language=en_US" target="_blank" rel="noopener noreferrer">How do I add timestamp to Hero 10 videos?</a></p></li><li><p><a href="https://www.reddit.com/r/gopro/comments/pt6u8j/burning_timestamp_on_gopro_movie/" target="_blank" rel="noopener noreferrer">Burning timestamp on GoPro movie : gopro</a></p></li></ul><p>bugfix: gopro labs won&#x27;t add timestamp to interval videos, see:</p><ul><li><a href="https://community.gopro.com/s/question/0D53b00008QAGooCAH/combining-the-video-overlay-and-interval-video-feature?language=en_US" target="_blank" rel="noopener noreferrer">Combining the video overlay and interval video feature.</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后一点感受">最后一点感受<a class="hash-link" href="#最后一点感受" title="标题的直接链接">​</a></h2><p>国外的极客生态真地很繁荣，一个小小的 gopro 就能玩出这么多的花样，反观国内，似乎还停留在各种参数的堆砌与各种大饼的圈画上，实则看不到太多对待一个具体的事物（而非钱）研究的诚意与专注的热爱。</p><p>之前携国货之光大疆无人机奔赴川藏线，它真地很好。但现在身处帝都，最终还是无用武之地，幸好有位天体物理博士愿意收购它，让它继续发光发热。而我，则只有尽我可能，把一些有趣的东西搞的更明白一些、更有用一些、更好玩一些。</p><p>gopro 的话题，从上篇的 open-gopro 到本篇的 GoPro Labs，基本已经涉及了 gopro 核心开发生态的方方面面，朋友们需要时完全可以顺着这两篇一窥 gopro 的里子，进而玩出新的花样。</p><p>下一期，我们聊聊最近做的另外一个有趣的小东西：投影与手机遥控器。</p><p>Best Wishes to All of You.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_rTaS padding--none margin-left--sm"><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/开发笔记">开发笔记</a></li><li class="tag_l5va"><a class="tag_Nd8t tagRegular_TiLs" href="/blog/tags/go-pro">GoPro</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/page/3"><div class="pagination-nav__label">较新的博文</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/5"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>