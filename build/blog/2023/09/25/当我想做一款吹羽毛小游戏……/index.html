<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0-alpha.0">
<title data-rh="true">当我想做一款吹羽毛小游戏…… | 南川笔记</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://markshawn2020.github.io/blog/2023/09/25/当我想做一款吹羽毛小游戏……"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="当我想做一款吹羽毛小游戏…… | 南川笔记"><meta data-rh="true" name="description" content="logo"><meta data-rh="true" property="og:description" content="logo"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-09-25T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://markshawn2020.github.io/blog/2023/09/25/当我想做一款吹羽毛小游戏……"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/2023/09/25/当我想做一款吹羽毛小游戏……" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://markshawn2020.github.io/blog/2023/09/25/当我想做一款吹羽毛小游戏……" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="南川笔记 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="南川笔记 Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFQ00XLDNZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-QFQ00XLDNZ",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b123addb.css">
<link rel="preload" href="/assets/js/runtime~main.aacdcb6f.js" as="script">
<link rel="preload" href="/assets/js/main.c22735e8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_UHvc">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--light_kaXc"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_qLAv themedImage--dark_ONYO"></div><b class="navbar__title text--truncate">南川笔记</b></a><a class="navbar__item navbar__link" href="/blog/archive">My Blog</a><a class="navbar__item navbar__link" href="/docs/">My Notes</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/markshawn2020/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Framework<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/docusaurus-my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/markshawn2020/my-documents" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Source of Documents<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_bT41 colorModeToggle_UolE"><button class="clean-btn toggleButton_x9TT toggleButtonDisabled_Dj8q" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_dnYY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_OBbf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_CTO4"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_PEsc"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_P3nc thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_VrjY margin-bottom--md">All Posts</div><ul class="sidebarItemList_OSkG clean-list"><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-INFP与ENTJ的日日夜夜">2024/2422-INFP与ENTJ的日日夜夜</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/2422-从FP走向TJ">2024/2422-从FP走向TJ</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/06/21/Rabbit-R1分享会">Rabbit-R1分享会</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/05/01/2419-信仰一跃">2419-信仰一跃</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/04/30/飞脑">飞脑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/discarded/微信聊天记录备份指南">微信聊天记录备份指南</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2024/01/14/觉醒的硅基">觉醒的硅基</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/31/index">[03-27-digital-travel] 南川数字游民之旅01：</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/27/南川骑行川藏线（下）">南川骑行川藏线（下）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/19/十年 —— 一位自学者、技术工作者、理想主义者的独白">十年 —— 一位自学者、技术工作者、理想主义者的独白</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/12/18/南川骑行川藏线（中）">南川骑行川藏线（中）</a></li><li class="sidebarItem_WJ0y"><a aria-current="page" class="sidebarItemLink_Qrfg sidebarItemLinkActive_nUeK" href="/blog/2023/09/25/当我想做一款吹羽毛小游戏……">当我想做一款吹羽毛小游戏……</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦">Poketto.AI: 每一个人的哆啦A梦</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/12/31/this-year">this-year</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/29/coding-cries">代码有所能，有所不能</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/03/taiwan-data-research">关于台湾进出口临时政策与历史数据的研究</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/08/01/wechat-hack">微信数据库破解</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/11/prose-I-am-me">札记 | 我与我周旋久，我亦是我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/07/02/dev-gaokao">编程 | 使用 pandas 研究高考志愿填报</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/16/dev-gopro-2">编程 | GoPro 02: 玩转 OpenLab</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/11/dev-gopro-1">编程 | GoPro 01: 全天候自动 4K 延时摄影</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/06/06/dev-ios-automation">编程 | iOS 自动化实现王者荣耀一键换装</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/23/dev-mp3-meta">编程 | 逼哥的音乐元数据修复</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/22/evaluation-breo-dream6">评测 | Breo Dream6 按摩仪</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/15/prose-is-not-easy">札记 | 须知，活好是很不容易的</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/05/14/dev-voice2srt">编程 | 视频剪辑自动转写字幕</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/04/22/research-mbti/mark_mbti">研究 | 基于 MBTI 的人生复盘与计划（上）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/27/prose-321-air-crash">札记 | 愿逝者安息生者坚强，你我迎风奔跑向阳而生</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/03/09/dev-douban-renting">编程 | 北京租房系统设计、研究与经验 0.1.0</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/21/ad-beike-hiring">推广 | 贝壳新业务 VR 全职开发招募</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/12/coding-design-shortcuts/02-12-coding-design-shortcuts">编程设计艺术思考（持续更新）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/03/prose-living">札记 | 2022，活着</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/02/dev-linux">编程 | Linux 笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/02/01/prose-2022-begining">札记 | 关于近几年的一些感悟</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/23/prose-engineer-cultivation">札记 | 一位工程师的自我修养（序）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/20/prose-first-job">札记 | 是的，我入职了</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2022/01/01/prose-my-2021">札记 | 我的 2021：混沌与洞见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/24/dev-webpack">编程 | 记与 Webpack 十二小时的奋战</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/一道“全军覆灭”的数学题">一道“全军覆灭”的数学题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/12/04/考研数学试题编辑">考研数学试题编辑</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/28/今天南川学习十小时了吗？是的。">关于正态分布表的一个有趣发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/11/09/浅谈我自学编程的经历与经验">浅谈我自学编程的经历与经验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/28/关于有人想仲裁我">关于有人想仲裁我</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/27/十月：无题">十月：无题</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/10/18/王者荣耀打野上分经验总结（全干货）">王者荣耀打野上分经验总结</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/06/27/毕业一年：我的得与失">南川二一零六：毕业一年，我的失与得</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/05/12/记逆向攻破拼多多加密系统">南川逆向笔记 | 攻破 PDD 风控系统（一）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/04/14/从0到1搭建一个Electron应用">Electron 开发笔记 - 从 0 到 1 搭建一个 Electron 应用</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/03/12/shamghai-rent-lesson">记与上海无良房东斡旋经验与教训</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2021/01/09/评测-南川Effie使用初体验">南川 Effie 使用初体验</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/11/20/拜登获胜演讲稿">拜登获胜演讲稿</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/28/人生 | 五台山论道（节选自《遥远的救世主》）">五台山论道（节选自《遥远的救世主》）</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：一路失败，我到底学到了什么">大学沉思录：一路失败，我到底学到了什么</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/10/16/大学沉思录：意向调查">大学沉思录：意向调查</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/22/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/15/投资：凯利公式">“中一千万”与“挣一千万”到底哪个更容易</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/bug_fix">BUG FIX</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/home">南川笔记中文首页</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/todo-old">待办事项</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/release-notes">更新日志</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/guestbook">留言墙</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/12/经验与发现">经验与发现</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/10/JS、ES、TS、node、Vue、React修炼">JS、ES、TS、node、Vue、React 修炼</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/开发常用命令行">开发常用命令行</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/my_university">谨以此文，纪念我在大学的这四年</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/VuePress-Journal">VuePress你好，VuePres再见</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/vue开发笔记">vue开发笔记</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/博客开发之导航设计方案">博客开发之导航设计方案</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/如何向ElementUI一样封装Message全局组件">如何向ElementUI一样封装Message全局组件</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/如何给右键添加任何启动程序">如何给右键添加任何启动程序</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/08/29/我谈《三十而已》">我谈《三十而已》</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/文集/极客运营手册/">极客运营手册</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/ssg-ssr">When to Use Static Generation v.s. Server-side Rendering</a></li><li class="sidebarItem_WJ0y"><a class="sidebarItemLink_Qrfg" href="/blog/2020/09/13/pre-rendering">Two Forms of Pre-rendering</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_UBNu" itemprop="headline">当我想做一款吹羽毛小游戏……</h1><div class="container_x5Un margin-vert--md"><time datetime="2023-09-25T00:00:00.000Z" itemprop="datePublished">2023/09/25</time> · <!-- -->阅读需 25 分钟</div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/logo.png" alt="logo" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><p>最近在B站有一款「李佳琦吹羽毛」的游戏非常火，我也去详细看了，觉得脑洞大开，非常有趣。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/41jq3t.jpg" alt="image-20230925090726811" class="img_vXGZ"></p><p>无奈该款游戏UP主由于框架选型原因只有pc版的，很不方便。</p><p>考虑到我很喜欢基于 React 做些网页端随时可用的工具，因此打算也试着实现一番，其中诞生了一些思考与经验，特此分享一下。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="目标设计">目标设计<a class="hash-link" href="#目标设计" title="标题的直接链接">​</a></h2><p>按照 UP 主的设计，目标是一款 2D 游戏，里面有游戏状态区、玩家、天空（一排花西子眉笔），和道具（分羽毛和金币）两种，以及一些其他的模型与动画效果，比如吹的时候会有气流等。</p><p>值得注意的是，羽毛在默认情况下，会缓慢降落，目测是固定的速度，这说明我们不需要基于重力系统实现这款游戏，这也是我们第一版实现的时候采取的方案，但是有个缺点，那就是依旧要处理羽毛被吹时的加速度变化（以看起来像是真地被吹了一样）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v1-梦开始的地方">V1 梦开始的地方<a class="hash-link" href="#v1-梦开始的地方" title="标题的直接链接">​</a></h3><p>我们一开始是手写了这样的加速度变化，具体而言，我们首先给定每片羽毛的初始速度为比如说 0.3，然后一旦以力 F 吹了之后，速度变为 0.3 - F （比如说 -0.2，这样就反方向运动了），接着再在每一个 tick 不断回升其速度到原始速度，这样就模拟出了一个抛物增速的效果。</p><p>这是在纯手动实现上唯一一个比较细节的点，其他就还好了。就这样，我们很快设计出了第一版有加减速的版本。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/9f5ych.png" alt="IMG_2928" class="img_vXGZ"></p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v2-伟大但失败的多人混战模型">V2 伟大但失败的多人混战模型<a class="hash-link" href="#v2-伟大但失败的多人混战模型" title="标题的直接链接">​</a></h3><p>当然，以上的游戏设计还远不能让我们感到满意，倒不是 UI 层面，而是逻辑层面，觉得太简单了。其实如果细心的话可以看到，我们的第一版就和 UP 主的设计不一样，区别在于没有了花西子眉笔，这样就没有了羽毛撞到花西子眉笔变成花西币的机制了，只能玩家之间互相吹来吹去，因此需要做多人在线。</p><p>此时，我心中一个大型多人在线的想法萌动了出来，既然大家只需要把羽毛吹来吹去，那其实人数（在带宽允许的情况下）可以无限多，我们只需要所有人等分一个圆即可！</p><p>于是，一个自觉天才的想法就诞生了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/4gajx6.png" alt="35da072b4f37e1f4cf43376ee9636e9d" class="img_vXGZ"></p><p>上述模型可以分成服务端和客户端两部分，其中服务端是个圆的世界模型，所有用户均匀分散在圆环上，而客户端（也就是用户界面）上是一个用户视角的矩形，其中下半矩形对应世界模型玩家侧的 1/N 区域，上班矩形则对应世界模型对手侧的 (N-1)/N 区域。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/dceyv4.jpg" alt="IMG_2953" class="img_vXGZ"></p><p>但由于我们时间仓促，这个模型，虽然实现了，但是有bug，就是各种角度换算啥的，其实没算明白。</p><p>结果就被我们的产品经理给砍了，因为她首先非常不同意把 UI 做成矩形，因为这是个 2D 游戏，2D游戏一般要让所有玩家看到相同的游戏界面（例如三国杀之类），这么搞，每个用户的视角不一样，一般是 3D 的做法。</p><p>其次，也会让用户误会，以为自己是 1 VS (N-1)。</p><p>其实仔细看我们的世界模型可以发现，如果我们的羽毛每次从世界中心随机方向发出，然后被玩家吹后又逆向返回，则所有的玩家平均下来其实都是 1 v 1，其中玩家数量为偶数时正好对称，为奇数时则形成环。（我一开始就考虑过这个问题，并准备设计如果玩家是偶数，则变成组队模式（因为可以正好分成两队）。）</p><p>综合分析下来确实得不偿失，我们暂时没有必要做成这样，复杂还不一定买单。</p><p>不过我们的产品经理倒也并不反对有一个圆形的世界模型，但她更建议在客户端上做成一个圆或者椭圆。而现在的矩形……虽然我觉得只是曲率的区别……</p><p>我甚至想过给用户提供一个一键切换 UI 模式的按钮，让用户可以在矩形 UI 与圆形 UI 之间切换，但必须承认，这确实是偏技术角度的思考，矩形 UI 真地有很大的问题。</p><p>我自己举个觉得别扭的地方吧，我们刚刚说了矩形上下区域对应的世界模型面积是不一样的（ 1 : n-1 ），这导致一个什么问题呢？如果我们的程序运行无误，在多人模式下，羽毛从自己这边飞过“楚河汉界”（也就是世界中心）后，羽毛会瞬间变小为 1/(n-1)，并且会产生 x 轴的 shift，因为比例被压缩了，我觉得这是体验很不好的。</p><p>最后考虑到时间成本，我们暂时先搁置了换算 bug，开始 V3 的计划。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v3-只要肯放弃万事无难事">V3 只要肯放弃，万事无难事<a class="hash-link" href="#v3-只要肯放弃万事无难事" title="标题的直接链接">​</a></h3><p>在产品经理的耳提面命下，我们深刻地吸取了 V2 的教训，决定先完美复刻 UP 主的产品，守住初心。</p><p>于是，吭吭吭，很快，我们有了 UI 最酷炫的一版。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/hqgp8m.png" alt="IMG_3007" class="img_vXGZ"></p><p>在这一版中，我们深刻分析了游戏需要绝对位置的概念，因此自己封装了一些“游戏组件”，并且为了测试各种 <code>translate</code>，还额外加了 debug 的 UI 功能：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/vw8n25.png" alt="IMG_2988" class="img_vXGZ"></p><p>只要开启测试模式，就可以实时显示每个元素的准心与边界，非常好用。</p><p>（不过后来我在使用 phaser 时发现人家也有这种设计，并且还显示物体的速度与加速度，更专业！）</p><p>这点给我的启示，真地是，世间的智慧是相通的，比如看这个人的评论：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/dz2aoc.png" alt="947a5e4cd03b1cbd20ddeb7d023edd50" class="img_vXGZ"></p><p>ok，暂时先不扯太远，总之，如您们所见，第三版在放弃梦想之后，老老实实做单机，加入花西子口红，一切就非常顺利，甚至还有时间换上了酷炫的背景动画，以及各种马里奥的 bgm 和 特效。这一版是我最喜欢的一版，尤其是在 UIUX 上。</p><p>但是，很可惜，产品经理马上就指出了新的问题：掉帧严重！</p><p>为此，我开启了慢慢地调试与摸索之路，继而真正领会了游戏开发的奥秘。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v4-游戏开发的左手渲染引擎">V4 游戏开发的左手：渲染引擎！<a class="hash-link" href="#v4-游戏开发的左手渲染引擎" title="标题的直接链接">​</a></h3><p>经过大量的调试，我逐步排除了桩服务器、多次setState、hook memo 等可能的性能问题，查阅了大量资料，最终不得不承认，基于状态管理的 react 根本不适合作为高刷游戏的载体，仅仅是 79 个羽毛与金币，服务端 50 的 fps，客户端 UI 竟然能卡到只剩 10 fps，这绝对是无法接受的。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/rbj11v.jpg" alt="0ba6a341303b5c06f42264ad9b9221e4" class="img_vXGZ"></p><p>但同样的代码，我们使用 <code>react-three-fiber</code> （底层基于 <code>webgl</code>与<code>canvas</code>）却能完美运行，客户端 UI 少说也能稳定在 30 fps 以上！</p><p>我不相信，又做了大量的调优，最后还是不得不放弃，除非我改写整个 react 的状态刷新，比如 79 个羽毛和金币 不要用 <code>setState</code> 之类，而是自己画 <code>canvas</code> 或者用 <code>ref</code> 更新啥的，但总之，这个工作量，或者说目标实现，其实就等于重新用一套新的渲染引擎了，而这一套引擎，我重点查了一下，大致有 <code>pixijs</code> 、<code>threejs</code>、<code>phaser</code>等等。</p><p>最终，我们使用 <code>react-three-fiber</code>（ <code>threejs</code>的<code>react</code>版），完成了我们第四版的游戏设计，并在设置菜单里提供了渲染模型的切换，大家可以切换后仔细对比两种渲染引擎下的性能差异（至少 2 倍，实际是差一个数量级）。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="v7-游戏开发的右手游戏引擎">V7 游戏开发的右手：游戏引擎！<a class="hash-link" href="#v7-游戏开发的右手游戏引擎" title="标题的直接链接">​</a></h3><p>既然我们已经把目光从传统的 react 开发转向了渲染引擎，那么最后一步，直接使用专业的游戏引擎进一步加速研发，将成为了一个自然的选择，所谓游戏引擎，就是集成了 刷新、交互、渲染等一整套游戏逻辑，以性能、兼容性等为主要目标的框架。</p><p>我主要查看了以下资料：</p><ul><li>⚛️ React | Web Game Dev, <a href="https://www.webgamedev.com/engines-libraries/react" target="_blank" rel="noopener noreferrer">https://www.webgamedev.com/engines-libraries/react</a></li><li>React for game development? : r/reactjs, <a href="https://www.reddit.com/r/reactjs/comments/dnfld6/react_for_game_development/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/reactjs/comments/dnfld6/react_for_game_development/</a></li><li>Does it make sense to use React for canvas game GUI, that will get updated VERY frequently? : r/reactjs, <a href="https://www.reddit.com/r/reactjs/comments/14sl7fl/does_it_make_sense_to_use_react_for_canvas_game/" target="_blank" rel="noopener noreferrer">https://www.reddit.com/r/reactjs/comments/14sl7fl/does_it_make_sense_to_use_react_for_canvas_game/</a></li><li>Collection: JavaScript Game Engines, <a href="https://github.com/collections/javascript-game-engines" target="_blank" rel="noopener noreferrer">https://github.com/collections/javascript-game-engines</a></li><li>Top 6 JavaScript and HTML5 game engines - LogRocket Blog, <a href="https://blog.logrocket.com/best-javascript-html5-game-engines/" target="_blank" rel="noopener noreferrer">https://blog.logrocket.com/best-javascript-html5-game-engines/</a></li><li>compare with three.js · Issue #39 · pixijs/pixijs, <a href="https://github.com/pixijs/pixijs/issues/39" target="_blank" rel="noopener noreferrer">https://github.com/pixijs/pixijs/issues/39</a></li><li>Phaser vs PixiJS for making 2D games - DEV Community, <a href="https://dev.to/ritza/phaser-vs-pixijs-for-making-2d-games-2j8c#:~:text=Phaser%20has%20more%20game%2Dspecific,organized%20for%20games%20by%20default" target="_blank" rel="noopener noreferrer">https://dev.to/ritza/phaser-vs-pixijs-for-making-2d-games-2j8c#:~:text=Phaser%20has%20more%20game%2Dspecific,organized%20for%20games%20by%20default</a>.</li></ul><p>并且在简单尝试了 star 70 多 k 的 <code>GoDot</code> 之后，觉得还是不太习惯有 UI Editor 的游戏框架，以及不太想学新的语言（GDScript）。但不排除未来会有深度研究使用 <code>GoDot</code> 的可能，毕竟它 2D、3D都支持，而且是跨端的，会基于目标输出平台决定所使用的性能，这个非常棒。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/aez70g.jpg" alt="image-20230925091822199" class="img_vXGZ"></p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/7pbkjd.jpg" alt="image-20230925092037914" class="img_vXGZ"></p><p>（好吧，其实是因为 <code>GoDot</code> 我不怎么会用，2333 ……）</p><p>而在 JS 生态里，2D 有 <code>phaser / pixi.js</code> ，3D 有 <code>three.js</code> ，目前都非常能打，所以最终选择了 <code>phaser</code>。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/zywc7c.jpg" alt="image-20230925084426852" class="img_vXGZ"></p><p><code>phaser</code> 由于经常被用于制作 rpg 游戏，所以我们也融入了一些 rpg 元素，摸索 <code>phaser</code> 也花了一定的时间，但最好的学习资料就是 <code>phaser</code> （ v3 版本）的官方案例库：</p><ul><li>photonstorm/phaser3-examples: Phaser 3 Examples, <a href="https://github.com/photonstorm/phaser3-examples" target="_blank" rel="noopener noreferrer">https://github.com/photonstorm/phaser3-examples</a></li></ul><p>它的在线 demo 做的很高端（sha bi），竟然用的是文件夹的形式，但是请相信我，每个文件夹都过一过，这绝对是最好的资料，与代码库直接对接，否则绝对都是舍近求远了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102310842.png" alt="image-20230925102310842" class="img_vXGZ"></p><p>比如我们可爱的 <code>nayuki</code> 同学，就是在 <code>/Input/Dragging</code> 里一眼相中的：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/cuz3c8.jpg" alt="image-20230925075546752" class="img_vXGZ"></p><p>然后我们游戏里吹羽毛时的龙卷风，其实本来是想直接用 <code>/Animation/Yoyo</code> 里的火焰，但是代码里是基于图像的切片实现的，火焰与角色是混在一起的，不方便切，所以就放弃了。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102348410.png" alt="image-20230925102348410" class="img_vXGZ"></p><p>最后我们是结合 ChatGPT4 自己手写了扇形蒙版动画，并精心挑选了静态龙卷风 png 组合完成：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/waxnee.jpg" alt="image-20230925075644351" class="img_vXGZ"></p><p>最终效果，就是酷炫的动态龙卷风了：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/RPReplay_Final1695640188%20(2).gif" alt="RPReplay_Final1695640188 (2)" class="img_vXGZ"></p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="核心技术汇总">核心技术汇总<a class="hash-link" href="#核心技术汇总" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="fps">FPS<a class="hash-link" href="#fps" title="标题的直接链接">​</a></h3><p> 帧同步主要瓶颈一般是在客户端上，因为客户端不但要处理数据更新，还要处理数据渲染，UI 与事件会抢进程，再加上与后端接口数据交互有延时，就会有明显的掉帧。</p><p>因此在网页端，几乎都是 30 FPS 左右，60 FPS 都要风扇发热了，更高（比如 90 FPS、120 FPS）就只有在设备终端本机环境、电影院等才支持了。</p><p>而在客户端向服务器获取数据上，有几种办法，除了 socket 之外，都是客户端主动向服务端发起请求的，以下给出几种办法。</p><ol><li><code>useInterval</code></li></ol><p>而在客户端，我们一开始是使用一个 <code>useInterval</code>函数，它可以每隔 N ms 刷新一次 UI，以下是我们后端小哥哥和 <code>@mantine/hooks</code>里<code>useInterval</code>写法的对比：</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102451944.png" alt="image-20230925102451944" class="img_vXGZ"></p><p>对比下来，如果不涉及主动控制，确实还是我们小哥哥写的简单方便，而且由于每次都传入最新的 <code>cb</code>，因此不会有脏数据的问题。</p><ol start="2"><li>基于 <code>trpc</code></li></ol><p>可以基于 <code>referchInterval</code> 参数，自动每 N ms 获取一次数据。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> isFetching </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">syncServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">useQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eventsId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> eventsIdRef</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">current</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      refetchInterval</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CONFIG</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">game</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但使用 trpc 也要谨慎，有时会出现 <code>isFetching = false, data=undefined</code>的情况，这还是一个暂时留待去研究的小 bug。</p><p>除此之外，倒是问题不大。</p><ol start="3"><li>基于游戏引擎的 nextTick 机制</li></ol><p>游戏引擎里都会有一个类似 <code>init</code> 和 <code>onUpdate</code> 的机制，每个 tick 都会自动触发 <code>onUpdate</code> 函数。在这个函数里面我们可以处理数据的更新。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// update 函数里非常适合处理 Input 事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// this.tick++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// const fps = Math.round((1000 / delta) * 10) / 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// console.log({time, delta, tick: this.tick, fps})</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vw</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">LEFT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-=</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">D</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">RIGHT</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 只要按住就会一直feedback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SPACE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isDown</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lastDownTime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console.log(&quot;down: &quot;, this.lastDownTime)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SPACE</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isUp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 不考虑drag了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console.log(&quot;up: &quot;, Date.now() - this.lastDownTime)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">handleShoot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">lastDownTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">isSpacingPressing</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">updatePlayerX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">player</span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="socket-与-nextjs-的集成">socket 与 nextjs 的集成<a class="hash-link" href="#socket-与-nextjs-的集成" title="标题的直接链接">​</a></h3><p>多人在线玩游戏是一个看起来很简单，但实际上颇有技巧的一件事，一般都用 socket，但也有其他的方案。</p><p>这里简单说一下我们集成 <code>socket.io</code> 到 <code>nextjs</code> 里的一些要点：</p><p>首先一个非常大的坑是，<code>nextjs@13.4.12</code>环境下，<code>socket.io</code>服务器端需要额外配置<code>addTrailingSlash: false</code>，否则会自动加上 <code>/</code> 导致 api 访问出错，具体参考：<a href="https://github.com/vercel/next.js/issues/49334#issuecomment-1539268823" target="_blank" rel="noopener noreferrer">https://github.com/vercel/next.js/issues/49334#issuecomment-1539268823</a></p><p>其次，由于 <code>socket.io</code> 默认挂载在 <code>/socket.io/</code> 路径下，与 <code>nexjts</code> 默认的 api 路由并不一致，因此需要做一些处理，这里提供三种办法。</p><ol><li>显式指定 socket 挂载的路径：</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// [server] /pages/api/socket.ts </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  req</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NextApiRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NextApiResponseServerIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// console.log(&quot;Socket is already running&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;initializing Socket.io server...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// adapt Next&#x27;s net Server to http Server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> httpServer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> NetServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> server </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Server</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">httpServer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOCKET_IO_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      addTrailingSlash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">handleSocket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// append SocketIO server to Next.js socket server response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">                            </span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// [client] /lib/socket.ts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> socket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">socketio</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 不需要添加 url，直接指定 path即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transports</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// &quot;websocket&quot;, // 不能开 websocket，我也不知道为什么！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;polling&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这是默认的，关了后就没法用了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ref: https://stackoverflow.com/a/41953165/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SOCKET_IO_ENDPOINT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    autoConnect</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>无论是客户端还是服务器端，都不指定 path，而是基于 fetch 激活服务端路由 （很多帖子里都是用的这种办法，很神奇）</li></ol><div class="language-ts codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-ts codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">init</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 要先唤醒一下服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/api/socket&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// no-op if the socket is already connected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;connecting&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> allEvents</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;on handler of &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;connect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 客户端有可能都没有监听 UserJoinRoom，但是服务端我们要加，否则客户端容易bug</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SocketEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserJoinRoom</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">user </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">socket</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c"> joined room </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">roomId</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">...</span><span class="token plain">extra</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        socketId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> IFullMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>还有一种办法，是单开一个 nodejs 服务，使用 middleware 形式启动 socket，由于我个人不是很喜欢，所以就不放了。但也是很重要的一种办法。也很直接。</li></ol><p>除了以上的一些要点之外，在 socket 的写法上也有各种办法，我是用了一个 <code>useSocketEvents</code> 统一管理需要监听的函数，注意最后要使用 <code>beforeunload</code> 的 eventListener 做清理动作，否则用户刷新浏览器，socket还活着，不符合预期。</p><div class="language-tsx codeBlockContainer_jDV4 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_vx7S"><pre tabindex="0" class="prism-code language-tsx codeBlock_Gebt thin-scrollbar"><code class="codeBlockLines_FJaf"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Event</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">args</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> defaultEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// { name: &quot;connect&quot;, handler: console.log },</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;connect_error&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;disconnect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">log</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * ref: https://www.codeconcisely.com/posts/react-socket-io-hooks/</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">useSocketEvents</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extra</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">IMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;using socket events&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> roomId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userImage </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> extra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> allEvents</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">Event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">defaultEvents</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">cleanup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;disconnecting&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> event </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> allEvents</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;off handler of &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      socket</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">off</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token method function property-access" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;beforeunload&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// note: important! react不会自己清除，ref: https://stackoverflow.com/a/61310052/9422455</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;beforeunload&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_cUGO"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_OqsO" aria-hidden="true"><svg class="copyButtonIcon_PgCn" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_bsQG" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_rB0w" id="游戏引擎与-reactnextjs-的集成">游戏引擎与 React/NextJS 的集成<a class="hash-link" href="#游戏引擎与-reactnextjs-的集成" title="标题的直接链接">​</a></h3><p>诚如这位老哥所言， React 可以与游戏集成，但是仅限于用于制作 UI 上，要注意与游戏的代码分离。</p><p><img loading="lazy" src="https://poketto.oss-cn-hangzhou.aliyuncs.com/image-20230925102547276.png" alt="image-20230925102547276" class="img_vXGZ"></p><p>我也顺利找到了将 <code>phaser</code> 与 其他集成的模板：</p><ul><li>【pahser + webpack】nodes777/phaser3-react-template: A starter template for using PhaserJS and React, <a href="https://github.com/nodes777/phaser3-react-template" target="_blank" rel="noopener noreferrer">https://github.com/nodes777/phaser3-react-template</a></li><li>【phaser + create-react-app】kevinshen56714/create-react-phaser3-app: Minimal Phaser3 + Create React App template, <a href="https://github.com/kevinshen56714/create-react-phaser3-app" target="_blank" rel="noopener noreferrer">https://github.com/kevinshen56714/create-react-phaser3-app</a></li><li>【phaser + ion-phaser】proyecto26/ion-phaser: A web component to use Phaser Framework with Angular, React, Vue, etc 🎮, <a href="https://github.com/proyecto26/ion-phaser" target="_blank" rel="noopener noreferrer">https://github.com/proyecto26/ion-phaser</a></li><li>【phaser + nexjts】 isrmicha/nextjs-phaser: NextJs Phaser Starter Template, <a href="https://github.com/isrmicha/nextjs-phaser" target="_blank" rel="noopener noreferrer">https://github.com/isrmicha/nextjs-phaser</a></li></ul><p>我个人比较喜欢 <code>nextjs</code>，因此基于最后的改了改，其实核心要领，就是要用 <code>dynamic</code> 组件，因为 <code>phaser</code> 不支持 <code>ssr</code>，否则会甚至有 <code>HTMLVideoElement is not defined</code> 的问题。</p><h3 class="anchor anchorWithStickyNavbar_rB0w" id="力导向">力导向<a class="hash-link" href="#力导向" title="标题的直接链接">​</a></h3><p>在 <code>phaser</code> 中提供了几个关于 <code>applyForce</code> 相关的函数，都是基于 <code>matter.js</code> 的。</p><p>主要有三个 API，都在 <code>Phaser.Physics.Matter.MatterPhysics</code> 下，参考：<a href="https://newdocs.phaser.io/docs/3.54.0/Phaser.Physics.Matter.MatterPhysics#applyForceFromAngle" target="_blank" rel="noopener noreferrer">https://newdocs.phaser.io/docs/3.54.0/Phaser.Physics.Matter.MatterPhysics#applyForceFromAngle</a></p><ul><li><code>applyForce(bodies, force)</code>: Applies a force to a body, at the bodies current position, including resulting torque.</li><li><code>applyForceFromPosition(bodies, position, speed, [angle])</code>: <ul><li>Applies a force to a body, from the given world position, including resulting torque. If no angle is given, the current body angle is used.</li><li>Use very small speed values, such as 0.1, depending on the mass and required velocity.</li><li>注意这里的 <code>position</code> 是摄像机里的目标位置，而非平面坐标位置，关于这个，调了很久！</li></ul></li><li><code>applyForceFromAngle(bodies, speed, [angle])</code>: <ul><li>Apply a force to a body based on the given angle and speed. If no angle is given, the current body angle is used.</li><li>Use very small speed values, such as 0.1, depending on the mass and required velocity.</li></ul></li></ul><p>我很想给大家画点示意图，因为官网的文档给的并不详细，并给出多种力导向的做法，比如生成一个 matter body，或者生成虚拟的形状，这两种各有利弊，但此处限于篇幅，暂时就不赘述了把！</p><p>目前我们是使用了基于点位置的扇形力导向，但其实也很方便做多种导向（类比 moba 游戏的英雄技能！）。</p><h2 class="anchor anchorWithStickyNavbar_rB0w" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_rB0w" id="微信小游戏">微信小游戏<a class="hash-link" href="#微信小游戏" title="标题的直接链接">​</a></h3><p>我们本来想要做微信小游戏的，结果需要至少一个月的审核，并且还需要软著，觉得没必要，就没搞了。。。</p><ul><li>(16)小游戏渲染 | 微信开放社区, <a href="https://developers.weixin.qq.com/community/develop/doc/000e0e01990300540807830c951009" target="_blank" rel="noopener noreferrer">https://developers.weixin.qq.com/community/develop/doc/000e0e01990300540807830c951009</a></li><li>小程序资质审核, <a href="https://mp.weixin.qq.com/wxamp/frame/pluginRedirect/pluginRedirect?title=&amp;action=plugin_redirect&amp;token=445115645&amp;lang=zh_CN&amp;plugin_uin=1031&amp;custom=isApplyPayPc%3Dfalse" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/wxamp/frame/pluginRedirect/pluginRedirect?title=&amp;action=plugin_redirect&amp;token=445115645&amp;lang=zh_CN&amp;plugin_uin=1031&amp;custom=isApplyPayPc%3Dfalse</a></li><li>个人开发者的游戏自审自查报告是否按照官方的截图，打印出来后签名，然后拍照即可？ | 微信开放社区, <a href="https://developers.weixin.qq.com/community/develop/doc/0000026f4c4548ca35198fbd851800" target="_blank" rel="noopener noreferrer">https://developers.weixin.qq.com/community/develop/doc/0000026f4c4548ca35198fbd851800</a></li><li>※※申请软著标本&amp;小游戏提交的技巧※※ - 非技术 - Cocos中文社区, <a href="https://forum.cocos.org/t/topic/69267" target="_blank" rel="noopener noreferrer">https://forum.cocos.org/t/topic/69267</a></li></ul><h3 class="anchor anchorWithStickyNavbar_rB0w" id="jsreact-相关游戏资源教程">JS/React 相关游戏资源、教程<a class="hash-link" href="#jsreact-相关游戏资源教程" title="标题的直接链接">​</a></h3><p>强推一款需要 64 G 内存的超大型多人在线沙盒游戏，基于 nextjs + webgl + webAssembly 的：Biomes — Join the community shaping a new world, <a href="https://www.biomes.gg/" target="_blank" rel="noopener noreferrer">https://www.biomes.gg/</a></p><ul><li>Games - React.js Examples, <a href="https://reactjsexample.com/tag/games/" target="_blank" rel="noopener noreferrer">https://reactjsexample.com/tag/games/</a></li><li>Building Steam Games with React — Syntax Podcast 176, <a href="https://syntax.fm/show/176/building-steam-games-with-react" target="_blank" rel="noopener noreferrer">https://syntax.fm/show/176/building-steam-games-with-react</a></li><li>Building a Game with Three.js, React and WebGL — SitePoint, <a href="https://www.sitepoint.com/building-a-game-reactjs-and-webgl/" target="_blank" rel="noopener noreferrer">https://www.sitepoint.com/building-a-game-reactjs-and-webgl/</a></li><li>Mario Jump, <a href="https://mariojumpp.vercel.app/" target="_blank" rel="noopener noreferrer">https://mariojumpp.vercel.app/</a></li></ul><h2 class="anchor anchorWithStickyNavbar_rB0w" id="最后">最后<a class="hash-link" href="#最后" title="标题的直接链接">​</a></h2><p>哈哈哈，本来以为两小时就能搞定的小游戏，没想到扯出这么多犊子，哈哈哈哈，真地没谁了！</p><p>有兴趣的朋友可以一起开发 V7 吹羽毛呀。（或者不会写代码，去点个赞也可以啊 👀 ）</p><ul><li><p>V2 （实验版本。基于 <code>socket.io</code>，多人世界模型）</p></li><li><p>V4 （这个版本完成度最高。基于 <code>react-three-fiber</code>，未来有 3D 渲染/游戏的需求，这个 library 是首选）</p><ul><li><p>开发地址：<a href="https://github.com/cs-magic/feather-v4" target="_blank" rel="noopener noreferrer">https://github.com/cs-magic/feather-v4</a></p></li><li><p>体验网址: <a href="https://f4.cs-magic.cn" target="_blank" rel="noopener noreferrer">https://f4.cs-magic.cn</a></p></li></ul></li><li><p>V7 （目前的主力版本。基于 <code>phaser</code>，目前对这个更感兴趣，因为接下来想借助 <code>phaser</code> 做一些基于 AIGC 的 2D RPG 游戏）</p><ul><li><p>开发地址：<a href="https://github.com/cs-magic/feather-v7" target="_blank" rel="noopener noreferrer">https://github.com/cs-magic/feather-v7</a></p></li><li><p>体验网址: <a href="https://f7.cs-magic.cn" target="_blank" rel="noopener noreferrer">https://f7.cs-magic.cn</a></p></li></ul></li></ul><p>以上！我们下次再见！</p><p><strong>但愿我们每个人都能加薪！</strong></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_WmAe"><div class="col margin-top--sm"><a href="https://github.com/markshawn2020/docusaurus/edit/master/my-documents/blog/2023/09-25-当我想做一款吹羽毛小游戏…….md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_IMw_" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2023/12/18/南川骑行川藏线（中）"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">南川骑行川藏线（中）</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2023/08/31/Poketto.AI 每一个人的哆啦A梦"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Poketto.AI: 每一个人的哆啦A梦</div></a></nav></main><div class="col col--2"><div class="tableOfContents_RLlU thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#背景" class="table-of-contents__link toc-highlight">背景</a></li><li><a href="#目标设计" class="table-of-contents__link toc-highlight">目标设计</a><ul><li><a href="#v1-梦开始的地方" class="table-of-contents__link toc-highlight">V1 梦开始的地方</a></li><li><a href="#v2-伟大但失败的多人混战模型" class="table-of-contents__link toc-highlight">V2 伟大但失败的多人混战模型</a></li><li><a href="#v3-只要肯放弃万事无难事" class="table-of-contents__link toc-highlight">V3 只要肯放弃，万事无难事</a></li><li><a href="#v4-游戏开发的左手渲染引擎" class="table-of-contents__link toc-highlight">V4 游戏开发的左手：渲染引擎！</a></li><li><a href="#v7-游戏开发的右手游戏引擎" class="table-of-contents__link toc-highlight">V7 游戏开发的右手：游戏引擎！</a></li></ul></li><li><a href="#核心技术汇总" class="table-of-contents__link toc-highlight">核心技术汇总</a><ul><li><a href="#fps" class="table-of-contents__link toc-highlight">FPS</a></li><li><a href="#socket-与-nextjs-的集成" class="table-of-contents__link toc-highlight">socket 与 nextjs 的集成</a></li><li><a href="#游戏引擎与-reactnextjs-的集成" class="table-of-contents__link toc-highlight">游戏引擎与 React/NextJS 的集成</a></li><li><a href="#力导向" class="table-of-contents__link toc-highlight">力导向</a></li></ul></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#微信小游戏" class="table-of-contents__link toc-highlight">微信小游戏</a></li><li><a href="#jsreact-相关游戏资源教程" class="table-of-contents__link toc-highlight">JS/React 相关游戏资源、教程</a></li></ul></li><li><a href="#最后" class="table-of-contents__link toc-highlight">最后</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Core</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/archive">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Docusaurus</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/category/guides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://joshcena.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case: Joshua Chen<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vercel.com/markshawn2020/docusaurus/deployments" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vercel Deploy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://analytics.google.com/analytics/web/#/p324822374/reports/reportinghub?params=_u.dateOption%3DthisWeekSatToToday" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Analytics<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ap-east-1.console.aws.amazon.com/ec2/home?region=ap-east-1#InstanceDetails:instanceId=i-02fffe2800e2025e1" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS EC2 Monitor (VPN)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_Rdzz"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aacdcb6f.js"></script>
<script src="/assets/js/main.c22735e8.js"></script>
</body>
</html>